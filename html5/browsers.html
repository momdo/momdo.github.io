<!DOCTYPE html><html lang="ja"><meta charset="utf-8"><title>5 ウェブページの読み込み — HTML5 日本語訳</title><script src="link-fixup.js"></script><!--nobanner-->
<style type="text/css">
body{line-height:1.5;}
     .applies thead th > * { display: block; }
     .applies thead code { display: block; }
     .applies tbody th { white-space: nowrap; }
     .applies td { text-align: center; }
     .applies .yes { background: yellow; }

     .matrix, .matrix td { border: hidden; text-align: right; }
     .matrix { margin-left: 2em; }

     .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
     .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
     .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

     td.eg { border-width: thin; text-align: center; }

     #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
     #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
     #table-example-1 caption { padding-bottom: 0.5em; }
     #table-example-1 thead, #table-example-1 tbody { border: none; }
     #table-example-1 th, #table-example-1 td { border: solid thin; }
     #table-example-1 th { font-weight: normal; }
     #table-example-1 td { border-style: none solid; vertical-align: top; }
     #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
     #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
     #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
     #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
     #table-example-1 tbody td:first-child::after { content: leader(". "); }
     #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
     #table-example-1 tbody td:first-child + td { width: 10em; }
     #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
     #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

     .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
     .apple-table-examples * { font-family: "Times", serif; }
     .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
     .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
     .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
     .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
     .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
     .apple-table-examples td { text-align: right; vertical-align: top; }
     .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
     .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
     .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
     .apple-table-examples sup { line-height: 0; }

     .details-example img { vertical-align: top; }

     #base64-table {
       white-space: nowrap;
       font-size: 0.6em;
       column-width: 6em;
       column-count: 5;
       column-gap: 1em;
       -moz-column-width: 6em;
       -moz-column-count: 5;
       -moz-column-gap: 1em;
       -webkit-column-width: 6em;
       -webkit-column-count: 5;
       -webkit-column-gap: 1em;
     }
     #base64-table thead { display: none; }
     #base64-table * { border: none; }
     #base64-table tbody td:first-child:after { content: ':'; }
     #base64-table tbody td:last-child { text-align: right; }

     #named-character-references-table {
       white-space: nowrap;
       font-size: 0.6em;
       column-width: 30em;
       column-gap: 1em;
       -moz-column-width: 30em;
       -moz-column-gap: 1em;
       -webkit-column-width: 30em;
       -webkit-column-gap: 1em;
     }
     #named-character-references-table > table > tbody > tr > td:first-child + td,
     #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
     #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
     #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

     .glyph.control { color: red; }

     @font-face {
       font-family: 'Essays1743';
       src: url('fonts/Essays1743.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-weight: bold;
       src: url('fonts/Essays1743-Bold.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       src: url('fonts/Essays1743-Italic.ttf');
     }
     @font-face {
       font-family: 'Essays1743';
       font-style: italic;
       font-weight: bold;
       src: url('fonts/Essays1743-BoldItalic.ttf');
     }

    </style>
<style type="text/css">
       pre { margin-left: 2em; white-space: pre-wrap; }
       h2 { margin: 3em 0 1em 0; }
       h3 { margin: 2.5em 0 1em 0; }
       h4 { margin: 2.5em 0 0.75em 0; }
       h5, h6 { margin: 2.5em 0 1em; }
       h1 + h2, h1 + h2 + h2, h1 + p, h1 + p + h2 { margin: 0.75em 0 0.75em; }
       h2 + h3, h3 + h4, h4 + h5, h5 + h6 { margin-top: 0.5em; }
       p { margin: 1em 0; }
       hr:not(.top) { display: block; background: none; border: none; padding: 0; margin: 2em 0; height: auto; }
       .element dd,  .element dl { margin-top: 0em; margin-bottom: 0.25em;}
       dt { margin-top: 0.75em; margin-bottom: 0.5em; clear: left; }
        .element dt { margin-top: 0.5em; margin-bottom: 0.5em;  }
       dt + dt { margin-top: 0; }
       dd dt { margin-top: 0.25em; margin-bottom: 0; }
       dd p { margin-top: 0; }
       dd dl + p { margin-top: 1em; }
       dd table + p { margin-top: 1em; }
       p + * > li, dd li { margin: 1em 0; }
       dt, dfn { font-weight: bold; font-style: normal; }
       i, em { font-style: italic; }
       dt dfn { font-style: italic; }
       pre, code { font-size: inherit; font-family: monospace; font-variant: normal; }
       pre strong { color: black; font: inherit; font-weight: bold; background: yellow; }
       pre em { font-weight: bolder; font-style: normal; }
       @media screen { code { color: #D93B00; } code :link, code :visited { color: inherit; } }
       var { background-color: #f9f9f9; border: 1px solid #eee; padding: 0 2px; }
       var sub { vertical-align: bottom; font-size: smaller; position: relative; top: 0.1em; }
       table { border-collapse: collapse; border-style: hidden hidden none hidden; }
       table thead, table tbody { border-bottom: solid; }
       table tbody th:first-child { border-left: solid; }
       table tbody th { text-align: left; }
       table td, table th { border-left: solid; border-right: solid; border-bottom: solid thin; vertical-align: top; padding: 0.2em; }
       blockquote { margin: 0 0 0 2em; border: 0; padding: 0; font-style: italic; }

       .bad, .bad *:not(.XXX) { color: #5F6D7A; border-color: gray; background: transparent; }
       .matrix, .matrix td { border: none; text-align: right; }
       .matrix { margin-left: 2em; }
       .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
       .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
       .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

       .toc dfn, h1 dfn, h2 dfn, h3 dfn, h4 dfn, h5 dfn, h6 dfn { font: inherit; }
       img.extra, p.overview { float: right; }
       pre.idl { border: solid thin #d3d3d3; background: #FCFCFC; color: black; padding: 0.5em 1em; position: relative; }
       pre.idl :link, pre.idl :visited { color: inherit; background: transparent; }
       pre.idl::before { content: "IDL"; font: bold small sans-serif; padding: 0.5em; background: white; position: absolute; top: 0; margin: -1px 0 0 -4em; width: 1.5em; border: thin solid; border-radius: 0 0 0 0.5em }
       pre.css { border: solid thin; background: #FFFFEE; color: black; padding: 0.5em 1em; }
       pre.css:first-line { color: #AAAA50; }
       dl.domintro {padding: 0.5em 1em; border: none; background:#E9FBE9; border: 1px solid lightgray; }
       hr + dl.domintro, div.impl + dl.domintro { margin-top: 2.5em; margin-bottom: 1.5em; }
       dl.domintro dt, dl.domintro dt * { color: black; text-decoration: none; }
       dl.domintro dd { margin: 0.5em 0 1em 2em; padding: 0; }
       dl.domintro dd p { margin: 0.5em 0; }
       dl.domintro:before { display: table; margin: -1em -0.5em -0.5em auto; width: auto; content: 'This definition is non-normative. Implementation requirements are given below this definition.'; color: #606060; border:1px solid lightgray; background: white; padding: 0 0.25em;font-size:.9em;}
       dl.switch { padding-left: 2em; }
       dl.switch > dt { text-indent: -1.5em; }
       dl.switch > dt:before { content: '\21AA'; padding: 0 0.5em 0 0; display: inline-block; width: 1em; text-align: right; line-height: 0.5em; }
       dl.triple { padding: 0 0 0 1em; }
       dl.triple dt, dl.triple dd { margin: 0; display: inline }
       dl.triple dt:after { content: ':'; }
       dl.triple dd:after { content: '\A'; white-space: pre; }
       .diff-old { text-decoration: line-through; color: silver; background: transparent; }
       .diff-chg, .diff-new { text-decoration: underline; color: green; background: transparent; }
       a .diff-new { border-bottom: 1px blue solid; }

       figure.diagrams { border: double black; background: white; padding: 1em; }
       figure.diagrams img { display: block; margin: 1em auto; } 

       h2 { page-break-before: always; }
       h1, h2, h3, h4, h5, h6 { page-break-after: avoid; }
       h1 + h2, hr + h2.no-toc { page-break-before: auto; }

       p  > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang]),
       li > span:not([title=""]):not([class="XXX"]):not([class="impl"]):not([class="note"]):not([class="t2"]):not([id]):not([lang])
       { border-bottom: solid #9999CC; }

       div.head { margin: 0 0 1em; padding: 1em 0 0 0; }
       div.head p { margin: 0; }
       div.head h1 { margin: 0; }
       div.head .logo { float: right; margin: 0 1em; }
       div.head .logo img { border: none } /* remove border from top image */
       div.head dl { margin: 1em 0; }
       div.head p.copyright, div.head p.alt { font-size: x-small; font-style: oblique; margin: 0; }

       body > .toc > li { margin-top: 1em; margin-bottom: 1em; }
       body > .toc.brief > li { margin-top: 0.35em; margin-bottom: 0.35em; }
       body > .toc > li > * { margin-bottom: 0.5em; }
       body > .toc > li > * > li > * { margin-bottom: 0.25em; }
       .toc, .toc li { list-style: none; }

       .brief { margin-top: 1em; margin-bottom: 1em; line-height: 1.1; }
       .brief li { margin: 0; padding: 0; }
       .brief li p { margin: 0; padding: 0; }

       .category-list { margin-top: -0.75em; margin-bottom: 1em; line-height: 1.5; }
       .category-list::before { content: '\21D2\A0'; font-size: 1.2em; font-weight: 900; }
       .category-list li { display: inline; }
       .category-list li:not(:last-child)::after { content: ', '; }
       .category-list li > span, .category-list li > a { text-transform: lowercase; }
       .category-list li * { text-transform: none; } /* don't affect <code> nested in <a> */

       .XXX { color: #E50000; background: white; border: solid red; padding: 0.5em; margin: 1em 0; }
       .XXX > :first-child { margin-top: 0; }
       p .XXX { line-height: 3em; }
       .annotation { border: solid thin black; background: #0C479D; color: white; position: relative; margin: 8px 0 20px 0; }
       .annotation:before { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 6px -6px -6px 6px; background: #333333; z-index: -1; content: ''; }
       .annotation :link, .annotation :visited { color: inherit; }
       .annotation :link:hover, .annotation :visited:hover { background: transparent; }
       .annotation span { border: none ! important; }
       .note { border-left-style: solid; border-left-width: 0.25em; background: none repeat scroll 0 0 #E9FBE9; border-color: #52E052; }
       .warning { background-color: #F9F0D4; border: medium double #FF0000; margin: 1em; padding: 1em; }
       .note em, .warning em, .note i, .warning i { font-style: normal; }
       p.note, div.note { padding: 0.5em 2em; }
       span.note { padding: 0 2em; }
       .note p:first-child, .warning p:first-child { margin-top: 0; }
       .note p:last-child, .warning p:last-child { margin-bottom: 0; }
       .warning:before { font-style: normal; }
       p.note:before { content: 'Note: '; font-weight: bolder;}
       p.warning:before { content: '\26A0 Warning! '; font-weight:bolder;}
       .critical {margin:1em; border:double red; padding:1em; background-color:#F9F0D4;}

       .bookkeeping:before { display: block; content: 'Bookkeeping details'; font-weight: bolder; font-style: italic; }
       .bookkeeping { font-size: 0.8em; margin: 2em 0; }
       .bookkeeping p { margin: 0.5em 2em; display: list-item; list-style: square; }
       .bookkeeping dt { margin: 0.5em 2em 0; }
       .bookkeeping dd { margin: 0 3em 0.5em; }

       h4 { position: relative; z-index: 3; }
       h4 + .element, h4 + div + .element { margin-top: -2.5em; padding-top: 2em; }
       .element {
         background: #F4F4FA;
         color: black;
         margin: 0 0 1em 0.15em;
         padding: 0 1em 0.25em 0.75em;
         border-left: solid #9999FF 0.25em;
         position: relative;
         z-index: 1;
       }
       .element:before {
         position: absolute;
         z-index: 2;
         top: 0;
         left: -1.15em;
         height: 2em;
         width: 0.9em;
         background: #F4F4FA;
         content: ' ';
         border-style: none none solid solid;
         border-color: #9999FF;
         border-width: 0.25em;
       }

       .example { display: block; color: #222222; background: #FCFCFC; border-left-style: solid;border-color:#c0c0c0; border-left-width: 0.25em; margin-left: 1em; padding-left: 1em;padding-bottom: 0.5em;}
       div.example:before { content: 'Code Example: '; font-weight: bolder;}
       td > .example:only-child { margin: 0 0 0 0.1em; }

       ul.domTree, ul.domTree ul { padding: 0 0 0 1em; margin: 0; }
       ul.domTree li { padding: 0; margin: 0; list-style: none; position: relative; }
       ul.domTree li li { list-style: none; }
       ul.domTree li:first-child::before { position: absolute; top: 0; height: 0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree li:not(:last-child)::after { position: absolute; top: 0; bottom: -0.6em; left: -0.75em; width: 0.5em; border-style: none none solid solid; content: ''; border-width: 0.1em; }
       ul.domTree span { font-style: italic; font-family: serif; }
       ul.domTree .t1 code { color: purple; font-weight: bold; }
       ul.domTree .t2 { font-style: normal; font-family: monospace; }
       ul.domTree .t2 .name { color: black; font-weight: bold; }
       ul.domTree .t2 .value { color: blue; font-weight: normal; }
       ul.domTree .t3 code, .domTree .t4 code, .domTree .t5 code { color: gray; }
       ul.domTree .t7 code, .domTree .t8 code { color: green; }
       ul.domTree .t10 code { color: teal; }

       body.dfnEnabled dfn { cursor: pointer; }
       .dfnPanel {
         display: inline;
         position: absolute;
         z-index: 10;
         height: auto;
         width: auto;
         padding: 0.5em 0.75em;
         font: small sans-serif, Droid Sans Fallback;
         background: #DDDDDD;
         color: black;
         border: outset 0.2em;
       }
       .dfnPanel * { margin: 0; padding: 0; font: inherit; text-indent: 0; }
       .dfnPanel :link, .dfnPanel :visited { color: black; }
       .dfnPanel p { font-weight: bolder; }
       .dfnPanel * + p { margin-top: 0.25em; }
       .dfnPanel li { list-style-position: inside; }

       #configUI { position: absolute; z-index: 20; top: 10em; right: 1em; width: 11em; font-size: small; }
       #configUI p { margin: 0.5em 0; padding: 0.3em; background: #EEEEEE; color: black; border: inset thin; }
       #configUI p label { display: block; }
       #configUI #updateUI, #configUI .loginUI { text-align: center; }
       #configUI input[type=button] { display: block; margin: auto; }

       fieldset { margin: 1em; padding: 0.5em 1em; }
       fieldset > legend + * { margin-top: 0; }
       fieldset > :last-child { margin-bottom: 0; }
       fieldset p { margin: 0.5em 0; }
       header p.subline {color:#005A9C; font: 140% sans-serif;margin: 0.75em 0;}
       #authorButton {overflow: visible; padding: 0.1em 0.3em; position: fixed; right: 2em; top: 6em; width: auto;}

       @media print {#authorButton { display:none;}}

   .stability {
     position: fixed;
     bottom: 0;
     left: 0; right: 0;
     margin: 0 auto 0 auto;
     width: 50%;
     background: maroon; color: yellow;
     -webkit-border-radius: 1em 1em 0 0;
     -moz-border-radius: 1em 1em 0 0;
     border-radius: 1em 1em 0 0;
     -moz-box-shadow: 0 0 1em #500;
     -webkit-box-shadow: 0 0 1em #500;
     box-shadow: 0 0 1em red;
     padding: 0.5em 1em;
     text-align: center;
   }
   .stability strong {
     display: block;
   }
   .stability input {
     -moz-appearance: none; -webkit-appearance: none; margin: 0; 
     border: 0; padding: 0.25em 0.5em; background: transparent; color: black;
     position: absolute; top: -0.5em; right: 0; font: 1.25em sans-serif; text-align: center;
   }
   .stability input:hover {
     color: white;
     text-shadow: 0 0 2px black;
   }
   .stability input:active {
     padding: 0.3em 0.45em 0.2em 0.55em;
   }
   .stability :link, .stability :visited,
   .stability :link:hover, .stability :visited:hover {
     background: transparent;
     color: white;
   }

  </style><!-- style switcher script by Stommepoes  --><link href="http://www.w3.org/StyleSheets/TR/W3C-CR" rel="stylesheet" type="text/css"><link href="switcher/author-view.css" id="author-view" rel="alternate stylesheet" title="Author documentation only"><script src="switcher/authorstylesheet.js"></script><link href="disabled-elements.html" rel="prev" title="4.13 Disabled elements">
  <link href="Overview.html#contents" rel="contents" title="目次">
  <link href="webappapis.html" rel="next" title="6 Web application APIs">
  <body class="split chapter" onload="fixBrokenLink();"><div class="head" id="head">
<header><span id="styleSwitch"></span>
   <p><a href="http://www.w3.org/"><img alt="W3C" height="48" src="http://www.w3.org/Icons/w3c_home" width="72"></a></p>

    <h1 id="big-title">HTML5日本語訳</h1>
    <p class="no-num no-toc subline">HTMLとXHTMLのための語彙と関連API</p>
   <h2 class="no-num no-toc" id="w3c-candidate-recommendation-31-july-2014">W3C Candidate Recommendation 31 July 2014</h2>
   </header></div>
  

  <nav class="prev_next">
   <a href="disabled-elements.html">← 4.13 無効要素</a> – <a href="Overview.html#contents">目次</a> – <a href="webappapis.html">6 WebアプリケーションAPI →</a>
  <ol class="toc"><li><a href="browsers.html#browsers"><span class="secno">5</span> ウェブページの読み込み</a>
  <ol><li><a href="browsers.html#windows"><span class="secno">5.1</span> ブラウジングコンテキスト</a>
    <ol><li><a href="browsers.html#nested-browsing-contexts"><span class="secno">5.1.1</span> ネストされたブラウジングコンテキスト</a>
      <ol><li><a href="browsers.html#navigating-nested-browsing-contexts-in-the-dom"><span class="secno">5.1.1.1</span> DOM内でネストされたブラウジングコンテキストを操作する</a></li></ol></li><li><a href="browsers.html#auxiliary-browsing-contexts"><span class="secno">5.1.2</span> 補助ブラウジングコンテキスト</a>
      <ol><li><a href="browsers.html#navigating-auxiliary-browsing-contexts-in-the-dom"><span class="secno">5.1.2.1</span> DOM内の補助ブラウジングコンテキストを操作する</a></li></ol></li><li><a href="browsers.html#secondary-browsing-contexts"><span class="secno">5.1.3</span> セカンダリブラウジングコンテキスト</a></li><li><a href="browsers.html#security-nav"><span class="secno">5.1.4 </span>Security</a></li><li><a href="browsers.html#groupings-of-browsing-contexts"><span class="secno">5.1.5 </span>Groupings of browsing contexts</a></li><li><a href="browsers.html#browsing-context-names"><span class="secno">5.1.6</span> ブラウジングコンテキスト名</a></li></ol></li><li><a href="browsers.html#the-window-object"><span class="secno">5.2</span> <code>Window</code>オブジェクト</a>
    <ol><li><a href="browsers.html#security-window"><span class="secno">5.2.1 </span>Security</a></li><li><a href="browsers.html#apis-for-creating-and-navigating-browsing-contexts-by-name"><span class="secno">5.2.2</span> 名前でブラウジングコンテキストを作成および操作するためのAPI</a></li><li><a href="browsers.html#accessing-other-browsing-contexts"><span class="secno">5.2.3</span> 他のブラウジングコンテキストへのアクセス</a></li><li><a href="browsers.html#named-access-on-the-window-object"><span class="secno">5.2.4</span> <code>Window</code>オブジェクトの名前付きアクセス</a></li><li><a href="browsers.html#garbage-collection-and-browsing-contexts"><span class="secno">5.2.5 </span>Garbage collection and browsing contexts</a></li><li><a href="browsers.html#closing-browsing-contexts"><span class="secno">5.2.6</span> ブラウジングコンテキストを閉じる</a></li><li><a href="browsers.html#browser-interface-elements"><span class="secno">5.2.7</span> ブラウザインターフェース要素</a></li><li><a href="browsers.html#the-windowproxy-object"><span class="secno">5.2.8 </span>The <code>WindowProxy</code> object</a></li></ol></li><li><a href="browsers.html#origin"><span class="secno">5.3</span> 生成元</a>
    <ol><li><a href="browsers.html#relaxing-the-same-origin-restriction"><span class="secno">5.3.1</span> 同一生成元制限を緩和する</a></li></ol></li><li><a href="browsers.html#sandboxing"><span class="secno">5.4</span> サンドボックス</a></li><li><a href="browsers.html#history"><span class="secno">5.5</span> セッション履歴およびナビゲーション</a>
    <ol><li><a href="browsers.html#the-session-history-of-browsing-contexts"><span class="secno">5.5.1</span> ブラウジングコンテキストのセッション履歴</a></li><li><a href="browsers.html#the-history-interface"><span class="secno">5.5.2</span> <code>History</code>インターフェース</a></li><li><a href="browsers.html#the-location-interface"><span class="secno">5.5.3</span> <code>Location</code>インターフェース</a>
      <ol><li><a href="browsers.html#security-location"><span class="secno">5.5.3.1 </span>Security</a></li></ol></li><li><a href="browsers.html#history-notes"><span class="secno">5.5.4 </span>Implementation notes for session history</a></li></ol></li><li><a href="browsers.html#browsing-the-web"><span class="secno">5.6</span> ウェブを閲覧する</a>
    <ol><li><a href="browsers.html#navigating-across-documents"><span class="secno">5.6.1 </span>Navigating across documents</a></li><li><a href="browsers.html#read-html"><span class="secno">5.6.2 </span>Page load processing model for HTML files</a></li><li><a href="browsers.html#read-xml"><span class="secno">5.6.3 </span>Page load processing model for XML files</a></li><li><a href="browsers.html#read-text"><span class="secno">5.6.4 </span>Page load processing model for text files</a></li><li><a href="browsers.html#read-multipart-x-mixed-replace"><span class="secno">5.6.5 </span>Page load processing model for <code>multipart/x-mixed-replace</code> resources</a></li><li><a href="browsers.html#read-media"><span class="secno">5.6.6 </span>Page load processing model for media</a></li><li><a href="browsers.html#read-plugin"><span class="secno">5.6.7 </span>Page load processing model for content that uses plugins</a></li><li><a href="browsers.html#read-ua-inline"><span class="secno">5.6.8 </span>Page load processing model for inline
  content that doesn't have a DOM</a></li><li><a href="browsers.html#scroll-to-fragid"><span class="secno">5.6.9 </span>Navigating to a fragment identifier</a></li><li><a href="browsers.html#history-traversal"><span class="secno">5.6.10</span> 履歴走査</a>
      <ol><li><a href="browsers.html#event-definitions-0"><span class="secno">5.6.10.1 </span>Event definitions</a></li></ol></li><li><a href="browsers.html#unloading-documents"><span class="secno">5.6.11</span> 文書の解放</a>
      <ol><li><a href="browsers.html#event-definition"><span class="secno">5.6.11.1 </span>Event definition</a></li></ol></li><li><a href="browsers.html#aborting-a-document-load"><span class="secno">5.6.12 </span>Aborting a document load</a></li></ol></li><li><a href="browsers.html#offline"><span class="secno">5.7</span> オフラインウェブアプリケーション</a>
    <ol><li><a href="browsers.html#introduction-3"><span class="secno">5.7.1</span> 導入</a>
      <ol><li><a href="browsers.html#supporting-offline-caching-for-legacy-applications"><span class="secno">5.7.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート</a></li><li><a href="browsers.html#appcacheevents"><span class="secno">5.7.1.2</span> イベントの概要</a></li></ol></li><li><a href="browsers.html#appcache"><span class="secno">5.7.2 </span>Application caches</a></li><li><a href="browsers.html#manifests"><span class="secno">5.7.3</span> キャッシュマニフェスト構文</a>
      <ol><li><a href="browsers.html#some-sample-manifests"><span class="secno">5.7.3.1</span> サンプルマニフェスト</a></li><li><a href="browsers.html#writing-cache-manifests"><span class="secno">5.7.3.2</span> キャッシュマニフェストの記述</a></li><li><a href="browsers.html#parsing-cache-manifests"><span class="secno">5.7.3.3 </span>Parsing cache manifests</a></li></ol></li><li><a href="browsers.html#downloading-or-updating-an-application-cache"><span class="secno">5.7.4 </span>Downloading or updating an application cache</a></li><li><a href="browsers.html#the-application-cache-selection-algorithm"><span class="secno">5.7.5 </span>The application cache selection algorithm</a></li><li><a href="browsers.html#changesToNetworkingModel"><span class="secno">5.7.6 </span>Changes to the networking model</a></li><li><a href="browsers.html#expiring-application-caches"><span class="secno">5.7.7 </span>Expiring application caches</a></li><li><a href="browsers.html#disk-space"><span class="secno">5.7.8 </span>Disk space</a></li><li><a href="browsers.html#application-cache-api"><span class="secno">5.7.9</span> アプリケーションキャッシュAPI</a></li><li><a href="browsers.html#browser-state"><span class="secno">5.7.10</span> ブラウザの状態</a></li></ol></li></ol></li></ol></nav>

  <h2 id="browsers"><span class="secno">5</span> ウェブページの読み込み</h2>

  <div class="impl">

  <p>This section describes features that apply most directly to Web browsers. Having said that,
  except where specified otherwise, the requirements defined in this section <em>do</em> apply to
  all user agents, whether they are Web browsers or not.</p>

  </div>



  <h3 id="windows"><span class="secno">5.1</span> ブラウジングコンテキスト</h3>

  <p><dfn id="browsing-context">ブラウジングコンテキスト</dfn>は<code><a href="dom.html#document">Document</a></code>オブジェクトがユーザーに提示される環境である。</p>

  <p class="note"><code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>を含むと同様に、ウェブブラウザにおいてタブやウィンドウは通常、<a href="#browsing-context">ブラウジングコンテキスト</a>を含む。<span class="impl"> or <code><a href="obsolete.html#frame">frame</a></code>s in a
  <code><a href="obsolete.html#frameset">frameset</a></code></span></p>

  <p>各<a href="#browsing-context">ブラウジングコンテキスト</a>は、対応する<code><a href="#windowproxy">WindowProxy</a></code>オブジェクトを持つ。</p>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a>は、<a href="#browsing-context">ブラウジングコンテキスト</a>が提示されていた、している、またはするだろう<code><a href="dom.html#document">Document</a></code>オブジェクトを一覧表示する<a href="#session-history">セッション履歴</a>を持つ。任意の時点で、それぞれの<a href="#browsing-context">ブラウジングコンテキスト</a>で1つの<code><a href="dom.html#document">Document</a></code>が<dfn id="active-document">アクティブドキュメント</dfn>を指定される。<code><a href="dom.html#document">Document</a></code>の<a href="#browsing-context">ブラウジングコンテキスト</a>は、もしあれば、<a href="#session-history">セッション履歴</a>が<code><a href="dom.html#document">Document</a></code>を含む<a href="#browsing-context">ブラウジングコンテキスト</a>である。（<code data-anolis-xref="dom-DOMImplementation-createDocument"><a href="infrastructure.html#dom-domimplementation-createdocument">createDocument()</a></code>などのAPIを使用して作成された<code><a href="dom.html#document">Document</a></code>は、一切<a href="#browsing-context">ブラウジングコンテキスト</a>を持たない。）</p>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a>内の各<code><a href="dom.html#document">Document</a></code>は、<code><a href="#window">Window</a></code>オブジェクトに<dfn data-anolis-xref="concept-document-window" id="concept-document-window">関連づける</dfn>。<a href="#browsing-context">ブラウジングコンテキスト</a>の<code><a href="#windowproxy">WindowProxy</a></code>オブジェクトは、すべて<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#active-document">アクティブドキュメント</a>の<code><a href="#window">Window</a></code>オブジェクトへ転送する。</p>

  <p class="note">一般に、<code><a href="#window">Window</a></code>オブジェクトから<code><a href="dom.html#document">Document</a></code>オブジェクトへ1対1の対応が存在する。2つの例外が存在する。まず、<code><a href="#window">Window</a></code>は、マッピングが1対2になるような、同じ<a href="#browsing-context">ブラウジングコンテキスト</a>における2番目の<code><a href="dom.html#document">Document</a></code>のプレゼンテーションに対して再利用できる。<a href="#replacement-enabled">交換が有効になっている</a>、<a href="#browsing-context">ブラウジングコンテキスト</a>は初期<code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code>から別のものに<a data-anolis-xref="navigate" href="#navigate">ナビゲート</a>したとき、これは起こる。次に、<code><a href="dom.html#document">Document</a></code>は、マッピングが多対1であるような、<code data-anolis-xref="dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code>メソッドが使用される場合、複数の<code><a href="#window">Window</a></code>オブジェクトを再利用されて終わることができる。</p>

  <p class="note"><code><a href="dom.html#document">Document</a></code>は、関連付けられた<a href="#browsing-context">ブラウジングコンテキスト</a>を必ずしも持たない。具体的には、データマイニングツールはブラウジングコンテキストをインスタンス化できないだろう。</p>

  <hr><p><a href="#browsing-context">ブラウジングコンテキスト</a>は、その作成に関与する<a href="#browsing-context">ブラウジングコンテキスト</a>、<dfn id="creator-browsing-context">クリエーターブラウジングコンテキスト</dfn>を持つことができる。<a href="#browsing-context">ブラウジングコンテキスト</a>が<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>を持つ場合、それは、その<a href="#creator-browsing-context">クリエーターブラウジングコンテキスト</a>である。そうでなければ、<a href="#browsing-context">ブラウジングコンテキスト</a>が<a href="#opener-browsing-context">オープナーブラウジングコンテキスト</a>を持つ場合、<em>それ</em>がその<a href="#creator-browsing-context">クリエイターブラウジングコンテキスト</a>である。そうでなければ、<a href="#browsing-context">ブラウジングコンテキスト</a>は<a href="#creator-browsing-context">作成者ブラウジングコンテキスト</a>を持たない。</p>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a><var data-anolis-xref="">A</var>が<a href="#creator-browsing-context">クリエーターブラウジングコンテキスト</a>を持つ場合、<code><a href="dom.html#document">Document</a></code>は<var data-anolis-xref="">A</var>が<dfn id="creator-document">クリエーター<code>Document</code></dfn>を作成された時点で、その<a href="#creator-browsing-context">クリエイターブラウジングコンテキスト</a>の<a href="#active-document">アクティブドキュメント</a>であった。</p>

  <div class="impl">

<!--CLEANUP-->
  <p>When a <a href="#browsing-context">browsing context</a> is first created, it must be created with a single
  <code><a href="dom.html#document">Document</a></code> in its session history, whose <a data-anolis-xref="the document's
  address" href="dom.html#the-document's-address">address</a> is <code><a href="infrastructure.html#about:blank">about:blank</a></code>, which is marked as being an <a data-anolis-xref="HTML
  documents" href="infrastructure.html#html-documents">HTML document</a>, whose <a data-anolis-xref="document's character encoding" href="infrastructure.html#document's-character-encoding">character
  encoding</a> is UTF-8, and which is both <a href="syntax.html#ready-for-post-load-tasks">ready for post-load tasks</a> and
  <a href="syntax.html#completely-loaded">completely loaded</a> immediately, along with a new <code><a href="#window">Window</a></code> object that
  the <code><a href="dom.html#document">Document</a></code> is associated with. The <code><a href="dom.html#document">Document</a></code> must have a single child
  <code><a href="semantics.html#the-html-element">html</a></code> node, which itself has two empty child nodes: a <code><a href="document-metadata.html#the-head-element">head</a></code> element, and a <code><a href="sections.html#the-body-element">body</a></code> element. As soon as this
  <code><a href="dom.html#document">Document</a></code> is created, the user agent must <a href="#implement-the-sandboxing">implement the sandboxing</a> for
  it. If the <a href="#browsing-context">browsing context</a> has a <a href="#creator-document">creator <code>Document</code></a>, then
  the <a href="#browsing-context">browsing context</a>'s <code><a href="dom.html#document">Document</a></code>'s <a data-anolis-xref="the document's
  referrer" href="dom.html#the-document's-referrer">referrer</a> must be set to <a data-anolis-xref="the document's address" href="dom.html#the-document's-address">the address</a>
  of that <a href="#creator-document">creator <code>Document</code></a> at the time of the <a href="#browsing-context">browsing
  context</a>'s creation.</p>

  <p class="note">If the <a href="#browsing-context">browsing context</a> is created specifically to be immediately
  navigated, then that initial navigation will have <a href="#replacement-enabled">replacement enabled</a>.</p>

  <p id="about-blank-origin">The <a href="#origin-0">origin</a> and <a href="#effective-script-origin">effective script origin</a> of the
  <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> are set when the <code><a href="dom.html#document">Document</a></code> is created.
  If the new <a href="#browsing-context">browsing context</a> has a <a href="#creator-browsing-context">creator browsing context</a>, then the
  <a href="#origin-0">origin</a> of the <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the <a href="#creator-document">creator
  <code>Document</code></a> and the <a href="#effective-script-origin">effective script origin</a> of the
  <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#effective-script-origin">effective script origin</a> of the
  <a href="#creator-document">creator <code>Document</code></a>. Otherwise, the <a href="#origin-0">origin</a> of the
  <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> is a globally unique identifier assigned when the
  new <a href="#browsing-context">browsing context</a> is created and the <a href="#effective-script-origin">effective script origin</a> of the
  <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to its <a href="#origin-0">origin</a>.</p>

  </div>


  <h4 id="nested-browsing-contexts"><span class="secno">5.1.1</span> ネストされたブラウジングコンテキスト</h4>

  <p>特定の要素（たとえば、<code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>要素）は、<a data-anolis-xref="browsing context" href="#browsing-context">ブラウジングコンテキスト</a>をさらにインスタンス化できる。これらは、<dfn data-anolis-xref="nested browsing
  context" id="nested-browsing-context">ネストされたブラウジングコンテキスト</dfn>と呼ばれる。ブラウジングコンテキスト<var data-anolis-xref="">P</var>が、その中に別のブラウジングコンテキスト<var data-anolis-xref="">C</var>をネストする要素<var data-anolis-xref="">E</var>とともに<code><a href="dom.html#document">Document</a></code> <var data-anolis-xref="">D</var>を持つ場合、<var data-anolis-xref="">C</var>は<var data-anolis-xref="">D</var>を<dfn data-anolis-xref="browsing context nested through" id="browsing-context-nested-through">介してネストされる</dfn>と言い、<var data-anolis-xref="">E</var>は<var data-anolis-xref="">C</var>の<dfn id="browsing-context-container">ブラウジングコンテキストコンテナ</dfn>であると言われる。<a href="#browsing-context-container">ブラウジングコンテキストコンテナ</a>要素<var data-anolis-xref="">E</var>が<code><a href="dom.html#document">Document</a></code> <var data-anolis-xref="">D</var>の<a data-anolis-xref="in a
  Document" href="infrastructure.html#in-a-document">中に</a>ある場合、<var data-anolis-xref="">P</var>は<var data-anolis-xref="">C</var>の<dfn id="parent-browsing-context">親ブラウジングコンテキスト</dfn>であると言われ、<var data-anolis-xref="">C</var>は<var data-anolis-xref="">P</var>の<dfn id="child-browsing-context">子ブラウジングコンテキスト</dfn>であると言われる。そうでなければ、<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a><var data-anolis-xref="">C</var>は<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>を持たない。</p>

  <p><var data-anolis-xref="">A</var>の<a href="#child-browsing-context">子ブラウジングコンテキスト</a>であるブラウジングコンテキスト<var data-anolis-xref="">A'</var>が存在し、それが<var data-anolis-xref="">B</var>の<a data-anolis-xref="ancestor browsing context" href="#ancestor-browsing-context">祖先</a>自身である場合、または、ブラウジングコンテキスト<var data-anolis-xref="">A</var>が<var data-anolis-xref="">B</var>の<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>である場合、ブラウジングコンテキスト<var data-anolis-xref="">A</var>はブラウジングコンテキスト<var data-anolis-xref="">B</var>の<dfn data-anolis-xref="ancestor browsing
  context" id="ancestor-browsing-context">祖先</dfn>であると言われる。</p>

  <p>ブラウジングコンテキストは<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>が<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>を持たないものでなく、<a href="#ancestor-browsing-context">祖先のブラウジングコンテキスト</a>であるすべてのブラウジングコンテキストの<dfn id="top-level-browsing-context">レベルレベルブラウジングコンテキスト</dfn>である。</p>

  <p><a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>への<a data-anolis-xref="parent browsing context" href="#parent-browsing-context">親ブラウジングコンテキスト</a>の推移クロージャは、<a data-anolis-xref="ancestor browsing
  context" href="#ancestor-browsing-context">先祖ブラウジングコンテキスト</a>のリストを提供する。</p>

  <p><code><a href="dom.html#document">Document</a></code> <var data-anolis-xref="">d</var>の<dfn id="list-of-the-descendant-browsing-contexts">子孫ブラウジングコンテキストのリスト</dfn>は、以下のアルゴリズムによって返される（順序の）リストである：</p>

  <ol><li><p><var data-anolis-xref="">list</var>を空にする。</li>

   <li>

    <p><var data-anolis-xref="">d</var>の各<a href="#child-browsing-context">子ブラウジングコンテキスト</a>は<var data-anolis-xref="">d</var> <a data-anolis-xref="in
    a document" href="infrastructure.html#in-a-document"><code>Document</code>で</a>存在する要素を<a data-anolis-xref="browsing context nested through" href="#browsing-context-nested-through">介してネストされる</a>ので、要素のこれら<a data-anolis-xref="browsing context" href="#browsing-context">ブラウジングコンテキスト</a>をネストする<a href="infrastructure.html#tree-order">ツリー順</a>に、次のサブステップを実行する：</p>

    <ol><li><p>リスト<var data-anolis-xref="">list</var>にその<a href="#child-browsing-context">子ブラウジングコンテキスト</a>を追加する。</p>

     </li><li><p>リスト<var data-anolis-xref="">list</var>にその<a href="#child-browsing-context">子ブラウジングコンテキスト</a>の<a href="#active-document">アクティブドキュメント</a>に属する<a href="#list-of-the-descendant-browsing-contexts">子孫ブラウジングコンテキストのリスト</a>を追加する。</li>

    </ol></li>

   <li><p>構築された<var data-anolis-xref="">list</var>を返す。</li>

  </ol><p>それがその<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#active-document">アクティブドキュメント</a>であり、かつそのブラウジングコンテキストが<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>であるか、それが<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>およびそれ自身が<a href="#fully-active">完全にアクティブ</a>で<a data-anolis-xref="nested browsing context" href="#nested-browsing-context">ネストされる</a><a data-anolis-xref="browsing context nested through" href="#browsing-context-nested-through">経由で</a><code><a href="dom.html#document">Document</a></code>を持つかのいずれかである場合、<code><a href="dom.html#document">Document</a></code>は<dfn id="fully-active">完全にアクティブ</dfn>であると言われる。</p>

  <p>それらは要素を介してネストされるため、<a data-anolis-xref="child browsing context" href="#child-browsing-context">子ブラウジングコンテキスト</a>は常に、<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>内の特定の<code><a href="dom.html#document">Document</a></code>に関連付けられる。ユーザーエージェントは、ユーザーにがいない自身が<a href="#fully-active">完全にアクティブ</a>でない<code><a href="dom.html#document">Document</a></code>にある要素の<a data-anolis-xref="child browsing
  context" href="#child-browsing-context">子ブラウジングコンテキスト</a>と対話することを許可してはならない。</p>

  <p><a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>は、<dfn id="delaying-load-events-mode">遅延<code data-anolis-xref="event-load">load</code>イベントモード</dfn>にすることができる。これは、新しい<code><a href="dom.html#document">Document</a></code>が作成される前に<a href="#browsing-context-container">ブラウジングコンテキストコンテナ</a><code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>要素の<a href="syntax.html#delay-the-load-event">loadイベントを遅らせる</a>ために、<a data-anolis-xref="navigate" href="#navigate">移動された</a>際に使用される。</p><!--(There's no current way for this to happen, since removing an iframe from a document discards its browsing context)
  <p class="note">A <span>nested browsing context</span> can in some cases be taken out of its
  <span>parent browsing context</span> (e.g. if an <code>iframe</code> element is removed from its
  <code>Document</code>). In such a situation, the <span>nested browsing context</span> has no
  <span>parent browsing context</span>, but it still has the same <span>browsing context
  container</span> and is still <span data-x="browsing context nested through">nested through</span>
  that element's <code>Document</code>. Such a <span>nested browsing context</span> is <em>not</em>
  a <span>top-level browsing context</span>, and cannot contain <code>Document</code>s that are
  <span>fully active</span>. Furthermore, if a <span>browsing context container</span> (such as an
  <code>iframe</code>) is moved to another <code>Document</code>, then the <span>parent browsing
  context</span> of its <span>nested browsing context</span> will change.</p>
-->



  <p><a href="#browsing-context">ブラウジングコンテキスト</a>の<dfn id="document-family">ドキュメントファミリー</dfn>は、その<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#session-history">セッション履歴</a>ですべての<code><a href="dom.html#document">Document</a></code>オブジェクト　およびすべてのそれら<code><a href="dom.html#document">Document</a></code>オブジェクトの<a data-anolis-xref="document family" href="#document-family">ドキュメントファミリー</a>の結合で構成される。<code><a href="dom.html#document">Document</a></code>オブジェクトの<a href="#document-family">ドキュメントファミリー</a>は、<code><a href="dom.html#document">Document</a></code>オブジェクトを<a data-anolis-xref="browsing context
  nested through" href="#browsing-context-nested-through">介してネストされる</a><a data-anolis-xref="browsing context" href="#browsing-context">ブラウジングコンテキスト</a>の所有するすべての<a data-anolis-xref="document family" href="#document-family">ドキュメントファミリー</a>の結合で構成される。</p>


  <h5 id="navigating-nested-browsing-contexts-in-the-dom"><span class="secno">5.1.1.1</span> DOM内でネストされたブラウジングコンテキストを操作する</h5>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-top"><a href="#dom-top">top</a></code></dt>

   <dd>

    <p><a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>の<code><a href="#windowproxy">WindowProxy</a></code>を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-parent"><a href="#dom-parent">parent</a></code></dt>

   <dd>

    <p><a href="#parent-browsing-context">親ブラウジングコンテキスト</a>に対する<code><a href="#windowproxy">WindowProxy</a></code>を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-frameElement"><a href="#dom-frameelement">frameElement</a></code></dt>

   <dd>

    <p><a href="#browsing-context-container">ブラウジングコンテキストコンテナ</a>の<code><a href="infrastructure.html#element">Element</a></code>を返す。</p>

    <p>存在しない場合nullを返す。</p>

    <p>クロスオリジンの状況で<code><a href="infrastructure.html#securityerror">SecurityError</a></code>例外を投げる。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-top" id="dom-top"><code>top</code></dfn> IDL attribute on the <code><a href="#window">Window</a></code> object
  of a <code><a href="dom.html#document">Document</a></code> in a <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> must return
  the <code><a href="#windowproxy">WindowProxy</a></code> object of its <a href="#top-level-browsing-context">top-level browsing context</a> (which would be
  its own <code><a href="#windowproxy">WindowProxy</a></code> object if it was a <a href="#top-level-browsing-context">top-level browsing context</a>
  itself), if it has one, or its own <code><a href="#windowproxy">WindowProxy</a></code> object otherwise (e.g. if it was a
  detached <a href="#nested-browsing-context">nested browsing context</a>).</p>

  <p>The <dfn data-anolis-xref="dom-parent" id="dom-parent"><code>parent</code></dfn> IDL attribute on the <code><a href="#window">Window</a></code>
  object of a <code><a href="dom.html#document">Document</a></code> in a <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> must
  return the <code><a href="#windowproxy">WindowProxy</a></code> object of the <a href="#parent-browsing-context">parent browsing context</a>, if there
  is one (i.e. if <var data-anolis-xref="">b</var> is a <a href="#child-browsing-context">child browsing context</a>), or the
  <code><a href="#windowproxy">WindowProxy</a></code> object of the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> itself,
  otherwise (i.e. if it is a <a href="#top-level-browsing-context">top-level browsing context</a> or a detached <a href="#nested-browsing-context">nested
  browsing context</a>).</p>

  <p>The <dfn data-anolis-xref="dom-frameElement" id="dom-frameelement"><code>frameElement</code></dfn> IDL attribute on the
  <code><a href="#window">Window</a></code> object of a <code><a href="dom.html#document">Document</a></code> <var data-anolis-xref="">d</var>, on getting, must run
  the following algorithm:</p>

  <ol><li><p>If <var data-anolis-xref="">d</var> is not a <code><a href="dom.html#document">Document</a></code> in a <a href="#nested-browsing-context">nested browsing
   context</a>, return null and abort these steps.</li>

<!--CLEANUP-->
   <li><p>If the <a href="#browsing-context-container">browsing context container</a>'s <code><a href="dom.html#document">Document</a></code> does not have the
   <a data-anolis-xref="same origin" href="#same-origin">same</a> <a href="#effective-script-origin">effective script origin</a> as the <a href="#effective-script-origin">effective script origin</a> specified by the <a href="webappapis.html#entry-settings-object">entry
   settings object</a>, then throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</li>

   <li><p>Return the <a href="#browsing-context-container">browsing context container</a> for <var data-anolis-xref="">b</var>.</li>

  </ol></div>



  <h4 id="auxiliary-browsing-contexts"><span class="secno">5.1.2</span> 補助ブラウジングコンテキスト</h4>

  <p>要素を通じてネストせずに<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>に関連する新しいブラウジングコンテキストを作成することが可能である。このようなブラウジングコンテキストは、<dfn data-anolis-xref="auxiliary browsing context" id="auxiliary-browsing-context">補助ブラウジングコンテキスト</dfn>と呼ばれる。補助ブラウジングコンテキストは常に<a data-anolis-xref="top-level browsing context" href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>である。</p>

  <p><a href="#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>は、<a href="#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>から作成された<a href="#browsing-context">ブラウジングコンテキスト</a>である、<dfn id="opener-browsing-context">オープナーブラウジングコンテキスト</dfn>を持つ。</p>


  <h5 id="navigating-auxiliary-browsing-contexts-in-the-dom"><span class="secno">5.1.2.1</span> DOM内の補助ブラウジングコンテキストを操作する</h5>

  <p>存在し、利用可能であり、かつ現在の<a href="#browsing-context">ブラウジングコンテキスト</a>が、<i><a href="#disowned-its-opener">そのオープナーを解消する</a></i>のでない場合、取得時に、<code><a href="#window">Window</a></code>オブジェクトの<dfn data-anolis-xref="dom-opener" id="dom-opener"><code>opener</code></dfn>IDL属性は、現在の<a href="#browsing-context">ブラウジングコンテキスト</a>が（その<a href="#opener-browsing-context">オープナーブラウジングコンテキスト</a>）を作成された<a href="#browsing-context">ブラウジングコンテキスト</a>の<code><a href="#windowproxy">WindowProxy</a></code>オブジェクトを返さなければならない。そうでなければ、nullを返さなければならない。設定時に、新しい値がnullの場合、現在の<a href="#browsing-context">ブラウジングコンテキスト</a>は<dfn data-anolis-xref="disowned its opener" id="disowned-its-opener">オープナーを解消し</dfn>なければならない。新しい値が何か他のものである場合、ユーザーエージェントは<code><a href="#window">Window</a></code>オブジェクトの[[DefineOwnProperty]]初期メソッドを呼ばなければならず、 プロパティキーとしてプロパティ名"<code data-anolis-xref="">opener</code>"を通過し、かつプロパティ記述子としてプロパティ記述子 { [[Value]]: <var data-anolis-xref="">value</var>, [[Writable]]: true, [[Enumerable]]: true, [[Configurable]]: true }とする。ここで<var data-anolis-xref="">value</var>は新しい値である。</p>

  <h4 id="secondary-browsing-contexts"><span class="secno">5.1.3</span> セカンダリブラウジングコンテキスト</h4>

  <p>ユーザーエージェントは、主要コンテンツ領域から離れて、ユーザーエージェントのインターフェースの一部を形成する<a data-anolis-xref="browsing context" href="#browsing-context">ブラウジングコンテキスト</a>である、<dfn data-anolis-xref="secondary browsing context" id="secondary-browsing-context">セカンダリブラウジングコンテキスト</dfn>をサポートしてもよい。</p><!-- This only exists for the purpose of defining
  rel=sidebar, which was dropped due to wg decision in
     http://www.w3.org/Bugs/Public/show_bug.cgi?id=11183
  and then moved to the wiki --><!--
  <p class="note">The <code data-x="rel-sidebar">sidebar</code> link type uses <span data-x="secondary
  browsing context">secondary browsing contexts</span>.</p>
--><!--ADD-TOPIC:Security-->




  <div class="impl">

  <h4 id="security-nav"><span class="secno">5.1.4 </span>Security</h4>

  <p id="security-1">A <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">A</var> is <dfn id="familiar-with">familiar
  with</dfn> a second <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">B</var> if one of the following
  conditions is true:</p>

  <ul><li>Either the <a href="#origin-0">origin</a> of the <a href="#active-document">active document</a> of <var data-anolis-xref="">A</var>
   is the <a data-anolis-xref="same origin" href="#same-origin">same</a> as the <a href="#origin-0">origin</a> of the <a href="#active-document">active
   document</a> of <var data-anolis-xref="">B</var>, or</li>

   <li>The browsing context <var data-anolis-xref="">A</var> is a <a href="#nested-browsing-context">nested browsing context</a> with a
   <a href="#top-level-browsing-context">top-level browsing context</a>, and its <a href="#top-level-browsing-context">top-level browsing context</a> is <var data-anolis-xref="">B</var>, or</li>

   <li>The browsing context <var data-anolis-xref="">B</var> is an <a href="#auxiliary-browsing-context">auxiliary browsing context</a> and
   <var data-anolis-xref="">A</var> is <a href="#familiar-with">familiar with</a> <var data-anolis-xref="">B</var>'s <a href="#opener-browsing-context">opener
   browsing context</a>, or</li>

   <li>The browsing context <var data-anolis-xref="">B</var> is not a <a href="#top-level-browsing-context">top-level browsing context</a>,
   but there exists an <a href="#ancestor-browsing-context">ancestor browsing context</a> of <var data-anolis-xref="">B</var> whose
   <a href="#active-document">active document</a> has the <a data-anolis-xref="same origin" href="#same-origin">same</a> <a href="#origin-0">origin</a> as
   the <a href="#active-document">active document</a> of <var data-anolis-xref="">A</var> (possibly in fact being <var data-anolis-xref="">A</var> itself).</li>

  </ul><hr><p>A <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">A</var> is <dfn id="allowed-to-navigate">allowed to navigate</dfn> a
  second <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">B</var> if the following algorithm terminates
  positively:</p>

  <ol><li><p>If <var data-anolis-xref="">A</var> is not the same <a href="#browsing-context">browsing context</a> as <var data-anolis-xref="">B</var>, and <var data-anolis-xref="">A</var> is not one of the <a data-anolis-xref="ancestor browsing
   context" href="#ancestor-browsing-context">ancestor browsing contexts</a> of <var data-anolis-xref="">B</var>, and <var data-anolis-xref="">B</var>
   is not a <a href="#top-level-browsing-context">top-level browsing context</a>, and <var data-anolis-xref="">A</var>'s <a href="#active-document">active
   document</a>'s <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> has its <a href="#sandboxed-navigation-browsing-context-flag">sandboxed navigation
   browsing context flag</a> set, then abort these steps negatively.</li>

   <li><p>Otherwise, if <var data-anolis-xref="">B</var> is a <a href="#top-level-browsing-context">top-level browsing context</a>, and is
   one of the <a data-anolis-xref="ancestor browsing context" href="#ancestor-browsing-context">ancestor browsing contexts</a> of <var data-anolis-xref="">A</var>, and <var data-anolis-xref="">A</var>'s <code><a href="dom.html#document">Document</a></code>'s <a href="#active-sandboxing-flag-set">active sandboxing
   flag set</a> has its <a href="#sandboxed-top-level-navigation-browsing-context-flag">sandboxed top-level navigation browsing context flag</a> set,
   then abort these steps negatively.</li>

<!--CLEANUP-->
   <li><p>Otherwise, if <var data-anolis-xref="">B</var> is a <a href="#top-level-browsing-context">top-level browsing context</a>, and is
   neither <var data-anolis-xref="">A</var> nor one of the <a data-anolis-xref="ancestor browsing context" href="#ancestor-browsing-context">ancestor browsing contexts</a> of <var data-anolis-xref="">A</var>, and <var data-anolis-xref="">A</var>'s <code><a href="dom.html#document">Document</a></code>'s <a href="#active-sandboxing-flag-set">active sandboxing
   flag set</a> has its <a href="#sandboxed-navigation-browsing-context-flag">sandboxed navigation browsing context flag</a> set, and <var data-anolis-xref="">A</var> is not the <a href="#one-permitted-sandboxed-navigator">one permitted sandboxed navigator</a> of <var data-anolis-xref="">B</var>, then abort these steps negatively.</li> <!-- we do not check the
   /sandboxed auxiliary navigation browsing context flag/ here, that's only for actually opening
   the new top-level browsing context. -->

   <li><p>Otherwise, terminate positively!</li>

  </ol><hr><p>An element has a <dfn id="browsing-context-scope-origin">browsing context scope origin</dfn> if its <code><a href="dom.html#document">Document</a></code>'s
  <a href="#browsing-context">browsing context</a> is a <a href="#top-level-browsing-context">top-level browsing context</a> or if all of its
  <code><a href="dom.html#document">Document</a></code>'s <a data-anolis-xref="ancestor browsing context" href="#ancestor-browsing-context">ancestor browsing contexts</a>
  all have <a data-anolis-xref="active document" href="#active-document">active documents</a> whose <a href="#origin-0">origin</a> are the
  <a href="#same-origin">same origin</a> as the element's <code><a href="dom.html#document">Document</a></code>'s <a href="#origin-0">origin</a>. If an
  element has a <a href="#browsing-context-scope-origin">browsing context scope origin</a>, then its value is the
  <a href="#origin-0">origin</a> of the element's <code><a href="dom.html#document">Document</a></code>.</p>

  </div><!--REMOVE-TOPIC:Security-->



  <div class="impl">

  <h4 id="groupings-of-browsing-contexts"><span class="secno">5.1.5 </span>Groupings of browsing contexts</h4>

  <p>Each <a href="#browsing-context">browsing context</a> is defined as having a list of one or more <dfn id="directly-reachable-browsing-contexts">directly
  reachable browsing contexts</dfn>. These are:</p>

  <ul><li>The <a href="#browsing-context">browsing context</a> itself.</li>

   <li>All the <a href="#browsing-context">browsing context</a>'s <a data-anolis-xref="child browsing context" href="#child-browsing-context">child browsing
   contexts</a>.</li>

   <li>The <a href="#browsing-context">browsing context</a>'s <a href="#parent-browsing-context">parent browsing context</a>.</li>

   <li>All the <a data-anolis-xref="browsing context" href="#browsing-context">browsing contexts</a> that have the <a href="#browsing-context">browsing
   context</a> as their <a href="#opener-browsing-context">opener browsing context</a>.</li>

   <li>The <a href="#browsing-context">browsing context</a>'s <a href="#opener-browsing-context">opener browsing context</a>.</li>

  </ul><p>The transitive closure of all the <a data-anolis-xref="browsing context" href="#browsing-context">browsing contexts</a> that
  are <a href="#directly-reachable-browsing-contexts">directly reachable browsing contexts</a> forms a <dfn id="unit-of-related-browsing-contexts">unit of related browsing
  contexts</dfn>.</p>

  <p>Each <a href="#unit-of-related-browsing-contexts">unit of related browsing contexts</a> is then further divided into the smallest
  number of groups such that every member of each group has an <a href="#active-document">active document</a> with an
  <a href="#effective-script-origin">effective script origin</a> that, through appropriate manipulation of the <code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code> attribute, could be made to be the same as
  other members of the group, but could not be made the same as members of any other group. Each
  such group is a <dfn id="unit-of-related-similar-origin-browsing-contexts">unit of related similar-origin browsing contexts</dfn>.</p>

  <p class="note">There is also at most one <a href="webappapis.html#event-loop">event loop</a> per <a href="#unit-of-related-similar-origin-browsing-contexts">unit of related
  similar-origin browsing contexts</a> (though several <a data-anolis-xref="unit of related
  similar-origin browsing contexts" href="#unit-of-related-similar-origin-browsing-contexts">units of related similar-origin browsing contexts</a> can
  have a shared <a href="webappapis.html#event-loop">event loop</a>).</p>

  </div>



  <h4 id="browsing-context-names"><span class="secno">5.1.6</span> ブラウジングコンテキスト名</h4>

  <p>ブラウジングコンテキストは、<dfn id="browsing-context-name">ブラウジングコンテキスト名</dfn>を持つことができる。デフォルトでは、ブラウジングコンテキストは名前を持たない（名前が設定されない）。</p>

  <p><dfn id="valid-browsing-context-name">妥当なブラウジングコンテキスト名</dfn>は、U+005F LOW LINE文字で始まらない少なくとも1文字をもつ任意の文字列である。（アンダースコアで始まる名前は、特別なキーワードのために予約されている。）</p>

  <p><dfn id="valid-browsing-context-name-or-keyword">妥当なブラウジングコンテキスト名またはキーワード</dfn>は、<a href="#valid-browsing-context-name">妥当なブラウジングコンテキスト名</a>または<a href="infrastructure.html#ascii-case-insensitive">ASCII大文字・小文字不区別</a>で<code data-anolis-xref="">_blank</code>、<code data-anolis-xref="">_self</code>、<code data-anolis-xref="">_parent</code>、または<code data-anolis-xref="">_top</code>の1つにマッチするいずれかとなる任意の文字列である。</p>

  <p>これらの値は、以下の（非規範的な）テーブルで要約されるように、ページがサンドボックス化されるかどうかに基づいて異なる意味を持つ。この表において、"current"はリンクまたはスクリプト内にある<a href="#browsing-context">ブラウジングコンテキスト</a>を意味し、"parent"はリンクまたはスクリプト内にあるいずれかの<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>を意味し、"master"はリンクまたはスクリプトのいずれかである最も近い<a href="#ancestor-browsing-context">祖先ブラウジングコンテキスト</a>を意味し、"top"はリンクまたはスクリプトがあるいずれかの<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を意味し、"new"はさまざまなユーザー設定とユーザーエージェントのポリシーに次第で、新しい<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>または<a href="#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>が作成されることを意味し、"none"は何も起こらないことを意味し、"maybe new"は"<code data-anolis-xref="attr-iframe-sandbox-allow-popups"><a href="#attr-iframe-sandbox-allow-popups">allow-popups</a></code>"キーワードはまた<code data-anolis-xref="attr-iframe-sandbox"><a href="embedded-content-0.html#attr-iframe-sandbox">sandbox</a></code>属性で指定される場合（またはユーザーがサンドボックスを覆う場合）、"new"と同じであり、そうでなければ"none"と同じである。</p>

  <table><thead><tr><th rowspan="2">キーワード
     </th><th rowspan="2">普通の効果
     </th><th colspan="2"><code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>での効果
    </th></tr><tr><!-- nothing --><th><code data-anolis-xref="">sandbox=""</code>
     </th><th><code data-anolis-xref="">sandbox="allow-top-navigation"</code>

   <tbody></th></tr><tr><td>リンクおよびフォーム送信に対して、何も指定しない <!-- same as empty string -->
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>空文字列
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td><code data-anolis-xref="">_blank</code>
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

    

    </td></tr><tr><td><code data-anolis-xref="">_self</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>親が存在しない場合の<code data-anolis-xref="">_parent</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>親がまたトップである場合の<code data-anolis-xref="">_parent</code>
     </td><td>parent/top
     
     </td><td>なし
     </td><td>parent/top

    

    </td></tr><tr><td>存在するがトップでない場合の<code data-anolis-xref="">_parent</code>
     </td><td>parent
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td>トップが現在である場合の<code data-anolis-xref="">_top</code>
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>トップが現在でない場合の<code data-anolis-xref="">_top</code>
     </td><td>top
     
     </td><td>なし
     </td><td>top

    

    </td></tr><tr><td>名前が存在しない
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

    

    </td></tr><tr><td>名前が存在しかつ子孫である
     </td><td>specified descendant
     
     </td><td>specified descendant
     
     </td><td>specified descendant

    

    </td></tr><tr><td>名前が存在し現在である
     </td><td>current
     
     </td><td>current
     
     </td><td>current

    

    </td></tr><tr><td>名前が存在しかつトップとなる祖先である
     </td><td>specified ancestor
     
     </td><td>なし
     </td><td>specified ancestor/top

    

    </td></tr><tr><td>名前が存在しかつトップでない祖先である
     </td><td>specified ancestor
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td>他の名前が共通のトップとともに存在する
     </td><td>specified
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td><a data-anolis-xref="familiar with" href="#familiar-with">familiar</a>かつ<a href="#one-permitted-sandboxed-navigator">ある許可されたサンドボックス化されたナビゲーター</a>である場合、異なるトップをもつ名前が存在する
     </td><td>specified
     
     </td><td>specified
     
     </td><td>specified

    

    </td></tr><tr><td><a data-anolis-xref="familiar with" href="#familiar-with">familiar</a>だが<a href="#one-permitted-sandboxed-navigator">ある許可されたサンドボックス化されたナビゲーター</a>でない場合、異なるトップをもつ名前が存在する
     </td><td>specified
     
     </td><td>なし
     </td><td>なし

    </td></tr><tr><td><a data-anolis-xref="familiar with" href="#familiar-with">familiar</a>でない、異なるトップをもつ名前が存在する
     </td><td>new
     
     </td><td>maybe new
     
     </td><td>maybe new

  

  </td></tr></table><p class="tablenote"><small>サンドボックス化されたブラウジングコンテキストの制限のほとんどは、他のアルゴリズムにより適用される。たとえば、下記で与えられる<a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">ブラウジングコンテキスト名で与えられたをブラウジングコンテキストを選択するための規則</a>でなく、<a data-anolis-xref="navigate" href="#navigate">ナビゲーション</a>アルゴリズムとして。</small></p>

  <div class="impl">

  <hr><p>An algorithm is <dfn id="allowed-to-show-a-popup">allowed to show a popup</dfn> if any of the following conditions is
  true:</p>

  <ul><li><p>The <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in which the algorithm is running is currently
   processing an <a href="dom.html#activation-behavior">activation behavior</a> whose <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event
   was <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>.</li>

   <li>

    <p>The <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in which the algorithm is running is currently
    running the event listener for a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> event whose
    type is in the following list:</p>

    <ul class="brief"><li><code data-anolis-xref="event-change">change</code></li>
     <li><code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code></li>
     <li><code data-anolis-xref="event-dblclick">dblclick</code></li>
     <li><code data-anolis-xref="event-mouseup">mouseup</code></li>
     <li><code data-anolis-xref="event-reset">reset</code></li>
     <li><code data-anolis-xref="event-submit">submit</code></li>
    </ul></li>

   <li>

    <p>The <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in which the algorithm is running was <a data-anolis-xref="queue a task" href="webappapis.html#queue-a-task">queued</a> by an algorithm that was <a href="#allowed-to-show-a-popup">allowed to show a popup</a>,
    and the chain of such algorithms started within a user-agent defined timeframe.</p>

    <p class="example">For example, if a user clicked a button, it might be acceptable for a popup
    to result from that after 4 seconds, but it would likely not be acceptable for a popup to result
    from that after 4 hours.</p>

   </li>

  </ul><hr><p><dfn id="the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">The rules for choosing a browsing context given a browsing context name</dfn> are as
  follows. The rules assume that they are being applied in the context of a <a href="#browsing-context">browsing
  context</a>, as part of the execution of a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a>.</p>

  <ol><li>

    <p>If the given browsing context name is the empty string or <code data-anolis-xref="">_self</code>, then
    the chosen browsing context must be the current one.</p>

    <p>If the given browsing context name is <code data-anolis-xref="">_self</code>, then this is an
    <span>explicit self-navigation override</span>.</p>

   </li>

   <li><p>If the given browsing context name is <code data-anolis-xref="">_parent</code>, then the chosen
   browsing context must be the <a href="#parent-browsing-context"><em>parent</em> browsing context</a> of the current one,
   unless there isn't one, in which case the chosen browsing context must be the current browsing
   context.</li>

   <li><p>If the given browsing context name is <code data-anolis-xref="">_top</code>, then the chosen browsing
   context must be the <a href="#top-level-browsing-context">top-level browsing context</a> of the current one, if there is one,
   or else the current browsing context.</li>

   <li>

    <p>If the given browsing context name is not <code data-anolis-xref="">_blank</code> and there exists a
    browsing context whose <a data-anolis-xref="browsing context name" href="#browsing-context-name">name</a> is the same as the given
    browsing context name, and the current browsing context is <a href="#familiar-with">familiar with</a> that
    browsing context, and the user agent determines that the two browsing contexts are related
    enough that it is ok if they reach each other, then that browsing context must be the chosen
    one. If there are multiple matching browsing contexts, the user agent should select one in some
    arbitrary consistent manner, such as the most recently opened, most recently focused, or more
    closely related.</p>

    <p>If the browsing context is chosen by this step to be the current browsing context, then this
    is also an <span>explicit self-navigation override</span>.</p>

   </li>

   <li>

    <p>Otherwise, a new browsing context is being requested, and what happens depends on the user
    agent's configuration and abilities — it is determined by the rules given for the first
    applicable option from the following list:</p>

    <dl class="switch"><dt id="popup-blocker">If the algorithm is not <a href="#allowed-to-show-a-popup">allowed to show a popup</a> and the
     user agent has been configured to not show popups (i.e. the user agent has a "popup blocker"
     enabled)</dt>

     <dd>

      <p>There is no chosen browsing context. The user agent may inform the user that a popup has
      been blocked.</p>

     </dd>

     <dt id="sandboxWindowOpen">If the current browsing context's <a href="#active-document">active document</a>'s
     <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> has the <a href="#sandboxed-auxiliary-navigation-browsing-context-flag">sandboxed auxiliary navigation browsing
     context flag</a> set.</dt>

     <dd>

      <p>Typically, there is no chosen browsing context.</p>

      <p>The user agent may offer to create a new <a href="#top-level-browsing-context">top-level browsing context</a> or reuse
      an existing <a href="#top-level-browsing-context">top-level browsing context</a>. If the user picks one of those options,
      then the designated browsing context must be the chosen one (the browsing context's name isn't
      set to the given browsing context name). The default behaviour (if the user agent doesn't
      offer the option to the user, or if the user declines to allow a browsing context to be used)
      must be that there must not be a chosen browsing context.</p>

      <p class="warning">If this case occurs, it means that an author has explicitly sandboxed the
      document that is trying to open a link.</p>

     </dd>


     <dt id="noopener">If the user agent has been configured such that in this instance it will
     create a new browsing context, and the browsing context is being requested as part of <a data-anolis-xref="following hyperlinks" href="links.html#following-hyperlinks">following a hyperlink</a> whose <a href="links.html#linkTypes">link
     types</a> include the <code data-anolis-xref="rel-noreferrer"><a href="links.html#link-type-noreferrer">noreferrer</a></code> keyword</dt>

     <dd><p>A new <a href="#top-level-browsing-context">top-level browsing context</a> must be created. If the given browsing
     context name is not <code data-anolis-xref="">_blank</code>, then the new top-level browsing context's
     name must be the given browsing context name (otherwise, it has no name). The chosen browsing
     context must be this new browsing context. The creation of such a <a href="#browsing-context">browsing context</a>
     is <dfn id="a-new-start-for-session-storage">a new start for session storage</dfn>.</p>

     <p class="note">If it is immediately <a data-anolis-xref="navigate" href="#navigate">navigated</a>, then the
     navigation will be done with <a href="#replacement-enabled">replacement enabled</a>.</dd>


     <dt>If the user agent has been configured such that in this instance it will create a new
     browsing context, and the <code data-anolis-xref="rel-noreferrer"><a href="links.html#link-type-noreferrer">noreferrer</a></code> keyword doesn't
     apply</dt>

     <dd><p>A new <a href="#auxiliary-browsing-context">auxiliary browsing context</a> must be created, with the <a href="#opener-browsing-context">opener
     browsing context</a> being the current one. If the given browsing context name is not <code data-anolis-xref="">_blank</code>, then the new auxiliary browsing context's name must be the given
     browsing context name (otherwise, it has no name). The chosen browsing context must be this new
     browsing context.</p>

     <p class="note">If it is immediately <a data-anolis-xref="navigate" href="#navigate">navigated</a>, then the
     navigation will be done with <a href="#replacement-enabled">replacement enabled</a>.</dd>


     <dt>If the user agent has been configured such that in this instance it will reuse the current
     browsing context</dt>

     <dd><p>The chosen browsing context is the current browsing context.</dd>


     <dt>If the user agent has been configured such that in this instance it will not find a
     browsing context</dt>

     <dd><p>There must not be a chosen browsing context.</dd>

    </dl><p>User agent implementors are encouraged to provide a way for users to configure the user agent
    to always reuse the current browsing context.</p>

    <p>If the current browsing context's <a href="#active-document">active document</a>'s <a href="#active-sandboxing-flag-set">active sandboxing flag
    set</a> has the <a href="#sandboxed-navigation-browsing-context-flag">sandboxed navigation browsing context flag</a> set and the chosen
    browsing context picked above, if any, is a new browsing context (whether top-level or
    auxiliary), then all the flags that are set in the current browsing context's <a href="#active-document">active
    document</a>'s <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> when the new browsing context is
    created must be set in the new browsing context's <a href="#popup-sandboxing-flag-set">popup sandboxing flag set</a>, and
    the current browsing context must be set as the new browsing context's <a href="#one-permitted-sandboxed-navigator">one permitted
    sandboxed navigator</a>.</p>

   </li>

  </ol></div><!--TOPIC:DOM APIs-->



  <h3 id="the-window-object"><span class="secno">5.2</span> <code><a href="#window">Window</a></code>オブジェクト</h3>

  <pre class="idl">[Global]
/*sealed*/ interface <dfn id="window">Window</dfn> : <a href="infrastructure.html#eventtarget">EventTarget</a> {
  // the current browsing context
  [Unforgeable] readonly attribute <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-window" href="#dom-window">window</a>;
  [Replaceable] readonly attribute <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-self" href="#dom-self">self</a>;
  [Unforgeable] readonly attribute <a href="dom.html#document">Document</a> <a data-anolis-xref="dom-document" href="#dom-document-0">document</a>;
           attribute DOMString <a data-anolis-xref="dom-name" href="#dom-name">name</a>; <!-- not [Replaceable] per WebKit and IE8 -->
  [PutForwards=<a data-anolis-xref="dom-url-href" href="infrastructure.html#dom-url-href">href</a>, Unforgeable] readonly attribute <a href="#location">Location</a> <a data-anolis-xref="dom-location" href="#dom-location">location</a>;
  readonly attribute <a href="#history-1">History</a> <a data-anolis-xref="dom-history" href="#dom-history">history</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-locationbar" href="#dom-window-locationbar">locationbar</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-menubar" href="#dom-window-menubar">menubar</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-personalbar" href="#dom-window-personalbar">personalbar</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-scrollbars" href="#dom-window-scrollbars">scrollbars</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-statusbar" href="#dom-window-statusbar">statusbar</a>;
  [Replaceable] readonly attribute <a href="#barprop">BarProp</a> <a data-anolis-xref="dom-window-toolbar" href="#dom-window-toolbar">toolbar</a>;<!--
  [Replaceable] readonly attribute <span>BarProp</span> <span data-x="dom-window-directories">directories</span>; // legacy (Gecko-only) -->
           attribute DOMString <a data-anolis-xref="dom-window-status" href="#dom-window-status">status</a>;
  void <a data-anolis-xref="dom-window-close" href="#dom-window-close">close</a>();
  readonly attribute boolean <a data-anolis-xref="dom-window-closed" href="#dom-window-closed">closed</a>;
  void <a data-anolis-xref="dom-window-stop" href="#dom-window-stop">stop</a>();
  void <a data-anolis-xref="dom-window-focus" href="editing.html#dom-window-focus">focus</a>();
  void <a data-anolis-xref="dom-window-blur" href="editing.html#dom-window-blur">blur</a>();

  // other browsing contexts
  [Replaceable] readonly attribute <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-frames" href="#dom-frames">frames</a>;
  [Replaceable] readonly attribute unsigned long <a data-anolis-xref="dom-length" href="#dom-length">length</a>;
  [Unforgeable] readonly attribute <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-top" href="#dom-top">top</a>;
           attribute <a href="#windowproxy">WindowProxy</a>? <a data-anolis-xref="dom-opener" href="#dom-opener">opener</a>;
  readonly attribute <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-parent" href="#dom-parent">parent</a>;
  readonly attribute <a href="infrastructure.html#element">Element</a>? <a data-anolis-xref="dom-frameElement" href="#dom-frameelement">frameElement</a>;
  <a href="#windowproxy">WindowProxy</a> <a data-anolis-xref="dom-open" href="#dom-open">open</a>(optional DOMString url = "about:blank", optional DOMString target = "_blank", optional DOMString features = "", optional boolean replace = false);
  <a data-anolis-xref="dom-window-item" href="#dom-window-item">getter</a> <a href="#windowproxy">WindowProxy</a> (unsigned long index);
  <a data-anolis-xref="dom-window-namedItem" href="#dom-window-nameditem">getter</a> object (DOMString name);

  // the user agent
  readonly attribute <a href="webappapis.html#navigator">Navigator</a> <a data-anolis-xref="dom-navigator" href="webappapis.html#dom-navigator">navigator</a>; <!-- IE also has window.clientInformation === window.navigator -->
  readonly attribute <a href="webappapis.html#external">External</a> <a data-anolis-xref="dom-external" href="webappapis.html#dom-external">external</a>;
  readonly attribute <a href="#applicationcache">ApplicationCache</a> <a data-anolis-xref="dom-applicationCache" href="#dom-applicationcache">applicationCache</a>;

  // user prompts
  void <a data-anolis-xref="dom-alert" href="webappapis.html#dom-alert">alert</a>(optional DOMString message = "");
  boolean <a data-anolis-xref="dom-confirm" href="webappapis.html#dom-confirm">confirm</a>(optional DOMString message = "");
  DOMString? <a data-anolis-xref="dom-prompt" href="webappapis.html#dom-prompt">prompt</a>(optional DOMString message = "", optional DOMString default = "");
  void <a data-anolis-xref="dom-print" href="webappapis.html#dom-print">print</a>();

<!--POSTMSG-->
};
<a href="#window">Window</a> implements <a href="webappapis.html#globaleventhandlers">GlobalEventHandlers</a>;
<a href="#window">Window</a> implements <a href="webappapis.html#windoweventhandlers">WindowEventHandlers</a>;</pre><!-- for more features to add here, look here:
 http://msdn.microsoft.com/workshop/author/dhtml/reference/objects/obj_window.asp
 http://www.mozilla.org/docs/dom/domref/dom_window_ref.html
 http://lxr.mozilla.org/mozilla/source/dom/public/idl/base/nsIDOMWindow.idl - scrollBy, etc
 http://lxr.mozilla.org/mozilla/source/dom/public/idl/base/nsIDOMWindowInternal.idl - DOM level 0
-->



  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window"><a href="#dom-window">window</a></code></dt>
   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-frames"><a href="#dom-frames">frames</a></code></dt>
   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-self"><a href="#dom-self">self</a></code></dt>

   <dd>

    <p>これらの属性すべては<var data-anolis-xref="">window</var>を返す。</p>

   </dd>


   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-document"><a href="#dom-document-0">document</a></code></dt>

   <dd>

    <p><var data-anolis-xref="">window</var>と関連する<code><a href="dom.html#document">Document</a></code>を返す。</p>

   </dd>


   <dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-defaultView"><a href="#dom-document-defaultview">defaultView</a></code></dt>

   <dd>

    <p><a href="#active-document">アクティブドキュメント</a>の<code><a href="#window">Window</a></code>オブジェクトを返す。</p>

   </dd>

  </dl><div class="impl">

  <p>The <code><a href="#window">Window</a></code> interface must only be <span>exposed to JavaScript</span> if the
  <a href="infrastructure.html#javascript-global-environment">JavaScript global environment</a> is a <a href="webappapis.html#document-environment">document environment</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window" id="dom-window"><code>window</code></dfn>, <dfn data-anolis-xref="dom-frames" id="dom-frames"><code>frames</code></dfn>, and <dfn data-anolis-xref="dom-self" id="dom-self"><code>self</code></dfn>
  IDL attributes must all return the <code><a href="#window">Window</a></code> object's <a href="#browsing-context">browsing context</a>'s
  <code><a href="#windowproxy">WindowProxy</a></code> object.</p>

  <p>The <dfn data-anolis-xref="dom-document" id="dom-document-0"><code>document</code></dfn> IDL attribute must return
  <a data-anolis-xref="concept-document-window" href="#concept-document-window">the <code>Window</code> object's newest <code>Document</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-document-defaultView" id="dom-document-defaultview"><code>defaultView</code></dfn> IDL attribute of the
  <code><a href="dom.html#document">Document</a></code> interface must return the <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing
  context</a>'s <code><a href="#windowproxy">WindowProxy</a></code> object, if there is one, or null otherwise.</p>

  <hr><p>For historical reasons, <code><a href="#window">Window</a></code> objects must also have a writable, configurable,
  non-enumerable property named <dfn id="htmldocument"><code>HTMLDocument</code></dfn> whose value is the
  <code><a href="dom.html#document">Document</a></code> interface object.</p>

  </div><!--ADD-TOPIC:Security-->



  <div class="impl">

  <h4 id="security-window"><span class="secno">5.2.1 </span>Security</h4>

  <p class="critical">This section describes a security model that is underdefined, imperfect, and
  does not match implementations. Work is ongoing to attempt to resolve this, but in the meantime,
  please do not rely on this section for precision. Implementors are urged to send their feedback on
  how cross-origin cross-global access to <code><a href="#window">Window</a></code> and <code><a href="#location">Location</a></code> objects
  should work. See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20701">bug 20701</a>.</p>

<!--CLEANUP-->
  <p id="security-2">User agents must throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception whenever any
  properties of a <code><a href="#window">Window</a></code> object are accessed when the <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a> specifies
  an <a href="#effective-script-origin">effective script origin</a> that is not the <a data-anolis-xref="same origin" href="#same-origin">same</a> as
  <a data-anolis-xref="concept-document-window" href="#concept-document-window">the <code>Window</code> object's
  <code>Document</code></a>'s <a href="#effective-script-origin">effective script origin</a>, with the following
  exceptions:</p>

  <ul><li>The <code data-anolis-xref="dom-location"><a href="#dom-location">location</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-window-postMessage">postMessage()</code> method

   </li><li>The <code data-anolis-xref="dom-window"><a href="#dom-window">window</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-frames"><a href="#dom-frames">frames</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-self"><a href="#dom-self">self</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-top"><a href="#dom-top">top</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-parent"><a href="#dom-parent">parent</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-opener"><a href="#dom-opener">opener</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-window-closed"><a href="#dom-window-closed">closed</a></code> attribute

   </li><li>The <code data-anolis-xref="dom-window-close"><a href="#dom-window-close">close()</a></code> method

   </li><li>The <code data-anolis-xref="dom-window-blur"><a href="editing.html#dom-window-blur">blur()</a></code> method

   </li><li>The <code data-anolis-xref="dom-window-focus"><a href="editing.html#dom-window-focus">focus()</a></code> method

   </li><li>The <a href="#dynamic-nested-browsing-context-properties">dynamic nested browsing context properties</a>

  </li></ul><!--CLEANUP--><p>When the <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a> specifies an <a href="#effective-script-origin">effective script origin</a> that is different than
  a <a data-anolis-xref="concept-document-window" href="#concept-document-window"><code>Window</code> object's
  <code>Document</code></a>'s <a href="#effective-script-origin">effective script origin</a>, the user agent must act as if
  any changes to that <code><a href="#window">Window</a></code> object's properties, getters, setters, etc, were not
  present, and as if all the properties of that <code><a href="#window">Window</a></code> object had their [[Enumerable]]
  attribute set to false.</p>

<!--CLEANUP-->
  <p>For members that return objects (including function objects), each distinct <a href="#effective-script-origin">effective
  script origin</a> that is not the same as the <code><a href="#window">Window</a></code> object's
  <code><a href="dom.html#document">Document</a></code>'s <a href="#effective-script-origin">effective script origin</a> must be provided with a separate set
  of objects. These objects must have the prototype chain appropriate for the script for which the
  objects are created (not those that would be appropriate for scripts whose <a href="webappapis.html#global-object">global
  object</a>, as specified by their <a href="webappapis.html#settings-object">settings object</a>,
  is the <code><a href="#window">Window</a></code> object in question).</p>

  <div class="example">

   <p>For instance, if two frames containing <code><a href="dom.html#document">Document</a></code>s from different <a data-anolis-xref="origin" href="#origin-0">origins</a> access the same <code><a href="#window">Window</a></code> object's <code data-anolis-xref="dom-window-postMessage">postMessage()</code> method, they will get distinct objects that
   are not equal.</p>

  </div>

  </div><!--REMOVE-TOPIC:Security-->




  <h4 id="apis-for-creating-and-navigating-browsing-contexts-by-name"><span class="secno">5.2.2</span> 名前でブラウジングコンテキストを作成および操作するためのAPI</h4>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> = <var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-open"><a href="#dom-open">open</a></code>( [ <var data-anolis-xref="">url</var> [, <var data-anolis-xref="">target</var> [, <var data-anolis-xref="">features</var> [, <var data-anolis-xref="">replace</var> ] ] ] ] )</dt>

   <dd>

    <p><var data-anolis-xref="">url</var>（デフォルトで<code><a href="infrastructure.html#about:blank">about:blank</a></code>）を表示するためのウィンドウを開き、それを返す。<var data-anolis-xref="">target</var>引数は、新しいウィンドウの名前を与える。すでにその名前をもつウィンドウが存在する場合、それが再利用される。<var data-anolis-xref="">replace</var>属性がtrueの場合、どのページでも、ウィンドウがウィンドウのセッション履歴から削除される現在開いていることを意味する。<var data-anolis-xref="">features</var>引数は無視される。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-name"><a href="#dom-name">name</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>ウィンドウの名前を返す。</p>

    <p>名前を変更する設定が可能である。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-close"><a href="#dom-window-close">close</a></code>()</dt>

   <dd>

    <p>ウィンドウを閉じる。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-closed"><a href="#dom-window-closed">closed</a></code></dt>

   <dd>

    <p>ウィンドウが閉じられている場合はtrueを返し、そうでなければfalseを返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-stop"><a href="#dom-window-stop">stop</a></code>()</dt>

   <dd>

    <p>ドキュメントの読み込みを中止する。</p>

   </dd>

  </dl><div class="impl">

  <!-- This whole section should be rewritten to use algorithmic style -->

  <p>The <dfn data-anolis-xref="dom-open" id="dom-open"><code>open()</code></dfn> method on <code><a href="#window">Window</a></code> objects
  provides a mechanism for <a data-anolis-xref="navigate" href="#navigate">navigating</a> an existing <a href="#browsing-context">browsing
  context</a> or opening and navigating an <a href="#auxiliary-browsing-context">auxiliary browsing context</a>.</p>

  <p>The method has four arguments, though they are all optional.</p>

<!--CLEANUP-->
  <p>The first argument, <var data-anolis-xref="">url</var>, must be a <a href="infrastructure.html#valid-non-empty-url">valid non-empty URL</a> for a
  page to load in the browsing context. If the first argument is the empty string, then the <var data-anolis-xref="">url</var> argument must be interpreted as "<code><a href="infrastructure.html#about:blank">about:blank</a></code>". Otherwise, the
  argument must be <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolved</a> to an <a href="infrastructure.html#absolute-url">absolute URL</a> (or
  an error), relative to the <a href="webappapis.html#api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings 
  object</a> when the method was invoked.</p>

  <p>The second argument, <var data-anolis-xref="">target</var>, specifies the <a data-anolis-xref="browsing context
  name" href="#browsing-context-name">name</a> of the browsing context that is to be navigated. It must be a <a href="#valid-browsing-context-name-or-keyword">valid
  browsing context name or keyword</a>.</p>

  <p>The third argument, <var data-anolis-xref="">features</var>, has no defined effect and is mentioned for
  historical reasons only. User agents may interpret this argument as instructions to set the size
  and position of the browsing context, but are encouraged to instead ignore the argument
  entirely.</p>

  <p>The fourth argument, <var data-anolis-xref="">replace</var>, specifies whether or not the new page will
  <a data-anolis-xref="replacement enabled" href="#replacement-enabled">replace</a> the page currently loaded in the browsing
  context, when <var data-anolis-xref="">target</var> identifies an existing browsing context (as opposed to
  leaving the current page in the browsing context's <a href="#session-history">session history</a>).</p>

  <p>When the method is invoked, the user agent must first select a <a href="#browsing-context">browsing context</a> to
  navigate by applying <a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for choosing a browsing context given a browsing context
  name</a> using the <var data-anolis-xref="">target</var> argument as the name and the <a href="#browsing-context">browsing
  context</a> of the script as the context in which the algorithm is executed, unless the user
  has indicated a preference, in which case the browsing context to navigate may instead be the one
  indicated by the user.</p>

  <p class="example">For example, suppose there is a user agent that supports control-clicking a
  link to open it in a new tab. If a user clicks in that user agent on an element whose <code data-anolis-xref="handler-onclick"><a href="webappapis.html#handler-onclick">onclick</a></code> handler uses the <code data-anolis-xref="dom-open"><a href="#dom-open">window.open()</a></code> API to open a page in an iframe, but, while doing so, holds
  the control key down, the user agent could override the selection of the target browsing context
  to instead target a new tab.</p>

  <p>If applying <a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for choosing a browsing context given a browsing context
  name</a> using the <var data-anolis-xref="">target</var> argument would result in there not being a chosen
  browsing context, then throw an <code><a href="infrastructure.html#invalidaccesserror">InvalidAccessError</a></code> exception and abort these
  steps.</p>

<!--CLEANUP-->
  <p>Otherwise, if <var data-anolis-xref="">url</var> is not "<code><a href="infrastructure.html#about:blank">about:blank</a></code>", the user agent must
  <a href="#navigate">navigate</a><!--DONAV window.open()--> the selected <a href="#browsing-context">browsing context</a> to the
  <a href="infrastructure.html#absolute-url">absolute URL</a> obtained from <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolving</a> <var data-anolis-xref="">url</var> earlier, with <a href="#exceptions-enabled">exceptions enabled</a>. If the <var data-anolis-xref="">replace</var> is true or if the <a href="#browsing-context">browsing
  context</a> was just created as part of <a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for choosing a browsing context given a
  browsing context name</a>, then <a data-anolis-xref="replacement enabled" href="#replacement-enabled">replacement must be
  enabled</a> also. The navigation must be done with the <a href="webappapis.html#responsible-browsing-context">responsible
  browsing context</a> specified by the <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a> as the <a href="#source-browsing-context">source browsing
  context</a>. If the <a href="infrastructure.html#resolve-a-url">resolve a URL</a> algorithm failed, then the user agent may either
  instead <a href="#navigate">navigate</a> to an inline error page, with <a href="#exceptions-enabled">exceptions enabled</a> and using the same replacement behavior and
  source browsing context behavior as described earlier in this paragraph; or treat the <var data-anolis-xref="">url</var> as "<code><a href="infrastructure.html#about:blank">about:blank</a></code>", acting as described in the next paragraph.</p>

  <p>If <var data-anolis-xref="">url</var> <em>is</em> "<code><a href="infrastructure.html#about:blank">about:blank</a></code>", and the <a href="#browsing-context">browsing
  context</a> was just created as part of <a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">the rules for choosing a browsing context given a
  browsing context name</a>, then the user agent must instead <a href="webappapis.html#queue-a-task">queue a task</a> to
  <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <code data-anolis-xref="event-load">load</code> at the selected
  <a href="#browsing-context">browsing context</a>'s <code><a href="#window">Window</a></code> object, but with its <code data-anolis-xref="dom-event-target"><a href="infrastructure.html#dom-event-target">target</a></code> set to the selected <a href="#browsing-context">browsing context</a>'s <a data-anolis-xref="concept-document-window" href="#concept-document-window"><code>Window</code> object's <code>Document</code></a> object
  (and the <code data-anolis-xref="dom-event-currentTarget">currentTarget</code> set to the <code><a href="#window">Window</a></code>
  object).</p>

  <p>The method must return the <code><a href="#windowproxy">WindowProxy</a></code> object of the <a href="#browsing-context">browsing context</a>
  that was navigated, or null if no browsing context was navigated.</p>

  <hr><p>The <dfn data-anolis-xref="dom-name" id="dom-name"><code>name</code></dfn> attribute of the <code><a href="#window">Window</a></code> object
  must, on getting, return the current <a data-anolis-xref="browsing context name" href="#browsing-context-name">name</a> of the
  <a href="#browsing-context">browsing context</a>, and, on setting, set the <a data-anolis-xref="browsing context
  name" href="#browsing-context-name">name</a> of the <a href="#browsing-context">browsing context</a> to the new value.</p>

  <p class="note">The name <a href="#resetBCName">gets reset</a> when the browsing context is
  navigated to another domain.</p>

  <hr><p>The <dfn data-anolis-xref="dom-window-close" id="dom-window-close"><code>close()</code></dfn> method on <code><a href="#window">Window</a></code>
  objects should, if all the following conditions are met, <a data-anolis-xref="close a browsing
  context" href="#close-a-browsing-context">close</a> the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">A</var>:

  <ul class="brief"><li>The corresponding <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">A</var> is
   <a href="#script-closable">script-closable</a>.</li>

<!--CLEANUP-->
   <li>The <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a> specified by the <a href="webappapis.html#incumbent-settings-object">incumbent
   settings object</a> is <a href="#familiar-with">familiar
   with</a> the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">A</var>.</li>

<!--CLEANUP-->
   <li id="sandboxClose">The <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a> specified by the
   <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a>
   is <a href="#allowed-to-navigate">allowed to navigate</a> the <a href="#browsing-context">browsing
   context</a> <var data-anolis-xref="">A</var>.</li>

  </ul><p>A <a href="#browsing-context">browsing context</a> is <dfn id="script-closable">script-closable</dfn> if it is an <a href="#auxiliary-browsing-context">auxiliary
  browsing context</a> that was created by a script (as opposed to by an action of the user), or
  if it is a <a href="#browsing-context">browsing context</a> whose <a href="#session-history">session history</a> contains only one
  <code><a href="dom.html#document">Document</a></code>.</p>

  <p>The <dfn data-anolis-xref="dom-window-closed" id="dom-window-closed"><code>closed</code></dfn> attribute on <code><a href="#window">Window</a></code>
  objects must return true if the <code><a href="#window">Window</a></code> object's <a href="#browsing-context">browsing context</a> has
  been <a data-anolis-xref="a browsing context is discarded" href="#a-browsing-context-is-discarded">discarded</a>, and false otherwise.</p>

  <p>The <dfn data-anolis-xref="dom-window-stop" id="dom-window-stop"><code>stop()</code></dfn> method on <code><a href="#window">Window</a></code>
  objects should, if there is an existing attempt to <a href="#navigate">navigate</a> the <a href="#browsing-context">browsing
  context</a> and that attempt is not currently running the <a href="#unload-a-document">unload a document</a>
  algorithm, cancel that <a data-anolis-xref="navigate" href="#navigate">navigation</a>; then, it must <a data-anolis-xref="abort
  a document" href="#abort-a-document">abort</a> the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a> of
  the <code><a href="#window">Window</a></code> object on which it was invoked.</p>

  </div>


  <h4 id="accessing-other-browsing-contexts"><span class="secno">5.2.3</span> 他のブラウジングコンテキストへのアクセス</h4>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-length"><a href="#dom-length">length</a></code></dt>

   <dd>

    <p><a data-anolis-xref="child browsing context" href="#child-browsing-context">子ブラウジングコンテキスト</a>の数を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var>[<var data-anolis-xref="">index</var>]</dt>

   <dd>

    <p>指示された<a href="#child-browsing-context">子ブラウジングコンテキスト</a>を返す。</p>

   </dd>

  </dl><div class="impl">

<!--CLEANUP-->
  <p>The <dfn data-anolis-xref="dom-length" id="dom-length"><code>length</code></dfn> IDL attribute on the <code><a href="#window">Window</a></code>
  interface must return the number of <a data-anolis-xref="child browsing context" href="#child-browsing-context">child browsing
  contexts</a> that are <a data-anolis-xref="browsing context nested through" href="#browsing-context-nested-through">nested through</a>
  elements that are <a data-anolis-xref="in a document" href="infrastructure.html#in-a-document">in the <code>Document</code></a> that is the
  <a href="#active-document">active document</a> of that <code><a href="#window">Window</a></code> object, if that <code><a href="#window">Window</a></code>'s
  <a href="#browsing-context">browsing context</a> shares the same <a href="webappapis.html#event-loop">event loop</a> as the <a href="webappapis.html#responsible-document">responsible
  document</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings object</a> accessing the IDL attribute; otherwise,
  it must return zero.</p>

  <!-- in other words, frames are only accessible to same-thread processes -->

  <p>The <a href="infrastructure.html#supported-property-indices">supported property indices</a> on the <code><a href="#window">Window</a></code> object at any instant
  are the numbers in the range 0 .. <span data-anolis-xref=""><var data-anolis-xref="">n</var>-1</span>, where <var data-anolis-xref="">n</var> is the number returned by the <code data-anolis-xref="dom-length"><a href="#dom-length">length</a></code> IDL
  attribute. If <var data-anolis-xref="">n</var> is zero then there are no <a href="infrastructure.html#supported-property-indices">supported property
  indices</a>.</p>

  <p>To <dfn data-anolis-xref="dom-window-item" id="dom-window-item">determine the value of an indexed property</dfn> <var data-anolis-xref="">index</var> of a <code><a href="#window">Window</a></code> object, the user agent must return the
  <code><a href="#windowproxy">WindowProxy</a></code> object of the <var data-anolis-xref="">index</var>th <a href="#child-browsing-context">child browsing
  context</a> of the <code><a href="dom.html#document">Document</a></code> that is nested through an element that is <a data-anolis-xref="in a document" href="infrastructure.html#in-a-document">in the <code>Document</code></a>, sorted in the <a href="infrastructure.html#tree-order">tree order</a>
  of the elements nesting those <a data-anolis-xref="browsing context" href="#browsing-context">browsing contexts</a>.</p>

  <p>These properties are the <dfn id="dynamic-nested-browsing-context-properties">dynamic nested browsing context properties</dfn>.</p>

  </div>



  <h4 id="named-access-on-the-window-object"><span class="secno">5.2.4</span> <code><a href="#window">Window</a></code>オブジェクトの名前付きアクセス</h4>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var>[<var data-anolis-xref="">name</var>]</dt>

   <dd>

    <p>指示された要素または要素のコレクションを返す。</p>

   </dd>

  </dl><div class="impl">

  <p>The <code><a href="#window">Window</a></code> interface <a data-anolis-xref="support named properties" href="infrastructure.html#support-named-properties">supports named
  properties</a>. The <a href="infrastructure.html#supported-property-names">supported property names</a> at any moment consist of the
  following, in <a href="infrastructure.html#tree-order">tree order</a>, ignoring later duplicates:</p>

  <ul><li>the <a href="#browsing-context-name">browsing context name</a> of any <a href="#child-browsing-context">child browsing context</a> of the
   <a href="#active-document">active document</a> whose name is not the empty string,</li>

   <li>the value of the <code data-anolis-xref="">name</code> content attribute for all <code><a href="text-level-semantics.html#the-a-element">a</a></code>,
   <code><a href="obsolete.html#the-applet-element">applet</a></code>, <code><a href="embedded-content-0.html#the-area-element">area</a></code>, <code><a href="embedded-content-0.html#the-embed-element">embed</a></code>, <code><a href="forms.html#the-form-element">form</a></code>,
   <code><a href="obsolete.html#frameset">frameset</a></code>, <code><a href="embedded-content-0.html#the-img-element">img</a></code>, and <code><a href="embedded-content-0.html#the-object-element">object</a></code> elements in the <a href="#active-document">active
   document</a> that have a non-empty <code data-anolis-xref="">name</code> content attribute, and</li>

   <li>the value of the <code data-anolis-xref="attr-id"><a href="dom.html#the-id-attribute">id</a></code> content attribute of any <a data-anolis-xref="HTML
   elements" href="infrastructure.html#html-elements">HTML element</a> in the <a href="#active-document">active document</a> with a non-empty <code data-anolis-xref="attr-id"><a href="dom.html#the-id-attribute">id</a></code> content attribute.</li>

  </ul><p>To <a href="infrastructure.html#determine-the-value-of-a-named-property">determine the value of a named property</a> <var data-anolis-xref="">name</var> when <dfn data-anolis-xref="dom-window-namedItem" id="dom-window-nameditem">the <code>Window</code> object is indexed for property
  retrieval</dfn>, the user agent must return the value obtained using the following steps:</p>

  <ol><!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/1716 --><li>

    <p>Let <var data-anolis-xref="">objects</var> be the list of <a data-anolis-xref="dom-window-namedItem-filter" href="#dom-window-nameditem-filter">named objects</a> with the name <var data-anolis-xref="">name</var>
    in the <a href="#active-document">active document</a>.

    <p class="note">There will be at least one such object, by definition.<!-- (If there wasn't,
    then this algorithm wouldn't have been invoked by Web IDL.) --></p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">objects</var> contains a <a href="#nested-browsing-context">nested browsing context</a>, then return
    the <code><a href="#windowproxy">WindowProxy</a></code> object of the <a href="#nested-browsing-context">nested browsing context</a> corresponding to
    the first <a href="#browsing-context-container">browsing context container</a> in <a href="infrastructure.html#tree-order">tree order</a> whose
    <a href="#browsing-context">browsing context</a> is in <var data-anolis-xref="">objects</var>, and abort these steps.</p>

   </li>

   <li>

    <p>Otherwise, if <var data-anolis-xref="">objects</var> has only one element, return that element and
    abort these steps.</p>

   </li>

   <li>

    <p>Otherwise return an <code><a href="infrastructure.html#htmlcollection">HTMLCollection</a></code> rooted at the <code><a href="dom.html#document">Document</a></code> node,
    whose filter matches only <a data-anolis-xref="dom-window-namedItem-filter" href="#dom-window-nameditem-filter">named objects</a> with
    the name <var data-anolis-xref="">name</var>. (By definition, these will all be elements.)</p> <!-- the
    same one each time is returned, because of the rule under collections -->

   </li>

  </ol><p><dfn data-anolis-xref="dom-window-nameditem-filter" id="dom-window-nameditem-filter">Named objects</dfn> with the name <var data-anolis-xref="">name</var>, for the purposes of the above algorithm, are those that are either:</p>

  <ul><li><a data-anolis-xref="child browsing context" href="#child-browsing-context">child browsing contexts</a> of the <a href="#active-document">active
   document</a> whose name is <var data-anolis-xref="">name</var>,</li>

   <li><code><a href="text-level-semantics.html#the-a-element">a</a></code>, <code><a href="obsolete.html#the-applet-element">applet</a></code>, <code><a href="embedded-content-0.html#the-area-element">area</a></code>, <code><a href="embedded-content-0.html#the-embed-element">embed</a></code>,
   <code><a href="forms.html#the-form-element">form</a></code>, <code><a href="obsolete.html#frameset">frameset</a></code>, <code><a href="embedded-content-0.html#the-img-element">img</a></code>, or <code><a href="embedded-content-0.html#the-object-element">object</a></code> elements that
   have a <code data-anolis-xref="attr-name">name</code> content attribute whose value is <var data-anolis-xref="">name</var>, or</li>

   <li><a href="infrastructure.html#html-elements">HTML elements</a> that have an <code data-anolis-xref="attr-id"><a href="dom.html#the-id-attribute">id</a></code> content attribute
   whose value is <var data-anolis-xref="">name</var>.</li>

  </ul></div>


  <div class="impl">

  <h4 id="garbage-collection-and-browsing-contexts"><span class="secno">5.2.5 </span>Garbage collection and browsing contexts</h4>

  <p>A <a href="#browsing-context">browsing context</a> has a strong reference to each of its <code><a href="dom.html#document">Document</a></code>s
  and its <code><a href="#windowproxy">WindowProxy</a></code> object, and the user agent itself has a strong reference to its
  <a data-anolis-xref="top-level browsing context" href="#top-level-browsing-context">top-level browsing contexts</a>.</p>

  <p>A <code><a href="dom.html#document">Document</a></code> has a strong reference to its <code><a href="#window">Window</a></code> object.</p>

  <p class="note">A <code><a href="#window">Window</a></code> object <a data-anolis-xref="implied strong reference" href="infrastructure.html#implied-strong-reference">has a strong
  reference</a> to its <code><a href="dom.html#document">Document</a></code> object through its <code data-anolis-xref="dom-document"><a href="#dom-document-0">document</a></code> attribute. Thus, references from other scripts to either of
  those objects will keep both alive. Similarly, both <code><a href="dom.html#document">Document</a></code> and <code><a href="#window">Window</a></code>
  objects have <a data-anolis-xref="implied strong reference" href="infrastructure.html#implied-strong-reference">implied strong references</a> to the
  <code><a href="#windowproxy">WindowProxy</a></code> object.</p>

<!--CLEANUP-->
  <p>Each <a data-anolis-xref="concept-script" href="webappapis.html#concept-script">script</a> has a strong reference to its <a href="webappapis.html#settings-object">settings
  object</a>, and each <a href="webappapis.html#script-settings-object">script settings object</a>
  has strong references to its <a href="webappapis.html#global-object">global object</a>, <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a>, and <a href="webappapis.html#responsible-document">responsible document</a>.</p>

  <!-- discard a document -->
  <p>When a <a href="#browsing-context">browsing context</a> is to <dfn id="discard-a-document">discard a <code>Document</code></dfn>, the user
  agent must run the following steps:</p>

  <ol><li><p>Set the <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to false.</li>

   <li><p>Run any <a href="#unloading-document-cleanup-steps">unloading document cleanup steps</a> for the <code><a href="dom.html#document">Document</a></code> that
   are defined by this specification and <a href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</li>

   <li><p><a data-anolis-xref="abort a document" href="#abort-a-document">Abort the <code>Document</code></a>.</li>

   <li><p>Remove any <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> associated with the
   <code><a href="dom.html#document">Document</a></code> in any <a href="webappapis.html#task-source">task source</a>, without running those tasks.</li>

   <li><p><a data-anolis-xref="a browsing context is discarded" href="#a-browsing-context-is-discarded">Discard</a> all the <a data-anolis-xref="child
   browsing context" href="#child-browsing-context">child browsing contexts</a> of the <code><a href="dom.html#document">Document</a></code>.</li>

   <li><p>Lose the strong reference from the <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing context</a>
   to the <code><a href="dom.html#document">Document</a></code>.</li>

  </ol><p class="note">Whenever a <code><a href="dom.html#document">Document</a></code> object is <a data-anolis-xref="discard a
  Document" href="#discard-a-document">discarded</a>, it is also removed from the list of <span>the worker's
  <code><a href="dom.html#document">Document</a></code>s</span> of each worker whose list contains that <code><a href="dom.html#document">Document</a></code>.</p>

  <p>When <dfn id="a-browsing-context-is-discarded">a <em><span>browsing context</span></em> is discarded</dfn>, the strong reference
  from the user agent itself to the <a href="#browsing-context">browsing context</a> must be severed, and all the
  <code><a href="dom.html#document">Document</a></code> objects for all the entries in the <a href="#browsing-context">browsing context</a>'s session
  history must be <a data-anolis-xref="discard a document" href="#discard-a-document">discarded</a> as well.</p>

  <p>User agents may <a data-anolis-xref="a browsing context is discarded" href="#a-browsing-context-is-discarded">discard</a> <a data-anolis-xref="top-level browsing context" href="#top-level-browsing-context">top-level browsing contexts</a> at any time (typically, in
  response to user requests, e.g. when a user force-closes a window containing one or more <a data-anolis-xref="top-level browsing context" href="#top-level-browsing-context">top-level browsing contexts</a>). Other <a data-anolis-xref="browsing context" href="#browsing-context">browsing contexts</a> must be discarded once their
  <code><a href="#windowproxy">WindowProxy</a></code> object is eligible for garbage collection.</p>

  </div>


  <h4 id="closing-browsing-contexts"><span class="secno">5.2.6</span> ブラウジングコンテキストを閉じる</h4>

  <p>ユーザーエージェントは、<dfn id="close-a-browsing-context">ブラウジングコンテキストを閉じる</dfn>ことを供給される場合、以下のステップを実行しなければならない：</p>

  <ol><li><p><var data-anolis-xref="">specified browsing context</var>を閉じられている<a href="#browsing-context">ブラウジングコンテキスト</a>とする。</li>

   <li><p><var data-anolis-xref="">specified browsing context</var>の<a href="#active-document">アクティブなドキュメント</a>を<a data-anolis-xref="prompt to unload a document" href="#prompt-to-unload-a-document">アンロードするように要求する</a>。ユーザーが<a href="#refused-to-allow-the-document-to-be-unloaded">文書をアンロードできるようにすることを拒否した</a>場合、これらの手順を中止する。</li>

   <li><p>falseに設定する<var data-anolis-xref="">recycle</var>パラメータをもつ<var data-anolis-xref="">specified browsing context</var>の<a href="#active-document">アクティブなドキュメント</a>を<a data-anolis-xref="unload a document" href="#unload-a-document">アンロードする</a>。</li>

   <li><p>ユーザーインターフェース（たとえばタブブラウザでタブを閉じる、または非表示にする）から、<var data-anolis-xref="">specified browsing context</var>を削除する。</li>

   <li><p><var data-anolis-xref="">specified browsing context</var>を<a data-anolis-xref="a browsing context is discarded" href="#a-browsing-context-is-discarded">破棄する</a>。</li>

  </ol><p>ユーザーエージェントは、ユーザーが任意に任意の<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を<a data-anolis-xref="close a browsing
  context" href="#close-a-browsing-context">閉じる</a>機能を提供すべきである。</p>



  <h4 id="browser-interface-elements"><span class="secno">5.2.7</span> ブラウザインターフェース要素</h4>

  <p>ウェブページがウェブブラウザと統合できるようにするために、特定のウェブブラウザインターフェース要素はウェブページ内のスクリプトに限られた方法で公開される。</p>

  <p>各インターフェース要素は<code><a href="#barprop">BarProp</a></code>オブジェクトによって表される：</p>

  <pre class="idl">interface <dfn id="barprop">BarProp</dfn> {
           attribute boolean <a data-anolis-xref="dom-BarProp-visible" href="#dom-barprop-visible">visible</a>;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-locationbar"><a href="#dom-window-locationbar">locationbar</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt>
   <dd>
    <p>ロケーションバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-menubar"><a href="#dom-window-menubar">menubar</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt>
   <dd>
    <p>メニューバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-personalbar"><a href="#dom-window-personalbar">personalbar</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt><!--<dt><var data-x="">window</var> . <code data-x="dom-window-directories">directories</code> . <code data-x="dom-BarProp-visible">visible</code></dt>-->
   
   <dd>
    <p>パーソナルバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-scrollbars"><a href="#dom-window-scrollbars">scrollbars</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt>
   <dd>
    <p>スクロールバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-statusbar"><a href="#dom-window-statusbar">statusbar</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt>
   <dd>
    <p>ステータスバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-window-toolbar"><a href="#dom-window-toolbar">toolbar</a></code> . <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code></dt>
   <dd>
    <p>ツールバーが表示される場合はtrueを返し、そうでなければfalseを返す。</p>
   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-BarProp-visible" id="dom-barprop-visible">visible</dfn> attribute, on getting, must return either
  true or a value determined by the user agent to most accurately represent the visibility state of
  the user interface element that the object represents, as described below. On setting, the new
  value must be discarded.</p>

  <p>The following <code><a href="#barprop">BarProp</a></code> objects exist for each <code><a href="dom.html#document">Document</a></code> object in a
  <a href="#browsing-context">browsing context</a>. Some of the user interface elements represented by these objects
  might have no equivalent in some user agents; for those user agents, except when otherwise
  specified, the object must act as if it was present and visible (i.e. its <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code> attribute must return true).</p>

  <dl><dt><dfn id="the-location-bar-barprop-object">The location bar <code>BarProp</code> object</dfn></dt>

   <dd>Represents the user interface element that contains a control that displays the
   <a href="infrastructure.html#url">URL</a> of the <a href="#active-document">active document</a>, or some similar interface concept.</dd>

   <dt><dfn id="the-menu-bar-barprop-object">The menu bar <code>BarProp</code> object</dfn></dt>

   <dd>Represents the user interface element that contains a list of commands in menu form, or some
   similar interface concept.</dd>

   <dt><dfn id="the-personal-bar-barprop-object">The personal bar <code>BarProp</code> object</dfn></dt>

   <dd>Represents the user interface element that contains links to the user's favorite pages, or
   some similar interface concept.</dd>

   <dt><dfn id="the-scrollbar-barprop-object">The scrollbar <code>BarProp</code> object</dfn></dt>

   <dd>Represents the user interface element that contains a scrolling mechanism, or some similar
   interface concept.</dd>

   <dt><dfn id="the-status-bar-barprop-object">The status bar <code>BarProp</code> object</dfn></dt>

   <dd>Represents a user interface element found immediately below or after the document, as
   appropriate for the user's media. If the user agent has no such user interface element, then the
   object may act as if the corresponding user interface element was absent (i.e. its <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code> attribute may return false).</dd>

   <dt><dfn id="the-toolbar-barprop-object">The toolbar <code>BarProp</code> object</dfn></dt>

   <dd>Represents the user interface element found immediately above or before the document, as
   appropriate for the user's media. If the user agent has no such user interface element, then the
   object may act as if the corresponding user interface element was absent (i.e. its <code data-anolis-xref="dom-BarProp-visible"><a href="#dom-barprop-visible">visible</a></code> attribute may return false).</dd>

  </dl><p>The <dfn data-anolis-xref="dom-window-locationbar" id="dom-window-locationbar"><code>locationbar</code></dfn> attribute must return
  <a href="#the-location-bar-barprop-object">the location bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window-menubar" id="dom-window-menubar"><code>menubar</code></dfn> attribute must return <a href="#the-menu-bar-barprop-object">the
  menu bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window-personalbar" id="dom-window-personalbar"><code>personalbar</code></dfn> attribute must return
  <a href="#the-personal-bar-barprop-object">the personal bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window-scrollbars" id="dom-window-scrollbars"><code>scrollbars</code></dfn> attribute must return
  <a href="#the-scrollbar-barprop-object">the scrollbar <code>BarProp</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window-statusbar" id="dom-window-statusbar"><code>statusbar</code></dfn> attribute must return
  <a href="#the-status-bar-barprop-object">the status bar <code>BarProp</code> object</a>.</p>

  <p>The <dfn data-anolis-xref="dom-window-toolbar" id="dom-window-toolbar"><code>toolbar</code></dfn> attribute must return <a href="#the-toolbar-barprop-object">the
  toolbar <code>BarProp</code> object</a>.</p>

<!--
  <p>For legacy reasons, the <dfn data-x="dom-window-directories"><code>directories</code></dfn>
  attribute must also return <span>the personal bar <code>BarProp</code> object</span>.</p>
-->

  <hr><p>For historical reasons, the <dfn data-anolis-xref="dom-window-status" id="dom-window-status"><code>status</code></dfn> attribute
  on the <code><a href="#window">Window</a></code> object must, on getting, return the last string it was set to, and on
  setting, must set itself to the new value. When the <code><a href="#window">Window</a></code> object is created, the
  attribute must be set to the empty string. It does not do anything else.</p>

  </div>


  <div class="impl">

  <h4 id="the-windowproxy-object"><span class="secno">5.2.8 </span>The <code><a href="#windowproxy">WindowProxy</a></code> object</h4>


  <p>As mentioned earlier, each <a href="#browsing-context">browsing context</a> has a
  <dfn id="windowproxy"><code>WindowProxy</code></dfn> object. This object is unusual in that all operations that
  would be performed on it must be performed on the <code><a href="#window">Window</a></code> object of the <a href="#browsing-context">browsing
  context</a>'s <a href="#active-document">active document</a> instead. It is thus indistinguishable from that
  <code><a href="#window">Window</a></code> object in every way until the <a href="#browsing-context">browsing context</a> is navigated.</p>

  <p>There is no <code><a href="#windowproxy">WindowProxy</a></code> interface object.</p>

  <p class="note">The <code><a href="#windowproxy">WindowProxy</a></code> object allows scripts to act as if each
  <a href="#browsing-context">browsing context</a> had a single <code><a href="#window">Window</a></code> object, while still keeping
  separate <code><a href="#window">Window</a></code> objects for each <code><a href="dom.html#document">Document</a></code>.</p>

  <div class="example">

   <p>In the following example, the variable <var data-anolis-xref="">x</var> is set to the
   <code><a href="#windowproxy">WindowProxy</a></code> object returned by the <code data-anolis-xref="dom-window"><a href="#dom-window">window</a></code> accessor
   on the global object. All of the expressions following the assignment return true, because in
   every respect, the <code><a href="#windowproxy">WindowProxy</a></code> object acts like the underlying <code><a href="#window">Window</a></code>
   object.</p>

   <pre>var x = window;
x instanceof Window; // true
x === this; // true</pre>

  </div>

  </div><!--TOPIC:HTML--><!--TOPIC:Security-->





  <h3 id="origin"><span class="secno">5.3</span> 生成元</h3><!-- Hallowed are the Ori -->
  

  <p>生成元は、ウェブのセキュリティモデルの基本的な通貨である。生成元を共有するウェブプラットフォーム内の2つの当事者が互いに信頼し、同一の権限を有すると仮定される。異なる生成元をもつ当事者は、互いに潜在的に悪意があると見なされ、互いから程度を変化させるよう隔離される。</p>

  <p class="example">たとえば、<code data-anolis-xref="">bank.example.com</code>でホストされるExample Bankのウェブサイトは、<code data-anolis-xref="">charity.example.org</code>でホストExample CharityのウェブサイトのDOMを検査しようとすると、例外<code><a href="infrastructure.html#securityerror">SecurityError</a></code>例外が発生する。</p>

  <hr><p>リソースの<dfn id="origin-0">生成元</dfn>とリソースの<dfn id="effective-script-origin">効果的なスクリプトの生成元</dfn>は、スキームコンポーネント、ホストコンポーネント、ポートコンポーネント、および任意で追加データで構成される曖昧な識別子またはタプルいずれか両方である。</p>

  <p class="note">追加データは、サイトの安全な証明書が変更されたかどうか、同様に生成元が変化すると考えられることを保証するために、暗号化された接続を使用する際、サイトの証明書を含めることができる。</p>

  <div class="impl">

  <p>An <a href="#origin-0">origin</a> or <a href="#effective-script-origin">effective script origin</a> can be defined as an <dfn data-anolis-xref="concept-origin-alias" id="concept-origin-alias">alias</dfn> to another <a href="#origin-0">origin</a> or <a href="#effective-script-origin">effective script
  origin</a>. The value of the <a href="#origin-0">origin</a> or <a href="#effective-script-origin">effective script origin</a> is
  then the value of the <a href="#origin-0">origin</a> or <a href="#effective-script-origin">effective script origin</a> to which it is
  an alias.</p>

  <p>These characteristics are defined as follows:</p>

  <dl><dt>For URLs</dt>

   <dd>

    <p>The <a href="#origin-0">origin</a> and <a href="#effective-script-origin">effective script origin</a> of the <a href="infrastructure.html#url">URL</a> are
    the origin defined in <cite>The Web Origin Concept</cite>. <a href="references.html#refsORIGIN">[ORIGIN]</a></p>

   </dd>


   <dt>For <code><a href="dom.html#document">Document</a></code> objects</dt>

   <dd>

    <dl class="switch"><dt id="sandboxOrigin">If a <code><a href="dom.html#document">Document</a></code>'s <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> has
     its <a href="#sandboxed-origin-browsing-context-flag">sandboxed origin browsing context flag</a> set</dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> is a globally unique identifier assigned when the
      <code><a href="dom.html#document">Document</a></code> is created.</p>

      <p>The <a href="#effective-script-origin">effective script origin</a> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the
      <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> was served over the network and has an address that uses a URL
     scheme with a server-based naming authority</dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the
      <a href="#origin-0">origin</a> of <a href="dom.html#the-document's-address">the <code>Document</code>'s address</a>.</p>

      <p>The <a href="#effective-script-origin">effective script origin</a> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the
      <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> was generated from a <a data-anolis-xref="data protocol" href="infrastructure.html#data-protocol"><code data-anolis-xref="">data:</code> URL</a> found in another <code><a href="dom.html#document">Document</a></code> or in a script</dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the
      <a href="#origin-0">origin</a> specified by the <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a> when the <a href="#navigate">navigate</a>
      algorithm was invoked, or, if no <a data-anolis-xref="concept-script" href="webappapis.html#concept-script">script</a> was involved, of
      the <code><a href="dom.html#document">Document</a></code> of the element that initiated the <a data-anolis-xref="navigate" href="#navigate">navigation</a> to that <a href="infrastructure.html#url">URL</a>.</p>

      <p>The <a href="#effective-script-origin">effective script origin</a> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#effective-script-origin">effective script origin</a> of that
      same <a href="webappapis.html#script-settings-object">script settings object</a> or <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> is the initial "<code><a href="infrastructure.html#about:blank">about:blank</a></code>" document</dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> and <a href="#effective-script-origin">effective script origin</a> of the
      <code><a href="dom.html#document">Document</a></code> are <a href="#about-blank-origin">those it was assigned when its
      browsing context was created</a>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> was created as part of the processing for <a data-anolis-xref="javascript protocol" href="#javascript-protocol"><code>javascript:</code> URLs</a></dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the
      <a href="#origin-0">origin</a> of the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a>
      being navigated when the <a href="#navigate">navigate</a> algorithm was invoked.</p>

      <p>The <a href="#effective-script-origin">effective script origin</a> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#effective-script-origin">effective script origin</a> of that
      same <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> is <a href="embedded-content-0.html#an-iframe-srcdoc-document">an <code>iframe</code> <code data-anolis-xref="attr-iframe-srcdoc">srcdoc</code> document</a></dt>

     <dd>

      <p>The <a href="#origin-0">origin</a> of the <code><a href="dom.html#document">Document</a></code> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the
      <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing context</a>'s <a href="#browsing-context-container">browsing context
      container</a>'s <code><a href="dom.html#document">Document</a></code>.</p>

      <p>The <a href="#effective-script-origin">effective script origin</a> is initially an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#effective-script-origin">effective script origin</a> of the
      <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing context</a>'s <a href="#browsing-context-container">browsing context
      container</a>'s <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>


     <dt>If a <code><a href="dom.html#document">Document</a></code> was obtained in some other manner (e.g. a <a data-anolis-xref="data
     protocol" href="infrastructure.html#data-protocol"><code data-anolis-xref="">data:</code> URL</a> typed in by the user or that was returned as
     the location of an HTTP redirect (<a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or
     equivalent</a> in other protocols), a <code><a href="dom.html#document">Document</a></code> created using the <code data-anolis-xref="dom-DOMImplementation-createDocument"><a href="infrastructure.html#dom-domimplementation-createdocument">createDocument()</a></code> API, etc)</dt>

     <dd>

      <p>The default behavior as defined in the DOM standard applies. <a href="references.html#refsDOM">[DOM]</a>.</p>

      <p class="note">The <a href="#origin-0">origin</a> is a globally unique identifier assigned when the
      <code><a href="dom.html#document">Document</a></code> is created, and the <a href="#effective-script-origin">effective script origin</a> is initially an
      <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the
      <code><a href="dom.html#document">Document</a></code>.</p>

     </dd>

    </dl><p class="note">The <a href="#effective-script-origin">effective script origin</a> of a <code><a href="dom.html#document">Document</a></code> can be
    manipulated using the <code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code> IDL
    attribute.</p>

   </dd>


   <dt>For images of <code><a href="embedded-content-0.html#the-img-element">img</a></code> elements</dt>

   <dd>

    <dl class="switch"><dt>If the image data is <a href="infrastructure.html#cors-cross-origin">CORS-cross-origin</a></dt>

     <dd>The <a href="#origin-0">origin</a> is a globally unique identifier assigned when the image is
     created.</dd>


     <dt>If the image data is <a href="infrastructure.html#cors-same-origin">CORS-same-origin</a></dt>

     <dd>The <a href="#origin-0">origin</a> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the
     <a href="#origin-0">origin</a> of the <code><a href="embedded-content-0.html#the-img-element">img</a></code> element's <code><a href="dom.html#document">Document</a></code>.</dd>

     <!-- all image loads go through the "potentially CORS-enabled fetch" algorithm so they're all
     either CORS-cross-origin or CORS-same-origin if they succeed at all -->

    </dl><p>Images do not have an <a href="#effective-script-origin">effective script origin</a>.</p>

   </dd>


   <dt>For <code><a href="embedded-content-0.html#the-audio-element">audio</a></code> and <code><a href="embedded-content-0.html#the-video-element">video</a></code> elements</dt>

   <dd>

    <dl class="switch"><dt>If the <a href="embedded-content-0.html#media-data">media data</a> is <a href="infrastructure.html#cors-cross-origin">CORS-cross-origin</a></dt>

     <dd>The <a href="#origin-0">origin</a> is a globally unique identifier assigned when the <a href="embedded-content-0.html#media-data">media
     data</a> is <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetched</a>.</dd>


     <dt>If the <a href="embedded-content-0.html#media-data">media data</a> is <a href="infrastructure.html#cors-same-origin">CORS-same-origin</a></dt>

     <dd>The <a href="#origin-0">origin</a> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the
     <a href="#origin-0">origin</a> of the <a href="embedded-content-0.html#media-element">media element</a>'s <code><a href="dom.html#document">Document</a></code>.</dd>

    </dl><p><a data-anolis-xref="media element" href="embedded-content-0.html#media-element">Media elements</a> do not have an <a href="#effective-script-origin">effective script
    origin</a>.</p>

   </dd>


   <dt>For fonts</dt>

   <dd>

    <p>The <a href="#origin-0">origin</a> of a downloadable Web font is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the <a href="infrastructure.html#absolute-url">absolute
    URL</a> used to obtain the font (after any redirects). <a href="references.html#refsCSSFONTS">[CSSFONTS]</a>
    <a href="references.html#refsCSSFONTLOAD">[CSSFONTLOAD]</a></p> <!-- this means you can get data from a remote
    site if you can make it redirect to your own site in some fashion controlled by the data you
    want to read -->

    <p>The <a href="#origin-0">origin</a> of a locally installed system font is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a> to the <a href="#origin-0">origin</a> of the
    <code><a href="dom.html#document">Document</a></code> in which that font is being used.</p>

    <p>Fonts do not have an <a href="#effective-script-origin">effective script origin</a>.</p>

   </dd>

  </dl><p>Other specifications can override the above definitions by themselves specifying the origin of
  a particular <a href="infrastructure.html#url">URL</a>, <code><a href="dom.html#document">Document</a></code>, image, <a href="embedded-content-0.html#media-element">media element</a>, or
  font.</p>

  <!-- e.g.:

    <p>The <span>origin</span> of a <code>Document</code> object returned by the
    <code>XMLHttpRequest</code> API is an <span data-x="concept-origin-alias">alias</span> to the
    <span>XMLHttpRequest origin</span> of the <code>XMLHttpRequest</code> object.</p>

  -->

  <hr><p>The <dfn id="unicode-serialization-of-an-origin">Unicode serialization of an origin</dfn> is the string obtained by applying the
  following algorithm to the given <a href="#origin-0">origin</a>:</p>

  <ol><li><p>If the <a href="#origin-0">origin</a> in question is not a scheme/host/port tuple, then return the
   literal string "<code data-anolis-xref="">null</code>" and abort these steps.</li>

   <li><p>Otherwise, let <var data-anolis-xref="">result</var> be the scheme part of the <a href="#origin-0">origin</a>
   tuple.</li>

   <li><p>Append the string "<code data-anolis-xref="">://</code>" to <var data-anolis-xref="">result</var>.</li>

   <li><p>Apply the IDNA ToUnicode algorithm to each component of the host part of the
   <a href="#origin-0">origin</a> tuple, and append the results — each component, in the same order,
   separated by "." (U+002E) characters — to <var data-anolis-xref="">result</var>. <a href="references.html#refsRFC3490">[RFC3490]</a></li> <!--XXX-23005-->

   <li><p>If the port part of the <a href="#origin-0">origin</a> tuple gives a port that is different from the
   default port for the protocol given by the scheme part of the <a href="#origin-0">origin</a> tuple, then
   append a ":" (U+003A) character and the given port, in base ten, to <var data-anolis-xref="">result</var>.</li>

   <li><p>Return <var data-anolis-xref="">result</var>.</li>

  </ol><p>The <dfn id="ascii-serialization-of-an-origin">ASCII serialization of an origin</dfn> is the string obtained by applying the
  following algorithm to the given <a href="#origin-0">origin</a>:</p>

  <ol><li><p>If the <a href="#origin-0">origin</a> in question is not a scheme/host/port tuple, then return the
   literal string "<code data-anolis-xref="">null</code>" and abort these steps.</li>

   <li><p>Otherwise, let <var data-anolis-xref="">result</var> be the scheme part of the <a href="#origin-0">origin</a>
   tuple.</li>

   <li><p>Append the string "<code data-anolis-xref="">://</code>" to <var data-anolis-xref="">result</var>.</li>

   <li>

    <p>Apply the IDNA ToASCII algorithm to the host part of the <a href="#origin-0">origin</a> tuple, with both
    the AllowUnassigned and UseSTD3ASCIIRules flags set, and append the results to <var data-anolis-xref="">result</var>.</p> <!--XXX-23005-->

    <p>If ToASCII fails to convert one of the components of the string, e.g. because it is too long
    or because it contains invalid characters, then return the empty string and abort these steps.
    <a href="references.html#refsRFC3490">[RFC3490]</a></p>

   </li>

   <li><p>If the port part of the <a href="#origin-0">origin</a> tuple gives a port that is different from the
   default port for the protocol given by the scheme part of the <a href="#origin-0">origin</a> tuple, then
   append a ":" (U+003A) character and the given port, in base ten, to <var data-anolis-xref="">result</var>.</li>

   <li><p>Return <var data-anolis-xref="">result</var>.</li>

  </ol><p>Two <a data-anolis-xref="origin" href="#origin-0">origins</a> are said to be the <dfn id="same-origin">same origin</dfn> if the
  following algorithm returns true:</p>

  <ol><li><p>Let <var data-anolis-xref="">A</var> be the first <a href="#origin-0">origin</a> being compared, and <var data-anolis-xref="">B</var> be the second <a href="#origin-0">origin</a> being compared.</li>

   <li><p>If <var data-anolis-xref="">A</var> and <var data-anolis-xref="">B</var> are both opaque identifiers, and their
   value is equal, then return true.</li>

   <li><p>Otherwise, if either <var data-anolis-xref="">A</var> or <var data-anolis-xref="">B</var> or both are opaque
   identifiers, return false.</li>

   <li><p>If <var data-anolis-xref="">A</var> and <var data-anolis-xref="">B</var> have scheme components that are not
   identical, return false.</li>

   <li><p>If <var data-anolis-xref="">A</var> and <var data-anolis-xref="">B</var> have host components that are not
   identical, return false.</li>

   <li><p>If <var data-anolis-xref="">A</var> and <var data-anolis-xref="">B</var> have port components that are not
   identical, return false.</li>

   <li><p>If either <var data-anolis-xref="">A</var> or <var data-anolis-xref="">B</var> have additional data, but that
   data is not identical for both, return false.</li>

   <li><p>Return true.</li>

  </ol></div>


  <h4 id="relaxing-the-same-origin-restriction"><span class="secno">5.3.1</span> 同一生成元制限を緩和する</h4>

  <dl class="domintro"><dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">domain</a></code> [ = <var data-anolis-xref="">domain</var> ]</dt>

   <dd>

    <p>セキュリティチェックのために使用される現在のドメインを返す。</p>

    <p>（それらが同じことをする場合）互いにアクセスするために同じドメインの他のサブドメインのページを許可するために<a href="#effective-script-origin">効果的なスクリプトの生成元</a>を変更するために、サブドメインを削除した値に設定可能である。（サンドボックス化された<code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>において設定できない。）</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-document-domain" id="dom-document-domain"><code>domain</code></dfn> attribute on
  <code><a href="dom.html#document">Document</a></code> objects must be initialized to <a href="#the-document's-domain">the document's domain</a>, if it has
  one, and the empty string otherwise. If <a href="#the-document's-domain">the document's domain</a> starts with a "[" (U+005B) character and ends with a "]" (U+005D) character, it is
  an IPv6 address; these square brackets must be omitted when initializing the attribute's
  value.</p>

  <p>On getting, the attribute must return its current value, unless the <code><a href="dom.html#document">Document</a></code> has
  no <a href="#browsing-context">browsing context</a>, in which case it must return the empty string.</p>

  <p>On setting, the user agent must run the following algorithm:</p>

  <ol><li>

    <p>If the <code><a href="dom.html#document">Document</a></code> has no <a href="#browsing-context">browsing context</a>, throw a
    <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li>

   <li>

    <p>If the <code><a href="dom.html#document">Document</a></code>'s <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> has its
    <a href="#sandboxed-document.domain-browsing-context-flag">sandboxed <code data-anolis-xref="dom-document-domain">document.domain</code> browsing context
    flag</a> set, throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</p>

   </li>

   <li>

    <p>If the new value is an IPv4 or IPv6 address, let <var data-anolis-xref="">new value</var> be the new
    value. Otherwise, apply the IDNA ToASCII algorithm to the new value, with both the
    AllowUnassigned and UseSTD3ASCIIRules flags set, and let <var data-anolis-xref="">new value</var> be the
    result of the ToASCII algorithm.</p> <!--XXX-23005-->

    <p>If ToASCII fails to convert one of the components of the string, e.g. because it is too long
    or because it contains invalid characters, then throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and
    abort these steps. <a href="references.html#refsRFC3490">[RFC3490]</a></p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">new value</var> is not exactly equal to the current value of the <code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code> attribute, then run these substeps:</p>

    <ol><li>

      <p>If the current value is an IPv4 or IPv6 address, throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code>
      exception and abort these steps.</p>

     </li>

     <li>

      <p>If <var data-anolis-xref="">new value</var>, prefixed by a "." (U+002E), does not exactly
      match the end of the current value, throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort
      these steps.</p>

      <p class="note">If the <var data-anolis-xref="">new value</var> is an IPv4 or IPv6 address, it cannot
      match the <var data-anolis-xref="">new value</var> in this way and thus an exception will be thrown
      here.</p>

      <!-- this is the step that prevents us from ever setting document.domain if the >effective
      script origin< isn't a scheme/host/port tuple -->

     </li>

     <li>

      <p>If <var data-anolis-xref="">new value</var> matches a suffix in the Public Suffix List, or, if <var data-anolis-xref="">new value</var>, prefixed by a "." (U+002E), matches the end of a suffix in
      the Public Suffix List, then throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these
      steps. <a href="references.html#refsPSL">[PSL]</a></p>

      <p>Suffixes must be compared after applying the IDNA ToASCII algorithm to them, with both the
      AllowUnassigned and UseSTD3ASCIIRules flags set, in an <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a>
      manner. <a href="references.html#refsRFC3490">[RFC3490]</a></p> <!--XXX-23005-->

     </li>

    </ol></li>

   <li><p>Release the <a href="webappapis.html#storage-mutex">storage mutex</a>.</li>

   <li>

    <p>Set the attribute's value to <var data-anolis-xref="">new value</var>.</p>

   </li>

   <li>

    <p>If the <a href="#effective-script-origin">effective script origin</a> of the <code><a href="dom.html#document">Document</a></code> is an <a data-anolis-xref="concept-origin-alias" href="#concept-origin-alias">alias</a>, set it to the value of the <a href="#effective-script-origin">effective script
    origin</a> (essentially de-aliasing the <a href="#effective-script-origin">effective script origin</a>).</p>

   </li>

   <li>

    <p>If <var data-anolis-xref="">new value</var> is not the empty string, then run these substeps:</p>

    <ol><li>

      <p>Set the host part of the <a href="#effective-script-origin">effective script origin</a> tuple of the
      <code><a href="dom.html#document">Document</a></code> to <var data-anolis-xref="">new value</var>.</p>

     </li>

     <li>

      <p>Set the port part of the <a href="#effective-script-origin">effective script origin</a> tuple of the
      <code><a href="dom.html#document">Document</a></code> to "manual override" (a value that, for the purposes of <a data-anolis-xref="same origin" href="#same-origin">comparing origins</a>, is identical to "manual override" but not
      identical to any other value).</p>

     </li>

    </ol></li>

  </ol><p>The <dfn data-anolis-xref="the document's domain" id="the-document's-domain">domain</dfn> of a <code><a href="dom.html#document">Document</a></code> is the host part
  of the document's <a href="#origin-0">origin</a>, if the value of that <a href="#origin-0">origin</a> is a
  scheme/host/port tuple. If it isn't, then the document does not have a domain.</p>

  </div>

  <p class="note"><code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain"> domain</a></code>属性は、ドメインの異なるホスト上の有効なページに互いのDOMをアクセスするために使用される。</p>

  <p class="warning">共有ホスティングを使用する際<code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>の属性を使用しない。信頼できない第三者が同じIPアドレスだが別のポート上でHTTPサーバーをホストできる場合、<code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>属性が使用された後に生成元を比較する際にポートは無視されるように、通常同じホスト上の2つの異なるサイトを保護する同一生成元の保護は失敗するだろう。</p><!--TOPIC:HTML-->





  <h3 id="sandboxing"><span class="secno">5.4</span> サンドボックス</h3>

  <p><dfn id="sandboxing-flag-set">サンドボックスフラグ設定</dfn>は、潜在的に信頼されないリソースが持つ能力を制限するために使用される、以下のフラグに属するゼロ個以上のセットである：</p>

  <dl><dt><dfn id="sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<a href="#sandboxLinks">サンドボックス化されたブラウジングコンテキスト自身以外のコンテンツのナビゲーションブラウジングコンテキスト</a>（またはその中にさらにネストされたブラウジングコンテキスト）、（次の定義された<a href="#sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>により保護される）<a data-anolis-xref="auxiliary browsing context" href="#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>、および（以下に定義する<a href="#sandboxed-top-level-navigation-browsing-context-flag">サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>によって保護される）<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を阻止する。</p>

    <p><a href="#sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>が設定されない場合、それにもかかわらず一定の場合における制限はポップアップ（新しい<a data-anolis-xref="top-level browsing
    context" href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>）を開くことができる。これらの<a data-anolis-xref="browsing
    context" href="#browsing-context">ブラウジングコンテキスト</a>は常に、<dfn id="one-permitted-sandboxed-navigator">1つの許可されたサンドボックス化されたナビゲーター</dfn>を持ち、実際に移動するために作成した<a href="#browsing-context">ブラウジングコンテキスト</a>を許可する、ブラウジングコンテキストが作成される際に設定を持つ。（そうでなければ、<a href="#sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>は、それらが開かれた場合であってもナビゲートされていくのを防ぐだろう。）</p>

   </dd>


   <dt><dfn id="sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、たとえば<code data-anolis-xref="attr-hyperlink-target"><a href="links.html#attr-hyperlink-target">target</a></code>属性、または<code data-anolis-xref="dom-open"><a href="#dom-open">window.open()</a></code>の使用など、<a href="#sandboxWindowOpen">新しい補助ブラウジングコンテキストの作成からコンテンツを防ぐ</a>。</p>

   </dd>


   <dt><dfn id="sandboxed-top-level-navigation-browsing-context-flag">サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<a href="#sandboxLinks">それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href="#sandboxClose">それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。</p>

    <p><a href="#sandboxed-top-level-navigation-browsing-context-flag">サンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>が設定され<em>ない</em>場合、コンテンツはその<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>をナビゲートできるが、他の<a data-anolis-xref="browsing context" href="#browsing-context">ブラウジングコンテキスト</a>は依然として<a href="#sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>およびおそらく<a href="#sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護される。</p>

   </dd>


   <dt><dfn id="sandboxed-plugins-browsing-context-flag">サンドボックス化されたプラグインブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>これらの<a data-anolis-xref="plugin" href="infrastructure.html#plugin">プラグイン</a>が<a data-anolis-xref="concept-plugin-secure" href="infrastructure.html#concept-plugin-secure">安全</a>でない限り、<a href="embedded-content-0.html#sandboxPluginEmbed"><code>embed</code>要素</a>、<a href="embedded-content-0.html#sandboxPluginObject"><code>object</code>要素</a>、<a href="obsolete.html#sandboxPluginApplet"><code>applet</code>要素</a>を使用しているかどうか、または<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>の<a href="#sandboxPluginNavigate">ナビゲーション</a>を介して、このフラグは、<a data-anolis-xref="plugin" href="infrastructure.html#plugin">プラグイン</a>をインスタンス化するコンテンツを防ぐ。</p>

   </dd>


   <dt><dfn id="sandboxed-origin-browsing-context-flag">サンドボックス化された生成元ブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<a href="#sandboxOrigin">一意な生成元にコンテンツを強制する</a>。したがって、同一<a href="#origin-0">生成元</a>から他のコンテンツにアクセスすることを防止する。</p>

    <p>このフラグはまた、<a href="dom.html#sandboxCookies"><code data-anolis-xref="dom-document-cookie">document.cookie</code>IDL属性からの読み取りまたは書き込みをするスクリプトを防止し</a>、<code data-anolis-xref="dom-localStorage">localStorage</code>へのアクセスをブロックする。<a href="references.html#refsWEBSTORAGE">[WEBSTORAGE]</a>
        </p>

   </dd>


   <dt><dfn id="sandboxed-forms-browsing-context-flag">サンドボックス化されたフォームブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは<a href="forms.html#sandboxSubmitBlocked">フォーム送信をブロックする</a>。</p>

   </dd>


   <dt><dfn id="sandboxed-pointer-lock-browsing-context-flag">サンドボックス化されたポインタロックブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグはPointer Lock APIを無効にする。<a href="references.html#refsPOINTERLOCK">[POINTERLOCK]</a></p>

   </dd>


   <dt><dfn id="sandboxed-scripts-browsing-context-flag">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<a href="webappapis.html#sandboxScriptBlocked">スクリプトの実行をブロックする</a>。</p>

   </dd>


   <dt><dfn id="sandboxed-automatic-features-browsing-context-flag">サンドボックス化された自動機能ブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<a data-anolis-xref="attr-media-autoplay" href="embedded-content-0.html#attr-media-autoplay">自動ビデオ再生</a>や<a data-anolis-xref="attr-fe-autofocus" href="forms.html#attr-fe-autofocus">自動フォームコントロールフォーカス</a>などの、自動的に切り替える機能をブロックする。</p>

   </dd>


   <dt><dfn id="sandboxed-fullscreen-browsing-context-flag">サンドボックス化されたフルスクリーンブラウジングコンテキストフラグ</dfn></dt>

   <dd>

    <p>このフラグは、<code data-anolis-xref="dom-element-requestFullscreen"><a href="infrastructure.html#dom-element-requestfullscreen">requestFullscreen()</a></code>メソッドの使用からコンテンツを保護する。</p>

   </dd>


   <dt><dfn id="sandboxed-document.domain-browsing-context-flag">サンドボックス化された<code data-anolis-xref="dom-document-domain">document.domain</code>ブラウジングコンテキストフラグ</dfn>。</dt>

   <dd>

    <p>このフラグは、<a href="#effective-script-origin">有効なスクリプトの生成元</a>を変更する<code data-anolis-xref="dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>機能の使用からコンテンツを防止する。</p>

   </dd>


  </dl><p>ユーザーエージェントが<dfn id="parse-a-sandboxing-directive">サンドボックスディレクティブを解析する</dfn>場合、文字列<var data-anolis-xref="">input</var>、<a href="#sandboxing-flag-set">サンドボックスフラグ設定</a><var data-anolis-xref="">output</var>、および任意で<var data-anolis-xref="">allow fullscreen flag</var>を与え、次の手順を実行しなければならない：</p>

  <ol><li><p><var data-anolis-xref="">tokens</var>を取得するために、<a data-anolis-xref="split a string on spaces" href="infrastructure.html#split-a-string-on-spaces">スペースでの<var data-anolis-xref="">input</var>を分割する</a>。</li>

   <li><p><var data-anolis-xref="">output</var>を空にする。</li>

   <li>

    <p><var data-anolis-xref="">output</var>に次のフラグを追加する：</p>

    <ul><li><p><a href="#sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a></li>

     <li><p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-popups" id="attr-iframe-sandbox-allow-popups"><code>allow-popups</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a></li>

     <li><p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-top-navigation" id="attr-iframe-sandbox-allow-top-navigation"><code>allow-top-navigation</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-top-level-navigation-browsing-context-flag">サンドボックス化されたトップレベルブラウジングコンテキストフラグ</a></li>

     <li><p><a href="#sandboxed-plugins-browsing-context-flag">サンドボックス化されたプラグインブラウジングコンテキストフラグ</a></li>

     <li>

      <p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-same-origin" id="attr-iframe-sandbox-allow-same-origin"><code>allow-same-origin</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-origin-browsing-context-flag">サンドボックス化された生成元ブラウジングコンテキストフラグ</a></p>

      <div class="note">

       <p><code data-anolis-xref="attr-iframe-sandbox-allow-same-origin"><a href="#attr-iframe-sandbox-allow-same-origin">allow-same-origin</a></code>キーワードは2つの例を対象とする。</p>

       <p>1つ目は、依然としてサンドボックス化されたコンテンツのDOMへのアクセスを可能する一方で、スクリプトを無効にするためにサンドボックス化されるべき同じサイトからコンテンツを許可するために使用できる。</p>

       <p>2つ目は、サードパーティサイトからコンテンツを埋め込むために使用でき、データなどを格納するためにデータベースAPIを使用して、その元のサイトに戻る通信から埋め込まれたページを妨げることなく、ポップアップウィンドウなどを開いてから、そのサイトを防ぐためにサンドボックス化する。</p>

      </div>

     </li>

     <li><p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-forms" id="attr-iframe-sandbox-allow-forms"><code>allow-forms</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-forms-browsing-context-flag">サンドボックス化されたフォームブラウジングコンテキストフラグ</a></li>

     <li><p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-pointer-lock" id="attr-iframe-sandbox-allow-pointer-lock"><code>allow-pointer-lock</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-pointer-lock-browsing-context-flag">サンドボックス化されたポインタロックブラウジングコンテキストフラグ</a></li>

     <li><p><var data-anolis-xref="">tokens</var>が<dfn data-anolis-xref="attr-iframe-sandbox-allow-scripts" id="attr-iframe-sandbox-allow-scripts"><code>allow-scripts</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-scripts-browsing-context-flag">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</a></li>

     <li>

      <p><var data-anolis-xref="">tokens</var>が（上記で定義された）<code data-anolis-xref="attr-iframe-sandbox-allow-scripts"><a href="#attr-iframe-sandbox-allow-scripts">allow-scripts</a></code>キーワードを含む場合を除いて、<a href="#sandboxed-automatic-features-browsing-context-flag">サンドボックス化された自動機能ブラウジングコンテキストフラグ</a></p>

      <p class="note">このフラグは、サンドボックスの自動機能　これらの機能がとにかく些細なことも可能であるスクリプトが有効である場合、およびそれらが宣言機能を使用できるようにするよりむしろサンドボックス化された場合、著者がそれらを行うためのスクリプトを使用するよう強制することが不幸であるので、スクリプトと同じキーワードで緩和される。</p>

     </li>

     <li><p><var data-anolis-xref="">allow fullscreen flag</var>が<a href="#parse-a-sandboxing-directive">サンドボックスディレクティブを解析する</a>フラグを通過される場合を除いて、<a href="#sandboxed-fullscreen-browsing-context-flag">サンドボックス化されたフルスクリーンブラウジングコンテキストフラグ</a></li>

     <li><p><a href="#sandboxed-document.domain-browsing-context-flag">サンドボックス化された<code data-anolis-xref="dom-document-domain">document.domain</code>ブラウジングコンテキストフラグ</a>。</li>

    </ul></li>

  </ol><hr><p>すべての<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>は、<a href="#sandboxing-flag-set">サンドボックスフラグが設定</a>される、<dfn id="popup-sandboxing-flag-set">ポップアップサンドボックスフラグ設定</dfn>を持つ。<a href="#browsing-context">ブラウジングコンテキスト</a>が作成される場合、その<a href="#popup-sandboxing-flag-set">ポップアップサンドフラグ設定</a>は空でなければならない。これは、<a href="#the-rules-for-choosing-a-browsing-context-given-a-browsing-context-name">ブラウジングコンテキスト名を指定されるブラウジングコンテキストを選択するための規則</a>によって移入される。</p>

  <p>すべての<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>は、<a href="#sandboxing-flag-set">サンドボックスフラグが設定</a>される、<dfn id="iframe-sandboxing-flag-set"><code>iframe</code>サンドボックスフラグ設定</dfn>を持つ。<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>の<a href="#iframe-sandboxing-flag-set"><code>iframe</code>サンドボックスフラグ設定</a>で任意の特定の時間に設定されるそれぞれのフラグは、<code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>要素の<code data-anolis-xref="attr-iframe-sandbox"><a href="embedded-content-0.html#attr-iframe-sandbox">sandbox</a></code>属性によって決定される。</p>

  <p>すべての<code><a href="dom.html#document">Document</a></code>は、<a href="#sandboxing-flag-set">サンドボックスフラグ設定</a>である、<dfn id="active-sandboxing-flag-set">アクティブサンドボックスフラグ設定</dfn>を持つ。<code><a href="dom.html#document">Document</a></code>が作成される場合、その<a href="#active-sandboxing-flag-set">アクティブサンドボックスフラグ設定</a>が空でなければならない。それは、<a data-anolis-xref="navigate" href="#navigate">ナビゲーションアルゴリズム</a>によって追加される。</p>

  <p><a data-anolis-xref="navigate" href="#navigate">ナビゲーションアルゴリズム</a>によって得られるすべてのリソースは、<a href="#sandboxing-flag-set">サンドボックスフラグが設定</a>される、<dfn id="forced-sandboxing-flag-set">強制サンドボックスフラグ設定</dfn>を持つ。デフォルトでリソースは、その<a href="#forced-sandboxing-flag-set">強制サンドボックスフラグセット</a>で設定されるフラグを持たないが、他の仕様は、特定のフラグが設定されていることを定義できる。</p>

  <p class="note">具体的には、<a href="#forced-sandboxing-flag-set">強制サンドボックスフラグセット</a>がコンテンツセキュリティポリシー仕様によって使用される。<a href="references.html#refsCSP">[CSP]</a></p>

  <hr><p>ユーザーエージェントが<code><a href="dom.html#document">Document</a></code>の<dfn id="implement-the-sandboxing">サンドボックスを実装する</dfn>際に、<code><a href="dom.html#document">Document</a></code>オブジェクトが作成された時点で、次の<a data-anolis-xref="sandboxing flag set" href="#sandboxing-flag-set">サンドボックスフラグセット</a>に存在するフラグの組合とともに<code><a href="dom.html#document">Document</a></code>の<a href="#active-sandboxing-flag-set">アクティブなサンドボックスフラグセット</a>を追加しなければならない：</p>

  <ul><li><p><code><a href="dom.html#document">Document</a></code>の<a href="#browsing-context">ブラウジングコンテキスト</a>が<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>である場合：<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#popup-sandboxing-flag-set">ポップアップサンドフラグセット</a>に設定されたフラグ。</li>

   <li><p><code><a href="dom.html#document">Document</a></code>の<a href="#browsing-context">ブラウジングコンテキスト</a>が<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>である場合：<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#iframe-sandboxing-flag-set"><code>iframe</code>サンドフラグセット</a>に設定されたフラグ。</li>

   <li><p><code><a href="dom.html#document">Document</a></code>の<a href="#browsing-context">ブラウジングコンテキスト</a>が<a href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>である場合：<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#parent-browsing-context">親ブラウジングコンテキスト</a>に属する<a href="#active-document">アクティブ文書</a>の<a href="#active-sandboxing-flag-set">アクティブサンドボックスフラグセット</a>。</li>

   <li><p>存在する場合、<code><a href="dom.html#document">Document</a></code>のリソースの<a href="#forced-sandboxing-flag-set">強制サンドボックスフラグセット</a>に設定されたフラグをフラグは設定する。</li>

  </ul><h3 id="history"><span class="secno">5.5</span> セッション履歴およびナビゲーション</h3>

  <h4 id="the-session-history-of-browsing-contexts"><span class="secno">5.5.1</span> ブラウジングコンテキストのセッション履歴</h4>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a>内の<code><a href="dom.html#document">Document</a></code>の配列は、その<dfn id="session-history">セッション履歴</dfn>である。<a data-anolis-xref="nested browsing
  context" href="#nested-browsing-context">ネストされたブラウジングコンテキスト</a>を含む各<a href="#browsing-context">ブラウジングコンテキスト</a>は、個別のセッション履歴を持つ。<a href="#browsing-context">ブラウジングコンテキスト</a>のセッション履歴は、<a data-anolis-xref="session history
  entry" href="#session-history-entry">セッション履歴のエントリ</a>のフラットなリストから成る。各<dfn id="session-history-entry">セッション履歴のエントリ</dfn>は、少なくとも、<a href="infrastructure.html#url">URL</a>、およびさらに<a href="#state-object">状態オブジェクト</a>を持ってもよい各エントリ、タイトル、<code><a href="dom.html#document">Document</a></code>オブジェクト、フォームデータ、スクロールポジション、および関連する他の情報から構成される。</p>

  <p class="note">最初に作成される際、各エントリは<code><a href="dom.html#document">Document</a></code>を持つ。しかし、<code><a href="dom.html#document">Document</a></code>が<a data-anolis-xref="fully active" href="#fully-active">活性化</a>でない場合、リソースを解放するために<a data-anolis-xref="discard a Document" href="#discard-a-document">廃棄する</a>ことができる。<a href="#session-history-entry">セッション履歴のエントリ</a>において<a href="infrastructure.html#url">URL</a>などのデータは、新しい<code><a href="dom.html#document">Document</a></code>に元の場所を取るものをもたらすために使用され、ユーザーエージェントは自身にその<code><a href="dom.html#document">Document</a></code>を再活性化する必要を見つけるべきである。</p>

  <p class="note"><a data-anolis-xref="session history entry" href="#session-history-entry">セッション履歴エントリ</a>に関連付けられたタイトルは、<code><a href="dom.html#document">Document</a></code>の現在の<code><a href="document-metadata.html#the-title-element">title</a></code>と関係をもつ必要はない。<a href="#session-history-entry">セッション履歴エントリ</a>のタイトルは、ユーザーが文書の履歴をナビゲートできるように、その時点で文書の状態を説明しようとするものである。</p>

  <p><a data-anolis-xref="state object" href="#state-object">セッション履歴</a>関連付けられるURLが、ユーザー（またはスクリプト）がページからページへ移動するように状態に追加される。</p>

  <hr><p><a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#session-history">セッション履歴</a>における各<code><a href="dom.html#document">Document</a></code>オブジェクトは、同じ基礎となる<a href="#session-history">セッション履歴</a>をすべてモデル化しなければならない、一意な<code><a href="#history-1">History</a></code>オブジェクトに関連付けられる。</p>

  <div class="impl">

  <p>The <dfn data-anolis-xref="dom-history" id="dom-history"><code>history</code></dfn> attribute of the <code><a href="#window">Window</a></code>
  interface must return the object implementing the <code><a href="#history-1">History</a></code> interface for that <a data-anolis-xref="concept-document-window" href="#concept-document-window"><code>Window</code> object's newest
  <code>Document</code></a>.</p>

  </div>

  <hr><p><dfn id="state-object">状態オブジェクト</dfn>は、ユーザーインターフェースの状態を表すオブジェクトである。</p>

  <p>ページは、セッション履歴に<a data-anolis-xref="state object" href="#state-object">状態オブジェクト</a>を<a data-anolis-xref="dom-history-pushState" href="#dom-history-pushstate">追加</a>できる。このように著者に一つでもページのアプリケーションでは"ナビゲーション"メタファーを使用できるように、これらは、ユーザー（またはスクリプト）が履歴に戻る際にその後<a data-anolis-xref="event-popstate" href="#event-popstate">スクリプトに返される</a>。</p>

  <div class="note">

   <p><a data-anolis-xref="state object" href="#state-object">状態オブジェクト</a>は、2つの主な目的に使用されることを意図される：1つ目は、（それがユーザーによって扱う<a data-anolis-xref="URL" href="infrastructure.html#url">URL</a>を渡されるものに対して解析する必要が依然としてあるので、マイナー最適化のみであるが）単純なケース場合において、著者が解析を行う必要がないように、<a href="infrastructure.html#url">URL</a>内の状態の事前解析された説明を格納し、2つ目は、新しい<code><a href="dom.html#document">Document</a></code>が開かれた場合、現在の<code><a href="dom.html#document">Document</a></code>インスタンスのみに適用され、再構築しなければならないため、著者はそれがURLに格納しない状態を保存できるようにする。</p>

   <p>後者の例は、ユーザーが戻った場合同じ場所にアニメーションさせることができるように、ポップアップ<code><a href="grouping-content.html#the-div-element">div</a></code>がアニメーション化するために作られた正確な座標を追跡するようなものになるだろう。またその代わりに、前後に行く際に、情報が再度フェッチする必要がないよう、<a href="infrastructure.html#url">URL</a>内の情報に基づいてサーバーからフェッチされるデータのキャッシュにポインタを保持するために使用できる。</p>

  </div>

  <hr><p>任意の時点で、セッション履歴のエントリの一つは、<dfn id="current-entry">現在のエントリ</dfn>である。これは、<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#active-document">アクティブドキュメント</a>を表すエントリである。<a href="#current-entry">現在のエントリ</a>であるそれぞれのエントリは、この仕様で定義されるアルゴリズムによって変更される。たとえば<a data-anolis-xref="traverse the history" href="#traverse-the-history">セッション履歴走査</a>中など。</p>

  <p class="note"><a href="#current-entry">現在のエントリ</a>は通常、<code><a href="dom.html#document">Document</a></code>の<a data-anolis-xref="the
  document's address" href="dom.html#the-document's-address">アドレス</a>のエントリである。しかし、それはまた、その文書によって履歴に追加された<a data-anolis-xref="state object" href="#state-object">状態オブジェクト</a>のエントリのいずれかを指定できる。</p>

  <p><dfn id="an-entry-with-persisted-user-state">永続ユーザー状態を持つエントリ</dfn>はまた、ユーザーエージェント定義の状態を持つ。この仕様は、何が状態の種類を格納できるのかを指定しない。</p>
  
  <p class="example">たとえば、一部のユーザーエージェントは、スクロール位置またはフォームコントロールの値を永続化したいかもしれない。</p>

  <p class="note">フォームコントロールの値を永続化するユーザーエージェントはまた、それらの方向（要素の<code data-anolis-xref="attr-dir"><a href="dom.html#the-dir-attribute">dir</a></code>属性の値）を保持することが推奨される。これは、ユーザーが最初明示的にデフォルト以外の方向をもつ値を入力した場合、履歴走査の後に誤って値を表示することを防ぐ。</p>

  <p><a data-anolis-xref="state object" href="#state-object">状態オブジェクト</a>から成るエントリは、追加された際にアクティブであったページのエントリと同じ<code><a href="dom.html#document">Document</a></code>を共有する。</p>

  <p>フラグメント識別子が異なる連続したエントリはまた、同じ<code><a href="dom.html#document">Document</a></code>を共有する。</p>

  <p class="note">（単にある特定の文書の異なる状態である）同じ<code><a href="dom.html#document">Document</a></code>を共有するすべてのエントリは、定義により連続する。</p>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a>内の各<code><a href="dom.html#document">Document</a></code>はまた、<dfn id="latest-entry">最新のエントリ</dfn>を持つことができる。これは、エントリまたは直近に走査された<code><a href="dom.html#document">Document</a></code>である。<code><a href="dom.html#document">Document</a></code>が作成される場合、最初に<a href="#latest-entry">最新のエントリ</a>を持たない。</p>

  <div class="impl">

  <p>User agents may <a data-anolis-xref="discard a Document" href="#discard-a-document">discard</a> the <code><a href="dom.html#document">Document</a></code>
  objects of entries other than the <a href="#current-entry">current entry</a> that are not referenced from any
  script, reloading the pages afresh when the user or script navigates back to such pages. This
  specification does not specify when user agents should discard <code><a href="dom.html#document">Document</a></code> objects and
  when they should cache them.</p>

  <p>Entries that have had their <code><a href="dom.html#document">Document</a></code> objects discarded must, for the purposes of
  the algorithms given below, act as if they had not. When the user or script navigates back or
  forwards to a page which has no in-memory DOM objects, any other entries that shared the same
  <code><a href="dom.html#document">Document</a></code> object with it must share the new object as well.</p>

  </div><!--TOPIC:DOM APIs-->




  <h4 id="the-history-interface"><span class="secno">5.5.2</span> <code><a href="#history-1">History</a></code>インターフェース</h4>

  <pre class="idl">interface <dfn id="history-1">History</dfn> {
  readonly attribute long <a data-anolis-xref="dom-history-length" href="#dom-history-length">length</a>;
  readonly attribute any <a data-anolis-xref="dom-history-state" href="#dom-history-state">state</a>;
  void <a data-anolis-xref="dom-history-go" href="#dom-history-go">go</a>(optional long delta);
  void <a data-anolis-xref="dom-history-back" href="#dom-history-back">back</a>();
  void <a data-anolis-xref="dom-history-forward" href="#dom-history-forward">forward</a>();
  void <a data-anolis-xref="dom-history-pushState" href="#dom-history-pushstate">pushState</a>(any data, DOMString title, optional DOMString? url = null);
  void <a data-anolis-xref="dom-history-replaceState" href="#dom-history-replacestate">replaceState</a>(any data, DOMString title, optional DOMString? url = null);
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-length"><a href="#dom-history-length">length</a></code></dt>

   <dd>

    <p><a href="#joint-session-history">ジョイントセッション履歴</a>内のエントリの数を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-state"><a href="#dom-history-state">state</a></code></dt>

   <dd>

    <p>現在の<a href="#state-object">状態オブジェクト</a>を返す。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-go"><a href="#dom-history-go">go</a></code>( [ <var data-anolis-xref="">delta</var> ] )</dt>

   <dd>

    <p><a href="#joint-session-history">ジョイントセッション履歴</a>内のステップの指定した数の前後に進む。</p>

    <p>ゼロ差分は、現在のページをリロードする。</p>

    <p>差分が範囲外の場合、何もしない。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-back"><a href="#dom-history-back">back</a></code>()</dt>

   <dd>

    <p><a href="#joint-session-history">ジョイントセッション履歴</a>内の1つのステップに戻る。</p>

    <p>前のページが存在しない場合、何もしない。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-forward"><a href="#dom-history-forward">forward</a></code>()</dt>

   <dd>

    <p><a href="#joint-session-history">ジョイントセッション履歴</a>内の1つのステップに進む。</p>

    <p>次のページが存在しない場合、何もしない。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState</a></code>(<var data-anolis-xref="">data</var>, <var data-anolis-xref="">title</var> [, <var data-anolis-xref="">url</var> ] )</dt>

   <dd>

    <p>指定されたURLが供給される場合、指定されたタイトルとともに、セッション履歴上に与えられたデータをプッシュする。</p>

   </dd>

   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> . <code data-anolis-xref="dom-history-replaceState"><a href="#dom-history-replacestate">replaceState</a></code>(<var data-anolis-xref="">data</var>, <var data-anolis-xref="">title</var> [, <var data-anolis-xref="">url</var> ] )</dt>

   <dd>

    <p>指定されたデータ、タイトルおよび、提供される場合にURLを持つ、セッション履歴の現在のエントリを更新する。</p>

   </dd>

  </dl><!--TOPIC:HTML--><p><a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>の<dfn id="joint-session-history">ジョイントセッション履歴</dfn>は、<a href="#current-entry-of-the-joint-session-history">ジョイントセッション履歴の現在のエントリ</a>を除いて削除されたそれぞれの<a data-anolis-xref="session
  history" href="#session-history">セッション履歴</a>において<a data-anolis-xref="current entry" href="#current-entry">現在のエントリ</a>であるすべてのエントリとともに、<a href="#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を共有するすべての<a href="#fully-active">完全にアクティブな</a><code><a href="dom.html#document">Document</a></code>オブジェクトのすべての<a data-anolis-xref="browsing
  context" href="#browsing-context">ブラウジングコンテキスト</a>に属するすべての<a data-anolis-xref="session history" href="#session-history">セッション履歴</a>の結合である。</p>

  <p><dfn id="current-entry-of-the-joint-session-history">ジョイントセッション履歴の現在のエントリ</dfn>は、最近その<a href="#session-history">セッション履歴</a>内の<a href="#current-entry">現在のエントリ</a>になったエントリである。</p>

  <p><a href="#joint-session-history">ジョイントセッション履歴</a>内のエントリは、それぞれの<a data-anolis-xref="session history" href="#session-history">セッション履歴</a>に追加された時点で時系列に並べられる。各エントリはインデックスを持つ。最古のエントリのインデックスは0を持ち、後続のエントリは連続して増加する整数（1、2、3など）を番号付けされる。</p>

  <p class="note"><a href="#browsing-context">ブラウジングコンテキスト</a>内の各<code><a href="dom.html#document">Document</a></code>は、異なる<a href="webappapis.html#event-loop">イベントループ</a>があるかもしれないので、<a href="#joint-session-history">ジョイントセッション履歴</a>の実際の状態は、不明瞭にできる。たとえば、2つの兄弟<code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>要素は、同時に1つのユニークな原点から別のものに互いに<a data-anolis-xref="traverse the history" href="#traverse-the-history">横断</a>でき、それらの正確な順序は明確に定義されないかもしれない。それらは後にお互いを知るかもしれないので、同様に、それらは<a href="#joint-session-history">ジョイントセッション履歴</a>の長さについて同意しないかもしれない。</p><!--TOPIC:DOM APIs-->



  <div class="impl">

<!--ADD-TOPIC:Security-->
  <p>All the getters and setters for attributes, and all the methods, defined on the
  <code><a href="#history-1">History</a></code> interface, when invoked on a <code><a href="#history-1">History</a></code> object associated with a
  <code><a href="dom.html#document">Document</a></code> that is not <a href="#fully-active">fully active</a>, must throw a
  <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception instead of operating as described below.</p>
<!--REMOVE-TOPIC:Security-->

  <p>The <dfn data-anolis-xref="dom-history-length" id="dom-history-length"><code>length</code></dfn> attribute of the
  <code><a href="#history-1">History</a></code> interface must return the number of entries in the <a href="#top-level-browsing-context">top-level browsing
  context</a>'s <a href="#joint-session-history">joint session history</a>.</p>

  <p>The actual entries are not accessible from script.</p>

  <p>The <dfn data-anolis-xref="dom-history-state" id="dom-history-state"><code>state</code></dfn> attribute of the
  <code><a href="#history-1">History</a></code> interface must return the last value it was set to by the user agent.
  Initially, its value must be null.</p>

  <p>When the <dfn data-anolis-xref="dom-history-go" id="dom-history-go"><code>go(<var data-anolis-xref="">delta</var>)</code></dfn> method is
  invoked, if the argument to the method was omitted or has the value zero, the user agent must act
  as if the <code data-anolis-xref="dom-location-reload"><a href="#dom-location-reload">location.reload()</a></code> method was called instead.
  Otherwise, the user agent must <a href="#traverse-the-history-by-a-delta">traverse the history by a delta</a> whose value is the
  value of the method's argument.</p>

  <p>When the <dfn data-anolis-xref="dom-history-back" id="dom-history-back"><code>back()</code></dfn> method is invoked, the user
  agent must <a href="#traverse-the-history-by-a-delta">traverse the history by a delta</a> −1.</p>

  <p>When the <dfn data-anolis-xref="dom-history-forward" id="dom-history-forward"><code>forward()</code></dfn>method is invoked, the
  user agent must <a href="#traverse-the-history-by-a-delta">traverse the history by a delta</a> +1.</p>

<!--TOPIC:HTML-->

  <hr><p>Each <a href="#top-level-browsing-context">top-level browsing context</a> has a <dfn id="session-history-traversal-queue">session history traversal queue</dfn>,
  initially empty, to which <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> can be added.</p>

  <p>Each <a href="#top-level-browsing-context">top-level browsing context</a>, when created, must asynchronously begin running
  the following algorithm, known as the <dfn id="session-history-event-loop">session history event loop</dfn> for that
  <a href="#top-level-browsing-context">top-level browsing context</a>:</p>

  <ol><li><p>Wait until this <a href="#top-level-browsing-context">top-level browsing context</a>'s <a href="#session-history-traversal-queue">session history traversal
   queue</a> is not empty.</li>

   <li><p>Pull the first <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> from this <a href="#top-level-browsing-context">top-level browsing
   context</a>'s <a href="#session-history-traversal-queue">session history traversal queue</a>, and execute it.</li>

   <li><p>Return to the first step of this algorithm.</p>

  </li></ol><p>The <a href="#session-history-event-loop">session history event loop</a> helps coordinate cross-browsing-context transitions
  of the <a href="#joint-session-history">joint session history</a>: since each <a href="#browsing-context">browsing context</a> might, at any
  particular time, have a different <a href="webappapis.html#event-loop">event loop</a> (this can happen if the user agent has
  more than one <a href="webappapis.html#event-loop">event loop</a> per <a href="#unit-of-related-browsing-contexts">unit of related browsing contexts</a>),
  transitions would otherwise have to involve cross-event-loop synchronisation.</p>

  <hr><p>To <dfn id="traverse-the-history-by-a-delta">traverse the history by a delta</dfn> <var data-anolis-xref="">delta</var>, the user agent must
  append a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to this <a href="#top-level-browsing-context">top-level browsing context</a>'s
  <a href="#session-history-traversal-queue">session history traversal queue</a>, the <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a>
  consisting of running the following steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">delta</var> be the argument to the method.</li>

   <li><p>If the index of the <a href="#current-entry-of-the-joint-session-history">current entry of the joint session history</a> plus <var data-anolis-xref="">delta</var> is less than zero or greater than or equal to the number of items in the
   <a href="#joint-session-history">joint session history</a>, then abort these steps.</p>

   </li><li><p>Let <var data-anolis-xref="">specified entry</var> be the entry in the <a href="#joint-session-history">joint session
   history</a> whose index is the sum of <var data-anolis-xref="">delta</var> and the index of the
   <a href="#current-entry-of-the-joint-session-history">current entry of the joint session history</a>.</li>

   <li><p>Let <var data-anolis-xref="">specified browsing context</var> be the <a href="#browsing-context">browsing context</a> of
   the <var data-anolis-xref="">specified entry</var>.</li>

   <li><p>If the <var data-anolis-xref="">specified browsing context</var>'s <a href="#active-document">active document</a>'s
   <a href="#unload-a-document">unload a document</a> algorithm is currently running, abort these steps.</li>

   <li>

    <p><a href="webappapis.html#queue-a-task">Queue a task</a> that consists of running the following substeps. The relevant
    <a href="webappapis.html#event-loop">event loop</a> is that of the <var data-anolis-xref="">specified browsing context</var>'s
    <a href="#active-document">active document</a>. The <a href="webappapis.html#task-source">task source</a> for the queued task is the
    <a href="webappapis.html#history-traversal-task-source">history traversal task source</a>.</p>

    <ol><li><p>If there is an ongoing attempt to navigate <var data-anolis-xref="">specified browsing context</var>
     that has not yet <a data-anolis-xref="concept-navigate-mature" href="#concept-navigate-mature">matured</a> (i.e. it has not passed the
     point of making its <code><a href="dom.html#document">Document</a></code> the <a href="#active-document">active document</a>), then cancel that
     attempt to navigate the <a href="#browsing-context">browsing context</a>.</li>

     <li>

      <p>If the <var data-anolis-xref="">specified browsing context</var>'s <a href="#active-document">active document</a> is not
      the same <code><a href="dom.html#document">Document</a></code> as the <code><a href="dom.html#document">Document</a></code> of the <var data-anolis-xref="">specified
      entry</var>, then run these substeps:</p>

      <ol><li><p><a href="infrastructure.html#fully-exit-fullscreen">Fully exit fullscreen</a>.</li>

       <li><p><a data-anolis-xref="prompt to unload a document" href="#prompt-to-unload-a-document">Prompt to unload</a> the <a href="#active-document">active
       document</a> of the <var data-anolis-xref="">specified browsing context</var>. If the user
       <a href="#refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then abort these steps.</li>

       <li><p><a data-anolis-xref="unload a document" href="#unload-a-document">Unload</a> the <a href="#active-document">active document</a> of the
       <var data-anolis-xref="">specified browsing context</var> with the <var data-anolis-xref="">recycle</var> parameter
       set to false.</li>

      </ol></li>

     <li><p><a href="#traverse-the-history">Traverse the history</a> of the <var data-anolis-xref="">specified browsing context</var> to
     the <var data-anolis-xref="">specified entry</var>.</p>

    </li></ol></li>

  </ol><p>When the user navigates through a <a href="#browsing-context">browsing context</a>, e.g. using a browser's back
  and forward buttons, the user agent must <a href="#traverse-the-history-by-a-delta">traverse the history by a delta</a> equivalent
  to the action specified by the user.</p>

  <hr><!--TOPIC:DOM APIs--><p>The <dfn data-anolis-xref="dom-history-pushState" id="dom-history-pushstate"><code>pushState(<var data-anolis-xref="">data</var>, <var data-anolis-xref="">title</var>, <var data-anolis-xref="">url</var>)</code></dfn> method adds a state object entry to
  the history.</p>

  <p>The <dfn data-anolis-xref="dom-history-replaceState" id="dom-history-replacestate"><code>replaceState(<var data-anolis-xref="">data</var>, <var data-anolis-xref="">title</var>, <var data-anolis-xref="">url</var>)</code></dfn> method updates the state object,
  title, and optionally the <a href="infrastructure.html#url">URL</a> of the <a href="#current-entry">current entry</a> in the history.</p>

  <p>When either of these methods is invoked, the user agent must run the following steps:</p>

  <ol><li><p>Let <var data-anolis-xref="">cloned data</var> be a <a href="infrastructure.html#structured-clone">structured clone</a> of the specified
   <var data-anolis-xref="">data</var>. If this throws an exception, then rethrow that exception and abort
   these steps.</li>

   <li>

    <p>If the third argument is not null, run these substeps:</p>

    <ol><!--CLEANUP--><li><a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">Resolve</a> the value of the third argument, relative to the
     <a href="webappapis.html#api-base-url">API base URL</a> specified by the
     <a href="webappapis.html#entry-settings-object">entry settings object</a>.</li>

     <li>If that fails, throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</li>

     <li>Compare the resulting <a href="infrastructure.html#parsed-url">parsed URL</a> to the result of applying the <a href="infrastructure.html#url-parser">URL
     parser</a> algorithm to <a href="dom.html#the-document's-address">the document's address</a>. If any component of these two
     <a data-anolis-xref="URL" href="infrastructure.html#url">URLs</a> differ other than the <a data-anolis-xref="concept-url-path" href="infrastructure.html#concept-url-path">path</a>,
     <a data-anolis-xref="concept-url-query" href="infrastructure.html#concept-url-query">query</a>, and <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a> components, then throw a
     <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception and abort these steps.</li>

<!--CLEANUP-->
     <li>If the <a href="#origin-0">origin</a> of the resulting <a href="infrastructure.html#absolute-url">absolute URL</a> is not the same as
     the <a href="#origin-0">origin</a> of the <a href="webappapis.html#responsible-document">responsible document</a> specified by the <a href="webappapis.html#entry-settings-object">entry
     settings object</a>, and either the <a data-anolis-xref="concept-url-path" href="infrastructure.html#concept-url-path">path</a> or <a data-anolis-xref="concept-url-query" href="infrastructure.html#concept-url-query">query</a> components of the two <a data-anolis-xref="parsed URL" href="infrastructure.html#parsed-url">parsed
     URLs</a> compared in the previous step differ, throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception
     and abort these steps. (This prevents sandboxed content from spoofing other pages on the same
     origin.)</li>

     <li><p>Let <var data-anolis-xref="">new URL</var> be the resulting <a href="infrastructure.html#absolute-url">absolute URL</a>.</li>

    </ol><p>For the purposes of the comparisons in the above substeps, the <a data-anolis-xref="concept-url-path" href="infrastructure.html#concept-url-path">path</a> and <a data-anolis-xref="concept-url-query" href="infrastructure.html#concept-url-query">query</a> components
    can only be the same if the <a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a> component of both
    <a data-anolis-xref="parsed URL" href="infrastructure.html#parsed-url">parsed URLs</a> are <a data-anolis-xref="concept-url-scheme-relative" href="infrastructure.html#concept-url-scheme-relative">relative schemes</a>.</p>

   </li>

   <li>

    <p>If the third argument is null, then let <var data-anolis-xref="">new URL</var> be the <a href="infrastructure.html#url">URL</a>
    of the <a href="#current-entry">current entry</a>.</p>

   </li><li>

    <p>If the method invoked was the <code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code>
    method:</p>

    <ol><li>

      <p>Remove all the entries in the <a href="#browsing-context">browsing context</a>'s <a href="#session-history">session history</a>
      after the <a href="#current-entry">current entry</a>. If the <a href="#current-entry">current entry</a> is the last entry in
      the session history, then no entries are removed.</p>

      <p class="note">This <a href="#history-notes">doesn't necessarily have to affect</a> the user
      agent's user interface.</p>

     </li>

     <li><p>Remove any <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source">history traversal
     task source</a> that are associated with any <code><a href="dom.html#document">Document</a></code> objects in the
     <a href="#top-level-browsing-context">top-level browsing context</a>'s <a href="#document-family">document family</a>.</li>

     <li><p>If appropriate, update the <a href="#current-entry">current entry</a> to reflect any state that the user
     agent wishes to persist. The entry is then said to be <a href="#an-entry-with-persisted-user-state">an entry with persisted user
     state</a>.</li>

     <li><p>Add a <a href="#state-object">state object</a> entry to the session history, after the <a href="#current-entry">current
     entry</a>, with <var data-anolis-xref="">cloned data</var> as the <a href="#state-object">state object</a>, the given
     <var data-anolis-xref="">title</var> as the title, and <var data-anolis-xref="">new URL</var> as the <a href="infrastructure.html#url">URL</a>
     of the entry.</li>

     <li><p>Update the <a href="#current-entry">current entry</a> to be this newly added entry.</li>

    </ol><p>Otherwise, if the method invoked was the <code data-anolis-xref="dom-history-replaceState"><a href="#dom-history-replacestate">replaceState()</a></code> method:</p>

    <ol><li><p>Update the <a href="#current-entry">current entry</a> in the session history so that <var data-anolis-xref="">cloned data</var> is the entry's new state object, the given <var data-anolis-xref="">title</var>
     is the new title, and <var data-anolis-xref="">new URL</var> is the entry's new <a href="infrastructure.html#url">URL</a>.</li>

    </ol></li>

   <li><p>If the <a href="#current-entry">current entry</a> in the session history represents a non-GET request
   (e.g. it was the result of a POST submission) then update it to instead represent a GET request
   (<a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>).</li>

   <li>

    <p>Set <a href="dom.html#the-document's-address">the document's address</a> to <var data-anolis-xref="">new URL</var>.</p>

    <p class="note">Since this is neither a <a data-anolis-xref="navigate" href="#navigate">navigation</a> of the
    <a href="#browsing-context">browsing context</a> nor a <a data-anolis-xref="traverse the history" href="#traverse-the-history">history traversal</a>,
    it does not cause a <code data-anolis-xref="event-hashchange"><a href="#event-hashchange">hashchange</a></code> event to be fired.</p>

   </li>

   <li>

    <p>Set <code data-anolis-xref="dom-history-state"><a href="#dom-history-state">history.state</a></code> to a <a href="infrastructure.html#structured-clone">structured clone</a>
    of <var data-anolis-xref="">cloned data</var>.</p> <!-- it's a clone of /cloned data/, not /data/, so that
    there's no risk of running scripts again -->

   </li>

   <li>

    <p>Let the <a href="#latest-entry">latest entry</a> of the <code><a href="dom.html#document">Document</a></code> of the <a href="#current-entry">current
    entry</a> be the <a href="#current-entry">current entry</a>.</p>

   </li>

  </ol><p class="note">The <var data-anolis-xref="">title</var> is purely advisory. User agents might use the title
  in the user interface.</p>

  <p>User agents may limit the number of state objects added to the session history per page. If a
  page hits the UA-defined limit, user agents must remove the entry immediately after the first
  entry for that <code><a href="dom.html#document">Document</a></code> object in the session history after having added the new
  entry. (Thus the state history acts as a FIFO buffer for eviction, but as a LIFO buffer for
  navigation.)</p>

  </div>

  <div class="example">

   <p>ユーザーはいくつかの座標に常にあり、ユーザーが後で再開するための特定の座標に対応するページをブックマークできるような、ユーザーがラインに沿って移動できるゲームを考える。</p>

   <p>そのようなゲームでx=5位置を実装する静的ページは次のようになる：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this is http://example.com/line?x=5 --&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate 5 on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;</pre>

   <p>このようなシステムの問題点は、毎回ユーザーがクリックするとページ全体をリロードする必要があることにある。ここで、代わりにスクリプトを使用して、リロードを行うための別の方法：</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;!-- this starts off as http://example.com/line?x=5 --&gt;
&lt;title&gt;Line Game - 5&lt;/title&gt;
&lt;p&gt;You are at coordinate &lt;span id="coord"&gt;5&lt;/span&gt; on the line.&lt;/p&gt;
&lt;p&gt;
 &lt;a href="?x=6" onclick="go(1); return false;"&gt;Advance to 6&lt;/a&gt; or
 &lt;a href="?x=4" onclick="go(-1); return false;"&gt;retreat to 4&lt;/a&gt;?
&lt;/p&gt;
&lt;script&gt;
 var currentPage = 5; // prefilled by server
 function go(d) {
   setupPage(currentPage + d);
   history.pushState(currentPage, document.title, '?x=' + currentPage);
 }
 onpopstate = function(event) {
   setupPage(event.state);
 }
 function setupPage(page) {
   currentPage = page;
   document.title = 'Line Game - ' + currentPage;
   document.getElementById('coord').textContent = currentPage;
   document.links[0].href = '?x=' + (currentPage+1);
   document.links[0].textContent = 'Advance to ' + (currentPage+1);
   document.links[1].href = '?x=' + (currentPage-1);
   document.links[1].textContent = 'retreat to ' + (currentPage-1);
 }
&lt;/script&gt;</pre>

   <p>スクリプトをもたないシステムにおいて、前の例と同じように動作する。しかし、同じ体験に対するネットワークアクセスが存在しないので、スクリプトをサポート<em>する</em>ユーザーは現在はるかに速く移動できる。さらに、経験に反して、ユーザーは単にナイーブなスクリプトベースのアプローチ、ブックマーク、およびセッション履歴の移動が依然として動作する必要がある。</p>

   <p>上記の例において、<code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code>メソッドへの<var data-anolis-xref="">data</var>引数は、サーバに送信されるものと同じ情報であるが、スクリプトはURLにユーザーが移動するたびに解析する必要はないので、より便利な形式となる。</p>

  </div>

  <div class="example">

   <p>アプリケーションは、その時点で文書の<code><a href="document-metadata.html#the-title-element">title</a></code>要素の値として<a href="#session-history-entry">セッション履歴エントリ</a>の同じタイトルを使用しないかもしれない。たとえば、これは<code><a href="document-metadata.html#the-title-element">title</a></code>要素内のブロックを示す単純なページである。明らかに、後方に以前の状態に移動する際にユーザーは時間内に戻らず、したがって、セッション履歴のタイトルに時間を置くことは不適切だろう。</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;TITLE&gt;Line&lt;/TITLE&gt;
&lt;SCRIPT&gt;
 setInterval(function () { document.title = 'Line - ' + new Date(); }, 1000);
 var i = 1;
 function inc() {
   set(i+1);
   history.pushState(i, 'Line - ' + i);
 }
 function set(newI) {
   i = newI;
   document.forms.F.I.value = newI;
 }
&lt;/SCRIPT&gt;
&lt;BODY ONPOPSTATE="set(event.state)"&gt;
&lt;FORM NAME=F&gt;
State: &lt;OUTPUT NAME=I&gt;1&lt;/OUTPUT&gt; &lt;INPUT VALUE="Increment" TYPE=BUTTON ONCLICK="inc()"&gt;
&lt;/FORM&gt;</pre>

  </div>



  <h4 id="the-location-interface"><span class="secno">5.5.3</span> <code><a href="#location">Location</a></code>インターフェース</h4>

  <p><a href="#browsing-context">ブラウジングコンテキスト</a>のセッション履歴における各<code><a href="dom.html#document">Document</a></code>オブジェクトは、<code><a href="#location">Location</a></code>オブジェクトの一意なインスタンスに関連付けられる。</p>

  <dl class="domintro"><dt><var data-anolis-xref="">document</var> . <code data-anolis-xref="dom-document-location"><a href="#dom-document-location">location</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>
   <dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-location"><a href="#dom-location">location</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>現在のページの位置と<code><a href="#location">Location</a></code>オブジェクトを返す。</p>

    <p>別のページにナビゲートするために、設定可能である。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-document-location" id="dom-document-location"><code>location</code></dfn> attribute of the
  <code><a href="dom.html#document">Document</a></code> interface must return the <code><a href="#location">Location</a></code> object for that
  <code><a href="dom.html#document">Document</a></code> object, if it is in a <a href="#browsing-context">browsing context</a>, and null otherwise.</p>

  <p>The <dfn data-anolis-xref="dom-location" id="dom-location"><code>location</code></dfn> attribute of the <code><a href="#window">Window</a></code>
  interface must return the <code><a href="#location">Location</a></code> object for that <code><a href="#window">Window</a></code> object's
  <code><a href="dom.html#document">Document</a></code>.</p>

  </div>

  <p><code><a href="#location">Location</a></code>オブジェクトは、その<code><a href="dom.html#document">Document</a></code>の<a href="#browsing-context">ブラウジングコンテキスト</a>の<a href="#active-document">アクティブなドキュメント</a>の<a data-anolis-xref="the document's
  address" href="dom.html#the-document's-address">アドレス</a>の表現を提供し、かつ<a href="#browsing-context">ブラウジングコンテキスト</a>のセッション履歴に属する<a href="#current-entry">現在のエントリ</a>の変更を<code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code>オブジェクト内のエントリを追加または交換することによって許可する。</p>

  <pre class="idl">[Unforgeable] interface <dfn id="location">Location</dfn> {
  void <a data-anolis-xref="dom-location-assign" href="#dom-location-assign">assign</a>(DOMString url);
  void <a data-anolis-xref="dom-location-replace" href="#dom-location-replace">replace</a>(DOMString url);
  void <a data-anolis-xref="dom-location-reload" href="#dom-location-reload">reload</a>();
};
<a href="#location">Location</a> implements <a href="infrastructure.html#urlutils">URLUtils</a>;</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">location</var> . <code data-anolis-xref="dom-location-assign"><a href="#dom-location-assign">assign</a></code>(<var data-anolis-xref="">url</var>)</dt>

   <dd>

    <p>特定のページに移動する。</p>

   </dd>

   <dt><var data-anolis-xref="">location</var> . <code data-anolis-xref="dom-location-replace"><a href="#dom-location-replace">replace</a></code>(<var data-anolis-xref="">url</var>)</dt>

   <dd>

    <p>セッション履歴から現在のページを削除して、指定されたページに移動する。</p>

   </dd>

   <dt><var data-anolis-xref="">location</var> . <code data-anolis-xref="dom-location-reload"><a href="#dom-location-reload">reload</a></code>()</dt>

   <dd>

    <p>現在のページをリロードする。</p>

   </dd>

  </dl><div class="impl">

  <p>The <i>relevant <code><a href="dom.html#document">Document</a></code></i> is the <code><a href="#location">Location</a></code> object's associated
  <code><a href="dom.html#document">Document</a></code> object's <a href="#browsing-context">browsing context</a>'s <a href="#active-document">active document</a>.</p>

<!--CLEANUP-->
  <p>When the <dfn data-anolis-xref="dom-location-assign" id="dom-location-assign"><code>assign(<var data-anolis-xref="">url</var>)</code></dfn>
  method is invoked, the UA must <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolve</a> the argument, relative
  to the <a href="webappapis.html#api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings object</a>, and if that is
  successful, must <a href="#navigate">navigate</a><!--DONAV location.href/assign--> the <a href="#browsing-context">browsing
  context</a> to the specified <var data-anolis-xref="">url</var>, with <a href="#exceptions-enabled">exceptions enabled</a>. If the <a href="#browsing-context">browsing context</a>'s
  <a href="#session-history">session history</a> contains only one <code><a href="dom.html#document">Document</a></code>, and that was the
  <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> created when the <a href="#browsing-context">browsing context</a> was
  created, then the navigation must be done with <a href="#replacement-enabled">replacement enabled</a>.</p> <!-- READ ME
  WHEN EDITING THIS: IE and Firefox only seem to treat it that way if the DOM is still a virgin DOM;
  Safari doesn't check that. Thus this might need changing if testing shows the IE/Firefox behaviour
  is required here. -->

<!--CLEANUP-->
  <p>When the <dfn data-anolis-xref="dom-location-replace" id="dom-location-replace"><code>replace(<var data-anolis-xref="">url</var>)</code></dfn>
  method is invoked, the UA must <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolve</a> the argument, relative
  to the <a href="webappapis.html#api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings object</a>, and if that is
  successful, <a href="#navigate">navigate</a><!--DONAV location.href/replace--> the <a href="#browsing-context">browsing
  context</a> to the specified <var data-anolis-xref="">url</var> with <a href="#replacement-enabled">replacement enabled</a> and <a href="#exceptions-enabled">exceptions enabled</a>.</p>

<!--CLEANUP-->
  <p>Navigation for the <code data-anolis-xref="dom-location-assign"><a href="#dom-location-assign">assign()</a></code> and <code data-anolis-xref="dom-location-replace"><a href="#dom-location-replace">replace()</a></code> methods must be done with the <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a> specified by
  the <a href="webappapis.html#incumbent-settings-object">incumbent settings object</a> as the <a href="#source-browsing-context">source
  browsing context</a>.</p>

  <p>If the <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolving</a> step of the <code data-anolis-xref="dom-location-assign"><a href="#dom-location-assign">assign()</a></code> and <code data-anolis-xref="dom-location-replace"><a href="#dom-location-replace">replace()</a></code> methods is not successful, then the user agent must
  instead throw a <code><a href="infrastructure.html#syntaxerror">SyntaxError</a></code> exception.</p>

  <p>When the <dfn data-anolis-xref="dom-location-reload" id="dom-location-reload"><code>reload()</code></dfn> method is invoked, the
  user agent must run the appropriate steps from the following list:</p>

  <dl class="switch"><dt>If the currently executing <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> is the dispatch of a <code data-anolis-xref="event-resize">resize</code> event in response to the user resizing the <a href="#browsing-context">browsing
   context</a></dt>

   <dd><p>Repaint the <a href="#browsing-context">browsing context</a> and abort these steps.</dd> <!-- this
   theoretically would have no effect but in practice can be useful to work around rendering bugs.
   -->

   <dt>If the <a href="#browsing-context">browsing context</a>'s <a href="#active-document">active document</a> is <a href="embedded-content-0.html#an-iframe-srcdoc-document">an
   <code>iframe</code> <code data-anolis-xref="attr-iframe-srcdoc">srcdoc</code> document</a></dt>

   <dd><p><a data-anolis-xref="process the iframe attributes" href="embedded-content-0.html#process-the-iframe-attributes">Reprocess the <code>iframe</code>
   attributes</a> of the <a href="#browsing-context">browsing context</a>'s <a href="#browsing-context-container">browsing context
   container</a>.</dd>

   <dt>If the <a href="#browsing-context">browsing context</a>'s <a href="#active-document">active document</a> has its <a href="dom.html#reload-override-flag">reload
   override flag</a> set</dt>

   <dd><p>Perform <a href="dom.html#an-overridden-reload">an overridden reload</a>, with the <a href="#browsing-context">browsing context</a> being
   navigated as the <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a>.</dd>
   <!-- http://damowmow.com/playground/demos/sandbox/001.html -->

   <dt>Otherwise</dt>

<!--CLEANUP-->
   <dd><p><a href="#navigate">Navigate</a><!--DONAV location.reload()--> the
   <a href="#browsing-context">browsing context</a> to <a href="dom.html#the-document's-address">the document's
   address</a> with <a href="#replacement-enabled">replacement enabled</a> and <a href="#exceptions-enabled">exceptions enabled</a>. The
   <a href="#source-browsing-context">source browsing context</a> must be the <a href="#browsing-context">browsing
   context</a> being navigated.</dd> <!-- it appears that
   document.reload() always uses GET and does not, e.g., re-POST. -->

   <!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/141 defends the source browsing context claim; submit, eval document.referrer, reload, eval document.referrer. -->

  </dl><p>When a user requests that the <a href="#active-document">active document</a> of a <a href="#browsing-context">browsing context</a>
  be reloaded through a user interface element, the user agent should <a href="#navigate">navigate</a><!--DONAV
  user reload--> the <a href="#browsing-context">browsing context</a> to the same resource as that
  <code><a href="dom.html#document">Document</a></code>, with <a href="#replacement-enabled">replacement enabled</a>. In the case of non-idempotent
  methods (e.g. HTTP POST), the user agent should prompt the user to confirm the operation first,
  since otherwise transactions (e.g. purchases or database modifications) could be repeated. User
  agents may allow the user to explicitly override any caches when reloading. If <a href="#browsing-context">browsing
  context</a>'s <a href="#active-document">active document</a>'s <a href="dom.html#reload-override-flag">reload override flag</a> is set, then the
  user agent may instead perform <a href="dom.html#an-overridden-reload">an overridden reload</a> rather than the navigation
  described in this paragraph (with the <a href="#browsing-context">browsing context</a> being reloaded as the
  <a href="#source-browsing-context">source browsing context</a>).</p>

  <hr></div><!-- concept-uu -->

  

  <p><code><a href="#location">Location</a></code>はまた<code><a href="infrastructure.html#urlutils">URLUtils</a></code>インターフェースをサポートする。<a href="references.html#refsURL">[URL]</a></p>

  <div class="impl">

  <p>When the object is created, and whenever the <a data-anolis-xref="the document's address" href="dom.html#the-document's-address">the
  address</a> of the <i>relevant <code><a href="dom.html#document">Document</a></code></i> changes, the user agent must invoke
  the object's <code><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a data-anolis-xref="concept-uu-set-the-input" href="infrastructure.html#concept-uu-set-the-input">set the
  input</a> algorithm with <a data-anolis-xref="the document's address" href="dom.html#the-document's-address">the address</a> of the
  <i>relevant <code><a href="dom.html#document">Document</a></code></i> as the given value.</p>

<!--CLEANUP-->
  <p>The object's <code><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a data-anolis-xref="concept-uu-get-the-base" href="infrastructure.html#concept-uu-get-the-base">get the
  base</a> algorithm must return the <a href="webappapis.html#api-base-url">API base URL</a> specified by the <a href="webappapis.html#entry-settings-object">entry
  settings object</a>, if there is one, or null otherwise.</p>

  <p>The object's <code><a href="infrastructure.html#urlutils">URLUtils</a></code> interface's <a data-anolis-xref="concept-uu-query-encoding" href="infrastructure.html#concept-uu-query-encoding">query
  encoding</a> is the <a href="infrastructure.html#document's-character-encoding">document's character encoding</a>.</p>

<!--CLEANUP-->
  <p>When the object's <code><a href="infrastructure.html#urlutils">URLUtils</a></code> interface invokes its <a data-anolis-xref="concept-uu-update" href="infrastructure.html#concept-uu-update">update steps</a> with the string <var data-anolis-xref="">value</var>, the user
  agent must run the following steps:</p>

  <ol><li>

    <p>If any of the following conditions are met, let <var data-anolis-xref="">mode</var> be <i>normal
    navigation</i>; otherwise, let it be <i>replace navigation</i>:</p>

    <ul class="brief"><li>The <code><a href="#location">Location</a></code> object's <i>relevant <code><a href="dom.html#document">Document</a></code></i> has
     <a href="syntax.html#completely-loaded">completely loaded</a>, or</li>

     <li>In the <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in which the algorithm is running, an
     <a href="dom.html#activation-behavior">activation behavior</a> is currently being processed whose <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event was <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>,
     or</li>

     <li>In the <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in which the algorithm is running, the event
     listener for a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> <code data-anolis-xref="event-click"><a href="infrastructure.html#event-click">click</a></code> event is being handled.</li>

    </ul></li>

   <li><p>If <var data-anolis-xref="">mode</var> is <i>normal navigation</i>, then act as if the <code data-anolis-xref="dom-location-assign"><a href="#dom-location-assign">assign()</a></code> method had been called with <var data-anolis-xref="">value</var>
   as its argument. Otherwise, act as if the <code data-anolis-xref="dom-location-replace"><a href="#dom-location-replace">replace()</a></code>
   method had been called with <var data-anolis-xref="">value</var> as its argument.</li>
   <!--DONAV location.href, defined in terms of the paragraphs far above-->

  </ol></div><!--ADD-TOPIC:Security-->




  <div class="impl">

  <h5 id="security-location"><span class="secno">5.5.3.1 </span>Security</h5>

  <p class="critical">This section describes a security model that is underdefined, imperfect, and
  does not match implementations. Work is ongoing to attempt to resolve this, but in the meantime,
  please do not rely on this section for precision. Implementors are urged to send their feedback on
  how cross-origin cross-global access to <code><a href="#window">Window</a></code> and <code><a href="#location">Location</a></code> objects
  should work. See <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20701">bug 20701</a>.</p>

  <p id="security-3">User agents must throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception whenever any
  properties of a <code><a href="#location">Location</a></code> object are accessed when the <a href="webappapis.html#entry-settings-object">entry settings object</a> specifies
  an <a href="#effective-script-origin">effective script origin</a> that is not the <a data-anolis-xref="same origin" href="#same-origin">same</a> as
  the <code><a href="#location">Location</a></code> object's associated <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing
  context</a>'s <a href="#active-document">active document</a>'s <a href="#effective-script-origin">effective script origin</a>, with the
  following exceptions:</p>

  <ul><!--CLEANUP--><li>The <code data-anolis-xref="dom-url-href"><a href="infrastructure.html#dom-url-href">href</a></code> setter, if the <a href="webappapis.html#responsible-browsing-context">responsible browsing context</a>
   specified by the <a href="webappapis.html#entry-settings-object">entry
   settings object</a> is <a href="#familiar-with">familiar with</a> the <a href="#browsing-context">browsing
   context</a> with which the <code><a href="#location">Location</a></code> object is associated

<!--CLEANUP-->
   </li><li>The <code data-anolis-xref="dom-location-replace"><a href="#dom-location-replace">replace()</a></code> method, if the <a href="webappapis.html#responsible-browsing-context">responsible
   browsing context</a> specified by the <a href="webappapis.html#entry-settings-object">entry 
   settings object</a> is <a href="#familiar-with">familiar with</a> the
   <a href="#browsing-context">browsing context</a> with which the <code><a href="#location">Location</a></code> object is associated

<!--CLEANUP-->
   </li><li>Any properties not defined in the IDL for the <code><a href="#location">Location</a></code> object or indirectly via
   one of those properties (e.g. <code data-anolis-xref="">toString()</code>, which is defined via the <code data-anolis-xref="">stringifier</code> keyword), if the <a href="#effective-script-origin">effective script
   origin</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings object</a> is the <a href="#same-origin">same origin</a> as the <code><a href="#location">Location</a></code> object's associated
   <code><a href="dom.html#document">Document</a></code>'s <a href="#effective-script-origin">effective script origin</a>

  </li></ul><p>When the <a href="#effective-script-origin">effective script origin</a> specified by the <a href="webappapis.html#entry-settings-object">entry settings object</a> is different than a
  <code><a href="#location">Location</a></code> object's associated <code><a href="dom.html#document">Document</a></code>'s <a href="#effective-script-origin">effective script
  origin</a>, the user agent must act as if any changes to that <code><a href="#location">Location</a></code> object's
  properties, getters, setters, etc, were not present, and as if all the properties of that
  <code><a href="#location">Location</a></code> object had their [[Enumerable]] attribute set to false.</p>

<!--CLEANUP-->
  <p>For members that return objects (including function objects), each distinct <a href="#effective-script-origin">effective
  script origin</a> that is not the <a href="#same-origin">same origin</a> as the <code><a href="#location">Location</a></code>
  object's <code><a href="dom.html#document">Document</a></code>'s <a href="#effective-script-origin">effective script origin</a> must be provided with a
  separate set of objects. These objects must have the prototype chain appropriate for the script
  for which the objects are created (not those that would be appropriate for scripts whose
  <a href="webappapis.html#settings-object">settings object</a> specifies a <a href="webappapis.html#global-object">global object</a> that is the <code><a href="#location">Location</a></code> object's <code><a href="dom.html#document">Document</a></code>'s
  <code><a href="#window">Window</a></code> object).</p>

  </div><!--REMOVE-TOPIC:Security-->



  <div class="impl">

  <h4 id="history-notes"><span class="secno">5.5.4 </span>Implementation notes for session history</h4>
  <!-- don't change the ID without updating multiple internal links -->

  <p><i>This section is non-normative.</i></p>
  <p>The <code><a href="#history-1">History</a></code> interface is not meant to place restrictions on how implementations
  represent the session history to the user.</p>

  <p>For example, session history could be implemented in a tree-like manner, with each page having
  multiple "forward" pages. This specification doesn't define how the linear list of pages in the
  <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> object are derived from the actual session history as
  seen from the user's perspective.</p>

  <p>Similarly, a page containing two <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>s has a <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> object distinct from the <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>s' <code data-anolis-xref="dom-history"><a href="#dom-history">history</a></code> objects, despite the fact that typical Web browsers present the
  user with just one "Back" button, with a session history that interleaves the navigation of the
  two inner frames and the outer page.</p>

<!--ADD-TOPIC:Security-->
  <p><strong>Security</strong>: It is suggested that to avoid letting a page "hijack" the history
  navigation facilities of a UA by abusing <code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code>,
  the UA provide the user with a way to jump back to the previous page (rather than just going back
  to the previous state). For example, the back button could have a drop down showing just the pages
  in the session history, and not showing any of the states. Similarly, an aural browser could have
  two "back" commands, one that goes back to the previous state, and one that jumps straight back to
  the previous page.</p>

  <p>In addition, a user agent could ignore calls to <code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code> that are invoked on a timer, or from event
  listeners that are not triggered in response to a clear user action, or that are invoked in rapid
  succession.</p>
<!--REMOVE-TOPIC:Security-->

  </div><!--TOPIC:HTML-->



  <h3 id="browsing-the-web"><span class="secno">5.6</span> ウェブを閲覧する</h3>

  <div class="impl">

  <p class="warning">
    Features described in this section can at times prove difficult to test in order to assess
    interoperability. As a result, at present, their test coverage is less than much of the other
    features with all the stability implications this may have.
  </p>


  <h4 id="navigating-across-documents"><span class="secno">5.6.1 </span>Navigating across documents</h4>

  <p>Certain actions cause the <a href="#browsing-context">browsing context</a> to <i><a href="#navigate">navigate</a></i> to a new resource.
  A user agent may provide various ways for the user to explicitly cause a browsing context to
  navigate, in addition to those defined in this specification.</p>

  <p class="example">For example, <a data-anolis-xref="following hyperlinks" href="links.html#following-hyperlinks">following a hyperlink</a>,
  <a data-anolis-xref="concept-form-submit" href="forms.html#concept-form-submit">form submission</a>, and the <code data-anolis-xref="dom-open"><a href="#dom-open">window.open()</a></code> and <code data-anolis-xref="dom-location-assign"><a href="#dom-location-assign">location.assign()</a></code> methods can all cause a browsing context to
  navigate.</p>

  <p class="note">A <i>resource</i> has a URL, but that might not be the only information necessary
  to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method
  and payload. Similarly, <a href="embedded-content-0.html#an-iframe-srcdoc-document">an <code>iframe</code> <code data-anolis-xref="attr-iframe-srcdoc">srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Navigation always involves <dfn id="source-browsing-context">source browsing context</dfn>, which is the browsing context which
  was responsible for starting the navigation.</p>

  <!-- NAVIGATE <dfn>navigate</dfn> -->
  <!-- For places that _call_ this, as opposed to just referring to
  it, search for "DONAV" -->
  <p>When a browsing context is <dfn data-anolis-xref="navigate" id="navigate">navigated</dfn> to a new resource, the user
  agent must run the following steps:</p>

  <ol><li><p>Release the <a href="webappapis.html#storage-mutex">storage mutex</a>.</li>

   <li id="sandboxLinks">

    <p>If the <a href="#source-browsing-context">source browsing context</a> is not <a href="#allowed-to-navigate">allowed to navigate</a> the
    <a href="#browsing-context">browsing context</a> being navigated, then abort these steps.</p>

    <p>If these steps are aborted here, the user agent may instead offer to open the new resource in
    a new <a href="#top-level-browsing-context">top-level browsing context</a> or in the <a href="#top-level-browsing-context">top-level browsing context</a>
    of the <a href="#source-browsing-context">source browsing context</a>, at the user's option, in which case the user agent
    must <a href="#navigate">navigate</a><!--DONAV sandbox manual load--> that designated <a href="#top-level-browsing-context">top-level
    browsing context</a> to the new resource as if the user had requested it independently.</p>

    <p class="note">Doing so, however, can be dangerous, as it means that the user is overriding the
    author's explicit request to sandbox the content.</p>

    <p>If the <a href="#navigate">navigate</a> algorithm was invoked with <dfn id="exceptions-enabled">exceptions enabled</dfn>, and it
    is aborted on this step, then in addition to aborting this algorithm, the user agent must also
    throw a <code><a href="infrastructure.html#securityerror">SecurityError</a></code> exception.</p>

   </li>

   <li><p>If there is a preexisting attempt to navigate the <a href="#browsing-context">browsing context</a>, and the
   <a href="#source-browsing-context">source browsing context</a> is the same as the <a href="#browsing-context">browsing context</a> being
   navigated, and that attempt is currently running the <a href="#unload-a-document">unload a document</a> algorithm,
   and the <a href="#origin-0">origin</a> of the <a href="infrastructure.html#url">URL</a> of the resource being loaded in that
   navigation is not the <a href="#same-origin">same origin</a> as the <a href="#origin-0">origin</a> of the <a href="infrastructure.html#url">URL</a>
   of the resource being loaded in <em>this</em> navigation, then abort these steps without
   affecting the preexisting attempt to navigate the <a href="#browsing-context">browsing context</a>.</li> <!--
   http://www.hixie.ch/tests/adhoc/html/navigation/unload/ -->

   <li><p>If a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> queued by the <a href="#traverse-the-history-by-a-delta">traverse the history by a
   delta</a> algorithm is running the <a href="#unload-a-document">unload a document</a> algorithm for the
   <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="#unload-a-document">unload a document</a> algorithm or the aforementioned
   history traversal task.</li> <!-- this stops pages from hijacking the back/forward button -->

   <li><p>If the <a href="#prompt-to-unload-a-document">prompt to unload a document</a> algorithm is being run for the
   <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a> being navigated, then abort
   these steps without affecting the <a href="#prompt-to-unload-a-document">prompt to unload a document</a> algorithm.</li>
   <!-- http://software.hixie.ch/utilities/js/live-dom-viewer/saved/1946 to 1955 -->

   <li>

    <p>Let <var data-anolis-xref="">gone async</var> be false.</p>

    <p class="note">The <a href="#navigate-redirect-step"><i>handle redirects</i></a> step later in
    this algorithm can in certain cases jump back to the step labeled <a href="#navigate-fragid-step"><i>fragment identifiers</i></a>. Since, between those two steps,
    this algorithm goes from operating synchronously in the context of the calling <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to operating asynchronously independent of the <a href="webappapis.html#event-loop">event
    loop</a>, some of the intervening steps need to be able to handle both being synchronous and
    being asynchronous. The <var data-anolis-xref="">gone async</var> flag is thus used to make these steps
    aware of which mode they are operating in.</p>

   </li>

   <li id="navigate-fragid-step"><p><i>Fragment identifiers</i>: Apply the <a href="infrastructure.html#url-parser">URL parser</a>
   algorithm to the <a href="infrastructure.html#absolute-url">absolute URL</a> of the new resource and the <a data-anolis-xref="the
   document's address" href="dom.html#the-document's-address">address</a> of the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing
   context</a> being navigated. If all the components of the resulting <a data-anolis-xref="parsed
   URL" href="infrastructure.html#parsed-url">parsed URLs</a>, ignoring any <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a>
   components, are identical, and the new resource is to be fetched using HTTP GET <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>, and the <a href="infrastructure.html#parsed-url">parsed URL</a> of the
   new resource has a <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a> component that is not null
   (even if it is empty), then <a data-anolis-xref="navigate-fragid" href="#scroll-to-fragid">navigate to that fragment
   identifier</a> and abort these steps.</li>

   <li><p>If <var data-anolis-xref="">gone async</var> is false, cancel any preexisting but not yet <a data-anolis-xref="concept-navigate-mature" href="#concept-navigate-mature">mature</a> attempt to navigate the <a href="#browsing-context">browsing
   context</a>, including canceling any instances of the <a href="infrastructure.html#fetch">fetch</a> algorithm started by
   those attempts. If one of those attempts has already <a data-anolis-xref="create a document
   object" href="#create-a-document-object">created a new <code>Document</code> object</a>, <a data-anolis-xref="abort a
   document" href="#abort-a-document">abort</a> that <code><a href="dom.html#document">Document</a></code> also. (Navigation attempts that have <a data-anolis-xref="concept-navigate-mature" href="#concept-navigate-mature">matured</a> already have session history entries, and are
   therefore handled during the <a href="#update-the-session-history-with-the-new-page">update the session history with the new page</a> algorithm,
   later.)</li>

   <li><p>If the new resource is to be handled using a mechanism that does not affect the browsing
   context, e.g. ignoring the navigation request altogether because the specified scheme is not one
   of the supported protocols, then abort these steps and proceed with that mechanism
   instead.</li>

   <li>

    <p>If <var data-anolis-xref="">gone async</var> is false, <a data-anolis-xref="prompt to unload a document" href="#prompt-to-unload-a-document">prompt
    to unload</a> the <code><a href="dom.html#document">Document</a></code> object. If the user <a href="#refused-to-allow-the-document-to-be-unloaded">refused to allow the
    document to be unloaded</a>, then abort these steps.</p>

    <p>If this instance of the <a data-anolis-xref="navigate" href="#navigate">navigation</a> algorithm gets canceled
    while this step is running, the <a href="#prompt-to-unload-a-document">prompt to unload a document</a> algorithm must
    nonetheless be run to completion.</p>

   </li>

   <li><p>If <var data-anolis-xref="">gone async</var> is false, <a data-anolis-xref="abort a document" href="#abort-a-document">abort</a>
   the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a>.</li>

   <li>

    <p>If the new resource is to be handled by displaying some sort of inline content, e.g. an error
    message because the specified scheme is not one of the supported protocols, or an inline prompt
    to allow the user to select <a data-anolis-xref="dom-navigator-registerProtocolHandler" href="webappapis.html#dom-navigator-registerprotocolhandler">a registered
    handler</a> for the given scheme, then <a data-anolis-xref="navigate-ua-inline" href="#read-ua-inline">display the inline
    content</a> and abort these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li>

   <li>

    <p>If the <a href="#browsing-context">browsing context</a> being navigated is a <a href="#nested-browsing-context">nested browsing
    context</a>, then put it in the <a href="#delaying-load-events-mode">delaying <code data-anolis-xref="event-load">load</code> events
    mode</a>.</p>

    <p>The user agent must take this <a href="#nested-browsing-context">nested browsing context</a> out of the <a href="#delaying-load-events-mode">delaying
    <code data-anolis-xref="event-load">load</code> events mode</a> when this <a data-anolis-xref="navigate" href="#navigate">navigation</a> algorithm later <a data-anolis-xref="concept-navigate-mature" href="#concept-navigate-mature">matures</a>, or when it terminates (whether due to having
    run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    <!-- this is what makes <iframe> elements delay the load event of their parent browsing context
    when their child browsing context is in between this step and the step that starts the parser. -->

   </li>

   <li>

    <p>This is the step that attempts to obtain the resource, if necessary. Jump to the first
    appropriate substep:</p>

    <dl><dt>If the resource has already been obtained (e.g. because it is being used to populate an
     <code><a href="embedded-content-0.html#the-object-element">object</a></code> element's new <a href="#child-browsing-context">child browsing context</a>)</dt>

     <dd><p>Skip this step. The data is already available.</dd>

     <dt>If the new resource is a <a href="infrastructure.html#url">URL</a> whose <a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a> is <code data-anolis-xref="javascript
     protocol"><a href="#javascript-protocol">javascript</a></code></dt>

     <dd>

      <!-- http://www.hixie.ch/tests/adhoc/html/navigation/javascript-url/ -->

      <p><a href="webappapis.html#queue-a-task">Queue a task</a> to run <dfn data-anolis-xref="javascript protocol" id="javascript-protocol">these "<code data-anolis-xref="">javascript:</code> URL" steps</dfn>, associated with the <a href="#active-document">active
      document</a> of the <a href="#browsing-context">browsing context</a> being navigated:</p>

      <ol id="concept-js-deref"><li><p>If the <a href="#origin-0">origin</a> of the <a href="#source-browsing-context">source browsing context</a> is not the
       <a href="#same-origin">same origin</a> as the <a href="#origin-0">origin</a> of the <a href="#active-document">active document</a> of
       the <a href="#browsing-context">browsing context</a> being navigated, then act as if the result of evaluating
       the script was the void value, and jump to the step labeled <i>process results</i>
       below.</li>

       <li><p>Apply the <a href="infrastructure.html#url-parser">URL parser</a> to the <a href="infrastructure.html#url">URL</a> being navigated.</li>

       <li><p>Let <var data-anolis-xref="">parsed URL</var> be the result of the <a href="infrastructure.html#url-parser">URL
       parser</a>.</li>

       <li><p>Let <var data-anolis-xref="">script source</var> be the empty string.</li>

       <li><p>Append <var data-anolis-xref="">parsed URL</var>'s <a data-anolis-xref="concept-url-scheme-data" href="infrastructure.html#concept-url-scheme-data">scheme
       data</a> component to <var data-anolis-xref="">script source</var>.</li>

       <li><p>If <var data-anolis-xref="">parsed URL</var>'s <a data-anolis-xref="concept-url-query" href="infrastructure.html#concept-url-query">query</a>
       component is not null, then first append a "?" (U+003F) character to <var data-anolis-xref="">script source</var>, and then append <var data-anolis-xref="">parsed URL</var>'s <a data-anolis-xref="concept-url-query" href="infrastructure.html#concept-url-query">query</a> component to <var data-anolis-xref="">script
       source</var>.</li>

<!--CLEANUP-->
       <li><p>If <var data-anolis-xref="">parsed URL</var>'s <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a> component is not null, then first append a
       "#" (U+0023) character to <var data-anolis-xref="">script source</var>, and then append
       <var data-anolis-xref="">parsed URL</var>'s <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a>
       component to <var data-anolis-xref="">script source</var>.</li>

       <li><p>Replace <var data-anolis-xref="">script source</var> with the result of applying the
       <a href="infrastructure.html#percent-decode">percent decode</a> algorithm to <var data-anolis-xref="">script source</var>.</li>

       <li><p>Replace <var data-anolis-xref="">script source</var> with the result of applying the <a href="infrastructure.html#utf-8-decode">UTF-8
       decode</a> algorithm to <var data-anolis-xref="">script source</var>.</li>

       <!-- <body onload="&#xFFFE;w('test')"> and javascript:%EF%BB%BF'test' both work, so we assume
            that JavaScript is stripping the BOM, and we don't have to -->

       <!--
         http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2639 -> about:blank
         http://software.hixie.ch/utilities/js/live-dom-viewer/saved/2640 -> javascript:'test' in Firefox, about:blank otherwise
       -->
       <li><p>Let <var data-anolis-xref="">address</var> be the <a data-anolis-xref="the document's
       address" href="dom.html#the-document's-address">address</a> of the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing
       context</a> being navigated.</li>

       <li>

        <p><a href="webappapis.html#create-a-script">Create a script</a>, using <var data-anolis-xref="">script source</var> as the script
        source, <var data-anolis-xref="">address</var> as the script source URL, JavaScript as the scripting
        language, and the <a href="webappapis.html#script-settings-object">script settings object</a> of the <code><a href="#window">Window</a></code> object of
        the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing context</a> being navigated.</p>

        <p>Let <var data-anolis-xref="">result</var> be the return value of the <a href="webappapis.html#code-entry-point">code entry-point</a>
        of this <a data-anolis-xref="concept-script" href="webappapis.html#concept-script">script</a>. If an exception was thrown, let <var data-anolis-xref="">result</var> be void instead. (The result will be void also if <a data-anolis-xref="concept-bc-noscript" href="webappapis.html#concept-bc-noscript">scripting is disabled</a>.)</p>

       </li>

       <li>

        <p><i>Process results</i>: If the result of executing the script is void (there is no return
        value), then the result of obtaining the resource for the URL is <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">equivalent to</a> an HTTP resource with an HTTP
        204 No Content response.</p>

        <p>Otherwise, the result of obtaining the resource for the URL is <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">equivalent</a> to an HTTP resource with a 200 OK
        response whose <a data-anolis-xref="Content-Type" href="infrastructure.html#content-type">Content-Type metadata</a> is
        <code><a href="iana.html#text/html">text/html</a></code> and whose response body is the return value converted to a string
        value.</p>

        <p>When it comes time to <a href="#set-the-document's-address">set the document's address</a> in the <a data-anolis-xref="navigate" href="#navigate">navigation algorithm</a>, use <var data-anolis-xref="">address</var> as the
        <a href="#override-url">override URL</a>.</p>

       </li>

      </ol><p>The <a href="webappapis.html#task-source">task source</a> for this <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> is the
      <a href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a>.</p>

      <div class="example">

       <p>So for example a <a data-anolis-xref="javascript protocol" href="#javascript-protocol"><code data-anolis-xref="">javascript:</code>
       URL</a> in an <code data-anolis-xref="attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> attribute of an
       <code><a href="text-level-semantics.html#the-a-element">a</a></code> element would only be evaluated when the link was <a data-anolis-xref="following
       hyperlinks" href="links.html#following-hyperlinks">followed</a>, while such a URL in the <code data-anolis-xref="attr-iframe-src"><a href="embedded-content-0.html#attr-iframe-src">src</a></code> attribute of an <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code> element would be
       evaluated in the context of the <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>'s own <a href="#nested-browsing-context">nested browsing
       context</a> when the <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code> is being set up; once evaluated, its return value
       (if it was not void) would replace that <a href="#browsing-context">browsing context</a>'s document, thus also
       changing the <code><a href="#window">Window</a></code> object of that <a href="#browsing-context">browsing context</a>.</p>

      </div>

     </dd>

     <dt>If the new resource is to be fetched using HTTP GET <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>, and there are <a data-anolis-xref="relevant
     application cache" href="#relevant-application-cache">relevant application caches</a> that are identified by a URL with the
     <a href="#same-origin">same origin</a> as the URL in question, and that have this URL as one of their
     entries, excluding entries marked as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>,
     and whose <a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">mode</a> is <a data-anolis-xref="concept-appcache-mode-fast" href="#concept-appcache-mode-fast">fast</a>, and the user agent is not in a mode where it
     will avoid using <a data-anolis-xref="application cache" href="#application-cache">application caches</a></dt>

     <dd>

      <p><a href="infrastructure.html#fetch">Fetch</a> the resource from the <a data-anolis-xref="concept-appcache-selection" href="#concept-appcache-selection">most
      appropriate application cache</a> of those that match.</p>

      <p class="example">For example, imagine an HTML page with an associated application cache
      displaying an image and a form, where the image is also used by several other application
      caches. If the user right-clicks on the image and chooses "View Image", then the user agent
      could decide to show the image from any of those caches, but it is likely that the most useful
      cache for the user would be the one that was used for the aforementioned HTML page. On the
      other hand, if the user submits the form, and the form does a POST submission, then the user
      agent will not use an application cache at all; the submission will be made to the
      network.</p>

     </dd>

     <dt>Otherwise</dt>

     <dd>

      <p><a href="infrastructure.html#fetch">Fetch</a><!--FETCH--> the new resource, with the <i>manual redirect flag</i>
      set.</p>

     </dd>

    </dl><p>If the steps above invoked the <a href="infrastructure.html#fetch">fetch</a> algorith, the following requirements also
    apply:</p>

    <p>If the resource is being fetched using a method other than one <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">equivalent to</a> HTTP's GET<!-- or HEAD (but that can't
    happen) -->, or, if the <a data-anolis-xref="navigate" href="#navigate">navigation algorithm</a> was invoked as a
    result of the <a data-anolis-xref="concept-form-submit" href="forms.html#concept-form-submit">form submission algorithm</a>, then the
    <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching algorithm</a> must be invoked from the <a href="#origin-0">origin</a> of
    the <a href="#active-document">active document</a> of the <a href="#source-browsing-context">source browsing context</a>, if any.</p> <!--
    potentially http-origin privacy sensitive -->

    <p>Otherwise, if the <a href="#browsing-context">browsing context</a> being navigated is a <a href="#child-browsing-context">child browsing
    context</a>, then the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching algorithm</a> must be invoked from the
    <a href="#browsing-context-scope-origin">browsing context scope origin</a> of the <a href="#browsing-context-container">browsing context container</a> of the
    <a href="#browsing-context">browsing context</a> being navigated, if it has one.</p> <!-- potentially http-origin
    privacy sensitive -->

   </li>

   <li>

    <!-- *********************************** ASYNC BOUNDARY *********************************** -->

    <p>If <var data-anolis-xref="">gone async</var> is false, return to whatever algorithm invoked the
    navigation steps and continue running these steps asynchronously.</p>

   </li>

   <li><p>Let <var data-anolis-xref="">gone async</var> be true.</li>

   <li id="navigate-redirect-step">

    <!--CLEANUP-->
    <p><i>Handle redirects</i>: If fetching the resource results in a redirect, and either the <a href="infrastructure.html#url">URL</a> of the target
    of the redirect has the <a href="#same-origin">same origin</a> as the original resource, or the resource is
    being obtained using the POST method or a safe method (in HTTP terms), return to <a href="#navigate-fragid-step">the step labeled <i>fragment identifiers</i></a> with the new
    resource, except that if the <a href="infrastructure.html#url">URL</a> of the target of the redirect does not have a
    fragment identifier and the <a href="infrastructure.html#url">URL</a> of the resource that led to the redirect does, then
    the fragment identifier of the resource that led to the redirect must be propagated to the
    <a href="infrastructure.html#url">URL</a> of the target of the redirect.</p>

    <p class="example">So for instance, if the original URL was "<code data-anolis-xref="">http://example.com/#!sample</code>" and "<code data-anolis-xref="">http://example.com/</code>" is
    found to redirect to "<code data-anolis-xref="">https://example.com/</code>", the URL of the new resource
    will be "<code data-anolis-xref="">https://example.com/#!sample</code>".</p>

    <p>Otherwise, if fetching the resource results in a redirect but the <a href="infrastructure.html#url">URL</a> of the
    target of the redirect does not have the <a href="#same-origin">same origin</a> as the original resource and
    the resource is being obtained using a method that is neither the POST method nor a safe method
    (in HTTP terms), then abort these steps. The user agent may indicate to the user that the
    navigation has been aborted for security reasons.</p>

   </li>

   <!--CLEANUP: should move this step to above the "handle redirects" step-->
   <li><p>Wait for one or more bytes to be available or for the user agent to establish that the
   resource in question is empty. During this time, the user agent may allow the user to cancel this
   navigation attempt or start other navigation attempts.</li>

   <li>

    <p><strong>Fallback in prefer-online mode</strong>: If the resource was not fetched from an
    <a href="#application-cache">application cache</a>, and was to be fetched using HTTP GET <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>, and there are <a data-anolis-xref="relevant
    application cache" href="#relevant-application-cache">relevant application caches</a> that are identified by a URL with the
    <a href="#same-origin">same origin</a> as the URL in question, and that have this URL as one of their entries,
    excluding entries marked as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>, and whose
    <a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">mode</a> is <a data-anolis-xref="concept-appcache-mode-prefer-online" href="#concept-appcache-mode-prefer-online">prefer-online</a>, and the user didn't cancel the
    navigation attempt during the earlier step, and the navigation attempt failed (e.g. the server
    returned a 4xx or 5xx status code <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or
    equivalent</a>, or there was a DNS error), then:</p>

    <p>Let <var data-anolis-xref="">candidate</var> be the resource identified by the URL in question from the
    <a data-anolis-xref="concept-appcache-selection" href="#concept-appcache-selection">most appropriate application cache</a> of those that
    match.</p> <!-- note that a redirect can never reach this point as it is handled earlier,
    meaning that a captive portal captures URLs in "prefer-online" caches and you can't ever get to
    the cached resource of a prefer-online cache if you have a captive portal -->

    <p>If <var data-anolis-xref="">candidate</var> is not marked as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var data-anolis-xref="">candidate</var> as the resource.
    The user agent may indicate to the user that the original page load failed, and that the page
    used was a previously cached resource.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="dom.html#the-document's-referrer">the document's referrer</a> in the <a href="#create-a-document-object">create a Document
    object</a> steps below; they still use the value as computed by the original
    <a href="infrastructure.html#fetch">fetch</a> algorithm.</p>

   </li>

   <li>

    <p><strong>Fallback for fallback entries</strong>: If the resource was not fetched from an
    <a href="#application-cache">application cache</a>, and was to be fetched using HTTP GET <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>, and its URL <a data-anolis-xref="concept-appcache-matches-fallback" href="#concept-appcache-matches-fallback">matches the fallback namespace</a> of one or more
    <a data-anolis-xref="relevant application cache" href="#relevant-application-cache">relevant application caches</a>, and the <a data-anolis-xref="concept-appcache-selection" href="#concept-appcache-selection">most appropriate application cache</a> of those that match
    does not have an entry in its <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online
    whitelist</a> that has the <a href="#same-origin">same origin</a> as the resource's URL and that is a
    <a href="infrastructure.html#prefix-match">prefix match</a> for the resource's URL, and the user didn't cancel the navigation
    attempt during the previous step, and the navigation attempt failed (e.g. the server returned a
    4xx or 5xx status code <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or
    there was a DNS error), then:</p> <!-- note that a redirect can never reach this point as it is
    handled earlier, meaning that a captive portal captures URLs in fallback namespaces and you
    can't ever get to the fallback file of a resource if you have a captive portal -->

    <p>Let <var data-anolis-xref="">candidate</var> be the <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback
    resource</a> specified for the <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback
    namespace</a> in question. If multiple application caches match, the user agent must use the
    fallback of the <a data-anolis-xref="concept-appcache-selection" href="#concept-appcache-selection">most appropriate application
    cache</a> of those that match.</p>

    <p>If <var data-anolis-xref="">candidate</var> is not marked as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>, then the user agent must discard the failed
    load and instead continue along these steps using <var data-anolis-xref="">candidate</var> as the resource.
    <a href="dom.html#the-document's-address">The document's address</a>, if appropriate, will still be the originally requested URL,
    not the fallback URL, but the user agent may indicate to the user that the original page load
    failed, that the page used was a fallback resource, and what the URL of the fallback resource
    actually is.</p>

    <p class="note">This does not affect the <i>address of the resource from which Request-URIs are
    obtained</i>, as used to set <a href="dom.html#the-document's-referrer">the document's referrer</a> in the <a href="#create-a-document-object">create a Document
    object</a> steps below; they still use the value as computed by the original
    <a href="infrastructure.html#fetch">fetch</a> algorithm.</p>

   </li>

   <li>

    <p><i>Resource handling</i>: If the resource's out-of-band metadata (e.g. HTTP headers), not
    counting any <a data-anolis-xref="Content-Type" href="infrastructure.html#content-type">type information</a> (such as the Content-Type HTTP
    header), requires some sort of processing that will not affect the browsing context, then
    perform that processing and abort these steps.</p>

    <div class="note">
     <p>Such processing might be triggered by, amongst other things, the following:</p>
     <ul class="brief"><li>HTTP status codes (e.g. 204 No Content or 205 Reset Content)</li>
      <li>Network errors (e.g. the network interface being unavailable)</li>
      <li>Cryptographic protocol failures (e.g. an incorrect TLS certificate)</li>
      <!-- Other schemes are handled earlier -->
      <!-- Content-Disposition is handled below -->
      <!-- Content-Type is handled in subsequent steps -->
      <!-- ...and I can't think of any others. -->
     </ul></div>

    <p>Responses with HTTP <code data-anolis-xref="http-content-disposition">Content-Disposition</code> headers
    specifying the <code data-anolis-xref="">attachment</code> disposition type must be handled <a href="links.html#as-a-download">as a
    download</a>.</p>

    <!-- theoretically, HTTP 205 processing would occur here, resetting all forms with no other
    effect. However, it seems nobody actually wants to use this ability, so requiring it here seems
    like unnecessary work. -->

    <p>HTTP 401 responses that do not include a challenge recognized by the user agent must be
    processed as if they had no challenge, e.g. rendering the entity body as if the response had
    been 200 OK.</p>

    <p>User agents may show the entity body of an HTTP 401 response even when the response does
    include a recognized challenge, with the option to login being included in a non-modal fashion,
    to enable the information provided by the server to be used by the user before authenticating.
    Similarly, user agents should allow the user to authenticate (in a non-modal fashion) against
    authentication challenges included in other responses such as HTTP 200 OK responses, effectively
    allowing resources to present HTTP login forms without requiring their use.</p>

   </li>

   <li><p>Let <var data-anolis-xref="">type</var> be <a data-anolis-xref="Content-Type sniffing" href="infrastructure.html#content-type-sniffing-0">the sniffed type of
   the resource</a>.</li>

   <li><p>If the user agent has been configured to process resources of the given <var data-anolis-xref="">type</var> using some mechanism other than rendering the content in a <a href="#browsing-context">browsing
   context</a>, then skip this step. Otherwise, if the <var data-anolis-xref="">type</var> is one of the
   following types, jump to the appropriate entry in the following list, and process the resource as
   described there:</p>

    <dl class="switch"><!-- an <span>HTML MIME type</span> --><dt>"<code><a href="iana.html#text/html">text/html</a></code>"</dt>
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-html" href="#read-html">HTML document</a> section,
     and then, once they have completed, abort this <a href="#navigate">navigate</a> algorithm.</dd>

     <!-- an <span>XML MIME type</span> -->
     <dt>"<code>application/xml</code>"</dt>
     <dt>"<code>text/xml</code>"</dt>
     <dt>"<code>image/svg+xml</code>"</dt>
     <dt>"<code><a href="iana.html#application/xhtml+xml">application/xhtml+xml</a></code>"</dt>
     <dt>Any other type ending in "<code data-anolis-xref="">+xml</code>" that is not an <a href="#explicitly-supported-xml-type">explicitly
     supported XML type</a></dt> <!-- no need to say that the _subtype_ ends in "+xml" so long as
     the "sniffed type" algorithm continues to drop parameters -->
<!--CLEANUP-->
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-xml" href="#read-xml">XML document</a> section. If
     that section determines that the content is <em>not</em> to be displayed as a generic XML
     document, then proceed to the next step in this overall set of steps. Otherwise, once the steps given in the <a data-anolis-xref="navigate-xml" href="#read-xml">XML document</a> section have completed,
     abort this <a href="#navigate">navigate</a> algorithm.</dd>

     <dt>"<code>text/plain</code>"</dt>
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-text" href="#read-text">plain text file</a> section,
     and then, once they have completed, abort this <a href="#navigate">navigate</a> algorithm.</dd>

     <dt>"<code><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code>"</dt>
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-multipart-x-mixed-replace" href="#read-multipart-x-mixed-replace">multipart/x-mixed-replace</a> section, and then,
     once they have completed, abort this <a href="#navigate">navigate</a> algorithm.</dd>

     <dt>A supported image, video, or audio type</dt>
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-media" href="#read-media">media</a> section, and then,
     once they have completed, abort this <a href="#navigate">navigate</a> algorithm.</dd>

     <dt>A type that will use an external application to render the content in the <a href="#browsing-context">browsing
     context</a></dt>
     <dd>Follow the steps given in the <a data-anolis-xref="navigate-plugin" href="#read-plugin">plugin</a> section, and then,
     once they have completed, abort this <a href="#navigate">navigate</a> algorithm.</dd>

    </dl><p>An <dfn id="explicitly-supported-xml-type">explicitly supported XML type</dfn> is one for which the user agent is configured to
    use an external application to render the content (either a <a href="infrastructure.html#plugin">plugin</a> rendering
    directly in the <a href="#browsing-context">browsing context</a>, or a separate application), or one for which the
    user agent has dedicated processing rules (e.g. a Web browser with a built-in Atom feed viewer
    would be said to explicitly support the <code>application/atom+xml</code> MIME type), or one for
    which the user agent has a dedicated handler (e.g. one registered using <code data-anolis-xref="dom-navigator-registerContentHandler"><a href="webappapis.html#dom-navigator-registercontenthandler">registerContentHandler()</a></code>).</p>

    <p><dfn data-anolis-xref="set the document's address" id="set-the-document's-address">Setting the document's address</dfn>: If there is no
    <dfn id="override-url">override URL</dfn>, then any <code><a href="dom.html#document">Document</a></code> created by these steps must have its
    <a data-anolis-xref="the document's address" href="dom.html#the-document's-address">address</a> set to the <a href="infrastructure.html#url">URL</a> that was
    originally to be <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetched</a>, ignoring any other data that was used to
    obtain the resource (e.g. the entity body in the case of a POST submission is not part of
    <a href="dom.html#the-document's-address">the document's address</a>, nor is the URL of the fallback resource in the case of the
    original load having failed and that URL having been found to match a <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a>). However, if there <em>is</em>
    an <a href="#override-url">override URL</a>, then any <code><a href="dom.html#document">Document</a></code> created by these steps must have
    its <a data-anolis-xref="the document's address" href="dom.html#the-document's-address">address</a> set to that <a href="infrastructure.html#url">URL</a>
    instead.</p>

    <p class="note">An <a data-anolis-xref="override URL" href="#override-url">override URL</a> is set when <a data-anolis-xref="javascript protocol" href="#javascript-protocol">dereferencing a <code>javascript:</code> URL</a> and when
    performing <a href="dom.html#an-overridden-reload">an overridden reload</a>.</p>

    <p><dfn data-anolis-xref="create a Document object" id="create-a-document-object">Creating a new <code>Document</code> object</dfn>: when
    a <code><a href="dom.html#document">Document</a></code> is created as part of the above steps, the user agent must additionally
    run the following algorithm as part of creating the new object:</p>

    <ol><li><p>Create a new <code><a href="#window">Window</a></code> object, and associate it with the
     <code><a href="dom.html#document">Document</a></code>, with one exception: if the <a href="#browsing-context">browsing context</a>'s only entry in
     its <a href="#session-history">session history</a> is the <code><a href="infrastructure.html#about:blank">about:blank</a></code> <code><a href="dom.html#document">Document</a></code> that was
     added when the <a href="#browsing-context">browsing context</a> was created, and navigation is occurring with
     <a href="#replacement-enabled">replacement enabled</a>, and that <code><a href="dom.html#document">Document</a></code> has the <a href="#same-origin">same
     origin</a> as the new <code><a href="dom.html#document">Document</a></code>, then use the <code><a href="#window">Window</a></code> object of that
     <code><a href="dom.html#document">Document</a></code> instead, and change the <code data-anolis-xref="dom-document"><a href="#dom-document-0">document</a></code>
     attribute of the <code><a href="#window">Window</a></code> object to point to the new <code><a href="dom.html#document">Document</a></code>.</p>

     </li><li><p>Set <a href="dom.html#the-document's-referrer">the document's referrer</a> to the <i>address of the resource from which
     Request-URIs are obtained</i> as determined when the <a href="infrastructure.html#fetch">fetch</a> algorithm obtained the
     resource, if that algorithm was used and determined such a value; otherwise, set it to the
     empty string.</li>

     <li><p><a href="#implement-the-sandboxing">Implement the sandboxing</a> for the <code><a href="dom.html#document">Document</a></code>.</li>

     <li id="fullscreen-logic">

      <p>If the <a href="#active-sandboxing-flag-set">active sandboxing flag set</a> of the <code><a href="dom.html#document">Document</a></code>'s
      <a href="#browsing-context">browsing context</a> or any of its <a data-anolis-xref="ancestor browsing context" href="#ancestor-browsing-context">ancestor
      browsing contexts</a> (if any) have the <a href="#sandboxed-fullscreen-browsing-context-flag">sandboxed fullscreen browsing context
      flag</a> set, then skip this step.</p>

      <p>If the <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing context</a> has a <a href="#browsing-context-container">browsing context
      container</a> and either it is not an <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code> element, or its
      <code><a href="dom.html#document">Document</a></code> does not have the <a href="infrastructure.html#fullscreen-enabled-flag">fullscreen enabled flag</a> set, then also
      skip this step.</p>

      <p>Otherwise, set the <code><a href="dom.html#document">Document</a></code>'s <a href="infrastructure.html#fullscreen-enabled-flag">fullscreen enabled flag</a>.</p>

    </li></ol></li>

   <li id="navigate-non-Document">

<!--CLEANUP-->
    <p><i>Non-document content</i>: If, given <var data-anolis-xref="">type</var>, the new resource is to be
    handled by displaying some sort of inline content, e.g. a native rendering of the content, an
    error message because the specified type is not supported, or an inline prompt to allow the user
    to select <a data-anolis-xref="dom-navigator-registerContentHandler" href="webappapis.html#dom-navigator-registercontenthandler">a registered handler</a> for the
    given type, then <a data-anolis-xref="navigate-ua-inline" href="#read-ua-inline">display the inline content</a>, and then abort
    these steps.</p>

    <p class="note">In the case of a registered handler being used, the algorithm will be reinvoked
    with a new URL to handle the request.</p>

   </li>

   <li><p>Otherwise, the document's <var data-anolis-xref="">type</var> is such that the resource will not
   affect the browsing context, e.g. because the resource is to be handed to an external application
   or because it is an unknown type that will be processed <a href="links.html#as-a-download">as a download</a>. Process the
   resource appropriately.</p>

  </li></ol><hr><p>Some of the sections below, to which the above algorithm defers in certain cases, require the
  user agent to <dfn id="update-the-session-history-with-the-new-page">update the session history with the new page</dfn>. When a user agent is
  required to do this, it must <a href="webappapis.html#queue-a-task">queue a task</a> (associated with the <code><a href="dom.html#document">Document</a></code>
  object of the <a href="#current-entry">current entry</a>, not the new one) to run the following steps:</p>

  <ol><li>

    <p><a data-anolis-xref="unload a document" href="#unload-a-document">Unload</a> the <code><a href="dom.html#document">Document</a></code> object of the
    <a href="#current-entry">current entry</a>, with the <var data-anolis-xref="">recycle</var> parameter set to false.</p>

    <p>If this instance of the <a data-anolis-xref="navigate" href="#navigate">navigation</a> algorithm is canceled while
    this step is running the <a href="#unload-a-document">unload a document</a> algorithm, then the <a href="#unload-a-document">unload a
    document</a> algorithm must be allowed to run to completion, but this instance of the <a data-anolis-xref="navigate" href="#navigate">navigation</a> algorithm must not run beyond this step. (In particular, for
    instance, the cancelation of this algorithm does not abort any event dispatch or script
    execution occurring as part of unloading the document or its descendants.)</p>

   </li>

   <li>

    <dl><dt>If the navigation was initiated for <dfn id="entry-update">entry update</dfn> of an entry</dt>

     <dd>

      <ol><li><p>Replace the <code><a href="dom.html#document">Document</a></code> of the entry being updated, and any other entries
       that referenced the same document as that entry, with the new <code><a href="dom.html#document">Document</a></code>.</li>

       <li><p><a href="#traverse-the-history">Traverse the history</a> to the new entry.</li>

      </ol><p class="note">This can only happen if the entry being updated is not the <a href="#current-entry">current
      entry</a>, and can never happen with <a href="#replacement-enabled">replacement enabled</a>. (It happens when the
      user tried to traverse to a session history entry that no longer had a <code><a href="dom.html#document">Document</a></code>
      object.)</p>

     </dd>


     <dt>Otherwise</dt>

     <dd>

      <ol><li>

        <p>Remove all the entries in the <a href="#browsing-context">browsing context</a>'s <a href="#session-history">session
        history</a> after the <a href="#current-entry">current entry</a>. If the <a href="#current-entry">current entry</a> is
        the last entry in the session history, then no entries are removed.</p>

        <p class="note">This <a href="#history-notes">doesn't necessarily have to affect</a> the
        user agent's user interface.</p>

       </li>

       <li><p>Append a new entry at the end of the <code><a href="#history-1">History</a></code> object representing the new
       resource and its <code><a href="dom.html#document">Document</a></code> object and related state.</li>

       <li><p><a href="#traverse-the-history">Traverse the history</a> to the new entry. If the navigation was initiated
       with <a href="#replacement-enabled">replacement enabled</a>, then the traversal must itself be initiated with
       <a href="#replacement-enabled">replacement enabled</a>.</p>

       </li>

      </ol></dd>

    </dl></li>

   <li><p>The <a data-anolis-xref="navigate" href="#navigate">navigation algorithm</a> has now <dfn data-anolis-xref="concept-navigate-mature" id="concept-navigate-mature">matured</dfn>.</li>

   <li><p><i>Fragment identifier loop</i>: <a href="webappapis.html#spin-the-event-loop">Spin the event loop</a> for a user-agent-defined
   amount of time, as desired by the user agent implementor. (This is intended to allow the user
   agent to optimize the user experience in the face of performance concerns.)</li>

   <li><p>If the <code><a href="dom.html#document">Document</a></code> object has no parser, or its parser has <a data-anolis-xref="stop
   parsing" href="syntax.html#stop-parsing">stopped parsing</a>, or the user agent has reason to believe the user is no longer
   interested in scrolling to the fragment identifier, then abort these steps.</li>

   <li><p><a href="#scroll-to-the-fragment-identifier">Scroll to the fragment identifier</a> given in <a href="dom.html#the-document's-address">the document's
   address</a>. If this fails to find <a data-anolis-xref="the indicated part of the document" href="#the-indicated-part-of-the-document">an
   indicated part of the document</a>, then return to the <i>fragment identifier loop</i>
   step.</li>

  </ol><p>The <a href="webappapis.html#task-source">task source</a> for this <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> is the
  <a href="webappapis.html#networking-task-source">networking task source</a>.</p>


  <h4 id="read-html"><span class="secno">5.6.2 </span><dfn data-anolis-xref="navigate-html" id="navigate-html">Page load processing model for HTML files</dfn></h4>

  <p>When an HTML document is to be loaded in a <a href="#browsing-context">browsing context</a>, the user agent must
  <a href="webappapis.html#queue-a-task">queue a task</a> to <a href="#create-a-document-object">create a <code>Document</code> object</a>, mark it as being
  an <a data-anolis-xref="HTML documents" href="infrastructure.html#html-documents">HTML document</a>, set its <a data-anolis-xref="concept-document-content-type" href="infrastructure.html#concept-document-content-type">content type</a> to "<code data-anolis-xref="">text/html</code>",
  create an <a href="syntax.html#html-parser">HTML parser</a>, and associate it with the document. Each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> that the <a href="webappapis.html#networking-task-source">networking task source</a> places on the
  <a href="webappapis.html#task-queue">task queue</a> while the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching algorithm</a> runs must then
  fill the parser's <a href="syntax.html#the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a href="syntax.html#html-parser">HTML
  parser</a> to perform the appropriate processing of the input stream.</p>

  <p class="note">The <a href="syntax.html#the-input-byte-stream">input byte stream</a> converts bytes into characters for use in the
  <a data-anolis-xref="tokenization" href="syntax.html#tokenization">tokenizer</a>. This process relies, in part, on character encoding
  information found in the real <a data-anolis-xref="Content-Type" href="infrastructure.html#content-type">Content-Type metadata</a> of the
  resource; the "sniffed type" is not used for this purpose.</p>

  <!-- next two paragraphs are nearly identical to the navigate-text section, keep them in sync -->

  <p>When no more bytes are available, the user agent must <a href="webappapis.html#queue-a-task">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code data-anolis-xref="event-load">load</code> event to be fired.</p>

  <p>After creating the <code><a href="dom.html#document">Document</a></code> object, but before any script execution, certainly
  before the parser <a data-anolis-xref="stop parsing" href="syntax.html#stop-parsing">stops</a>, the user agent must <a href="#update-the-session-history-with-the-new-page">update the
  session history with the new page</a>.</p>

  <p class="note"><a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">Application cache selection</a> happens <a href="syntax.html#parser-appcache">in the HTML parser</a>.</p>

  <p>The <a href="webappapis.html#task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="webappapis.html#networking-task-source">networking task source</a>.</p>



  <h4 id="read-xml"><span class="secno">5.6.3 </span><dfn data-anolis-xref="navigate-xml" id="navigate-xml">Page load processing model for XML files</dfn></h4>

  <p>When faced with displaying an XML file inline, user agents must first <a href="#create-a-document-object">create a
  <code>Document</code> object</a>, following the requirements of the XML and Namespaces in XML
  recommendations, RFC 3023, DOM, and other relevant specifications. <a href="references.html#refsXML">[XML]</a> <a href="references.html#refsXMLNS">[XMLNS]</a> <a href="references.html#refsRFC3023">[RFC3023]</a> <a href="references.html#refsDOM">[DOM]</a></p>

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the
  algorithms given in this specification, are the ones that must be used when determining the
  character encoding according to the rules given in the above specifications. Once the character
  encoding is established, the <a href="infrastructure.html#document's-character-encoding">document's character encoding</a> must be set to that
  character encoding.</p>

  <p>If the root element, as parsed according to the XML specifications cited above, is found to be
  an <code><a href="semantics.html#the-html-element">html</a></code> element with an attribute <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>
  whose value is not the empty string, then, as soon as the element is <a data-anolis-xref="insert an
  element into a document" href="infrastructure.html#insert-an-element-into-a-document">inserted into the document</a>, the user agent must <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolve</a> the value of that attribute relative to that element, and if
  that is successful, must apply the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a>
  algorithm to the resulting <a href="infrastructure.html#parsed-url">parsed URL</a> with the <i>exclude fragment flag</i> set to
  obtain <var data-anolis-xref="">manifest URL</var>, and then run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with <var data-anolis-xref="">manifest URL</var> as the manifest URL, passing in the newly-created
  <code><a href="dom.html#document">Document</a></code>. Otherwise, if the attribute is absent, its value is the empty string, or
  resolving its value fails, then as soon as the root element is <a data-anolis-xref="insert an element into
  a document" href="infrastructure.html#insert-an-element-into-a-document">inserted into the document</a>, the user agent must run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the <code><a href="dom.html#document">Document</a></code>.</p>

  <p class="note">Because the processing of the <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>
  attribute happens only once the root element is parsed, any URLs referenced by processing
  instructions before the root element (such as <code data-anolis-xref="">&lt;?xml-stylesheet?&gt;</code> and
  <code data-anolis-xref="">&lt;?xbl?&gt;</code> PIs) will be fetched from the network and cannot be
  cached.</p><!-- v2: fix this somehow -->

  <p>User agents may examine the namespace of the root <code><a href="infrastructure.html#element">Element</a></code> node of this
  <code><a href="dom.html#document">Document</a></code> object to perform namespace-based dispatch to alternative processing tools,
  e.g. determining that the content is actually a syndication feed and passing it to a feed handler.
  If such processing is to take place, abort the steps in this section, and jump to <a href="#navigate-non-Document">the next step</a> (labeled <i>non-document content</i>) in the
  <a href="#navigate">navigate</a> steps above.</p>

  <p>Otherwise, then, with the newly created <code><a href="dom.html#document">Document</a></code>, the user agent must <a href="#update-the-session-history-with-the-new-page">update
  the session history with the new page</a>. User agents may do this before the complete document
  has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts
  are to be executed.</p>

  <p>Error messages from the parse process (e.g. XML namespace well-formedness errors) may be
  reported inline by mutating the <code><a href="dom.html#document">Document</a></code>.</p>


  <h4 id="read-text"><span class="secno">5.6.4 </span><dfn data-anolis-xref="navigate-text" id="navigate-text">Page load processing model for text files</dfn></h4>

  <p>When a plain text document is to be loaded in a <a href="#browsing-context">browsing context</a>, the user agent
  must <a href="webappapis.html#queue-a-task">queue a task</a> to <a href="#create-a-document-object">create a <code>Document</code> object</a>, mark it as
  being an <a data-anolis-xref="HTML documents" href="infrastructure.html#html-documents">HTML document</a>, set its <a data-anolis-xref="concept-document-content-type" href="infrastructure.html#concept-document-content-type">content type</a> to "<code data-anolis-xref="">text/plain</code>",
  create an <a href="syntax.html#html-parser">HTML parser</a>, associate it with the document, act as if the tokenizer had
  emitted a start tag token with the tag name "pre" followed by a single "LF" (U+000A)
  character<!-- to get eaten, so that a leading LF in the text/plain stream doesn't get eaten
  itself-->, and switch the <a href="syntax.html#html-parser">HTML parser</a>'s tokenizer to the <a href="syntax.html#plaintext-state">PLAINTEXT
  state</a>. Each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> that the <a href="webappapis.html#networking-task-source">networking task
  source</a> places on the <a href="webappapis.html#task-queue">task queue</a> while the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching
  algorithm</a> runs must then fill the parser's <a href="syntax.html#the-input-byte-stream">input byte stream</a> with the fetched
  bytes and cause the <a href="syntax.html#html-parser">HTML parser</a> to perform the appropriate processing of the input
  stream.</p>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and
  the rules for actually rendering the text to the user, are defined in RFC 2046, RFC 3676, and
  subsequent versions thereof. <a href="references.html#refsRFC2046">[RFC2046]</a> <a href="references.html#refsRFC3676">[RFC3676]</a></p>

  <p>The <a href="infrastructure.html#document's-character-encoding">document's character encoding</a> must be set to the character encoding used to
  decode the document.</p>

  <p>Upon creation of the <code><a href="dom.html#document">Document</a></code> object, the user agent must run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code><a href="dom.html#document">Document</a></code>.</p>

  <!-- next two paragraphs are nearly identical to the navigate-html section and similar to the
  "navigate-ua-inline" section, and the next three are similar to the navigate-media and
  navigate-plugin sections; keep them all in sync -->

  <p>When no more bytes are available, the user agent must <a href="webappapis.html#queue-a-task">queue a task</a> for the parser
  to process the implied EOF character, which eventually causes a <code data-anolis-xref="event-load">load</code> event to be fired.</p>

  <p>After creating the <code><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  parsing, the user agent must <a href="#update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code><a href="document-metadata.html#the-head-element">head</a></code> element of the <code><a href="dom.html#document">Document</a></code>, e.g.
  linking to a style sheet or an XBL binding, providing script, giving the document a
  <code><a href="document-metadata.html#the-title-element">title</a></code>, etc.</p>

  <p class="note">In particular, if the user agent supports the <code data-anolis-xref="">Format=Flowed</code>
  feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to
  wrap correctly and to handle the quoting feature. This could be performed using, e.g., an XBL
  binding or a CSS extension.</p>

  <p>The <a href="webappapis.html#task-source">task source</a> for the two tasks mentioned in this section must be the
  <a href="webappapis.html#networking-task-source">networking task source</a>.</p>


  <h4 id="read-multipart-x-mixed-replace"><span class="secno">5.6.5 </span><dfn data-anolis-xref="navigate-multipart-x-mixed-replace" id="navigate-multipart-x-mixed-replace">Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn></h4>

  <p>When a resource with the type <code><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code> is to be loaded in a
  <a href="#browsing-context">browsing context</a>, the user agent must parse the resource using the rules for
  multipart types. <a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>For each body part obtained from the resource, the user agent must run a new instance of the
  <a href="#navigate">navigate</a> algorithm, starting from the <i>resource handling</i> step, using the new
  body part as the resource being navigated, with <a href="#replacement-enabled">replacement enabled</a> if a previous
  body part from the same resource resulted in a <code><a href="dom.html#document">Document</a></code> object being <a data-anolis-xref="create a document object" href="#create-a-document-object">created</a>, and otherwise using the same setup as the
  <a href="#navigate">navigate</a> attempt that caused this section to be invoked in the first place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone
  resources, the user agent must act as if there were no more bytes for those resources whenever the
  boundary following the body part is reached.</p>

  <p class="note">Thus, <code data-anolis-xref="event-load">load</code> events (and for that matter <code data-anolis-xref="event-unload">unload</code> events) do fire for each body part loaded.</p>


  <h4 id="read-media"><span class="secno">5.6.6 </span><dfn data-anolis-xref="navigate-media" id="navigate-media">Page load processing model for media</dfn></h4>

  <p>When an image, video, or audio resource is to be loaded in a <a href="#browsing-context">browsing context</a>, the
  user agent should <a href="#create-a-document-object">create a <code>Document</code> object</a>, mark it as being an <a data-anolis-xref="HTML documents" href="infrastructure.html#html-documents">HTML document</a>, set its <a data-anolis-xref="concept-document-content-type" href="infrastructure.html#concept-document-content-type">content type</a> to the sniffed MIME type of the resource
  (<var data-anolis-xref="">type</var> in the <a href="#navigate">navigate</a> algorithm), append an <code><a href="semantics.html#the-html-element">html</a></code>
  element to the <code><a href="dom.html#document">Document</a></code>, append a <code><a href="document-metadata.html#the-head-element">head</a></code> element and a <code><a href="sections.html#the-body-element">body</a></code>
  element to the <code><a href="semantics.html#the-html-element">html</a></code> element, append an element <var data-anolis-xref="">host element</var> for
  the media, as described below, to the <code><a href="sections.html#the-body-element">body</a></code> element, and set the appropriate attribute
  of the element <var data-anolis-xref="">host element</var>, as described below, to the address of the image,
  video, or audio resource.</p>

  <p>The element <var data-anolis-xref="">host element</var> to create for the media is the element given in
  the table below in the second cell of the row whose first cell describes the media. The
  appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th> Type of media
         </th><th> Element for the media
         </th><th> Appropriate attribute
    </th></tr><tr><td> Image
         </td><td> <code><a href="embedded-content-0.html#the-img-element">img</a></code>
         </td><td> <code data-anolis-xref="attr-img-src"><a href="embedded-content-0.html#attr-img-src">src</a></code>
    </td></tr><tr><td> Video
         </td><td> <code><a href="embedded-content-0.html#the-video-element">video</a></code>
         </td><td> <code data-anolis-xref="attr-media-src"><a href="embedded-content-0.html#attr-media-src">src</a></code>
    </td></tr><tr><td> Audio
         </td><td> <code><a href="embedded-content-0.html#the-audio-element">audio</a></code>
         </td><td> <code data-anolis-xref="attr-media-src"><a href="embedded-content-0.html#attr-media-src">src</a></code>
  </thead></td></tr></table><!-- next three paragraphs are similar to the navigate-text section, keep them in sync --><p>Then, the user agent must act as if it had <a data-anolis-xref="stop parsing" href="syntax.html#stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code><a href="dom.html#document">Document</a></code> object, the user agent must run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="#update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code><a href="document-metadata.html#the-head-element">head</a></code> element of the <code><a href="dom.html#document">Document</a></code>, or
  attributes to the element <var data-anolis-xref="">host element</var>, e.g. to link to a style sheet or an
  XBL binding, to provide a script, to give the document a <code><a href="document-metadata.html#the-title-element">title</a></code>, to make the media
  <a data-anolis-xref="attr-media-autoplay" href="embedded-content-0.html#attr-media-autoplay">autoplay</a>, etc.</p>


  <h4 id="read-plugin"><span class="secno">5.6.7 </span><dfn data-anolis-xref="navigate-plugin" id="navigate-plugin">Page load processing model for content that uses plugins</dfn></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded in a
  <a href="#browsing-context">browsing context</a>, the user agent should <a href="#create-a-document-object">create a <code>Document</code>
  object</a>, mark it as being an <a data-anolis-xref="HTML documents" href="infrastructure.html#html-documents">HTML document</a> and mark it
  as being a <dfn id="plugin-document">plugin document</dfn>, set its <a data-anolis-xref="concept-document-content-type" href="infrastructure.html#concept-document-content-type">content
  type</a> to the sniffed MIME type of the resource (<var data-anolis-xref="">type</var> in the
  <a href="#navigate">navigate</a> algorithm), append an <code><a href="semantics.html#the-html-element">html</a></code> element to the
  <code><a href="dom.html#document">Document</a></code>, append a <code><a href="document-metadata.html#the-head-element">head</a></code> element and a <code><a href="sections.html#the-body-element">body</a></code> element to the
  <code><a href="semantics.html#the-html-element">html</a></code> element, append an <code><a href="embedded-content-0.html#the-embed-element">embed</a></code> to the <code><a href="sections.html#the-body-element">body</a></code> element, and set
  the <code data-anolis-xref="attr-embed-src"><a href="embedded-content-0.html#attr-embed-src">src</a></code> attribute of the <code><a href="embedded-content-0.html#the-embed-element">embed</a></code> element to the
  address of the resource.</p>

  <p class="note">The term <a href="#plugin-document">plugin document</a> is used by the Content Security Policy
  specification as part of the mechanism that ensures <code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>s can't be used to evade
  <code data-anolis-xref="">plugin-types</code> directives. <a href="references.html#refsCSP">[CSP]</a></p>

  <!-- next three paragraphs are similar to the navigate-text section, keep them in sync -->

  <p>Then, the user agent must act as if it had <a data-anolis-xref="stop parsing" href="syntax.html#stop-parsing">stopped
  parsing</a>.</p>

  <p>Upon creation of the <code><a href="dom.html#document">Document</a></code> object, the user agent must run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with no manifest, and
  passing in the newly-created <code><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished
  fully loading, the user agent must <a href="#update-the-session-history-with-the-new-page">update the session history with the new page</a>.</p>

  <p>User agents may add content to the <code><a href="document-metadata.html#the-head-element">head</a></code> element of the <code><a href="dom.html#document">Document</a></code>, or
  attributes to the <code><a href="embedded-content-0.html#the-embed-element">embed</a></code> element, e.g. to link to a style sheet or an XBL binding, or
  to give the document a <code><a href="document-metadata.html#the-title-element">title</a></code>.</p>

  <p class="note" id="sandboxPluginNavigate">If the <code><a href="dom.html#document">Document</a></code>'s <a href="#active-sandboxing-flag-set">active sandboxing
  flag set</a> has its <a href="#sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</a> set, the synthesized
  <code><a href="embedded-content-0.html#the-embed-element">embed</a></code> element will <a href="embedded-content-0.html#sandboxPluginEmbed">fail to render the content</a> if
  the relevant <a href="infrastructure.html#plugin">plugin</a> cannot be <a data-anolis-xref="concept-plugin-secure" href="infrastructure.html#concept-plugin-secure">secured</a>.</p>


  <h4 id="read-ua-inline"><span class="secno">5.6.8 </span><dfn data-anolis-xref="navigate-ua-inline" id="navigate-ua-inline">Page load processing model for inline
  content that doesn't have a DOM</dfn></h4>

  <p>When the user agent is to display a user agent page inline in a <a href="#browsing-context">browsing context</a>,
  the user agent should <a href="#create-a-document-object">create a <code>Document</code> object</a>, mark it as being an
  <a data-anolis-xref="HTML documents" href="infrastructure.html#html-documents">HTML document</a>, set its <a data-anolis-xref="concept-document-content-type" href="infrastructure.html#concept-document-content-type">content type</a> to "<code data-anolis-xref="">text/html</code>",
  and then either associate that <code><a href="dom.html#document">Document</a></code> with a custom rendering that is not rendered
  using the normal <code><a href="dom.html#document">Document</a></code> rendering rules, or mutate that <code><a href="dom.html#document">Document</a></code> until
  it represents the content the user agent wants to render.</p>

  <!-- next two paragraphs are similar to the navigate-text section, keep them in sync -->

  <p>Once the page has been set up, the user agent must act as if it had <a data-anolis-xref="stop
  parsing" href="syntax.html#stop-parsing">stopped parsing</a>.</p>

  <p>Upon creation of the <code><a href="dom.html#document">Document</a></code> object, the user agent must run the <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache selection algorithm</a> with no manifest,
  passing in the newly-created <code><a href="dom.html#document">Document</a></code>.</p>

  <p>After creating the <code><a href="dom.html#document">Document</a></code> object, but potentially before the page has been
  completely set up, the user agent must <a href="#update-the-session-history-with-the-new-page">update the session history with the new
  page</a>.</p>



  <h4 id="scroll-to-fragid"><span class="secno">5.6.9 </span><dfn data-anolis-xref="navigate-fragid" id="navigate-fragid">Navigating to a fragment identifier</dfn></h4>

  <p>When a user agent is supposed to navigate to a fragment identifier, then the user agent must
  run the following steps:</p>

  <ol><li>

    <p>Remove all the entries in the <a href="#browsing-context">browsing context</a>'s <a href="#session-history">session history</a>
    after the <a href="#current-entry">current entry</a>. If the <a href="#current-entry">current entry</a> is the last entry in the
    session history, then no entries are removed.</p>

    <p class="note">This <a href="#history-notes">doesn't necessarily have to affect</a> the user
    agent's user interface.</p>

   </li>

   <li><p>Remove any <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source">history traversal
   task source</a> that are associated with any <code><a href="dom.html#document">Document</a></code> objects in the
   <a href="#top-level-browsing-context">top-level browsing context</a>'s <a href="#document-family">document family</a>.</li>

   <li><p>Append a new entry at the end of the <code><a href="#history-1">History</a></code> object representing the new
   resource and its <code><a href="dom.html#document">Document</a></code> object and related state. Its <a href="infrastructure.html#url">URL</a> must be set
   to the address to which the user agent was <a data-anolis-xref="navigate" href="#navigate">navigating</a>. The title
   must be left unset.</li>

   <li><p><a href="#traverse-the-history">Traverse the history</a> to the new entry, with the <i>asynchronous events</i> flag
   set. This will <a href="#scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a> given in what is now <a href="dom.html#the-document's-address">the document's address</a>.</li>

  </ol><p class="note">If the scrolling fails because the relevant <a data-anolis-xref="concept-id" href="infrastructure.html#concept-id">ID</a> has
  not yet been parsed, then the original <a data-anolis-xref="navigate" href="#navigate">navigation</a> algorithm will
  take care of the scrolling instead, as the last few steps of its <a href="#update-the-session-history-with-the-new-page">update the session history
  with the new page</a> algorithm.</p>

  <hr><p>When the user agent is required to <dfn id="scroll-to-the-fragment-identifier">scroll to the fragment identifier</dfn> and <a href="#the-indicated-part-of-the-document">the
  indicated part of the document</a>, if any, is <a href="rendering.html#being-rendered">being rendered</a>, the user agent must
  either change the scrolling position of the document using the following algorithm, or perform
  some other action such that <a href="#the-indicated-part-of-the-document">the indicated part of the document</a> is brought to the
  user's attention. If there is no indicated part, or if the indicated part is not <a href="rendering.html#being-rendered">being
  rendered</a>, then the user agent must do nothing. The aforementioned algorithm is as
  follows:</p>

  <ol><li><p>Let <var data-anolis-xref="">target</var> be <a href="#the-indicated-part-of-the-document">the indicated part of the
   document</a>, as defined below.</li>

   <li><p>If <var data-anolis-xref="">target</var> is the top of the document, then <a href="infrastructure.html#scroll-to-the-beginning-of-the-document">scroll to the
   beginning of the document</a> for the <code><a href="dom.html#document">Document</a></code>, and abort these steps. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></li>

   <li><p>Use the <a href="infrastructure.html#scroll-an-element-into-view">scroll an element into view</a> algorithm to scroll <var data-anolis-xref="">target</var> into view, with the <var data-anolis-xref="">align to top flag</var> set. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></li>

   <li><p>If <var data-anolis-xref="">target</var> is a <a href="editing.html#focusable">focusable</a> element, run the <a href="editing.html#focusing-steps">focusing
   steps</a> for that element.</li>

  </ol><p><dfn id="the-indicated-part-of-the-document">The indicated part of the document</dfn> is the one that the fragment identifier, if any,
  identifies. The semantics of the fragment identifier in terms of mapping it to a specific DOM Node
  is defined by the specification that defines the <a href="infrastructure.html#mime-type">MIME type</a> used by the
  <code><a href="dom.html#document">Document</a></code> (for example, the processing of fragment identifiers for <a data-anolis-xref="XML
  MIME type" href="infrastructure.html#xml-mime-type">XML MIME types</a> is the responsibility of RFC3023). <a href="references.html#refsRFC3023">[RFC3023]</a></p>

  <p>For HTML documents (and <a data-anolis-xref="HTML MIME type" href="infrastructure.html#html-mime-type">HTML MIME types</a>), the following
  processing model must be followed to determine what <a href="#the-indicated-part-of-the-document">the indicated part of the
  document</a> is.</p>

  <ol><li><p>Apply the <a href="infrastructure.html#url-parser">URL parser</a> algorithm to the <a href="infrastructure.html#url">URL</a>, and let <var data-anolis-xref="">fragid</var> be the <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a> component of the
   resulting <a href="infrastructure.html#parsed-url">parsed URL</a>.</li><!-- parsing can't fail, since we checked earlier on
   when navigating -->

   <li><p>If <var data-anolis-xref="">fragid</var> is the empty string, then <a href="#the-indicated-part-of-the-document">the indicated part of the
   document</a> is the top of the document; stop the algorithm here.</li>

   <li><p>Let <var data-anolis-xref="">fragid bytes</var> be the result of <a data-anolis-xref="percent
   decode" href="infrastructure.html#percent-decode">percent-decoding</a> <var data-anolis-xref="">fragid</var>.</li>

   <li><p>Let <var data-anolis-xref="">decoded fragid</var> be the result of applying the <a href="infrastructure.html#utf-8-decoder">UTF-8
   decoder</a> algorithm to <var data-anolis-xref="">fragid bytes</var>. If the <a href="infrastructure.html#utf-8-decoder">UTF-8 decoder</a>
   emits a <a href="infrastructure.html#decoder-error">decoder error</a>, abort the decoder and instead jump to the step labeled <i>no
   decoded fragid</i>.</li>

   <li><p>If there is an element in the DOM that has an <a data-anolis-xref="concept-id" href="infrastructure.html#concept-id">ID</a> exactly
   equal to <var data-anolis-xref="">decoded fragid</var>, then the first such element in tree order is
   <a href="#the-indicated-part-of-the-document">the indicated part of the document</a>; stop the algorithm here.</li>

   <li><p><i>No decoded fragid</i>: If there is an <code><a href="text-level-semantics.html#the-a-element">a</a></code> element in the DOM that has a <code data-anolis-xref="attr-a-name"><a href="obsolete.html#attr-a-name">name</a></code> attribute whose value is exactly equal to <var data-anolis-xref="">fragid</var> (<em>not</em> <var data-anolis-xref="">decoded fragid</var>), then the first such
   element in tree order is <a href="#the-indicated-part-of-the-document">the indicated part of the document</a>; stop the algorithm
   here.</li>

   <li><p>If <var data-anolis-xref="">fragid</var> is an <a href="infrastructure.html#ascii-case-insensitive">ASCII case-insensitive</a> match for the
   string <code data-anolis-xref="">top</code>, then <a href="#the-indicated-part-of-the-document">the indicated part of the document</a> is the top
   of the document; stop the algorithm here.</li>

   <li><p>Otherwise, there is no <a data-anolis-xref="the indicated part of the document" href="#the-indicated-part-of-the-document">indicated part of
   the document</a>.</li>

  </ol><p>For the purposes of the interaction of HTML with Selectors' <code data-anolis-xref="selector-target">:target</code> pseudo-class, the <dfn id="target-element"><i>target element</i></dfn> is
  <a href="#the-indicated-part-of-the-document">the indicated part of the document</a>, if that is an element; otherwise there is no
  <i><a href="#target-element">target element</a></i>. <a href="references.html#refsSELECTORS">[SELECTORS]</a></p>

  <p>The <a href="webappapis.html#task-source">task source</a> for the task mentioned in this section must be the <a href="webappapis.html#dom-manipulation-task-source">DOM
  manipulation task source</a>.</p>

  </div>



  <h4 id="history-traversal"><span class="secno">5.6.10</span> 履歴走査</h4><!-- session history --> 

  <div class="impl">

  <p>When a user agent is required to <dfn id="traverse-the-history">traverse the history</dfn> to a <var data-anolis-xref="">specified
  entry</var>, optionally with <a href="#replacement-enabled">replacement enabled</a>, and optionally with the
  <i>asynchronous events</i> flag set, the user agent must act as follows.</p>

  <p class="note">This algorithm is not just invoked when <a data-anolis-xref="traverse the history by a
  delta" href="#traverse-the-history-by-a-delta">explicitly going back or forwards in the session history</a> — it is also invoked
  in other situations, for example when <a data-anolis-xref="navigate" href="#navigate">navigating a browsing context</a>,
  as part of <a data-anolis-xref="update the session history with the new page" href="#update-the-session-history-with-the-new-page">updating the session history
  with the new page</a>.</p>

  <ol><li>

    <p>If there is no longer a <code><a href="dom.html#document">Document</a></code> object for the entry in question,
    <a href="#navigate">navigate</a><!--DONAV history traversal after eviction--> the <a href="#browsing-context">browsing
    context</a> to the resource for that entry to perform an <a href="#entry-update">entry update</a> of that
    entry, and abort these steps. The "<a href="#navigate">navigate</a>" algorithm reinvokes this "traverse"
    algorithm to complete the traversal, at which point there <em>is</em> a <code><a href="dom.html#document">Document</a></code>
    object and so this step gets skipped. The navigation must be done using the same <a href="#source-browsing-context">source
    browsing context</a> as was used the first time this entry was created. (This can never
    happen with <a href="#replacement-enabled">replacement enabled</a>.)</p>

    <p class="note">If the resource was obtained usign a non-idempotent action, for example a POST
    form submission, or if the resource is no longer available, for example because the computer is
    now offline and the page wasn't cached, navigating to it again might not be possible. In this
    case, the navigation will result in a different page than previously; for example, it might be
    an error message explaining the problem or offering to resubmit the form.</p>

   </li>

   <li><p>If the <a href="#current-entry">current entry</a>'s title was not set by the <code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code> or <code data-anolis-xref="dom-history-replaceState"><a href="#dom-history-replacestate">replaceState()</a></code> methods, then set its title to the value
   returned by the <code data-anolis-xref="dom-document-title"><a href="dom.html#document.title">document.title</a></code> IDL attribute.</li>

   <li><p>If appropriate, update the <a href="#current-entry">current entry</a> in the <a href="#browsing-context">browsing
   context</a>'s <code><a href="dom.html#document">Document</a></code> object's <code><a href="#history-1">History</a></code> object to reflect any state
   that the user agent wishes to persist. The entry is then said to be <a href="#an-entry-with-persisted-user-state">an entry with persisted
   user state</a>.</li>

   <li><p>If the <var data-anolis-xref="">specified entry</var> has a different <code><a href="dom.html#document">Document</a></code> object
   than the <a href="#current-entry">current entry</a>, then run the following substeps:</p>

    <ol><li><p>Remove any <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> queued by the <a href="webappapis.html#history-traversal-task-source">history traversal
     task source</a> that are associated with any <code><a href="dom.html#document">Document</a></code> objects in the
     <a href="#top-level-browsing-context">top-level browsing context</a>'s <a href="#document-family">document family</a>.</li> <!-- so the
     network is racing history.back(), in the case of setting location.href="" and then calling
     history.back() -->

     <li>

      <p>If the <a href="#origin-0">origin</a> of the <code><a href="dom.html#document">Document</a></code> of the <var data-anolis-xref="">specified
      entry</var> is not the <a data-anolis-xref="same origin" href="#same-origin">same</a> as the <a href="#origin-0">origin</a> of the
      <code><a href="dom.html#document">Document</a></code> of the <a href="#current-entry">current entry</a>, then run the following
      sub-sub-steps:</p>

      <ol><li><p>The current <a href="#browsing-context-name">browsing context name</a> must be stored with all the entries in
       the history that are associated with <code><a href="dom.html#document">Document</a></code> objects with the <a href="#same-origin">same
       origin</a> as the <a href="#active-document">active document</a> <em>and</em> that are contiguous with the
       <a href="#current-entry">current entry</a>.</li>

       <li id="resetBCName"><p>If the browsing context is a <a href="#top-level-browsing-context">top-level browsing context</a>,
       but not an <a href="#auxiliary-browsing-context">auxiliary browsing context</a>, then the browsing context's
       <a href="#browsing-context-name">browsing context name</a> must be unset.</li>

      </ol></li>

     <li id="appcache-history-2"><p>Make the <var data-anolis-xref="">specified entry</var>'s
     <code><a href="dom.html#document">Document</a></code> object the <a href="#active-document">active document</a> of the <a href="#browsing-context">browsing
     context</a>.</li>

     <li>

      <p>If the <var data-anolis-xref="">specified entry</var> has a <a href="#browsing-context-name">browsing context name</a> stored
      with it, then run the following sub-sub-steps:</p>

      <ol><li><p>Set the browsing context's <a href="#browsing-context-name">browsing context name</a> to the name stored with
       the specified entry.</li>

       <li><p>Clear any <a data-anolis-xref="browsing context name" href="#browsing-context-name">browsing context names</a> stored
       with all entries in the history that are associated with <code><a href="dom.html#document">Document</a></code> objects with
       the <a href="#same-origin">same origin</a> as the new <a href="#active-document">active document</a> and that are contiguous
       with the specified entry.</li>

      </ol></li>

     <li id="history-autocomplete"><p>If the <var data-anolis-xref="">specified entry</var>'s
     <code><a href="dom.html#document">Document</a></code> has any form controls whose <span>autofill field name</span> is "<code data-anolis-xref="attr-fe-autocomplete-off"><a href="forms.html#attr-fe-autocomplete-off">off</a></code>", invoke the <a data-anolis-xref="concept-form-reset-control" href="forms.html#concept-form-reset-control">reset algorithm</a> of each of those elements.</li>

     <li>

      <p>If the <a href="dom.html#current-document-readiness">current document readiness</a> of the <var data-anolis-xref="">specified entry</var>'s
      <code><a href="dom.html#document">Document</a></code> is "<code data-anolis-xref="">complete</code>", <a href="webappapis.html#queue-a-task">queue a task</a> to run
      the following sub-sub-steps:</p>

      <ol><li><p>If the <code><a href="dom.html#document">Document</a></code>'s <a href="#page-showing">page showing</a> flag is true, then abort this
       task (i.e. don't fire the event below).</li>

       <li><p>Set the <code><a href="dom.html#document">Document</a></code>'s <a href="#page-showing">page showing</a> flag to true.</li>

       <li>

        <p>Run any <dfn id="session-history-document-visibility-change-steps">session history document visibility change steps</dfn> for <code><a href="dom.html#document">Document</a></code> that
        are defined by <a href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</p>

        <p class="note">This is specifically intended for use by the Page Visibility specification. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>

       </li>

       <li><p><a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">Fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> event with the name <code data-anolis-xref="event-pageshow"><a href="#event-pageshow">pageshow</a></code> at the <code><a href="#window">Window</a></code> object of that
       <code><a href="dom.html#document">Document</a></code>, but with its <code data-anolis-xref="dom-event-target"><a href="infrastructure.html#dom-event-target">target</a></code> set to the
       <code><a href="dom.html#document">Document</a></code> object (and the <code data-anolis-xref="dom-event-currentTarget">currentTarget</code> set to the <code><a href="#window">Window</a></code> object),
       using the <code><a href="#pagetransitionevent">PageTransitionEvent</a></code> interface, with the <code data-anolis-xref="dom-PageTransitionEvent-persisted"><a href="#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialized to true.
       This event must not bubble, must not be cancelable, and has no default action.</li>

      </ol><!-- an interesting thing to test would be to traverse back during onload, before the first
      pageshow has fired, and then to traverse forward again, and see if we get _two_ pageshows. If
      so, it indicates that browsers don't have a "page showing" flag like this and that the history
      traversal task source has a higher priority than the DOM manipulation task source. --></li>

    </ol></li>

   <li><p>Set <a href="dom.html#the-document's-address">the document's address</a> to the URL of the <var data-anolis-xref="">specified
   entry</var>.</li>

   <li><p>If the <var data-anolis-xref="">specified entry</var> has a URL whose fragment identifier differs
   from that of the <a href="#current-entry">current entry</a>'s when compared in a <a href="infrastructure.html#case-sensitive">case-sensitive</a>
   manner, and the two share the same <code><a href="dom.html#document">Document</a></code> object, then let <var data-anolis-xref="">hash
   changed</var> be true, and let <var data-anolis-xref="">old URL</var> be the URL of the <a href="#current-entry">current
   entry</a> and <var data-anolis-xref="">new URL</var> be the URL of the <var data-anolis-xref="">specified
   entry</var>. Otherwise, let <var data-anolis-xref="">hash changed</var> be false.</li>

   <li><p>If the traversal was initiated with <dfn id="replacement-enabled">replacement enabled</dfn>, remove the entry
   immediately before the <var data-anolis-xref="">specified entry</var> in the session history.</p>

   </li><li><p>If the <var data-anolis-xref="">specified entry</var> is not <a href="#an-entry-with-persisted-user-state">an entry with persisted user
   state</a>, but its URL has a fragment identifier, <a href="#scroll-to-the-fragment-identifier">scroll to the fragment
   identifier</a>.</li>

   <li>

    <p>If the entry is <a href="#an-entry-with-persisted-user-state">an entry with persisted user state</a>, the user agent may update
    aspects of the document and its rendering, for instance the scroll position or values of form
    fields, that it had previously recorded.</p>

    <!-- see similar paragraphs in the textarea and input sections -->
    <p class="note">This can even include updating the <code data-anolis-xref="attr-dir"><a href="dom.html#the-dir-attribute">dir</a></code> attribute
    of <code><a href="forms.html#the-textarea-element">textarea</a></code> elements or <code><a href="forms.html#the-input-element">input</a></code> elements whose <code data-anolis-xref="attr-input-type"><a href="forms.html#attr-input-type">type</a></code> attribute is in either the <a data-anolis-xref="attr-input-type-text" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a data-anolis-xref="attr-input-type-search" href="forms.html#text-(type=text)-state-and-search-state-(type=search)">Search</a> state, if the persisted state includes the
    directionality of user input in such controls.</p>

   </li>

   <li><p>If the entry is a <a href="#state-object">state object</a> entry, let <var data-anolis-xref="">state</var> be a
   <a href="infrastructure.html#structured-clone">structured clone</a> of that state object. Otherwise, let <var data-anolis-xref="">state</var> be
   null.</li>

   <li><p>Set <code data-anolis-xref="dom-history-state"><a href="#dom-history-state">history.state</a></code> to <var data-anolis-xref="">state</var>.</li>

   <li><p>Let <var data-anolis-xref="">state changed</var> be true if the <code><a href="dom.html#document">Document</a></code> of the <var data-anolis-xref="">specified entry</var> has a <a href="#latest-entry">latest entry</a>, and that entry is not the <var data-anolis-xref="">specified entry</var>; otherwise let it be false.</p>

   </li><li><p>Let the <a href="#latest-entry">latest entry</a> of the <code><a href="dom.html#document">Document</a></code> of the <var data-anolis-xref="">specified entry</var> be the <var data-anolis-xref="">specified entry</var>.</li>

   <li>

    <p>If the <i>asynchronous events</i> flag is not set, then run the following steps
    synchronously. Otherwise, the <i>asynchronous events</i> flag is set; <a href="webappapis.html#queue-a-task">queue a task</a>
    to run the following substeps.</p>

    <ol><li><p>If <var data-anolis-xref="">state changed</var> is true, <a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>
     event with the name <code data-anolis-xref="event-popstate"><a href="#event-popstate">popstate</a></code> at the <code><a href="#window">Window</a></code>
     object of the <code><a href="dom.html#document">Document</a></code>, using the <code><a href="#popstateevent">PopStateEvent</a></code> interface, with the
     <code data-anolis-xref="dom-PopStateEvent-state"><a href="#dom-popstateevent-state">state</a></code> attribute initialized to the value of <var data-anolis-xref="">state</var>. This event must bubble but not be cancelable and has no default
     action.</li>

     <li><p>If <var data-anolis-xref="">hash changed</var> is true, then <a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>
     event with the name <code data-anolis-xref="event-hashchange"><a href="#event-hashchange">hashchange</a></code> at the <a href="#browsing-context">browsing
     context</a>'s <code><a href="#window">Window</a></code> object, using the <code><a href="#hashchangeevent">HashChangeEvent</a></code> interface,
     with the <code data-anolis-xref="dom-HashChangeEvent-oldURL"><a href="#dom-hashchangeevent-oldurl">oldURL</a></code> attribute initialized to <var data-anolis-xref="">old URL</var> and the <code data-anolis-xref="dom-HashChangeEvent-newURL"><a href="#dom-hashchangeevent-newurl">newURL</a></code> attribute
     initialized to <var data-anolis-xref="">new URL</var>. This event must bubble but not be cancelable and
     has no default action.</li>

    </ol></li>

   <li><p>The <a href="#current-entry">current entry</a> is now the <var data-anolis-xref="">specified entry</var>.</li>

  </ol><p>The <a href="webappapis.html#task-source">task source</a> for the tasks mentioned above is the <a href="webappapis.html#dom-manipulation-task-source">DOM manipulation task
  source</a>.</p>


  <h5 id="event-definitions-0"><span class="secno">5.6.10.1 </span>Event definitions</h5>

  </div>

  <p><a href="#session-history-entry">セッション履歴のエントリ</a>に移動する際に、<dfn data-anolis-xref="event-popstate" id="event-popstate"><code>popstate</code></dfn>イベントは特定の場合に発生する。</p>

  <pre class="idl">[Constructor(DOMString type, optional <a href="#popstateeventinit">PopStateEventInit</a> eventInitDict)]
interface <dfn id="popstateevent">PopStateEvent</dfn> : <a href="infrastructure.html#event">Event</a> {
  readonly attribute any <a data-anolis-xref="dom-PopStateEvent-state" href="#dom-popstateevent-state">state</a>;
};

dictionary <dfn id="popstateeventinit">PopStateEventInit</dfn> : <a href="infrastructure.html#eventinit">EventInit</a> {
  any state;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-PopStateEvent-state"><a href="#dom-popstateevent-state">state</a></code></dt>

   <dd>

    <p><code data-anolis-xref="dom-history-pushState"><a href="#dom-history-pushstate">pushState()</a></code>または<code data-anolis-xref="dom-history-replaceState"><a href="#dom-history-replacestate">replaceState()</a></code>へ提供される情報のコピーを返す。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-PopStateEvent-state" id="dom-popstateevent-state"><code>state</code></dfn> attribute must return the
  value it was initialized to. When the object is created, this attribute must be initialized to
  null. It represents the context information for the event, or null, if the state represented is
  the initial state of the <code><a href="dom.html#document">Document</a></code>.</p>

  </div>

  <hr><p><a href="infrastructure.html#url">URL</a>が前のものとはフラグメント識別子のみ異なる<a href="#session-history-entry">セッション履歴のエントリ</a>に移動する際に<dfn data-anolis-xref="event-hashchange" id="event-hashchange"><code>hashchange</code></dfn>イベントは発火する。</p>

  <pre class="idl">[Constructor(DOMString type, optional <a href="#hashchangeeventinit">HashChangeEventInit</a> eventInitDict)]
interface <dfn id="hashchangeevent">HashChangeEvent</dfn> : <a href="infrastructure.html#event">Event</a> {
  readonly attribute DOMString <a data-anolis-xref="dom-HashChangeEvent-oldURL" href="#dom-hashchangeevent-oldurl">oldURL</a>;
  readonly attribute DOMString <a data-anolis-xref="dom-HashChangeEvent-newURL" href="#dom-hashchangeevent-newurl">newURL</a>;
};

dictionary <dfn id="hashchangeeventinit">HashChangeEventInit</dfn> : <a href="infrastructure.html#eventinit">EventInit</a> {
  DOMString oldURL;
  DOMString newURL;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-HashChangeEvent-oldURL"><a href="#dom-hashchangeevent-oldurl">oldURL</a></code></dt>

   <dd>

    <p>以前に現在であった<a href="#session-history-entry">セッション履歴のエントリ</a>の<a href="infrastructure.html#url">URL</a>を返す。</p>

   </dd>


   <dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-HashChangeEvent-newURL"><a href="#dom-hashchangeevent-newurl">newURL</a></code></dt>

   <dd>

    <p>今現在である<a href="#session-history-entry">セッション履歴のエントリ</a>の<a href="infrastructure.html#url">URL</a>を返す。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-HashChangeEvent-oldURL" id="dom-hashchangeevent-oldurl"><code>oldURL</code></dfn> attribute must return the
  value it was initialized to. When the object is created, this attribute must be initialized to
  null. It represents context information for the event, specifically the URL of the <a href="#session-history-entry">session
  history entry</a> that was traversed from.</p>

  <p>The <dfn data-anolis-xref="dom-HashChangeEvent-newURL" id="dom-hashchangeevent-newurl"><code>newURL</code></dfn> attribute must return the
  value it was initialized to. When the object is created, this attribute must be initialized to
  null. It represents context information for the event, specifically the URL of the <a href="#session-history-entry">session
  history entry</a> that was traversed to.</p>

  </div>

  <hr><p><a href="#session-history-entry">セッション履歴エントリ</a><em>に</em><a data-anolis-xref="traverse the history" href="#traverse-the-history">横断する</a>際に<dfn data-anolis-xref="event-pageshow" id="event-pageshow"><code>pageshow</code></dfn>イベントは発火する。<a href="#session-history-entry">セッション履歴のエントリ</a><em>から</em>横断する際に<dfn data-anolis-xref="event-pagehide" id="event-pagehide"><code>pagehide</code></dfn>イベントは発火する。仕様は、そのスクリプトが一貫した方法で（それらが、彼らは介在する<code data-anolis-xref="event-pageshow"><a href="#event-pageshow">pageshow</a></code>なしの行で2つの<code data-anolis-xref="event-pagehide"><a href="#event-pagehide">pagehide</a></code>イベントを受信しない、またはその逆で）これらのイベントを受け取ることを確認するための<a href="#page-showing">page showing</a>フラグを使用する。</p>

  <pre class="idl">[Constructor(DOMString type, optional <a href="#pagetransitioneventinit">PageTransitionEventInit</a> eventInitDict)]
interface <dfn id="pagetransitionevent">PageTransitionEvent</dfn> : <a href="infrastructure.html#event">Event</a> {
  readonly attribute boolean <a data-anolis-xref="dom-PageTransitionEvent-persisted" href="#dom-pagetransitionevent-persisted">persisted</a>;
};

dictionary <dfn id="pagetransitioneventinit">PageTransitionEventInit</dfn> : <a href="infrastructure.html#eventinit">EventInit</a> {
  boolean persisted;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-PageTransitionEvent-persisted"><a href="#dom-pagetransitionevent-persisted">persisted</a></code></dt>

   <dd>

    <p><code data-anolis-xref="event-pageshow"><a href="#event-pageshow">pageshow</a></code>に対して、ページが新しく読み込まれている（および<code data-anolis-xref="event-load">load</code>イベントが発生する）場合にfalseを返す。そうでなければ、trueを返す。</p>

    <p><code data-anolis-xref="event-pagehide"><a href="#event-pagehide">pagehide</a></code>イベントに対して、ページが最後の時間まで出かける場合はfalseを返す。そうでなければ、（何もページを最上にしないよう共謀しない場合）、ユーザーがこのページに戻る場合、ページが再利用されるかもしれないことを意味し、trueを返す。</p>

    <p>最上でないページを含む可能性があるもの：</p>

    <ul class="brief"><li><code data-anolis-xref="dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code>
     </li><li><code data-anolis-xref="event-beforeunload">beforeunload</code>イベントの待ち
     </li><li><code data-anolis-xref="event-unload">unload</code>イベントの待ち
     </li><li>最上でない<code><a href="embedded-content-0.html#the-iframe-element">iframe</a></code>を持っている
     </li><li>アクティブな<code>WebSocket</code>オブジェクト
     </li><li><a data-anolis-xref="abort a document" href="#abort-a-document"><code>Document</code>の中止</a>
    </li></ul></dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-PageTransitionEvent-persisted" id="dom-pagetransitionevent-persisted"><code>persisted</code></dfn> attribute must
  return the value it was initialized to. When the object is created, this attribute must be
  initialized to false. It represents the context information for the event.</p>

  </div>



  <h4 id="unloading-documents"><span class="secno">5.6.11</span> 文書の解放</h4>

  <div class="impl">

  <p>A <code><a href="dom.html#document">Document</a></code> has a <dfn data-anolis-xref="concept-document-salvageable" id="concept-document-salvageable"><i>salvageable</i></dfn> state, which must initially be true,
  a <dfn id="fired-unload">fired unload</dfn> flag, which must initially be false, and a <dfn id="page-showing">page showing</dfn> flag,
  which must initially be false.</p>

  <p><a data-anolis-xref="event loop" href="webappapis.html#event-loop">Event loops</a> have a <dfn id="termination-nesting-level">termination nesting level</dfn>
  counter, which must initially be zero.</p>

  <p>When a user agent is to <dfn id="prompt-to-unload-a-document">prompt to unload a document</dfn>, it must run the following
  steps.</p>

  <ol><li><p>Increase the <a href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level">termination nesting level</a> by
   one.</li>

   <li><p>Increase the <code><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by
   one.</li>

   <li><p>Let <var data-anolis-xref="">event</var> be a new <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>
   <code><a href="#beforeunloadevent">BeforeUnloadEvent</a></code> event object with the name <code data-anolis-xref="event-beforeunload">beforeunload</code>, which does not bubble but is cancelable.</li>

   <li><p><i>Dispatch</i>: <a data-anolis-xref="concept-event-dispatch" href="infrastructure.html#concept-event-dispatch">Dispatch</a> <var data-anolis-xref="">event</var> at the <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code> object.</li>

   <li><p>Decrease the <a href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level">termination nesting level</a> by
   one.</li>

   <li><p>Release the <a href="webappapis.html#storage-mutex">storage mutex</a>.</li>

   <li><p>If any event listeners were triggered by the earlier <i>dispatch</i> step, then set the
   <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to
   false.</li>

   <li>

    <p>If the <code data-anolis-xref="dom-BeforeUnloadEvent-returnValue"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute of the
    <var data-anolis-xref="">event</var> object is not the empty string, or if the event was canceled, then the
    user agent should ask the user to confirm that they wish to unload the document.</p>

    <p>The prompt shown by the user agent may include the string of the <code data-anolis-xref="dom-BeforeUnloadEvent-returnValue"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute, or some leading subset
    thereof. (A user agent may want to truncate the string to 1024 characters for display, for
    instance.)</p>

    <p>The user agent must <a href="webappapis.html#pause">pause</a> while waiting for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id="refused-to-allow-the-document-to-be-unloaded">refused to allow
    the document to be unloaded</dfn>.</p>

   </li>

   <li><p>If this algorithm was invoked by another instance of the "prompt to unload a document"
   algorithm (i.e. through the steps below that invoke this algorithm for all descendant browsing
   contexts), then jump to the step labeled <i>end</i>.</li>

   <li><p>Let <var data-anolis-xref="">descendants</var> be the <a href="#list-of-the-descendant-browsing-contexts">list of the descendant browsing
   contexts</a> of the <code><a href="dom.html#document">Document</a></code>.</li>

   <li>

    <p>If <var data-anolis-xref="">descendants</var> is not an empty list, then for each <a href="#browsing-context">browsing
    context</a> <var data-anolis-xref="">b</var> in <var data-anolis-xref="">descendants</var> run the following
    substeps:</p>

    <ol><li><p><a data-anolis-xref="prompt to unload a document" href="#prompt-to-unload-a-document">Prompt to unload</a> the <a href="#active-document">active
     document</a> of the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var>. If the user
     <a href="#refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then the user implicitly also <a data-anolis-xref="refused to allow the document to be unloaded" href="#refused-to-allow-the-document-to-be-unloaded">refused to allow <em>this</em> document to
     be unloaded</a>; jump to the step labeled <i>end</i>.</p>

     </li><li><p>If the <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state of the <a href="#active-document">active
     document</a> of the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> is false, then set
     the <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</li>

    </ol></li>

   <li><p><i>End</i>: Decrease the <code><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter">ignore-opens-during-unload
   counter</a> by one.</li>

  </ol><p>When a user agent is to <dfn id="unload-a-document">unload a document</dfn>, it must run the following steps. These
  steps are passed an argument, <var data-anolis-xref="">recycle</var>, which is either true or false,
  indicating whether the <code><a href="dom.html#document">Document</a></code> object is going to be re-used. (This is set by the
  <code data-anolis-xref="dom-document-open"><a href="webappapis.html#dom-document-open">document.open()</a></code> method.)</p>

  <ol><li><p>Increase the <a href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level">termination nesting level</a> by
   one.</li>

   <li><p>Increase the <code><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by
   one.</li>

   <li><p>If the <code><a href="dom.html#document">Document</a></code>'s <a href="#page-showing">page showing</a> flag is false, then jump to the
   step labeled <i>unload event</i> below (i.e. skip firing the <code data-anolis-xref="event-pagehide"><a href="#event-pagehide">pagehide</a></code> event and don't rerun the <a href="#unloading-document-visibility-change-steps">unloading document
   visibility change steps</a>).</li>

   <li><p>Set the <code><a href="dom.html#document">Document</a></code>'s <a href="#page-showing">page showing</a> flag to false.</li>

   <li><p><a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">Fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a> event with the name <code data-anolis-xref="event-pagehide"><a href="#event-pagehide">pagehide</a></code> at the <code><a href="#window">Window</a></code> object of the
   <code><a href="dom.html#document">Document</a></code>, but with its <code data-anolis-xref="dom-event-target"><a href="infrastructure.html#dom-event-target">target</a></code> set to the
   <code><a href="dom.html#document">Document</a></code> object (and the <code data-anolis-xref="dom-event-currentTarget">currentTarget</code>
   set to the <code><a href="#window">Window</a></code> object), using the <code><a href="#pagetransitionevent">PageTransitionEvent</a></code> interface,
   with the <code data-anolis-xref="dom-PageTransitionEvent-persisted"><a href="#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialized
   to true if the <code><a href="dom.html#document">Document</a></code> object's <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state is true, and false otherwise. This
   event must not bubble, must not be cancelable, and has no default action.</li>

   <li>

    <p>Run any <dfn id="unloading-document-visibility-change-steps">unloading document visibility change steps</dfn> for <code><a href="dom.html#document">Document</a></code> that
    are defined by <a href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</p>

    <p class="note">This is specifically intended for use by the Page Visibility specification. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>

   </li>

   <li><p><i>Unload event</i>: If the <code><a href="dom.html#document">Document</a></code>'s <a href="#fired-unload">fired unload</a> flag is
   false, <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <code data-anolis-xref="event-unload">unload</code> at the
   <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code> object.</li>

   <li><p>Decrease the <a href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level">termination nesting level</a> by
   one.</li>

   <li><p>Release the <a href="webappapis.html#storage-mutex">storage mutex</a>.</li>

   <li><p>If any event listeners were triggered by the earlier <i>unload event</i> step, then set
   the <code><a href="dom.html#document">Document</a></code> object's <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state
   to false and set the <code><a href="dom.html#document">Document</a></code>'s <a href="#fired-unload">fired unload</a> flag to true.</li>

   <li><p>Run any <a href="#unloading-document-cleanup-steps">unloading document cleanup steps</a> for <code><a href="dom.html#document">Document</a></code> that are
   defined by this specification and <a href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</li>

   <li><p>If this algorithm was invoked by another instance of the "unload a document" algorithm
   (i.e. by the steps below that invoke this algorithm for all descendant browsing contexts), then
   jump to the step labeled <i>end</i>.</li>

   <li><p>Let <var data-anolis-xref="">descendants</var> be the <a href="#list-of-the-descendant-browsing-contexts">list of the descendant browsing
   contexts</a> of the <code><a href="dom.html#document">Document</a></code>.</li>

   <li>

    <p>If <var data-anolis-xref="">descendants</var> is not an empty list, then for each <a href="#browsing-context">browsing
    context</a> <var data-anolis-xref="">b</var> in <var data-anolis-xref="">descendants</var> run the following
    substeps:</p>

    <ol><li><p><a data-anolis-xref="unload a document" href="#unload-a-document">Unload</a> the <a href="#active-document">active document</a> of the
     <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> with the <var data-anolis-xref="">recycle</var>
     parameter set to false.</li>

     <li><p>If the <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state of the <a href="#active-document">active
     document</a> of the <a href="#browsing-context">browsing context</a> <var data-anolis-xref="">b</var> is false, then set
     the <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state of <em>this</em> document to
     false also.</li>

    </ol></li>

   <li><p>If both the <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state and <var data-anolis-xref="">recycle</var> are
   false, then the <code><a href="dom.html#document">Document</a></code>'s <a href="#browsing-context">browsing context</a> must <a data-anolis-xref="discard a
   document" href="#discard-a-document">discard the <code>Document</code></a>.</li>

   <li><p><i>End</i>: Decrease the <code><a href="dom.html#document">Document</a></code>'s <a href="webappapis.html#ignore-opens-during-unload-counter">ignore-opens-during-unload
   counter</a> by one.</li>

  </ol><p>This specification defines the following <dfn id="unloading-document-cleanup-steps">unloading document cleanup steps</dfn>. Other
  specifications can define more.</p>

  <ol><li>

    <p><span>Make disappear</span> any <code>WebSocket</code> objects that were created by the <code data-anolis-xref="dom-WebSocket">WebSocket()</code> constructor from the
    <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code> object.</p>

    <p>If this affected any <code>WebSocket</code> objects, then set <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to false.</p>

   </li>

   <li><p>If the <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i>
   state is false, <span data-anolis-xref="concept-EventSource-forcibly-close">forcibly close</span> any
   <code><a href="infrastructure.html#eventsource">EventSource</a></code> objects that whose constructor was invoked from the
   <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code> object.</li>

   <li><p>If the <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i>
   state is false, empty the <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code>'s <a href="webappapis.html#list-of-active-timers">list of active
   timers</a>.</li>

  </ol><h5 id="event-definition"><span class="secno">5.6.11.1 </span>Event definition</h5>

  </div>

  <pre class="idl">interface <dfn id="beforeunloadevent">BeforeUnloadEvent</dfn> : <a href="infrastructure.html#event">Event</a> {
           attribute DOMString <a data-anolis-xref="dom-BeforeUnloadEvent-returnValue" href="#dom-beforeunloadevent-returnvalue">returnValue</a>;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">event</var> . <code data-anolis-xref="dom-BeforeUnloadEvent-returnValue"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code> [ = <var data-anolis-xref="">value</var> ]</dt>

   <dd>

    <p>イベントの現在の戻り値（ユーザーに表示するメッセージ）を返す。</p>

    <p>メッセージを更新する設定が可能である。</p>

   </dd>

  </dl><p class="note"><code><a href="#beforeunloadevent">BeforeUnloadEvent</a></code>固有の初期化メソッドは存在しない。</p>

  <div class="impl">

  <p>The <dfn data-anolis-xref="dom-BeforeUnloadEvent-returnValue" id="dom-beforeunloadevent-returnvalue"><code>returnValue</code></dfn> attribute
  represents the message to show the user. When the event is created, the attribute must be set to
  the empty string. On getting, it must return the last value it was set to. On setting, the
  attribute must be set to the new value.</p>

  </div>


  <div class="impl">

  <h4 id="aborting-a-document-load"><span class="secno">5.6.12 </span>Aborting a document load</h4>

  <p>If a <code><a href="dom.html#document">Document</a></code> is <dfn data-anolis-xref="abort a document" id="abort-a-document">aborted</dfn>, the user agent must
  run the following steps:</p>

  <ol><li><p><a data-anolis-xref="abort a document" href="#abort-a-document">Abort</a> the <a data-anolis-xref="active document" href="#active-document">active
   documents</a> of every <a href="#child-browsing-context">child browsing context</a>. If this results in any of those
   <code><a href="dom.html#document">Document</a></code> objects having their <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state set to false, then set this
   <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to false
   also.</li>

   <li><p>Cancel any instances of the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetch</a> algorithm in the context of
   this <code><a href="dom.html#document">Document</a></code>, discarding any <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> <a data-anolis-xref="queue a task" href="webappapis.html#queue-a-task">queued</a> for them, and discarding any further data received from the
   network for them. If this resulted in any instances of the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetch</a>
   algorithm being canceled or any <a data-anolis-xref="queue a task" href="webappapis.html#queue-a-task">queued</a> <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> or any network data getting discarded, then set the
   <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to
   false.</li>

   <li><p>If the <code><a href="dom.html#document">Document</a></code> has an <a href="dom.html#active-parser">active parser</a>, then <a data-anolis-xref="abort a
   parser" href="syntax.html#abort-a-parser">abort that parser</a> and set the <code><a href="dom.html#document">Document</a></code>'s <i data-anolis-xref="concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to false.</li>

   <!-- we could also stop all script, or stop animations -->

  </ol><p>User agents may allow users to explicitly invoke the <a data-anolis-xref="abort a document" href="#abort-a-document">abort a
  document</a> algorithm for a <code><a href="dom.html#document">Document</a></code>. If the user does so, then, if that
  <code><a href="dom.html#document">Document</a></code> is an <a href="#active-document">active document</a>, the user agent should <a href="webappapis.html#queue-a-task">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <code data-anolis-xref="event-abort">abort</code> at
  that <code><a href="dom.html#document">Document</a></code>'s <code><a href="#window">Window</a></code> object before invoking the <a data-anolis-xref="abort a
  document" href="#abort-a-document">abort</a> algorithm.</p>

  <!-- I'd love to make this more precise, anyone have any suggestions on what it should say? -->

  </div><!--TOPIC:Offline Web Applications-->



  <h3 id="offline"><span class="secno">5.7</span> オフラインウェブアプリケーション</h3><!-- v2 ideas for appcache:

     * A way to limit what gets download when the user agent is updating the application cache and
       it turns out the server has changed EVERY page because every page has a dynamic "site last
       modified" date on it.

       http://groups.google.com/group/gears-users/browse_thread/thread/efbd808325df607a/c73adb34f9b63cf7?hl=en&q=whatwg#c73adb34f9b63cf7


     * Multiuser appcaches.

       If the application code (HTML, JS, CSS) is all the same for two users, then appcache works
       for multiple users by just having the data for the users separate from the logic.

       This is the expected model for most apps. For example, your typical blog has just one set of
       CSS for all users.

       For systems where the user affects what HTML, JS, and CSS is served back, the spec as written
       pretty much requires that there be one app per user, and one generic "login" app that then
       redirects to one of those other apps - and where each app has a different base URL, separate
       manifest, etc.

       An alternative that we could explore in a future version is to have the manifest include a
       manifest name, and then have script that allows you to "activate" a particular manifest name
       for a given appcache.

       So each appcache group would be further subdivided into named subgroups, and for a given
       manifest URL with such a group of subgroups, one subgroup would be the default one at a time.
       The inactive ones would just lie dormant, but and the active ones would act like now, but
       there'd be a scripted way to change the default (and maybe query what available variants
       exist for the current appcache), so that you could log back in as someone else by just making
       the script pick the other user's variant, and then reloading.


     * Add and remove specific additional files from the cache (e.g. precaching new master entries).

  -->

  

  <h4 id="introduction-3"><span class="secno">5.7.1</span> 導入</h4>

  <p><i>この節は非規範的である。</i></p>
  <p>ネットワーク接続が利用できない場合―たとえば、ユーザーがISPのカバレッジエリアの外に移動しているため―でも、ユーザーにウェブアプリケーションおよび文書との対話を継続できるようにするために、著者は、オフラインで作業し、オフラインで使用のためにファイルのコピーを保持するためにユーザーのブラウザになる、ウェブアプリケーション用に必要とされるファイルの一覧を示したマニフェストを提供できる。</p>

  <p>これを説明するために、HTMLページ"<code data-anolis-xref="">clock.html</code>"、CSSスタイルシート"<code data-anolis-xref="">clock.css</code>"、およびJavaScriptスクリプト"<code data-anolis-xref="">clock.js</code>"から成る単純な時計アプレットを考えてみる。</p>

  <p>マニフェストを追加する前に、これらの3つのファイルは次のようになる：</p>

  <pre>EXAMPLE offline/clock/clock1.html</pre>
  <pre>EXAMPLE offline/clock/clock1.css</pre>
  <pre>EXAMPLE offline/clock/clock1.js</pre>

  <p>ユーザーがオフライン時に"<code data-anolis-xref="">clock.html</code>"ページを開こうとする場合、しかし、（ローカルキャッシュにまだ持つ場合を除いて）ユーザーエージェントはエラーとともに失敗する。</p>

  <p>著者は、代わりに"<code data-anolis-xref="">clock.appcache</code>"という、3つのファイルのマニフェストを提供できる：</p>

  <pre>EXAMPLE offline/clock/clock2.appcache</pre>

  <p>HTMLファイルへの小さな変化とともに、（<code><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>で提供される）マニフェストがアプリケーションにリンクされている：</p>

  <pre>EXAMPLE offline/clock/clock2.html</pre>

  <p>さて、ユーザーがページに行く場合、ブラウザはファイルをキャッシュし、ユーザーがオフラインである場合でも、それらを使用できるようにする。</p>

  <p class="note">著者はまた、マニフェストのメインページを含めることを推奨するが、実際にマニフェストを参照されるページは、明示的に言及されない場合でも、自動的にキャッシュされる。</p>

  <p class="note">"no-store"ディレクティブ例外とともに、TLSで供給される（<code data-anolis-xref="">https:</code>を使用して暗号化される）キャッシュページでのHTTPキャッシュヘッダーと制限は、マニフェストによって上書きされる。したがって、ページは、ユーザーエージェントがそれを更新する前にアプリケーションキャッシュから期限切れにならず、TLS経由で提供されるアプリケーションはオフラインで動作させることができる。</p>

  <p><a href="http://www.whatwg.org/demos/offline/clock/live-demo/clock.html">この例をオンラインで見る</a>。</p>



  <h5 id="supporting-offline-caching-for-legacy-applications"><span class="secno">5.7.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート</h5>

  <p><i>この節は非規範的である。</i></p>
  <p>マニフェストに記載されかつアプリケーションキャッシュに格納されたロジック（マークアップ、スクリプト、スタイルシート、画像など）とともに、アプリケーションに対する有限数の静的HTMLページとともに、およびウェブストレージまたはサーバ側にインデックス付けされたデータベースに格納されたアプリケーションおよびユーザデーターとともに、アプリケーションロジックがアプリケーションとユーザデータから別れる場合、アプリケーションキャッシュ機能は最も機能的に動作し、ウェブソケット、<code><a href="infrastructure.html#xmlhttprequest">XMLHttpRequest</a></code>、サーバに送信されるイベント、または他の同様の機構を使用して動的に更新される。</p>

  <p>このモデルはユーザーに対して高速な経験をもたらす：（おそらく古いデータを示しつつ）アプリケーション即時に読み込み、ネットワークがそれを可能にするように、新鮮なデータを高速に得られる。</p>

  <p>しかし、レガシーアプリケーションは、サーバから新しいHTMLページで得られた各操作とともに、ユーザーデータおよびロジックがHTMLと一緒に混合されるように設計される傾向にある。</p>

  <div class="example">

   <p>たとえば、ニュースアプリケーションを考えてみよう。このようなアプリケーションの典型的なアーキテクチャは、アプリケーションキャッシュ機能を使用しない場合、ユーザーはメインページをフェッチし、サーバーは現在の見出しとユーザーインタフェースロジックを一緒に混合した動的に生成されるページを返す。</p>

   <p>しかし、アプリケーションキャッシュ機能のために設計されたニュースアプリケーションは、ロジックでのみ構成されるメインページを代わりに持つだろうし、メインページがサーバとは別にデータをフェッチしているだろう。たとえば、<code><a href="infrastructure.html#xmlhttprequest">XMLHttpRequest</a></code>を使用して。</p>

  </div>

  <p>混合コンテンツモデルは、アプリケーションのキャッシュ機能とともにうまく動作しない：コンテンツがキャッシュされているので、常にキャッシュが更新された前回から古いデータを見て、ユーザーにもたらすだろう。</p>

  <p>分離されたモデルと同じ速さで、従来のモデルを動作させる方法がないが、それは少なくとも<a data-anolis-xref="concept-appcache-mode-prefer-online" href="#concept-appcache-mode-prefer-online">好ましいオンライン</a><a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">アプリケーションキャッシュモード</a>を使用してオフライン利用で使用するために改造<em>できる</em>。これを行うには、<a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">アプリケーションキャッシュマニフェスト</a>でオフライン作業をしたいHTMLページによって使用されるすべての静的リソースを一覧表示し、HTMLファイルからそのマニフェストを選択する<code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>属性を使用し、マニフェストの一番下に次の行を追加する：</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>ユーザーがオフラインである際に、許可するすべてのリソースが通常アクセスされるマニフェストに記載されていない一方で、これは、<a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">マスターエントリ</a>にのみ使用される<a href="#application-cache">アプリケーションキャッシュ</a>を引き起こし、（本質的にマニフェストに記載されているリソースをピン留めする）分割不能なHTTPキャッシュとして使用されるアプリケーションキャッシュを引き起こす。</p>



  <h5 id="appcacheevents"><span class="secno">5.7.1.2</span> イベントの概要</h5>

  <p><i>この節は非規範的である。</i></p>
  <p>ユーザーがマニフェストを宣言するページを訪問する際に、ブラウザはキャッシュを更新しようとする。これは、ユーザーエージェントが最後にそれを見てからマニフェストが変更された場合、それが言及されているすべてのリソースを再ダウンロードして改めてキャッシュし、マニフェストのコピーを取得することによってこれを行う。</p>

  <p>これが起こっているように、ユーザーに適切な方法で通知できるように、イベントの数は、キャッシュの更新の状態へと更新されたスクリプトを保つために<code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトで発火する。イベントは次のとおり：</p>

  <table><thead><tr><th> イベント名
     </th><th> インターフェース
     </th><th> 発火条件
     </th><th> 次のイベント
   <tbody></th></tr><tr><td> <dfn data-anolis-xref="event-appcache-checking" id="event-appcache-checking"><code>checking</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> ユーザーエージェントは、更新をチェックする、または初回のマニフェストをダウンロードしようとしている。<strong>これは、常にシーケンスの最初のイベントである。</strong>
     </td><td> <code data-anolis-xref="event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code>、<code data-anolis-xref="event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code>、<code data-anolis-xref="event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code>、<code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code>

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-noupdate" id="event-appcache-noupdate"><code>noupdate</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> マニフェストは変更されなかった。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-downloading" id="event-appcache-downloading"><code>downloading</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> ユーザーエージェントは更新を発見し、それをフェッチしている、または初回のマニフェストで記載されたリソースをダウンロードしている。
     </td><td> <code data-anolis-xref="event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>、<code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code>、<code data-anolis-xref="event-appcache-cached"><a href="#event-appcache-cached">cached</a></code>、<code data-anolis-xref="event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-progress" id="event-appcache-progress"><code>progress</code></dfn>
     </td><td> <code><a href="infrastructure.html#progressevent">ProgressEvent</a></code>
     </td><td> ユーザーエージェントは、マニフェストで記載されたリソースをダウンロードしている。イベントオブジェクトの<code data-anolis-xref="dom-ProgressEvents-total">total</code>属性は、ダウンロードされたファイルの合計数を返す。イベントオブジェクトの<code data-anolis-xref="dom-ProgressEvents-loaded">loaded</code>属性は、これまでに処理されたファイルの数を返す。
     </td><td> <code data-anolis-xref="event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>、<code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code>、<code data-anolis-xref="event-appcache-cached"><a href="#event-appcache-cached">cached</a></code>、<code data-anolis-xref="event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-cached" id="event-appcache-cached"><code>cached</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> マニフェストに記載されたリソースがダウンロードされ、アプリケーションがキャッシュされた。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-updateready" id="event-appcache-updateready"><code>updateready</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> マニフェストに記載されたリソースは新しく再ダウンロードされており、スクリプトは新しいキャッシュに切り替えるために<code data-anolis-xref="dom-appcache-swapCache"><a href="#dom-appcache-swapcache">swapCache()</a></code>を使用できる。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td> <dfn data-anolis-xref="event-appcache-obsolete" id="event-appcache-obsolete"><code>obsolete</code></dfn>
     </td><td> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> マニフェストは404または410ページになっていることが判明し、アプリケーションのキャッシュを削除している。
     </td><td> シーケンス内の最後のイベント。

    </td></tr><tr><td rowspan="4"> <dfn data-anolis-xref="event-appcache-error" id="event-appcache-error"><code>error</code></dfn>
     </td><td rowspan="4"> <code><a href="infrastructure.html#event">Event</a></code>
     </td><td> マニフェストが404または410ページだったので、アプリケーションをキャッシュする試みが中止された。
     </td><td rowspan="3"> シーケンス内の最後のイベント。

    </td></tr><tr><td> マニフェストは変更されなかったが、マニフェストを参照するページが正しくダウンロードでなかった。

    </td></tr><tr><td> マニフェストに記載されたリソースを取得するときに致命的なエラーが発生した。

    </td></tr><tr><td> 更新されている間にマニフェストが変更された。
     </td><td> ユーザーエージェントは、再び一時的にファイルを取得しようする。

  </td></tr></table><p>これらのイベントはキャンセル可能である。それらのデフォルトアクションは、ダウンロードの進捗情報を表示するためのユーザエージェントに対するものである。ページが独自のアップデートのUIが表示する場合、イベントのキャンセルは、冗長な進捗情報の表示からユーザーエージェントを防ぐだろう。</p>



  <div class="impl">

  <h4 id="appcache"><span class="secno">5.7.2 </span>Application caches</h4> <!--APPCACHE-->

  <p>An <dfn id="application-cache">application cache</dfn> is a set of cached resources consisting of:</p>

  <ul><li>

    <p>One or more resources (including their out-of-band metadata, such as HTTP headers, if any),
    identified by URLs, each falling into one (or more) of the following categories:</p>

    <dl><dt><dfn data-anolis-xref="concept-appcache-master" id="concept-appcache-master">Master entries</dfn>

     <dd><p class="note">These are documents that were added to the cache because a <a href="#browsing-context">browsing
     context</a> was <a data-anolis-xref="navigate" href="#navigate">navigated</a> to that document and the document
     indicated that this was its cache, using the <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>
     attribute.</p>


     <dt><dfn data-anolis-xref="concept-appcache-manifest" id="concept-appcache-manifest">The manifest</dfn>

     <dd><p class="note">This is the resource corresponding to the URL that was given in a master
     entry's <code><a href="semantics.html#the-html-element">html</a></code> element's <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute.
     The manifest is fetched and processed during the <a href="#application-cache-download-process">application cache download
     process</a>. All the <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master entries</a> have the
     <a data-anolis-xref="same origin" href="#same-origin">same origin</a> as the manifest.</p>


     <dt><dfn data-anolis-xref="concept-appcache-explicit" id="concept-appcache-explicit">Explicit entries</dfn>

     <dd><p class="note">These are the resources that were listed in the cache's <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> in an <a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">explicit section</a>.</p>


     <dt><dfn data-anolis-xref="concept-appcache-fallback" id="concept-appcache-fallback">Fallback entries</dfn>

     <dd><p class="note">These are the resources that were listed in the cache's <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> in a <a data-anolis-xref="concept-appcache-manifest-fallback" href="#concept-appcache-manifest-fallback">fallback section</a>.</p>


    </dl><p><a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">Explicit entries</a> and <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">Fallback entries</a> can be marked as <dfn data-anolis-xref="concept-appcache-foreign" id="concept-appcache-foreign">foreign</dfn>, which means that they have a <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute but that it doesn't point at this cache's
    <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a>.</p>

    <p class="note">A URL in the list can be flagged with multiple different types, and thus an
    entry can end up being categorized as multiple entries. For example, an entry can be a manifest
    entry and an explicit entry at the same time, if the manifest is listed within the manifest.</p>

   </li>

   <li>

    <p>Zero or more <dfn data-anolis-xref="concept-appcache-fallback-ns" id="concept-appcache-fallback-ns">fallback namespaces</dfn>, each of
    which is mapped to a <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entry</a>.</p>

    <p class="note">These are URLs used as <a data-anolis-xref="concept-appcache-matches-fallback" href="#concept-appcache-matches-fallback">prefix
    match patterns</a> for resources that are to be fetched from the network if possible, or to
    be replaced by the corresponding <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entry</a>
    if not. Each namespace URL has the <a href="#same-origin">same origin</a> as <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">the manifest</a>.</p>

   </li>

   <li>

    <p>Zero or more URLs that form the <dfn data-anolis-xref="concept-appcache-onlinewhitelist" id="concept-appcache-onlinewhitelist">online
    whitelist namespaces</dfn>.</p>

    <p class="note">These are used as prefix match patterns, and declare URLs for which the user
    agent will ignore the application cache, instead fetching them normally (i.e. from the network
    or local HTTP cache as appropriate).</p>

   </li>

   <li>

    <p>An <dfn data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" id="concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard
    flag</dfn>, which is either <i data-anolis-xref="">open</i> or <i data-anolis-xref="">blocking</i>.</p>

    <p class="note">The <i data-anolis-xref="">open</i> state indicates that any URL not listed as cached is to
    be implicitly treated as being in the <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online
    whitelist namespaces</a>; the <i data-anolis-xref="">blocking</i> state indicates that URLs not listed
    explicitly in the manifest are to be treated as unavailable.</p>

   </li>

   <li>

    <p>A <dfn data-anolis-xref="concept-appcache-mode" id="concept-appcache-mode">cache mode flag</dfn>, which is either in the <dfn data-anolis-xref="concept-appcache-mode-fast" id="concept-appcache-mode-fast"><i>fast</i></dfn> state or the <dfn data-anolis-xref="concept-appcache-mode-prefer-online" id="concept-appcache-mode-prefer-online"><i>prefer-online</i></dfn> state.</p>

   </li>

  </ul><p>Each <a href="#application-cache">application cache</a> has a <dfn data-anolis-xref="concept-appcache-completeness" id="concept-appcache-completeness">completeness flag</dfn>, which is either <i>complete</i> or
  <i>incomplete</i>.</p>

  <hr><p>An <dfn id="application-cache-group">application cache group</dfn> is a group of <a data-anolis-xref="application cache" href="#application-cache">application
  caches</a>, identified by the <a href="infrastructure.html#absolute-url">absolute URL</a> of a resource <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> which is used to populate the caches in the
  group.</p>

  <p>An <a href="#application-cache">application cache</a> is <dfn data-anolis-xref="concept-appcache-newer" id="concept-appcache-newer">newer</dfn> than
  another if it was created after the other (in other words, <a data-anolis-xref="application
  cache" href="#application-cache">application caches</a> in an <a href="#application-cache-group">application cache group</a> have a chronological
  order).</p>

  <p>Only the newest <a href="#application-cache">application cache</a> in an <a href="#application-cache-group">application cache group</a> can
  have its <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> set to
  <i>incomplete</i>; the others are always all <i>complete</i>.</p>

  <p>Each <a href="#application-cache-group">application cache group</a> has an <dfn data-anolis-xref="concept-appcache-status" id="concept-appcache-status">update
  status</dfn>, which is one of the following: <i>idle</i>, <i>checking</i>, <i>downloading</i>.</p>

  <p>A <dfn id="relevant-application-cache">relevant application cache</dfn> is an <a href="#application-cache">application cache</a> that is the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> in its <a data-anolis-xref="application cache
  group" href="#application-cache-group">group</a> to be <i>complete</i>.</p>

  <p>Each <a href="#application-cache-group">application cache group</a> has a <dfn data-anolis-xref="concept-appcache-pending-masters" id="concept-appcache-pending-masters">list of pending master entries</dfn>. Each entry in this
  list consists of a resource and a corresponding <code><a href="dom.html#document">Document</a></code> object. It is used during
  the <a href="#application-cache-download-process">application cache download process</a> to ensure that new master entries are cached
  even if the <a href="#application-cache-download-process">application cache download process</a> was already running for their
  <a href="#application-cache-group">application cache group</a> when they were loaded.</p>

  <p>An <a href="#application-cache-group">application cache group</a> can be marked as <dfn data-anolis-xref="concept-appcache-obsolete" id="concept-appcache-obsolete">obsolete</dfn>, meaning that it must be ignored when looking at
  what <a data-anolis-xref="application cache group" href="#application-cache-group">application cache groups</a> exist.</p>

  <hr><p>A <dfn id="cache-host">cache host</dfn> is a <code><a href="dom.html#document">Document</a></code> or a <code>SharedWorkerGlobalScope</code>
  object. A <a href="#cache-host">cache host</a> can be associated with an <a href="#application-cache">application cache</a>.
    <a href="references.html#refsWEBWORKERS">[WEBWORKERS]</a>
    </p>

  <p>A <code><a href="dom.html#document">Document</a></code> initially is not associated with an <a href="#application-cache">application cache</a>, but
  can become associated with one early during the page load process, when steps <a href="syntax.html#parser-appcache">in the parser</a> and in the <a data-anolis-xref="navigate" href="#navigate">navigation</a>
  sections cause <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">cache selection</a> to occur.</p>

  <p>A <code>SharedWorkerGlobalScope</code> can be associated with an <a href="#application-cache">application cache</a>
  when it is created.
    <a href="references.html#refsWEBWORKERS">[WEBWORKERS]</a>
    </p>

  <p>Each <a href="#cache-host">cache host</a> has an associated <code><a href="#applicationcache">ApplicationCache</a></code> object.</p>

  <hr><p>Multiple <a data-anolis-xref="application cache" href="#application-cache">application caches</a> in different <a data-anolis-xref="application cache group" href="#application-cache-group">application cache groups</a> can contain the same resource,
  e.g. if the manifests all reference that resource. If the user agent is to <dfn data-anolis-xref="concept-appcache-selection" id="concept-appcache-selection">select an application cache</dfn> from a list of <a data-anolis-xref="relevant application cache" href="#relevant-application-cache">relevant application caches</a> that contain a resource, the
  user agent must use the application cache that the user most likely wants to see the resource
  from, taking into account the following:</p>

  <ul><li>which application cache was most recently updated,

   </li><li>which application cache was being used to display the resource from which the user decided to
   look at the new resource, and

   </li><li>which application cache the user prefers.

  </li></ul><hr><p>A URL <dfn data-anolis-xref="concept-appcache-matches-fallback" id="concept-appcache-matches-fallback">matches a fallback namespace</dfn> if
  there exists a <a href="#relevant-application-cache">relevant application cache</a> whose <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a>'s URL has the <a href="#same-origin">same origin</a> as the
  URL in question, and that has a <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback
  namespace</a> that is a <a href="infrastructure.html#prefix-match">prefix match</a> for the URL being examined. If multiple
  fallback namespaces match the same URL, the longest one is the one that matches. A URL looking for
  a fallback namespace can match more than one application cache at a time, but only matches one
  namespace in each cache.</p>

  <div class="example">

   <p>If a manifest <code data-anolis-xref="">http://example.com/app1/manifest</code> declares that <code data-anolis-xref="">http://example.com/resources/images</code> is a fallback namespace, and the user
   navigates to <code data-anolis-xref="">HTTP://EXAMPLE.COM:80/resources/images/cat.png</code>, then the user
   agent will decide that the application cache identified by <code data-anolis-xref="">http://example.com/app1/manifest</code> contains a namespace with a match for that
   URL.</p>

   <!-- "resolve a url" canonicalises the case for the scheme and host and removes the port if it is
   the default -->

  </div>

  </div>



  <h4 id="manifests"><span class="secno">5.7.3</span> キャッシュマニフェスト構文</h4>


  <h5 id="some-sample-manifests"><span class="secno">5.7.3.1</span> サンプルマニフェスト</h5>

  <p><i>この節は非規範的である。</i></p>
  <div class="example">

   <p>この例のマニフェストは、2つの画像およびキャッシュされたスタイルシートおよびホワイトリストのCGIスクリプトを要求する。</p>

   <pre>CACHE MANIFEST
# the above line is required

# this is a comment
# there can be as many of these anywhere in the file
# they are all ignored
  # comments can have spaces before them
  # but must be alone on the line

# blank lines are ignored too

# these are files that need to be cached they can either be listed
# first, or a "CACHE:" header could be put before them, as is done
# lower down.
images/sound-icon.png
images/background.png
# note that each file has to be put on its own line

# here is a file for the online whitelist -- it isn't cached, and
# references to this file will bypass the cache, always hitting the
# network (or trying to, if the user is offline).
NETWORK:
comm.cgi

# here is another set of files to cache, this time just the CSS file.
CACHE:
style/default.css</pre>

   <p>同様に次のように記述できる：</p>

   <pre>CACHE MANIFEST
NETWORK:
comm.cgi
CACHE:
style/default.css
images/sound-icon.png
images/background.png</pre>

  </div>

  <div class="example">

   <p>オフラインアプリケーションキャッシュマニフェストは、絶対パスまたは絶対URLを使用できる：</p>

   <pre>CACHE MANIFEST

/main/home
/main/app.js
/settings/home
/settings/app.js
http://img.example.com/logo.png
http://img.example.com/check.png
http://img.example.com/cross.png</pre>

  </div>

  <div class="example">

   <p>次のマニフェストは、ユーザーがオフラインの間にサイト上の任意のページに表示されている汎用のエラーページを定義する。これはまた、<a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">オンラインホワイトワイルドカードフラグ</a>が<i data-anolis-xref="">open</i>であることを指定し、他のサイト上のリソースにアクセスがブロックされないことを意味する。（汎用フォールバック名前空間なので、同じサイト上のリソースがすでにブロックされない。）</p>

   <p>このマニフェスト上のすべてのページのように、同じページにヒットする後続はキャッシュからすぐに読み込まれるので、それらが取得されるようにローカルでキャッシュされるだろう。マニフェストが変更されるまで、これらのページは、再度サーバから取得されることはない。マニフェストが変更される際、次にすべてのファイルが再ダウンロードされる。</p>

   <p>スタイルシートや画像などのようなサブリソースは、しかし、通常のHTTPキャッシングセマンティックを使用してのみキャッシュされる。</p>

   <pre>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</pre>

  </div>


  <h5 id="writing-cache-manifests"><span class="secno">5.7.3.2</span> キャッシュマニフェストの記述</h5>

  <p>マニフェストは、<code><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code><a href="infrastructure.html#mime-type">MIMEタイプ</a>を使用して配信しなければならない。<code><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code><a href="infrastructure.html#mime-type">MIMEタイプ</a>を使用して配信されるすべてのリソースは、この節で説明するように、アプリケーションキャッシュマニフェストの構文に従わなければならない。</p>

  <p>アプリケーションキャッシュマニフェストは、テキストがUTF-8を使用してエンコードされるテキストファイルである。アプリケーションキャッシュマニフェストでのデータは行ベースである。改行は、"LF"（U+000A）文字、"CR"（U+000D）文字、または"CR"（U+000D）"LF"（U+000A）のペアで表されなければならない。<a href="references.html#refsRFC3629">[RFC3629]</a></p>

  <p class="note">これは、すべての<code data-anolis-xref="">text/*</code>型が唯一のCRLF改行を許可する必要がある、RFC 2046の<a href="introduction.html#willful-violation">故意の違反</a>である。しかし、この要件は時代遅れである。CR、LFおよびCRLFの改行の使用は一般的に支持されており、実際に時にCRLFはテキストエディタでサポートされ<em>ない</em>。<a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>アプリケーションキャッシュマニフェストの最初の行は、文字列"CACHE"、単一のU+0020 SPACE文字、文字列"MANIFEST"、およびU+0020 SPACE文字、"tab"（U+0009）文字、"LF"（U+000A）文字、または"CR"（U+000D）文字のいずれかで構成しなければならない。最初の行は、任意で"BOM"（U+FEFF）文字を付けてもよい。他のテキストが最初の行にある場合、無視される。</p>

  <p>後続の行がもしあれば、すべて次のいずれかでなければならない：</p>

  <dl><dt>空白行
   <dd>
    <p>空白行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字のみで構成しなければならない。</p>

   <dt>コメント
   <dd>
    <p>コメント行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字に続いて、単一の"#"（U+0023）文字が続き、0個以上の"LF"（U+000A）および"CR"（U+000D）文字以外の文字が続くもので構成されなければならない。</p>

    <p class="note">コメントは自身のみで行になければならない。コメントがURLを持つ行に含まれる場合、"#"はフラグメント識別子の一部に間違えられるだろう。</p>

   <dt>セクションヘッダ
   <dd>

    <p>セクションヘッダは、現在のセクションを変更する。可能な4つのセクションヘッダが存在する：

    <dl><dt><code>CACHE:</code>
     <dd><dfn data-anolis-xref="concept-appcache-manifest-explicit" id="concept-appcache-manifest-explicit">明示的なセクション</dfn>に切り替える。

     <dt><code>FALLBACK:</code>
     <dd><dfn data-anolis-xref="concept-appcache-manifest-fallback" id="concept-appcache-manifest-fallback">代替セクション</dfn>に切り替える。

     <dt><code>NETWORK:</code>
     <dd><dfn data-anolis-xref="concept-appcache-manifest-network" id="concept-appcache-manifest-network">オンラインホワイトリストセクション</dfn>に切り替える。

     <dt><code>SETTINGS:</code>
     <dd><dfn data-anolis-xref="concept-appcache-manifest-settings" id="concept-appcache-manifest-settings">設定セクション</dfn>に切り替える。

    </dl><p>セクションヘッダ行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字に続き、上記の名前（":)"（U+003A）文字を含む）のいずれかの後にゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字で構成されなければならない。</p>

    <p>皮肉なことに、デフォルトでは、現在のセクションは、<a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">明示的なセクション</a>である。</p>

   <dt>現在のセクションのデータ
   <dd>

    <p>データ行が取得しなければならない形式は、現在のセクションに依存する。</p>

    <p>現在のセクションが<a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">明示的なセクション</a>である場合、データ行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字、マニフェスト自体以外のリソースを識別する<a href="infrastructure.html#valid-url">妥当なURL</a>、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字で構成されなければならない。</p>

    <p>現在のセクションが<a data-anolis-xref="concept-appcache-manifest-fallback" href="#concept-appcache-manifest-fallback">フォールバックセクション</a>である場合、データ行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字、マニフェスト自身以外のリソースを識別する<a href="infrastructure.html#valid-url">妥当なURL</a>、1つ以上のU+0020 SPACEおよび"tab"（U+0009）文字、マニフェスト自身以外のリソースを識別する別の<a href="infrastructure.html#valid-url">妥当なURL</a>、およびゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字で構成されなければならない。</p>

    <p>現在のセクションが<a data-anolis-xref="concept-appcache-manifest-network" href="#concept-appcache-manifest-network">オンラインホワイトリストセクション</a>である場合、データ行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字、単一の"*"（U+002A）文字またはマニフェスト自体以外のリソースを識別する<a href="infrastructure.html#valid-url">妥当なURL</a>のいずれか、およびゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字で構成されなければならない。</p>

    <p>現在のセクションが<a data-anolis-xref="concept-appcache-manifest-settings" href="#concept-appcache-manifest-settings">設定セクション</a>である場合、データ行は、ゼロ個以上のU+0020 SPACEおよび"tab"（U+0009）文字、<a data-anolis-xref="concept-appcache-manifest-setting" href="#concept-appcache-manifest-setting">設定</a>、およびその後にゼロ個以上のU+0020 SPACEと"tab"（U+0009）文字で構成されなければならない。</p>

    <p>現在のところ1つの<dfn data-anolis-xref="concept-appcache-manifest-setting" id="concept-appcache-manifest-setting">設定</dfn>のみが定義される：</p>

    <dl><dt>キャッシュモード設定</dt>

     <dd>これは、文字列"<code data-anolis-xref="">prefer-online</code>"で構成される。この文字列は、<a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">キャッシュモード</a>を<a data-anolis-xref="concept-appcache-mode-prefer-online" href="#concept-appcache-mode-prefer-online">優先オンライン</a>に設定する。（<a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">キャッシュモード</a>はデフォルトで<a data-anolis-xref="concept-appcache-mode-fast" href="#concept-appcache-mode-fast">高速</a>になる。）</dd>

    </dl><p><a data-anolis-xref="concept-appcache-manifest-settings" href="#concept-appcache-manifest-settings">設定セクション</a>内で、各<a data-anolis-xref="concept-appcache-manifest-setting" href="#concept-appcache-manifest-setting">設定</a>は1回以上出現してはならない。</p><!--
    <p class="note">The URLs in data lines can't be empty strings, since those would be relative
    URLs to the manifest itself. Such lines would be confused with blank or invalid lines,
    anyway.</p>
-->



  </dl><p>マニフェストは、複数回のセクションを含んでもよい。セクションは空であってもよい。</p>

  <p><a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">フォールバック名前空間</a>自体に関連付けられたフォールバックページであるURL、およびそれらの名前空間は、データ行の最初のURLである名前空間、および2番目のURLであるフォールバックページ対応する、<a data-anolis-xref="concept-appcache-manifest-fallback" href="#concept-appcache-manifest-fallback">フォールバックセクション</a>で指定されなければならない。キャッシュされる他のすべてのページは、<a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">明示的なセクション</a>に記載されなければならない。</p>

  <p><a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">フォールバック名前空間</a>および<a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">フォールバックエントリ</a>は、マニフェスト自身と<a href="#same-origin">同じ生成元</a>を持たなければならない。</p>

  <p><a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">フォールバック名前空間</a>は、複数回記載されてはならない。</p>

  <p>ユーザーエージェントが<a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">オンラインホワイトリスト</a>に入れる名前空間は、すべて<a data-anolis-xref="concept-appcache-manifest-network" href="#concept-appcache-manifest-network">オンラインホワイトリストセクション</a>で指定されなければならない。（これは、ページがサーバーに通信するために使用しようとされている任意のURLを指定するために必要である。）このようにしてすべてのURLは自動的にホワイトリストに登録されることを指定するために、"*"（U+002A）は文字はURLの1つとして指定されてもよい。 <!-- concept-appcache-onlinewhitelist-wildcard --></p>

  <p class="auth">著者は、<a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">オンラインホワイトリスト</a>内の別の名前空間が<a href="infrastructure.html#prefix-match">接頭辞一致</a>である<a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">オンラインホワイトリスト</a>にある名前空間を含めるべきでない。</p>

  <p><a data-anolis-xref="relative URL" href="infrastructure.html#relative-url">相対URL</a>はマニフェスト自身のURLを基準に指定されなければならない。マニフェスト内のすべてのURLは、（明示的または暗黙的に、<a data-anolis-xref="relative
  URL" href="infrastructure.html#relative-url">相対URL</a>を使用して）マニフェスト自身と同じ<a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a>を持たなければならない。<a href="references.html#refsURL">[URL]</a></p>

  <p>マニフェスト内のURLは、フラグメント識別子を持たなければならない（すなわち、U+0023 NUMBER SIGN文字はマニフェスト内のURLで許可されない）。</p>

  <p><a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">フォールバック名前空間</a>と<a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">オンラインホワイト</a>内名前空間は、<a href="infrastructure.html#prefix-match">接頭辞一致</a>で一致する。</p>


  <div class="impl">

  <h5 id="parsing-cache-manifests"><span class="secno">5.7.3.3 </span>Parsing cache manifests</h5>

  <p>When a user agent is to <dfn id="parse-a-manifest">parse a manifest</dfn>, it means that the user agent must run the
  following steps:</p>

  <ol><li>

    <p><a href="infrastructure.html#utf-8-decode">UTF-8 decode</a> the byte stream corresponding with the manifest to be parsed.</p>

    <p class="note">The <a href="infrastructure.html#utf-8-decode">UTF-8 decode</a> algorithm strips a leading BOM, if any.</p>

    <!--All U+0000 NULL characters must be replaced by U+FFFD REPLACEMENT CHARACTERs. (this isn't
    black-box testable since neither U+0000 nor U+FFFD are valid anywhere in the syntax and thus
    both will be treated the same anyway)-->

   </li>

   <li><p>Let <var data-anolis-xref="">base URL</var> be the <a href="infrastructure.html#absolute-url">absolute URL</a> representing the
   manifest.</li>

   <li><p>Apply the <a href="infrastructure.html#url-parser">URL parser</a> steps to the <var data-anolis-xref="">base URL</var>, so that the
   components from its <a href="infrastructure.html#parsed-url">parsed URL</a> can be used by the subseqent steps of this
   algorithm.</li>

   <li><p>Let <var data-anolis-xref="">explicit URLs</var> be an initially empty list of <a data-anolis-xref="absolute
   URL" href="infrastructure.html#absolute-url">absolute URLs</a> for <a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">explicit
   entries</a>.</li>

   <li><p>Let <var data-anolis-xref="">fallback URLs</var> be an initially empty mapping of <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespaces</a> to <a data-anolis-xref="absolute
   URL" href="infrastructure.html#absolute-url">absolute URLs</a> for <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback
   entries</a>.</li>

   <li><p>Let <var data-anolis-xref="">online whitelist namespaces</var> be an initially empty list of <a data-anolis-xref="absolute URL" href="infrastructure.html#absolute-url">absolute URLs</a> for an <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist</a>.</li>

   <li><p>Let <var data-anolis-xref="">online whitelist wildcard flag</var> be <i data-anolis-xref="">blocking</i>. <!--
   concept-appcache-onlinewhitelist-wildcard --></li>

   <li><p>Let <var data-anolis-xref="">cache mode flag</var> be <i data-anolis-xref="">fast</i>. <!--
   concept-appcache-mode-fast --></li>

   <li><p>Let <var data-anolis-xref="">input</var> be the decoded text of the manifest's byte stream.</li>

   <li><p>Let <var data-anolis-xref="">position</var> be a pointer into <var data-anolis-xref="">input</var>, initially
   pointing at the first character.</li>

   <li><p>If the characters starting from <var data-anolis-xref="">position</var> are "CACHE", followed by a
   U+0020 SPACE character, followed by "MANIFEST", then advance <var data-anolis-xref="">position</var> to the
   next character after those. Otherwise, this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</li>

   <li><p>If the character at <var data-anolis-xref="">position</var> is neither a U+0020 SPACE character, a
   "tab" (U+0009) character, "LF" (U+000A) character, nor a "CR" (U+000D) character, then this isn't a cache manifest; abort this algorithm with a
   failure while checking for the magic signature.</li>

   <li><p>This is a cache manifest. The algorithm cannot fail beyond
   this point (though bogus lines can get ignored).</li>

   <li><p><a href="infrastructure.html#collect-a-sequence-of-characters">Collect a sequence of characters</a> that are <em>not</em> "LF" (U+000A)
   or "CR" (U+000D) characters, and ignore those characters. (Extra text on the first
   line, after the signature, is ignored.)</li>

   <li><p>Let <var data-anolis-xref="">mode</var> be "explicit".</li>

   <li><p><i>Start of line</i>: If <var data-anolis-xref="">position</var> is past the end of <var data-anolis-xref="">input</var>, then jump to the last step. Otherwise, <a href="infrastructure.html#collect-a-sequence-of-characters">collect a sequence of
   characters</a> that are "LF" (U+000A), "CR" (U+000D), U+0020 SPACE, or
   "tab" (U+0009) characters.</li>
   <!-- strips leading spaces, ignores space-only lines, ignores blank lines -->

   <li><p>Now, <a href="infrastructure.html#collect-a-sequence-of-characters">collect a sequence of characters</a> that are <em>not</em> "LF" (U+000A) or "CR" (U+000D) characters, and let the result be <var data-anolis-xref="">line</var>.</li>

   <li><p>Drop any trailing U+0020 SPACE and "tab" (U+0009) characters at the end
   of <var data-anolis-xref="">line</var>.</li>

   <li><p>If <var data-anolis-xref="">line</var> is the empty string, then jump back to the step labeled <i>start
   of line</i>.</li>

   <li><p>If the first character in <var data-anolis-xref="">line</var> is a "#" (U+0023) character,
   then jump back to the step labeled <i>start of line</i>.</li>

   <li><p>If <var data-anolis-xref="">line</var> equals "CACHE:" (the word "CACHE" followed by a ":)" (U+003A) character, then set <var data-anolis-xref="">mode</var> to "explicit" and jump back to the step labeled
   <i>start of line</i>.</li>

   <li><p>If <var data-anolis-xref="">line</var> equals "FALLBACK:" (the word "FALLBACK" followed by a ":)" (U+003A) character, then set <var data-anolis-xref="">mode</var> to "fallback" and jump back to the step
   labeled <i>start of line</i>.</li>

   <li><p>If <var data-anolis-xref="">line</var> equals "NETWORK:" (the word "NETWORK" followed by a ":)" (U+003A) character, then set <var data-anolis-xref="">mode</var> to "online whitelist" and jump back to
   the step labeled <i>start of line</i>.</li>

   <li><p>If <var data-anolis-xref="">line</var> equals "SETTINGS:" (the word "SETTINGS" followed by a ":)" (U+003A) character, then set <var data-anolis-xref="">mode</var> to "settings" and jump back to the step
   labeled <i>start of line</i>.</li>

   <li><p>If <var data-anolis-xref="">line</var> ends with a ":" (U+003A) character, then set <var data-anolis-xref="">mode</var> to "unknown" and jump back to the step labeled <i>start of line</i>.</li>

   <li><p>This is either a data line or it is syntactically incorrect.</li>

   <li><p>Let <var data-anolis-xref="">position</var> be a pointer into <var data-anolis-xref="">line</var>, initially
   pointing at the start of the string.</li>

   <li><p>Let <var data-anolis-xref="">tokens</var> be a list of strings, initially empty.</li>

   <li>

    <p>While <var data-anolis-xref="">position</var> doesn't point past the end of <var data-anolis-xref="">line</var>:</p>

    <ol><li><p>Let <var data-anolis-xref="">current token</var> be an empty string.</li>

     <li><p>While <var data-anolis-xref="">position</var> doesn't point past the end of <var data-anolis-xref="">line</var> and the character at <var data-anolis-xref="">position</var> is neither a U+0020 SPACE
     nor a "tab" (U+0009) character, add the character at <var data-anolis-xref="">position</var> to <var data-anolis-xref="">current token</var> and advance <var data-anolis-xref="">position</var> to the next character in <var data-anolis-xref="">input</var>.</li>

     <li><p>Add <var data-anolis-xref="">current token</var> to the <var data-anolis-xref="">tokens</var> list.</li>

     <li><p>While <var data-anolis-xref="">position</var> doesn't point past the end of <var data-anolis-xref="">line</var> and the character at <var data-anolis-xref="">position</var> is either a U+0020 SPACE
     or a "tab" (U+0009) character, advance <var data-anolis-xref="">position</var> to the
     next character in <var data-anolis-xref="">input</var>.</li>

    </ol></li>

   <li>

    <p>Process <var data-anolis-xref="">tokens</var> as follows:</p>

    <dl class="switch"><dt>If <var data-anolis-xref="">mode</var> is "explicit"</dt>

     <dd>

      <p><a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">Resolve</a> the first item in <var data-anolis-xref="">tokens</var>,
      relative to <var data-anolis-xref="">base URL</var>, with the URL character encoding set to UTF-8;
      ignore the rest.</p>

      <p>If this fails, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If the resulting <a href="infrastructure.html#parsed-url">parsed URL</a> has a different <a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a> component than <var data-anolis-xref="">base URL</var> (the
      manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var data-anolis-xref="">new URL</var> be the result of applying the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a> algorithm to the resulting <a href="infrastructure.html#parsed-url">parsed
      URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var data-anolis-xref="">new URL</var> to the <var data-anolis-xref="">explicit URLs</var>.</p>

     </dd>

     <dt>If <var data-anolis-xref="">mode</var> is "fallback"</dt>

     <dd>

      <p>Let <var data-anolis-xref="">part one</var> be the first token in <var data-anolis-xref="">tokens</var>, and let
      <var data-anolis-xref="">part two</var> be the second token in <var data-anolis-xref="">tokens</var>.</p>

      <p><a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">Resolve</a> <var data-anolis-xref="">part one</var> and <var data-anolis-xref="">part two</var>, relative to <var data-anolis-xref="">base URL</var>, with the URL character
      encoding set to UTF-8.</p>

      <p>If either fails, then jump back to the step labeled <i>start of line</i>.</p>

<!--ADD-TOPIC:Security-->
      <p>If the <a href="infrastructure.html#absolute-url">absolute URL</a> corresponding to either <var data-anolis-xref="">part one</var> or
      <var data-anolis-xref="">part two</var> does not have the <a href="#same-origin">same origin</a> as the manifest's URL,
      then jump back to the step labeled <i>start of line</i>.</p> <!-- SECURITY -->
<!--REMOVE-TOPIC:Security-->

      <p>Let <var data-anolis-xref="">part one</var> be the result of applying the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a> algorithm to the first resulting
      <a href="infrastructure.html#parsed-url">parsed URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Let <var data-anolis-xref="">part two</var> be the result of applying the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a> algorithm to the second resulting
      <a href="infrastructure.html#parsed-url">parsed URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>If <var data-anolis-xref="">part one</var> is already in the <var data-anolis-xref="">fallback URLs</var> mapping
      as a <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a>, then jump back to
      the step labeled <i>start of line</i>.</p>

      <p>Otherwise, add <var data-anolis-xref="">part one</var> to the <var data-anolis-xref="">fallback URLs</var>
      mapping as a <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a>, mapped to
      <var data-anolis-xref="">part two</var> as the <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback
      entry</a>.</p>

     </dd>

     <dt>If <var data-anolis-xref="">mode</var> is "online whitelist"</dt>

     <dd>

      <p>If the first item in <var data-anolis-xref="">tokens</var> is a "*" (U+002A) character, then
      set <var data-anolis-xref="">online whitelist wildcard flag</var> to <i data-anolis-xref="">open</i> and jump back
      to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, <a data-anolis-xref="resolve a url" href="infrastructure.html#resolve-a-url">resolve</a> the first item in <var data-anolis-xref="">tokens</var>, relative to <var data-anolis-xref="">base URL</var>, with the URL character
      encoding set to UTF-8; ignore the rest.</p>

      <p>If this fails, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If the resulting <a href="infrastructure.html#parsed-url">parsed URL</a> has a different <a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a> component than <var data-anolis-xref="">base URL</var> (the
      manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var data-anolis-xref="">new URL</var> be the result of applying the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a> algorithm to the resulting <a href="infrastructure.html#parsed-url">parsed
      URL</a>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var data-anolis-xref="">new URL</var> to the <var data-anolis-xref="">online whitelist namespaces</var>.</p>

     </dd>

     <dt>If <var data-anolis-xref="">mode</var> is "settings"</dt>

     <dd>

      <p>If <var data-anolis-xref="">tokens</var> contains a single token, and that token is a
      <a href="infrastructure.html#case-sensitive">case-sensitive</a> match for the string "<code data-anolis-xref="">prefer-online</code>", then
      set <var data-anolis-xref="">cache mode flag</var> to <i data-anolis-xref="">prefer-online</i> and jump back to the
      step labeled <i>start of line</i>.</p>

      <p>Otherwise, the line is an unsupported setting: do nothing; the line is ignored.</p>

     </dd>

     <dt>If <var data-anolis-xref="">mode</var> is "unknown"</dt>

     <dd>

      <p>Do nothing. The line is ignored.</p>

     </dd>

    </dl></li>

   <li><p>Jump back to the step labeled <i>start of line</i>. (That step jumps to the next, and last,
   step when the end of the file is reached.)</li>

   <li><p>Return the <var data-anolis-xref="">explicit URLs</var> list, the <var data-anolis-xref="">fallback URLs</var>
   mapping, the <var data-anolis-xref="">online whitelist namespaces</var>, the <var data-anolis-xref="">online whitelist
   wildcard flag</var>, and the <var data-anolis-xref="">cache mode flag</var>.</li>

  </ol><div class="note">

   <p>The resource that declares the manifest (with the <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute) will always get taken from the cache,
   whether it is listed in the cache or not, even if it is listed in an <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist namespace</a>.</p>

   <p>If a resource is listed in the <a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">explicit
   section</a> or as a <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entry</a> in the <a data-anolis-xref="concept-appcache-manifest-fallback" href="#concept-appcache-manifest-fallback">fallback section</a>, the resource will always be
   taken from the cache, regardless of any other matching entries in the <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespaces</a> or <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist namespaces</a>.</p>

   <p>When a <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a> and an <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist namespace</a> overlap, the <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist namespace</a> has priority.</p>

   <p>The <a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard
   flag</a> is applied last, only for URLs that match neither the <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist namespace</a> nor the <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a> and that are not listed in the
   <a data-anolis-xref="concept-appcache-manifest-explicit" href="#concept-appcache-manifest-explicit">explicit section</a>.</p>

  </div>


  <h4 id="downloading-or-updating-an-application-cache"><span class="secno">5.7.4 </span>Downloading or updating an application cache</h4>

  <p>When the user agent is required (by other parts of this specification) to start the
  <dfn id="application-cache-download-process">application cache download process</dfn> for an <a href="infrastructure.html#absolute-url">absolute URL</a> purported to
  identify a <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a>, or for an <a href="#application-cache-group">application
  cache group</a>, potentially given a particular <a href="#cache-host">cache host</a>, and potentially given
  a <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master</a> resource, the user agent must run the steps
  below. These steps are always run asynchronously, in parallel with the <a href="webappapis.html#event-loop">event loop</a>
  <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a>.</p>

  <p>Some of these steps have requirements that only apply if the user agent <dfn id="shows-caching-progress">shows caching
  progress</dfn>. Support for this is optional. Caching progress UI could consist of a progress bar
  or message panel in the user agent's interface, or an overlay, or something else. Certain events
  fired during the <a href="#application-cache-download-process">application cache download process</a> allow the script to override the
  display of such an interface. (Such events are delayed until after the <code data-anolis-xref="event-load">load</code> event has fired.)

  The goal of this is to allow Web applications to provide more
  seamless update mechanisms, hiding from the user the mechanics of the application cache mechanism.
  User agents may display user interfaces independent of this, but are encouraged to not show
  prominent update progress notifications for applications that cancel the relevant events.</p>

  <p>The <a href="#application-cache-download-process">application cache download process</a> steps are as follows:

  <ol><li><p>Optionally, wait until the permission to start the <a href="#application-cache-download-process">application cache download
   process</a> has been obtained from the user and until the user agent is confident that the
   network is available. This could include doing nothing until the user explicitly opts-in to
   caching the site, or could involve prompting the user for permission. The algorithm might never
   get past this point. (This step is particularly intended to be used by user agents running on
   severely space-constrained devices or in highly privacy-sensitive environments).</li>

   <li>

    <p>Atomically, so as to avoid race conditions, perform the following substeps:</p>

    <ol><li>

      <p>Pick the appropriate substeps:</p>

      <dl class="switch"><dt>If these steps were invoked with an <a href="infrastructure.html#absolute-url">absolute URL</a> purported to identify a
       <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a></dt>

       <dd>

        <p>Let <var data-anolis-xref="">manifest URL</var> be that <a href="infrastructure.html#absolute-url">absolute URL</a>.</p>

        <p>If there is no <a href="#application-cache-group">application cache group</a> identified by <var data-anolis-xref="">manifest
        URL</var>, then create a new <a href="#application-cache-group">application cache group</a> identified by <var data-anolis-xref="">manifest URL</var>. Initially, it has no <a data-anolis-xref="application
        cache" href="#application-cache">application caches</a>. One will be created later in this algorithm.</p>

       </dd>


       <dt>If these steps were invoked with an <a href="#application-cache-group">application cache group</a></dt>

       <dd>

        <p>Let <var data-anolis-xref="">manifest URL</var> be the <a href="infrastructure.html#absolute-url">absolute URL</a> of the <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> used to identify the <a href="#application-cache-group">application
        cache group</a> to be updated.</p>

        <p>If that <a href="#application-cache-group">application cache group</a> is <a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>, then abort this instance of the
        <a href="#application-cache-download-process">application cache download process</a>. This can happen if another instance of this
        algorithm found the manifest to be 404 or 410 while this algorithm was waiting in the first
        step above.</p>

       </dd>

      </dl></li>

     <li><p>Let <var data-anolis-xref="">cache group</var> be the <a href="#application-cache-group">application cache group</a>
     identified by <var data-anolis-xref="">manifest URL</var>.</li>

     <li><p>If these steps were invoked with a <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master</a>
     resource, then add the resource, along with the resource's <code><a href="dom.html#document">Document</a></code>, to <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending
     master entries</a>.</li>

     <li><p>If these steps were invoked with a <a href="#cache-host">cache host</a>, and the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache group</var> is
     <i>checking</i> or <i>downloading</i>, then <a href="#queue-a-post-load-task">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event">fire a
     simple event</a> named <code data-anolis-xref="event-appcache-checking"><a href="#event-appcache-checking">checking</a></code> that is
     cancelable at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host">cache host</a>. The
     default action of this event must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>,
     the display of some sort of user interface indicating to the user that the user agent is
     checking to see if it can download the application.</li>

     <li><p>If these steps were invoked with a <a href="#cache-host">cache host</a>, and the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache group</var> is
     <i>downloading</i>, then also <a href="#queue-a-post-load-task">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple
     event</a> named <code data-anolis-xref="event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code> that is
     cancelable at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host">cache host</a>. The
     default action of this event must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>,
     the display of some sort of user interface indicating to the user the application is being
     downloaded.</li>

     <li><p>If the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of the <var data-anolis-xref="">cache
     group</var> is either <i>checking</i> or <i>downloading</i>, then abort this instance of the
     <a href="#application-cache-download-process">application cache download process</a>, as an update is already in progress.</li>

     <li><p>Set the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache
     group</var> to <i>checking</i>.</p>

     </li><li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in
     <var data-anolis-xref="">cache group</var>, <a href="#queue-a-post-load-task">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple
     event</a> that is cancelable named <code data-anolis-xref="event-appcache-checking"><a href="#event-appcache-checking">checking</a></code> at
     the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>. The default action
     of these events must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the display of
     some sort of user interface indicating to the user that the user agent is checking for the
     availability of updates.</li>

    </ol><p class="note">The remainder of the steps run asynchronously.</p>

    <p>If <var data-anolis-xref="">cache group</var> already has an <a href="#application-cache">application cache</a> in it, then
    this is an <dfn data-anolis-xref="concept-appcache-upgrade" id="concept-appcache-upgrade">upgrade attempt</dfn>. Otherwise, this is a
    <dfn data-anolis-xref="concept-appcache-cache" id="concept-appcache-cache">cache attempt</dfn>.</p>

   </li>

   <li><p>If this is a <a data-anolis-xref="concept-appcache-cache" href="#concept-appcache-cache">cache attempt</a>, then this
   algorithm was invoked with a <a href="#cache-host">cache host</a>; <a href="#queue-a-post-load-task">queue a post-load task</a> to
   <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <code data-anolis-xref="event-appcache-checking"><a href="#event-appcache-checking">checking</a></code> that
   is cancelable at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host">cache host</a>. The
   default action of this event must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the
   display of some sort of user interface indicating to the user that the user agent is checking for
   the availability of updates.</li>

   <li>

    <p><i>Fetching the manifest</i>: <a href="infrastructure.html#fetch">Fetch</a><!--FETCH--> the resource from <var data-anolis-xref="">manifest URL</var> with the <i>synchronous flag</i> set, and let <var data-anolis-xref="">manifest</var> be that resource. HTTP caching semantics should be honored for this
    request.</p> <!-- http-origin privacy sensitive, though it doesn't matter, since this can never
    be cross-origin -->

    <p>Parse <var data-anolis-xref="">manifest</var> according to the <a data-anolis-xref="parse a manifest" href="#parse-a-manifest">rules for
    parsing manifests</a>, obtaining a list of <a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">explicit
    entries</a>, <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entries</a> and the <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespaces</a> that map to them, entries for
    the <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist</a>, and values for the
    <a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a>
    and the <a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">cache mode flag</a>.</p>

    <p class="note">The <a href="infrastructure.html#mime-type">MIME type</a> of the resource is ignored — it is assumed to
    be <code><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>. In the future, if new manifest formats are supported, the
    different types will probably be distinguished on the basis of the file signatures (for the
    current format, that is the "<code data-anolis-xref="">CACHE MANIFEST</code>" string at the top of the
    file).</p>

   </li>

   <li>

    <p>If <i>fetching the manifest</i> fails due to a 404 or 410 response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, then run these substeps:</p>

    <ol><li><p>Mark <var data-anolis-xref="">cache group</var> as <a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>. This <var data-anolis-xref="">cache group</var> no
     longer exists for any purpose other than the processing of <code><a href="dom.html#document">Document</a></code> objects
     already associated with an <a href="#application-cache">application cache</a> in the <var data-anolis-xref="">cache
     group</var>.</li>

     <li><p>Let <var data-anolis-xref="">task list</var> be an empty list of <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a>.</p>

     </li><li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in
     <var data-anolis-xref="">cache group</var>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire
     a simple event</a> named <code data-anolis-xref="event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code> that is
     cancelable at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>, and
     append it to <var data-anolis-xref="">task list</var>. The default action of these events must be, if the
     user agent <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface
     indicating to the user that the application is no longer available for offline use.</li>

     <li><p>For each entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> that is cancelable named
     <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code> (not <code data-anolis-xref="event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code>!) at the <code><a href="#applicationcache">ApplicationCache</a></code>
     singleton of the <code><a href="dom.html#document">Document</a></code> for this entry, if there still is one, and append it to
     <var data-anolis-xref="">task list</var>. The default action of this event must be, if the user agent
     <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to
     the user that the user agent failed to save the application for offline use.</li>

     <li><p>If <var data-anolis-xref="">cache group</var> has an <a href="#application-cache">application cache</a> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> is <i>incomplete</i>, then
     discard that <a href="#application-cache">application cache</a>.</p>

     </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</li>

     <li><p>Let the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache
     group</var> be <i>idle</i>.</li>

     <li><p>For each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in <var data-anolis-xref="">task list</var>, <a data-anolis-xref="queue a post-load task" href="#queue-a-post-load-task">queue that task as a post-load task</a>.</li>

     <li><p>Abort the <a href="#application-cache-download-process">application cache download process</a>.</li>

    </ol></li>

   <li>

    <p>Otherwise, if <i>fetching the manifest</i> fails in some other way (e.g. the server returns
    another 4xx or 5xx response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or
    there is a DNS error, or the connection times out, or the user cancels the download, or the
    parser for manifests fails when checking the magic signature), or if the server returned a
    redirect, then run the <a href="#cache-failure-steps">cache failure steps</a>. <a href="references.html#refsHTTP">[HTTP]</a></p>

   </li>

   <li>

    <p>If this is an <a data-anolis-xref="concept-appcache-upgrade" href="#concept-appcache-upgrade">upgrade attempt</a> and the newly
    downloaded <var data-anolis-xref="">manifest</var> is byte-for-byte identical to the manifest found in the
    <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var>, or the server reported it as "304 Not Modified" <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, then run these substeps:</p>

    <ol><li><p>Let <var data-anolis-xref="">cache</var> be the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a>
     <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var>.</li>

     <li><p>Let <var data-anolis-xref="">task list</var> be an empty list of <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a>.</p>

     </li><li>

      <p>For each entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, wait for the
      resource for this entry to have either completely downloaded or failed.</p>

      <p>If the download failed (e.g. the server returns a 4xx or 5xx response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or there is a DNS error, the
      connection times out, or the user cancels the download), or if the resource is labeled with
      the "no-store" cache directive, then create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to
      <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> that is cancelable named <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code> at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of
      the <code><a href="dom.html#document">Document</a></code> for this entry, if there still is one, and append it to <var data-anolis-xref="">task list</var>. The default action of this event must be, if the user agent
      <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to
      the user that the user agent failed to save the application for offline use.</p>

      <p>Otherwise, associate the <code><a href="dom.html#document">Document</a></code> for this entry with <var data-anolis-xref="">cache</var>; store the resource for this entry in <var data-anolis-xref="">cache</var>, if it
      isn't already there, and categorize its entry as a <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master entry</a>. If applying the <a href="infrastructure.html#url-parser">URL parser</a>
      algorithm to the resource's <a href="infrastructure.html#url">URL</a> results in a <a href="infrastructure.html#parsed-url">parsed URL</a> that has a
      non-null <a data-anolis-xref="concept-url-fragment" href="infrastructure.html#concept-url-fragment">fragment</a> component, the <a href="infrastructure.html#url">URL</a>
      used for the entry in <var data-anolis-xref="">cache</var> must instead be the <a href="infrastructure.html#absolute-url">absolute URL</a>
      obtained from applying the <a data-anolis-xref="concept-url-serializer" href="infrastructure.html#concept-url-serializer">URL serializer</a>
      algorithm to the <a href="infrastructure.html#parsed-url">parsed URL</a> with the <i>exclude fragment flag</i> set
      (application caches never include fragment identifiers).</p>

     </li>

     <li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in
     <var data-anolis-xref="">cache group</var>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire
     a simple event</a> that is cancelable named <code data-anolis-xref="event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code> at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton
     of the <a href="#cache-host">cache host</a>, and append it to <var data-anolis-xref="">task list</var>. The default
     action of these events must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the
     display of some sort of user interface indicating to the user that the application is up to
     date.</li>

     <li><p>Empty <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>.</li>

     <li><p>If appropriate, remove any user interface indicating that an update for this cache is in
     progress.</li>

     <li><p>Let the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache
     group</var> be <i>idle</i>.</li>

     <li><p>For each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in <var data-anolis-xref="">task list</var>, <a data-anolis-xref="queue a post-load task" href="#queue-a-post-load-task">queue that task as a post-load task</a>.</li>

     <li><p>Abort the <a href="#application-cache-download-process">application cache download process</a>.</li>

    </ol></li>

   <li><p>Let <var data-anolis-xref="">new cache</var> be a newly created <a href="#application-cache">application cache</a> in
   <var data-anolis-xref="">cache group</var>. Set its <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness
   flag</a> to <i>incomplete</i>.</li>

   <li><p>For each entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, associate the
   <code><a href="dom.html#document">Document</a></code> for this entry with <var data-anolis-xref="">new cache</var>.</li>

   <li><p>Set the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache
   group</var> to <i>downloading</i>.</li>

   <li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var>, <a href="#queue-a-post-load-task">queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple
   event</a> that is cancelable named <code data-anolis-xref="event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code>
   at the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>. The default action
   of these events must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the display of
   some sort of user interface indicating to the user that a new version is being
   downloaded.</li>

   <li><p>Let <var data-anolis-xref="">file list</var> be an empty list of URLs with flags.</li>

   <li><p>Add all the URLs in the list of <a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">explicit
   entries</a> obtained by parsing <var data-anolis-xref="">manifest</var> to <var data-anolis-xref="">file list</var>,
   each flagged with "explicit entry".</li>

   <li><p>Add all the URLs in the list of <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback
   entries</a> obtained by parsing <var data-anolis-xref="">manifest</var> to <var data-anolis-xref="">file list</var>,
   each flagged with "fallback entry".</li>

   <li><p>If this is an <a data-anolis-xref="concept-appcache-upgrade" href="#concept-appcache-upgrade">upgrade attempt</a>, then add all
   the URLs of <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master entries</a> in the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness
   flag</a> is <i>complete</i> to <var data-anolis-xref="">file list</var>, each flagged with "master
   entry".</li>

   <li><p>If any URL is in <var data-anolis-xref="">file list</var> more than once, then merge the entries into
   one entry for that URL, that entry having all the flags that the original entries had.</li>

   <li>

    <p>For each URL in <var data-anolis-xref="">file list</var>, run the following steps. These steps may be
    run in parallel for two or more of the URLs at a time. If, while running these steps, the
    <code><a href="#applicationcache">ApplicationCache</a></code> object's <code data-anolis-xref="dom-appcache-abort"><a href="#dom-appcache-abort">abort()</a></code> method
    <a data-anolis-xref="send a signal" href="#send-a-signal">sends a signal</a> to this instance of the <a href="#application-cache-download-process">application
    cache download process</a> algorithm, then run the <a href="#cache-failure-steps">cache failure steps</a>
    instead.</p>

    <ol><li>

      <p>If the resource URL being processed was flagged as neither an "explicit entry" nor or a
      "fallback entry", then the user agent may skip this URL.</p>

      <p class="note">This is intended to allow user agents to expire resources not listed in the
      manifest from the cache. Generally, implementors are urged to use an approach that expires
      lesser-used resources first.</p>

     </li>

     <li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in
     <var data-anolis-xref="">cache group</var>, <a href="#queue-a-post-load-task">queue a post-load task</a> to <a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>
     event with the name <code data-anolis-xref="event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>, which does not
     bubble, which is cancelable, and which uses the <code><a href="infrastructure.html#progressevent">ProgressEvent</a></code> interface, at the
     <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>. The <code data-anolis-xref="dom-ProgressEvents-lengthComputable">lengthComputable</code> attribute must be set to
     true, the <code data-anolis-xref="dom-ProgressEvents-total">total</code> attribute must be set to the
     number of files in <var data-anolis-xref="">file list</var>, and the <code data-anolis-xref="dom-ProgressEvents-loaded">loaded</code> attribute must be set to the number of files in
     <var data-anolis-xref="">file list</var> that have been either downloaded or skipped so far. The default
     action of these events must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the
     display of some sort of user interface indicating to the user that a file is being downloaded
     in preparation for updating the application. <a href="references.html#refsPROGRESS-EVENTS">[PROGRESS-EVENTS]</a></li>

     <li>

      <p><a href="infrastructure.html#fetch">Fetch</a><!--FETCH--> the resource, from the <a href="#origin-0">origin</a> of the
      <a href="infrastructure.html#url">URL</a> <var data-anolis-xref="">manifest URL</var>, with the <i>synchronous flag</i> set and
      the <i>manual redirect flag</i> set. If this is an <a data-anolis-xref="concept-appcache-upgrade" href="#concept-appcache-upgrade">upgrade attempt</a>, then use the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var> as an HTTP cache, and honor HTTP caching semantics (such as
      expiration, ETags, and so forth) with respect to that cache. User agents may also have other
      caches in place that are also honored.</p> <!-- not http-origin privacy sensitive -->

      <p class="note">If the resource in question is already being downloaded for other reasons then
      the existing download process can sometimes be used for the purposes of this step, as defined
      by the <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching</a> algorithm.</p>

      <p class="example">An example of a resource that might already be being downloaded is a large
      image on a Web page that is being seen for the first time. The image would get downloaded to
      satisfy the <code><a href="embedded-content-0.html#the-img-element">img</a></code> element on the page, as well as being listed in the cache
      manifest. According to the rules for <a data-anolis-xref="fetch" href="infrastructure.html#fetch">fetching</a> that image only need
      be downloaded once, and it can be used both for the cache and for the rendered Web page.</p>

     </li>

     <li>

      <p>If the previous step fails (e.g. the server returns a 4xx or 5xx response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or there is a DNS error, or the
      connection times out, or the user cancels the download), or if the server returned a redirect,
      or if the resource is labeled with the "no-store" cache directive, then run the first
      appropriate step from the following list: <a href="references.html#refsHTTP">[HTTP]</a></p>

      <dl class="switch"><dt>If the URL being processed was flagged as an "explicit entry" or a "fallback entry"</dt>

       <dd>

        <p>If these steps are being run in parallel for any other URLs in <var data-anolis-xref="">file
        list</var>, then abort these steps for those other URLs. Run the <a href="#cache-failure-steps">cache failure
        steps</a>.</p>

        <p class="note">Redirects are fatal because they are either indicative of a network problem
        (e.g. a captive portal); or would allow resources to be added to the cache under URLs that
        differ from any URL that the networking model will allow access to, leaving orphan entries;
        or would allow resources to be stored under URLs different than their true URLs. All of
        these situations are bad.</p>

       </dd>

       <dt>If the error was a 404 or 410 HTTP response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a></dt>

       <dt>If the resource was labeled with the "no-store" cache directive</dt>

       <dd>

        <p>Skip this resource. It is dropped from the cache.</p>

       </dd>

       <dt>Otherwise</dt>

       <dd>

        <p>Copy the resource and its metadata from the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness
        flag</a> is <i>complete</i>, and act as if that was the fetched resource, ignoring the
        resource obtained from the network.</p>

       </dd>

      </dl><p>User agents may warn the user of these errors as an aid to development.</p>

      <p class="note">These rules make errors for resources listed in the manifest fatal, while
      making it possible for other resources to be removed from caches when they are removed from
      the server, without errors, and making non-manifest resources survive server-side errors.</p>

      <p class="note">Except for the "no-store" directive, HTTP caching rules that would cause a
      file to be expired or otherwise not cached are ignored for the purposes of the
      <a href="#application-cache-download-process">application cache download process</a>.</p>

     </li>

     <li>

      <p>Otherwise, the fetching succeeded. Store the resource in the <var data-anolis-xref="">new
      cache</var>.</p>

      <p>If the user agent is not able to store the resource (e.g. because of quota restrictions),
      the user agent may prompt the user or try to resolve the problem in some other manner (e.g.
      automatically pruning content in other caches). If the problem cannot be resolved, the user
      agent must run the <a href="#cache-failure-steps">cache failure steps</a>.</p>

     </li>

     <li><p>If the URL being processed was flagged as an "explicit entry" in <var data-anolis-xref="">file
     list</var>, then categorize the entry as an <a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">explicit
     entry</a>.</li>

     <li><p>If the URL being processed was flagged as a "fallback entry" in <var data-anolis-xref="">file
     list</var>, then categorize the entry as a <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback
     entry</a>.</li>

     <li><p>If the URL being processed was flagged as an "master entry" in <var data-anolis-xref="">file
     list</var>, then categorize the entry as a <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master
     entry</a>.</li>

     <li><p>As an optimization, if the resource is an HTML or XML file whose root element is an
     <code><a href="semantics.html#the-html-element">html</a></code> element with a <code data-anolis-xref="attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute
     whose value doesn't match the manifest URL of the application cache being processed, then the
     user agent should mark the entry as being <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>.</p>

    </li></ol></li>

   <li><p>For each <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache group</var>, <a href="#queue-a-post-load-task">queue a post-load task</a> to <a data-anolis-xref="concept-event-fire" href="infrastructure.html#concept-event-fire">fire</a> a <a data-anolis-xref="concept-events-trusted" href="infrastructure.html#concept-events-trusted">trusted</a>
   event with the name <code data-anolis-xref="event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>, which does not bubble,
   which is cancelable, and which uses the <code><a href="infrastructure.html#progressevent">ProgressEvent</a></code> interface, at the
   <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>. The <code data-anolis-xref="dom-ProgressEvents-lengthComputable">lengthComputable</code> attribute must be set to
   true, the <code data-anolis-xref="dom-ProgressEvents-total">total</code> and the <code data-anolis-xref="dom-ProgressEvents-loaded">loaded</code> attributes must be set to the number of files in
   <var data-anolis-xref="">file list</var>. The default action of these events must be, if the user agent
   <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to the
   user that all the files have been downloaded. <a href="references.html#refsPROGRESS-EVENTS">[PROGRESS-EVENTS]</a></li>

   <li><p>Store the list of <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespaces</a>,
   and the URLs of the <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entries</a> that they map
   to, in <var data-anolis-xref="">new cache</var>.</li>

   <li><p>Store the URLs that form the new <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online
   whitelist</a> in <var data-anolis-xref="">new cache</var>.</li>

   <li><p>Store the value of the new <a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">online
   whitelist wildcard flag</a> in <var data-anolis-xref="">new cache</var>.</li>

   <li><p>Store the value of the new <a data-anolis-xref="concept-appcache-mode" href="#concept-appcache-mode">cache mode flag</a> in
   <var data-anolis-xref="">new cache</var>.</li>

   <li>

    <p>For each entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, wait for the
    resource for this entry to have either completely downloaded or failed.</p>

    <p>If the download failed (e.g. the server returns a 4xx or 5xx response <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or there is a DNS error, the
    connection times out, or the user cancels the download), or if the resource is labeled with the
    "no-store" cache directive, then run these substeps:</p>

    <ol><li><p>Unassociate the <code><a href="dom.html#document">Document</a></code> for this entry from <var data-anolis-xref="">new
     cache</var>.</li>

     <li><p><a href="#queue-a-post-load-task">Queue a post-load task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> that is
     cancelable named <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code> at the
     <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code><a href="dom.html#document">Document</a></code> for this entry, if there
     still is one. The default action of this event must be, if the user agent <a href="#shows-caching-progress">shows caching
     progress</a>, the display of some sort of user interface indicating to the user that the
     user agent failed to save the application for offline use.</p>

     </li><li>

      <p>If this is a <a data-anolis-xref="concept-appcache-cache" href="#concept-appcache-cache">cache attempt</a> and this entry is
      the last entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, then run these
      further substeps:</p>

      <ol><li><p>Discard <var data-anolis-xref="">cache group</var> and its only <a href="#application-cache">application cache</a>,
       <var data-anolis-xref="">new cache</var>.</p>

       </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is
       in progress.</li>

       <li><p>Abort the <a href="#application-cache-download-process">application cache download process</a>.</li>

      </ol></li>

     <li><p>Otherwise, remove this entry from <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>.</li>

    </ol><p>Otherwise, store the resource for this entry in <var data-anolis-xref="">new cache</var>, if it isn't
    already there, and categorize its entry as a <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master
    entry</a>.</p>

   </li>

   <li>

    <p><a href="infrastructure.html#fetch">Fetch</a><!--FETCH--> the resource from <var data-anolis-xref="">manifest URL</var> again, with
    the <i>synchronous flag</i> set, and let <var data-anolis-xref="">second manifest</var> be that resource.
    HTTP caching semantics should again be honored for this request.</p> <!-- http-origin privacy
    sensitive, though it doesn't matter, since this can never be cross-origin -->

    <p class="note">Since caching can be honored, authors are encouraged to avoid setting the cache
    headers on the manifest in such a way that the user agent would simply not contact the network
    for this second request; otherwise, the user agent would not notice if the cache had changed
    during the cache update process.</p>

   </li>

   <li>

    <p>If the previous step failed for any reason, or if the fetching attempt involved a redirect,
    or if <var data-anolis-xref="">second manifest</var> and <var data-anolis-xref="">manifest</var> are not byte-for-byte
    identical, then schedule a rerun of the entire algorithm with the same parameters after a short
    delay, and run the <a href="#cache-failure-steps">cache failure steps</a>.</p>

   </li>

   <li>

    <p>Otherwise, store <var data-anolis-xref="">manifest</var> in <var data-anolis-xref="">new cache</var>, if it's not
    there already, and categorize its entry as <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">the
    manifest</a>.</p>

   </li>

   <li><p>Set the <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> of <var data-anolis-xref="">new cache</var> to <i>complete</i>.</li>

   <li><p>Let <var data-anolis-xref="">task list</var> be an empty list of <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a>.</p>

   </li><li>

    <p>If this is a <a data-anolis-xref="concept-appcache-cache" href="#concept-appcache-cache">cache attempt</a>, then for each
    <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache
    group</var>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a>
    that is cancelable named <code data-anolis-xref="event-appcache-cached"><a href="#event-appcache-cached">cached</a></code> at the
    <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>, and append it to <var data-anolis-xref="">task list</var>. The default action of these events must be, if the user agent
    <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to
    the user that the application has been cached and that they can now use it offline.</p>

    <p>Otherwise, it is an <a data-anolis-xref="concept-appcache-upgrade" href="#concept-appcache-upgrade">upgrade attempt</a>. For each
    <a href="#cache-host">cache host</a> associated with an <a href="#application-cache">application cache</a> in <var data-anolis-xref="">cache
    group</var>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a>
    that is cancelable named <code data-anolis-xref="event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code> at the
    <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>, and append it to <var data-anolis-xref="">task list</var>. The default action of these events must be, if the user agent
    <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to
    the user that a new version is available and that they can activate it by reloading the
    page.</p>

   </li>

   <li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</li>

   <li><p>Set the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">update status</a> of <var data-anolis-xref="">cache
   group</var> to <i>idle</i>.</li>

   <li><p>For each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in <var data-anolis-xref="">task list</var>, <a data-anolis-xref="queue a post-load task" href="#queue-a-post-load-task">queue that task as a post-load task</a>.</li>

  </ol><p>The <dfn id="cache-failure-steps">cache failure steps</dfn> are as follows:</p>

  <ol><li><p>Let <var data-anolis-xref="">task list</var> be an empty list of <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a>.</p>

   </li><li>

    <p>For each entry in <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>, run the
    following further substeps. These steps may be run in parallel for two or more entries at a
    time.</p>

    <ol><li><p>Wait for the resource for this entry to have either completely downloaded or failed.</p>

     </li><li><p>Unassociate the <code><a href="dom.html#document">Document</a></code> for this entry from its <a href="#application-cache">application
     cache</a>, if it has one.</li>

     <li><p>Create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> that
     is cancelable named <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code> at the
     <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code><a href="dom.html#document">Document</a></code> for this entry, if there
     still is one, and append it to <var data-anolis-xref="">task list</var>. The default action of these
     events must be, if the user agent <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort
     of user interface indicating to the user that the user agent failed to save the application for
     offline use.</p>

    </li></ol></li>

   <li><p>For each <a href="#cache-host">cache host</a> still associated with an <a href="#application-cache">application cache</a>
   in <var data-anolis-xref="">cache group</var>, create a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> to <a href="webappapis.html#fire-a-simple-event">fire
   a simple event</a> that is cancelable named <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code> at
   the <code><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host">cache host</a>, and append it to <var data-anolis-xref="">task list</var>. The default action of these events must be, if the user agent
   <a href="#shows-caching-progress">shows caching progress</a>, the display of some sort of user interface indicating to the
   user that the user agent failed to save the application for offline use.</li>

   <li><p>Empty <var data-anolis-xref="">cache group</var>'s <a data-anolis-xref="concept-appcache-pending-masters" href="#concept-appcache-pending-masters">list of pending master entries</a>.</li>

   <li><p>If <var data-anolis-xref="">cache group</var> has an <a href="#application-cache">application cache</a> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> is <i>incomplete</i>, then discard
   that <a href="#application-cache">application cache</a>.</p>

   </li><li><p>If appropriate, remove any user interface indicating that an update for this cache is in
   progress.</li>

   <li><p>Let the <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">status</a> of <var data-anolis-xref="">cache
   group</var> be <i>idle</i>.</li>

   <li><p>If this was a <a data-anolis-xref="concept-appcache-cache" href="#concept-appcache-cache">cache attempt</a>, discard <var data-anolis-xref="">cache group</var> altogether.</p>

   </li><li><p>For each <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> in <var data-anolis-xref="">task list</var>, <a data-anolis-xref="queue a post-load task" href="#queue-a-post-load-task">queue that task as a post-load task</a>.</li>

   <li><p>Abort the <a href="#application-cache-download-process">application cache download process</a>.</li>

  </ol><p>Attempts to <a href="infrastructure.html#fetch">fetch</a> resources as part of the <a href="#application-cache-download-process">application cache download
  process</a> may be done with cache-defeating semantics, to avoid problems with stale or
  inconsistent intermediary caches.</p>

  <hr><p>User agents may invoke the <a href="#application-cache-download-process">application cache download process</a>, in the background,
  for any <a href="#application-cache-group">application cache group</a>, at any time (with no <a href="#cache-host">cache host</a>). This
  allows user agents to keep caches primed and to update caches even before the user visits a
  site.</p>

  <hr><p>Each <code><a href="dom.html#document">Document</a></code> has a list of <dfn id="pending-application-cache-download-process-tasks">pending application cache download process
  tasks</dfn> that is used to delay events fired by the algorithm above until the document's <code data-anolis-xref="event-load">load</code> event has fired. When the <code><a href="dom.html#document">Document</a></code> is created, the
  list must be empty.</p>

  <p>When the steps above say to <dfn id="queue-a-post-load-task">queue a post-load task</dfn> <var data-anolis-xref="">task</var>, where
  <var data-anolis-xref="">task</var> is a <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">task</a> that dispatches an event on a
  target <code><a href="#applicationcache">ApplicationCache</a></code> object <var data-anolis-xref="">target</var>, the user agent must run
  the appropriate steps from the following list:</p>

  <dl><dt>If <var data-anolis-xref="">target</var>'s <code><a href="dom.html#document">Document</a></code> is
   <a href="syntax.html#ready-for-post-load-tasks">ready for post-load tasks</a></dt>

   <dd><p><a data-anolis-xref="queue a task" href="webappapis.html#queue-a-task">Queue</a> the task <var data-anolis-xref="">task</var>.</dd>

   <dt>Otherwise</dt>

   <dd><p>Add <var data-anolis-xref="">task</var> to <var data-anolis-xref="">target</var>'s <code><a href="dom.html#document">Document</a></code>'s list
   of <a href="#pending-application-cache-download-process-tasks">pending application cache download process tasks</a>.</dd>

  </dl><p>The <a href="webappapis.html#task-source">task source</a> for these <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> is the
  <a href="webappapis.html#networking-task-source">networking task source</a>.</p>




  <h4 id="the-application-cache-selection-algorithm"><span class="secno">5.7.5 </span>The application cache selection algorithm</h4>

  <p>When the <dfn data-anolis-xref="concept-appcache-init" id="concept-appcache-init">application cache selection algorithm</dfn>
  algorithm is invoked with a <code><a href="dom.html#document">Document</a></code> <var data-anolis-xref="">document</var> and optionally a
  manifest <a href="infrastructure.html#url">URL</a> <var data-anolis-xref="">manifest URL</var>, the user agent must run the first
  applicable set of steps from the following list:</p>

  <dl class="switch"><dt>If there is a <var data-anolis-xref="">manifest URL</var>, and <var data-anolis-xref="">document</var> was loaded
   from an <a href="#application-cache">application cache</a>, and the URL of the <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> of that cache's <a href="#application-cache-group">application cache
   group</a> is <em>not</em> the same as <var data-anolis-xref="">manifest URL</var></dt>

   <dd>

    <p>Mark the entry for the resource from which <var data-anolis-xref="">document</var> was taken in the
    <a href="#application-cache">application cache</a> from which it was loaded as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>.</p>

    <p>Restart the current navigation from the top of the <a data-anolis-xref="navigate" href="#navigate">navigation
    algorithm</a>, undoing any changes that were made as part of the initial load (changes can be
    avoided by ensuring that the step to <a href="#update-the-session-history-with-the-new-page">update the session history with the new page</a>
    is only ever completed <em>after</em> this <a data-anolis-xref="concept-appcache-init" href="#concept-appcache-init">application cache
    selection algorithm</a> is run, though this is not required).</p>

    <p class="note">The navigation will not result in the same resource being loaded, because
    "foreign" entries are never picked during navigation.</p>

    <p>User agents may notify the user of the inconsistency between the cache manifest and the
    document's own metadata, to aid in application development.</p>

   </dd>


   <dt>If <var data-anolis-xref="">document</var> was loaded from an <a href="#application-cache">application cache</a>, and that
   <a href="#application-cache">application cache</a> still exists (it is not now <a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>)<!--[redundant], and either there is no <var
   data-x="">manifest URL</var>, or the URL of the <span
   data-x="concept-appcache-manifest">manifest</span> of the cache's <span>application cache
   group</span> is the same as <var data-x="">manifest URL</var>--></dt>

   <dd>

    <p>Associate <var data-anolis-xref="">document</var> with the <a href="#application-cache">application cache</a> from which it
    was loaded. Invoke, in the background, the <a href="#application-cache-download-process">application cache download process</a> for
    that <a href="#application-cache">application cache</a>'s <a href="#application-cache-group">application cache group</a>, with <var data-anolis-xref="">document</var> as the <a href="#cache-host">cache host</a>.</p>

   </dd>


   <dt>If <var data-anolis-xref="">document</var> <!--[redundant] was not loaded from an <span>application
   cache</span>, but it--> was loaded using HTTP GET <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or
   equivalent</a>, and, there is a <var data-anolis-xref="">manifest URL</var>, and <var data-anolis-xref="">manifest
   URL</var> has the <a href="#same-origin">same origin</a> as <var data-anolis-xref="">document</var></dt>

   <dd>

    <p>Invoke, in the background, the <a href="#application-cache-download-process">application cache download process</a> for <var data-anolis-xref="">manifest URL</var>, with <var data-anolis-xref="">document</var> as the <a href="#cache-host">cache host</a>
    and with the resource from which <var data-anolis-xref="">document</var> was parsed as the <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">master</a> resource.</p>

    <p>If there are <a data-anolis-xref="relevant application cache" href="#relevant-application-cache">relevant application caches</a> that
    are identified by a URL with the <a href="#same-origin">same origin</a> as the URL of <var data-anolis-xref="">document</var>, and that have this URL as one of their entries, excluding entries
    marked as <a data-anolis-xref="concept-appcache-foreign" href="#concept-appcache-foreign">foreign</a>, then the user agent should use
    the <a data-anolis-xref="concept-appcache-selection" href="#concept-appcache-selection">most appropriate application cache</a> of those
    that match as an HTTP cache for any subresource loads. User agents may also have other caches in
    place that are also honored.</p>

   </dd>


   <dt>Otherwise</dt> <!-- not from cache and either no <var data-x="">manifest URL</var>, or
   non-GET, or wrong-origin manifest -->

   <dd>

    <p>The <code><a href="dom.html#document">Document</a></code> is not associated with any <a href="#application-cache">application cache</a>.</p>

    <p>If there was a <var data-anolis-xref="">manifest URL</var>, the user agent may report to the user that
    it was ignored, to aid in application development.</p>

   </dd>

  </dl><h4 id="changesToNetworkingModel"><span class="secno">5.7.6 </span>Changes to the networking model</h4>

  <p>When a <a href="#cache-host">cache host</a> is associated with an <a href="#application-cache">application cache</a> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> is <i>complete</i>, any and all
  loads for resources related to that <a href="#cache-host">cache host</a> other than those for <a data-anolis-xref="child browsing context" href="#child-browsing-context">child browsing contexts</a> must go through the following steps
  instead of immediately invoking the mechanisms appropriate to that resource's scheme:</p>

  <ol><!--FETCH--><li><p>If the resource is not to be fetched using the HTTP GET mechanism <a data-anolis-xref="concept-http-equivalent-get" href="infrastructure.html#concept-http-equivalent-get">or equivalent</a>, or if applying the <a href="infrastructure.html#url-parser">URL
   parser</a> algorithm to both its <a href="infrastructure.html#url">URL</a> and the <a href="#application-cache">application cache</a>'s
   <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a>'s URL results in two <a data-anolis-xref="parsed
   URL" href="infrastructure.html#parsed-url">parsed URLs</a> with different <a data-anolis-xref="concept-url-scheme" href="infrastructure.html#concept-url-scheme">scheme</a> components,
   then <a href="infrastructure.html#fetch">fetch</a> the resource normally and abort these steps.</li>

   <li><p>If the resource's URL is <a data-anolis-xref="concept-appcache-master" href="#concept-appcache-master">a master entry</a>,
   <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">the manifest</a>, <a data-anolis-xref="concept-appcache-explicit" href="#concept-appcache-explicit">an explicit entry</a>, or <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">a fallback entry</a> in the <a href="#application-cache">application cache</a>,
   then get the resource from the cache (instead of fetching it), and abort these steps.</li>

   <li><p>If there is an entry in the <a href="#application-cache">application cache</a>'s <a data-anolis-xref="concept-appcache-onlinewhitelist" href="#concept-appcache-onlinewhitelist">online whitelist</a> that has the <a href="#same-origin">same
   origin</a> as the resource's URL and that is a <a href="infrastructure.html#prefix-match">prefix match</a> for the resource's
   URL, then <a href="infrastructure.html#fetch">fetch</a> the resource normally and abort these steps.</li>

   <li>

    <p>If the resource's URL has the <a href="#same-origin">same origin</a> as the manifest's URL, and there is a
    <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a> <var data-anolis-xref="">f</var> in
    the <a href="#application-cache">application cache</a> that is a <a href="infrastructure.html#prefix-match">prefix match</a> for the resource's URL,
    then:</p>

    <p><a href="infrastructure.html#fetch">Fetch</a> the resource normally. If this results in a redirect to a resource with
    another <a href="#origin-0">origin</a> (indicative of a captive portal), or a 4xx or 5xx status code <a data-anolis-xref="concept-http-equivalent-codes" href="infrastructure.html#concept-http-equivalent-codes">or equivalent</a>, or if there were network errors (but
    not if the user canceled the download), then instead get, from the cache, the resource of the
    <a data-anolis-xref="concept-appcache-fallback" href="#concept-appcache-fallback">fallback entry</a> corresponding to the <a data-anolis-xref="concept-appcache-fallback-ns" href="#concept-appcache-fallback-ns">fallback namespace</a> <var data-anolis-xref="">f</var>. Abort
    these steps.</p>

   </li>

   <li><p>If the <a href="#application-cache">application cache</a>'s <a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a> is <i data-anolis-xref="">open</i>, then <a href="infrastructure.html#fetch">fetch</a> the resource normally and abort these steps.</li>

   <li><p>Fail the resource load as if there had been a generic network error.</li>

  </ol><p class="note">The above algorithm ensures that so long as the <a data-anolis-xref="concept-appcache-onlinewhitelist-wildcard" href="#concept-appcache-onlinewhitelist-wildcard">online whitelist wildcard flag</a> is <i data-anolis-xref="">blocking</i>, resources that are not present in the <a data-anolis-xref="concept-appcache-manifest" href="#concept-appcache-manifest">manifest</a> will always fail to load (at least, after the
  <a href="#application-cache">application cache</a> has been primed the first time), making the testing of offline
  applications simpler.</p>

  </div>


  <div class="impl">

  <h4 id="expiring-application-caches"><span class="secno">5.7.7 </span>Expiring application caches</h4>

  <p>As a general rule, user agents should not expire application caches, except on request from the
  user, or after having been left unused for an extended period of time.</p>

  <p>Application caches and cookies have similar implications with respect to privacy (e.g. if the
  site can identify the user when providing the cache, it can store data in the cache that can be
  used for cookie resurrection). Implementors are therefore encouraged to expose application caches
  in a manner related to HTTP cookies, allowing caches to be expunged together with cookies and
  other origin-specific data.</p>

  <p class="example">For example, a user agent could have a "delete site-specific data" feature that
  clears all cookies, application caches, local storage, databases, etc, from an origin all at
  once.</p>

  </div>


  <div class="impl">

  <h4 id="disk-space"><span class="secno">5.7.8 </span>Disk space</h4>

  <p>User agents should consider applying constraints on disk usage of <a data-anolis-xref="application
  cache" href="#application-cache">application caches</a>, and care should be taken to ensure that the restrictions cannot
  be easily worked around using subdomains.</p>

  <p>User agents should allow users to see how much space each domain is using, and may offer the
  user the ability to delete specific <a data-anolis-xref="application cache" href="#application-cache">application caches</a>.</p>

  <p>For predictability, quotas should be based on the uncompressed size of data stored.</p>
  <!-- see https://www.w3.org/Bugs/Public/show_bug.cgi?id=21319#c3 -->

  <p class="note">How quotas are presented to the user is not defined by this specification. User
  agents are encouraged to provide features such as allowing a user to indicate that certain sites
  are trusted to use more than the default quota, e.g. by asynchronously presenting a user interface
  while a cache is being updated, or by having an explicit whitelist in the user agent's
  configuration interface.</p>

  </div>



  <h4 id="application-cache-api"><span class="secno">5.7.9</span> アプリケーションキャッシュAPI</h4>

  <pre class="idl">interface <dfn id="applicationcache">ApplicationCache</dfn> : <a href="infrastructure.html#eventtarget">EventTarget</a> {

  // <a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">update status</a>
  const unsigned short <a data-anolis-xref="dom-appcache-UNCACHED" href="#dom-appcache-uncached">UNCACHED</a> = 0;
  const unsigned short <a data-anolis-xref="dom-appcache-IDLE" href="#dom-appcache-idle">IDLE</a> = 1;
  const unsigned short <a data-anolis-xref="dom-appcache-CHECKING" href="#dom-appcache-checking">CHECKING</a> = 2;
  const unsigned short <a data-anolis-xref="dom-appcache-DOWNLOADING" href="#dom-appcache-downloading">DOWNLOADING</a> = 3;
  const unsigned short <a data-anolis-xref="dom-appcache-UPDATEREADY" href="#dom-appcache-updateready">UPDATEREADY</a> = 4;
  const unsigned short <a data-anolis-xref="dom-appcache-OBSOLETE" href="#dom-appcache-obsolete">OBSOLETE</a> = 5;
  readonly attribute unsigned short <a data-anolis-xref="dom-appcache-status" href="#dom-appcache-status">status</a>;

  // updates
  void <a data-anolis-xref="dom-appcache-update" href="#dom-appcache-update">update</a>();
  void <a data-anolis-xref="dom-appcache-abort" href="#dom-appcache-abort">abort</a>();
  void <a data-anolis-xref="dom-appcache-swapCache" href="#dom-appcache-swapcache">swapCache</a>();

  // events
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onchecking" href="#handler-appcache-onchecking">onchecking</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onerror" href="#handler-appcache-onerror">onerror</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onnoupdate" href="#handler-appcache-onnoupdate">onnoupdate</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-ondownloading" href="#handler-appcache-ondownloading">ondownloading</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onprogress" href="#handler-appcache-onprogress">onprogress</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onupdateready" href="#handler-appcache-onupdateready">onupdateready</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-oncached" href="#handler-appcache-oncached">oncached</a>;
           attribute <a href="webappapis.html#eventhandler">EventHandler</a> <a data-anolis-xref="handler-appcache-onobsolete" href="#handler-appcache-onobsolete">onobsolete</a>;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">cache</var> = <var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-applicationCache"><a href="#dom-applicationcache">applicationCache</a></code></dt>
   <dd>

    <p>（ウィンドウで）その<code><a href="#window">Window</a></code>の<a href="#active-document">アクティブドキュメント</a>に適用する<code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトを返す。</p>

   </dd>

   <dt><var data-anolis-xref="">cache</var> = <var data-anolis-xref="">self</var> . <code data-anolis-xref="dom-applicationCache"><a href="#dom-applicationcache">applicationCache</a></code></dt> <dd>

    <p>（共有ワーカーで）現在の共有ワーカーに適用する<code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトを返す。</p>

   </dd>

   <dt><var data-anolis-xref="">cache</var> . <code data-anolis-xref="dom-appcache-status"><a href="#dom-appcache-status">status</a></code></dt>
   <dd>

    <p>以下に定義された定数で与えられるように、アプリケーションキャッシュの現在のステータスを返す。</p>

   </dd>

   <dt><var data-anolis-xref="">cache</var> . <code data-anolis-xref="dom-appcache-update"><a href="#dom-appcache-update">update</a></code>()</dt>
   <dd>

    <p><a href="#application-cache-download-process">アプリケーションキャッシュのダウンロードプロセス</a>を起動する。</p>

    <p>更新すべきアプリケーションキャッシュが存在しない場合に<code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>例外を投げる。</p>

    <p>ユーザーエージェントは通常、自動的に<a data-anolis-xref="application cache" href="#application-cache">アプリケーションキャッシュ</a>を更新する処理をするので、通常このメソッドを呼び出す必要はない。</p>

    <p>このメソッドは、長期のアプリケーションのような状況で役立つ。たとえば、ウェブメールアプリケーションは一度に何週間もブラウザタブで開いたままかもしれない。このようなアプリケーションは、毎日更新をテストできるだろう。</p>

   </dd>

   <dt><var data-anolis-xref="">cache</var> . <code data-anolis-xref="dom-appcache-abort"><a href="#dom-appcache-abort">abort</a></code>()</dt>
   <dd>

    <p><a href="#application-cache-download-process">アプリケーションキャッシュのダウンロード処理</a>を中止する。</p>

    <p>このメソッドは、（帯域幅が限られるためなどで）ユーザーが更新を停止したい場合に、独自のキャッシング進捗UIを表示するウェブアプリケーションで使用されることを意図する。</p>

   </dd>

   <dt><var data-anolis-xref="">cache</var> . <code data-anolis-xref="dom-appcache-swapCache"><a href="#dom-appcache-swapcache">swapCache</a></code>()</dt>
   <dd>

    <p>新しいものが存在する場合、最新のアプリケーションキャッシュに切り替わる。存在しない場合、<code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>例外を投げる。</p>

    <p>これは、以前にロードされたリソースが再読み込みされることはない。たとえば、画像が急にリロードされないと、スタイルシートやスクリプトが再解析または再評価されない。唯一の変更点は、キャッシュされたリソースに対する後続の要求が新しいコピーを取得することである。</p>

    <p>このメソッドが呼び出される前に<code data-anolis-xref="event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>イベントが発火する。一度発火すると、ウェブアプリケーションは、その余暇で、より最近のアップデートで一つに基礎となるキャッシュを切り替えるためにこのメソッドを呼び出す。これを適切に使うためには、アプリケーションは動作に新しい機能をもたらすことができるようにする必要がある。たとえば、新しい機能を有効にするためにスクリプトをリロードするなど。</p>

    <p><code data-anolis-xref="dom-appcache-swapCache"><a href="#dom-appcache-swapcache">swapCache()</a></code>の代替は、<code data-anolis-xref="dom-location-reload"><a href="#dom-location-reload">location.reload()</a></code>を使用して、ユーザーに適した時点で単にページ全体をリロードすることである。</p>

   </dd>

  </dl><div class="impl">

  <p>There is a one-to-one mapping from <a data-anolis-xref="cache host" href="#cache-host">cache hosts</a> to
  <code><a href="#applicationcache">ApplicationCache</a></code> objects. The <dfn data-anolis-xref="dom-applicationCache" id="dom-applicationcache"><code>applicationCache</code></dfn> attribute on <code><a href="#window">Window</a></code>
  objects must return the <code><a href="#applicationcache">ApplicationCache</a></code> object associated with the
  <code><a href="#window">Window</a></code> object's <a href="#active-document">active document</a>. The <dfn data-anolis-xref="dom-SharedWorkerGlobalScope-applicationCache" id="dom-sharedworkerglobalscope-applicationcache"><code>applicationCache</code></dfn> attribute
  on <code>SharedWorkerGlobalScope</code> objects must return the <code><a href="#applicationcache">ApplicationCache</a></code>
  object associated with the worker.</p>

  <p class="note">A <code><a href="#window">Window</a></code> or <code>SharedWorkerGlobalScope</code> object has an
  associated <code><a href="#applicationcache">ApplicationCache</a></code> object even if that <a href="#cache-host">cache host</a> has no actual
  <a href="#application-cache">application cache</a>.</p>

  <hr><p>The <dfn data-anolis-xref="dom-appcache-status" id="dom-appcache-status"><code>status</code></dfn> attribute, on getting, must
  return the current state of the <a href="#application-cache">application cache</a> that the
  <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> is associated with, if any. This
  must be the appropriate value from the following list:</p>

  </div>

  <dl><dt><dfn data-anolis-xref="dom-appcache-UNCACHED" id="dom-appcache-uncached"><code>UNCACHED</code></dfn>（数値0）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、この時点で<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられていない。</dd>

   <dt><dfn data-anolis-xref="dom-appcache-IDLE" id="dom-appcache-idle"><code>IDLE</code></dfn>（数値1）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>の<a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">更新ステータス</a>が<i>idle</i>である<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられ、その<a href="#application-cache">アプリケーションキャッシュ</a>は、その<a href="#application-cache-group">アプリケーションキャッシュグループ</a>の<a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">最新の</a>キャッシュであり、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>は、<a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>とマークされない。</dd>

   <dt><dfn data-anolis-xref="dom-appcache-CHECKING" id="dom-appcache-checking"><code>CHECKING</code></dfn>（数値2）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>の<a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">更新ステータス</a>が<i>checking</i>である<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられる。</dd>

   <dt><dfn data-anolis-xref="dom-appcache-DOWNLOADING" id="dom-appcache-downloading"><code>DOWNLOADING</code></dfn>（数値3）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>の<a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">更新ステータス</a>が<i>downloading</i>である<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられる。</dd>

   <dt><dfn data-anolis-xref="dom-appcache-UPDATEREADY" id="dom-appcache-updateready"><code>UPDATEREADY</code></dfn>（数値4）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>の<a data-anolis-xref="concept-appcache-status" href="#concept-appcache-status">更新ステータス</a>が<i>idle</i>である<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられ、その<a href="#application-cache-group">アプリケーションキャッシュグループ</a>が<a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>としてマークされないが、その<a href="#application-cache">アプリケーションキャッシュ</a>は、そのグループ内の<a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">最新の</a>キャッシュでは<em>ない</em>。</dd>

   <dt><dfn data-anolis-xref="dom-appcache-OBSOLETE" id="dom-appcache-obsolete"><code>OBSOLETE</code></dfn>（数値5）</dt>

   <dd><p><code><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host">キャッシュホスト</a>は、<a href="#application-cache-group">アプリケーションキャッシュグループ</a>が<a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>とマークされる<a href="#application-cache">アプリケーションキャッシュ</a>に関連付けられる。</dd>

  </dl><div class="impl">

  <hr><p>If the <dfn data-anolis-xref="dom-appcache-update" id="dom-appcache-update"><code>update()</code></dfn> method is invoked, the user
  agent must invoke the <a href="#application-cache-download-process">application cache download process</a>, in the background, for the
  <a href="#application-cache-group">application cache group</a> of the <a href="#application-cache">application cache</a> with which the
  <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> is associated, but without giving
  that <a href="#cache-host">cache host</a> to the algorithm. If there is no such <a href="#application-cache">application cache</a>,
  or if its <a href="#application-cache-group">application cache group</a> is marked as <a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>, then the method must throw an
  <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception instead.</p>

  <p>If the <dfn data-anolis-xref="dom-appcache-abort" id="dom-appcache-abort"><code>abort()</code></dfn> method is invoked, the user
  agent must <dfn id="send-a-signal">send a signal</dfn> to the current <a href="#application-cache-download-process">application cache download process</a>
  for the <a href="#application-cache-group">application cache group</a> of the <a href="#application-cache">application cache</a> with which the
  <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> is associated, if any. If there is
  no such <a href="#application-cache">application cache</a>, or it does not have a current <a href="#application-cache-download-process">application cache
  download process</a>, then do nothing.</p>

  <p>If the <dfn data-anolis-xref="dom-appcache-swapCache" id="dom-appcache-swapcache"><code>swapCache()</code></dfn> method is invoked,
  the user agent must run the following steps:

  <ol><li><p>Check that <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> is associated
   with an <a href="#application-cache">application cache</a>. If it is not, then throw an
   <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code> exception and abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">cache</var> be the <a href="#application-cache">application cache</a> with which the
   <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> is associated. (By definition,
   this is the same as the one that was found in the previous step.)</li>

   <li><p>If <var data-anolis-xref="">cache</var>'s <a href="#application-cache-group">application cache group</a> is marked as <a data-anolis-xref="concept-appcache-obsolete" href="#concept-appcache-obsolete">obsolete</a>, then unassociate the
   <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> from <var data-anolis-xref="">cache</var> and
   abort these steps. (Resources will now load from the network instead of the cache.)</li>

   <li><p>Check that there is an application cache in the same <a href="#application-cache-group">application cache group</a>
   as <var data-anolis-xref="">cache</var> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness
   flag</a> is <i>complete</i> and that is <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newer</a> than
   <var data-anolis-xref="">cache</var>. If there is not, then throw an <code><a href="infrastructure.html#invalidstateerror">InvalidStateError</a></code>
   exception and abort these steps.</li>

   <li><p>Let <var data-anolis-xref="">new cache</var> be the <a data-anolis-xref="concept-appcache-newer" href="#concept-appcache-newer">newest</a> <a href="#application-cache">application cache</a> in the same
   <a href="#application-cache-group">application cache group</a> as <var data-anolis-xref="">cache</var> whose <a data-anolis-xref="concept-appcache-completeness" href="#concept-appcache-completeness">completeness flag</a> is <i>complete</i>.</li>

   <li><p>Unassociate the <code><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host">cache host</a> from <var data-anolis-xref="">cache</var> and instead associate it with <var data-anolis-xref="">new cache</var>.</li>

  </ol><p>The following are the <a href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <a data-anolis-xref="event
  handler event type" href="webappapis.html#event-handler-event-type">event handler event types</a>) <span class="impl">that must be</span>
  supported, as <a href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the
  <code><a href="#applicationcache">ApplicationCache</a></code> interface:</p>

  <table><thead><tr><th><a data-anolis-xref="event handlers" href="webappapis.html#event-handlers">Event handler</a> </th><th><a href="webappapis.html#event-handler-event-type">Event handler event type</a>
   <tbody></th></tr><tr><td><dfn data-anolis-xref="handler-appcache-onchecking" id="handler-appcache-onchecking"><code>onchecking</code></dfn> </td><td> <code data-anolis-xref="event-appcache-checking"><a href="#event-appcache-checking">checking</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-onerror" id="handler-appcache-onerror"><code>onerror</code></dfn> </td><td> <code data-anolis-xref="event-appcache-error"><a href="#event-appcache-error">error</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-onnoupdate" id="handler-appcache-onnoupdate"><code>onnoupdate</code></dfn> </td><td> <code data-anolis-xref="event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-ondownloading" id="handler-appcache-ondownloading"><code>ondownloading</code></dfn> </td><td> <code data-anolis-xref="event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-onprogress" id="handler-appcache-onprogress"><code>onprogress</code></dfn> </td><td> <code data-anolis-xref="event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-onupdateready" id="handler-appcache-onupdateready"><code>onupdateready</code></dfn> </td><td> <code data-anolis-xref="event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-oncached" id="handler-appcache-oncached"><code>oncached</code></dfn> </td><td> <code data-anolis-xref="event-appcache-cached"><a href="#event-appcache-cached">cached</a></code>
    </td></tr><tr><td><dfn data-anolis-xref="handler-appcache-onobsolete" id="handler-appcache-onobsolete"><code>onobsolete</code></dfn> </td><td> <code data-anolis-xref="event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code>
  </td></tr></table></div>


  <h4 id="browser-state"><span class="secno">5.7.10</span> ブラウザの状態</h4>

  <pre class="idl">[NoInterfaceObject]
interface <dfn id="navigatoronline">NavigatorOnLine</dfn> {
  readonly attribute boolean <a data-anolis-xref="dom-navigator-onLine" href="#dom-navigator-online">onLine</a>;
};</pre>

  <dl class="domintro"><dt><var data-anolis-xref="">window</var> . <code data-anolis-xref="dom-navigator"><a href="webappapis.html#dom-navigator">navigator</a></code> . <code data-anolis-xref="dom-navigator-onLine"><a href="#dom-navigator-online">onLine</a></code></dt>

   <dd>

    <p>ユーザーエージェントが正確にオフラインである（ネットワークから切断されている）場合にfalseを返すユーザーエージェントがオンラインかもしれない場合にtrueを返す。</p>

    <p>この属性値が変更される場合、イベント<code data-anolis-xref="event-online"><a href="#event-online">online</a></code>および<code data-anolis-xref="event-offline"><a href="#event-offline">offline</a></code>が発火する。</p>

   </dd>

  </dl><div class="impl">

  <p>The <dfn data-anolis-xref="dom-navigator-onLine" id="dom-navigator-online"><code>navigator.onLine</code></dfn> attribute must return
  false if the user agent will not contact the network when the user follows links or when a script
  requests a remote page (or knows that such an attempt would fail), and must return true
  otherwise.</p>

  <p>When the value that would be returned by the <code data-anolis-xref="dom-navigator-onLine"><a href="#dom-navigator-online">navigator.onLine</a></code> attribute of a <code><a href="#window">Window</a></code> or
  <code>WorkerGlobalScope</code> changes from true to false, the user agent must <a href="webappapis.html#queue-a-task">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <dfn data-anolis-xref="event-offline" id="event-offline"><code>offline</code></dfn> at the <code><a href="#window">Window</a></code> or
  <code>WorkerGlobalScope</code> object.</p>

  <p>On the other hand, when the value that would be returned by the <code data-anolis-xref="dom-navigator-onLine"><a href="#dom-navigator-online">navigator.onLine</a></code> attribute of a <code><a href="#window">Window</a></code> or
  <code>WorkerGlobalScope</code> changes from false to true, the user agent must <a href="webappapis.html#queue-a-task">queue a
  task</a> to <a href="webappapis.html#fire-a-simple-event">fire a simple event</a> named <dfn data-anolis-xref="event-online" id="event-online"><code>online</code></dfn> at the <code><a href="#window">Window</a></code> or
  <code>WorkerGlobalScope</code> object.</p>

  <p>The <a href="webappapis.html#task-source">task source</a> for these <a data-anolis-xref="concept-task" href="webappapis.html#concept-task">tasks</a> is the
  <a href="webappapis.html#networking-task-source">networking task source</a>.</p>

  </div>

  <p class="note">この属性は、本質的に信頼できない。コンピュータは、インターネット接続がなくてもネットワークに接続できる。</p>

  <div class="example">

   <p>この例において、ブラウザがオンラインおよびオフラインになるように、インジケータが更新される。</p>

   <pre>&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
 &lt;head&gt;
  &lt;title&gt;Online status&lt;/title&gt;
  &lt;script&gt;
   function updateIndicator() {
     document.getElementById('indicator').textContent = navigator.onLine ? 'online' : 'offline';
   }
  &lt;/script&gt;
 &lt;/head&gt;
 &lt;body onload="updateIndicator()" ononline="updateIndicator()" onoffline="updateIndicator()"&gt;
  &lt;p&gt;The network is: &lt;span id="indicator"&gt;(state unknown)&lt;/span&gt;
 &lt;/body&gt;
&lt;/html&gt;</pre>

  </div><!--TOPIC:DOM APIs--><!--TOPIC:HTML-->








  </body></html>
<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><style>
   .bad, .bad *:not(.X\58X) { color: gray; }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix, .equations { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   .parse-error-table td > p:first-child { margin-top: 0; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('https://html.spec.whatwg.org/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('https://html.spec.whatwg.org/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('https://html.spec.whatwg.org/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('https://html.spec.whatwg.org/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style><body>
  
  <script async="" crossorigin="" src="https://html.spec.whatwg.org/html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">7 February 2020</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="browsing-the-web.html">← 7.8 ウェブを閲覧する</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav><ol class="toc"><li id="toc-browsers"><ol><li><a href="offline.html#offline"><span class="secno">7.9</span> オフラインウェブアプリケーション</a><ol><li><a href="offline.html#introduction-10"><span class="secno">7.9.1</span> 導入</a><ol><li><a href="offline.html#supporting-offline-caching-for-legacy-applications"><span class="secno">7.9.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート</a><li><a href="offline.html#appcacheevents"><span class="secno">7.9.1.2</span> Events summary</a></ol><li><a href="offline.html#appcache"><span class="secno">7.9.2</span> Application caches</a><li><a href="offline.html#manifests"><span class="secno">7.9.3</span> キャッシュマニフェスト構文</a><ol><li><a href="offline.html#some-sample-manifests"><span class="secno">7.9.3.1</span> サンプルマニフェスト</a><li><a href="offline.html#writing-cache-manifests"><span class="secno">7.9.3.2</span> キャッシュマニフェストの記述</a><li><a href="offline.html#parsing-cache-manifests"><span class="secno">7.9.3.3</span> Parsing cache manifests</a></ol><li><a href="offline.html#downloading-or-updating-an-application-cache"><span class="secno">7.9.4</span> Downloading or updating an application cache</a><li><a href="offline.html#the-application-cache-selection-algorithm"><span class="secno">7.9.5</span> The application cache selection algorithm</a><li><a href="offline.html#changesToNetworkingModel"><span class="secno">7.9.6</span> Changes to the networking model</a><li><a href="offline.html#expiring-application-caches"><span class="secno">7.9.7</span> Expiring application caches</a><li><a href="offline.html#disk-space"><span class="secno">7.9.8</span> Disk space</a><li><a href="offline.html#security-concerns-with-offline-applications-caches"><span class="secno">7.9.9</span> Security concerns with offline applications caches</a><li><a href="offline.html#application-cache-api"><span class="secno">7.9.10</span> アプリケーションキャッシュAPI</a><li><a href="offline.html#navigator.online"><span class="secno">7.9.11</span> ブラウザーの状態</a></ol></ol></ol><h3 id="offline"><span class="secno">7.9</span> オフラインウェブアプリケーション<a href="#offline" class="self-link"></a></h3><div class="status"><input onclick="toggleStatus(this)" value="⋰" type="button"><p class="support"><strong>Support:</strong> offline-apps<span class="and_chr yes"><span>Chrome for Android</span> <span>79+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>3.5+</span></span><span class="safari yes"><span>Safari</span> <span>4+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>12.12+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><span class="and_ff yes"><span>Firefox for Android</span> <span>68+</span></span><p class="caniuse">Source: <a href="https://caniuse.com/#feat=offline-apps">caniuse.com</a></div> 

  <p class="critical">This feature is in the process of being removed from the Web platform. (This is a long process that takes many years.) Using any of the offline Web application features at this time is highly discouraged. 代わりにサービスワーカーを使用すること。<a href="references.html#refsSW">[SW]</a></p>

  

  <h4 id="introduction-10"><span class="secno">7.9.1</span> 導入<a href="#introduction-10" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p>ネットワーク接続が利用できない場合―たとえば、ユーザーがISPのカバレッジエリアの外に移動しているため―でも、ユーザーにウェブアプリケーションおよび文書との対話を継続できるようにするために、著者は、オフラインで作業し、オフラインで使用のためにファイルのコピーを保持するためにユーザーのブラウザーになる、ウェブアプリケーション用に必要とされるファイルの一覧を示したマニフェストを提供できる。</p>

  <p>これを説明するために、HTMLページ"<code>clock1.html</code>"、CSSスタイルシート"<code>clock.css</code>"、およびJavaScriptスクリプト"<code>clock.js</code>"から成る単純な時計アプレットを考えてみる。</p>

  <p>マニフェストを追加する前に、これらの3つのファイルは次のようになる：</p>

  <pre><code class='html'><c- c>&lt;!-- clock1.html --></c->
<c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>meta</c-> <c- e>charset</c-><c- o>=</c-><c- s>"utf-8"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Clock<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"clock.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>link</c-> <c- e>rel</c-><c- o>=</c-><c- s>"stylesheet"</c-> <c- e>href</c-><c- o>=</c-><c- s>"clock.css"</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The time is: <c- p>&lt;</c-><c- f>output</c-> <c- e>id</c-><c- o>=</c-><c- s>"clock"</c-><c- p>>&lt;/</c-><c- f>output</c-><c- p>>&lt;/</c-><c- f>p</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c->
</code></pre>
  <pre><code class='css'><c- c>/* clock.css */</c->
<c- f>output </c-><c- p>{</c-> <c- k>font</c-><c- p>:</c-> <c- m>2</c-><c- l>em</c-> sans-serif<c- p>;</c-> <c- p>}</c->
</code></pre>
  <pre><code class='js'><c- d>/* clock.js */</c->
setInterval<c- p>(</c-><c- a>function</c-> <c- p>()</c-> <c- p>{</c->
    document<c- p>.</c->getElementById<c- p>(</c-><c- t>'clock'</c-><c- p>).</c->value <c- o>=</c-> <c- k>new</c-> Date<c- p>();</c->
<c- p>},</c-> <c- mi>1000</c-><c- p>);</c->
</code></pre>

  <p>ユーザーがオフライン時に"<code>clock1.html</code>"ページを開こうとする場合、しかし、（ローカルキャッシュにまだ持つ場合を除いて）ユーザーエージェントはエラーとともに失敗する。</p>

  <p>著者は、代わりに"<code>clock.appcache</code>"という、3つのファイルのマニフェストを提供できる：</p>

  <pre>CACHE MANIFEST
clock2.html
clock.css
clock.js
</pre>

  <p>HTMLファイルへの小さな変化とともに、（<code id="introduction-10:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>で提供される）マニフェストがアプリケーションにリンクされている：</p>

  <pre><code class='html'><c- c>&lt;!-- clock2.html --></c->
<c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>manifest</c-><c- o>=</c-><c- s>"clock.appcache"</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>meta</c-> <c- e>charset</c-><c- o>=</c-><c- s>"utf-8"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Clock<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"clock.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>link</c-> <c- e>rel</c-><c- o>=</c-><c- s>"stylesheet"</c-> <c- e>href</c-><c- o>=</c-><c- s>"clock.css"</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The time is: <c- p>&lt;</c-><c- f>output</c-> <c- e>id</c-><c- o>=</c-><c- s>"clock"</c-><c- p>>&lt;/</c-><c- f>output</c-><c- p>>&lt;/</c-><c- f>p</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c->
</code></pre>

  <p>さて、ユーザーがページに行く場合、ブラウザーはファイルをキャッシュし、ユーザーがオフラインである場合でも、それらを使用できるようにする。</p>

  <p class="note">著者はまた、マニフェストのメインページを含めることを推奨するが、実際にマニフェストを参照されるページは、明示的に言及されない場合でも、自動的にキャッシュされる。</p>

  <p class="note">"no-store"ディレクティブ例外とともに、TLSで供給される（<code id="introduction-10:https-protocol"><a data-x-internal="https-protocol" href="https://triple-underscore.github.io/RFC7230-ja.html#section-2.7.2">https:</a></code>を使用して暗号化される）キャッシュページでのHTTPキャッシュヘッダーと制限は、マニフェストによって上書きされる。したがって、ページは、ユーザーエージェントがそれを更新する前にアプリケーションキャッシュから期限切れにならず、TLS経由で提供されるアプリケーションはオフラインで動作させることができる。</p>

  <p><a href="https://html.spec.whatwg.org/demos/offline/clock/clock2.html">この例をオンラインで見る</a>。</p>



  <h5 id="supporting-offline-caching-for-legacy-applications"><span class="secno">7.9.1.1</span> レガシーアプリケーションへのオフラインキャッシュのサポート<a href="#supporting-offline-caching-for-legacy-applications" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>マニフェストに記載されかつアプリケーションキャッシュに格納されたロジック（マークアップ、スクリプト、スタイルシート、画像など）とともに、アプリケーションに対する有限数の静的HTMLページとともに、およびウェブストレージまたはサーバー側にインデックス付けされたデータベースに格納されたアプリケーションおよびユーザーデーターとともに、アプリケーションロジックがアプリケーションとユーザーデータから別れる場合、アプリケーションキャッシュ機能は最も機能的に動作し、ウェブソケット、<code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>、サーバーに送信されるイベント、または他の同様の機構を使用して動的に更新される。</p>

  <p>このモデルはユーザーに対して高速な経験をもたらす：（おそらく古いデータを示しつつ）アプリケーション即時に読み込み、ネットワークがそれを可能にするように、新鮮なデータを高速に得られる。</p>

  <p>しかし、レガシーアプリケーションは、サーバーから新しいHTMLページで得られた各操作とともに、ユーザーデータおよびロジックがHTMLと一緒に混合されるように設計される傾向にある。</p>

  <div class="example"><p>たとえば、ニュースアプリケーションを考えてみよう。このようなアプリケーションの典型的なアーキテクチャーは、アプリケーションキャッシュ機能を使用しない場合、ユーザーはメインページをフェッチし、サーバーは現在の見出しとユーザーインタフェースロジックを一緒に混合した動的に生成されるページを返す。</p>

   <p>しかし、アプリケーションキャッシュ機能のために設計されたニュースアプリケーションは、ロジックでのみ構成されるメインページを代わりに持つだろうし、メインページがサーバーとは別にデータをフェッチしているだろう。たとえば、<code id="supporting-offline-caching-for-legacy-applications:xmlhttprequest-2"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>を使用して。</p>

  </div>

  <p>混合コンテンツモデルは、アプリケーションのキャッシュ機能とともにうまく動作しない：コンテンツがキャッシュされているので、常にキャッシュが更新された前回から古いデータを見て、ユーザーにもたらすだろう。</p>

  <p>分離されたモデルと同じ速さで、従来のモデルを動作させる方法がないが、それは少なくとも<a href="#concept-appcache-mode-prefer-online" id="supporting-offline-caching-for-legacy-applications:concept-appcache-mode-prefer-online">好ましいオンライン</a><a href="#concept-appcache-mode" id="supporting-offline-caching-for-legacy-applications:concept-appcache-mode">アプリケーションキャッシュモード</a>を使用してオフライン利用で使用するために改造<em>できる</em>。これを行うには、<a href="#concept-appcache-manifest" id="supporting-offline-caching-for-legacy-applications:concept-appcache-manifest">アプリケーションキャッシュマニフェスト</a>でオフライン作業をしたいHTMLページによって使用されるすべての静的リソースを一覧表示し、HTMLファイルからそのマニフェストを選択する<code id="supporting-offline-caching-for-legacy-applications:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code>属性を使用し、マニフェストの一番下に次の行を追加する：</p>

  <pre>SETTINGS:
prefer-online
NETWORK:
*</pre>

  <p>ユーザーがオフラインである際に、許可するすべてのリソースが通常アクセスされるマニフェストに記載されていない一方で、これは、<a href="#concept-appcache-master" id="supporting-offline-caching-for-legacy-applications:concept-appcache-master">マスターエントリ</a>にのみ使用される<a href="#application-cache" id="supporting-offline-caching-for-legacy-applications:application-cache">アプリケーションキャッシュ</a>を引き起こし、（本質的にマニフェストに記載されているリソースをピン留めする）分割不能なHTTPキャッシュとして使用されるアプリケーションキャッシュを引き起こす。</p>



  <h5 id="appcacheevents"><span class="secno">7.9.1.2</span> イベントの概要<a href="#appcacheevents" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>ユーザーがマニフェストを宣言するページを訪問する際に、ブラウザーはキャッシュを更新しようとする。これは、ユーザーエージェントが最後にそれを見てからマニフェストが変更された場合、それが言及されているすべてのリソースを再ダウンロードして改めてキャッシュし、マニフェストのコピーを取得することによってこれを行う。</p>

  <p>これが起こっているように、ユーザーに適切な方法で通知できるように、イベントの数は、キャッシュの更新の状態へと更新されたスクリプトを保つために<code id="appcacheevents:applicationcache"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトで発火する。イベントは次のとおり：</p>

  <table><thead><tr><th>イベント名<th>インターフェイス<th>発火条件<th>次のイベント<tbody><tr><td><dfn id="event-appcache-checking"><code>checking</code></dfn><td><code id="appcacheevents:event"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>ユーザーエージェントは、更新をチェックする、または初回のマニフェストをダウンロードしようとしている。<strong>これは、常にシーケンスの最初のイベントである。</strong><td><code id="appcacheevents:event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code>、<code id="appcacheevents:event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code>、<code id="appcacheevents:event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code>、<code id="appcacheevents:event-appcache-error"><a href="#event-appcache-error">error</a></code><tr><td><dfn id="event-appcache-noupdate"><code>noupdate</code></dfn><td><code id="appcacheevents:event-2"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストは変更されなかった。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-downloading"><code>downloading</code></dfn><td><code id="appcacheevents:event-3"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>ユーザーエージェントは更新を発見し、それをフェッチしている、または初回のマニフェストで記載されたリソースをダウンロードしている。<td><code id="appcacheevents:event-appcache-progress"><a href="#event-appcache-progress">progress</a></code>、<code id="appcacheevents:event-appcache-error-2"><a href="#event-appcache-error">error</a></code>、<code id="appcacheevents:event-appcache-cached"><a href="#event-appcache-cached">cached</a></code>、<code id="appcacheevents:event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code><tr><td><dfn id="event-appcache-progress"><code>progress</code></dfn><td><code id="appcacheevents:progressevent"><a data-x-internal="progressevent" href="https://triple-underscore.github.io/XHR-ja.html#interface-progressevent">ProgressEvent</a></code><td>ユーザーエージェントは、マニフェストで記載されたリソースをダウンロードしている。イベントオブジェクトの<code id="appcacheevents:dom-progressevent-total"><a data-x-internal="dom-progressevent-total" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total">total</a></code>属性は、ダウンロードされたファイルの合計数を返す。イベントオブジェクトの<code id="appcacheevents:dom-progressevent-loaded"><a data-x-internal="dom-progressevent-loaded" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded">loaded</a></code>属性は、これまでに処理されたファイルの数を返す。<td><code id="appcacheevents:event-appcache-progress-2"><a href="#event-appcache-progress">progress</a></code>、<code id="appcacheevents:event-appcache-error-3"><a href="#event-appcache-error">error</a></code>、<code id="appcacheevents:event-appcache-cached-2"><a href="#event-appcache-cached">cached</a></code>、<code id="appcacheevents:event-appcache-updateready-2"><a href="#event-appcache-updateready">updateready</a></code><tr><td><dfn id="event-appcache-cached"><code>cached</code></dfn><td><code id="appcacheevents:event-4"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストに記載されたリソースがダウンロードされ、アプリケーションがキャッシュされた。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-updateready"><code>updateready</code></dfn><td><code id="appcacheevents:event-5"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストに記載されたリソースは新しく再ダウンロードされており、スクリプトは新しいキャッシュに切り替えるために<code id="appcacheevents:dom-appcache-swapcache"><a href="#dom-appcache-swapcache">swapCache()</a></code>を使用できる。<td>シーケンス内の最後のイベント。<tr><td><dfn id="event-appcache-obsolete"><code>obsolete</code></dfn><td><code id="appcacheevents:event-6"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストは404または410ページになっていることが判明し、アプリケーションのキャッシュを削除している。<td>シーケンス内の最後のイベント。<tr><td rowspan="4"><dfn id="event-appcache-error"><code>error</code></dfn><td rowspan="4"><code id="appcacheevents:event-7"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code><td>マニフェストが404または410ページだったので、アプリケーションをキャッシュする試みが中止された。<td rowspan="3">シーケンス内の最後のイベント。<tr><td>マニフェストは変更されなかったが、マニフェストを参照するページが正しくダウンロードでなかった。<tr><td>マニフェストに記載されたリソースを取得するときに致命的なエラーが発生した。<tr><td>更新されている間にマニフェストが変更された。<td>ユーザーエージェントは、再び一時的にファイルを取得しようする。</table>

  <p>これらのイベントはキャンセル可能である。それらのデフォルトアクションは、ダウンロードの進捗情報を表示するためのユーザーエージェントに対するものである。ページが独自のアップデートのUIが表示する場合、イベントのキャンセルは、冗長な進捗情報の表示からユーザーエージェントを防ぐだろう。</p>



  

  <h4 id="appcache"><span class="secno">7.9.2</span> Application caches<a href="#appcache" class="self-link"></a></h4> 

  <p>An <dfn id="application-cache" data-export="">application cache</dfn> is a set of cached resources consisting of:</p>

  <ul><li><p>One or more resources (including their out-of-band metadata, such as HTTP headers, if any), identified by URLs, each falling into one (or more) of the following categories:</p>

    <dl><dt><dfn id="concept-appcache-master">Master entries</dfn><dd><p class="note">These are documents that were added to the cache because a <a id="appcache:browsing-context" href="browsers.html#browsing-context">browsing context</a> was <a href="browsing-the-web.html#navigate" id="appcache:navigate">navigated</a> to that document and the document indicated that this was its cache, using the <code id="appcache:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute.</p>


     <dt><dfn id="concept-appcache-manifest">The manifest</dfn><dd><p class="note">This is the resource corresponding to the URL that was given in a master entry's <code id="appcache:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element's <code id="appcache:attr-html-manifest-2"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute. The manifest is fetched and processed during the <a href="#application-cache-download-process" id="appcache:application-cache-download-process">application cache download process</a>. All the <a href="#concept-appcache-master" id="appcache:concept-appcache-master">master entries</a> have the <a href="origin.html#same-origin" id="appcache:same-origin">same origin</a> as the manifest.</p>


     <dt><dfn id="concept-appcache-explicit">Explicit entries</dfn><dd><p class="note">These are the resources that were listed in the cache's <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest">manifest</a> in an <a href="#concept-appcache-manifest-explicit" id="appcache:concept-appcache-manifest-explicit">explicit section</a>.</p>


     <dt><dfn id="concept-appcache-fallback">Fallback entries</dfn><dd><p class="note">These are the resources that were listed in the cache's <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest-2">manifest</a> in a <a href="#concept-appcache-manifest-fallback" id="appcache:concept-appcache-manifest-fallback">fallback section</a>.</p>


    </dl>

    <p><a href="#concept-appcache-explicit" id="appcache:concept-appcache-explicit">Explicit entries</a> and <a href="#concept-appcache-fallback" id="appcache:concept-appcache-fallback">Fallback entries</a> can be marked as <dfn id="concept-appcache-foreign">foreign</dfn>, which means that they have a <code id="appcache:attr-html-manifest-3"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute but that it doesn't point at this cache's <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest-3">manifest</a>.</p>

    <p class="note">A URL in the list can be flagged with multiple different types, and thus an entry can end up being categorized as multiple entries. For example, an entry can be a manifest entry and an explicit entry at the same time, if the manifest is listed within the manifest.</p>

   <li><p>Zero or more <dfn id="concept-appcache-fallback-ns">fallback namespaces</dfn>, each of which is mapped to a <a href="#concept-appcache-fallback" id="appcache:concept-appcache-fallback-2">fallback entry</a>.</p>

    <p class="note">These are URLs used as <a href="#concept-appcache-matches-fallback" id="appcache:concept-appcache-matches-fallback">prefix match patterns</a> for resources that are to be fetched from the network if possible, or to be replaced by the corresponding <a href="#concept-appcache-fallback" id="appcache:concept-appcache-fallback-3">fallback entry</a> if not. Each namespace URL has the <a id="appcache:same-origin-2" href="origin.html#same-origin">same origin</a> as <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest-4">the manifest</a>.</p>

   <li><p>Zero or more URLs that form the <dfn id="concept-appcache-onlinesafelist">online safelist namespaces</dfn>.</p>

    <p class="note">These are used as prefix match patterns, and declare URLs for which the user agent will ignore the application cache, instead fetching them normally (i.e. from the network or local HTTP cache as appropriate).</p>

   <li><p>An <dfn id="concept-appcache-onlinesafelist-wildcard">online safelist wildcard flag</dfn>, which is either <i>open</i> or <i>blocking</i>.</p>

    <p class="note">The <i>open</i> state indicates that any URL not listed as cached is to be implicitly treated as being in the <a href="#concept-appcache-onlinesafelist" id="appcache:concept-appcache-onlinesafelist">online safelist namespaces</a>; the <i>blocking</i> state indicates that URLs not listed explicitly in the manifest are to be treated as unavailable.</p>

   <li><p>A <dfn id="concept-appcache-mode">cache mode flag</dfn>, which is either in the <dfn id="concept-appcache-mode-fast"><i>fast</i></dfn> state or the <dfn id="concept-appcache-mode-prefer-online"><i>prefer-online</i></dfn> state.</p>

   </ul>

  <p>Each <a href="#application-cache" id="appcache:application-cache">application cache</a> has a <dfn id="concept-appcache-completeness">completeness flag</dfn>, which is either <i>complete</i> or <i>incomplete</i>.</p>

  <hr>

  <p>An <dfn id="application-cache-group">application cache group</dfn> is a group of <a href="#application-cache" id="appcache:application-cache-2">application caches</a>, identified by the <a id="appcache:absolute-url" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> of a resource <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest-5">manifest</a> which is used to populate the caches in the group.</p>

  <p>An <a href="#application-cache" id="appcache:application-cache-3">application cache</a> is <dfn id="concept-appcache-newer">newer</dfn> than another if it was created after the other (in other words, <a href="#application-cache" id="appcache:application-cache-4">application caches</a> in an <a href="#application-cache-group" id="appcache:application-cache-group">application cache group</a> have a chronological order).</p>

  <p>Only the newest <a href="#application-cache" id="appcache:application-cache-5">application cache</a> in an <a href="#application-cache-group" id="appcache:application-cache-group-2">application cache group</a> can have its <a href="#concept-appcache-completeness" id="appcache:concept-appcache-completeness">completeness flag</a> set to <i>incomplete</i>; the others are always all <i>complete</i>.</p>

  <p>Each <a href="#application-cache-group" id="appcache:application-cache-group-3">application cache group</a> has an <dfn id="concept-appcache-status">update status</dfn>, which is one of the following: <i>idle</i>, <i>checking</i>, <i>downloading</i>.</p>

  <p>A <dfn id="relevant-application-cache">relevant application cache</dfn> is an <a href="#application-cache" id="appcache:application-cache-6">application cache</a> that is the <a href="#concept-appcache-newer" id="appcache:concept-appcache-newer">newest</a> in its <a href="#application-cache-group" id="appcache:application-cache-group-4">group</a> to be <i>complete</i>.</p>

  <p>Each <a href="#application-cache-group" id="appcache:application-cache-group-5">application cache group</a> has a <dfn id="concept-appcache-pending-masters">list of pending master entries</dfn>. Each entry in this list consists of a resource and a corresponding <code id="appcache:document"><a href="dom.html#document">Document</a></code> object. It is used during the <a href="#application-cache-download-process" id="appcache:application-cache-download-process-2">application cache download process</a> to ensure that new master entries are cached even if the <a href="#application-cache-download-process" id="appcache:application-cache-download-process-3">application cache download process</a> was already running for their <a href="#application-cache-group" id="appcache:application-cache-group-6">application cache group</a> when they were loaded.</p>

  <p>An <a href="#application-cache-group" id="appcache:application-cache-group-7">application cache group</a> can be marked as <dfn id="concept-appcache-obsolete">obsolete</dfn>, meaning that it must be ignored when looking at what <a href="#application-cache-group" id="appcache:application-cache-group-8">application cache groups</a> exist.</p>

  <hr>

  <p>A <dfn id="cache-host">cache host</dfn> is a <code id="appcache:document-2"><a href="dom.html#document">Document</a></code> object.</p>

  <p>Each <a href="#cache-host" id="appcache:cache-host">cache host</a> has an associated <code id="appcache:applicationcache"><a href="#applicationcache">ApplicationCache</a></code> object.</p>

  <p>Each <a href="#cache-host" id="appcache:cache-host-2">cache host</a> initially is not associated with an <a href="#application-cache" id="appcache:application-cache-7">application cache</a>, but can become associated with one early during the page load process, when steps <a href="parsing.html#parser-appcache">in the parser</a> and in the <a href="browsing-the-web.html#navigate" id="appcache:navigate-2">navigation</a> sections cause <a href="#concept-appcache-init" id="appcache:concept-appcache-init">cache selection</a> to occur.</p>

  <hr>

  <p>Multiple <a href="#application-cache" id="appcache:application-cache-8">application caches</a> in different <a href="#application-cache-group" id="appcache:application-cache-group-9">application cache groups</a> can contain the same resource, e.g. if the manifests all reference that resource. If the user agent is to <dfn id="concept-appcache-selection">select an application cache</dfn> from a list of <a href="#relevant-application-cache" id="appcache:relevant-application-cache">relevant application caches</a> that contain a resource, the user agent must use the application cache that the user most likely wants to see the resource from, taking into account the following:</p>

  <ul><li>which application cache was most recently updated,<li>which application cache was being used to display the resource from which the user decided to look at the new resource, and<li>which application cache the user prefers.</ul>

  <hr>

  <p>A URL <dfn id="concept-appcache-matches-fallback">matches a fallback namespace</dfn> if there exists a <a href="#relevant-application-cache" id="appcache:relevant-application-cache-2">relevant application cache</a> whose <a href="#concept-appcache-manifest" id="appcache:concept-appcache-manifest-6">manifest</a>'s URL has the <a id="appcache:same-origin-3" href="origin.html#same-origin">same origin</a> as the URL in question, and that has a <a href="#concept-appcache-fallback-ns" id="appcache:concept-appcache-fallback-ns">fallback namespace</a> that is a <a id="appcache:prefix-match" href="infrastructure.html#prefix-match">prefix match</a> for the URL being examined. If multiple fallback namespaces match the same URL, the longest one is the one that matches. A URL looking for a fallback namespace can match more than one application cache at a time, but only matches one namespace in each cache.</p>

  <div class="example"><p>If a manifest <code>https://example.com/app1/manifest</code> declares that <code>https://example.com/resources/images</code> is a fallback namespace, and the user navigates to <code>https://example.com:80/resources/images/cat.png</code>, then the user agent will decide that the application cache identified by <code>https://example.com/app1/manifest</code> contains a namespace with a match for that URL.</p>

   

  </div>

  



  <h4 id="manifests"><span class="secno">7.9.3</span> キャッシュマニフェスト構文<a href="#manifests" class="self-link"></a></h4>


  <h5 id="some-sample-manifests"><span class="secno">7.9.3.1</span> サンプルマニフェスト<a href="#some-sample-manifests" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <div class="example"><p>This example manifest requires two images and a style sheet to be cached and safelists a CGI script.</p>

   <pre>CACHE MANIFEST
# the above line is required

# this is a comment
# there can be as many of these anywhere in the file
# they are all ignored
  # comments can have spaces before them
  # but must be alone on the line

# blank lines are ignored too

# these are files that need to be cached they can either be listed
# first, or a "CACHE:" header could be put before them, as is done
# lower down.
images/sound-icon.png
images/background.png
# note that each file has to be put on its own line

# here is a file for the online safelist -- it isn't cached, and
# references to this file will bypass the cache, always hitting the
# network (or trying to, if the user is offline).
NETWORK:
comm.cgi

# here is another set of files to cache, this time just the CSS file.
CACHE:
style/default.css</pre>

   <p>同様に次のように記述することができる：</p>

   <pre>CACHE MANIFEST
NETWORK:
comm.cgi
CACHE:
style/default.css
images/sound-icon.png
images/background.png</pre>

  </div>

  <div class="example"><p>オフラインアプリケーションキャッシュマニフェストは、絶対パスまたは絶対URLを使用することができる：</p>

   <pre>CACHE MANIFEST

/main/home
/main/app.js
/settings/home
/settings/app.js
https://img.example.com/logo.png
https://img.example.com/check.png
https://img.example.com/cross.png</pre>

  </div>

  <div class="example"><p>次のマニフェストは、ユーザーがオフラインの間にサイト上の任意のページに表示されている汎用のエラーページを定義する。これはまた、<a href="#concept-appcache-onlinesafelist-wildcard" id="some-sample-manifests:concept-appcache-onlinesafelist-wildcard">オンラインセーフリストワイルドカードフラグ</a>が<i>open</i>であることを指定し、他のサイト上のリソースにアクセスがブロックされないことを意味する。（汎用フォールバック名前空間なので、同じサイト上のリソースがすでにブロックされない。）</p>

   <p>このマニフェスト上のすべてのページのように、同じページにヒットする後続はキャッシュからすぐに読み込まれるので、それらが取得されるようにローカルでキャッシュされるだろう。マニフェストが変更されるまで、これらのページは、再度サーバーから取得されることはない。マニフェストが変更される際、次にすべてのファイルが再ダウンロードされる。</p>

   <p>スタイルシートや画像などのようなサブリソースは、しかし、通常のHTTPキャッシングセマンティックスを使用してのみキャッシュされる。</p>

   <pre>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</pre>

  </div>



  <h5 id="writing-cache-manifests"><span class="secno">7.9.3.2</span> キャッシュマニフェストの記述<a href="#writing-cache-manifests" class="self-link"></a></h5>

  <p>マニフェストは、<code id="writing-cache-manifests:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code><a id="writing-cache-manifests:mime-type" href="https://mimesniff.spec.whatwg.org/#mime-type" data-x-internal="mime-type">MIMEタイプ</a>を使用して配信しなければならない。<code id="writing-cache-manifests:text/cache-manifest-2"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code><a id="writing-cache-manifests:mime-type-2" href="https://mimesniff.spec.whatwg.org/#mime-type" data-x-internal="mime-type">MIMEタイプ</a>を使用して配信されるすべてのリソースは、この節で説明するように、アプリケーションキャッシュマニフェストの構文に従わなければならない。</p>

  <p>アプリケーションキャッシュマニフェストは、テキストがUTF-8を使用してエンコードされるテキストファイルである。アプリケーションキャッシュマニフェストでのデータは行ベースである。Newlines must be represented by U+000A LINE FEED (LF) characters, U+000D CARRIAGE RETURN (CR) characters, or U+000D CARRIAGE RETURN (CR) U+000A LINE FEED (LF) pairs. <a href="references.html#refsENCODING">[ENCODING]</a></p>

  <p class="note">これは、すべての<code>text/*</code>型が唯一のCRLF改行を許可する必要がある、RFC 2046の<a id="writing-cache-manifests:willful-violation" href="introduction.html#willful-violation">故意の違反</a>である。しかし、この要件は時代遅れである。CR、LFおよびCRLFの改行の使用は一般的に支持されており、実際に時にCRLFはテキストエディターでサポートされ<em>ない</em>。<a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p>The first line of an application cache manifest must consist of the string "CACHE", a single U+0020 SPACE character, the string "MANIFEST", and either a U+0020 SPACE character, a U+0009 CHARACTER TABULATION (tab) character, a U+000A LINE FEED (LF) character, or a U+000D CARRIAGE RETURN (CR) character. The first line may optionally be preceded by a U+FEFF BYTE ORDER MARK (BOM) character. 他のテキストが最初の行にある場合、無視される。</p>

  <p>後続の行がもしあれば、すべて次のいずれかでなければならない：</p>

  <dl><dt>空白行<dd><p>Blank lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters only.</p>

   <dt>コメント<dd><p>Comment lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, followed by a single U+0023 NUMBER SIGN character (#), followed by zero or more characters other than U+000A LINE FEED (LF) and U+000D CARRIAGE RETURN (CR) characters.</p>

    <p class="note">Comments need to be on a line on their own. If they were to be included on a line with a URL, the "#" would be mistaken for part of a <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="writing-cache-manifests:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a>.</p>

   <dt>セクションヘッダー<dd><p>セクションヘッダーは、現在のセクションを変更する。可能な4つのセクションヘッダーが存在する：<dl><dt><code>CACHE:</code><dd><dfn id="concept-appcache-manifest-explicit">明示的なセクション</dfn>に切り替える。<dt><code>FALLBACK:</code><dd><dfn id="concept-appcache-manifest-fallback">代替セクション</dfn>に切り替える。<dt><code>NETWORK:</code><dd>Switches to the <dfn id="concept-appcache-manifest-network">online safelist section</dfn>.<dt><code>SETTINGS:</code><dd><dfn id="concept-appcache-manifest-settings">設定セクション</dfn>に切り替える。</dl>

    <p>Section header lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, followed by one of the names above (including the U+003A COLON character (:)) followed by zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>皮肉なことに、デフォルトでは、現在のセクションは、<a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit">明示的なセクション</a>である。</p>

   <dt>現在のセクションのデータ<dd><p>データ行が取得しなければならない形式は、現在のセクションに依存する。</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-2">explicit section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a id="writing-cache-manifests:valid-url-string" href="https://triple-underscore.github.io/U#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback">fallback section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a id="writing-cache-manifests:valid-url-string-2" href="https://triple-underscore.github.io/U#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, one or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, another <a id="writing-cache-manifests:valid-url-string-3" href="https://triple-underscore.github.io/U#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network">online safelist section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, either a single U+002A ASTERISK character (*) or a <a id="writing-cache-manifests:valid-url-string-4" href="https://triple-underscore.github.io/U#valid-url-string" data-x-internal="valid-url-string">valid URL string</a> identifying a resource other than the manifest itself, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>When the current section is the <a href="#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings">settings section</a>, data lines must consist of zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters, a <a href="#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting">setting</a>, and then zero or more U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters.</p>

    <p>現在のところ1つの<dfn id="concept-appcache-manifest-setting">設定</dfn>のみが定義される：</p>

    <dl><dt>キャッシュモード設定<dd>これは、文字列"<code>prefer-online</code>"で構成される。この文字列は、<a href="#concept-appcache-mode" id="writing-cache-manifests:concept-appcache-mode">キャッシュモード</a>を<a href="#concept-appcache-mode-prefer-online" id="writing-cache-manifests:concept-appcache-mode-prefer-online">優先オンライン</a>に設定する。（<a href="#concept-appcache-mode" id="writing-cache-manifests:concept-appcache-mode-2">キャッシュモード</a>はデフォルトで<a href="#concept-appcache-mode-fast" id="writing-cache-manifests:concept-appcache-mode-fast">高速</a>になる。）</dl>

    <p><a href="#concept-appcache-manifest-settings" id="writing-cache-manifests:concept-appcache-manifest-settings-2">設定セクション</a>内で、各<a href="#concept-appcache-manifest-setting" id="writing-cache-manifests:concept-appcache-manifest-setting-2">設定</a>は1回以上出現してはならない。</p>



  </dl>

  <p>マニフェストは、複数回のセクションを含んでもよい。セクションは空であってもよい。</p>

  <p><a href="#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns">フォールバック名前空間</a>自体に関連付けられたフォールバックページであるURL、およびそれらの名前空間は、データ行の最初のURLである名前空間、および2番目のURLであるフォールバックページ対応する、<a href="#concept-appcache-manifest-fallback" id="writing-cache-manifests:concept-appcache-manifest-fallback-2">フォールバックセクション</a>で指定されなければならない。キャッシュされる他のすべてのページは、<a href="#concept-appcache-manifest-explicit" id="writing-cache-manifests:concept-appcache-manifest-explicit-3">明示的なセクション</a>に記載されなければならない。</p>

  <p><a href="#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-2">フォールバック名前空間</a>および<a href="#concept-appcache-fallback" id="writing-cache-manifests:concept-appcache-fallback">フォールバックエントリ</a>は、マニフェスト自身と<a id="writing-cache-manifests:same-origin" href="origin.html#same-origin">同じ生成元</a>を持たなければならない。<a href="#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-3">Fallback namespaces</a> must also be in the same path as the manifest's URL.</p>

  <p><a href="#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-4">フォールバック名前空間</a>は、複数回記載されてはならない。</p>

  <p>ユーザーエージェントが<a href="#concept-appcache-onlinesafelist" id="writing-cache-manifests:concept-appcache-onlinesafelist">オンラインセーフリスト</a>に入れる名前空間は、すべて<a href="#concept-appcache-manifest-network" id="writing-cache-manifests:concept-appcache-manifest-network-2">オンラインセーフリストセクション</a>で指定されなければならない。(This is needed for any URL that the page is intending to use to communicate back to the server.) To specify that all URLs are automatically safelisted in this way, a U+002A ASTERISK character (*) may be specified as one of the URLs.</p>

  <p>Authors should not include namespaces in the <a href="#concept-appcache-onlinesafelist" id="writing-cache-manifests:concept-appcache-onlinesafelist-2">online safelist</a> for which another namespace in the <a href="#concept-appcache-onlinesafelist" id="writing-cache-manifests:concept-appcache-onlinesafelist-3">online safelist</a> is a <a id="writing-cache-manifests:prefix-match" href="infrastructure.html#prefix-match">prefix match</a>.</p>

  <p><a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-relative" id="writing-cache-manifests:relative-url" data-x-internal="relative-url">相対URL</a>はマニフェスト自身のURLを基準に指定されなければならない。マニフェスト内のすべてのURLは、（明示的または暗黙的に、<a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-relative" id="writing-cache-manifests:relative-url-2" data-x-internal="relative-url">相対URL</a>を使用して）マニフェスト自身と同じ<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="writing-cache-manifests:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a>を持たなければならない。<a href="references.html#refsURL">[URL]</a></p>

  <p>URLs in manifests must not have <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="writing-cache-manifests:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragments</a> (i.e. the U+0023 NUMBER SIGN character isn't allowed in URLs in manifests).</p>

  <p><a href="#concept-appcache-fallback-ns" id="writing-cache-manifests:concept-appcache-fallback-ns-5">Fallback namespaces</a> and namespaces in the <a href="#concept-appcache-onlinesafelist" id="writing-cache-manifests:concept-appcache-onlinesafelist-4">online safelist</a> are matched by <a id="writing-cache-manifests:prefix-match-2" href="infrastructure.html#prefix-match">prefix match</a>.</p>


  

  <h5 id="parsing-cache-manifests"><span class="secno">7.9.3.3</span> Parsing cache manifests<a href="#parsing-cache-manifests" class="self-link"></a></h5>

  <p>When a user agent is to <dfn id="parse-a-manifest">parse a manifest</dfn>, it means that the user agent must run the following steps:</p>

  <ol><li><p><a id="parsing-cache-manifests:utf-8-decode" href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" data-x-internal="utf-8-decode">UTF-8 decode</a> the byte stream corresponding with the manifest to be parsed.</p>

    <p class="note">The <a id="parsing-cache-manifests:utf-8-decode-2" href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" data-x-internal="utf-8-decode">UTF-8 decode</a> algorithm strips a leading BOM, if any.</p>

    

   <li><p>Let <var>base URL</var> be the <a id="parsing-cache-manifests:absolute-url" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> representing the manifest.<li><p>Apply the <a id="parsing-cache-manifests:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> to <var>base URL</var>, and let <var>manifest path</var> be the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-path" id="parsing-cache-manifests:concept-url-path" data-x-internal="concept-url-path">path</a> component thus obtained.<li><p>Remove all the characters in <var>manifest path</var> after the last U+002F SOLIDUS character (/), if any. (The first character and the last character in <var>manifest path</var> after this step will both be slashes, the URL path separator character.)<li><p>Apply the <a id="parsing-cache-manifests:url-parser-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> steps to the <var>base URL</var>, so that the components from its <a id="parsing-cache-manifests:url-record" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> can be used by the subsequent steps of this algorithm.<li><p>Let <var>explicit URLs</var> be an initially empty list of <a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" id="parsing-cache-manifests:absolute-url-2" data-x-internal="absolute-url">absolute URLs</a> for <a href="#concept-appcache-explicit" id="parsing-cache-manifests:concept-appcache-explicit">explicit entries</a>.<li><p>Let <var>fallback URLs</var> be an initially empty mapping of <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns">fallback namespaces</a> to <a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" id="parsing-cache-manifests:absolute-url-3" data-x-internal="absolute-url">absolute URLs</a> for <a href="#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback">fallback entries</a>.<li><p>Let <var>online safelist namespaces</var> be an initially empty list of <a href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" id="parsing-cache-manifests:absolute-url-4" data-x-internal="absolute-url">absolute URLs</a> for an <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist">online safelist</a>.<li><p>Let <var>online safelist wildcard flag</var> be <i>blocking</i>.<li><p>Let <var>cache mode flag</var> be <i>fast</i>.<li><p>Let <var>input</var> be the decoded text of the manifest's byte stream.<li><p>Let <var>position</var> be a pointer into <var>input</var>, initially pointing at the first character.<li><p>If the characters starting from <var>position</var> are "CACHE", followed by a U+0020 SPACE character, followed by "MANIFEST", then advance <var>position</var> to the next character after those. Otherwise, this isn't a cache manifest; return with a failure while checking for the magic signature.<li><p>If the character at <var>position</var> is neither a U+0020 SPACE character, a U+0009 CHARACTER TABULATION (tab) character, U+000A LINE FEED (LF) character, nor a U+000D CARRIAGE RETURN (CR) character, then this isn't a cache manifest; return with a failure while checking for the magic signature.<li><p>This is a cache manifest. The algorithm cannot fail beyond this point (though bogus lines can get ignored).<li><p><a id="parsing-cache-manifests:collect-a-sequence-of-code-points" href="https://triple-underscore.github.io/infra-ja.html#collect-a-sequence-of-code-points" data-x-internal="collect-a-sequence-of-code-points">Collect a sequence of code points</a> that are <em>not</em> U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR) characters from <var>input</var> given <var>position</var>, and ignore those characters. (Extra text on the first line, after the signature, is ignored.)<li><p>Let <var>mode</var> be "explicit".<li><p><i>Start of line</i>: If <var>position</var> is past the end of <var>input</var>, then jump to the last step. Otherwise, <a id="parsing-cache-manifests:collect-a-sequence-of-code-points-2" href="https://triple-underscore.github.io/infra-ja.html#collect-a-sequence-of-code-points" data-x-internal="collect-a-sequence-of-code-points">collect a sequence of code points</a> that are U+000A LINE FEED (LF), U+000D CARRIAGE RETURN (CR), U+0020 SPACE, or U+0009 CHARACTER TABULATION (tab) characters from <var>input</var> given <var>position</var>.<li><p>Now, <a id="parsing-cache-manifests:collect-a-sequence-of-code-points-3" href="https://triple-underscore.github.io/infra-ja.html#collect-a-sequence-of-code-points" data-x-internal="collect-a-sequence-of-code-points">collect a sequence of code points</a> that are <em>not</em> U+000A LINE FEED (LF) or U+000D CARRIAGE RETURN (CR) characters from <var>input</var> given <var>position</var>, and let the result be <var>line</var>.<li><p>Drop any trailing U+0020 SPACE and U+0009 CHARACTER TABULATION (tab) characters at the end of <var>line</var>.<li><p>If <var>line</var> is the empty string, then jump back to the step labeled <i>start of line</i>.<li><p>If the first character in <var>line</var> is a U+0023 NUMBER SIGN character (#), then jump back to the step labeled <i>start of line</i>.<li><p>If <var>line</var> equals "CACHE:" (the word "CACHE" followed by a U+003A COLON character (:)), then set <var>mode</var> to "explicit" and jump back to the step labeled <i>start of line</i>.<li><p>If <var>line</var> equals "FALLBACK:" (the word "FALLBACK" followed by a U+003A COLON character (:)), then set <var>mode</var> to "fallback" and jump back to the step labeled <i>start of line</i>.<li><p>If <var>line</var> equals "NETWORK:" (the word "NETWORK" followed by a U+003A COLON character (:)), then set <var>mode</var> to "online safelist" and jump back to the step labeled <i>start of line</i>.<li><p>If <var>line</var> equals "SETTINGS:" (the word "SETTINGS" followed by a U+003A COLON character (:)), then set <var>mode</var> to "settings" and jump back to the step labeled <i>start of line</i>.<li><p>If <var>line</var> ends with a U+003A COLON character (:), then set <var>mode</var> to "unknown" and jump back to the step labeled <i>start of line</i>.<li><p>This is either a data line or it is syntactically incorrect.<li><p>Let <var>position</var> be a pointer into <var>line</var>, initially pointing at the start of the string.<li><p>Let <var>tokens</var> be a list of strings, initially empty.<li><p>While <var>position</var> doesn't point past the end of <var>line</var>:</p>

    <ol><li><p>Let <var>current token</var> be an empty string.<li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is neither a U+0020 SPACE nor a U+0009 CHARACTER TABULATION (tab) character, add the character at <var>position</var> to <var>current token</var> and advance <var>position</var> to the next character in <var>input</var>.<li><p>Add <var>current token</var> to the <var>tokens</var> list.<li><p>While <var>position</var> doesn't point past the end of <var>line</var> and the character at <var>position</var> is either a U+0020 SPACE or a U+0009 CHARACTER TABULATION (tab) character, advance <var>position</var> to the next character in <var>input</var>.</ol>

   <li><p>Process <var>tokens</var> as follows:</p>

    <dl class="switch"><dt>If <var>mode</var> is "explicit"<dd><p>Let <var>urlRecord</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" id="parsing-cache-manifests:url-parser-3" data-x-internal="url-parser">parsing</a> the first item in <var>tokens</var> with <var>base URL</var>; ignore the rest.</p>

      <p>If <var>urlRecord</var> is failure, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If <var>urlRecord</var> has a different <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="parsing-cache-manifests:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> component than <var>base URL</var> (the manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="parsing-cache-manifests:concept-url-serializer" data-x-internal="concept-url-serializer">URL serializer</a> algorithm to <var>urlRecord</var>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>explicit URLs</var>.</p>

     <dt>If <var>mode</var> is "fallback"<dd><p>Let <var>part one</var> be the first token in <var>tokens</var>, and let <var>part two</var> be the second token in <var>tokens</var>.</p>

      <p>Let <var>urlRecordOne</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" id="parsing-cache-manifests:url-parser-4" data-x-internal="url-parser">parsing</a> <var>part one</var> with <var>base URL</var>.</p>

      <p>Let <var>urlRecordTwo</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" id="parsing-cache-manifests:url-parser-5" data-x-internal="url-parser">parsing</a> <var>part two</var> with <var>base URL</var>.</p>

      <p>If either <var>urlRecordOne</var> or <var>urlRecordTwo</var> are failure, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="parsing-cache-manifests:concept-url-origin" data-x-internal="concept-url-origin">origin</a> of either <var>urlRecordOne</var> or <var>urlRecordTwo</var> is not <a id="parsing-cache-manifests:same-origin" href="origin.html#same-origin">same origin</a> with the manifest's URL <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="parsing-cache-manifests:concept-url-origin-2" data-x-internal="concept-url-origin">origin</a>, then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var>part one path</var> be the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-path" id="parsing-cache-manifests:concept-url-path-2" data-x-internal="concept-url-path">path</a> component of <var>urlRecordOne</var>.</p>

      <p>If <var>manifest path</var> is not a <a id="parsing-cache-manifests:prefix-match" href="infrastructure.html#prefix-match">prefix match</a> for <var>part one path</var>, then jump back to the step labeled <i>start of line</i>.</p> 


      <p>Let <var>part one</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="parsing-cache-manifests:concept-url-serializer-2" data-x-internal="concept-url-serializer">URL serializer</a> algorithm to <var>urlRecordOne</var>, with the <i>exclude fragment flag</i> set.</p>

      <p>Let <var>part two</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="parsing-cache-manifests:concept-url-serializer-3" data-x-internal="concept-url-serializer">URL serializer</a> algorithm to <var>urlRecordTwo</var>, with the <i>exclude fragment flag</i> set.</p>

      <p>If <var>part one</var> is already in the <var>fallback URLs</var> mapping as a <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-2">fallback namespace</a>, then jump back to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, add <var>part one</var> to the <var>fallback URLs</var> mapping as a <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-3">fallback namespace</a>, mapped to <var>part two</var> as the <a href="#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback-2">fallback entry</a>.</p>

     <dt>If <var>mode</var> is "online safelist"<dd><p>If the first item in <var>tokens</var> is a U+002A ASTERISK character (*), then set <var>online safelist wildcard flag</var> to <i>open</i> and jump back to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, let <var>urlRecord</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" id="parsing-cache-manifests:url-parser-6" data-x-internal="url-parser">parsing</a> the first item in <var>tokens</var> with <var>base URL</var>.</p>

      <p>If <var>urlRecord</var> is failure, then jump back to the step labeled <i>start of line</i>.</p>

      <p>If <var>urlRecord</var> has a different <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="parsing-cache-manifests:concept-url-scheme-2" data-x-internal="concept-url-scheme">scheme</a> component than <var>base URL</var> (the manifest's URL), then jump back to the step labeled <i>start of line</i>.</p>

      <p>Let <var>new URL</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="parsing-cache-manifests:concept-url-serializer-4" data-x-internal="concept-url-serializer">URL serializer</a> algorithm to <var>urlRecord</var>, with the <i>exclude fragment flag</i> set.</p>

      <p>Add <var>new URL</var> to the <var>online safelist namespaces</var>.</p>

     <dt>If <var>mode</var> is "settings"<dd><p>If <var>tokens</var> contains a single token, and that token is a <a id="parsing-cache-manifests:case-sensitive" href="infrastructure.html#case-sensitive">case-sensitive</a> match for the string "<code>prefer-online</code>", then set <var>cache mode flag</var> to <i>prefer-online</i> and jump back to the step labeled <i>start of line</i>.</p>

      <p>Otherwise, the line is an unsupported setting: do nothing; the line is ignored.</p>

     <dt>If <var>mode</var> is "unknown"<dd><p>Do nothing. The line is ignored.</p>

     </dl>

   <li><p>Jump back to the step labeled <i>start of line</i>. (That step jumps to the next, and last, step when the end of the file is reached.)<li><p>Return the <var>explicit URLs</var> list, the <var>fallback URLs</var> mapping, the <var>online safelist namespaces</var>, the <var>online safelist wildcard flag</var>, and the <var>cache mode flag</var>.</ol>

  <div class="note"><p>The resource that declares the manifest (with the <code id="parsing-cache-manifests:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute) will always get taken from the cache, whether it is listed in the cache or not, even if it is listed in an <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist-2">online safelist namespace</a>.</p>

   <p>If a resource is listed in the <a href="#concept-appcache-manifest-explicit" id="parsing-cache-manifests:concept-appcache-manifest-explicit">explicit section</a> or as a <a href="#concept-appcache-fallback" id="parsing-cache-manifests:concept-appcache-fallback-3">fallback entry</a> in the <a href="#concept-appcache-manifest-fallback" id="parsing-cache-manifests:concept-appcache-manifest-fallback">fallback section</a>, the resource will always be taken from the cache, regardless of any other matching entries in the <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-4">fallback namespaces</a> or <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist-3">online safelist namespaces</a>.</p>

   <p>When a <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-5">fallback namespace</a> and an <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist-4">online safelist namespace</a> overlap, the <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist-5">online safelist namespace</a> has priority.</p>

   <p>The <a href="#concept-appcache-onlinesafelist-wildcard" id="parsing-cache-manifests:concept-appcache-onlinesafelist-wildcard">online safelist wildcard flag</a> is applied last, only for URLs that match neither the <a href="#concept-appcache-onlinesafelist" id="parsing-cache-manifests:concept-appcache-onlinesafelist-6">online safelist namespace</a> nor the <a href="#concept-appcache-fallback-ns" id="parsing-cache-manifests:concept-appcache-fallback-ns-6">fallback namespace</a> and that are not listed in the <a href="#concept-appcache-manifest-explicit" id="parsing-cache-manifests:concept-appcache-manifest-explicit-2">explicit section</a>.</p>

  </div>


  <h4 id="downloading-or-updating-an-application-cache"><span class="secno">7.9.4</span> Downloading or updating an application cache<a href="#downloading-or-updating-an-application-cache" class="self-link"></a></h4>

  <p>When the user agent is required (by other parts of this specification) to start the <dfn id="application-cache-download-process">application cache download process</dfn> for an <a id="downloading-or-updating-an-application-cache:absolute-url" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> purported to identify a <a href="#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest">manifest</a>, or for an <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group">application cache group</a>, potentially given a particular <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host">cache host</a>, and potentially given a <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master">master</a> resource, the user agent must run the steps below. These steps are always run <a id="downloading-or-updating-an-application-cache:in-parallel" href="infrastructure.html#in-parallel">in parallel</a> with the <a id="downloading-or-updating-an-application-cache:event-loop" href="webappapis.html#event-loop">event loop</a> <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task">tasks</a>.</p>

  <p>Some of these steps have requirements that only apply if the user agent <dfn id="shows-caching-progress">shows caching progress</dfn>. Support for this is optional. Caching progress UI could consist of a progress bar or message panel in the user agent's interface, or an overlay, or something else. Certain events fired during the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process">application cache download process</a> allow the script to override the display of such an interface. (Such events are delayed until after the <code id="downloading-or-updating-an-application-cache:event-load"><a href="indices.html#event-load">load</a></code> event has fired.) The goal of this is to allow Web applications to provide more seamless update mechanisms, hiding from the user the mechanics of the application cache mechanism. User agents may display user interfaces independent of this, but are encouraged to not show prominent update progress notifications for applications that cancel the relevant events.</p>

  <p>The <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-2">application cache download process</a> steps are as follows:<ol><li><p>Optionally, wait until the permission to start the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-3">application cache download process</a> has been obtained from the user and until the user agent is confident that the network is available. This could include doing nothing until the user explicitly opts-in to caching the site, or could involve prompting the user for permission. The algorithm might never get past this point. (This step is particularly intended to be used by user agents running on severely space-constrained devices or in highly privacy-sensitive environments).<li><p>Atomically, so as to avoid race conditions, perform the following substeps:</p>

    <ol><li><p>Pick the appropriate substeps:</p>

      <dl class="switch"><dt>If these steps were invoked with an <a id="downloading-or-updating-an-application-cache:absolute-url-2" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> purported to identify a <a href="#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-2">manifest</a><dd><p>Let <var>manifest URL</var> be that <a id="downloading-or-updating-an-application-cache:absolute-url-3" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a>.</p>

        <p>If there is no <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-2">application cache group</a> identified by <var>manifest URL</var>, then create a new <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-3">application cache group</a> identified by <var>manifest URL</var>. Initially, it has no <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache">application caches</a>. One will be created later in this algorithm.</p>

       <dt>If these steps were invoked with an <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-4">application cache group</a><dd><p>Let <var>manifest URL</var> be the <a id="downloading-or-updating-an-application-cache:absolute-url-4" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> of the <a href="#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-3">manifest</a> used to identify the <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-5">application cache group</a> to be updated.</p>

        <p>If that <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-6">application cache group</a> is <a href="#concept-appcache-obsolete" id="downloading-or-updating-an-application-cache:concept-appcache-obsolete">obsolete</a>, then abort this instance of the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-4">application cache download process</a>. This can happen if another instance of this algorithm found the manifest to be 404 or 410 while this algorithm was waiting in the first step above.</p>

       </dl>

     <li><p>Let <var>cache group</var> be the <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-7">application cache group</a> identified by <var>manifest URL</var>.<li><p>If these steps were invoked with a <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-2">master</a> resource, then add the resource, along with the resource's <code id="downloading-or-updating-an-application-cache:document"><a href="dom.html#document">Document</a></code>, to <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters">list of pending master entries</a>.<li><p>If these steps were invoked with a <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-2">cache host</a>, and the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status">status</a> of <var>cache group</var> is <i>checking</i> or <i>downloading</i>, then <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task">queue a post-load task</a> to run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-checking"><a href="#event-appcache-checking">checking</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache"><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-3">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent is checking to see if it can download the application.</ol>
     <li><p>If these steps were invoked with a <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-4">cache host</a>, and the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-2">status</a> of <var>cache group</var> is <i>downloading</i>, then also <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-2">queue a post-load task</a> to run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-2" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-2"><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-5">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-2"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-2">shows caching progress</a>, then display some sort of user interface indicating to the user the application is being downloaded.</ol>
     <li><p>If the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-3">status</a> of the <var>cache group</var> is either <i>checking</i> or <i>downloading</i>, then abort this instance of the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-5">application cache download process</a>, as an update is already in progress.<li><p>Set the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-4">status</a> of <var>cache group</var> to <i>checking</i>.</p>

     <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-6">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-2">application cache</a> in <var>cache group</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-3">queue a post-load task</a> run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-3" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-checking-2"><a href="#event-appcache-checking">checking</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-3"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-7">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-3"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-3">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent is checking for the availability of updates.</ol>
     </ol>

    <p class="note">The remainder of the steps run <a id="downloading-or-updating-an-application-cache:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a>.</p>

    <p>If <var>cache group</var> already has an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-3">application cache</a> in it, then this is an <dfn id="concept-appcache-upgrade">upgrade attempt</dfn>. Otherwise, this is a <dfn id="concept-appcache-cache">cache attempt</dfn>.</p>

   <li><p>If this is a <a href="#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache">cache attempt</a>, then this algorithm was invoked with a <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-8">cache host</a>; <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-4">queue a post-load task</a> to run these steps:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-4" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-checking-3"><a href="#event-appcache-checking">checking</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-4"><a href="#applicationcache">ApplicationCache</a></code> singleton of that <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-9">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-4"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-4">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent is checking for the availability of updates.</ol>
   <li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="downloading-or-updating-an-application-cache:concept-request" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="downloading-or-updating-an-application-cache:concept-request-url" data-x-internal="concept-request-url">url</a> is <var>manifest URL</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="downloading-or-updating-an-application-cache:concept-request-client" data-x-internal="concept-request-client">client</a> is null, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="downloading-or-updating-an-application-cache:concept-request-destination" data-x-internal="concept-request-destination">destination</a> is the empty string, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="downloading-or-updating-an-application-cache:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> is "<code>no-referrer</code>", <a id="downloading-or-updating-an-application-cache:synchronous-flag" href="https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag" data-x-internal="synchronous-flag">synchronous flag</a> is set, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="downloading-or-updating-an-application-cache:concept-request-credentials-mode" data-x-internal="concept-request-credentials-mode">credentials mode</a> is "<code>include</code>", and whose <a id="downloading-or-updating-an-application-cache:use-url-credentials-flag" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a> is set.<li><p><i>Fetching the manifest</i>: Let <var>manifest</var> be the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="downloading-or-updating-an-application-cache:concept-fetch" data-x-internal="concept-fetch">fetching</a> <var>request</var>. HTTP caching semantics should be honored for this request.</p>

    <p>Parse <var>manifest</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="downloading-or-updating-an-application-cache:concept-response-body" data-x-internal="concept-response-body">body</a> according to the <a href="#parse-a-manifest" id="downloading-or-updating-an-application-cache:parse-a-manifest">rules for parsing manifests</a>, obtaining a list of <a href="#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit">explicit entries</a>, <a href="#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback">fallback entries</a> and the <a href="#concept-appcache-fallback-ns" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-ns">fallback namespaces</a> that map to them, entries for the <a href="#concept-appcache-onlinesafelist" id="downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist">online safelist</a>, and values for the <a href="#concept-appcache-onlinesafelist-wildcard" id="downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-wildcard">online safelist wildcard flag</a> and the <a href="#concept-appcache-mode" id="downloading-or-updating-an-application-cache:concept-appcache-mode">cache mode flag</a>.</p>

    <p class="note">The <a id="downloading-or-updating-an-application-cache:mime-type" href="https://mimesniff.spec.whatwg.org/#mime-type" data-x-internal="mime-type">MIME type</a> of the resource is ignored — it is assumed to be <code id="downloading-or-updating-an-application-cache:text/cache-manifest"><a href="iana.html#text/cache-manifest">text/cache-manifest</a></code>. In the future, if new manifest formats are supported, the different types will probably be distinguished on the basis of the file signatures (for the current format, that is the "<code>CACHE MANIFEST</code>" string at the top of the file).</p>

   <li><p>If <i>fetching the manifest</i> fails due to a 404 or 410 response status, then run these substeps:</p>

    <ol><li><p>Mark <var>cache group</var> as <a href="#concept-appcache-obsolete" id="downloading-or-updating-an-application-cache:concept-appcache-obsolete-2">obsolete</a>. This <var>cache group</var> no longer exists for any purpose other than the processing of <code id="downloading-or-updating-an-application-cache:document-2"><a href="dom.html#document">Document</a></code> objects already associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-4">application cache</a> in the <var>cache group</var>.<li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-2">tasks</a>.</p>

     <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-10">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-5">application cache</a> in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-3">task</a> to run these steps and append it to <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-5" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-5"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-11">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-5"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-5">shows caching progress</a>, then display some sort of user interface indicating to the user that the application is no longer available for offline use.</ol>
     <li><p>For each entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-2">list of pending master entries</a>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-4">task</a> to run these steps and append it to <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-6" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-error"><a href="#event-appcache-error">error</a></code> (not <code id="downloading-or-updating-an-application-cache:event-appcache-obsolete-2"><a href="#event-appcache-obsolete">obsolete</a></code>!) at the <code id="downloading-or-updating-an-application-cache:applicationcache-6"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-3"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-6"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-6">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent failed to save the application for offline use.</ol>
     <li><p>If <var>cache group</var> has an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-6">application cache</a> whose <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness">completeness flag</a> is <i>incomplete</i>, then discard that <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-7">application cache</a>.</p>

     <li><p>If appropriate, remove any user interface indicating that an update for this cache is in progress.<li><p>Let the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-5">status</a> of <var>cache group</var> be <i>idle</i>.<li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-5">task</a> in <var>task list</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-5">queue that task as a post-load task</a>.<li><p>Abort the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-6">application cache download process</a>.</ol>

   <li><p>Otherwise, if <i>fetching the manifest</i> fails in some other way (e.g. the server returns another 4xx or 5xx response, or there is a DNS error, or the connection times out, or the user cancels the download, or the parser for manifests fails when checking the magic signature), or if the server returned a redirect, then run the <a href="#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps">cache failure steps</a>. <a href="references.html#refsHTTP">[HTTP]</a></p>

   <li><p>If this is an <a href="#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade">upgrade attempt</a> and the newly downloaded <var>manifest</var> is byte-for-byte identical to the manifest found in the <a href="#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer">newest</a> <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-8">application cache</a> in <var>cache group</var>, or the response status is <code>304</code>, then run these substeps:</p>

    <ol><li><p>Let <var>cache</var> be the <a href="#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-2">newest</a> <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-9">application cache</a> in <var>cache group</var>.<li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-6">tasks</a>.</p>

     <li><p>For each entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-3">list of pending master entries</a>, wait for the resource for this entry to have either completely downloaded or failed.</p>

      <p>If the download failed (e.g. the server returns a 4xx or 5xx response, or there is a DNS error, the connection times out, or the user cancels the download), or if the resource is labeled with the "no-store" cache directive, then create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-7">task</a> to run these steps and append it to <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-7" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-error-2"><a href="#event-appcache-error">error</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-7"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-4"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-7"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-7">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent failed to save the application for offline use.</ol>

      <p>Otherwise, associate the <code id="downloading-or-updating-an-application-cache:document-5"><a href="dom.html#document">Document</a></code> for this entry with <var>cache</var>; store the resource for this entry in <var>cache</var>, if it isn't already there, and categorize its entry as a <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-3">master entry</a>. If applying the <a id="downloading-or-updating-an-application-cache:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> algorithm to the resource's <a id="downloading-or-updating-an-application-cache:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> results in a <a id="downloading-or-updating-an-application-cache:url-record" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> that has a non-null <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="downloading-or-updating-an-application-cache:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a> component, the <a id="downloading-or-updating-an-application-cache:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> used for the entry in <var>cache</var> must instead be the <a id="downloading-or-updating-an-application-cache:absolute-url-5" href="https://triple-underscore.github.io/URL-ja.html#syntax-url-absolute" data-x-internal="absolute-url">absolute URL</a> obtained from applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="downloading-or-updating-an-application-cache:concept-url-serializer" data-x-internal="concept-url-serializer">URL serializer</a> algorithm to the <a id="downloading-or-updating-an-application-cache:url-record-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> with the <i>exclude fragment flag</i> set (application caches never include <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="downloading-or-updating-an-application-cache:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragments</a>).</p>

     <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-12">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-10">application cache</a> in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-8">task</a> to run these steps and append it to <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-8" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-8"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-13">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-8"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-8">shows caching progress</a>, then display some sort of user interface indicating to the user that the application is up to date.</ol>
     <li><p>Empty <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-4">list of pending master entries</a>.<li><p>If appropriate, remove any user interface indicating that an update for this cache is in progress.<li><p>Let the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-6">status</a> of <var>cache group</var> be <i>idle</i>.<li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-9">task</a> in <var>task list</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-6">queue that task as a post-load task</a>.<li><p>Abort the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-7">application cache download process</a>.</ol>

   <li><p>Let <var>new cache</var> be a newly created <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-11">application cache</a> in <var>cache group</var>. Set its <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-2">completeness flag</a> to <i>incomplete</i>.<li><p>For each entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-5">list of pending master entries</a>, associate the <code id="downloading-or-updating-an-application-cache:document-6"><a href="dom.html#document">Document</a></code> for this entry with <var>new cache</var>.<li><p>Set the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-7">status</a> of <var>cache group</var> to <i>downloading</i>.<li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-14">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-12">application cache</a> in <var>cache group</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-7">queue a post-load task</a> to run these steps:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-9" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-downloading-2"><a href="#event-appcache-downloading">downloading</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-9"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-15">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-9"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-9">shows caching progress</a>, then display some sort of user interface indicating to the user that a new version is being downloaded.</ol>
   <li><p>Let <var>file list</var> be an empty list of URLs with flags.<li><p>Add all the URLs in the list of <a href="#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit-2">explicit entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>, each flagged with "explicit entry".<li><p>Add all the URLs in the list of <a href="#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-2">fallback entries</a> obtained by parsing <var>manifest</var> to <var>file list</var>, each flagged with "fallback entry".<li><p>If this is an <a href="#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-2">upgrade attempt</a>, then add all the URLs of <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-4">master entries</a> in the <a href="#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-3">newest</a> <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-13">application cache</a> in <var>cache group</var> whose <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-3">completeness flag</a> is <i>complete</i> to <var>file list</var>, each flagged with "master entry".<li><p>If any URL is in <var>file list</var> more than once, then merge the entries into one entry for that URL, that entry having all the flags that the original entries had.<li><p>For each URL in <var>file list</var>, run the following steps. These steps may be run in parallel for two or more of the URLs at a time. If, while running these steps, the <code id="downloading-or-updating-an-application-cache:applicationcache-10"><a href="#applicationcache">ApplicationCache</a></code> object's <code id="downloading-or-updating-an-application-cache:dom-appcache-abort"><a href="#dom-appcache-abort">abort()</a></code> method <a href="#send-a-signal" id="downloading-or-updating-an-application-cache:send-a-signal">sends a signal</a> to this instance of the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-8">application cache download process</a> algorithm, then run the <a href="#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-2">cache failure steps</a> instead.</p>

    <ol><li><p>If the resource URL being processed was flagged as neither an "explicit entry" nor or a "fallback entry", then the user agent may skip this URL.</p>

      <p class="note">This is intended to allow user agents to expire resources not listed in the manifest from the cache. Generally, implementers are urged to use an approach that expires lesser-used resources first.</p>

     <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-16">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-14">application cache</a> in <var>cache group</var>, <a href="#queue-a-progress-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-progress-post-load-task">queue a progress post-load task</a> to run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-10" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-progress"><a href="#event-appcache-progress">progress</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-11"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-17">cache host</a>, using <code id="downloading-or-updating-an-application-cache:progressevent"><a data-x-internal="progressevent" href="https://triple-underscore.github.io/XHR-ja.html#interface-progressevent">ProgressEvent</a></code>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-10"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true, the <code id="downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable"><a data-x-internal="dom-progressevent-lengthcomputable" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-lengthcomputable">lengthComputable</a></code> attribute initialized to true, the <code id="downloading-or-updating-an-application-cache:dom-progressevent-total"><a data-x-internal="dom-progressevent-total" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total">total</a></code> attribute initialized to the number of files in <var>file list</var>, and the <code id="downloading-or-updating-an-application-cache:dom-progressevent-loaded"><a data-x-internal="dom-progressevent-loaded" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded">loaded</a></code> attribute initialized to the number of files in <var>file list</var> that have been either downloaded or skipped so far. <a href="references.html#refsXHR">[XHR]</a><li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-10">shows caching progress</a>, then display some sort of user interface indicating to the user that a file is being downloaded in preparation for updating the application.</ol>
     <li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="downloading-or-updating-an-application-cache:concept-request-2" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="downloading-or-updating-an-application-cache:concept-request-url-2" data-x-internal="concept-request-url">url</a> is URL, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="downloading-or-updating-an-application-cache:concept-request-client-2" data-x-internal="concept-request-client">client</a> is null, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="downloading-or-updating-an-application-cache:concept-request-destination-2" data-x-internal="concept-request-destination">destination</a> is the empty string, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-origin" id="downloading-or-updating-an-application-cache:concept-request-origin" data-x-internal="concept-request-origin">origin</a> is <var>manifest URL</var>'s <a id="downloading-or-updating-an-application-cache:concept-origin" href="origin.html#concept-origin">origin</a>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="downloading-or-updating-an-application-cache:concept-request-referrer-2" data-x-internal="concept-request-referrer">referrer</a> is "<code>no-referrer</code>", <a id="downloading-or-updating-an-application-cache:synchronous-flag-2" href="https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag" data-x-internal="synchronous-flag">synchronous flag</a> is set, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="downloading-or-updating-an-application-cache:concept-request-credentials-mode-2" data-x-internal="concept-request-credentials-mode">credentials mode</a> is "<code>include</code>", <a id="downloading-or-updating-an-application-cache:use-url-credentials-flag-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a> is set, and <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-redirect-mode" id="downloading-or-updating-an-application-cache:concept-request-redirect-mode" data-x-internal="concept-request-redirect-mode">redirect mode</a> is "<code>manual</code>".<li><p><a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="downloading-or-updating-an-application-cache:concept-fetch-2" data-x-internal="concept-fetch">Fetch</a> <var>request</var>. If this is an <a href="#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-3">upgrade attempt</a>, then use the <a href="#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-4">newest</a> <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-15">application cache</a> in <var>cache group</var> as an HTTP cache, and honor HTTP caching semantics (such as expiration, ETags, and so forth) with respect to that cache. User agents may also have other caches in place that are also honored.<li><p>If the previous step fails (e.g. the server returns a 4xx or 5xx response, or there is a DNS error, or the connection times out, or the user cancels the download), or if the server returned a redirect, or if the resource is labeled with the "no-store" cache directive, then run the first appropriate step from the following list: <a href="references.html#refsHTTP">[HTTP]</a></p>

      <dl class="switch"><dt>If the URL being processed was flagged as an "explicit entry" or a "fallback entry"<dd><p>If these steps are being run in parallel for any other URLs in <var>file list</var>, then abort this algorithm for those other URLs. Run the <a href="#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-3">cache failure steps</a>.</p>

        <p class="note">Redirects are fatal because they are either indicative of a network problem (e.g. a captive portal); or would allow resources to be added to the cache under URLs that differ from any URL that the networking model will allow access to, leaving orphan entries; or would allow resources to be stored under URLs different than their true URLs. All of these situations are bad.</p>

       <dt>If the error was a 404 or 410 HTTP response<dt>If the resource was labeled with the "no-store" cache directive<dd><p>Skip this resource. It is dropped from the cache.</p>

       <dt>そうでなければ<dd><p>Copy the resource and its metadata from the <a href="#concept-appcache-newer" id="downloading-or-updating-an-application-cache:concept-appcache-newer-5">newest</a> <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-16">application cache</a> in <var>cache group</var> whose <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-4">completeness flag</a> is <i>complete</i>, and act as if that was the fetched resource, ignoring the resource obtained from the network.</p>

       </dl>

      <p>User agents may warn the user of these errors as an aid to development.</p>

      <p class="note">These rules make errors for resources listed in the manifest fatal, while making it possible for other resources to be removed from caches when they are removed from the server, without errors, and making non-manifest resources survive server-side errors.</p>

      <p class="note">Except for the "no-store" directive, HTTP caching rules that would cause a file to be expired or otherwise not cached are ignored for the purposes of the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-9">application cache download process</a>.</p>

     <li><p>Otherwise, the fetching succeeded. Store the resource in the <var>new cache</var>.</p>

      <p>If the user agent is not able to store the resource (e.g. because of quota restrictions), the user agent may prompt the user or try to resolve the problem in some other manner (e.g. automatically pruning content in other caches). If the problem cannot be resolved, the user agent must run the <a href="#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-4">cache failure steps</a>.</p>

     <li><p>If the URL being processed was flagged as an "explicit entry" in <var>file list</var>, then categorize the entry as an <a href="#concept-appcache-explicit" id="downloading-or-updating-an-application-cache:concept-appcache-explicit-3">explicit entry</a>.<li><p>If the URL being processed was flagged as a "fallback entry" in <var>file list</var>, then categorize the entry as a <a href="#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-3">fallback entry</a>.<li><p>If the URL being processed was flagged as an "master entry" in <var>file list</var>, then categorize the entry as a <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-5">master entry</a>.<li><p>As an optimization, if the resource is an HTML or XML file whose <a id="downloading-or-updating-an-application-cache:document-element" href="https://triple-underscore.github.io/DOM4-ja.html#document-element" data-x-internal="document-element">document element</a> is an <code id="downloading-or-updating-an-application-cache:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element with a <code id="downloading-or-updating-an-application-cache:attr-html-manifest"><a href="semantics.html#attr-html-manifest">manifest</a></code> attribute whose value doesn't match the manifest URL of the application cache being processed, then the user agent should mark the entry as being <a href="#concept-appcache-foreign" id="downloading-or-updating-an-application-cache:concept-appcache-foreign">foreign</a>.</p>

    </ol>

   <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-18">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-17">application cache</a> in <var>cache group</var>, <a href="#queue-a-progress-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-progress-post-load-task-2">queue a progress post-load task</a> to run these steps:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-11" data-x-internal="concept-event-fire">firing an event </a> named <code id="downloading-or-updating-an-application-cache:event-appcache-progress-2"><a href="#event-appcache-progress">progress</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-12"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-19">cache host</a>, using <code id="downloading-or-updating-an-application-cache:progressevent-2"><a data-x-internal="progressevent" href="https://triple-underscore.github.io/XHR-ja.html#interface-progressevent">ProgressEvent</a></code>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-11"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true, the <code id="downloading-or-updating-an-application-cache:dom-progressevent-lengthcomputable-2"><a data-x-internal="dom-progressevent-lengthcomputable" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-lengthcomputable">lengthComputable</a></code> attribute initialized to true, and the <code id="downloading-or-updating-an-application-cache:dom-progressevent-total-2"><a data-x-internal="dom-progressevent-total" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-total">total</a></code> and <code id="downloading-or-updating-an-application-cache:dom-progressevent-loaded-2"><a data-x-internal="dom-progressevent-loaded" href="https://triple-underscore.github.io/XHR-ja.html#dom-progressevent-loaded">loaded</a></code> attributes initialized to the number of files in <var>file list</var>. <a href="references.html#refsXHR">[XHR]</a><li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-11">shows caching progress</a>, then display some sort of user interface indicating to the user that all the files have been downloaded.</ol>
   <li><p>Store the list of <a href="#concept-appcache-fallback-ns" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-ns-2">fallback namespaces</a>, and the URLs of the <a href="#concept-appcache-fallback" id="downloading-or-updating-an-application-cache:concept-appcache-fallback-4">fallback entries</a> that they map to, in <var>new cache</var>.<li><p>Store the URLs that form the new <a href="#concept-appcache-onlinesafelist" id="downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-2">online safelist</a> in <var>new cache</var>.<li><p>Store the value of the new <a href="#concept-appcache-onlinesafelist-wildcard" id="downloading-or-updating-an-application-cache:concept-appcache-onlinesafelist-wildcard-2">online safelist wildcard flag</a> in <var>new cache</var>.<li><p>Store the value of the new <a href="#concept-appcache-mode" id="downloading-or-updating-an-application-cache:concept-appcache-mode-2">cache mode flag</a> in <var>new cache</var>.<li><p>For each entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-6">list of pending master entries</a>, wait for the resource for this entry to have either completely downloaded or failed.</p>

    <p>If the download failed (e.g. the server returns a 4xx or 5xx response, or there is a DNS error, the connection times out, or the user cancels the download), or if the resource is labeled with the "no-store" cache directive, then run these substeps:</p>

    <ol><li><p>Unassociate the <code id="downloading-or-updating-an-application-cache:document-7"><a href="dom.html#document">Document</a></code> for this entry from <var>new cache</var>.<li><p><a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-8">Queue a post-load task</a> to run these steps:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-12" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-error-3"><a href="#event-appcache-error">error</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-13"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-8"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-12"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-12">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent failed to save the application for offline use.</ol>
     <li><p>If this is a <a href="#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-2">cache attempt</a> and this entry is the last entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-7">list of pending master entries</a>, then run these further substeps:</p>

      <ol><li><p>Discard <var>cache group</var> and its only <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-18">application cache</a>, <var>new cache</var>.</p>

       <li><p>If appropriate, remove any user interface indicating that an update for this cache is in progress.<li><p>Abort the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-10">application cache download process</a>.</ol>

     <li><p>Otherwise, remove this entry from <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-8">list of pending master entries</a>.</ol>

    <p>Otherwise, store the resource for this entry in <var>new cache</var>, if it isn't already there, and categorize its entry as a <a href="#concept-appcache-master" id="downloading-or-updating-an-application-cache:concept-appcache-master-6">master entry</a>.</p>

   <li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="downloading-or-updating-an-application-cache:concept-request-3" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="downloading-or-updating-an-application-cache:concept-request-url-3" data-x-internal="concept-request-url">url</a> is <var>manifest URL</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="downloading-or-updating-an-application-cache:concept-request-client-3" data-x-internal="concept-request-client">client</a> is null, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="downloading-or-updating-an-application-cache:concept-request-destination-3" data-x-internal="concept-request-destination">destination</a> is the empty string, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="downloading-or-updating-an-application-cache:concept-request-referrer-3" data-x-internal="concept-request-referrer">referrer</a> is "<code>no-referrer</code>", <a id="downloading-or-updating-an-application-cache:synchronous-flag-3" href="https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag" data-x-internal="synchronous-flag">synchronous flag</a> is set, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="downloading-or-updating-an-application-cache:concept-request-credentials-mode-3" data-x-internal="concept-request-credentials-mode">credentials mode</a> is "<code>include</code>", and whose <a id="downloading-or-updating-an-application-cache:use-url-credentials-flag-3" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a> is set.<li><p>Let <var>second manifest</var> be the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="downloading-or-updating-an-application-cache:concept-fetch-3" data-x-internal="concept-fetch">fetching</a> <var>request</var>. HTTP caching semantics should again be honored for this request.</p>

    <p class="note">Since caching can be honored, authors are encouraged to avoid setting the cache headers on the manifest in such a way that the user agent would simply not contact the network for this second request; otherwise, the user agent would not notice if the cache had changed during the cache update process.</p>

   <li><p>If the previous step failed for any reason, or if the fetching attempt involved a redirect, or if <var>second manifest</var> and <var>manifest</var> are not byte-for-byte identical, then schedule a rerun of the entire algorithm with the same parameters after a short delay, and run the <a href="#cache-failure-steps" id="downloading-or-updating-an-application-cache:cache-failure-steps-5">cache failure steps</a>.</p>

   <li><p>Otherwise, store <var>manifest</var> in <var>new cache</var>, if it's not there already, and categorize its entry as <a href="#concept-appcache-manifest" id="downloading-or-updating-an-application-cache:concept-appcache-manifest-4">the manifest</a>.</p>

   <li><p>Set the <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-5">completeness flag</a> of <var>new cache</var> to <i>complete</i>.<li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-10">tasks</a>.</p>

   <li><p>If this is a <a href="#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-3">cache attempt</a>, then for each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-20">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-19">application cache</a> in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-11">task</a> to run these steps and append it to <var>task list</var>:<ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-13" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-cached"><a href="#event-appcache-cached">cached</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-14"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-21">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-13"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-13">shows caching progress</a>, then display some sort of user interface indicating to the user that the application has been cached and that they can now use it offline.</ol>

    <p>Otherwise, it is an <a href="#concept-appcache-upgrade" id="downloading-or-updating-an-application-cache:concept-appcache-upgrade-4">upgrade attempt</a>. For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-22">cache host</a> associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-20">application cache</a> in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-12">task</a> to run these steps and append it to <var>task list</var>:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-14" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-15"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-23">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-14"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-14">shows caching progress</a>, then display some sort of user interface indicating to the user that a new version is available and that they can activate it by reloading the page.</ol>

   <li><p>If appropriate, remove any user interface indicating that an update for this cache is in progress.<li><p>Set the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-8">update status</a> of <var>cache group</var> to <i>idle</i>.<li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-13">task</a> in <var>task list</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-9">queue that task as a post-load task</a>.</ol>

  <p>The <dfn id="cache-failure-steps">cache failure steps</dfn> are as follows:</p>

  <ol><li><p>Let <var>task list</var> be an empty list of <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-14">tasks</a>.</p>

   <li><p>For each entry in <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-9">list of pending master entries</a>, run the following further substeps. These steps may be run in parallel for two or more entries at a time.</p>

    <ol><li><p>Wait for the resource for this entry to have either completely downloaded or failed.</p>

     <li><p>Unassociate the <code id="downloading-or-updating-an-application-cache:document-9"><a href="dom.html#document">Document</a></code> for this entry from its <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-21">application cache</a>, if it has one.<li><p>Create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-15">task</a> to run these steps and append it to <var>task list</var>:</p>

      <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-15" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-error-4"><a href="#event-appcache-error">error</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-16"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <code id="downloading-or-updating-an-application-cache:document-10"><a href="dom.html#document">Document</a></code> for this entry, if there still is one, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-15"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-15">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent failed to save the application for offline use.</ol>
     </ol>

   <li><p>For each <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-24">cache host</a> still associated with an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-22">application cache</a> in <var>cache group</var>, create a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-16">task</a> to run these steps and append it to <var>task list</var>:</p>

    <ol><li><p>Let <var>showProgress</var> be the result of <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="downloading-or-updating-an-application-cache:concept-event-fire-16" data-x-internal="concept-event-fire">firing an event</a> named <code id="downloading-or-updating-an-application-cache:event-appcache-error-5"><a href="#event-appcache-error">error</a></code> at the <code id="downloading-or-updating-an-application-cache:applicationcache-17"><a href="#applicationcache">ApplicationCache</a></code> singleton of the <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-25">cache host</a>, with the <code id="downloading-or-updating-an-application-cache:dom-event-cancelable-16"><a data-x-internal="dom-event-cancelable" href="https://dom.spec.whatwg.org/#dom-event-cancelable">cancelable</a></code> attribute initialized to true.<li><p>If <var>showProgress</var> is true and the user agent <a href="#shows-caching-progress" id="downloading-or-updating-an-application-cache:shows-caching-progress-16">shows caching progress</a>, then display some sort of user interface indicating to the user that the user agent failed to save the application for offline use.</ol>
   <li><p>Empty <var>cache group</var>'s <a href="#concept-appcache-pending-masters" id="downloading-or-updating-an-application-cache:concept-appcache-pending-masters-10">list of pending master entries</a>.<li><p>If <var>cache group</var> has an <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-23">application cache</a> whose <a href="#concept-appcache-completeness" id="downloading-or-updating-an-application-cache:concept-appcache-completeness-6">completeness flag</a> is <i>incomplete</i>, then discard that <a href="#application-cache" id="downloading-or-updating-an-application-cache:application-cache-24">application cache</a>.</p>

   <li><p>If appropriate, remove any user interface indicating that an update for this cache is in progress.<li><p>Let the <a href="#concept-appcache-status" id="downloading-or-updating-an-application-cache:concept-appcache-status-9">status</a> of <var>cache group</var> be <i>idle</i>.<li><p>If this was a <a href="#concept-appcache-cache" id="downloading-or-updating-an-application-cache:concept-appcache-cache-4">cache attempt</a>, discard <var>cache group</var> altogether.</p>

   <li><p>For each <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-17">task</a> in <var>task list</var>, <a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-10">queue that task as a post-load task</a>.<li><p>Abort the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-11">application cache download process</a>.</ol>

  <p>Attempts to fetch resources as part of the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-12">application cache download process</a> may be done with cache-defeating semantics, to avoid problems with stale or inconsistent intermediary caches.</p>

  <hr>

  <p>User agents may invoke the <a href="#application-cache-download-process" id="downloading-or-updating-an-application-cache:application-cache-download-process-13">application cache download process</a>, in the background, for any <a href="#application-cache-group" id="downloading-or-updating-an-application-cache:application-cache-group-8">application cache group</a>, at any time (with no <a href="#cache-host" id="downloading-or-updating-an-application-cache:cache-host-26">cache host</a>). This allows user agents to keep caches primed and to update caches even before the user visits a site.</p>

  <hr>

  <p>Each <code id="downloading-or-updating-an-application-cache:document-11"><a href="dom.html#document">Document</a></code> has a list of <dfn id="pending-application-cache-download-process-tasks">pending application cache download process tasks</dfn> that is used to delay events fired by the algorithm above until the document's <code id="downloading-or-updating-an-application-cache:event-load-2"><a href="indices.html#event-load">load</a></code> event has fired. When the <code id="downloading-or-updating-an-application-cache:document-12"><a href="dom.html#document">Document</a></code> is created, the list must be empty.</p>

  <p>When the steps above say to <dfn id="queue-a-post-load-task">queue a post-load task</dfn> <var>task</var>, where <var>task</var> is a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-18">task</a> that dispatches an event on a target <code id="downloading-or-updating-an-application-cache:applicationcache-18"><a href="#applicationcache">ApplicationCache</a></code> object <var>target</var>, the user agent must run the appropriate steps from the following list:</p>

  <dl><dt>If <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a> is <a id="downloading-or-updating-an-application-cache:ready-for-post-load-tasks" href="parsing.html#ready-for-post-load-tasks">ready for post-load tasks</a><dd><p><a href="webappapis.html#queue-a-task" id="downloading-or-updating-an-application-cache:queue-a-task">Queue</a> the task <var>task</var>.<dt>そうでなければ<dd><p>Add <var>task</var> to <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s list of <a href="#pending-application-cache-download-process-tasks" id="downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks">pending application cache download process tasks</a>.</dl>

  <p>When the steps above say to <dfn id="queue-a-progress-post-load-task">queue a progress post-load task</dfn> <var>task</var>, where <var>task</var> is a <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-19">task</a> that dispatches an event on a target <code id="downloading-or-updating-an-application-cache:applicationcache-19"><a href="#applicationcache">ApplicationCache</a></code> object <var>target</var>, the user agent must run the following steps:</p>

  <ol><li><p>If there is a <var>task</var> in <var>target</var>'s <a id="downloading-or-updating-an-application-cache:node-document-3" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s list of <a href="#pending-application-cache-download-process-tasks" id="downloading-or-updating-an-application-cache:pending-application-cache-download-process-tasks-2">pending application cache download process tasks</a> that is labeled as a <i>progress task</i>, then remove that task from the list.<li><p>Label <var>task</var> as a <i>progress task</i>.<li><p><a href="#queue-a-post-load-task" id="downloading-or-updating-an-application-cache:queue-a-post-load-task-11">Queue a post-load task</a> <var>task</var>.</ol>

  <p>The <a id="downloading-or-updating-an-application-cache:task-source" href="webappapis.html#task-source">task source</a> for these <a href="webappapis.html#concept-task" id="downloading-or-updating-an-application-cache:concept-task-20">tasks</a> is the <a id="downloading-or-updating-an-application-cache:networking-task-source" href="webappapis.html#networking-task-source">networking task source</a>.</p>




  <h4 id="the-application-cache-selection-algorithm"><span class="secno">7.9.5</span> The application cache selection algorithm<a href="#the-application-cache-selection-algorithm" class="self-link"></a></h4>

  <p>When the <dfn id="concept-appcache-init">application cache selection algorithm</dfn> algorithm is invoked with a <code id="the-application-cache-selection-algorithm:document"><a href="dom.html#document">Document</a></code> <var>document</var> and optionally a manifest <a id="the-application-cache-selection-algorithm:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>manifest URL</var>, the user agent must run the first applicable set of steps from the following list:</p>

  <dl class="switch"><dt>If there is a <var>manifest URL</var>, and <var>document</var> was loaded from an <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache">application cache</a>, and the URL of the <a href="#concept-appcache-manifest" id="the-application-cache-selection-algorithm:concept-appcache-manifest">manifest</a> of that cache's <a href="#application-cache-group" id="the-application-cache-selection-algorithm:application-cache-group">application cache group</a> is <em>not</em> the same as <var>manifest URL</var><dd><p>Mark the entry for the resource from which <var>document</var> was taken in the <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-2">application cache</a> from which it was loaded as <a href="#concept-appcache-foreign" id="the-application-cache-selection-algorithm:concept-appcache-foreign">foreign</a>.</p>

    <p>Restart the current navigation from the top of the <a href="browsing-the-web.html#navigate" id="the-application-cache-selection-algorithm:navigate">navigation algorithm</a>, undoing any changes that were made as part of the initial load (changes can be avoided by ensuring that the step to <a id="the-application-cache-selection-algorithm:update-the-session-history-with-the-new-page" href="browsing-the-web.html#update-the-session-history-with-the-new-page">update the session history with the new page</a> is only ever completed <em>after</em> this <a href="#concept-appcache-init" id="the-application-cache-selection-algorithm:concept-appcache-init">application cache selection algorithm</a> is run, though this is not required).</p>

    <p class="note">The navigation will not result in the same resource being loaded, because "foreign" entries are never picked during navigation.</p>

    <p>User agents may notify the user of the inconsistency between the cache manifest and the document's own metadata, to aid in application development.</p>

   <dt>If <var>document</var> was loaded from an <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-3">application cache</a>, and that <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-4">application cache</a> still exists (it is not now <a href="#concept-appcache-obsolete" id="the-application-cache-selection-algorithm:concept-appcache-obsolete">obsolete</a>)<dd><p>Associate <var>document</var> with the <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-5">application cache</a> from which it was loaded. Invoke, in the background, the <a href="#application-cache-download-process" id="the-application-cache-selection-algorithm:application-cache-download-process">application cache download process</a> for that <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-6">application cache</a>'s <a href="#application-cache-group" id="the-application-cache-selection-algorithm:application-cache-group-2">application cache group</a>, with <var>document</var> as the <a href="#cache-host" id="the-application-cache-selection-algorithm:cache-host">cache host</a>.</p>

   <dt>If <var>document</var> was loaded using `<code>GET</code>`, and, there is a <var>manifest URL</var>, and <var>manifest URL</var> has the <a id="the-application-cache-selection-algorithm:same-origin" href="origin.html#same-origin">same origin</a> as <var>document</var><dd><p>Invoke, in the background, the <a href="#application-cache-download-process" id="the-application-cache-selection-algorithm:application-cache-download-process-2">application cache download process</a> for <var>manifest URL</var>, with <var>document</var> as the <a href="#cache-host" id="the-application-cache-selection-algorithm:cache-host-2">cache host</a> and with the resource from which <var>document</var> was parsed as the <a href="#concept-appcache-master" id="the-application-cache-selection-algorithm:concept-appcache-master">master</a> resource.</p>

    <p>If there are <a href="#relevant-application-cache" id="the-application-cache-selection-algorithm:relevant-application-cache">relevant application caches</a> that are identified by a URL with the <a id="the-application-cache-selection-algorithm:same-origin-2" href="origin.html#same-origin">same origin</a> as the URL of <var>document</var>, and that have this URL as one of their entries, excluding entries marked as <a href="#concept-appcache-foreign" id="the-application-cache-selection-algorithm:concept-appcache-foreign-2">foreign</a>, then the user agent should use the <a href="#concept-appcache-selection" id="the-application-cache-selection-algorithm:concept-appcache-selection">most appropriate application cache</a> of those that match as an HTTP cache for any subresource loads. User agents may also have other caches in place that are also honored.</p>

   <dt>そうでなければ<dd><p>The <code id="the-application-cache-selection-algorithm:document-2"><a href="dom.html#document">Document</a></code> is not associated with any <a href="#application-cache" id="the-application-cache-selection-algorithm:application-cache-7">application cache</a>.</p>

    <p>If there was a <var>manifest URL</var>, the user agent may report to the user that it was ignored, to aid in application development.</p>

   </dl>



  <h4 id="changesToNetworkingModel"><span class="secno">7.9.6</span> Changes to the networking model<a href="#changesToNetworkingModel" class="self-link"></a></h4>

  <p class="XXX">If "AppCache" is not removed as a feature this section needs to be integrated into the Fetch standard.</p>

  <p>When a <a href="#cache-host" id="changesToNetworkingModel:cache-host">cache host</a> is associated with an <a href="#application-cache" id="changesToNetworkingModel:application-cache">application cache</a> whose <a href="#concept-appcache-completeness" id="changesToNetworkingModel:concept-appcache-completeness">completeness flag</a> is <i>complete</i>, any and all loads for resources related to that <a href="#cache-host" id="changesToNetworkingModel:cache-host-2">cache host</a> other than those for <a href="browsers.html#child-browsing-context" id="changesToNetworkingModel:child-browsing-context">child browsing contexts</a> must go through the following steps instead of immediately invoking the mechanisms appropriate to that resource's scheme:</p>

  <ol><li><p>If the resource is not to be fetched using the GET method, or if applying the <a id="changesToNetworkingModel:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> algorithm to both its <a id="changesToNetworkingModel:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> and the <a href="#application-cache" id="changesToNetworkingModel:application-cache-2">application cache</a>'s <a href="#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest">manifest</a>'s URL results in two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="changesToNetworkingModel:url-record" data-x-internal="url-record">URL records</a> with different <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="changesToNetworkingModel:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> components, then fetch the resource normally and return.<li><p>If the resource's URL is <a href="#concept-appcache-master" id="changesToNetworkingModel:concept-appcache-master">a master entry</a>, <a href="#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest-2">the manifest</a>, <a href="#concept-appcache-explicit" id="changesToNetworkingModel:concept-appcache-explicit">an explicit entry</a>, or <a href="#concept-appcache-fallback" id="changesToNetworkingModel:concept-appcache-fallback">a fallback entry</a> in the <a href="#application-cache" id="changesToNetworkingModel:application-cache-3">application cache</a>, then get the resource from the cache (instead of fetching it), and return.<li><p>If there is an entry in the <a href="#application-cache" id="changesToNetworkingModel:application-cache-4">application cache</a>'s <a href="#concept-appcache-onlinesafelist" id="changesToNetworkingModel:concept-appcache-onlinesafelist">online safelist</a> that has the <a id="changesToNetworkingModel:same-origin" href="origin.html#same-origin">same origin</a> as the resource's URL and that is a <a id="changesToNetworkingModel:prefix-match" href="infrastructure.html#prefix-match">prefix match</a> for the resource's URL, then fetch the resource normally and return.<li><p>If the resource's URL has the <a id="changesToNetworkingModel:same-origin-2" href="origin.html#same-origin">same origin</a> as the manifest's URL, and there is a <a href="#concept-appcache-fallback-ns" id="changesToNetworkingModel:concept-appcache-fallback-ns">fallback namespace</a> <var>f</var> in the <a href="#application-cache" id="changesToNetworkingModel:application-cache-5">application cache</a> that is a <a id="changesToNetworkingModel:prefix-match-2" href="infrastructure.html#prefix-match">prefix match</a> for the resource's URL, then:</p>

    <p>Fetch the resource normally. If this results in a redirect to a resource with another <a id="changesToNetworkingModel:concept-origin" href="origin.html#concept-origin">origin</a> (indicative of a captive portal), or a 4xx or 5xx status code, or if there were network errors (but not if the user canceled the download), then instead get, from the cache, the resource of the <a href="#concept-appcache-fallback" id="changesToNetworkingModel:concept-appcache-fallback-2">fallback entry</a> corresponding to the <a href="#concept-appcache-fallback-ns" id="changesToNetworkingModel:concept-appcache-fallback-ns-2">fallback namespace</a> <var>f</var>. Return.</p>

   <li><p>If the <a href="#application-cache" id="changesToNetworkingModel:application-cache-6">application cache</a>'s <a href="#concept-appcache-onlinesafelist-wildcard" id="changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard">online safelist wildcard flag</a> is <i>open</i>, then fetch the resource normally and return.<li><p>Fail the resource load as if there had been a generic network error.</ol>

  <p class="note">The above algorithm ensures that so long as the <a href="#concept-appcache-onlinesafelist-wildcard" id="changesToNetworkingModel:concept-appcache-onlinesafelist-wildcard-2">online safelist wildcard flag</a> is <i>blocking</i>, resources that are not present in the <a href="#concept-appcache-manifest" id="changesToNetworkingModel:concept-appcache-manifest-3">manifest</a> will always fail to load (at least, after the <a href="#application-cache" id="changesToNetworkingModel:application-cache-7">application cache</a> has been primed the first time), making the testing of offline applications simpler.</p>

  


  

  <h4 id="expiring-application-caches"><span class="secno">7.9.7</span> Expiring application caches<a href="#expiring-application-caches" class="self-link"></a></h4>

  <p>As a general rule, user agents should not expire application caches, except on request from the user, or after having been left unused for an extended period of time.</p>

  <p>Application caches and cookies have similar implications with respect to privacy (e.g. if the site can identify the user when providing the cache, it can store data in the cache that can be used for cookie resurrection). Implementors are therefore encouraged to expose application caches in a manner related to HTTP cookies, allowing caches to be expunged together with cookies and other origin-specific data.</p>

  <p class="example">For example, a user agent could have a "delete site-specific data" feature that clears all cookies, application caches, local storage, databases, etc, from an origin all at once.</p>

  


  

  <h4 id="disk-space"><span class="secno">7.9.8</span> Disk space<a href="#disk-space" class="self-link"></a></h4>

  <p>User agents should consider applying constraints on disk usage of <a href="#application-cache" id="disk-space:application-cache">application caches</a>, and care should be taken to ensure that the restrictions cannot be easily worked around using subdomains.</p>

  <p>User agents should allow users to see how much space each domain is using, and may offer the user the ability to delete specific <a href="#application-cache" id="disk-space:application-cache-2">application caches</a>.</p>

  <p>For predictability, quotas should be based on the uncompressed size of data stored.</p>
  

  <p class="note">How quotas are presented to the user is not defined by this specification. User agents are encouraged to provide features such as allowing a user to indicate that certain sites are trusted to use more than the default quota, e.g. by presenting a non-modal user interface while a cache is being updated, or by having an explicit safelist in the user agent's configuration interface.</p>

  



  <h4 id="security-concerns-with-offline-applications-caches"><span class="secno">7.9.9</span> Security concerns with offline applications caches<a href="#security-concerns-with-offline-applications-caches" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p>The main risk introduced by offline application caches is that an injection attack can be elevated into persistent site-wide page replacement. This attack involves using an injection vulnerability to upload two files to the victim site. The first file is an application cache manifest consisting of just a fallback entry pointing to the second file, which is an HTML page whose manifest is declared as that first file. Once the user has been directed to that second file, all subsequent accesses to any file covered by the given fallback namespace while either the user or the site is offline will instead show that second file. Targeted denial-of-service attacks or cookie bombing attacks (where the client is made to send so many cookies that the server refuses to process the request) can be used to ensure that the site appears offline.</p>

  <p>To mitigate this, manifests can only specify fallbacks that are in the same path as the manifest itself. This means that a content injection upload vulnerability in a particular directory on a server can only be escalated to a take-over of that directory and its subdirectories. If there is no way to inject a file into the root directory, the entire site cannot be taken over.</p>

  <p>If a site has been attacked in this way, simply removing the offending manifest might eventually clear the problem, since the next time the manifest is updated, a 404 error will be seen, and the user agent will clear the cache. "Eventually" is the key word here, however; while the attack on the user or server is ongoing, such that connections from an affected user to the affected site are blocked, the user agent will simply assume that the user is offline and will continue to use the hostile manifest. Unfortunately, if a cookie bombing attack has also been used, merely removing the manifest is insufficient; in addition, the server has to be configured to return a 404 or 410 response instead of the 413 "Request Entity Too Large" response.</p>

  <p>TLS does not inherently protect a site from this attack, since the attack relies on content being served from the server itself. Not using application caches also does not prevent this attack, since the attack relies on an attacker-provided manifest.</p>



  <h4 id="application-cache-api"><span class="secno">7.9.10</span> アプリケーションキャッシュAPI<a href="#application-cache-api" class="self-link"></a></h4>

  <pre><code class='idl'>[<c- g>SecureContext</c->,
 <c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='applicationcache'><c- g>ApplicationCache</c-></dfn> : <a href='https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget' data-x-internal='eventtarget' id='application-cache-api:eventtarget'><c- n>EventTarget</c-></a> {

  // <a href='#concept-appcache-status' id='application-cache-api:concept-appcache-status'>update status</a>
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-uncached' id='application-cache-api:dom-appcache-uncached'><c- g>UNCACHED</c-></a> = 0;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-idle' id='application-cache-api:dom-appcache-idle'><c- g>IDLE</c-></a> = 1;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-checking' id='application-cache-api:dom-appcache-checking'><c- g>CHECKING</c-></a> = 2;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-downloading' id='application-cache-api:dom-appcache-downloading'><c- g>DOWNLOADING</c-></a> = 3;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-updateready' id='application-cache-api:dom-appcache-updateready'><c- g>UPDATEREADY</c-></a> = 4;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-obsolete' id='application-cache-api:dom-appcache-obsolete'><c- g>OBSOLETE</c-></a> = 5;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-appcache-status' id='application-cache-api:dom-appcache-status'><c- g>status</c-></a>;

  // updates
  <c- b>void</c-> <a href='#dom-appcache-update' id='application-cache-api:dom-appcache-update'><c- g>update</c-></a>();
  <c- b>void</c-> <a href='#dom-appcache-abort' id='application-cache-api:dom-appcache-abort'><c- g>abort</c-></a>();
  <c- b>void</c-> <a href='#dom-appcache-swapcache' id='application-cache-api:dom-appcache-swapcache'><c- g>swapCache</c-></a>();

  // events
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onchecking' id='application-cache-api:handler-appcache-onchecking'><c- g>onchecking</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-2'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onerror' id='application-cache-api:handler-appcache-onerror'><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-3'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onnoupdate' id='application-cache-api:handler-appcache-onnoupdate'><c- g>onnoupdate</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-4'><c- n>EventHandler</c-></a> <a href='#handler-appcache-ondownloading' id='application-cache-api:handler-appcache-ondownloading'><c- g>ondownloading</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-5'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onprogress' id='application-cache-api:handler-appcache-onprogress'><c- g>onprogress</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-6'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onupdateready' id='application-cache-api:handler-appcache-onupdateready'><c- g>onupdateready</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-7'><c- n>EventHandler</c-></a> <a href='#handler-appcache-oncached' id='application-cache-api:handler-appcache-oncached'><c- g>oncached</c-></a>;
  <c- b>attribute</c-> <a href='webappapis.html#eventhandler' id='application-cache-api:eventhandler-8'><c- n>EventHandler</c-></a> <a href='#handler-appcache-onobsolete' id='application-cache-api:handler-appcache-onobsolete'><c- g>onobsolete</c-></a>;
};</code></pre>

  <dl class="domintro"><dt><var>cache</var> = <var>window</var> . <code id="dom-applicationcache-dev"><a href="#dom-applicationcache">applicationCache</a></code><dd><p>Returns the <code id="application-cache-api:applicationcache"><a href="#applicationcache">ApplicationCache</a></code> object that applies to the <a id="application-cache-api:active-document" href="browsers.html#active-document">active document</a> of that <code id="application-cache-api:window"><a href="window-object.html#window">Window</a></code>.</p>

   <dt><var>cache</var> . <code id="dom-appcache-status-dev"><a href="#dom-appcache-status">status</a></code><dd><p>以下に定義された定数で与えられるように、アプリケーションキャッシュの現在のステータスを返す。</p>

   <dt><var>cache</var> . <code id="dom-appcache-update-dev"><a href="#dom-appcache-update">update</a></code>()<dd><p><a href="#application-cache-download-process" id="application-cache-api:application-cache-download-process">アプリケーションキャッシュのダウンロードプロセス</a>を起動する。</p>

    <p>Throws an <a id="application-cache-api:invalidstateerror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if there is no application cache to update.</p>

    <p>ユーザーエージェントは通常、自動的に<a href="#application-cache" id="application-cache-api:application-cache">アプリケーションキャッシュ</a>を更新する処理をするので、通常このメソッドを呼び出す必要はない。</p>

    <p>このメソッドは、長期のアプリケーションのような状況で役立つ。たとえば、ウェブメールアプリケーションは一度に何週間もブラウザータブで開いたままかもしれない。このようなアプリケーションは、毎日更新をテストできるだろう。</p>

   <dt><var>cache</var> . <code id="dom-appcache-abort-dev"><a href="#dom-appcache-abort">abort</a></code>()<dd><p><a href="#application-cache-download-process" id="application-cache-api:application-cache-download-process-2">アプリケーションキャッシュのダウンロード処理</a>を中止する。</p>

    <p>このメソッドは、（帯域幅が限られるためなどで）ユーザーが更新を停止したい場合に、独自のキャッシング進捗UIを表示するウェブアプリケーションで使用されることを意図する。</p>

   <dt><var>cache</var> . <code id="dom-appcache-swapcache-dev"><a href="#dom-appcache-swapcache">swapCache</a></code>()<dd><p>新しいものが存在する場合、最新のアプリケーションキャッシュに切り替わる。If there isn't, throws an <a id="application-cache-api:invalidstateerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.</p>

    <p>これは、以前にロードされたリソースが再読み込みされることはない。たとえば、画像が急にリロードされないと、スタイルシートやスクリプトが再解析または再評価されない。唯一の変更点は、キャッシュされたリソースに対する後続の要求が新しいコピーを取得することである。</p>

    <p>このメソッドが呼び出される前に<code id="application-cache-api:event-appcache-updateready"><a href="#event-appcache-updateready">updateready</a></code>イベントが発火する。一度発火すると、ウェブアプリケーションは、その余暇で、より最近のアップデートで一つに基礎となるキャッシュを切り替えるためにこのメソッドを呼び出す。これを適切に使うためには、アプリケーションは動作に新しい機能をもたらすことができるようにする必要がある。たとえば、新しい機能を有効にするためにスクリプトをリロードするなど。</p>

    <p><code id="application-cache-api:dom-appcache-swapcache-2"><a href="#dom-appcache-swapcache">swapCache()</a></code>の代替は、<code id="application-cache-api:dom-location-reload"><a href="history.html#dom-location-reload">location.reload()</a></code>を使用して、ユーザーに適した時点で単にページ全体をリロードすることである。</p>

   </dl>

  

  <p>There is a one-to-one mapping from <a href="#cache-host" id="application-cache-api:cache-host">cache hosts</a> to <code id="application-cache-api:applicationcache-2"><a href="#applicationcache">ApplicationCache</a></code> objects. The <dfn id="dom-applicationcache"><code>applicationCache</code></dfn> attribute on <code id="application-cache-api:window-2"><a href="window-object.html#window">Window</a></code> objects must return the <code id="application-cache-api:applicationcache-3"><a href="#applicationcache">ApplicationCache</a></code> object associated with the <code id="application-cache-api:window-3"><a href="window-object.html#window">Window</a></code> object's <a id="application-cache-api:active-document-2" href="browsers.html#active-document">active document</a>.</p>

  <p class="note">A <code id="application-cache-api:document"><a href="dom.html#document">Document</a></code> has an associated <code id="application-cache-api:applicationcache-4"><a href="#applicationcache">ApplicationCache</a></code> object even if that <a href="#cache-host" id="application-cache-api:cache-host-2">cache host</a> has no actual <a href="#application-cache" id="application-cache-api:application-cache-2">application cache</a>.</p>

  <hr>

  <p>The <dfn id="dom-appcache-status"><code>status</code></dfn> attribute, on getting, must return the current state of the <a href="#application-cache" id="application-cache-api:application-cache-3">application cache</a> that the <code id="application-cache-api:applicationcache-5"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-3">cache host</a> is associated with, if any. This must be the appropriate value from the following list:</p>

  

  <dl><dt><dfn id="dom-appcache-uncached"><code>UNCACHED</code></dfn>（数値0）<dd><p><code id="application-cache-api:applicationcache-6"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-4">キャッシュホスト</a>は、この時点で<a href="#application-cache" id="application-cache-api:application-cache-4">アプリケーションキャッシュ</a>に関連付けられていない。<dt><dfn id="dom-appcache-idle"><code>IDLE</code></dfn>（数値1）<dd><p><code id="application-cache-api:applicationcache-7"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-5">キャッシュホスト</a>は、<a href="#application-cache-group" id="application-cache-api:application-cache-group">アプリケーションキャッシュグループ</a>の<a href="#concept-appcache-status" id="application-cache-api:concept-appcache-status-2">更新ステータス</a>が<i>idle</i>である<a href="#application-cache" id="application-cache-api:application-cache-5">アプリケーションキャッシュ</a>に関連付けられ、その<a href="#application-cache" id="application-cache-api:application-cache-6">アプリケーションキャッシュ</a>は、その<a href="#application-cache-group" id="application-cache-api:application-cache-group-2">アプリケーションキャッシュグループ</a>の<a href="#concept-appcache-newer" id="application-cache-api:concept-appcache-newer">最新の</a>キャッシュであり、<a href="#application-cache-group" id="application-cache-api:application-cache-group-3">アプリケーションキャッシュグループ</a>は、<a href="#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete">obsolete</a>とマークされない。<dt><dfn id="dom-appcache-checking"><code>CHECKING</code></dfn>（数値2）<dd><p><code id="application-cache-api:applicationcache-8"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-6">キャッシュホスト</a>は、<a href="#application-cache-group" id="application-cache-api:application-cache-group-4">アプリケーションキャッシュグループ</a>の<a href="#concept-appcache-status" id="application-cache-api:concept-appcache-status-3">更新ステータス</a>が<i>checking</i>である<a href="#application-cache" id="application-cache-api:application-cache-7">アプリケーションキャッシュ</a>に関連付けられる。<dt><dfn id="dom-appcache-downloading"><code>DOWNLOADING</code></dfn>（数値3）<dd><p><code id="application-cache-api:applicationcache-9"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-7">キャッシュホスト</a>は、<a href="#application-cache-group" id="application-cache-api:application-cache-group-5">アプリケーションキャッシュグループ</a>の<a href="#concept-appcache-status" id="application-cache-api:concept-appcache-status-4">更新ステータス</a>が<i>downloading</i>である<a href="#application-cache" id="application-cache-api:application-cache-8">アプリケーションキャッシュ</a>に関連付けられる。<dt><dfn id="dom-appcache-updateready"><code>UPDATEREADY</code></dfn>（数値4）<dd><p><code id="application-cache-api:applicationcache-10"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-8">キャッシュホスト</a>は、<a href="#application-cache-group" id="application-cache-api:application-cache-group-6">アプリケーションキャッシュグループ</a>の<a href="#concept-appcache-status" id="application-cache-api:concept-appcache-status-5">更新ステータス</a>が<i>idle</i>である<a href="#application-cache" id="application-cache-api:application-cache-9">アプリケーションキャッシュ</a>に関連付けられ、その<a href="#application-cache-group" id="application-cache-api:application-cache-group-7">アプリケーションキャッシュグループ</a>が<a href="#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-2">obsolete</a>としてマークされないが、その<a href="#application-cache" id="application-cache-api:application-cache-10">アプリケーションキャッシュ</a>は、そのグループ内の<a href="#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-2">最新の</a>キャッシュでは<em>ない</em>。<dt><dfn id="dom-appcache-obsolete"><code>OBSOLETE</code></dfn>（数値5）<dd><p><code id="application-cache-api:applicationcache-11"><a href="#applicationcache">ApplicationCache</a></code>オブジェクトの<a href="#cache-host" id="application-cache-api:cache-host-9">キャッシュホスト</a>は、<a href="#application-cache-group" id="application-cache-api:application-cache-group-8">アプリケーションキャッシュグループ</a>が<a href="#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-3">obsolete</a>とマークされる<a href="#application-cache" id="application-cache-api:application-cache-11">アプリケーションキャッシュ</a>に関連付けられる。</dl>

  

  <hr>

  <p>If the <dfn id="dom-appcache-update"><code>update()</code></dfn> method is invoked, the user agent must invoke the <a href="#application-cache-download-process" id="application-cache-api:application-cache-download-process-3">application cache download process</a>, in the background, for the <a href="#application-cache-group" id="application-cache-api:application-cache-group-9">application cache group</a> of the <a href="#application-cache" id="application-cache-api:application-cache-12">application cache</a> with which the <code id="application-cache-api:applicationcache-12"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-10">cache host</a> is associated, but without giving that <a href="#cache-host" id="application-cache-api:cache-host-11">cache host</a> to the algorithm. If there is no such <a href="#application-cache" id="application-cache-api:application-cache-13">application cache</a>, or if its <a href="#application-cache-group" id="application-cache-api:application-cache-group-10">application cache group</a> is marked as <a href="#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-4">obsolete</a>, then the method must throw an <a id="application-cache-api:invalidstateerror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> instead.</p>

  <p>If the <dfn id="dom-appcache-abort"><code>abort()</code></dfn> method is invoked, the user agent must <dfn id="send-a-signal">send a signal</dfn> to the current <a href="#application-cache-download-process" id="application-cache-api:application-cache-download-process-4">application cache download process</a> for the <a href="#application-cache-group" id="application-cache-api:application-cache-group-11">application cache group</a> of the <a href="#application-cache" id="application-cache-api:application-cache-14">application cache</a> with which the <code id="application-cache-api:applicationcache-13"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-12">cache host</a> is associated, if any. If there is no such <a href="#application-cache" id="application-cache-api:application-cache-15">application cache</a>, or it does not have a current <a href="#application-cache-download-process" id="application-cache-api:application-cache-download-process-5">application cache download process</a>, then do nothing.</p>

  <p>If the <dfn id="dom-appcache-swapcache"><code>swapCache()</code></dfn> method is invoked, the user agent must run the following steps:<ol><li><p>Check that <code id="application-cache-api:applicationcache-14"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-13">cache host</a> is associated with an <a href="#application-cache" id="application-cache-api:application-cache-16">application cache</a>. If it is not, then throw an <a id="application-cache-api:invalidstateerror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>cache</var> be the <a href="#application-cache" id="application-cache-api:application-cache-17">application cache</a> with which the <code id="application-cache-api:applicationcache-15"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-14">cache host</a> is associated. (By definition, this is the same as the one that was found in the previous step.)<li><p>If <var>cache</var>'s <a href="#application-cache-group" id="application-cache-api:application-cache-group-12">application cache group</a> is marked as <a href="#concept-appcache-obsolete" id="application-cache-api:concept-appcache-obsolete-5">obsolete</a>, then unassociate the <code id="application-cache-api:applicationcache-16"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-15">cache host</a> from <var>cache</var> and return. (Resources will now load from the network instead of the cache.)<li><p>Check that there is an application cache in the same <a href="#application-cache-group" id="application-cache-api:application-cache-group-13">application cache group</a> as <var>cache</var> whose <a href="#concept-appcache-completeness" id="application-cache-api:concept-appcache-completeness">completeness flag</a> is <i>complete</i> and that is <a href="#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-3">newer</a> than <var>cache</var>. If there is not, then throw an <a id="application-cache-api:invalidstateerror-5" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="application-cache-api:domexception-5"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> exception.<li><p>Let <var>new cache</var> be the <a href="#concept-appcache-newer" id="application-cache-api:concept-appcache-newer-4">newest</a> <a href="#application-cache" id="application-cache-api:application-cache-18">application cache</a> in the same <a href="#application-cache-group" id="application-cache-api:application-cache-group-14">application cache group</a> as <var>cache</var> whose <a href="#concept-appcache-completeness" id="application-cache-api:concept-appcache-completeness-2">completeness flag</a> is <i>complete</i>.<li><p>Unassociate the <code id="application-cache-api:applicationcache-17"><a href="#applicationcache">ApplicationCache</a></code> object's <a href="#cache-host" id="application-cache-api:cache-host-16">cache host</a> from <var>cache</var> and instead associate it with <var>new cache</var>.</ol>

  <p>The following are the <a id="application-cache-api:event-handlers" href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <a href="webappapis.html#event-handler-event-type" id="application-cache-api:event-handler-event-type">event handler event types</a>) that must be supported, as <a id="application-cache-api:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the <code id="application-cache-api:applicationcache-18"><a href="#applicationcache">ApplicationCache</a></code> interface:</p>

  <table><thead><tr><th><a href="webappapis.html#event-handlers" id="application-cache-api:event-handlers-2">イベントハンドラー</a><th><a id="application-cache-api:event-handler-event-type-2" href="webappapis.html#event-handler-event-type">イベントハンドラーイベント型</a><tbody><tr><td><dfn id="handler-appcache-onchecking"><code>onchecking</code></dfn><td><code id="application-cache-api:event-appcache-checking"><a href="#event-appcache-checking">checking</a></code><tr><td><dfn id="handler-appcache-onerror"><code>onerror</code></dfn><td><code id="application-cache-api:event-appcache-error"><a href="#event-appcache-error">error</a></code><tr><td><dfn id="handler-appcache-onnoupdate"><code>onnoupdate</code></dfn><td><code id="application-cache-api:event-appcache-noupdate"><a href="#event-appcache-noupdate">noupdate</a></code><tr><td><dfn id="handler-appcache-ondownloading"><code>ondownloading</code></dfn><td><code id="application-cache-api:event-appcache-downloading"><a href="#event-appcache-downloading">downloading</a></code><tr><td><dfn id="handler-appcache-onprogress"><code>onprogress</code></dfn><td><code id="application-cache-api:event-appcache-progress"><a href="#event-appcache-progress">progress</a></code><tr><td><dfn id="handler-appcache-onupdateready"><code>onupdateready</code></dfn><td><code id="application-cache-api:event-appcache-updateready-2"><a href="#event-appcache-updateready">updateready</a></code><tr><td><dfn id="handler-appcache-oncached"><code>oncached</code></dfn><td><code id="application-cache-api:event-appcache-cached"><a href="#event-appcache-cached">cached</a></code><tr><td><dfn id="handler-appcache-onobsolete"><code>onobsolete</code></dfn><td><code id="application-cache-api:event-appcache-obsolete"><a href="#event-appcache-obsolete">obsolete</a></code></table>

  


  <h4 id="navigator.online"><span class="secno">7.9.11</span> <span id="browser-state">ブラウザーの状態</span><a href="#navigator.online" class="self-link"></a></h4><div class="status"><input onclick="toggleStatus(this)" value="⋰" type="button"><p class="support"><strong>Support:</strong> online-status<span class="and_chr yes"><span>Chrome for Android</span> <span>79+</span></span><span class="chrome yes"><span>Chrome</span> <span>14+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>4.2+</span></span><span class="firefox yes"><span>Firefox</span> <span>41+</span></span><span class="safari yes"><span>Safari</span> <span>5+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>12.12+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="ie yes"><span>IE</span> <span>9+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="opera yes"><span>Opera</span> <span>15+</span></span><span class="and_ff yes"><span>Firefox for Android</span> <span>68+</span></span><p class="caniuse">Source: <a href="https://caniuse.com/#feat=online-status">caniuse.com</a></div>

  <aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine" title="The NavigatorOnLine interface contains methods and properties related to the connectivity status of the browser.">NavigatorOnLine</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge yes"><span>Edge</span><span>Yes</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside><pre><code class='idl'><c- b>interface</c-> <c- b>mixin</c-> <dfn id='navigatoronline'><c- g>NavigatorOnLine</c-></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-navigator-online' id='navigator.online:dom-navigator-online'><c- g>onLine</c-></a>;
};</code></pre>

  <dl class="domintro"><dt><var>self</var> . <code id="navigator.online:dom-navigator"><a href="system-state.html#dom-navigator">navigator</a></code> . <code id="dom-navigator-online-dev"><a href="#dom-navigator-online">onLine</a></code><dd><p>ユーザーエージェントが正確にオフラインである（ネットワークから切断されている）場合にfalseを返すユーザーエージェントがオンラインかもしれない場合にtrueを返す。</p>

    <p>この属性値が変更される場合、イベント<code id="navigator.online:event-online"><a href="indices.html#event-online">online</a></code>および<code id="navigator.online:event-offline"><a href="indices.html#event-offline">offline</a></code>が発火する。</p>
   </dl>

  

  <aside class="mdn before wrapped"><input onclick="toggleStatus(this)" value="⋰" type="button"><div><b>MDN</b><details><summary><a href="https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/onLine" title="Returns the online status of the browser. The property returns a boolean value, with true meaning online and false meaning offline. The property sends updates whenever the browser's ability to connect to the network changes. The update occurs when the user follows links or when a script requests a remote page. For example, the property should return false when users click links soon after they lose internet connection.">NavigatorOnLine/onLine</a></summary><p class="mdnsupport"><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="edge yes"><span>Edge</span><span>Yes</span></span><span class="edge_mobile unknown"><span>Edge Mobile</span><span>?</span></span><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="firefox yes"><span>Firefox</span><span>4+</span></span><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><span class="opera no"><span>Opera</span><span>No</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span></details></div></aside><p>The <dfn id="dom-navigator-online"><code>navigator.onLine</code></dfn> attribute must return false if the user agent will not contact the network when the user follows links or when a script requests a remote page (or knows that such an attempt would fail), and must return true otherwise.</p>

  <p>When the value that would be returned by the <code id="navigator.online:dom-navigator-online-2"><a href="#dom-navigator-online">navigator.onLine</a></code> attribute of a <code id="navigator.online:window"><a href="window-object.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> changes from true to false, the user agent must <a id="navigator.online:queue-a-task" href="webappapis.html#queue-a-task">queue a task</a> to <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="navigator.online:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="navigator.online:event-offline-2"><a href="indices.html#event-offline">offline</a></code> at the <code id="navigator.online:window-2"><a href="window-object.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope-2"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> object.</p>

  <p>On the other hand, when the value that would be returned by the <code id="navigator.online:dom-navigator-online-3"><a href="#dom-navigator-online">navigator.onLine</a></code> attribute of a <code id="navigator.online:window-3"><a href="window-object.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope-3"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> changes from false to true, the user agent must <a id="navigator.online:queue-a-task-2" href="webappapis.html#queue-a-task">queue a task</a> to <a href="https://dom.spec.whatwg.org/#concept-event-fire" id="navigator.online:concept-event-fire-2" data-x-internal="concept-event-fire">fire an event</a> named <code id="navigator.online:event-online-2"><a href="indices.html#event-online">online</a></code> at the <code id="navigator.online:window-4"><a href="window-object.html#window">Window</a></code> or <code id="navigator.online:workerglobalscope-4"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> object.</p>

  <p>The <a id="navigator.online:task-source" href="webappapis.html#task-source">task source</a> for these <a href="webappapis.html#concept-task" id="navigator.online:concept-task">tasks</a> is the <a id="navigator.online:networking-task-source" href="webappapis.html#networking-task-source">networking task source</a>.</p>

  

  <p class="note">この属性は、本質的に信頼できない。コンピューターは、インターネット接続がなくてもネットワークに接続できる。</p>

  <div class="example"><p>この例において、ブラウザーがオンラインおよびオフラインになるように、インジケーターが更新される。</p>

   <pre><code class='html'><c- cp>&lt;!DOCTYPE HTML></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>head</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>title</c-><c- p>></c->Online status<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>script</c-><c- p>></c->
   <c- a>function</c-> updateIndicator<c- p>()</c-> <c- p>{</c->
     document<c- p>.</c->getElementById<c- p>(</c-><c- t>'indicator'</c-><c- p>).</c->textContent <c- o>=</c-> navigator<c- p>.</c->onLine <c- o>?</c-> <c- t>'online'</c-> <c- o>:</c-> <c- t>'offline'</c-><c- p>;</c->
   <c- p>}</c->
  <c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>head</c-><c- p>></c->
 <c- p>&lt;</c-><c- f>body</c-> <c- e>onload</c-><c- o>=</c-><c- s>"updateIndicator()"</c-> <c- e>ononline</c-><c- o>=</c-><c- s>"updateIndicator()"</c-> <c- e>onoffline</c-><c- o>=</c-><c- s>"updateIndicator()"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->The network is: <c- p>&lt;</c-><c- f>span</c-> <c- e>id</c-><c- o>=</c-><c- s>"indicator"</c-><c- p>></c->(state unknown)<c- p>&lt;/</c-><c- f>span</c-><c- p>></c->
 <c- p>&lt;/</c-><c- f>body</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>html</c-><c- p>></c-></code></pre>

  </div>




  <nav><a href="browsing-the-web.html">← 7.8 ウェブを閲覧する</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav>

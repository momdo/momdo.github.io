<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><meta content="light dark" name="color-scheme"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script defer="" crossorigin="" src="./html-dfn.js"></script>
  <script defer="" crossorigin="" src="/var-click-highlighting.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" class="darkmode-aware" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><p id="living-standard">Living Standard — Last Updated <span class="pubdate">29 October 2025</span></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav><ol class="toc"><li id="toc-comms"><ol><li><a href="web-messaging.html#web-messaging"><span class="secno">9.3</span> 異なる文書間のメッセージング</a><ol><li><a href="web-messaging.html#introduction-12"><span class="secno">9.3.1</span> 導入</a><li><a href="web-messaging.html#security-postmsg"><span class="secno">9.3.2</span> セキュリティ</a><ol><li><a href="web-messaging.html#authors"><span class="secno">9.3.2.1</span> 著者</a><li><a href="web-messaging.html#user-agents"><span class="secno">9.3.2.2</span> User agents</a></ol><li><a href="web-messaging.html#posting-messages"><span class="secno">9.3.3</span> メッセージのポスト</a></ol><li><a href="web-messaging.html#channel-messaging"><span class="secno">9.4</span> チャンネルメッセージング</a><ol><li><a href="web-messaging.html#introduction-13"><span class="secno">9.4.1</span> 導入</a><ol><li><a href="web-messaging.html#examples-5"><span class="secno">9.4.1.1</span> 例</a><li><a href="web-messaging.html#ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> ウェブ上のオブジェクト機能モデルの基礎としてのポート</a><li><a href="web-messaging.html#ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> サービス実装を抽象化する基礎としてのポート</a></ol><li><a href="web-messaging.html#message-channels"><span class="secno">9.4.2</span> メッセージチャンネル</a><li><a href="web-messaging.html#the-messageeventtarget-mixin"><span class="secno">9.4.3</span> <code>MessageEventTarget</code>ミックスイン</a><li><a href="web-messaging.html#message-ports"><span class="secno">9.4.4</span> メッセージポート</a><li><a href="web-messaging.html#ports-and-garbage-collection"><span class="secno">9.4.5</span> ポートおよびガベージコレクション</a></ol><li><a href="web-messaging.html#broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> 他のブラウジングコンテキストへのブロードキャスト</a></ol></ol><h3 id="web-messaging"><span class="secno">9.3</span> <dfn id="crossDocumentMessages">異なる文書間のメッセージング</dfn><a href="#web-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" title="The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.">Window/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>9.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>≤37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div>

  <p>ウェブブラウザーは、セキュリティおよびプライバシー上の理由から、異なるドメインの文書が相互に影響を与えないようにしている。つまり、クロスサイトスクリプティングは許可されてない。</p>

  <p>これは重要なセキュリティ機能であるが、たとえ敵対的でないページであっても、異なるドメインにあるそれらのページの通信を妨げる。このセクションでは、クロスサイトスクリプティング攻撃を可能にしないように設計された、ソースドメインに関係なく文書が相互に通信を可能にするメッセージングシステムを紹介する。</p>

  <p id="fingerprint-postMessage" class="note"><a href="#fingerprint-postMessage" class="self-link"></a> <a id="web-messaging:tracking-vector" title="There is a tracking vector here." href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" class="tracking-vector" data-x-internal="tracking-vector"><img width="46" alt="(This is a tracking vector.)" crossorigin="" class="darkmode-aware" src="https://resources.whatwg.org/tracking-vector.svg" height="64"></a> <code id="web-messaging:dom-window-postmessage"><a href="#dom-window-postmessage">postMessage()</a></code> APIは、<a id="web-messaging:tracking-vector-2" href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" data-x-internal="tracking-vector">トラッキングベクター</a>として使用できる。</p>


  <h4 id="introduction-12"><span class="secno">9.3.1</span> 導入<a href="#introduction-12" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <div class="example"><p>たとえば、文書Aに文書Bを含む<code id="introduction-12:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素が含まれ、文書Aのスクリプトが文書Bの <code id="introduction-12:window"><a href="nav-history-apis.html#window">Window</a></code>オブジェクトで<code id="introduction-12:dom-window-postmessage"><a href="#dom-window-postmessage">postMessage()</a></code>を呼び出す場合、文書Aの<code id="introduction-12:window-2"><a href="nav-history-apis.html#window">Window</a></code>から発信されたものとしてマークされたメッセージイベントがそのオブジェクトで発生する。文書Aのスクリプトは次のようになる；</p>

   <pre><code class='js'><c- a>var</c-> o <c- o>=</c-> document<c- p>.</c->getElementsByTagName<c- p>(</c-><c- t>'iframe'</c-><c- p>)[</c-><c- mf>0</c-><c- p>];</c->
o<c- p>.</c->contentWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello world'</c-><c- p>,</c-> <c- t>'https://b.example.org/'</c-><c- p>);</c-></code></pre>

   <p>着信イベントのイベントハンドラーを登録するために、スクリプトは<code>addEventListener</code>（または類似のメカニズム）を使用する。たとえば、文書Bのスクリプトは次のようになる：</p>

   <pre><code class='js'>window<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> receiver<c- p>,</c-> <c- kc>false</c-><c- p>);</c->
<c- a>function</c-> receiver<c- p>(</c->e<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->e<c- p>.</c->origin <c- o>==</c-> <c- t>'https://example.com'</c-><c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->e<c- p>.</c->data <c- o>==</c-> <c- t>'Hello world'</c-><c- p>)</c-> <c- p>{</c->
      e<c- p>.</c->source<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello'</c-><c- p>,</c-> e<c- p>.</c->origin<c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      alert<c- p>(</c->e<c- p>.</c->data<c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

   <p>このスクリプトは、ドメインが予想されるドメインであることを最初に確認し、次にメッセージを調べる。メッセージは、ユーザーに表示されるまたは、最初にメッセージを送信した文書にメッセージを送り返すことによって応答される。</p>

  </div>


  <h4 id="security-postmsg"><span class="secno">9.3.2</span> セキュリティ<a href="#security-postmsg" class="self-link"></a></h4>

  

  <h5 id="authors"><span class="secno">9.3.2.1</span> 著者<a href="#authors" class="self-link"></a></h5>

  

  <p id="security-4" class="warning">このAPIを使用するには、サイトを悪用する悪意のある組織からユーザーを保護するために、特別な注意が必要である。</p>

  <p>著者は、<code id="authors:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックし、メッセージを受信すると予想されるドメインからのみメッセージが受け入れられるようにすべきである。さもなければ、著者のメッセージ処理コードのバグが悪意のあるサイトによって悪用される可能性がある。</p>

  <p>さらに、<code id="authors:dom-messageevent-origin-2"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックした後でも、著者は問題のデータが期待されたフォーマットであることもチェックすべきである。さもなければ、イベントのソースがクロスサイトスクリプティングの欠陥を使用して攻撃された場合、 <code id="authors:dom-window-postmessage"><a href="#dom-window-postmessage">postMessage()</a></code>メソッドを使用して送信された情報の処理がさらにチェックされないことで、攻撃が受信側に伝播する可能性がある。</p>

  <p>著者は、機密情報を含むメッセージの<var>targetOrigin</var> 引数にワイルドカードキーワード(*)を使用すべきではない。さもなければ、メッセージが意図した受信者にのみ配信されることを保証できなくなる。</p>

  <hr>

  <p>あらゆる生成元からのメッセージを受け入れる著者は、サービス拒否攻撃のリスクを考慮することが奨励される。攻撃者は大量のメッセージを送信する可能性がある。受信ページがコストのかかる計算を実行したり、そのようなメッセージごとにネットワークトラフィックが送信されたりすると、攻撃者のメッセージはサービス拒否攻撃に増幅される可能性がある。著者は、そのような攻撃を非現実的にするために、レート制限（1分あたり特定の数のメッセージのみを受け入れる）を採用することが奨励される。</p>


  

  <h5 id="user-agents"><span class="secno">9.3.2.2</span> User agents<a href="#user-agents" class="self-link"></a></h5>

  <p>The integrity of this API is based on the inability for scripts of one <a id="user-agents:concept-origin" href="browsers.html#concept-origin">origin</a> to post arbitrary events (using <code>dispatchEvent()</code> or otherwise) to objects in other origins (those that are not the <a href="browsers.html#same-origin" id="user-agents:same-origin">same</a>).</p>

  <p class="note">Implementers are urged to take extra care in the implementation of this feature. It allows authors to transmit information from one domain to another domain, which is normally disallowed for security reasons. It also requires that UAs be careful to allow access to certain properties but not others.</p>

  <hr>

  <p>User agents are also encouraged to consider rate-limiting message traffic between different <a href="browsers.html#concept-origin" id="user-agents:concept-origin-2">origins</a>, to protect naïve sites from denial-of-service attacks.</p>

  



  <h4 id="posting-messages"><span class="secno">9.3.3</span> メッセージのポスト<a href="#posting-messages" class="self-link"></a></h4>

  <dl class="domintro"><dt><code><var>window</var>.<a href="#dom-window-postmessage-options" id="dom-window-postmessage-options-dev">postMessage</a>(<var>message</var> [, <var>options</var> ])</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" title="The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.">Window/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>9.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><dd><p>指定されたウィンドウにメッセージをポストする。メッセージは、ネストされたオブジェクト、配列などの構造化されたオブジェクトにすることができ、JavaScriptの値（文字列、数値、<code id="posting-messages:date"><a data-x-internal="date" href="https://tc39.es/ecma262/#sec-date-objects">Date</a></code>オブジェクトなど）を含めることができ、 <code id="posting-messages:file"><a data-x-internal="file" href="https://triple-underscore.github.io/File_API-ja.html#dfn-file">File</a></code> <code id="posting-messages:blob"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>、<code id="posting-messages:filelist"><a data-x-internal="filelist" href="https://triple-underscore.github.io/File_API-ja.html#filelist-section">FileList</a></code>、<code id="posting-messages:idl-arraybuffer"><a data-x-internal="idl-arraybuffer" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-ArrayBuffer">ArrayBuffer</a></code>オブジェクトなどの特定のデータオブジェクトを含めることができる。</p>

    <p><var>options</var>の<code id="posting-messages:dom-structuredserializeoptions-transfer"><a href="#dom-structuredserializeoptions-transfer">transfer</a></code>メンバーにリストされているオブジェクトは、複製されるだけでなく、転送される。つまり、送信側では使用できなくなる。</p>

    <p>ターゲットの生成元は、<var>options</var>の<code id="posting-messages:dom-windowpostmessageoptions-targetorigin"><a href="nav-history-apis.html#dom-windowpostmessageoptions-targetorigin">targetOrigin</a></code>メンバーを使用して指定できる。指定しない場合、デフォルトの"<code>/</code>"になる。このデフォルトでは、メッセージは生成元が同じターゲットだけに制限される。</p>

    <p>ターゲットウィンドウの生成元が指定されたターゲットの生成元とマッチしない場合、情報の漏洩を避けるためにメッセージは破棄される。生成元に関係なく宛先にメッセージを送信するには、ターゲットの生成元を"<code>*</code>"に設定する。</p>

    <p><var>transfer</var>配列に重複するオブジェクトが含まれている場合、または<var>message</var>をクローンできなかった場合、<a id="posting-messages:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="posting-messages:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を投げる。</p>
   <dt><code><var>window</var>.<a href="#dom-window-postmessage" id="posting-messages:dom-window-postmessage">postMessage</a>(<var>message</var>, <var>targetOrigin</var> [, <var>transfer</var> ])</code><dd><p>これは<code id="posting-messages:dom-window-postmessage-options"><a href="#dom-window-postmessage-options">postMessage()</a></code>の代替バージョンで、ターゲットの生成元がパラメータとして指定される。<code>window.postMessage(message, target, transfer)</code>の呼び出しは、<code>window.postMessage(message, {targetOrigin, transfer})</code>と同じである。</dl>

  <p class="note">新しい<code id="posting-messages:document"><a href="dom.html#document">Document</a></code>にナビゲートされたばかりの<a id="posting-messages:browsing-context" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>の<code id="posting-messages:window"><a href="nav-history-apis.html#window">Window</a></code>にメッセージを投稿するとき、メッセージが意図した受信者を受信しない可能性がある。ターゲット<a id="posting-messages:browsing-context-2" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>のスクリプトには、メッセージのリスナーを設定する時間が必要である。したがって、たとえば、メッセージが新しく作成された子<code id="posting-messages:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>の<code id="posting-messages:window-2"><a href="nav-history-apis.html#window">Window</a></code>に送信される状況では、著者は、子&lt;<code id="posting-messages:document-2"><a href="dom.html#document">Document</a></code>にメッセージを受信する準備ができていることを知らせるメッセージを親に投稿させ、親がこのメッセージを待ってからメッセージの投稿を開始するようにアドバイスされる。</p>

  

  <div data-algorithm=""><p>The <dfn id="window-post-message-steps">window post message steps</dfn>, given a <var>targetWindow</var>, <var>message</var>, and <var>options</var>, are as follows:</p>

  <ol><li><p>Let <var>targetRealm</var> be <var>targetWindow</var>'s <a href="webappapis.html#concept-global-object-realm" id="posting-messages:concept-global-object-realm">realm</a>.<li><p>Let <var>incumbentSettings</var> be the <a id="posting-messages:incumbent-settings-object" href="webappapis.html#incumbent-settings-object">incumbent settings object</a>.<li><p>Let <var>targetOrigin</var> be <var>options</var>["<code id="posting-messages:dom-windowpostmessageoptions-targetorigin-2"><a href="nav-history-apis.html#dom-windowpostmessageoptions-targetorigin">targetOrigin</a></code>"].<li><p>If <var>targetOrigin</var> is a single U+002F SOLIDUS character (/), then set <var>targetOrigin</var> to <var>incumbentSettings</var>'s <a href="webappapis.html#concept-settings-object-origin" id="posting-messages:concept-settings-object-origin">origin</a>.</p>

   <li><p>Otherwise, if <var>targetOrigin</var> is not a single U+002A ASTERISK character (*), then:</p>

    <ol><li><p>Let <var>parsedURL</var> be the result of running the <a id="posting-messages:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> on <var>targetOrigin</var>.<li><p>If <var>parsedURL</var> is failure, then throw a <a id="posting-messages:syntaxerror" href="https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="posting-messages:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>targetOrigin</var> to <var>parsedURL</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="posting-messages:concept-url-origin" data-x-internal="concept-url-origin">origin</a>.</ol>
   <li><p>Let <var>transfer</var> be <var>options</var>["<code id="posting-messages:dom-structuredserializeoptions-transfer-2"><a href="#dom-structuredserializeoptions-transfer">transfer</a></code>"].<li><p>Let <var>serializeWithTransferResult</var> be <a id="posting-messages:structuredserializewithtransfer" href="structured-data.html#structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). 例外を再度投げる。<li><p><a id="posting-messages:queue-a-global-task" href="webappapis.html#queue-a-global-task">Queue a global task</a> on the <dfn id="posted-message-task-source">posted message task source</dfn> given <var>targetWindow</var> to run the following steps:</p>

    <ol><li><p>If the <var>targetOrigin</var> argument is not a single literal U+002A ASTERISK character (*) and <var>targetWindow</var>'s <a href="nav-history-apis.html#concept-document-window" id="posting-messages:concept-document-window">associated <code>Document</code></a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="posting-messages:concept-document-origin" data-x-internal="concept-document-origin">origin</a> is not <a id="posting-messages:same-origin" href="browsers.html#same-origin">same origin</a> with <var>targetOrigin</var>, then return.<li><p>Let <var>origin</var> be the <a href="browsers.html#ascii-serialisation-of-an-origin" id="posting-messages:ascii-serialisation-of-an-origin">serialization</a> of <var>incumbentSettings</var>'s <a href="webappapis.html#concept-settings-object-origin" id="posting-messages:concept-settings-object-origin-2">origin</a>.<li><p>Let <var>source</var> be the <code id="posting-messages:windowproxy"><a href="nav-history-apis.html#windowproxy">WindowProxy</a></code> object corresponding to <var>incumbentSettings</var>'s <a href="webappapis.html#concept-settings-object-global" id="posting-messages:concept-settings-object-global">global object</a> (a <code id="posting-messages:window-3"><a href="nav-history-apis.html#window">Window</a></code> object).<li><p>Let <var>deserializeRecord</var> be <a id="posting-messages:structureddeserializewithtransfer" href="structured-data.html#structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>

      <p>If this throws an exception, catch it, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="posting-messages:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="posting-messages:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code> at <var>targetWindow</var>, using <code id="posting-messages:messageevent"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="posting-messages:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var> and the <code id="posting-messages:dom-messageevent-source"><a href="comms.html#dom-messageevent-source">source</a></code> attribute initialized to <var>source</var>, and then return.</p>
     <li><p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].<li><p>Let <var>newPorts</var> be a new <a id="posting-messages:frozen-array" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-frozen-array-type" data-x-internal="frozen-array">frozen array</a> consisting of all <code id="posting-messages:messageport"><a href="#messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.<li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="posting-messages:concept-event-fire-2" data-x-internal="concept-event-fire">Fire an event</a> named <code id="posting-messages:event-message"><a href="indices.html#event-message">message</a></code> at <var>targetWindow</var>, using <code id="posting-messages:messageevent-2"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="posting-messages:dom-messageevent-origin-2"><a href="comms.html#dom-messageevent-origin">origin</a></code> attribute initialized to <var>origin</var>, the <code id="posting-messages:dom-messageevent-source-2"><a href="comms.html#dom-messageevent-source">source</a></code> attribute initialized to <var>source</var>, the <code id="posting-messages:dom-messageevent-data"><a href="comms.html#dom-messageevent-data">data</a></code> attribute initialized to <var>messageClone</var>, and the <code id="posting-messages:dom-messageevent-ports"><a href="comms.html#dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</ol>
   </ol>
  </div>

  <div data-algorithm=""><p>The <code id="posting-messages:window-4"><a href="nav-history-apis.html#window">Window</a></code> interface's <dfn data-dfn-for="Window" id="dom-window-postmessage-options" data-dfn-type="method"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method steps are to run the <a href="#window-post-message-steps" id="posting-messages:window-post-message-steps">window post message steps</a> given <a id="posting-messages:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>, <var>message</var>, and <var>options</var>.</p>
  </div>

  <div data-algorithm=""><p>The <code id="posting-messages:window-5"><a href="nav-history-apis.html#window">Window</a></code> interface's <dfn data-dfn-for="Window" id="dom-window-postmessage" data-dfn-type="method"><code>postMessage(<var>message</var>, <var>targetOrigin</var>, <var>transfer</var>)</code></dfn> method steps are to run the <a href="#window-post-message-steps" id="posting-messages:window-post-message-steps-2">window post message steps</a> given <a id="posting-messages:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>, <var>message</var>, and «[ "<code id="posting-messages:dom-windowpostmessageoptions-targetorigin-3"><a href="nav-history-apis.html#dom-windowpostmessageoptions-targetorigin">targetOrigin</a></code>" → <var>targetOrigin</var>, "<code id="posting-messages:dom-structuredserializeoptions-transfer-3"><a href="#dom-structuredserializeoptions-transfer">transfer</a></code>" → <var>transfer</var> ]».</p>
  </div>

  




  <h3 id="channel-messaging"><span class="secno">9.4</span> <dfn>チャンネルメッセージング</dfn><a href="#channel-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two IFrames, or the main document and an IFrame, two documents via a SharedWorker, or two workers) to communicate directly, passing messages between one another through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API/Using_channel_messaging" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two &lt;iframe> elements, the main document and a single &lt;iframe>, or two documents via a SharedWorker) to communicate directly, passing messages between each other through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API/Using_channel_messaging</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <h4 id="introduction-13"><span class="secno">9.4.1</span> 導入<a href="#introduction-13" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p>独立したコード部分（たとえば、異なる<a href="document-sequences.html#browsing-context" id="introduction-13:browsing-context">ブラウジングコンテキスト</a>で実行される )が直接通信できるようにするために、著者は<a href="#channel-messaging" id="introduction-13:channel-messaging">チャンネルメッセージング</a>を使用することができる。</p>

  <p>このメカニズムの通信チャンネルは、両端にポートを持つ双方向パイプとして実装される。一方のポートで送信されたメッセージはもう一方のポートに配信され、その逆も同様である。メッセージはDOMイベントとして配信され、実行<a href="webappapis.html#concept-task" id="introduction-13:concept-task">タスク</a>を中断したりブロックしたりすることはない。</p>

  <p>接続（2つの"もつれた"ポート）を作成するには、<code>MessageChannel()</code>コンストラクターを呼び出す：</p>

  <pre><code class='js'><c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c-></code></pre>

  <p>ポートの1つはローカルポートとして保持され、もう1つのポートはリモートコードに送信される。たとえば、<code id="introduction-13:dom-window-postmessage"><a href="#dom-window-postmessage">postMessage()</a></code>を使用する：</p>

  <pre><code class='js'>otherWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'https://example.com'</c-><c- p>,</c-> <c- p>[</c->channel<c- p>.</c->port2<c- p>]);</c-></code></pre>

  <p>メッセージを送信するには、ポートの<code id="introduction-13:dom-messageport-postmessage"><a href="#dom-messageport-postmessage">postMessage()</a></code>メソッドを使用する：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>);</c-></code></pre>

  <p>メッセージを受信するには、<code id="introduction-13:event-message"><a href="indices.html#event-message">message</a></code>イベントをリッスンする：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->onmessage <c- o>=</c-> handleMessage<c- p>;</c->
<c- a>function</c-> handleMessage<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- c1>// message is in event.data</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  <p>ポートで送信されるデータは構造化データである可能性がある。たとえば、ここでは文字列の配列が<code id="introduction-13:messageport"><a href="#messageport">MessagePort</a></code>で渡される：</p>

  <pre><code class='js'>port1<c- p>.</c->postMessage<c- p>([</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'world'</c-><c- p>]);</c-></code></pre>


  <h5 id="examples-5"><span class="secno">9.4.1.1</span> 例<a href="#examples-5" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <div class="example"><p>この例では、2つのJavaScriptライブラリが<code id="examples-5:messageport"><a href="#messageport">MessagePort</a></code>を使用して相互に接続されている。これにより、APIを変更することなく、ライブラリを後で別のフレームまたは<code id="examples-5:worker"><a href="workers.html#worker">Worker</a></code>オブジェクトにホストできるようになる。</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"contacts.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a contacts object --></c->
<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"compose-mail.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a composer object --></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c->
 composer<c- p>.</c->addContactsProvider<c- p>(</c->channel<c- p>.</c->port1<c- p>);</c->
 contacts<c- p>.</c->registerConsumer<c- p>(</c->channel<c- p>.</c->port2<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>"addContactsProvider()"関数の実装は次のようになる：</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>switch</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType<c- p>)</c-> <c- p>{</c->
      <c- k>case</c-> <c- t>'search-result'</c-><c- o>:</c-> handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-done'</c-><c- o>:</c-> handleSearchDone<c- p>();</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-error'</c-><c- o>:</c-> handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- c1>// ...</c->
    <c- p>}</c->
  <c- p>};</c->
<c- p>};</c-></code></pre>

   <p>あるいは、次のように実装することもできる：</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-result'</c-><c- p>)</c->
      handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-done'</c-><c- p>)</c->
      handleSearchDone<c- p>();</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-error'</c-><c- p>)</c->
      handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c->
  <c- p>});</c->
  <c- c1>// ...</c->
  port<c- p>.</c->start<c- p>();</c->
<c- p>};</c-></code></pre>

   <p>重要な違いは、<code id="examples-5:dom-eventtarget-addeventlistener"><a data-x-internal="dom-eventtarget-addeventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener">addEventListener()</a></code>を使用する場合、<code id="examples-5:dom-messageport-start"><a href="#dom-messageport-start">start()</a></code>メソッドも呼び出さなければならないことである。<code id="examples-5:handler-messageeventtarget-onmessage"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>を使用する場合、<code id="examples-5:dom-messageport-start-2"><a href="#dom-messageport-start">start()</a></code>メソッドが暗黙的に呼び出される。</p>

   <p><code id="examples-5:dom-messageport-start-3"><a href="#dom-messageport-start">start()</a></code>メソッドは、明示的に呼び出された場合でも、（<code id="examples-5:handler-messageeventtarget-onmessage-2"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>を設定することで）暗黙的に呼び出された場合でも、メッセージのフローを開始する。メッセージポートにポストされたメッセージは、スクリプトがハンドラーをセットアップする前に破棄されないように、最初は一時停止される。</p>

  </div>


  <h5 id="ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> ウェブ上のオブジェクト機能モデルの基礎としてのポート<a href="#ports-as-the-basis-of-an-object-capability-model-on-the-web" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <div data-var-scope=""><p>ポートは、システム内の他の行為者に対して、限定された機能（オブジェクト機能モデルの意味で）を公開する手段と捉えることができる。これは、ポートが特定の生成元内での便利なモデルとしてのみ使用される弱い機能システムと、別の生成元の<var>消費者</var>が<var>プロバイダー</var>に変更を加えたり情報を取得したりするための唯一の手段として、ある生成元の<var>プロバイダー</var>によって提供される強い機能モデルのいずれかである。</p>
  </div>

  <p>たとえば、ソーシャルウェブサイトが、ある<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>にユーザーのメール連絡先プロバイダー（別の生成元のアドレス帳サイト）を埋め込み、別の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>にゲーム（別の生成元のゲーム）を埋め込んでいる状況を考えてみる。外側のソーシャルサイトと2番目の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-3"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内のゲームは、1つ目の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-4"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内のいかなる機能にもアクセスできない。つまり、これら2つのサイトでできることは次のとおりである：</p>

  <ul><li><p><code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-5"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>を新しい<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>（同じ<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>であるが<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="ports-as-the-basis-of-an-object-capability-model-on-the-web:concept-url-fragment" data-x-internal="concept-url-fragment">フラグメント</a>が異なるフラグメントなど）に<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:navigate" href="browsing-the-web.html#navigate">ナビゲート</a>し、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-6"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:window"><a href="nav-history-apis.html#window">Window</a></code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-hashchange"><a href="indices.html#event-hashchange">hashchange</a></code>イベントを受信する。<li><p><code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-7"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>のサイズを変更し、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-8"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:window-2"><a href="nav-history-apis.html#window">Window</a></code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-resize"><a data-x-internal="event-resize" href="https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize">resize</a></code>イベントを受信する。<li><p><code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:dom-window-postmessage"><a href="#dom-window-postmessage">window.postMessage()</a></code> APIを使用して、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-9"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:window-3"><a href="nav-history-apis.html#window">Window</a></code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-message"><a href="indices.html#event-message">message</a></code>イベントを送信する。</ul>

  <p>連絡先プロバイダーはこれらのメソッド、特に3番目のメソッドを使用することで、他の生成元がユーザーのアドレス帳を操作できるAPIを提供できる。たとえば、"<code>add-contact Guillaume Tell &lt;tell@pomme.example.net></code>"というメッセージに応答し、指定された人物およびメールアドレスをユーザーのアドレス帳に追加することができる。</p>

  <p>ウェブ上のどのサイトもユーザーの連絡先を操作できないようにするために、連絡先プロバイダーは、ソーシャルサイトなどの特定の信頼できるサイトのみにこの操作を許可する場合がある。</p>

  <p>さて、ゲームがユーザーのアドレス帳に連絡先を追加したいと考えており、ソーシャルサイトがゲームに代わってその操作を許可し、連絡先プロバイダーがソーシャルサイトと築いていた信頼を「共有」することを望んだとする。これにはいくつかの方法があるが、最も単純な方法は、ゲームサイトと連絡先サイトとの間のメッセージをプロキシすることである。しかし、この解決策にはいくつかの難点がある。ソーシャルサイトは、ゲームサイトが権限を乱用しないことを完全に信頼するか、ソーシャルサイトが各リクエストを検証して、許可したくないリクエスト（複数の連絡先の追加、連絡先の閲覧、削除など）ではないことを確認する必要がある。また、複数のゲームが同時に連絡先プロバイダーとやり取りする可能性がある場合、複雑さが増す。</p>

  <p>しかし、メッセージチャンネルおよび<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:messageport"><a href="#messageport">MessagePort</a></code>オブジェクトを使用すれば、これらの問題はすべて解消する。ゲームがソーシャルサイトに連絡先を追加したいと伝えると、ソーシャルサイトは連絡先プロバイダーに、連絡先を1つ追加するのではなく、1つの連絡先を追加する<em>機能</em>を要求できる。連絡先プロバイダーは<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:messageport-2"><a href="#messageport">MessagePort</a></code>オブジェクトのペアを作成し、そのうちの1つをソーシャルサイトに送り返し、ソーシャルサイトはそれをゲームに転送する。こうしてゲームと連絡先プロバイダーは直接接続され、連絡先プロバイダーは"連絡先の追加"リクエスト1件のみを承認すればよく、それ以外のリクエストは受け付けない。つまり、ゲームには1つの連絡先を追加する機能が付与されたことになる。</p>


  <h5 id="ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> サービス実装を抽象化する基礎としてのポート<a href="#ports-as-the-basis-of-abstracting-out-service-implementations" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>前のセクションからの例に続いて、特に連絡先プロバイダーについて考えてみる。初期の実装では、サービスの<code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>で単に<code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>オブジェクトを使用していたかもしれないが、サービスの進化により、代わりに単一の<code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code>接続で<a href="workers.html#sharedworker" id="ports-as-the-basis-of-abstracting-out-service-implementations:sharedworker">共有ワーカー</a>を使用したい場合がある。</p>

  <p>最初の設計で<code id="ports-as-the-basis-of-abstracting-out-service-implementations:messageport"><a href="#messageport">MessagePort</a></code>オブジェクトを使用して機能を付与した場合、または単に複数の同時独立セッションを許可した場合でも、サービス実装は、APIをまったく変更することなく、  <code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest-2"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>の各<code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>モデルから共有<code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code>モデルに切り替えることができる。サービスプロバイダー側のポートはすべて、APIのユーザーに少しも影響を与えることなく、共有ワーカーに転送できる。</p>



  <h4 id="message-channels"><span class="secno">9.4.2</span> メッセージチャンネル<a href="#message-channels" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel" title="The MessageChannel interface of the Channel Messaging API allows us to create a new message channel and send data through it via its two MessagePort properties.">MessageChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='messagechannel' data-dfn-type='interface'><c- g>MessageChannel</c-></dfn> {
  <a href='#dom-messagechannel' id='message-channels:dom-messagechannel'><c- g>constructor</c-></a>();

  <c- b>readonly</c-> <c- b>attribute</c-> <a href='#messageport' id='message-channels:messageport'><c- n>MessagePort</c-></a> <a href='#dom-messagechannel-port1' id='message-channels:dom-messagechannel-port1'><c- g>port1</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a href='#messageport' id='message-channels:messageport-2'><c- n>MessagePort</c-></a> <a href='#dom-messagechannel-port2' id='message-channels:dom-messagechannel-port2'><c- g>port2</c-></a>;
};</code></pre>

  <dl class="domintro"><dt><code><var>channel</var> = new <a href="#dom-messagechannel" id="dom-messagechannel-dev">MessageChannel</a>()</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel/MessageChannel" title="The MessageChannel() constructor of the MessageChannel interface returns a new MessageChannel object with two new MessagePort objects.">MessageChannel/MessageChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd><p>2つの新しい<a href="#messageport"><code id="message-channels:messageport-3">MessagePort</code></a>オブジェクトをもつ新しい<code id="message-channels:messagechannel"><a href="#messagechannel">MessageChannel</a></code>オブジェクトを返す。</p>
   <dt><code><var>channel</var>.<a href="#dom-messagechannel-port1" id="dom-messagechannel-port1-dev">port1</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel/port1" title="The port1 read-only property of the MessageChannel interface returns the first port of the message channel — the port attached to the context that originated the channel.">MessageChannel/port1</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd><p>1つ目の<code id="message-channels:messageport-4"><a href="#messageport">MessagePort</a></code>オブジェクトを返す。<dt><code><var>channel</var>.<a href="#dom-messagechannel-port2" id="dom-messagechannel-port2-dev">port2</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel/port2" title="The port2 read-only property of the MessageChannel interface returns the second port of the message channel — the port attached to the context at the other end of the channel, which the message is initially sent to.">MessageChannel/port2</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd><p>2つ目の<code id="message-channels:messageport-5"><a href="#messageport">MessagePort</a></code>オブジェクトを返す。</dl>

  

  <p>A <code id="message-channels:messagechannel-2"><a href="#messagechannel">MessageChannel</a></code> object has an associated <dfn id="port-1">port 1</dfn> and an associated <dfn id="port-2">port 2</dfn>, both <code id="message-channels:messageport-6"><a href="#messageport">MessagePort</a></code> objects.</p>

  <div data-algorithm=""><p>The <dfn id="dom-messagechannel"><code>new MessageChannel()</code></dfn> constructor steps are:</p>

  <ol><li><p>Set <a id="message-channels:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-1" id="message-channels:port-1">port 1</a> to a <a id="message-channels:new" href="https://triple-underscore.github.io/WebIDL-JS-ja.html#new" data-x-internal="new">new</a> <code id="message-channels:messageport-7"><a href="#messageport">MessagePort</a></code> in <a id="message-channels:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="webappapis.html#concept-relevant-realm" id="message-channels:concept-relevant-realm">relevant realm</a>.<li><p>Set <a id="message-channels:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-2" id="message-channels:port-2">port 2</a> to a <a id="message-channels:new-2" href="https://triple-underscore.github.io/WebIDL-JS-ja.html#new" data-x-internal="new">new</a> <code id="message-channels:messageport-8"><a href="#messageport">MessagePort</a></code> in <a id="message-channels:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="webappapis.html#concept-relevant-realm" id="message-channels:concept-relevant-realm-2">relevant realm</a>.<li><p><a href="#entangle" id="message-channels:entangle">Entangle</a> <a id="message-channels:this-5" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-1" id="message-channels:port-1-2">port 1</a> and <a id="message-channels:this-6" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-2" id="message-channels:port-2-2">port 2</a>.</ol>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessageChannel" id="dom-messagechannel-port1" data-dfn-type="attribute"><code>port1</code></dfn> getter steps are to return <a id="message-channels:this-7" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-1" id="message-channels:port-1-3">port 1</a>.</p>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessageChannel" id="dom-messagechannel-port2" data-dfn-type="attribute"><code>port2</code></dfn> getter steps are to return <a id="message-channels:this-8" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-2" id="message-channels:port-2-3">port 2</a>.</p>
  </div>

  

  <h4 id="the-messageeventtarget-mixin"><span class="secno">9.4.3</span> <span id="the-messageeventtarget-abstract-interface"></span><code id="the-messageeventtarget-mixin:messageeventtarget"><a href="#messageeventtarget">MessageEventTarget</a></code>ミックスイン<a href="#the-messageeventtarget-mixin" class="self-link"></a></h4>
  

  <pre><code class='idl'><c- b>interface</c-> <c- b>mixin</c-> <dfn id='messageeventtarget' data-dfn-type='interface'><c- g>MessageEventTarget</c-></dfn> {
  <c- b>attribute</c-> <a id='the-messageeventtarget-mixin:eventhandler' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-messageeventtarget-onmessage' id='the-messageeventtarget-mixin:handler-messageeventtarget-onmessage'><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a id='the-messageeventtarget-mixin:eventhandler-2' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-messageeventtarget-onmessageerror' id='the-messageeventtarget-mixin:handler-messageeventtarget-onmessageerror'><c- g>onmessageerror</c-></a>;
};</code></pre>

   <p>以下は、<code id="the-messageeventtarget-mixin:messageeventtarget-2"><a href="#messageeventtarget">MessageEventTarget</a></code>インターフェイスを実装するすべてのオブジェクトによって、<a id="the-messageeventtarget-mixin:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">イベントハンドラーIDL属性</a>として、サポートされる<a id="the-messageeventtarget-mixin:event-handlers" href="webappapis.html#event-handlers">イベントハンドラー</a>（および対応する<a href="webappapis.html#event-handler-event-type" id="the-messageeventtarget-mixin:event-handler-event-type">イベントハンドラーイベント型</a>）である：</p>

   <table><thead><tr><th><a href="webappapis.html#event-handlers" id="the-messageeventtarget-mixin:event-handlers-2">イベントハンドラー</a><th><a id="the-messageeventtarget-mixin:event-handler-event-type-2" href="webappapis.html#event-handler-event-type">イベントハンドラーイベント型</a><tbody><tr><td><span id="handler-messageport-onmessage"></span><span id="handler-worker-onmessage"></span><span id="handler-dedicatedworkerglobalscope-onmessage"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessage" data-dfn-type="attribute"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/message_event" title="The message event is fired on a MessagePort object when a message arrives on that channel.">MessagePort/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/message_event" title="The message event is fired on a DedicatedWorkerGlobalScope object when the worker receives a message from its parent (i.e. when the parent sends a message using Worker.postMessage()).">DedicatedWorkerGlobalScope/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div></div><td><code id="the-messageeventtarget-mixin:event-message"><a href="indices.html#event-message">message</a></code><tr><td><span id="handler-messageport-onmessageerror"></span><span id="handler-worker-onmessageerror"></span><span id="handler-dedicatedworkerglobalscope-onmessageerror"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessageerror" data-dfn-type="attribute"><code>onmessageerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/messageerror_event" title="The messageerror event is fired on a MessagePort object when it receives a message that can&apos;t be deserialized.">MessagePort/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/messageerror_event" title="The messageerror event is fired on a DedicatedWorkerGlobalScope object when it receives a message that can&apos;t be deserialized.">DedicatedWorkerGlobalScope/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><td><code id="the-messageeventtarget-mixin:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code></table>

  <h4 id="message-ports"><span class="secno">9.4.4</span> メッセージポート<a href="#message-ports" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" title="The MessagePort interface of the Channel Messaging API represents one of the two ports of a MessageChannel, allowing messages to be sent from one port and listening out for them arriving at the other.">MessagePort</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <p>各チャネルには2つのメッセージポートがある。一方のポートから送信されたデータはもう一方のポートで受信され、その逆も同様である。</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->,<c- n>AudioWorklet</c->), <a id='message-ports:transferable' href='structured-data.html#transferable'><c- g>Transferable</c-></a>]
<c- b>interface</c-> <dfn id='messageport' data-dfn-type='interface'><c- g>MessagePort</c-></dfn> : <a id='message-ports:eventtarget' href='https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget' data-x-internal='eventtarget'><c- n>EventTarget</c-></a> {
  <c- b>undefined</c-> <a href='#dom-messageport-postmessage' id='message-ports:dom-messageport-postmessage'><c- g>postMessage</c-></a>(<c- b>any</c-> <c- g>message</c->, <c- b>sequence</c->&lt;<a href='https://triple-underscore.github.io/WebIDL-ja.html#idl-object' id='message-ports:idl-object' data-x-internal='idl-object'><c- b>object</c-></a>> <c- g>transfer</c->);
  <c- b>undefined</c-> <a href='#dom-messageport-postmessage-options' id='message-ports:dom-messageport-postmessage-options'><c- g>postMessage</c-></a>(<c- b>any</c-> <c- g>message</c->, <c- b>optional</c-> <a href='#structuredserializeoptions' id='message-ports:structuredserializeoptions'><c- n>StructuredSerializeOptions</c-></a> <c- g>options</c-> = {});
  <c- b>undefined</c-> <a href='#dom-messageport-start' id='message-ports:dom-messageport-start'><c- g>start</c-></a>();
  <c- b>undefined</c-> <a href='#dom-messageport-close' id='message-ports:dom-messageport-close'><c- g>close</c-></a>();

  // event handlers
  <c- b>attribute</c-> <a id='message-ports:eventhandler' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-messageport-onclose' id='message-ports:handler-messageport-onclose'><c- g>onclose</c-></a>;
};

<a href='#messageport' id='message-ports:messageport'><c- n>MessagePort</c-></a> <c- b>includes</c-> <a href='#messageeventtarget' id='message-ports:messageeventtarget'><c- n>MessageEventTarget</c-></a>;

<c- b>dictionary</c-> <dfn id='structuredserializeoptions' data-dfn-type='dictionary'><c- g>StructuredSerializeOptions</c-></dfn> {
  <c- b>sequence</c->&lt;<a href='https://triple-underscore.github.io/WebIDL-ja.html#idl-object' id='message-ports:idl-object-2' data-x-internal='idl-object'><c- b>object</c-></a>> <dfn data-dfn-for='StructuredSerializeOptions' id='dom-structuredserializeoptions-transfer' data-dfn-type='dict-member'><c- g>transfer</c-></dfn> = [];
};</code></pre>

  <dl class="domintro"><dt><code><var>port</var>.<a href="#dom-messageport-postmessage" id="dom-messageport-postmessage-dev">postMessage</a>(<var>message</var> [, <var>transfer</var>])</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/postMessage" title="The postMessage() method of the MessagePort interface sends a message from the port, and optionally, transfers ownership of objects to other browsing contexts.">MessagePort/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dt><code><var>port</var>.<a href="#dom-messageport-postmessage-options" id="dom-messageport-postmessage-options-dev">postMessage</a>(<var>message</var> [, { <span>transfer</span> }])</code><dd><p>チャンネルを通じてメッセージをポストする。Objects listed in <var>transfer</var>にリストされたオブジェクトは、単に複製されるのではなく転送される。つまり、送信側では使用できなくなる。</p>

    <p><var>transfer</var>が重複するオブジェクトもしくは<var>port</var>を含む場合、または<var>message</var>を複製できなかった場合、<a id="message-ports:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="message-ports:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を投げる。</p>
   <dt><code><var>port</var>.<a href="#dom-messageport-start" id="dom-messageport-start-dev">start</a>()</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/start" title="The start() method of the MessagePort interface starts the sending of messages queued on the port. This method is only needed when using EventTarget.addEventListener; it is implied when using onmessage.">MessagePort/start</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd><p>ポートで受信したメッセージの発送を開始する。<dt><code><var>port</var>.<a href="#dom-messageport-close" id="dom-messageport-close-dev">close</a>()</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/close" title="The close() method of the MessagePort interface disconnects the port, so it is no longer active. This stops the flow of messages to that port.">MessagePort/close</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><dd><p>ポートを切断し、アクティブでなくなる。</dl>

  

  <p>Each <code id="message-ports:messageport-2"><a href="#messageport">MessagePort</a></code> object has a <dfn id="message-event-target">message event target</dfn> (a <code id="message-ports:messageeventtarget-2"><a href="#messageeventtarget">MessageEventTarget</a></code>), to which the <code id="message-ports:event-message"><a href="indices.html#event-message">message</a></code> and <code id="message-ports:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code> events are dispatched. Unless otherwise specified, it defaults to the <code id="message-ports:messageport-3"><a href="#messageport">MessagePort</a></code> object itself.</p>

  <p>Each <code id="message-ports:messageport-4"><a href="#messageport">MessagePort</a></code> object can be entangled with another (a symmetric relationship). Each <code id="message-ports:messageport-5"><a href="#messageport">MessagePort</a></code> object also has a <a id="message-ports:task-source" href="webappapis.html#task-source">task source</a> called the <dfn id="port-message-queue">port message queue</dfn>, initially empty. A <a href="#port-message-queue" id="message-ports:port-message-queue">port message queue</a> can be enabled or disabled, and is initially disabled. Once enabled, a port can never be disabled again (though messages in the queue can get moved to another queue or removed altogether, which has much the same effect). A <code id="message-ports:messageport-6"><a href="#messageport">MessagePort</a></code> also has a <dfn id="has-been-shipped">has been shipped</dfn> flag, which must initially be false.</p>

  <div data-algorithm=""><p>When a port's <a href="#port-message-queue" id="message-ports:port-message-queue-2">port message queue</a> is enabled, the <a id="message-ports:event-loop" href="webappapis.html#event-loop">event loop</a> must use it as one of its <a href="webappapis.html#task-source" id="message-ports:task-source-2">task sources</a>. When a port's <a id="message-ports:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> is a <code id="message-ports:window"><a href="nav-history-apis.html#window">Window</a></code>, all <a href="webappapis.html#concept-task" id="message-ports:concept-task">tasks</a> <a href="webappapis.html#queue-a-task" id="message-ports:queue-a-task">queued</a> on its <a href="#port-message-queue" id="message-ports:port-message-queue-3">port message queue</a> must be associated with the port's <a id="message-ports:concept-relevant-global-2" href="webappapis.html#concept-relevant-global">relevant global object</a>'s <a href="nav-history-apis.html#concept-document-window" id="message-ports:concept-document-window">associated <code>Document</code></a>.</p>
  </div>

  <p class="note">If the document is <a id="message-ports:fully-active" href="document-sequences.html#fully-active">fully active</a>, but the event listeners were all created in the context of documents that are <em>not</em> <a id="message-ports:fully-active-2" href="document-sequences.html#fully-active">fully active</a>, then the messages will not be received unless and until the documents become <a id="message-ports:fully-active-3" href="document-sequences.html#fully-active">fully active</a> again.</p>

  <div data-algorithm=""><p>Each <a id="message-ports:event-loop-2" href="webappapis.html#event-loop">event loop</a> has a <a id="message-ports:task-source-3" href="webappapis.html#task-source">task source</a> called the <dfn id="unshipped-port-message-queue">unshipped port message queue</dfn>. This is a virtual <a id="message-ports:task-source-4" href="webappapis.html#task-source">task source</a>: it must act as if it contained the <a href="webappapis.html#concept-task" id="message-ports:concept-task-2">tasks</a> of each <a href="#port-message-queue" id="message-ports:port-message-queue-4">port message queue</a> of each <code id="message-ports:messageport-7"><a href="#messageport">MessagePort</a></code> whose <a href="#has-been-shipped" id="message-ports:has-been-shipped">has been shipped</a> flag is false, whose <a href="#port-message-queue" id="message-ports:port-message-queue-5">port message queue</a> is enabled, and whose <a id="message-ports:relevant-agent" href="webappapis.html#relevant-agent">relevant agent</a>'s <a href="webappapis.html#concept-agent-event-loop" id="message-ports:concept-agent-event-loop">event loop</a> is that <a id="message-ports:event-loop-3" href="webappapis.html#event-loop">event loop</a>, in the order in which they were added to their respective <a id="message-ports:task-source-5" href="webappapis.html#task-source">task source</a>. When a <a href="webappapis.html#concept-task" id="message-ports:concept-task-3">task</a> would be removed from the <a href="#unshipped-port-message-queue" id="message-ports:unshipped-port-message-queue">unshipped port message queue</a>, it must instead be removed from its <a href="#port-message-queue" id="message-ports:port-message-queue-6">port message queue</a>.</p>
  </div>

  <div data-algorithm=""><p>When a <code id="message-ports:messageport-8"><a href="#messageport">MessagePort</a></code>'s <a href="#has-been-shipped" id="message-ports:has-been-shipped-2">has been shipped</a> flag is false, its <a href="#port-message-queue" id="message-ports:port-message-queue-7">port message queue</a> must be ignored for the purposes of the <a id="message-ports:event-loop-4" href="webappapis.html#event-loop">event loop</a>. (The <a href="#unshipped-port-message-queue" id="message-ports:unshipped-port-message-queue-2">unshipped port message queue</a> is used instead.)</p>
  </div>

  <p class="note">The <a href="#has-been-shipped" id="message-ports:has-been-shipped-3">has been shipped</a> flag is set to true when a port, its twin, or the object it was cloned from, is or has been transferred. When a <code id="message-ports:messageport-9"><a href="#messageport">MessagePort</a></code>'s <a href="#has-been-shipped" id="message-ports:has-been-shipped-4">has been shipped</a> flag is true, its <a href="#port-message-queue" id="message-ports:port-message-queue-8">port message queue</a> acts as a first-class <a id="message-ports:task-source-6" href="webappapis.html#task-source">task source</a>, unaffected to any <a href="#unshipped-port-message-queue" id="message-ports:unshipped-port-message-queue-3">unshipped port message queue</a>.</p>

  <div data-algorithm=""><p>When the user agent is to <dfn id="entangle">entangle</dfn> two <code id="message-ports:messageport-10"><a href="#messageport">MessagePort</a></code> objects, it must run the following steps:</p>

  <ol><li><p>If one of the ports is already entangled, then disentangle it and the port that it was entangled with.</p>

    <p class="note">If those two previously entangled ports were the two ports of a <code id="message-ports:messagechannel"><a href="#messagechannel">MessageChannel</a></code> object, then that <code id="message-ports:messagechannel-2"><a href="#messagechannel">MessageChannel</a></code> object no longer represents an actual channel: the two ports in that object are no longer entangled.</p>
   <li><p>Associate the two ports to be entangled, so that they form the two parts of a new channel. (There is no <code id="message-ports:messagechannel-3"><a href="#messagechannel">MessageChannel</a></code> object that represents this channel.)</p>

    <p>Two ports <var>A</var> and <var>B</var> that have gone through this step are now said to be entangled; one is entangled to the other, and vice versa.</p>

    <p class="note">While this specification describes this process as instantaneous, implementations are more likely to implement it via message passing. As with all algorithms, the key is "merely" that the end result be indistinguishable, in a black-box sense, from the specification.</p>
   </ol>
  </div>

  <div data-algorithm=""><p>The <dfn id="disentangle">disentangle</dfn> steps, given a <code id="message-ports:messageport-11"><a href="#messageport">MessagePort</a></code> <var>initiatorPort</var> which initiates disentangling, are as follows:</p>

  <ol><li><p>Let <var>otherPort</var> be the <code id="message-ports:messageport-12"><a href="#messageport">MessagePort</a></code> which <var>initiatorPort</var> was entangled with.<li><p><a id="message-ports:assert" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>otherPort</var> exists.<li><p>Disentangle <var>initiatorPort</var> and <var>otherPort</var>, so that they are no longer entangled or associated with each other.<li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="message-ports:concept-event-fire" data-x-internal="concept-event-fire">Fire an event</a> named <code id="message-ports:event-close"><a href="indices.html#event-close">close</a></code> at <var>otherPort</var>.</ol>

  <div class="note"><p>The <code id="message-ports:event-close-2"><a href="indices.html#event-close">close</a></code> event will be fired even if the port is not explicitly closed. The cases where this event is dispatched are:</p>

   <ul><li>the <code id="message-ports:dom-messageport-close-2"><a href="#dom-messageport-close">close()</a></code> method was called;<li>the <code id="message-ports:document"><a href="dom.html#document">Document</a></code> was <a href="document-lifecycle.html#destroy-a-document" id="message-ports:destroy-a-document">destroyed</a>; or<li>the <code id="message-ports:messageport-13"><a href="#messageport">MessagePort</a></code> was <a href="#ports-and-garbage-collection">garbage collected</a>.</ul>

   <p>We only dispatch the event on <var>otherPort</var> because <var>initiatorPort</var> explicitly triggered the close, its <code id="message-ports:document-2"><a href="dom.html#document">Document</a></code> no longer exists, or it was already garbage collected, as described above.</p>
  </div>
  </div>

  <hr>

  <div data-algorithm=""><p id="transferMessagePort"><code id="message-ports:messageport-14"><a href="#messageport">MessagePort</a></code> objects are <a id="message-ports:transferable-objects" href="structured-data.html#transferable-objects">transferable objects</a>. Their <a id="message-ports:transfer-steps" href="structured-data.html#transfer-steps">transfer steps</a>, given <var>value</var> and <var>dataHolder</var>, are:</p>

  <ol><li><p>Set <var>value</var>'s <a href="#has-been-shipped" id="message-ports:has-been-shipped-5">has been shipped</a> flag to true.<li><p>Set <var>dataHolder</var>.[[PortMessageQueue]] to <var>value</var>'s <a href="#port-message-queue" id="message-ports:port-message-queue-9">port message queue</a>.<li><p>If <var>value</var> is entangled with another port <var>remotePort</var>, then:</p>

    <ol><li><p>Set <var>remotePort</var>'s <a href="#has-been-shipped" id="message-ports:has-been-shipped-6">has been shipped</a> flag to true.<li><p>Set <var>dataHolder</var>.[[RemotePort]] to <var>remotePort</var>.</ol>
   <li><p>Otherwise, set <var>dataHolder</var>.[[RemotePort]] to null.</ol>
  </div>

  <div data-algorithm=""><p>Their <a id="message-ports:transfer-receiving-steps" href="structured-data.html#transfer-receiving-steps">transfer-receiving steps</a>, given <var>dataHolder</var> and <var>value</var>, are:</p>

  <ol><li><p>Set <var>value</var>'s <a href="#has-been-shipped" id="message-ports:has-been-shipped-7">has been shipped</a> flag to true.<li><p>Move all the <a href="webappapis.html#concept-task" id="message-ports:concept-task-4">tasks</a> that are to fire <code id="message-ports:event-message-2"><a href="indices.html#event-message">message</a></code> events in <var>dataHolder</var>.[[PortMessageQueue]] to the <a href="#port-message-queue" id="message-ports:port-message-queue-10">port message queue</a> of <var>value</var>, if any, leaving <var>value</var>'s <a href="#port-message-queue" id="message-ports:port-message-queue-11">port message queue</a> in its initial disabled state, and, if <var>value</var>'s <a id="message-ports:concept-relevant-global-3" href="webappapis.html#concept-relevant-global">relevant global object</a> is a <code id="message-ports:window-2"><a href="nav-history-apis.html#window">Window</a></code>, associating the moved <a href="webappapis.html#concept-task" id="message-ports:concept-task-5">tasks</a> with <var>value</var>'s <a id="message-ports:concept-relevant-global-4" href="webappapis.html#concept-relevant-global">relevant global object</a>'s <a href="nav-history-apis.html#concept-document-window" id="message-ports:concept-document-window-2">associated <code>Document</code></a>.<li><p>If <var>dataHolder</var>.[[RemotePort]] is not null, then <a href="#entangle" id="message-ports:entangle">entangle</a> <var>dataHolder</var>.[[RemotePort]] and <var>value</var>. (This will disentangle <var>dataHolder</var>.[[RemotePort]] from the original port that was transferred.)</ol>
  </div>

  <hr>

  <div data-algorithm=""><p>The <dfn id="message-port-post-message-steps">message port post message steps</dfn>, given <var>sourcePort</var>, <var>targetPort</var>, <var>message</var>, and <var>options</var> are as follows:</p>

  <ol><li><p>Let <var>transfer</var> be <var>options</var>["<code id="message-ports:dom-structuredserializeoptions-transfer"><a href="#dom-structuredserializeoptions-transfer">transfer</a></code>"].<li><p>If <var>transfer</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="message-ports:list-contains" data-x-internal="list-contains">contains</a> <var>sourcePort</var>, then throw a <a id="message-ports:datacloneerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="message-ports:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>doomed</var> be false.<li><p>If <var>targetPort</var> is not null and <var>transfer</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="message-ports:list-contains-2" data-x-internal="list-contains">contains</a> <var>targetPort</var>, then set <var>doomed</var> to true and optionally report to a developer console that the target port was posted to itself, causing the communication channel to be lost.<li><p>Let <var>serializeWithTransferResult</var> be <a id="message-ports:structuredserializewithtransfer" href="structured-data.html#structuredserializewithtransfer">StructuredSerializeWithTransfer</a>(<var>message</var>, <var>transfer</var>). 例外を再度投げる。<li><p>If <var>targetPort</var> is null, or if <var>doomed</var> is true, then return.<li><p>Add a <a href="webappapis.html#concept-task" id="message-ports:concept-task-6">task</a> that runs the following steps to the <a href="#port-message-queue" id="message-ports:port-message-queue-12">port message queue</a> of <var>targetPort</var>:</p>

    <ol><li><p>Let <var>finalTargetPort</var> be the <code id="message-ports:messageport-15"><a href="#messageport">MessagePort</a></code> in whose <a href="#port-message-queue" id="message-ports:port-message-queue-13">port message queue</a> the task now finds itself.</p>

      <p class="note">This can be different from <var>targetPort</var>, if <var>targetPort</var> itself was transferred and thus all its tasks moved along with it.</p>
     <li><p>Let <var>messageEventTarget</var> be <var>finalTargetPort</var>'s <a href="#message-event-target" id="message-ports:message-event-target">message event target</a>.<li><p>Let <var>targetRealm</var> be <var>finalTargetPort</var>'s <a href="webappapis.html#concept-relevant-realm" id="message-ports:concept-relevant-realm">relevant realm</a>.<li><p>Let <var>deserializeRecord</var> be <a id="message-ports:structureddeserializewithtransfer" href="structured-data.html#structureddeserializewithtransfer">StructuredDeserializeWithTransfer</a>(<var>serializeWithTransferResult</var>, <var>targetRealm</var>).</p>

      <p>If this throws an exception, catch it, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="message-ports:concept-event-fire-2" data-x-internal="concept-event-fire">fire an event</a> named <code id="message-ports:event-messageerror-2"><a href="indices.html#event-messageerror">messageerror</a></code> at <var>messageEventTarget</var>, using <code id="message-ports:messageevent"><a href="comms.html#messageevent">MessageEvent</a></code>, and then return.<li><p>Let <var>messageClone</var> be <var>deserializeRecord</var>.[[Deserialized]].<li><p>Let <var>newPorts</var> be a new <a id="message-ports:frozen-array" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-frozen-array-type" data-x-internal="frozen-array">frozen array</a> consisting of all <code id="message-ports:messageport-16"><a href="#messageport">MessagePort</a></code> objects in <var>deserializeRecord</var>.[[TransferredValues]], if any, maintaining their relative order.<li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="message-ports:concept-event-fire-3" data-x-internal="concept-event-fire">Fire an event</a> named <code id="message-ports:event-message-3"><a href="indices.html#event-message">message</a></code> at <var>messageEventTarget</var>, using <code id="message-ports:messageevent-2"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="message-ports:dom-messageevent-data"><a href="comms.html#dom-messageevent-data">data</a></code> attribute initialized to <var>messageClone</var> and the <code id="message-ports:dom-messageevent-ports"><a href="comms.html#dom-messageevent-ports">ports</a></code> attribute initialized to <var>newPorts</var>.</ol>
   </ol>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessagePort" id="dom-messageport-postmessage-options" data-dfn-type="method"><code>postMessage(<var>message</var>, <var>options</var>)</code></dfn> method steps are:</p>

  <ol><li><p>Let <var>targetPort</var> be the port with which <a id="message-ports:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is entangled, if any; otherwise let it be null.<li><p>Run the <a href="#message-port-post-message-steps" id="message-ports:message-port-post-message-steps">message port post message steps</a> providing <a id="message-ports:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>, <var>targetPort</var>, <var>message</var> and <var>options</var>.</ol>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessagePort" id="dom-messageport-postmessage" data-dfn-type="method"><code>postMessage(<var>message</var>, <var>transfer</var>)</code></dfn> method steps are:</p>

  <ol><li><p>Let <var>targetPort</var> be the port with which <a id="message-ports:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is entangled, if any; otherwise let it be null.<li><p>Let <var>options</var> be «[ "<code id="message-ports:dom-structuredserializeoptions-transfer-2"><a href="#dom-structuredserializeoptions-transfer">transfer</a></code>" → <var>transfer</var> ]».<li><p>Run the <a href="#message-port-post-message-steps" id="message-ports:message-port-post-message-steps-2">message port post message steps</a> providing <a id="message-ports:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>, <var>targetPort</var>, <var>message</var> and <var>options</var>.</ol>
  </div>

  <hr>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessagePort" id="dom-messageport-start" data-dfn-type="method"><code>start()</code></dfn> method steps are to enable <a id="message-ports:this-5" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#port-message-queue" id="message-ports:port-message-queue-14">port message queue</a>, if it is not already enabled.</p>
  </div>

  <hr>

  <div data-algorithm=""><p>The <dfn data-dfn-for="MessagePort" id="dom-messageport-close" data-dfn-type="method"><code>close()</code></dfn> method steps are:</p>

  <ol><li><p>Set <a id="message-ports:this-6" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="message-ports:detached" href="structured-data.html#detached">[[Detached]]</a> internal slot value to true.<li><p>If <a id="message-ports:this-7" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is entangled, <a href="#disentangle" id="message-ports:disentangle">disentangle</a> it.</ol>
  </div>

  <hr>

  <p>The following are the <a id="message-ports:event-handlers" href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <a href="webappapis.html#event-handler-event-type" id="message-ports:event-handler-event-type">event handler event types</a>) that must be supported, as <a id="message-ports:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the <code id="message-ports:messageport-17"><a href="#messageport">MessagePort</a></code> interface:</p>

  <table><thead><tr><th><a href="webappapis.html#event-handlers" id="message-ports:event-handlers-2">イベントハンドラー</a><th><a id="message-ports:event-handler-event-type-2" href="webappapis.html#event-handler-event-type">イベントハンドラーイベント型</a><tbody><tr><td><dfn data-dfn-for="MessagePort" id="handler-messageport-onclose" data-dfn-type="attribute"><code>onclose</code></dfn><td><code id="message-ports:event-close-3"><a href="indices.html#event-close">close</a></code></table>

  <div data-algorithm=""><p>The first time a <code id="message-ports:messageport-18"><a href="#messageport">MessagePort</a></code> object's <code id="message-ports:handler-messageeventtarget-onmessage"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code> IDL attribute is set, the port's <a href="#port-message-queue" id="message-ports:port-message-queue-15">port message queue</a> must be enabled, as if the <code id="message-ports:dom-messageport-start-2"><a href="#dom-messageport-start">start()</a></code> method had been called.</p>
  </div>

  


  <h4 id="ports-and-garbage-collection"><span class="secno">9.4.5</span> ポートおよびガベージコレクション<a href="#ports-and-garbage-collection" class="self-link"></a></h4>

  
  <div data-algorithm=""><p>When a <code id="ports-and-garbage-collection:messageport"><a href="#messageport">MessagePort</a></code> object <var>o</var> is garbage collected, if <var>o</var> is entangled, then the user agent must <a href="#disentangle" id="ports-and-garbage-collection:disentangle">disentangle</a> <var>o</var>.</p>
  </div>

  <div data-algorithm=""><p>When a <code id="ports-and-garbage-collection:messageport-2"><a href="#messageport">MessagePort</a></code> object <var>o</var> is entangled and <code id="ports-and-garbage-collection:event-message"><a href="indices.html#event-message">message</a></code> or <code id="ports-and-garbage-collection:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code> event listener is registered, user agents must act as if <var>o</var>'s entangled <code id="ports-and-garbage-collection:messageport-3"><a href="#messageport">MessagePort</a></code> object has a strong reference to <var>o</var>.</p>
  </div>

  <p>Furthermore, a <code id="ports-and-garbage-collection:messageport-4"><a href="#messageport">MessagePort</a></code> object must not be garbage collected while there exists an event referenced by a <a href="webappapis.html#concept-task" id="ports-and-garbage-collection:concept-task">task</a> in a <a id="ports-and-garbage-collection:task-queue" href="webappapis.html#task-queue">task queue</a> that is to be dispatched on that <code id="ports-and-garbage-collection:messageport-5"><a href="#messageport">MessagePort</a></code> object, or while the <code id="ports-and-garbage-collection:messageport-6"><a href="#messageport">MessagePort</a></code> object's <a href="#port-message-queue" id="ports-and-garbage-collection:port-message-queue">port message queue</a> is enabled and not empty.</p>
  

  

  <div class="note"><p>Thus, a message port can be received, given an event listener, and then forgotten, and so long as that event listener could receive a message, the channel will be maintained.</p>

   <p>Of course, if this was to occur on both sides of the channel, then both ports could be garbage collected, since they would not be reachable from live code, despite having a strong reference to each other. However, if a message port has a pending message, it is not garbage collected.</p>

  </div>

  

  <p class="note">著者は、リソースを再収集できるように、<code id="ports-and-garbage-collection:messageport-7"><a href="#messageport">MessagePort</a></code>オブジェクトを明示的に閉じて、それらを分離することを強く勧める。多くの<code id="ports-and-garbage-collection:messageport-8"><a href="#messageport">MessagePort</a></code>オブジェクトを作成し、それらを閉じずに破棄すると、ガベージコレクションが必ずしも迅速に実行されるとは限らないため、一時的にメモリーの使用率が高くなる可能性がある。特に、ガベージコレクションにプロセス間の調整が含まれる<code id="ports-and-garbage-collection:messageport-9"><a href="#messageport">MessagePort</a></code>の場合はそうなる。</p>



  <h3 id="broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> <dfn>他のブラウジングコンテキストへのブロードキャスト</dfn><a href="#broadcasting-to-other-browsing-contexts" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" title="The BroadcastChannel interface represents a named channel that any browsing context of a given origin can subscribe to. It allows communication between different documents (in different windows, tabs, frames or iframes) of the same origin. Messages are broadcasted via a message event fired at all BroadcastChannel objects listening to the channel, except the object that sent the message.">BroadcastChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" title="The Broadcast Channel API allows basic communication between browsing contexts (that is, windows, tabs, frames, or iframes) and workers on the same origin.">Broadcast_Channel_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  <p>同じユーザーエージェント内の同じユーザーによって開かれたが、異なる関連のない<a href="document-sequences.html#browsing-context" id="broadcasting-to-other-browsing-contexts:browsing-context">ブラウジングコンテキスト</a>の単一の<a id="broadcasting-to-other-browsing-contexts:concept-origin" href="browsers.html#concept-origin">生成元</a>上のページは、時には互いに通知を送信する必要がある。例えば、「ユーザーはここにログインしました、あなたの認証情報をもう一度確認してください」。</p>

  <p>共有状態のロックの管理、サーバーと複数のローカルクライアント間のリソースの同期の管理、リモートホストとの<code id="broadcasting-to-other-browsing-contexts:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code>接続の共有など、複雑なケースでは、<a href="workers.html#sharedworker" id="broadcasting-to-other-browsing-contexts:sharedworker">共有ワーカー</a>が最も適切なソリューションである。</p>

  <p>しかし、共有ワーカーが過度のオーバーヘッドとなるような単純な場合には、著者はこのセクションで説明する単純なチャンネルベースのブロードキャストメカニズムを使用することができる。</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='broadcastchannel' data-dfn-type='interface'><c- g>BroadcastChannel</c-></dfn> : <a id='broadcasting-to-other-browsing-contexts:eventtarget' href='https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget' data-x-internal='eventtarget'><c- n>EventTarget</c-></a> {
  <a href='#dom-broadcastchannel' id='broadcasting-to-other-browsing-contexts:dom-broadcastchannel'><c- g>constructor</c-></a>(<c- b>DOMString</c-> <c- g>name</c->);

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-broadcastchannel-name' id='broadcasting-to-other-browsing-contexts:dom-broadcastchannel-name'><c- g>name</c-></a>;
  <c- b>undefined</c-> <a href='#dom-broadcastchannel-postmessage' id='broadcasting-to-other-browsing-contexts:dom-broadcastchannel-postmessage'><c- g>postMessage</c-></a>(<c- b>any</c-> <c- g>message</c->);
  <c- b>undefined</c-> <a href='#dom-broadcastchannel-close' id='broadcasting-to-other-browsing-contexts:dom-broadcastchannel-close'><c- g>close</c-></a>();
  <c- b>attribute</c-> <a id='broadcasting-to-other-browsing-contexts:eventhandler' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-broadcastchannel-onmessage' id='broadcasting-to-other-browsing-contexts:handler-broadcastchannel-onmessage'><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a id='broadcasting-to-other-browsing-contexts:eventhandler-2' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-broadcastchannel-onmessageerror' id='broadcasting-to-other-browsing-contexts:handler-broadcastchannel-onmessageerror'><c- g>onmessageerror</c-></a>;
};</code></pre>

  <dl class="domintro"><dt><code><var>broadcastChannel</var> = new <a href="#dom-broadcastchannel" id="dom-broadcastchannel-dev">BroadcastChannel</a>(<var>name</var>)</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/BroadcastChannel" title="The BroadcastChannel() constructor creates a new BroadcastChannel and connects it to the underlying channel.">BroadcastChannel/BroadcastChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>指定されたチャンネル名のメッセージを送受信できる新しい<code id="broadcasting-to-other-browsing-contexts:broadcastchannel"><a href="#broadcastchannel">BroadcastChannel</a></code>オブジェクトを返す。</p>
   <dt><code><var>broadcastChannel</var>.<a href="#dom-broadcastchannel-name" id="dom-broadcastchannel-name-dev">name</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/name" title="The read-only BroadcastChannel.name property returns a string, which uniquely identifies the given channel with its name. This name is passed to the BroadcastChannel() constructor at creation time and is therefore read-only.">BroadcastChannel/name</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>（コンストラクターに渡された）チャンネル名を返す。<dt><code><var>broadcastChannel</var>.<a href="#dom-broadcastchannel-postmessage" id="dom-broadcastchannel-postmessage-dev">postMessage</a>(<var>message</var>)</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/postMessage" title="The BroadcastChannel.postMessage() sends a message, which can be of any kind of Object, to each listener in any browsing context with the same origin. The message is transmitted as a &apos;message&apos; event targeted at each BroadcastChannel bound to the channel.">BroadcastChannel/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>指定されたメッセージを、このチャンネルに設定されている他の<code id="broadcasting-to-other-browsing-contexts:broadcastchannel-2"><a href="#broadcastchannel">BroadcastChannel</a></code>オブジェクトに送信する。メッセージは、ネストされたオブジェクトや配列などの構造化オブジェクトにすることができる。</p>
   <dt><code><var>broadcastChannel</var>.<a href="#dom-broadcastchannel-close" id="dom-broadcastchannel-close-dev">close</a>()</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/close" title="The BroadcastChannel.close() terminates the connection to the underlying channel, allowing the object to be garbage collected. This is a necessary step to perform as there is no other way for a browser to know that this channel is not needed anymore.">BroadcastChannel/close</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p><code id="broadcasting-to-other-browsing-contexts:broadcastchannel-3"><a href="#broadcastchannel">BroadcastChannel</a></code>オブジェクトを閉じ、ガベージコレクションに対して開く。</dl>

  

  <p>A <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-4"><a href="#broadcastchannel">BroadcastChannel</a></code> object has a <dfn id="channel-name">channel name</dfn> and a <dfn id="concept-broadcastchannel-closed">closed flag</dfn>.</p>

  <div data-algorithm=""><p>The <dfn id="dom-broadcastchannel"><code>new BroadcastChannel(<var>name</var>)</code></dfn> constructor steps are:</p>

  <ol><li><p>Set <a id="broadcasting-to-other-browsing-contexts:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#channel-name" id="broadcasting-to-other-browsing-contexts:channel-name">channel name</a> to <var>name</var>.<li><p>Set <a id="broadcasting-to-other-browsing-contexts:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-broadcastchannel-closed" id="broadcasting-to-other-browsing-contexts:concept-broadcastchannel-closed">closed flag</a> to false.</ol>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="BroadcastChannel" id="dom-broadcastchannel-name" data-dfn-type="attribute"><code>name</code></dfn> getter steps are to return <a id="broadcasting-to-other-browsing-contexts:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#channel-name" id="broadcasting-to-other-browsing-contexts:channel-name-2">channel name</a>.</p>
  </div>

  <div data-algorithm=""><p>A <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-5"><a href="#broadcastchannel">BroadcastChannel</a></code> object is said to be <dfn id="eligible-for-messaging">eligible for messaging</dfn> when its <a id="broadcasting-to-other-browsing-contexts:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> is either:</p>

  <ul><li><p>a <code id="broadcasting-to-other-browsing-contexts:window"><a href="nav-history-apis.html#window">Window</a></code> object whose <a href="nav-history-apis.html#concept-document-window" id="broadcasting-to-other-browsing-contexts:concept-document-window">associated <code>Document</code></a> is <a id="broadcasting-to-other-browsing-contexts:fully-active" href="document-sequences.html#fully-active">fully active</a>, or<li><p>a <code id="broadcasting-to-other-browsing-contexts:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> object whose <a href="workers.html#dom-workerglobalscope-closing" id="broadcasting-to-other-browsing-contexts:dom-workerglobalscope-closing">closing</a> flag is false and is not <a href="workers.html#suspendable-worker" id="broadcasting-to-other-browsing-contexts:suspendable-worker">suspendable</a>.</ul>
  </div>

  <div data-algorithm=""><p>The <dfn data-dfn-for="BroadcastChannel" id="dom-broadcastchannel-postmessage" data-dfn-type="method"><code>postMessage(<var>message</var>)</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="broadcasting-to-other-browsing-contexts:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is not <a href="#eligible-for-messaging" id="broadcasting-to-other-browsing-contexts:eligible-for-messaging">eligible for messaging</a>, then return.<li><p>If <a id="broadcasting-to-other-browsing-contexts:this-5" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-broadcastchannel-closed" id="broadcasting-to-other-browsing-contexts:concept-broadcastchannel-closed-2">closed flag</a> is true, then throw an <a id="broadcasting-to-other-browsing-contexts:invalidstateerror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="broadcasting-to-other-browsing-contexts:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>serialized</var> be <a id="broadcasting-to-other-browsing-contexts:structuredserialize" href="structured-data.html#structuredserialize">StructuredSerialize</a>(<var>message</var>). 例外を再度投げる。<li><p>Let <var>sourceOrigin</var> be <a id="broadcasting-to-other-browsing-contexts:this-6" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="broadcasting-to-other-browsing-contexts:relevant-settings-object" href="webappapis.html#relevant-settings-object">relevant settings object</a>'s <a href="webappapis.html#concept-settings-object-origin" id="broadcasting-to-other-browsing-contexts:concept-settings-object-origin">origin</a>.<li><p>Let <var>sourceStorageKey</var> be the result of running <a id="broadcasting-to-other-browsing-contexts:obtain-a-storage-key-for-non-storage-purposes" href="https://triple-underscore.github.io/storage-ja.html#obtain-a-storage-key-for-non-storage-purposes" data-x-internal="obtain-a-storage-key-for-non-storage-purposes">obtain a storage key for non-storage purposes</a> with <a id="broadcasting-to-other-browsing-contexts:this-7" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="broadcasting-to-other-browsing-contexts:relevant-settings-object-2" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>Let <var>destinations</var> be a list of <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-6"><a href="#broadcastchannel">BroadcastChannel</a></code> objects that match the following criteria:</p>

    <ul><li><p>They are <a href="#eligible-for-messaging" id="broadcasting-to-other-browsing-contexts:eligible-for-messaging-2">eligible for messaging</a>.<li><p>The result of running <a id="broadcasting-to-other-browsing-contexts:obtain-a-storage-key-for-non-storage-purposes-2" href="https://triple-underscore.github.io/storage-ja.html#obtain-a-storage-key-for-non-storage-purposes" data-x-internal="obtain-a-storage-key-for-non-storage-purposes">obtain a storage key for non-storage purposes</a> with their <a id="broadcasting-to-other-browsing-contexts:relevant-settings-object-3" href="webappapis.html#relevant-settings-object">relevant settings object</a> <a href="https://triple-underscore.github.io/storage-ja.html#storage-key-equal" id="broadcasting-to-other-browsing-contexts:storage-key-equal" data-x-internal="storage-key-equal">equals</a> <var>sourceStorageKey</var>.<li><p>Their <a href="#channel-name" id="broadcasting-to-other-browsing-contexts:channel-name-3">channel name</a> <a id="broadcasting-to-other-browsing-contexts:is" href="https://triple-underscore.github.io/infra-ja.html#string-is" data-x-internal="is">is</a> <a id="broadcasting-to-other-browsing-contexts:this-8" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#channel-name" id="broadcasting-to-other-browsing-contexts:channel-name-4">channel name</a>.</ul>
   <li><p>Remove <var>source</var> from <var>destinations</var>.<li><p>Sort <var>destinations</var> such that all <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-7"><a href="#broadcastchannel">BroadcastChannel</a></code> objects whose <a href="webappapis.html#relevant-agent" id="broadcasting-to-other-browsing-contexts:relevant-agent">relevant agents</a> are the same are sorted in creation order, oldest first. (This does not define a complete ordering. Within this constraint, user agents may sort the list in any <a id="broadcasting-to-other-browsing-contexts:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> manner.)<li><p>For each <var>destination</var> in <var>destinations</var>, <a id="broadcasting-to-other-browsing-contexts:queue-a-global-task" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="broadcasting-to-other-browsing-contexts:dom-manipulation-task-source" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>destination</var>'s <a id="broadcasting-to-other-browsing-contexts:concept-relevant-global-2" href="webappapis.html#concept-relevant-global">relevant global object</a> to perform the following steps:</p>

    <ol><li><p>If <var>destination</var>'s <a href="#concept-broadcastchannel-closed" id="broadcasting-to-other-browsing-contexts:concept-broadcastchannel-closed-3">closed flag</a> is true, then abort these steps.<li><p>Let <var>targetRealm</var> be <var>destination</var>'s <a href="webappapis.html#concept-relevant-realm" id="broadcasting-to-other-browsing-contexts:concept-relevant-realm">relevant realm</a>.<li><p>Let <var>data</var> be <a id="broadcasting-to-other-browsing-contexts:structureddeserialize" href="structured-data.html#structureddeserialize">StructuredDeserialize</a>(<var>serialized</var>, <var>targetRealm</var>).</p>

      <p>If this throws an exception, catch it, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="broadcasting-to-other-browsing-contexts:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="broadcasting-to-other-browsing-contexts:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code> at <var>destination</var>, using <code id="broadcasting-to-other-browsing-contexts:messageevent"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="broadcasting-to-other-browsing-contexts:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code> attribute initialized to the <a href="browsers.html#ascii-serialisation-of-an-origin" id="broadcasting-to-other-browsing-contexts:ascii-serialisation-of-an-origin">serialization</a> of <var>sourceOrigin</var>, and then abort these steps.</p>
     <li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="broadcasting-to-other-browsing-contexts:concept-event-fire-2" data-x-internal="concept-event-fire">Fire an event</a> named <code id="broadcasting-to-other-browsing-contexts:event-message"><a href="indices.html#event-message">message</a></code> at <var>destination</var>, using <code id="broadcasting-to-other-browsing-contexts:messageevent-2"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="broadcasting-to-other-browsing-contexts:dom-messageevent-data"><a href="comms.html#dom-messageevent-data">data</a></code> attribute initialized to <var>data</var> and the <code id="broadcasting-to-other-browsing-contexts:dom-messageevent-origin-2"><a href="comms.html#dom-messageevent-origin">origin</a></code> attribute initialized to the <a href="browsers.html#ascii-serialisation-of-an-origin" id="broadcasting-to-other-browsing-contexts:ascii-serialisation-of-an-origin-2">serialization</a> of <var>sourceOrigin</var>.</ol>
   </ol>
  </div>

  <p>While a <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-8"><a href="#broadcastchannel">BroadcastChannel</a></code> object whose <a href="#concept-broadcastchannel-closed" id="broadcasting-to-other-browsing-contexts:concept-broadcastchannel-closed-4">closed flag</a> is false has an event listener registered for <code id="broadcasting-to-other-browsing-contexts:event-message-2"><a href="indices.html#event-message">message</a></code> or <code id="broadcasting-to-other-browsing-contexts:event-messageerror-2"><a href="indices.html#event-messageerror">messageerror</a></code> events, there must be a strong reference from the <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-9"><a href="#broadcastchannel">BroadcastChannel</a></code> object's <a id="broadcasting-to-other-browsing-contexts:concept-relevant-global-3" href="webappapis.html#concept-relevant-global">relevant global object</a> to the <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-10"><a href="#broadcastchannel">BroadcastChannel</a></code> object itself.</p>

  <div data-algorithm=""><p>The <dfn data-dfn-for="BroadcastChannel" id="dom-broadcastchannel-close" data-dfn-type="method"><code>close()</code></dfn> method steps are to set <a id="broadcasting-to-other-browsing-contexts:this-9" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-broadcastchannel-closed" id="broadcasting-to-other-browsing-contexts:concept-broadcastchannel-closed-5">closed flag</a> to true.</p>
  </div>

  

  <p class="note">Authors are strongly encouraged to explicitly close <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-11"><a href="#broadcastchannel">BroadcastChannel</a></code> objects when they are no longer needed, so that they can be garbage collected. Creating many <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-12"><a href="#broadcastchannel">BroadcastChannel</a></code> objects and discarding them while leaving them with an event listener and without closing them can lead to an apparent memory leak, since the objects will continue to live for as long as they have an event listener (or until their page or worker is closed).</p>

  

  <hr>

  <p>The following are the <a id="broadcasting-to-other-browsing-contexts:event-handlers" href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <a href="webappapis.html#event-handler-event-type" id="broadcasting-to-other-browsing-contexts:event-handler-event-type">event handler event types</a>) that must be supported, as <a id="broadcasting-to-other-browsing-contexts:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the <code id="broadcasting-to-other-browsing-contexts:broadcastchannel-13"><a href="#broadcastchannel">BroadcastChannel</a></code> interface:</p>

  <table><thead><tr><th><a href="webappapis.html#event-handlers" id="broadcasting-to-other-browsing-contexts:event-handlers-2">イベントハンドラー</a><th><a id="broadcasting-to-other-browsing-contexts:event-handler-event-type-2" href="webappapis.html#event-handler-event-type">イベントハンドラーイベント型</a><tbody><tr><td><dfn data-dfn-for="BroadcastChannel" id="handler-broadcastchannel-onmessage" data-dfn-type="attribute"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/message_event" title="The message event is fired on a BroadcastChannel object when a message arrives on that channel.">BroadcastChannel/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="broadcasting-to-other-browsing-contexts:event-message-3"><a href="indices.html#event-message">message</a></code><tr><td><dfn data-dfn-for="BroadcastChannel" id="handler-broadcastchannel-onmessageerror" data-dfn-type="attribute"><code>onmessageerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel/messageerror_event" title="The messageerror event is fired on a BroadcastChannel object when a message that can&apos;t be deserialized arrives on the channel.">BroadcastChannel/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><td><code id="broadcasting-to-other-browsing-contexts:event-messageerror-3"><a href="indices.html#event-messageerror">messageerror</a></code></table>

  

  <div class="example"><p>ユーザーが同じサイトの別のタブからログアウトした場合でも、ユーザーがいつログアウトしたかをページが知りたいとする：</p>

   <pre><code class='js'><c- a>var</c-> authChannel <c- o>=</c-> <c- k>new</c-> BroadcastChannel<c- p>(</c-><c- t>'auth'</c-><c- p>);</c->
authChannel<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'logout'</c-><c- p>)</c->
    showLogout<c- p>();</c->
<c- p>}</c->

<c- a>function</c-> logoutRequested<c- p>()</c-> <c- p>{</c->
  <c- c1>// called when the user asks us to log them out</c->
  doLogout<c- p>();</c->
  showLogout<c- p>();</c->
  authChannel<c- p>.</c->postMessage<c- p>(</c-><c- t>'logout'</c-><c- p>);</c->
<c- p>}</c->

<c- a>function</c-> doLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// actually log the user out (e.g. clearing cookies)</c->
  <c- c1>// ...</c->
<c- p>}</c->

<c- a>function</c-> showLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// update the UI to indicate we're logged out</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  </div>



  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav>

<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script async="" crossorigin="" src="./html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">22 June 2021</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="canvas.html">← 4.12.5 canvas要素</a> – <a href="./">目次</a> – <a href="semantics-other.html">4.14 専用要素なしの一般的語彙 →</a></nav><ol class="toc"><li id="toc-semantics"><ol><li><a href="custom-elements.html#custom-elements"><span class="secno">4.13</span> カスタム要素</a><ol><li><a href="custom-elements.html#custom-elements-intro"><span class="secno">4.13.1</span> 導入</a><ol><li><a href="custom-elements.html#custom-elements-autonomous-example"><span class="secno">4.13.1.1</span> 自律カスタム要素の作成</a><li><a href="custom-elements.html#custom-elements-face-example"><span class="secno">4.13.1.2</span> フォームに関連付けられたカスタム要素の作成</a><li><a href="custom-elements.html#custom-elements-accessibility-example"><span class="secno">4.13.1.3</span> デフォルトでアクセシブルなロール、ステート、およびプロパティをもつカスタム要素を作成する</a><li><a href="custom-elements.html#custom-elements-customized-builtin-example"><span class="secno">4.13.1.4</span> カスタマイズされた組み込み要素の作成</a><li><a href="custom-elements.html#custom-elements-autonomous-drawbacks"><span class="secno">4.13.1.5</span> 自律カスタム要素の欠点</a><li><a href="custom-elements.html#custom-elements-upgrades-examples"><span class="secno">4.13.1.6</span> 作成後の要素のアップグレード</a></ol><li><a href="custom-elements.html#custom-element-conformance"><span class="secno">4.13.2</span> カスタム要素のコンストラクターと反応の要件</a><li><a href="custom-elements.html#custom-elements-core-concepts"><span class="secno">4.13.3</span> コアコンセプト</a><li><a href="custom-elements.html#custom-elements-api"><span class="secno">4.13.4</span> <code>CustomElementRegistry</code>インターフェイス</a><li><a href="custom-elements.html#upgrades"><span class="secno">4.13.5</span> Upgrades</a><li><a href="custom-elements.html#custom-element-reactions"><span class="secno">4.13.6</span> カスタム要素応答</a><li><a href="custom-elements.html#element-internals"><span class="secno">4.13.7</span> 要素内部</a><ol><li><a href="custom-elements.html#the-elementinternals-interface"><span class="secno">4.13.7.1</span> The <code>ElementInternals</code> interface</a><li><a href="custom-elements.html#shadow-root-access"><span class="secno">4.13.7.2</span> シャドウルートアクセス</a><li><a href="custom-elements.html#form-associated-custom-elements"><span class="secno">4.13.7.3</span> フォームに関連付けられたカスタム要素</a><li><a href="custom-elements.html#accessibility-semantics"><span class="secno">4.13.7.4</span> アクセシビリティセマンティックス</a></ol></ol></ol></ol><h3 id="custom-elements"><span class="secno">4.13</span> カスタム要素<a href="#custom-elements" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements" title="One of the key features of the Web Components standard is the ability to create custom elements that encapsulate your functionality on an HTML page, rather than having to make do with a long, nested batch of elements that together provide a custom page feature. This article introduces the use of the Custom Elements API.">Using_custom_elements</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span></div></div></div>

  <h4 id="custom-elements-intro"><span class="secno">4.13.1</span> 導入<a href="#custom-elements-intro" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p><a href="#custom-element" id="custom-elements-intro:custom-element">カスタム要素</a>は、著者に完全に機能するDOM要素を独自に構築する方法を提供する。スクリプティングなどで事後に追加されたアプリケーション固有の動作とともに、著者は文書内で非標準要素を常に使用することができたが、そのような要素は歴史的に不適合であり、あまり機能しなかった。カスタム要素を<a href="#element-definition" id="custom-elements-intro:element-definition">定義する</a>ことで、著者はパーサーに要素を正しく構成する方法と、そのクラスの要素が変更にどのように反応するかを通知できる。</p>

  <p>カスタム要素は、（カスタム要素の定義のような）低レベルの著者公開拡張ポイントに関して、（HTMLの要素のような）既存のプラットフォーム機能を説明することによって、"プラットフォームを合理化する"ための大きな努力の一部である。今日、HTMLの既存要素の振る舞いを完全に説明することを妨げるカスタム要素（機能的および意味的な要素）の機能には多くの制限があるが、我々は時間の経過とともにこのギャップを縮小したいと思う。</p>

  <h5 id="custom-elements-autonomous-example"><span class="secno">4.13.1.1</span> 自律カスタム要素の作成<a href="#custom-elements-autonomous-example" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href="#autonomous-custom-element" id="custom-elements-autonomous-example:autonomous-custom-element">自律カスタム要素</a>を作成する方法を説明するために、国旗の小さなアイコンのレンダリングをカプセル化するカスタム要素を定義してみよう。私たちの目標は、次のように使用できるようにすることである：</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>flag-icon</c-> <c- e>country</c-><c- o>=</c-><c- s>"nl"</c-><c- p>>&lt;/</c-><c- f>flag-icon</c-><c- p>></c-></code></pre>

  <p>これを行うには、まずカスタム要素のクラスを宣言し、<code id="custom-elements-autonomous-example:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code>を拡張する：</p>

  <pre><code class='js'><c- a>class</c-> FlagIcon <c- k>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
  <c- p>}</c->

  <c- k>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- u>"country"</c-><c- p>];</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "country" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> newValue<c- p>;</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->

  get country<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->_countryCode<c- p>;</c->
  <c- p>}</c->
  set country<c- p>(</c->v<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"country"</c-><c- p>,</c-> v<c- p>);</c->
  <c- p>}</c->

  _updateRendering<c- p>()</c-> <c- p>{</c->
    <c- c1>// Left as an exercise for the reader. But, you'll probably want to</c->
    <c- c1>// check this.ownerDocument.defaultView to see if we've been</c->
    <c- c1>// inserted into a document with a browsing context, and avoid</c->
    <c- c1>// doing any work if not.</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>次に、要素を定義するために次のクラスを使用して必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"flag-icon"</c-><c- p>,</c-> FlagIcon<c- p>);</c-></code></pre>

  <p>この時点で、上記のコードは動作する。<code>flag-icon</code>タグを見るたびに、パーサーは<code>FlagIcon</code>クラスの新しいインスタンスを作成し、要素の内部状態を設定し、レンダリングを更新するために使用する（適切な場合）、新しい<code>country</code>属性についてコードに伝える。</p>

  <p>DOM APIを使用して<code>flag-icon</code>要素を作成することもできる：</p>

  <pre><code class='js'><c- a>const</c-> flagIcon <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"flag-icon"</c-><c- p>)</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <p>最後に、<a href="#custom-element-constructor" id="custom-elements-autonomous-example:custom-element-constructor">カスタム要素コンストラクター</a>自体を使用することもできる。つまり、上記のコードは次のコードと同じである：</p>

  <pre><code class='js'><c- a>const</c-> flagIcon <c- o>=</c-> <c- k>new</c-> FlagIcon<c- p>()</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <h5 id="custom-elements-face-example"><span class="secno">4.13.1.2</span> フォームに関連付けられたカスタム要素の作成<a href="#custom-elements-face-example" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>trueの値を持つ静的な<code>formAssociated</code>プロパティを追加すると、<a href="#autonomous-custom-element" id="custom-elements-face-example:autonomous-custom-element">自律カスタム要素</a>が<a href="#form-associated-custom-element" id="custom-elements-face-example:form-associated-custom-element">フォーム関連カスタム要素</a>になる。<code id="custom-elements-face-example:elementinternals"><a href="#elementinternals">ElementInternals</a></code>インターフェイスは、フォームコントロール要素に共通の関数およびプロパティを実装するのに役立つ。</p>

  <pre><code class='js'><c- a>class</c-> MyCheckbox <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> get formAssociated<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- kc>true</c-><c- p>;</c-> <c- p>}</c->
  <c- k>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'checked'</c-><c- p>];</c-> <c- p>}</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->_onClick<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>));</c->
  <c- p>}</c->

  get form<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->form<c- p>;</c-> <c- p>}</c->
  get name<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'name'</c-><c- p>);</c-> <c- p>}</c->
  get type<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->localName<c- p>;</c-> <c- p>}</c->

  get checked<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>);</c-> <c- p>}</c->
  set checked<c- p>(</c->flag<c- p>)</c-> <c- p>{</c-> <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "checked" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->setFormValue<c- p>(</c-><c- k>this</c-><c- p>.</c->checked <c- o>?</c-> <c- t>'on'</c-> <c- o>:</c-> <c- kc>null</c-><c- p>);</c->
  <c- p>}</c->

  _onClick<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->checked <c- o>=</c-> <c- o>!</c-><c- k>this</c-><c- p>.</c->checked<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- t>'my-checkbox'</c-><c- p>,</c-> MyCheckbox<c- p>);</c-></code></pre>

  <p>カスタム要素<code>my-checkbox</code>は、組み込みのフォームに関連付けられた要素のように使うことができる。たとえば、<code id="custom-elements-face-example:the-form-element"><a href="forms.html#the-form-element">form</a></code>または<code id="custom-elements-face-example:the-label-element"><a href="forms.html#the-label-element">label</a></code> の中に置くことで<code>my-checkbox</code>要素が関連付けられ、<code id="custom-elements-face-example:the-form-element-2"><a href="forms.html#the-form-element">form</a></code>を送信することで<code>my-checkbox</code>実装で提供されるデータが送信される。</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>form</c-> <c- e>action</c-><c- o>=</c-><c- s>"..."</c-> <c- e>method</c-><c- o>=</c-><c- s>"..."</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>label</c-><c- p>>&lt;</c-><c- f>my-checkbox</c-> <c- e>name</c-><c- o>=</c-><c- s>"agreed"</c-><c- p>>&lt;/</c-><c- f>my-checkbox</c-><c- p>></c-> I read the agreement.<c- p>&lt;/</c-><c- f>label</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>input</c-> <c- e>type</c-><c- o>=</c-><c- s>"submit"</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>form</c-><c- p>></c->
</code></pre>

  <h5 id="custom-elements-accessibility-example"><span class="secno">4.13.1.3</span> デフォルトでアクセシブルなロール、ステート、およびプロパティをもつカスタム要素を作成する<a href="#custom-elements-accessibility-example" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><code id="custom-elements-accessibility-example:elementinternals"><a href="#elementinternals">ElementInternals</a></code>の適切なプロパティを使用することにより、カスタム要素はデフォルトのアクセシビリティセマンティクスを持つことができる。 次のコードは、前のセクションのフォームに関連付けられたチェックボックスを拡張して、アクセシビリティ技術から見たデフォルトのロールおよびチェック状態を適切に設定する：</p>

  <pre><code class='js'><c- a>class</c-> MyCheckbox <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> get formAssociated<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- kc>true</c-><c- p>;</c-> <c- p>}</c->
  <c- k>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- t>'checked'</c-><c- p>];</c-> <c- p>}</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->_onClick<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>));</c->

<mark>    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->role <c- o>=</c-> <c- t>'checkbox'</c-><c- p>;</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaChecked <c- o>=</c-> <c- kc>false</c-><c- p>;</c-></mark>
  <c- p>}</c->

  get form<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->form<c- p>;</c-> <c- p>}</c->
  get name<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'name'</c-><c- p>);</c-> <c- p>}</c->
  get type<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->localName<c- p>;</c-> <c- p>}</c->

  get checked<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>);</c-> <c- p>}</c->
  set checked<c- p>(</c->flag<c- p>)</c-> <c- p>{</c-> <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "checked" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->setFormValue<c- p>(</c-><c- k>this</c-><c- p>.</c->checked <c- o>?</c-> <c- t>'on'</c-> <c- o>:</c-> <c- kc>null</c-><c- p>);</c->
<mark>    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaChecked <c- o>=</c-> <c- k>this</c-><c- p>.</c->checked<c- p>;</c-></mark>
  <c- p>}</c->

  _onClick<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->checked <c- o>=</c-> <c- o>!</c-><c- k>this</c-><c- p>.</c->checked<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- t>'my-checkbox'</c-><c- p>,</c-> MyCheckbox<c- p>);</c-></code></pre>

  <p>組み込み要素の場合と同様に、これらはデフォルトにすぎず、<code id="custom-elements-accessibility-example:attr-aria-role"><a href="infrastructure.html#attr-aria-role">role</a></code>および<code id="custom-elements-accessibility-example:attr-aria-*"><a href="infrastructure.html#attr-aria-*">aria-*</a></code>属性を使用するページ著者によって上書きできることに注意する：</p>

  <pre class="bad"><code class='html'><c- c>&lt;!-- This markup is non-conforming --></c->
<c- p>&lt;</c-><c- f>input</c-> <c- e>type</c-><c- o>=</c-><c- s>"checkbox"</c-> <c- e>checked</c-> <c- e>role</c-><c- o>=</c-><c- s>"button"</c-> <c- e>aria-checked</c-><c- o>=</c-><c- s>"false"</c-><c- p>></c-></code></pre>

<pre class="bad"><code class='html'><c- c>&lt;!-- This markup is probably not what the custom element author intended --></c->
<c- p>&lt;</c-><c- f>my-checkbox</c-> <c- e>role</c-><c- o>=</c-><c- s>"button"</c-> <c- e>checked</c-> <c- e>aria-checked</c-><c- o>=</c-><c- s>"false"</c-><c- p>></c-></code></pre>

  <p>カスタム要素の著者は、アクセシビリティセマンティクスのどの側面が強いネイティヴセマンティクスであるかを説明することが勧められる。つまり、カスタム要素のユーザーによって上書きされるべきではない。この例では、<code>my-checkbo</code>x要素の著者は、その<a id="custom-elements-accessibility-example:role" href="http://momdo.github.io/wai-aria-1.2/#dfn-role" data-x-internal="role">role</a>および<code id="custom-elements-accessibility-example:attr-aria-checked"><a data-x-internal="attr-aria-checked" href="https://w3c.github.io/aria/#aria-checked">aria-checked</a></code>値は強いネイティヴセマンティクスであるため、上記のようなコードを勧めないと述べている。</p>

  <h5 id="custom-elements-customized-builtin-example"><span class="secno">4.13.1.4</span> カスタマイズされた組み込み要素の作成<a href="#custom-elements-customized-builtin-example" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element">カスタマイズされた組み込み要素</a>は、<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element">自律カスタム要素</a>とはわずかに異なる定義があり、そして大きく異なる使われ方をする、独自の種類の<a href="#custom-element" id="custom-elements-customized-builtin-example:custom-element">カスタム要素</a>である。この要素は、新しいカスタム機能でHTMLの既存要素を拡張することで、HTMLの既存要素由来の動作の再利用を可能にするために存在する。残念なことに、HTML要素の既存の動作の多くが<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-2">自律カスタム要素</a>を純粋に使用して複製できないため、これは重要である。代わりに、<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-2">カスタマイズされた組み込み要素</a>は、既存の要素にカスタム構築動作、ライフサイクルフック、およびプロトタイプチェーンをインストールを可能にし、既存の要素の上にこれらの機能を本質的に"混在"させる。</p>

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-3">カスタマイズされた組み込み要素</a>は、ユーザーエージェントや他のソフトウェアが要素のセマンティクスおよび動作を識別するために要素のローカル名として扱うので、<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-3">自律カスタム要素</a>とは異なる構文を必要とする。つまり、既存の動作の上に構築する<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-4">カスタマイズされた組み込み要素</a>の概念は、元のローカル名を保持する拡張要素に決定的に依存する。</p>

  <p>この例において、<code>plastic-button</code>という<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-5">カスタマイズされた組み込み要素</a>を作成する。これは通常のボタンのように動作するが、クリックするたびにファンシーなアニメーション効果が追加される。今回は<code id="custom-elements-customized-builtin-example:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code>の代わりに<code id="custom-elements-customized-builtin-example:htmlbuttonelement"><a href="form-elements.html#htmlbuttonelement">HTMLButtonElement</a></code>を拡張するが、前と同じようにクラスを定義することから始める：</p>

  <pre><code class='js'><c- a>class</c-> PlasticButton <c- k>extends</c-> HTMLButtonElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
      <c- c1>// Draw some fancy animation effects!</c->
    <c- p>});</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>カスタム要素を定義する場合、<code>extends</code>オプションも指定する必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"plastic-button"</c-><c- p>,</c-> PlasticButton<c- p>,</c-> <c- p>{</c-> <c- k>extends</c-><c- o>:</c-> <c- u>"button"</c-> <c- p>});</c-></code></pre>

  <p>一般に、拡張されている要素の名前は、同じインターフェイスを共有する要素（<code id="custom-elements-customized-builtin-example:htmlquoteelement"><a href="grouping-content.html#htmlquoteelement">HTMLQuoteElement</a></code>を共有する<code id="custom-elements-customized-builtin-example:the-q-element"><a href="text-level-semantics.html#the-q-element">q</a></code>と<code id="custom-elements-customized-builtin-example:the-blockquote-element"><a href="grouping-content.html#the-blockquote-element">blockquote</a></code>の両者など）を共有するため、拡張する要素インターフェイスを単に調べるだけでは判断することができない。</p>

  <p>解析されたHTMLソーステキストから<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-6">カスタマイズされた組み込み要素</a>を構築するには、<code id="custom-elements-customized-builtin-example:the-button-element"><a href="form-elements.html#the-button-element">button</a></code>要素の<code id="custom-elements-customized-builtin-example:attr-is"><a href="#attr-is">is</a></code>属性を使用する。</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>is</c-><c- o>=</c-><c- s>"plastic-button"</c-><c- p>></c->Click Me!<c- p>&lt;/</c-><c- f>button</c-><c- p>></c-></code></pre>

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-7">カスタマイズされた組み込み要素</a>を<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-4">自律カスタム要素</a>として使用しようとするとうまく<em>いかない</em>。つまり、<code>&lt;plastic-button>Click me?&lt;/plastic-button></code>は特別な動作をしない<code id="custom-elements-customized-builtin-example:htmlelement-2"><a href="dom.html#htmlelement">HTMLElement</a></code>を作成するだけである。</p>

  <p>プログラムでカスタマイズしたビルトイン要素を作成する必要がある場合、次の<code id="custom-elements-customized-builtin-example:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement()</a></code>の形式を使用することができる：</p>

  <pre><code class='js'><c- a>const</c-> plasticButton <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"button"</c-><c- p>,</c-> <c- p>{</c-> is<c- o>:</c-> <c- u>"plastic-button"</c-> <c- p>});</c->
plasticButton<c- p>.</c->textContent <c- o>=</c-> <c- u>"Click me!"</c-><c- p>;</c-></code></pre>

  <p>前と同じように、コンストラクターも動作する：</p>

  <pre><code class='js'><c- a>const</c-> plasticButton2 <c- o>=</c-> <c- k>new</c-> PlasticButton<c- p>();</c->
console<c- p>.</c->log<c- p>(</c->plasticButton2<c- p>.</c->localName<c- p>);</c->  <c- c1>// will output "button"</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> PlasticButton<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> HTMLButtonElement<c- p>);</c-></code></pre>

  <p>プログラムでカスタマイズした組み込み要素を作成する場合、明示的に設定されていないので<code id="custom-elements-customized-builtin-example:attr-is-2"><a href="#attr-is">is</a></code>属性はDOMに存在しない。ただし、<a href="parsing.html#attr-is-during-serialization">シリアライズ時に出力に追加される</a>。</p>

  <pre><code class='js'>console<c- p>.</c->assert<c- p>(</c-><c- o>!</c->plasticButton<c- p>.</c->hasAttribute<c- p>(</c-><c- u>"is"</c-><c- p>));</c->
console<c- p>.</c->log<c- p>(</c->plasticButton<c- p>.</c->outerHTML<c- p>);</c-> <c- c1>// will output '&lt;button is="plastic-button">&lt;/button>'</c-></code></pre>

  <p>作成方法に関係なく、<code id="custom-elements-customized-builtin-example:the-button-element-2"><a href="form-elements.html#the-button-element">button</a></code>が特別であるすべての方法は、そのような"プラスチックボタン"にも適用される：フォーカス動作、<a href="form-control-infrastructure.html#concept-form-submit" id="custom-elements-customized-builtin-example:concept-form-submit">フォーム送信</a>に関与する能力、<code id="custom-elements-customized-builtin-example:attr-fe-disabled"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code>属性など。</p>

  <p id="customized-built-in-element-restrictions"><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-8">カスタマイズされた組み込み要素</a>は、有用なユーザーエージェントが提供する動作またはAPIを持つ既存のHTML要素を拡張を可能にするように設計されている。そのため、この仕様で定義される既存のHTML要素のみを拡張することができ、<a id="custom-elements-customized-builtin-example:element-interface" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface" data-x-internal="element-interface">要素インターフェイス</a>として<code id="custom-elements-customized-builtin-example:htmlunknownelement"><a href="dom.html#htmlunknownelement">HTMLUnknownElement</a></code>を使用するように定義された<code id="custom-elements-customized-builtin-example:bgsound"><a href="obsolete.html#bgsound">bgsound</a></code>、<code id="custom-elements-customized-builtin-example:blink"><a href="obsolete.html#blink">blink</a></code>、<code id="custom-elements-customized-builtin-example:isindex"><a href="obsolete.html#isindex">isindex</a></code>、<code id="custom-elements-customized-builtin-example:keygen"><a href="obsolete.html#keygen">keygen</a></code>、<code id="custom-elements-customized-builtin-example:multicol"><a href="obsolete.html#multicol">multicol</a></code>、<code id="custom-elements-customized-builtin-example:nextid"><a href="obsolete.html#nextid">nextid</a></code>、または<code id="custom-elements-customized-builtin-example:spacer"><a href="obsolete.html#spacer">spacer</a></code>などのレガシー要素は拡張できない。</p>

  <p>この要件の1つの理由は将来の互換性である。もし<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-9">カスタマイズされた組み込み要素</a>が、たとえば<code>combobox</code>のような、現在不明の要素を拡張したものが定義されたなら、派生した<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-10">カスタマイズされた組み込み要素</a>のコンシューマーが、ユーザーエージェント提供の動作に興味を持たない基本要素に依存するようになるため、これはこの仕様が将来<code>combobox</code>要素を定義することを妨げるかもしれない。</p>

  <h5 id="custom-elements-autonomous-drawbacks"><span class="secno">4.13.1.5</span> 自律カスタム要素の欠点<a href="#custom-elements-autonomous-drawbacks" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p>以下で規定されているように、そして上記で触れたように、単に<code>taco-button</code>という要素を定義して使用しても、そのような要素がボタンを<a href="dom.html#represents" id="custom-elements-autonomous-drawbacks:represents">表す</a>ことを意味しない。つまり、ウェブブラウザー、検索エンジン、アクセシビリティ技術などのツールは、定義された名前だけに基づいて、結果の要素をボタンとして自動的に処理しない。</p>

  <p><a href="#autonomous-custom-element" id="custom-elements-autonomous-drawbacks:autonomous-custom-element">自律カスタム要素</a>を依然として使用する一方で、様々なユーザーに所望のボタンセマンティクスを伝えるためためには、複数の技術を用いる必要がある：</p>

  <ul><li><p><code id="custom-elements-autonomous-drawbacks:attr-tabindex"><a href="interaction.html#attr-tabindex">tabindex</a></code>属性の追加は、<code>taco-button</code>を<a id="custom-elements-autonomous-drawbacks:focusable" href="interaction.html#focusable">フォーカス可能</a>にする。もし<code>taco-button</code>を論理的に無効にするならば、<code id="custom-elements-autonomous-drawbacks:attr-tabindex-2"><a href="interaction.html#attr-tabindex">tabindex</a></code>属性を削除する必要があるだろうことに注意すること。<li><p>ARIAロールならびにさまざまなARIAステートおよびプロパティの追加は、セマンティクスをアクセシビリティ技術に伝えるのに役立つ。 たとえば、<a id="custom-elements-autonomous-drawbacks:role" href="http://momdo.github.io/wai-aria-1.2/#dfn-role" data-x-internal="role">role</a>を"<code id="custom-elements-autonomous-drawbacks:attr-aria-role-button"><a data-x-internal="attr-aria-role-button" href="https://momdo.github.io/wai-aria-1.2/#button">button</a></code>"に設定すると、これがボタンであるというセマンティクスを伝え、支援技術で通常のボタンのような操作を使用してコントロールをユーザーが正常に操作できる。ボタンに<a href="http://momdo.github.io/wai-aria-1.2/#dfn-accessible-name" id="custom-elements-autonomous-drawbacks:concept-accessible-name" data-x-internal="concept-accessible-name">アクセシブルな名前</a>を付けるには、<code id="custom-elements-autonomous-drawbacks:attr-aria-label"><a data-x-internal="attr-aria-label" href="http://momdo.github.io/wai-aria-1.2/#aria-label">aria-label</a></code>プロパティを設定する必要がある。代わりに、アクセシビリティ技術でその子のテキストノードを縦走して通知する必要はない。そして、ボタンが論理的に無効になっているときに<code id="custom-elements-autonomous-drawbacks:attr-aria-disabled"><a data-x-internal="attr-aria-disabled" href="http://momdo.github.io/wai-aria-1.2/#aria-disabled">aria-disabled</a></code>ステートを"<code>true</code>"に設定すると、アクセシビリティ技術にボタンの無効状態を伝える。<li><p>通常予想されるボタンの動作を処理するイベントハンドラーを追加することにより、ボタンのセマンティクスをウェブブラウザーのユーザーに伝えることを手伝う。この場合、最も関連性の高いイベントハンドラーは、適切な<code id="custom-elements-autonomous-drawbacks:event-keydown"><a data-x-internal="event-keydown" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-keydown">keydown</a></code>イベントを<code id="custom-elements-autonomous-drawbacks:event-click"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code>イベントとしてプロキシーするものであるので、キーボードとクリックの両方でボタンをアクティブにすることができる。<li><p><code>taco-button</code>要素に提供される任意のデフォルトの視覚スタイリングに加えて、視覚スタイリングはまた、例えば無効になるなど、論理状態の変化を反映するように更新される必要がある。つまり、<code>taco-button</code>の規則を持つスタイルシートはすべて、<code>taco-button[disabled]</code>の規則も必要となる。</ul>

  <p>これらの点を念頭に置いて、（無効にする機能を含む）ボタンのセマンティクスを伝える責任を負ったフル機能の<code>taco-button</code>は、次のようになる：</p>

  <pre><code class='js'><c- a>class</c-> TacoButton <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> get observedAttributes<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- p>[</c-><c- u>"disabled"</c-><c- p>];</c-> <c- p>}</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->role <c- o>=</c-> <c- u>"button"</c-><c- p>;</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"keydown"</c-><c- p>,</c-> e <c- p>=></c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c->e<c- p>.</c->code <c- o>===</c-> <c- u>"Enter"</c-> <c- o>||</c-> e<c- p>.</c->code <c- o>===</c-> <c- u>"Space"</c-><c- p>)</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->dispatchEvent<c- p>(</c-><c- k>new</c-> PointerEvent<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>{</c->
          bubbles<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
          cancelable<c- o>:</c-> <c- kc>true</c->
        <c- p>}));</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> e <c- p>=></c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
        e<c- p>.</c->preventDefault<c- p>();</c->
        e<c- p>.</c->stopImmediatePropagation<c- p>();</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->_observer <c- o>=</c-> <c- k>new</c-> MutationObserver<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaLabel <c- o>=</c-> <c- k>this</c-><c- p>.</c->textContent<c- p>;</c->
    <c- p>});</c->
  <c- p>}</c->

  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->

    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->observe<c- p>(</c-><c- k>this</c-><c- p>,</c-> <c- p>{</c->
      childList<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      characterData<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      subtree<c- o>:</c-> <c- kc>true</c->
    <c- p>});</c->
  <c- p>}</c->

  disconnectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->disconnect<c- p>();</c->
  <c- p>}</c->

  get disabled<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->hasAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>);</c->
  <c- p>}</c->
  set disabled<c- p>(</c->flag<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c->
  <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "disabled" due to observedAttributes</c->
    <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->removeAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaDisabled <c- o>=</c-> <c- u>"true"</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaDisabled <c- o>=</c-> <c- u>"false"</c-><c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>このかなり複雑な要素定義であっても、要素はカスタマーに使用する喜びとはならない。その要素は、自身の意志の<code id="custom-elements-autonomous-drawbacks:attr-tabindex-3"><a href="interaction.html#attr-tabindex">tabindex</a></code>属性を継続的に"発芽"し、<code>tabindex="0"</code>フォーカス機能の動作の選択は、現在のプラットフォームの<code id="custom-elements-autonomous-drawbacks:the-button-element"><a href="form-elements.html#the-button-element">button</a></code>動作と一致しなくてもよい 。これは、（通常、コンシューマーがデフォルトの動作を上書きできるように予約されているにもかかわらず）そのために<code id="custom-elements-autonomous-drawbacks:attr-tabindex-4"><a href="interaction.html#attr-tabindex">tabindex</a></code>属性の使用を強制する、現時点では、カスタム要素のデフォルトのフォーカス動作を指定する方法がないためである。</p>

  <p>対照的に、前節で示したように、単一の<a href="#customized-built-in-element" id="custom-elements-autonomous-drawbacks:customized-built-in-element">カスタマイズされた組み込み要素</a>は、<code id="custom-elements-autonomous-drawbacks:the-button-element-2"><a href="form-elements.html#the-button-element">button</a></code>要素のセマンティクスと動作を自動的に継承する。これらの動作を手動で実装する必要はない。一般に、HTMLの既存要素の上に構築される重要な動作やセマンティクスを持つ要素については、<a href="#customized-built-in-element" id="custom-elements-autonomous-drawbacks:customized-built-in-element-2">カスタマイズされた組み込み要素</a>の開発、保守、および消費が容易になる。</p>

  <h5 id="custom-elements-upgrades-examples"><span class="secno">4.13.1.6</span> 作成後の要素のアップグレード<a href="#custom-elements-upgrades-examples" class="self-link"></a></h5>

  <p><i>この節は非規範的である。</i></p>

  <p><a href="#element-definition" id="custom-elements-upgrades-examples:element-definition">要素定義</a>はいつでも発生する可能性があるため、非カスタム要素が<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-elements-upgrades-examples:create-an-element" data-x-internal="create-an-element">作成され</a>、適切な<a href="#custom-element-definition" id="custom-elements-upgrades-examples:custom-element-definition">定義</a>を登録した後で<a href="#custom-element" id="custom-elements-upgrades-examples:custom-element">カスタム要素</a>にすることができる。 このプロセスを、通常の要素からカスタム要素に要素を"アップグレードする"と呼ぶ。</p>

  <p><a href="#upgrades" id="custom-elements-upgrades-examples:upgrades">アップグレード</a>は、パーサーなどで関連する要素が最初に作成された後に、<a href="#custom-element-definition" id="custom-elements-upgrades-examples:custom-element-definition-2">カスタム要素定義</a>を登録することが望ましい場合のシナリオを可能にする。これにより、カスタム要素内のコンテンツを段階的に強化することができる。例えば、以下の HTML文書において、<code>img-viewer</code>の要素定義は非同期的にロードされる：</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Image viewer example<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>img-viewer</c-> <c- e>filter</c-><c- o>=</c-><c- s>"Kelvin"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>img</c-> <c- e>src</c-><c- o>=</c-><c- s>"images/tree.jpg"</c-> <c- e>alt</c-><c- o>=</c-><c- s>"A beautiful tree towering over an empty savannah"</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>img-viewer</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"js/elements/img-viewer.js"</c-> <c- e>async</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  <p>ここでの<code>img-viewer</code>要素の定義は、マークアップで<code>&lt;img-viewer></code>タグの後に配置された、<code id="custom-elements-upgrades-examples:attr-script-async"><a href="scripting.html#attr-script-async">async</a></code>属性でマークされた<code id="custom-elements-upgrades-examples:the-script-element"><a href="scripting.html#the-script-element">script</a></code>要素を用いて読み込まれる。 スクリプトの読み込み中、<code>img-viewer</code>要素は、<code id="custom-elements-upgrades-examples:the-span-element"><a href="text-level-semantics.html#the-span-element">span</a></code>と同様に未定義の要素として扱われる。 スクリプトが読み込まれると、<code>img-viewer</code>要素が定義され、ページ上の既存の<code>img-viewer</code>要素は、カスタム要素の定義が適用してアップグレードされる（これはおそらく、文字列"Kelvin"によって識別される画像フィルターの適用し、画像の視覚的外観を向上させることが含まれる ）。</p>

  <hr>

  <p><a href="#upgrades" id="custom-elements-upgrades-examples:upgrades-2">アップグレード</a>は文書ツリー内の要素にのみ適用されることに注意する。（正式には、<a id="custom-elements-upgrades-examples:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">接続される</a>要素。）文書に挿入されない要素は、アップグレードされないままである。例はこの点を説明する：</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Upgrade edge-cases example<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>example-element</c-><c- p>>&lt;/</c-><c- f>example-element</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- u>"use strict"</c-><c- p>;</c->

  <c- a>const</c-> inDocument <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->
  <c- a>const</c-> outOfDocument <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->

  <c- c1>// Before the element definition, both are HTMLElement:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->

  <c- a>class</c-> ExampleElement <c- k>extends</c-> HTMLElement <c- p>{}</c->
  customElements<c- p>.</c->define<c- p>(</c-><c- u>"example-element"</c-><c- p>,</c-> ExampleElement<c- p>);</c->

  <c- c1>// After element definition, the in-document element was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>));</c->

  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->outOfDocument<c- p>);</c->

  <c- c1>// Now that we've moved the element into the document, it too was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  <h4 id="custom-element-conformance"><span class="secno">4.13.2</span> カスタム要素のコンストラクターと反応の要件<a href="#custom-element-conformance" class="self-link"></a></h4>

  <p><a href="#custom-element-constructor" id="custom-element-conformance:custom-element-constructor">カスタム要素コンストラクター</a>をオーサリングするとき、著者は以下の適合性要件に拘束される：</p>

  <ul><li><p>それ以上のコードを実行する前に正しいプロトタイプチェーンおよび<b>this</b>値を確立するために、パラメーターレスの<code>super()</code>の呼び出しは、コンストラクター本体の最初のステートメントでなければならない。<li><p><code>return</code>ステートメントは、単純な早期復帰（<code>return</code> または<code>return this</code>）でない限り、コンストラクター本体のどこにも現れてはならない。<li><p>コンストラクターは<code id="custom-element-conformance:dom-document-write"><a href="dynamic-markup-insertion.html#dom-document-write">document.write()</a></code> または<code id="custom-element-conformance:dom-document-open"><a href="dynamic-markup-insertion.html#dom-document-open">document.open()</a></code>メソッドを使用してはならない。<li><p>非<a href="#upgrades" id="custom-element-conformance:upgrades">アップグレード</a>の場合は存在しないため、要素の属性および子は検査してはならず、アップグレードに依存すると、要素の使用が困難になる。<li><p>これは、<code id="custom-element-conformance:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement</a></code>または<code id="custom-element-conformance:dom-document-createelementns"><a data-x-internal="dom-document-createelementns" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns">createElementNS</a></code>メソッドを使用するコンシューマーの期待に違反するため、要素は属性または子を取得してはならない。<li><p>一般に、作業は可能な限り<code>connectedCallback</code>に延期されるべきであり、特にリソースのフェッチまたはレンダリングに関連する作業はそうである。しかし、<code>connectedCallback</code>は複数回呼び出すことができるため、本当に1回のみの初期化作業では、2回実行されないようにガードが必要になることに注意する。<li><p>一般に、コンストラクターは、初期状態およびデフォルト値を設定し、イベントリスナーおよび場合によっては<a id="custom-element-conformance:shadow-root" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-root" data-x-internal="shadow-root">シャドウルート</a>を設定するために使用されるべきである。</ul>

  <p>これらの要件のいくつかは、<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-element-conformance:create-an-element" data-x-internal="create-an-element">要素の作成中</a>に直接的または間接的のいずれかでチェックされ、それらに従わないと、パーサーまたはDOM APIによってインスタンス化できないカスタム要素をもたらす。これは、たとえコンストラクターによって開始された<a id="custom-element-conformance:microtask" href="webappapis.html#microtask">マイクロタスク</a>内で作業が行われるとしても当てはまる。<a href="webappapis.html#perform-a-microtask-checkpoint" id="custom-element-conformance:perform-a-microtask-checkpoint">マイクロタスクのチェックポイント</a>は、作成直後に発生する可能性があるためである。</p>

  <p><a href="#concept-custom-element-reaction" id="custom-element-conformance:concept-custom-element-reaction">カスタム要素反応</a>を作成する場合、予期しない結果が生じる可能性があるため、ノードツリーの操作を避けるべきである。</p>

  <div class="example"><p>要素の<code>connectedCallback</code>は、要素が切断される前にキューに入れることができるが、コールバックキューはまだ処理されているため、接続されなくなった要素の<code>connectedCallback</code>をもたらす：</p>

   <pre><code class='js'><c- a>class</c-> CParent <c- k>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->firstChild<c- p>.</c->remove<c- p>();</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-parent"</c-><c- p>,</c-> CParent<c- p>);</c->

<c- a>class</c-> CChild <c- k>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    console<c- p>.</c->log<c- p>(</c-><c- u>"CChild connectedCallback: isConnected ="</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->isConnected<c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-child"</c-><c- p>,</c-> CChild<c- p>);</c->

<c- a>const</c-> parent <c- o>=</c-> <c- k>new</c-> CParent<c- p>(),</c->
      child <c- o>=</c-> <c- k>new</c-> CChild<c- p>();</c->
parent<c- p>.</c->append<c- p>(</c->child<c- p>);</c->
document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->parent<c- p>);</c->

<c- c1>// Logs:</c->
<c- c1>// CChild connectedCallback: isConnected = false</c-></code></pre>
  </div>

  <h4 id="custom-elements-core-concepts"><span class="secno">4.13.3</span> コアコンセプト<a href="#custom-elements-core-concepts" class="self-link"></a></h4>

  <p><dfn id="custom-element" data-export="">カスタム要素</dfn>は、<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom" id="custom-elements-core-concepts:concept-element-custom" data-x-internal="concept-element-custom">カスタム</a>である要素となる。非公式には、そのコンストラクターおよびプロトタイプが、ユーザーエージェントによってではなく、著者によって定義されていることを意味する。この著者が提供するコンストラクター関数を<dfn id="custom-element-constructor" data-export="">カスタム要素コンストラクター</dfn>と呼ぶ。</p>

  <p>2つの異なるタイプの<a href="#custom-element" id="custom-elements-core-concepts:custom-element">カスタム要素</a>を定義できる：</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/is" title="The is global attribute allows you to specify that a standard HTML element should behave like a defined custom built-in element (see Using custom elements for more details).">Global_attributes/is</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera yes"><span>Opera</span><span>54+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><ol><li><p><dfn id="autonomous-custom-element" data-export="">自律カスタム要素</dfn>。これは、<code>extends</code>オプションなしで定義されている。 これらのタイプのカスタム要素は、<a href="#concept-custom-element-definition-name" id="custom-elements-core-concepts:concept-custom-element-definition-name">定義された名前</a>と同じローカル名を持つ。<li><p><dfn id="customized-built-in-element" data-export="">カスタマイズされた組み込み要素</dfn>。これは、<code>extends</code>オプションで定義されている。これらのタイプのカスタム要素は、<code>extends</code>オプションで渡される値と同じローカル名を持ち、<a href="#concept-custom-element-definition-name" id="custom-elements-core-concepts:concept-custom-element-definition-name-2">定義された名前</a>は<dfn data-dfn-for="html-global" id="attr-is" data-dfn-type="element-attr"><code>is</code></dfn>属性の値として使用され、したがってこれは<a href="#valid-custom-element-name" id="custom-elements-core-concepts:valid-custom-element-name">妥当なカスタム要素名</a>でなければならない。</ol>

  <p><a href="#custom-element" id="custom-elements-core-concepts:custom-element-2">カスタム要素</a>が<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-elements-core-concepts:create-an-element" data-x-internal="create-an-element">作成された</a>後、<code id="custom-elements-core-concepts:attr-is"><a href="#attr-is">is</a></code>属性の値を変更しても、<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value" id="custom-elements-core-concepts:concept-element-is-value" data-x-internal="concept-element-is-value"><code>is</code>値</a>として要素に保存されるため、要素の動作は変更されない。</p>

  <p><a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element">自律カスタム要素</a>は、以下の要素定義を持つ：</p>

  <dl class="element"><dt><a href="dom.html#concept-element-categories" id="custom-elements-core-concepts:concept-element-categories">カテゴリー</a>：<dd><a id="custom-elements-core-concepts:flow-content-2" href="dom.html#flow-content-2">フローコンテンツ</a>。<dd><a id="custom-elements-core-concepts:phrasing-content-2" href="dom.html#phrasing-content-2">フレージングコンテンツ</a>。<dd><a id="custom-elements-core-concepts:palpable-content-2" href="dom.html#palpable-content-2">パルパブルコンテンツ</a>。<dd><a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element">フォームに関連付けられたカスタム要素</a>の場合：<a href="forms.html#category-listed" id="custom-elements-core-concepts:category-listed">記載</a>、<a href="forms.html#category-label" id="custom-elements-core-concepts:category-label">ラベル付け可能</a>、<a href="forms.html#category-submit" id="custom-elements-core-concepts:category-submit">送信可能</a>、<a href="forms.html#category-reset" id="custom-elements-core-concepts:category-reset">リセット可能</a><a id="custom-elements-core-concepts:form-associated-element" href="forms.html#form-associated-element">フォームに関連付けられた要素</a>。<dt><a href="dom.html#concept-element-contexts" id="custom-elements-core-concepts:concept-element-contexts">この要素を使用できるコンテキスト</a>：<dd><a id="custom-elements-core-concepts:phrasing-content-2-2" href="dom.html#phrasing-content-2">フレージングコンテンツ</a>が期待される場所。<dt><a href="dom.html#concept-element-content-model" id="custom-elements-core-concepts:concept-element-content-model">コンテンツモデル</a>：<dd><a id="custom-elements-core-concepts:transparent" href="dom.html#transparent">透過的</a>。<dt><a href="dom.html#concept-element-attributes" id="custom-elements-core-concepts:concept-element-attributes">コンテンツ属性</a>：<dd><a id="custom-elements-core-concepts:global-attributes" href="dom.html#global-attributes">グローバル属性</a>、<code id="custom-elements-core-concepts:attr-is-2"><a href="#attr-is">is</a></code>属性を除く<dd><code id="custom-elements-core-concepts:attr-fae-form"><a href="form-control-infrastructure.html#attr-fae-form">form</a></code>、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-2">フォームに関連付けられたカスタム要素</a>の場合 — 要素を<code id="custom-elements-core-concepts:the-form-element"><a href="forms.html#the-form-element">form</a></code>要素に関連付ける<dd><code id="custom-elements-core-concepts:attr-fe-disabled"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code>、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-3">フォームに関連付けられたカスタム要素</a>の場合 — フォームコントロールが無効かどうか<dd><code id="custom-elements-core-concepts:attr-face-readonly"><a href="#attr-face-readonly">readonly</a></code>、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-4">フォームに関連付けられたカスタム要素</a>の場合 — <code id="custom-elements-core-concepts:dom-elementinternals-willvalidate"><a href="form-control-infrastructure.html#dom-elementinternals-willvalidate">willValidate</a></code>に影響し、カスタム要素の著者によって追加されたすべての動作<dd><code id="custom-elements-core-concepts:attr-fe-name"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code>、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-5">フォームに関連付けられたカスタム要素</a>の場合 — <a id="custom-elements-core-concepts:form-submission-2" href="form-control-infrastructure.html#form-submission-2">フォームの送信</a>および<code id="custom-elements-core-concepts:dom-form-elements"><a href="forms.html#dom-form-elements">form.elements</a></code>に使用する要素の名前<dd>名前空間を持たないその他の属性（文参照）。<dt><a href="dom.html#concept-element-accessibility-considerations" id="custom-elements-core-concepts:concept-element-accessibility-considerations">アクセシビリティの考慮</a>：<dd><a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-6">フォームに関連付けられたカスタム要素</a>の場合：<a href="https://momdo.github.io/html-aria/#el-form-associated-custom-element">著者向け</a>、<a href="https://w3c.github.io/html-aam/#el-form-associated-custom-element"> 実装者向け</a>。<dd>そうでなければ：<a href="https://momdo.github.io/html-aria/#el-autonomous-custom-element">著者向け</a>、<a href="https://w3c.github.io/html-aam/#el-autonomous-custom-element">実装者向け</a>。<dt><a href="dom.html#concept-element-dom" id="custom-elements-core-concepts:concept-element-dom">DOMインターフェイス</a>：<dd>要素の著者によって提供される（<code id="custom-elements-core-concepts:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code>から継承）</dl>


  <p><a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-2">自律カスタム要素</a>は特別な意味を持たない：その要素の子を<a id="custom-elements-core-concepts:represents" href="dom.html#represents">表す</a>。<a href="#customized-built-in-element" id="custom-elements-core-concepts:customized-built-in-element">カスタマイズされた組み込み要素</a>は、それが拡張した要素のセマンティクスを継承する。</p>

  <p>要素の著者によって決定された、要素の機能に関連する名前空間なしの属性は、属性名が<a id="custom-elements-core-concepts:xml-compatible" href="infrastructure.html#xml-compatible">XML互換</a>、かつ<a href="https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha" id="custom-elements-core-concepts:uppercase-ascii-letters" data-x-internal="uppercase-ascii-letters">ASCII大文字</a>を含まない限り、<a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-3">自律カスタム</a>要素上で指定してもよい。例外は<code id="custom-elements-core-concepts:attr-is-3"><a href="#attr-is">is</a></code>属性であり、これは<a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-4">自律カスタム要素</a>に指定してはならない（かつ指定しても何の効果もない）。</p>

  <p><a href="#customized-built-in-element" id="custom-elements-core-concepts:customized-built-in-element-2">カスタマイズされた組み込み要素</a>は、それらが拡張する要素に基づいて、属性に関する通常の要件に従う。カスタム属性ベースの動作を追加するには、<code id="custom-elements-core-concepts:attr-data-*"><a href="dom.html#attr-data-*">data-*</a></code>属性を使用する。</p>

  <hr>

  <p><a href="#concept-custom-element-definition-form-associated" id="custom-elements-core-concepts:concept-custom-element-definition-form-associated">フォーム関連</a>フィールドがtrueに設定されている<a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition">カスタム要素定義</a>に要素が関連付けられている場合、<a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-5">自律カスタム要素</a>は<dfn id="form-associated-custom-element" data-export="">フォームに関連付けられたカスタム要素</dfn>と呼ばれる。</p>

  <p><code id="custom-elements-core-concepts:attr-fe-name-2"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code>属性は、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-7">フォームに関連付けられたカスタム要素</a>の名前を表す。<code id="custom-elements-core-concepts:attr-fe-disabled-2"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code>属性は、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-8">フォームに関連付けられたカスタム要素</a>を非対話的にし、その<a href="#face-submission-value" id="custom-elements-core-concepts:face-submission-value">送信値</a>が送信されないようにするために使用される。<code id="custom-elements-core-concepts:attr-fae-form-2"><a href="form-control-infrastructure.html#attr-fae-form">form</a></code>属性は、<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-9">フォームに関連付けられたカスタム要素</a>をその<a id="custom-elements-core-concepts:form-owner" href="form-control-infrastructure.html#form-owner">フォーム所有者</a>に明示的に関連付けるために使用される。</p>

  <p><a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-10">フォームに関連付けられたカスタム要素</a>の<dfn data-dfn-for="form-associated custom elements" id="attr-face-readonly" data-dfn-type="element-attr"><code>readonly</code></dfn>属性は、要素が<a id="custom-elements-core-concepts:barred-from-constraint-validation" href="form-control-infrastructure.html#barred-from-constraint-validation">制約検証から除外される</a>ことを指定する。ユーザーエージェントはこの属性のための他の動作を提供しないが、カスタム要素の著者は、可能であれば、組み込みフォームコントロール上の<a href="input.html#attr-input-readonly" id="custom-elements-core-concepts:attr-input-readonly">readonly</a>属性の動作と同様に、何らかの適切な方法でコントロールを編集不能にするために、その存在を使用すべきである。</p>

  <p><strong>制約検証</strong>。<a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-11">フォームに関連付けられたカスタム要素</a>に<code id="custom-elements-core-concepts:attr-face-readonly-2"><a href="#attr-face-readonly">readonly</a></code>属性が指定されている場合、その要素は<a id="custom-elements-core-concepts:barred-from-constraint-validation-2" href="form-control-infrastructure.html#barred-from-constraint-validation">制約検証から除外される</a>。</p>

  <p><a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-12">フォームに関連付けられたカスタム要素</a>の<a href="form-control-infrastructure.html#concept-form-reset-control" id="custom-elements-core-concepts:concept-form-reset-control">リセットアルゴリズム</a>は、要素、コールバック名"<code>formResetCallback</code>"、および空の引数リストをもつ<a href="#enqueue-a-custom-element-callback-reaction" id="custom-elements-core-concepts:enqueue-a-custom-element-callback-reaction">カスタム要素のコールバック反応をキューに加える</a>ことである。</p>

  <hr>

  <p><dfn id="valid-custom-element-name" data-export="">妥当なカスタム要素名</dfn>は、次のすべての要件を満たす一連の文字<var>名</var>である：</p>

  <ul><li><p><var>名前</var>は<code id="custom-elements-core-concepts:prod-potentialcustomelementname"><a href="#prod-potentialcustomelementname">PotentialCustomElementName</a></code>生成物と一致しなければならない：</p>

    <dl><dt><code><dfn id="prod-potentialcustomelementname">PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] (<a href="#prod-pcenchar" id="custom-elements-core-concepts:prod-pcenchar">PCENChar</a>)* '-' (<a href="#prod-pcenchar" id="custom-elements-core-concepts:prod-pcenchar-2">PCENChar</a>)*</code><dt><code><dfn id="prod-pcenchar">PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]</code></dl>

    <p>これは、<cite>XML</cite>仕様由来の<a href="http://w4ard.eplusx.net/translation/W3C/REC-xml-20081126/#sec-notation">EBNF notation</a>を使用している。<a href="references.html#refsXML">[XML]</a></p>
   <li><p><var>名前</var>は次のいずれであってはならない：</p>

    <ul class="brief"><li><code>annotation-xml</code><li><code>color-profile</code><li><code>font-face</code><li><code>font-face-src</code><li><code>font-face-uri</code><li><code>font-face-format</code><li><code>font-face-name</code><li><code>missing-glyph</code></ul>

    <p class="note">上記の名前のリストは、<a href="infrastructure.html#other-applicable-specifications" id="custom-elements-core-concepts:other-applicable-specifications">適用可能な仕様</a>、つまり<cite>SVG 2</cite>および<cite>MathML</cite>由来のすべてのハイフンを含む要素名の要約である。<a href="references.html#refsSVG">[SVG]</a> <a href="references.html#refsMATHML">[MATHML]</a></p>
   </ul>

  <div class="note"><p>これらの要件により、<a href="#valid-custom-element-name" id="custom-elements-core-concepts:valid-custom-element-name-2">妥当なカスタム要素名</a>の多数の目標が保証される。</p>

   <ul><li><p>それらは<a id="custom-elements-core-concepts:lowercase-ascii-letters" href="https://triple-underscore.github.io/infra-ja.html#ascii-lower-alpha" data-x-internal="lowercase-ascii-letters">ASCII小文字</a>で開始し、HTMLパーサーがそれらをテキストではなくタグとして扱うことを保証する。<li><p>それらは<a href="https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha" id="custom-elements-core-concepts:uppercase-ascii-letters-2" data-x-internal="uppercase-ascii-letters">ASCII大文字</a>が含まれないため、ユーザーエージェントは常にHTML要素を大文字・小文字不区別で扱うことができる。<li><p>名前空間および前方互換性を確保するために使用されるハイフンを含む（将来、ハイフンを含むローカル名を持つHTML、SVG、またはMathMLに要素が追加されなくなるため）。<li><p>それらは常に<code id="custom-elements-core-concepts:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement()</a></code>および<code id="custom-elements-core-concepts:dom-document-createelementns"><a data-x-internal="dom-document-createelementns" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns">createElementNS()</a></code>で作成できるが、これらにはパーサーの制限を超える制限がある。</ul>

   <p>これらの制限とは別に、<code>&lt;math-α></code>や<code>&lt;emotion-😍></code>などのユースケースに最大源の柔軟性を与えるために、さまざまな名前が許可されている。</p>
  </div>

  

  <p>A <dfn id="custom-element-definition">custom element definition</dfn> describes a <a href="#custom-element" id="custom-elements-core-concepts:custom-element-3">custom element</a> and consists of:</p>

  <dl><dt>A <dfn data-dfn-for="custom element definition" id="concept-custom-element-definition-name" data-export="">name</dfn><dd>A <a href="#valid-custom-element-name" id="custom-elements-core-concepts:valid-custom-element-name-3">valid custom element name</a><dt>A <dfn data-dfn-for="custom element definition" id="concept-custom-element-definition-local-name" data-export="">local name</dfn><dd>A local name<dt>A <dfn data-dfn-for="custom element definition" id="concept-custom-element-definition-constructor" data-export="">constructor</dfn><dd>A Web IDL <code id="custom-elements-core-concepts:customelementconstructor"><a href="#customelementconstructor">CustomElementConstructor</a></code> callback function type value wrapping the <a href="#custom-element-constructor" id="custom-elements-core-concepts:custom-element-constructor">custom element constructor</a><dt>A list of <dfn id="concept-custom-element-definition-observed-attributes">observed attributes</dfn><dd>A <code>sequence&lt;DOMString></code><dt>A collection of <dfn id="concept-custom-element-definition-lifecycle-callbacks">lifecycle callbacks</dfn><dd>A map, whose keys are the strings "<code>connectedCallback</code>", "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", "<code>attributeChangedCallback</code>", "<code>formAssociatedCallback</code>", "<code>formDisabledCallback</code>", "<code>formResetCallback</code>", and "<code>formStateRestoreCallback</code>". The corresponding values are either a Web IDL <code id="custom-elements-core-concepts:idl-function"><a data-x-internal="idl-function" href="https://triple-underscore.github.io/WebIDL-ja.html#common-Function">Function</a></code> callback function type value, or null. By default the value of each entry is null.<dt>A <dfn id="concept-custom-element-definition-construction-stack">construction stack</dfn><dd>A list, initially empty, that is manipulated by the <a href="#concept-upgrade-an-element" id="custom-elements-core-concepts:concept-upgrade-an-element">upgrade an element</a> algorithm and the <a href="dom.html#html-element-constructors">HTML element constructors</a>. Each entry in the list will be either an element or an <dfn id="concept-already-constructed-marker"><i>already constructed</i> marker</dfn>.<dt>A <dfn id="concept-custom-element-definition-form-associated">form-associated</dfn> boolean<dd>If this is true, user agent treats elements associated to this <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-2">custom element definition</a> as <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-13">form-associated custom elements</a>.<dt>A <dfn id="concept-custom-element-definition-disable-internals">disable internals</dfn> boolean<dd>Controls <code id="custom-elements-core-concepts:dom-attachinternals"><a href="#dom-attachinternals">attachInternals()</a></code>.<dt>A <dfn data-dfn-for="custom element definition" id="concept-custom-element-definition-disable-shadow" data-export="">disable shadow</dfn> boolean<dd>Controls <code id="custom-elements-core-concepts:dom-element-attachshadow"><a data-x-internal="dom-element-attachshadow" href="https://triple-underscore.github.io/DOM4-ja.html#dom-element-attachshadow">attachShadow()</a></code>.</dl>

  <p>To <dfn id="look-up-a-custom-element-definition" data-export="">look up a custom element definition</dfn>, given a <var>document</var>, <var>namespace</var>, <var>localName</var>, and <var>is</var>, perform the following steps. They will return either a <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-3">custom element definition</a> or null:</p>

  <ol><li><p>If <var>namespace</var> is not the <a id="custom-elements-core-concepts:html-namespace-2" href="https://triple-underscore.github.io/infra-ja.html#html-namespace" data-x-internal="html-namespace-2">HTML namespace</a>, return null.<li><p>If <var>document</var>'s <a href="browsers.html#concept-document-bc" id="custom-elements-core-concepts:concept-document-bc">browsing context</a> is null, return null.<li><p>Let <var>registry</var> be <var>document</var>'s <a id="custom-elements-core-concepts:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a>'s <code id="custom-elements-core-concepts:customelementregistry"><a href="#customelementregistry">CustomElementRegistry</a></code> object.<li><p>If there is <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-4">custom element definition</a> in <var>registry</var> with <a href="#concept-custom-element-definition-name" id="custom-elements-core-concepts:concept-custom-element-definition-name-3">name</a> and <a href="#concept-custom-element-definition-local-name" id="custom-elements-core-concepts:concept-custom-element-definition-local-name">local name</a> both equal to <var>localName</var>, return that <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-5">custom element definition</a>.<li><p>If there is a <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-6">custom element definition</a> in <var>registry</var> with <a href="#concept-custom-element-definition-name" id="custom-elements-core-concepts:concept-custom-element-definition-name-4">name</a> equal to <var>is</var> and <a href="#concept-custom-element-definition-local-name" id="custom-elements-core-concepts:concept-custom-element-definition-local-name-2">local name</a> equal to <var>localName</var>, return that <a href="#custom-element-definition" id="custom-elements-core-concepts:custom-element-definition-7">custom element definition</a>.<li><p>Return null.</ol>

  

  <h4 id="custom-elements-api"><span class="secno">4.13.4</span> <code id="custom-elements-api:customelementregistry"><a href="#customelementregistry">CustomElementRegistry</a></code>インターフェイス<a href="#custom-elements-api" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry" title="The CustomElementRegistry interface provides methods for registering custom elements and querying registered elements. To get an instance of it, use the window.customElements property.">CustomElementRegistry</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span></div></div></div>

  <p>Each <code id="custom-elements-api:window"><a href="window-object.html#window">Window</a></code> object is associated with a unique instance of a <code id="custom-elements-api:customelementregistry-2"><a href="#customelementregistry">CustomElementRegistry</a></code> object, allocated when the <code id="custom-elements-api:window-2"><a href="window-object.html#window">Window</a></code> object is created.</p>

  <p class="note">各<a href="#custom-element-constructor" id="custom-elements-api:custom-element-constructor">カスタム要素コンストラクター</a>は<code id="custom-elements-api:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code>インターフェイスを継承しており、<code id="custom-elements-api:window-4"><a href="window-object.html#window">Window</a></code>オブジェクトごとに正確に1 つの<code id="custom-elements-api:htmlelement-2"><a href="dom.html#htmlelement">HTMLElement</a></code>インターフェイスが存在するため、カスタム要素レジストリは<code id="custom-elements-api:document"><a href="dom.html#document">Document</a></code> オブジェクトの代わりに、<code id="custom-elements-api:window-3"><a href="window-object.html#window">Window</a></code>オブジェクトに関連付けられる。</p>

  

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/customElements" title="The customElements read-only property of the Window interface returns a reference to the CustomElementRegistry object, which can be used to register new custom elements and get information about previously registered custom elements.">Window/customElements</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span></div></div></div><p>The <dfn data-dfn-for="Window" id="dom-window-customelements" data-dfn-type="attribute"><code>customElements</code></dfn> attribute of the <code id="custom-elements-api:window-5"><a href="window-object.html#window">Window</a></code> interface must return the <code id="custom-elements-api:customelementregistry-3"><a href="#customelementregistry">CustomElementRegistry</a></code> object for that <code id="custom-elements-api:window-6"><a href="window-object.html#window">Window</a></code> object.</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='customelementregistry' data-dfn-type='interface'><c- g>CustomElementRegistry</c-></dfn> {
  [<a href='#cereactions' id='custom-elements-api:cereactions'><c- g>CEReactions</c-></a>] <c- b>undefined</c-> <a href='#dom-customelementregistry-define' id='custom-elements-api:dom-customelementregistry-define'><c- g>define</c-></a>(<c- b>DOMString</c-> <c- g>name</c->, <a href='#customelementconstructor' id='custom-elements-api:customelementconstructor'><c- n>CustomElementConstructor</c-></a> <c- g>constructor</c->, <c- b>optional</c-> <a href='#elementdefinitionoptions' id='custom-elements-api:elementdefinitionoptions'><c- n>ElementDefinitionOptions</c-></a> <c- g>options</c-> = {});
  (<a href='#customelementconstructor' id='custom-elements-api:customelementconstructor-2'><c- n>CustomElementConstructor</c-></a> <c- b>or</c-> <c- b>undefined</c->) <a href='#dom-customelementregistry-get' id='custom-elements-api:dom-customelementregistry-get'><c- g>get</c-></a>(<c- b>DOMString</c-> <c- g>name</c->);
  <c- b>Promise</c->&lt;<a href='#customelementconstructor' id='custom-elements-api:customelementconstructor-3'><c- n>CustomElementConstructor</c-></a>> <a href='#dom-customelementregistry-whendefined' id='custom-elements-api:dom-customelementregistry-whendefined'><c- g>whenDefined</c-></a>(<c- b>DOMString</c-> <c- g>name</c->);
  [<a href='#cereactions' id='custom-elements-api:cereactions-2'><c- g>CEReactions</c-></a>] <c- b>undefined</c-> <a href='#dom-customelementregistry-upgrade' id='custom-elements-api:dom-customelementregistry-upgrade'><c- g>upgrade</c-></a>(<a id='custom-elements-api:node' href='https://triple-underscore.github.io/DOM4-ja.html#interface-node' data-x-internal='node'><c- n>Node</c-></a> <c- g>root</c->);
};

<c- b>callback</c-> <dfn id='customelementconstructor' data-dfn-type='callback'><c- g>CustomElementConstructor</c-></dfn> = <a id='custom-elements-api:htmlelement-3' href='dom.html#htmlelement'><c- n>HTMLElement</c-></a> ();

<c- b>dictionary</c-> <dfn id='elementdefinitionoptions' data-dfn-type='dictionary'><c- g>ElementDefinitionOptions</c-></dfn> {
  <c- b>DOMString</c-> <c- g>extends</c->;
};</code></pre>

  <p>Every <code id="custom-elements-api:customelementregistry-4"><a href="#customelementregistry">CustomElementRegistry</a></code> has a set of <a href="#custom-element-definition" id="custom-elements-api:custom-element-definition">custom element definitions</a>, initially empty. In general, algorithms in this specification look up elements in the registry by any of <a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name">name</a>, <a href="#concept-custom-element-definition-local-name" id="custom-elements-api:concept-custom-element-definition-local-name">local name</a>, or <a href="#concept-custom-element-definition-constructor" id="custom-elements-api:concept-custom-element-definition-constructor">constructor</a>.</p>

  <p>Every <code id="custom-elements-api:customelementregistry-5"><a href="#customelementregistry">CustomElementRegistry</a></code> also has an <dfn id="element-definition-is-running">element definition is running</dfn> flag which is used to prevent reentrant invocations of <a href="#element-definition" id="custom-elements-api:element-definition">element definition</a>. It is initially unset.</p>

  <p>Every <code id="custom-elements-api:customelementregistry-6"><a href="#customelementregistry">CustomElementRegistry</a></code> also has a <dfn id="when-defined-promise-map">when-defined promise map</dfn>, mapping <a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name">valid custom element names</a> to promises. It is used to implement the <code id="custom-elements-api:dom-customelementregistry-whendefined-2"><a href="#dom-customelementregistry-whendefined">whenDefined()</a></code> method.</p>

  

  <dl class="domintro"><dt><var>window</var> . <code id="custom-elements-api:dom-window-customelements"><a href="#dom-window-customelements">customElements</a></code> . <code id="dom-customelementregistry-define-dev"><a href="#dom-customelementregistry-define">define</a></code>(<var>name</var>, <var>constructor</var>)<div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define" title="The define() method of the CustomElementRegistry interface defines a new custom element.">CustomElementRegistry/define</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera yes"><span>Opera</span><span>54+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><dd>指定された名前を指定されたコンストラクターに<a href="#autonomous-custom-element" id="custom-elements-api:autonomous-custom-element">自律カスタム要素</a>としてマッピングする、新しい<a href="#custom-element" id="custom-elements-api:custom-element">カスタム要素</a>を定義する。<dt><var>window</var> . <code id="custom-elements-api:dom-window-customelements-2"><a href="#dom-window-customelements">customElements</a></code> . <code id="custom-elements-api:dom-customelementregistry-define-2"><a href="#dom-customelementregistry-define">define</a></code>(<var>name</var>, <var>constructor</var>, { extends: <var>baseLocalName</var> })<dd>指定された名前を指定されたコンストラクターに、提供された<var>baseLocalName</var>で識別される<a id="custom-elements-api:element-type" href="infrastructure.html#element-type">要素タイプ</a>の<a href="#customized-built-in-element" id="custom-elements-api:customized-built-in-element">カスタマイズされた組み込み要素</a>としてマッピングする、<a href="#custom-element" id="custom-elements-api:custom-element-2">新しいカスタム要素</a>を定義する。<a href="#custom-element" id="custom-elements-api:custom-element-3">カスタム要素</a>または不明な要素を拡張しようとすると、<a id="custom-elements-api:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>が投げられる。<dt><var>window</var> . <code id="custom-elements-api:dom-window-customelements-3"><a href="#dom-window-customelements">customElements</a></code> . <code id="dom-customelementregistry-get-dev"><a href="#dom-customelementregistry-get">get</a></code>(<var>name</var>)<div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/get" title="The get() method of the CustomElementRegistry interface returns the constructor for a previously-defined custom element.">CustomElementRegistry/get</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera yes"><span>Opera</span><span>54+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><dd>指定された<a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-2">名前</a>に対して定義された<a href="#custom-element-constructor" id="custom-elements-api:custom-element-constructor-2">カスタム要素コンストラクター</a>を回収する。指定された<a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-3">名前</a>の<a href="#custom-element-definition" id="custom-elements-api:custom-element-definition-2">カスタム要素定義</a>がない場合、undefinedを返す。<dt><var>window</var> . <code id="custom-elements-api:dom-window-customelements-4"><a href="#dom-window-customelements">customElements</a></code> . <code id="dom-customelementregistry-whendefined-dev"><a href="#dom-customelementregistry-whendefined">whenDefined</a></code>(<var>name</var>)<div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/whenDefined" title="The whenDefined() method of the CustomElementRegistry interface returns a Promise that resolves when the named element is defined.">CustomElementRegistry/whenDefined</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera yes"><span>Opera</span><span>54+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><dd><a href="#custom-element" id="custom-elements-api:custom-element-5">カスタム要素</a>が指定された名前で定義されたときに<a href="#custom-element" id="custom-elements-api:custom-element-4">カスタム要素</a>のコンストラクターで満たされるプロミスを返す。 （そのような<a href="#custom-element" id="custom-elements-api:custom-element-6">カスタム要素</a>がすでに定義されている場合、返されたプロミスはすぐに満たされる。）<a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name-2">妥当なカスタム要素名</a>が指定されない場合、 <a id="custom-elements-api:syntaxerror" href="https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="custom-elements-api:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>で拒否されたプロミスを返す。<dt><var>window</var> . <code id="custom-elements-api:dom-window-customelements-5"><a href="#dom-window-customelements">customElements</a></code> . <code id="dom-customelementregistry-upgrade-dev"><a href="#dom-customelementregistry-upgrade">upgrade</a></code>(<var>root</var>)<div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/upgrade" title="The upgrade() method of the CustomElementRegistry interface upgrades all shadow-containing custom elements in a Node subtree, even before they are connected to the main document.">CustomElementRegistry/upgrade</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>12.1+</span></span><span class="chrome yes"><span>Chrome</span><span>68+</span></span><hr><span class="opera yes"><span>Opera</span><span>55+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>12.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>68+</span></span><span class="webview_android yes"><span>WebView Android</span><span>68+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>10.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><dd>たとえ<a id="custom-elements-api:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">接続されて</a>いないとしても、<var>ルート</var>の<a id="custom-elements-api:shadow-including-inclusive-descendant" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-inclusive-descendant" data-x-internal="shadow-including-inclusive-descendant">シャドウを含むすべての子孫</a>要素を<a href="#concept-try-upgrade" id="custom-elements-api:concept-try-upgrade">アップグレードしようとする</a>。</dl>

  <p><dfn id="element-definition">Element definition</dfn> is a process of adding a <a href="#custom-element-definition" id="custom-elements-api:custom-element-definition-3">custom element definition</a> to the <code id="custom-elements-api:customelementregistry-7"><a href="#customelementregistry">CustomElementRegistry</a></code>. This is accomplished by the <code id="custom-elements-api:dom-customelementregistry-define-3"><a href="#dom-customelementregistry-define">define()</a></code> method. When invoked, the <dfn data-dfn-for="CustomElementRegistry" id="dom-customelementregistry-define" data-dfn-type="method"><code>define(<var>name</var>, <var>constructor</var>, <var>options</var>)</code></dfn> method must run these steps:</p>

  

  <ol><li><p>If <a id="custom-elements-api:isconstructor" href="https://tc39.es/ecma262/#sec-isconstructor" data-x-internal="isconstructor">IsConstructor</a>(<var>constructor</var>) is false, then throw a <code id="custom-elements-api:typeerror"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code>.<li><p>If <var>name</var> is not a <a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name-3">valid custom element name</a>, then throw a <a id="custom-elements-api:syntaxerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="custom-elements-api:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If this <code id="custom-elements-api:customelementregistry-8"><a href="#customelementregistry">CustomElementRegistry</a></code> contains an entry with <a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-4">name</a> <var>name</var>, then throw a <a id="custom-elements-api:notsupportederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If this <code id="custom-elements-api:customelementregistry-9"><a href="#customelementregistry">CustomElementRegistry</a></code> contains an entry with <a href="#concept-custom-element-definition-constructor" id="custom-elements-api:concept-custom-element-definition-constructor-2">constructor</a> <var>constructor</var>, then throw a <a id="custom-elements-api:notsupportederror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception-5"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>localName</var> be <var>name</var>.<li><p>Let <var>extends</var> be the value of the <code>extends</code> member of <var>options</var>, or null if no such member exists.<li><p>If <var>extends</var> is not null, then:</p>

    <ol><li><p>If <var>extends</var> is a <a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name-4">valid custom element name</a>, then throw a <a id="custom-elements-api:notsupportederror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception-6"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If the <a id="custom-elements-api:element-interface" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface" data-x-internal="element-interface">element interface</a> for <var>extends</var> and the <a id="custom-elements-api:html-namespace-2" href="https://triple-underscore.github.io/infra-ja.html#html-namespace" data-x-internal="html-namespace-2">HTML namespace</a> is <code id="custom-elements-api:htmlunknownelement"><a href="dom.html#htmlunknownelement">HTMLUnknownElement</a></code> (e.g., if <var>extends</var> does not indicate an element definition in this specification), then throw a <a id="custom-elements-api:notsupportederror-5" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception-7"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>localName</var> to <var>extends</var>.</ol>
   <li><p>If this <code id="custom-elements-api:customelementregistry-10"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#element-definition-is-running" id="custom-elements-api:element-definition-is-running">element definition is running</a> flag is set, then throw a <a id="custom-elements-api:notsupportederror-6" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception-8"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set this <code id="custom-elements-api:customelementregistry-11"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#element-definition-is-running" id="custom-elements-api:element-definition-is-running-2">element definition is running</a> flag.<li><p>Let <var>formAssociated</var> be false.<li><p>Let <var>disableInternals</var> be false.<li><p>Let <var>disableShadow</var> be false.<li><p>Let <var>observedAttributes</var> be an empty <code>sequence&lt;DOMString></code>.<li><p>Run the following substeps while catching any exceptions:</p>

    <ol><li><p>Let <var>prototype</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get" data-x-internal="js-get">Get</a>(<var>constructor</var>, "prototype"). 例外を再度投げる。<li><p>If <a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="custom-elements-api:js-type" data-x-internal="js-type">Type</a>(<var>prototype</var>) is not Object, then throw a <code id="custom-elements-api:typeerror-2"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code> exception.<li><p>Let <var>lifecycleCallbacks</var> be a map with the keys "<code>connectedCallback</code>", "<code>disconnectedCallback</code>", "<code>adoptedCallback</code>", and "<code>attributeChangedCallback</code>", each of which belongs to an entry whose value is null.</p>

     <li><p>For each of the keys <var>callbackName</var> in <var>lifecycleCallbacks</var>, in the order listed in the previous step:</p>

      <ol><li><p>Let <var>callbackValue</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get-2" data-x-internal="js-get">Get</a>(<var>prototype</var>, <var>callbackName</var>). 例外を再度投げる。</p>

       <li><p>If <var>callbackValue</var> is not undefined, then set the value of the entry in <var>lifecycleCallbacks</var> with key <var>callbackName</var> to the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="custom-elements-api:concept-idl-convert" data-x-internal="concept-idl-convert">converting</a> <var>callbackValue</var> to the Web IDL <code id="custom-elements-api:idl-function"><a data-x-internal="idl-function" href="https://triple-underscore.github.io/WebIDL-ja.html#common-Function">Function</a></code> callback type. Rethrow any exceptions from the conversion.</ol>
     <li><p>If the value of the entry in <var>lifecycleCallbacks</var> with key "<code>attributeChangedCallback</code>" is not null, then:</p>

      <ol><li><p>Let <var>observedAttributesIterable</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get-3" data-x-internal="js-get">Get</a>(<var>constructor</var>, "observedAttributes"). 例外を再度投げる。<li><p>If <var>observedAttributesIterable</var> is not undefined, then set <var>observedAttributes</var> to the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="custom-elements-api:concept-idl-convert-2" data-x-internal="concept-idl-convert">converting</a> <var>observedAttributesIterable</var> to a <code>sequence&lt;DOMString></code>. Rethrow any exceptions from the conversion.</ol>

     <li><p>Let <var>disabledFeatures</var> be an empty <code>sequence&lt;DOMString></code>.<li><p>Let <var>disabledFeaturesIterable</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get-4" data-x-internal="js-get">Get</a>(<var>constructor</var>, "disabledFeatures"). 例外を再度投げる。<li><p>If <var>disabledFeaturesIterable</var> is not undefined, then set <var>disabledFeatures</var> to the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="custom-elements-api:concept-idl-convert-3" data-x-internal="concept-idl-convert">converting</a> <var>disabledFeaturesIterable</var> to a <code>sequence&lt;DOMString></code>. Rethrow any exceptions from the conversion.<li><p>Set <var>disableInternals</var> to true if <var>disabledFeatures</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="custom-elements-api:list-contains" data-x-internal="list-contains">contains</a> "<code>internals</code>".<li><p>Set <var>disableShadow</var> to true if <var>disabledFeatures</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="custom-elements-api:list-contains-2" data-x-internal="list-contains">contains</a> "<code>shadow</code>".<li><p>Let <var>formAssociatedValue</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get-5" data-x-internal="js-get">Get</a>( <var>constructor</var>, "formAssociated"). 例外を再度投げる。<li><p>Set <var>formAssociated</var> to the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="custom-elements-api:concept-idl-convert-4" data-x-internal="concept-idl-convert">converting</a> <var>formAssociatedValue</var> to a <code>boolean</code>. Rethrow any exceptions from the conversion.<li><p>If <var>formAssociated</var> is true, for each of "<code>formAssociatedCallback</code>", "<code>formResetCallback</code>", "<code>formDisabledCallback</code>", and "<code>formStateRestoreCallback</code>" <var>callbackName</var>:</p>

      <ol><li><p>Let <var>callbackValue</var> be <a href="https://tc39.es/ecma262/#sec-get-o-p" id="custom-elements-api:js-get-6" data-x-internal="js-get">Get</a>(<var>prototype</var>, <var>callbackName</var>). 例外を再度投げる。<li><p>If <var>callbackValue</var> is not undefined, then set the value of the entry in <var>lifecycleCallbacks</var> with key <var>callbackName</var> to the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="custom-elements-api:concept-idl-convert-5" data-x-internal="concept-idl-convert">converting</a> <var>callbackValue</var> to the Web IDL <code id="custom-elements-api:idl-function-2"><a data-x-internal="idl-function" href="https://triple-underscore.github.io/WebIDL-ja.html#common-Function">Function</a></code> callback type. Rethrow any exceptions from the conversion.</ol>
     </ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception or not:</p>

    <ol><li><p>Unset this <code id="custom-elements-api:customelementregistry-12"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#element-definition-is-running" id="custom-elements-api:element-definition-is-running-3">element definition is running</a> flag.</ol>

    <p>Finally, if the first set of substeps threw an exception, then rethrow that exception (thus terminating this algorithm). Otherwise, continue onward.</p>
   <li><p>Let <var>definition</var> be a new <a href="#custom-element-definition" id="custom-elements-api:custom-element-definition-4">custom element definition</a> with <a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-5">name</a> <var>name</var>, <a href="#concept-custom-element-definition-local-name" id="custom-elements-api:concept-custom-element-definition-local-name-2">local name</a> <var>localName</var>, <a href="#concept-custom-element-definition-constructor" id="custom-elements-api:concept-custom-element-definition-constructor-3">constructor</a> <var>constructor</var>, <a href="#concept-custom-element-definition-observed-attributes" id="custom-elements-api:concept-custom-element-definition-observed-attributes">observed attributes</a> <var>observedAttributes</var>, <a href="#concept-custom-element-definition-lifecycle-callbacks" id="custom-elements-api:concept-custom-element-definition-lifecycle-callbacks">lifecycle callbacks</a> <var>lifecycleCallbacks</var>, <a href="#concept-custom-element-definition-form-associated" id="custom-elements-api:concept-custom-element-definition-form-associated">form-associated</a> <var>formAssociated</var>, <a href="#concept-custom-element-definition-disable-internals" id="custom-elements-api:concept-custom-element-definition-disable-internals">disable internals</a> <var>disableInternals</var>, and <a href="#concept-custom-element-definition-disable-shadow" id="custom-elements-api:concept-custom-element-definition-disable-shadow">disable shadow</a> <var>disableShadow</var>.<li><p>Add <var>definition</var> to this <code id="custom-elements-api:customelementregistry-13"><a href="#customelementregistry">CustomElementRegistry</a></code>.<li><p>Let <var>document</var> be this <code id="custom-elements-api:customelementregistry-14"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a id="custom-elements-api:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a>'s <a href="window-object.html#concept-document-window" id="custom-elements-api:concept-document-window">associated <code>Document</code></a>.<li><p>Let <var>upgrade candidates</var> be all elements that are <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-descendant" id="custom-elements-api:shadow-including-descendant" data-x-internal="shadow-including-descendant">shadow-including descendants</a> of <var>document</var>, whose namespace is the <a id="custom-elements-api:html-namespace-2-2" href="https://triple-underscore.github.io/infra-ja.html#html-namespace" data-x-internal="html-namespace-2">HTML namespace</a> and whose local name is <var>localName</var>, in <a id="custom-elements-api:shadow-including-tree-order" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order" data-x-internal="shadow-including-tree-order">shadow-including tree order</a>. Additionally, if <var>extends</var> is non-null, only include elements whose <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value" id="custom-elements-api:concept-element-is-value" data-x-internal="concept-element-is-value"><code>is</code> value</a> is equal to <var>name</var>.<li><p>For each element <var>element</var> in <var>upgrade candidates</var>, <a href="#enqueue-a-custom-element-upgrade-reaction" id="custom-elements-api:enqueue-a-custom-element-upgrade-reaction">enqueue a custom element upgrade reaction</a> given <var>element</var> and <var>definition</var>.<li><p>If this <code id="custom-elements-api:customelementregistry-15"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#when-defined-promise-map" id="custom-elements-api:when-defined-promise-map">when-defined promise map</a> contains an entry with key <var>name</var>:</p>

    <ol><li><p>Let <var>promise</var> be the value of that entry.<li><p>Resolve <var>promise</var> with <var>constructor</var>.<li><p>Delete the entry with key <var>name</var> from this <code id="custom-elements-api:customelementregistry-16"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#when-defined-promise-map" id="custom-elements-api:when-defined-promise-map-2">when-defined promise map</a>.</ol>
   </ol>

  <p>When invoked, the <dfn data-dfn-for="CustomElementRegistry" id="dom-customelementregistry-get" data-dfn-type="method"><code>get(<var>name</var>)</code></dfn> method must run these steps:</p>

  <ol><li><p>If this <code id="custom-elements-api:customelementregistry-17"><a href="#customelementregistry">CustomElementRegistry</a></code> contains an entry with <a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-6">name</a> <var>name</var>, then return that entry's <a href="#concept-custom-element-definition-constructor" id="custom-elements-api:concept-custom-element-definition-constructor-4">constructor</a>.<li><p>Otherwise, return undefined.</ol>

  <p>When invoked, the <dfn data-dfn-for="CustomElementRegistry" id="dom-customelementregistry-whendefined" data-dfn-type="method"><code>whenDefined(<var>name</var>)</code></dfn> method must run these steps:</p>

  <ol><li><p>If <var>name</var> is not a <a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name-5">valid custom element name</a>, then return a new promise rejected with a <a id="custom-elements-api:syntaxerror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="custom-elements-api:domexception-9"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If this <code id="custom-elements-api:customelementregistry-18"><a href="#customelementregistry">CustomElementRegistry</a></code> contains an entry with <a href="#concept-custom-element-definition-name" id="custom-elements-api:concept-custom-element-definition-name-7">name</a> <var>name</var>, then return a new promise resolved with that entry's <a href="#concept-custom-element-definition-constructor" id="custom-elements-api:concept-custom-element-definition-constructor-5">constructor</a>.<li><p>Let <var>map</var> be this <code id="custom-elements-api:customelementregistry-19"><a href="#customelementregistry">CustomElementRegistry</a></code>'s <a href="#when-defined-promise-map" id="custom-elements-api:when-defined-promise-map-3">when-defined promise map</a>.<li><p>If <var>map</var> does not contain an entry with key <var>name</var>, create an entry in <var>map</var> with key <var>name</var> and whose value is a new promise.<li><p>Let <var>promise</var> be the value of the entry in <var>map</var> with key <var>name</var>.<li><p>Return <var>promise</var>.</ol>

  

  <div class="example"><p><code id="custom-elements-api:dom-customelementregistry-whendefined-3"><a href="#dom-customelementregistry-whendefined">whenDefined()</a></code>メソッドを使用して、すべての適切な<a href="#custom-element" id="custom-elements-api:custom-element-7">カスタム要素</a>が<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-defined" id="custom-elements-api:concept-element-defined" data-x-internal="concept-element-defined">定義される</a>まで、アクションを実行しないようにすることができる。この例において、使用する<a href="#autonomous-custom-element" id="custom-elements-api:autonomous-custom-element-2">自律カスタム要素</a>のすべてが定義されるまで、動的に読み込まれる記事のコンテンツを非表示するために、それを<code id="custom-elements-api:selector-defined"><a href="semantics-other.html#selector-defined">:defined</a></code>疑似クラスと組み合わる。</p>

   <pre><code class='js'>articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>true</c-><c- p>;</c->

fetch<c- p>(</c->articleURL<c- p>)</c->
  <c- p>.</c->then<c- p>(</c->response <c- p>=></c-> response<c- p>.</c->text<c- p>())</c->
  <c- p>.</c->then<c- p>(</c->text <c- p>=></c-> <c- p>{</c->
    articleContainer<c- p>.</c->innerHTML <c- o>=</c-> text<c- p>;</c->

    <c- k>return</c-> Promise<c- p>.</c->all<c- p>(</c->
      <c- p>[...</c->articleContainer<c- p>.</c->querySelectorAll<c- p>(</c-><c- u>":not(:defined)"</c-><c- p>)]</c->
        <c- p>.</c->map<c- p>(</c->el <c- p>=></c-> customElements<c- p>.</c->whenDefined<c- p>(</c->el<c- p>.</c->localName<c- p>))</c->
    <c- p>);</c->
  <c- p>})</c->
  <c- p>.</c->then<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
    articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>false</c-><c- p>;</c->
  <c- p>});</c-></code></pre>
  </div>

  

  <p>When invoked, the <dfn data-dfn-for="CustomElementRegistry" id="dom-customelementregistry-upgrade" data-dfn-type="method"><code>upgrade(<var>root</var>)</code></dfn> method must run these steps:</p>

  <ol><li><p>Let <var>candidates</var> be a <a id="custom-elements-api:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of all of <var>root</var>'s <a id="custom-elements-api:shadow-including-inclusive-descendant-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-inclusive-descendant" data-x-internal="shadow-including-inclusive-descendant">shadow-including inclusive descendant</a> elements, in <a id="custom-elements-api:shadow-including-tree-order-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order" data-x-internal="shadow-including-tree-order">shadow-including tree order</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="custom-elements-api:list-iterate" data-x-internal="list-iterate">For each</a> <var>candidate</var> of <var>candidates</var>, <a href="#concept-try-upgrade" id="custom-elements-api:concept-try-upgrade-2">try to upgrade</a> <var>candidate</var>.</ol>

  

  <div class="example"><p><code id="custom-elements-api:dom-customelementregistry-upgrade-2"><a href="#dom-customelementregistry-upgrade">upgrade()</a></code>メソッドは、自由に要素をアップグレード可能にする。 通常、要素は<a id="custom-elements-api:connected-2" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">接続された</a>ときに自動的にアップグレードされるが、この方法は、要素を接続する準備ができる前にアップグレードする必要がある場合に使用できる。</p>

   <pre><code class='js'><c- a>const</c-> el <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"spider-man"</c-><c- p>);</c->

<c- a>class</c-> SpiderMan <c- k>extends</c-> HTMLElement <c- p>{}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"spider-man"</c-><c- p>,</c-> SpiderMan<c- p>);</c->

console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>));</c-> <c- c1>// not yet upgraded</c->

customElements<c- p>.</c->upgrade<c- p>(</c->el<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>);</c->    <c- c1>// upgraded!</c-></code></pre>
  </div>

  

  <h4 id="upgrades"><span class="secno">4.13.5</span> <dfn>Upgrades</dfn><a href="#upgrades" class="self-link"></a></h4>

  <p>To <dfn id="concept-upgrade-an-element" data-export="">upgrade an element</dfn>, given as input a <a href="#custom-element-definition" id="upgrades:custom-element-definition">custom element definition</a> <var>definition</var> and an element <var>element</var>, run the following steps:</p>

  <ol><li id="concept-upgrade-an-element-early-exit"><p>If <var>element</var>'s <a id="upgrades:custom-element-state" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> is not "<code>undefined</code>" or "<code>uncustomized</code>", then return.</p>

    <div class="example"><p>One scenario where this can occur due to reentrant invocation of this algorithm, as in the following example:</p>

     <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>x-foo</c-> <c- e>id</c-><c- o>=</c-><c- s>"a"</c-><c- p>>&lt;/</c-><c- f>x-foo</c-><c- p>></c->
<c- p>&lt;</c-><c- f>x-foo</c-> <c- e>id</c-><c- o>=</c-><c- s>"b"</c-><c- p>>&lt;/</c-><c- f>x-foo</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- c1>// Defining enqueues upgrade reactions for both "a" and "b"</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"x-foo"</c-><c- p>,</c-> <c- a>class</c-> <c- k>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->

    <c- a>const</c-> b <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"#b"</c-><c- p>);</c->
    b<c- p>.</c->remove<c- p>();</c->

    <c- c1>// While this constructor is running for "a", "b" is still</c->
    <c- c1>// undefined, and so inserting it into the document will enqueue a</c->
    <c- c1>// second upgrade reaction for "b" in addition to the one enqueued</c->
    <c- c1>// by defining x-foo.</c->
    document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->b<c- p>);</c->
  <c- p>}</c->
<c- p>})</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

     <p>This step will thus bail out the algorithm early when <a href="#concept-upgrade-an-element" id="upgrades:concept-upgrade-an-element">upgrade an element</a> is invoked with "<code>b</code>" a second time.</p>
    </div>
   <li><p>Set <var>element</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition" id="upgrades:concept-element-custom-element-definition" data-x-internal="concept-element-custom-element-definition">custom element definition</a> to <var>definition</var>.<li><p>Set <var>element</var>'s <a id="upgrades:custom-element-state-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> to "<code>failed</code>".</p>

    <p class="note">It will be set to "<code>custom</code>" <a href="#concept-upgrade-an-element-set-state-to-custom">after the upgrade succeeds</a>. For now, we set it to "<code>failed</code>" so that any reentrant invocations will hit <a href="#concept-upgrade-an-element-early-exit">the above early-exit step</a>.</p>
   <li><p>For each <var>attribute</var> in <var>element</var>'s <a id="upgrades:attribute-list" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attribute" data-x-internal="attribute-list">attribute list</a>, in order, <a href="#enqueue-a-custom-element-callback-reaction" id="upgrades:enqueue-a-custom-element-callback-reaction">enqueue a custom element callback reaction</a> with <var>element</var>, callback name "<code>attributeChangedCallback</code>", and an argument list containing <var>attribute</var>'s local name, null, <var>attribute</var>'s value, and <var>attribute</var>'s namespace.<li><p>If <var>element</var> is <a id="upgrades:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">connected</a>, then <a href="#enqueue-a-custom-element-callback-reaction" id="upgrades:enqueue-a-custom-element-callback-reaction-2">enqueue a custom element callback reaction</a> with <var>element</var>, callback name "<code>connectedCallback</code>", and an empty argument list.<li><p>Add <var>element</var> to the end of <var>definition</var>'s <a href="#concept-custom-element-definition-construction-stack" id="upgrades:concept-custom-element-definition-construction-stack">construction stack</a>.<li><p>Let <var>C</var> be <var>definition</var>'s <a href="#concept-custom-element-definition-constructor" id="upgrades:concept-custom-element-definition-constructor">constructor</a>.<li><p>Run the following substeps while catching any exceptions:</p>

    <ol><li><p>If <var>definition</var>'s <a href="#concept-custom-element-definition-disable-shadow" id="upgrades:concept-custom-element-definition-disable-shadow">disable shadow</a> is true and <var>element</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-shadow-root" id="upgrades:concept-element-shadow-root" data-x-internal="concept-element-shadow-root">shadow root</a> is non-null, then throw a <a id="upgrades:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="upgrades:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.</p>

      <p class="note">This is needed as <code id="upgrades:dom-element-attachshadow"><a data-x-internal="dom-element-attachshadow" href="https://triple-underscore.github.io/DOM4-ja.html#dom-element-attachshadow">attachShadow()</a></code> does not use <a href="#look-up-a-custom-element-definition" id="upgrades:look-up-a-custom-element-definition">look up a custom element definition</a> while <code id="upgrades:dom-attachinternals"><a href="#dom-attachinternals">attachInternals()</a></code> does.</p>
     <li><p>Set <var>element</var>'s <a id="upgrades:custom-element-state-3" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> to "<code>precustomized</code>".<li><p>Let <var>constructResult</var> be the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#construct-a-callback-function" id="upgrades:es-constructing-callback-functions" data-x-internal="es-constructing-callback-functions">constructing</a> <var>C</var>, with no arguments.</p>

      <p class="note">If <var>C</var> <a href="#custom-element-conformance">non-conformantly</a> uses an API decorated with the <code id="upgrades:cereactions"><a href="#cereactions">[CEReactions]</a></code> extended attribute, then the reactions enqueued at the beginning of this algorithm will execute during this step, before <var>C</var> finishes and control returns to this algorithm. Otherwise, they will execute after <var>C</var> and the rest of the upgrade process finishes.</p>
     <li><p>If <a id="upgrades:samevalue" href="https://tc39.es/ecma262/#sec-samevalue" data-x-internal="samevalue">SameValue</a>(<var>constructResult</var>, <var>element</var>) is false, then throw a <code id="upgrades:typeerror"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code>.</p>

      <p class="note">This can occur if <var>C</var> constructs another instance of the same custom element before calling <code>super()</code>, or if <var>C</var> uses JavaScript's <code>return</code>-override feature to return an arbitrary <code id="upgrades:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code> object from the constructor.</p>
     </ol>

    <p>Then, perform the following substep, regardless of whether the above steps threw an exception or not:</p>

    <ol><li><p>Remove the last entry from the end of <var>definition</var>'s <a href="#concept-custom-element-definition-construction-stack" id="upgrades:concept-custom-element-definition-construction-stack-2">construction stack</a>.</p>

      <div class="note"><p>Assuming <var>C</var> calls <code>super()</code> (as it will if it is <a href="#custom-element-conformance">conformant</a>), and that the call succeeds, this will be the <a href="#concept-already-constructed-marker" id="upgrades:concept-already-constructed-marker"><i>already constructed</i> marker</a> that replaced the <var>element</var> we pushed at the beginning of this algorithm. (The <a href="dom.html#html-element-constructors">HTML element constructor</a> carries out this replacement.)</p>

       <p>If <var>C</var> does not call <code>super()</code> (i.e. it is not <a href="#custom-element-conformance">conformant</a>), or if any step in the <a href="dom.html#html-element-constructors">HTML element constructor</a> throws, then this entry will still be <var>element</var>.</p>
      </div>
     </ol>

    <p>Finally, if the above steps threw an exception, then:</p>

    <ol><li><p>Set <var>element</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition" id="upgrades:concept-element-custom-element-definition-2" data-x-internal="concept-element-custom-element-definition">custom element definition</a> to null.<li><p>Empty <var>element</var>'s <a href="#custom-element-reaction-queue" id="upgrades:custom-element-reaction-queue">custom element reaction queue</a>.</p>

     <li><p>Rethrow the exception (thus terminating this algorithm).</ol>

    <p class="note">If the above steps threw an exception, then <var>element</var>'s <a id="upgrades:custom-element-state-4" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> will remain "<code>failed</code>" or "<code>precustomized</code>".</p>
   <li><p>If <var>element</var> is a <a href="#form-associated-custom-element" id="upgrades:form-associated-custom-element">form-associated custom element</a>, then:</p>
    <ol><li><p><a id="upgrades:reset-the-form-owner" href="form-control-infrastructure.html#reset-the-form-owner">Reset the form owner</a> of <var>element</var>. If <var>element</var> is associated with a <code id="upgrades:the-form-element"><a href="forms.html#the-form-element">form</a></code> element, then <a href="#enqueue-a-custom-element-callback-reaction" id="upgrades:enqueue-a-custom-element-callback-reaction-3">enqueue a custom element callback reaction</a> with <var>element</var>, callback name "<code>formAssociatedCallback</code>", and « the associated <code id="upgrades:the-form-element-2"><a href="forms.html#the-form-element">form</a></code> ».<li><p>If <var>element</var> is <a href="form-control-infrastructure.html#concept-fe-disabled" id="upgrades:concept-fe-disabled">disabled</a>, then <a href="#enqueue-a-custom-element-callback-reaction" id="upgrades:enqueue-a-custom-element-callback-reaction-4">enqueue a custom element callback reaction</a> with <var>element</var>, callback name "<code>formDisabledCallback</code>" and « true ».</ol>
   <li id="concept-upgrade-an-element-set-state-to-custom"><p>Set <var>element</var>'s <a id="upgrades:custom-element-state-5" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> to "<code>custom</code>".</ol>

  <p>To <dfn id="concept-try-upgrade" data-export="">try to upgrade an element</dfn>, given as input an element <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be the result of <a href="#look-up-a-custom-element-definition" id="upgrades:look-up-a-custom-element-definition-2">looking up a custom element definition</a> given <var>element</var>'s <a id="upgrades:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>, <var>element</var>'s namespace, <var>element</var>'s local name, and <var>element</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value" id="upgrades:concept-element-is-value" data-x-internal="concept-element-is-value"><code>is</code> value</a>.<li><p>If <var>definition</var> is not null, then <a href="#enqueue-a-custom-element-upgrade-reaction" id="upgrades:enqueue-a-custom-element-upgrade-reaction">enqueue a custom element upgrade reaction</a> given <var>element</var> and <var>definition</var>.</ol>

  

  <h4 id="custom-element-reactions"><span class="secno">4.13.6</span> カスタム要素応答<a href="#custom-element-reactions" class="self-link"></a></h4>

  <p><a href="#custom-element" id="custom-element-reactions:custom-element">カスタム要素</a>は、著者によるコードを実行することで特定の発生に応答する機能をがある：</p>

  <ul><li><p><a href="#upgrades" id="custom-element-reactions:upgrades">アップグレードされる</a>と、引数なしでその<a href="#custom-element-constructor" id="custom-element-reactions:custom-element-constructor">コンストラクター</a>は実行される。<li><p><a id="custom-element-reactions:becomes-connected" href="infrastructure.html#becomes-connected">接続される</a>と、<code>connectedCallback</code>は引数なしで呼び出される。<li><p><a id="custom-element-reactions:becomes-disconnected" href="infrastructure.html#becomes-disconnected">接続が切断される</a>と、その<code>disconnectCallCallback</code>は引数なしで呼び出される。<li><p>新しい文書に<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt" id="custom-element-reactions:concept-node-adopt" data-x-internal="concept-node-adopt">採用される</a>と、古い文書と新しい文書を引数として指定して、<code>adoptedCallback</code>が呼び出される。<li><p>属性のいずれかが<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-change" id="custom-element-reactions:concept-element-attributes-change" data-x-internal="concept-element-attributes-change">変更</a>、<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-append" id="custom-element-reactions:concept-element-attributes-append" data-x-internal="concept-element-attributes-append">追加</a>、<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-remove" id="custom-element-reactions:concept-element-attributes-remove" data-x-internal="concept-element-attributes-remove">削除</a>、または<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-replace" id="custom-element-reactions:concept-element-attributes-replace" data-x-internal="concept-element-attributes-replace">置換</a>されるとき、属性のローカル名、古い値、新しい値、および名前空間が引数として指定され、<code>attributeChangedCallback</code>が呼び出される。（属性の古い値または新しい値は、その属性が追加または削除されたときにそれぞれnullと見なされる。）<li><p>ユーザーエージェントが<a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element">フォームに関連付けられたカスタム要素</a>の<a href="form-control-infrastructure.html#reset-the-form-owner" id="custom-element-reactions:reset-the-form-owner">フォーム所有者をリセットし</a>、それによってフォーム所有者を変更するとき、引数として新しいフォーム所有者（所有者がいない場合はnull）が指定されて、その<code>formAssociatedCallback</code>が呼び出される。<li><p><a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-2">フォームに関連付けられたカスタム要素</a>のフォーム所有者が<a href="form-control-infrastructure.html#concept-form-reset" id="custom-element-reactions:concept-form-reset">リセット</a>されるとき、その<code>formResetCallback</code>が呼び出される。<li><p><a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-3">フォームに関連付けられたカスタム要素</a>の<a href="form-control-infrastructure.html#concept-fe-disabled" id="custom-element-reactions:concept-fe-disabled">無効</a>状態が変更されるとき、新しい状態が引数として指定され、その<code>formDisabledCallback</code>が呼び出される。<li><p>ユーザーエージェントがユーザーに代わって<a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-4">フォームに関連付けられたカスタム要素</a>の値を更新するとき、新しい値と理由を示す文字列"<code>restore</code>"または"<code>autocomplete</code>"を引数として指定して、その<code>formStateRestoreCallback</code>が呼び出される。</ul>

  <p>これらの反応をまとめて<dfn id="concept-custom-element-reaction">カスタム要素応答</dfn>と呼ぶ。</p>

  <p><a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction">カスタム要素反応</a>が呼び出される方法は、デリケートな操作の途中で著者のコードが実行されるのを避けるために、特別な注意を払って行われる。実質的に、"ユーザースクリプトに戻る直前"まで遅延される。これは、ほとんどの目的では同期して実行されているように見えるが、複雑な複合操作（<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone" id="custom-element-reactions:concept-node-clone" data-x-internal="concept-node-clone">クローニング</a>や<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-range" id="custom-element-reactions:concept-range" data-x-internal="concept-range">範囲</a>操作など）の場合は、すべての関連するユーザーエージェントの処理ステップが完了するまで遅延され、その後、バッチとしてまとめて実行されることを意味する。</p>

  <p>Additionally, the precise ordering of these reactions is managed via a somewhat-complicated stack-of-queues system, described below. このシステムの背後にある意図は、<a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-2">カスタム要素反応</a>は常に、少なくとも1つの<a href="#custom-element" id="custom-element-reactions:custom-element-2">カスタム要素</a>のローカルコンテキスト内で、トリガーアクションと同じ順序で常に呼び出されることを保証することである。（<a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-3">カスタム要素反応</a>コードは独自の変更を実行できるため、複数の要素にまたがるグローバルな順序付けを保証することはできない。）</p>

  

  <hr>

  <p>Each <a id="custom-element-reactions:similar-origin-window-agent" href="webappapis.html#similar-origin-window-agent">similar-origin window agent</a> has a <dfn id="custom-element-reactions-stack">custom element reactions stack</dfn>, which is initially empty. A <a id="custom-element-reactions:similar-origin-window-agent-2" href="webappapis.html#similar-origin-window-agent">similar-origin window agent</a>'s <dfn id="current-element-queue">current element queue</dfn> is the <a href="#element-queue" id="custom-element-reactions:element-queue">element queue</a> at the top of its <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack">custom element reactions stack</a>. Each item in the stack is an <dfn id="element-queue">element queue</dfn>, which is initially empty as well. Each item in an <a href="#element-queue" id="custom-element-reactions:element-queue-2">element queue</a> is an element. (The elements are not necessarily <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom" id="custom-element-reactions:concept-element-custom" data-x-internal="concept-element-custom">custom</a> yet, since this queue is used for <a href="#upgrades" id="custom-element-reactions:upgrades-2">upgrades</a> as well.)</p>

  <p>Each <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack-2">custom element reactions stack</a> has an associated <dfn id="backup-element-queue">backup element queue</dfn>, which an initially-empty <a href="#element-queue" id="custom-element-reactions:element-queue-3">element queue</a>. Elements are pushed onto the <a href="#backup-element-queue" id="custom-element-reactions:backup-element-queue">backup element queue</a> during operations that affect the DOM without going through an API decorated with <code id="custom-element-reactions:cereactions"><a href="#cereactions">[CEReactions]</a></code>, or through the parser's <a id="custom-element-reactions:create-an-element-for-the-token" href="parsing.html#create-an-element-for-the-token">create an element for the token</a> algorithm. An example of this is a user-initiated editing operation which modifies the descendants or attributes of an <a id="custom-element-reactions:editable" href="https://w3c.github.io/editing/docs/execCommand/#editable" data-x-internal="editable">editable</a> element. To prevent reentrancy when processing the <a href="#backup-element-queue" id="custom-element-reactions:backup-element-queue-2">backup element queue</a>, each <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack-3">custom element reactions stack</a> also has a <dfn id="processing-the-backup-element-queue">processing the backup element queue</dfn> flag, initially unset.</p>

  <p>All elements have an associated <dfn id="custom-element-reaction-queue">custom element reaction queue</dfn>, initially empty. Each item in the <a href="#custom-element-reaction-queue" id="custom-element-reactions:custom-element-reaction-queue">custom element reaction queue</a> is of one of two types:</p>

  <ul><li><p>An <dfn id="upgrade-reaction">upgrade reaction</dfn>, which will <a href="#upgrades" id="custom-element-reactions:upgrades-3">upgrade</a> the custom element and contains a <a href="#custom-element-definition" id="custom-element-reactions:custom-element-definition">custom element definition</a>; or<li><p>A <dfn id="callback-reaction">callback reaction</dfn>, which will call a lifecycle callback, and contains a callback function as well as a list of arguments.</ul>

  <p>これは、次の模式図にすべて要約される：</p>

  <p><img src="https://html.spec.whatwg.org/multipage/images/custom-element-reactions.svg" alt="A custom element reactions stack consists of a stack of element queues. Zooming in on a particular queue, we see that it contains a number of elements (in our example, &lt;x-a>, then &lt;x-b>, then &lt;x-c>). Any particular element in the queue then has a custom element reaction queue. Zooming in on the custom element reaction queue, we see that it contains a variety of queued-up reactions (in our example, upgrade, then attribute changed, then another attribute changed, then connected)." style="width: 80%; max-width: 580px;"></p>

  <p>To <dfn id="enqueue-an-element-on-the-appropriate-element-queue">enqueue an element on the appropriate element queue</dfn>, given an element <var>element</var>, run the following steps:</p>

  <ol><li><p>Let <var>reactionsStack</var> be <var>element</var>'s <a id="custom-element-reactions:relevant-agent" href="webappapis.html#relevant-agent">relevant agent</a>'s <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack-4">custom element reactions stack</a>.<li><p>If <var>reactionsStack</var> is empty, then:</p>

    <ol><li><p>Add <var>element</var> to <var>reactionsStack</var>'s <a href="#backup-element-queue" id="custom-element-reactions:backup-element-queue-3">backup element queue</a>.<li><p>If <var>reactionsStack</var>'s <a href="#processing-the-backup-element-queue" id="custom-element-reactions:processing-the-backup-element-queue">processing the backup element queue</a> flag is set, then return.<li><p>Set <var>reactionsStack</var>'s <a href="#processing-the-backup-element-queue" id="custom-element-reactions:processing-the-backup-element-queue-2">processing the backup element queue</a> flag.<li><p><a id="custom-element-reactions:queue-a-microtask" href="webappapis.html#queue-a-microtask">Queue a microtask</a> to perform the following steps:</p>

      <ol><li><p><a href="#invoke-custom-element-reactions" id="custom-element-reactions:invoke-custom-element-reactions">Invoke custom element reactions</a> in <var>reactionsStack</var>'s <a href="#backup-element-queue" id="custom-element-reactions:backup-element-queue-4">backup element queue</a>.<li><p>Unset <var>reactionsStack</var>'s <a href="#processing-the-backup-element-queue" id="custom-element-reactions:processing-the-backup-element-queue-3">processing the backup element queue</a> flag.</ol>
     </ol>
   <li><p>Otherwise, add <var>element</var> to <var>element</var>'s <a id="custom-element-reactions:relevant-agent-2" href="webappapis.html#relevant-agent">relevant agent</a>'s <a href="#current-element-queue" id="custom-element-reactions:current-element-queue">current element queue</a>.</ol>

  <p>To <dfn id="enqueue-a-custom-element-callback-reaction" data-export="">enqueue a custom element callback reaction</dfn>, given a <a href="#custom-element" id="custom-element-reactions:custom-element-3">custom element</a> <var>element</var>, a callback name <var>callbackName</var>, and a list of arguments <var>args</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be <var>element</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-definition" id="custom-element-reactions:concept-element-custom-element-definition" data-x-internal="concept-element-custom-element-definition">custom element definition</a>.</p>

   <li><p>Let <var>callback</var> be the value of the entry in <var>definition</var>'s <a href="#concept-custom-element-definition-lifecycle-callbacks" id="custom-element-reactions:concept-custom-element-definition-lifecycle-callbacks">lifecycle callbacks</a> with key <var>callbackName</var>.<li><p>If <var>callback</var> is null, then return<li><p>If <var>callbackName</var> is "<code>attributeChangedCallback</code>", then:</p>

    <ol><li><p>Let <var>attributeName</var> be the first element of <var>args</var>.<li><p>If <var>definition</var>'s <a href="#concept-custom-element-definition-observed-attributes" id="custom-element-reactions:concept-custom-element-definition-observed-attributes">observed attributes</a> does not contain <var>attributeName</var>, then return.</ol>
   <li><p>Add a new <a href="#callback-reaction" id="custom-element-reactions:callback-reaction">callback reaction</a> to <var>element</var>'s <a href="#custom-element-reaction-queue" id="custom-element-reactions:custom-element-reaction-queue-2">custom element reaction queue</a>, with callback function <var>callback</var> and arguments <var>args</var>.<li><p><a href="#enqueue-an-element-on-the-appropriate-element-queue" id="custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue">Enqueue an element on the appropriate element queue</a> given <var>element</var>.</ol>

  <p>To <dfn id="enqueue-a-custom-element-upgrade-reaction" data-export="">enqueue a custom element upgrade reaction</dfn>, given an element <var>element</var> and <a href="#custom-element-definition" id="custom-element-reactions:custom-element-definition-2">custom element definition</a> <var>definition</var>, run the following steps:</p>

  <ol><li><p>Add a new <a href="#upgrade-reaction" id="custom-element-reactions:upgrade-reaction">upgrade reaction</a> to <var>element</var>'s <a href="#custom-element-reaction-queue" id="custom-element-reactions:custom-element-reaction-queue-3">custom element reaction queue</a>, with <a href="#custom-element-definition" id="custom-element-reactions:custom-element-definition-3">custom element definition</a> <var>definition</var>.<li><p><a href="#enqueue-an-element-on-the-appropriate-element-queue" id="custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue-2">Enqueue an element on the appropriate element queue</a> given <var>element</var>.</ol>

  <p>To <dfn id="invoke-custom-element-reactions">invoke custom element reactions</dfn> in an <a href="#element-queue" id="custom-element-reactions:element-queue-4">element queue</a> <var>queue</var>, run the following steps:</p>

  <ol><li><p>While <var>queue</var> is not <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="custom-element-reactions:list-is-empty" data-x-internal="list-is-empty">empty</a>:</p>

    <ol><li><p>Let <var>element</var> be the result of <a href="https://triple-underscore.github.io/infra-ja.html#queue-dequeue" id="custom-element-reactions:dequeue" data-x-internal="dequeue">dequeuing</a> from <var>queue</var>.<li><p>Let <var>reactions</var> be <var>element</var>'s <a href="#custom-element-reaction-queue" id="custom-element-reactions:custom-element-reaction-queue-4">custom element reaction queue</a>.<li><p>Repeat until <var>reactions</var> is empty:</p>

      <ol><li><p>Remove the first element of <var>reactions</var>, and let <var>reaction</var> be that element. Switch on <var>reaction</var>'s type:</p>

        <dl class="switch"><dt><a href="#upgrade-reaction" id="custom-element-reactions:upgrade-reaction-2">upgrade reaction</a><dd><a href="#concept-upgrade-an-element" id="custom-element-reactions:concept-upgrade-an-element">Upgrade</a> <var>element</var> using <var>reaction</var>'s <a href="#custom-element-definition" id="custom-element-reactions:custom-element-definition-4">custom element definition</a>.<dt><a href="#callback-reaction" id="custom-element-reactions:callback-reaction-2">callback reaction</a><dd><a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="custom-element-reactions:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>reaction</var>'s callback function with <var>reaction</var>'s arguments, and with <var>element</var> as the <a href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value" id="custom-element-reactions:dfn-callback-this-value" data-x-internal="dfn-callback-this-value">callback this value</a>.</dl>

        <p>If this throws an exception, catch it, and <a id="custom-element-reactions:report-the-exception" href="webappapis.html#report-the-exception">report the exception</a>.</p>
       </ol>
     </ol>
   </ol>

  <hr>

  <p>To ensure <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-4">custom element reactions</a> are triggered appropriately, we introduce the <dfn id="cereactions" data-dfn-type="extended-attribute" data-lt="CEReactions"><code>[CEReactions]</code></dfn> IDL <a id="custom-element-reactions:extended-attribute" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-extended-attribute" data-x-internal="extended-attribute">extended attribute</a>. It indicates that the relevant algorithm is to be supplemented with additional steps in order to appropriately track and invoke <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-5">custom element reactions</a>.</p>

  <p>The <code id="custom-element-reactions:cereactions-2"><a href="#cereactions">[CEReactions]</a></code> extended attribute must take no arguments, and must not appear on anything other than an operation, attribute, setter, or deleter. Additionally, it must not appear on readonly attributes.</p>

  <p>Operations, attributes, setters, or deleters annotated with the <code id="custom-element-reactions:cereactions-3"><a href="#cereactions">[CEReactions]</a></code> extended attribute must run the following steps in place of the ones specified in their description:</p>

  <ol><li><p><a href="https://triple-underscore.github.io/infra-ja.html#stack-push" id="custom-element-reactions:stack-push" data-x-internal="stack-push">Push</a> a new <a href="#element-queue" id="custom-element-reactions:element-queue-5">element queue</a> onto this object's <a id="custom-element-reactions:relevant-agent-3" href="webappapis.html#relevant-agent">relevant agent</a>'s <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack-5">custom element reactions stack</a>.<li><p>Run the originally-specified steps for this construct, catching any exceptions. If the steps return a value, let <var>value</var> be the returned value. If they throw an exception, let <var>exception</var> be the thrown exception.<li><p>Let <var>queue</var> be the result of <a href="https://triple-underscore.github.io/infra-ja.html#stack-pop" id="custom-element-reactions:stack-pop" data-x-internal="stack-pop">popping</a> from this object's <a id="custom-element-reactions:relevant-agent-4" href="webappapis.html#relevant-agent">relevant agent</a>'s <a href="#custom-element-reactions-stack" id="custom-element-reactions:custom-element-reactions-stack-6">custom element reactions stack</a>.<li><p><a href="#invoke-custom-element-reactions" id="custom-element-reactions:invoke-custom-element-reactions-2">Invoke custom element reactions</a> in <var>queue</var>.<li><p>If an exception <var>exception</var> was thrown by the original steps, rethrow <var>exception</var>.<li><p>If a value <var>value</var> was returned from the original steps, return <var>value</var>.</ol>

  <div class="note"><p>The intent behind this extended attribute is somewhat subtle. One way of accomplishing its goals would be to say that every operation, attribute, setter, and deleter on the platform must have these steps inserted, and to allow implementers to optimize away unnecessary cases (where no DOM mutation is possible that could cause <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-6">custom element reactions</a> to occur).</p>

   <p>However, in practice this imprecision could lead to non-interoperable implementations of <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-7">custom element reactions</a>, as some implementations might forget to invoke these steps in some cases. Instead, we settled on the approach of explicitly annotating all relevant IDL constructs, as a way of ensuring interoperable behavior and helping implementations easily pinpoint all cases where these steps are necessary.</p>
  </div>

  <p>Any nonstandard APIs introduced by the user agent that could modify the DOM in such a way as to cause <a href="#enqueue-a-custom-element-callback-reaction" id="custom-element-reactions:enqueue-a-custom-element-callback-reaction">enqueuing a custom element callback reaction</a> or <a href="#enqueue-a-custom-element-upgrade-reaction" id="custom-element-reactions:enqueue-a-custom-element-upgrade-reaction">enqueuing a custom element upgrade reaction</a>, for example by modifying any attributes or child elements, must also be decorated with the <code id="custom-element-reactions:cereactions-4"><a href="#cereactions">[CEReactions]</a></code> attribute.</p>

  <div class="note"><p>As of the time of this writing, the following nonstandard or not-yet-standardized APIs are known to fall into this category:</p>

   <ul><li><p><code id="custom-element-reactions:htmlinputelement"><a href="input.html#htmlinputelement">HTMLInputElement</a></code>'s <code>webkitdirectory</code> and <code>incremental</code> IDL attributes<li><p><code id="custom-element-reactions:htmllinkelement"><a href="semantics.html#htmllinkelement">HTMLLinkElement</a></code>'s <code>scope</code> IDL attribute</ul>
  </div>

  

  <h4 id="element-internals"><span class="secno">4.13.7</span> 要素内部<a href="#element-internals" class="self-link"></a></h4>

  <p>特定の機能は、カスタム要素の作成者が利用可能であることを意図されているが、カスタム要素の利用者は意図されていない。これらは、<code id="element-internals:dom-attachinternals"><a href="#dom-attachinternals">element.attachInternals()</a></code>メソッドによって提供され、<code id="element-internals:elementinternals"><a href="#elementinternals">ElementInternals</a></code>のインスタンスを返す。<code id="element-internals:elementinternals-2"><a href="#elementinternals">ElementInternals</a></code>のプロパティおよびメソッドは、ユーザーエージェントがすべての要素に提供する内部機能の制御を可能にする。</p>

  <dl class="domintro"><dt><var>element</var> . <code id="dom-attachinternals-dev"><a href="#dom-attachinternals">attachInternals()</a></code><dd><p><a href="#custom-element" id="element-internals:custom-element">カスタム要素</a><var>element</var>をターゲットとする<code id="element-internals:elementinternals-3"><a href="#elementinternals">ElementInternals</a></code>オブジェクトを返す。<var>element</var>が<a href="#custom-element" id="element-internals:custom-element-2">カスタム要素</a>でない場合、"<code>internals</code>"機能が要素定義の一部として無効にされた場合、または同じ要素で2回呼び出された場合、例外を投げる。</dl>

  

  <p>各<code id="element-internals:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code>は、最初はfalseである<dfn id="attached-internals">attached internals</dfn>真偽値を持つ。</p>

  <p>The <dfn data-dfn-for="HTMLElement" id="dom-attachinternals" data-dfn-type="method"><code>attachInternals()</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="element-internals:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value" id="element-internals:concept-element-is-value" data-x-internal="concept-element-is-value"><code>is</code> value</a> is not null, then throw a <a id="element-internals:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="element-internals:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>definition</var> be the result of <a href="#look-up-a-custom-element-definition" id="element-internals:look-up-a-custom-element-definition">looking up a custom element definition</a> given this's <a id="element-internals:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>, its namespace, its local name, and null as the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-is-value" id="element-internals:concept-element-is-value-2" data-x-internal="concept-element-is-value"><code>is</code> value</a>.<li><p>If <var>definition</var> is null, then throw an <a id="element-internals:notsupportederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="element-internals:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <var>definition</var>'s <a href="#concept-custom-element-definition-disable-internals" id="element-internals:concept-custom-element-definition-disable-internals">disable internals</a> is true, then throw a <a id="element-internals:notsupportederror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="element-internals:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <a id="element-internals:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#attached-internals" id="element-internals:attached-internals">attached internals</a> is true, then throw an <a id="element-internals:notsupportederror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="element-internals:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <a id="element-internals:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="element-internals:custom-element-state" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom-element-state" data-x-internal="custom-element-state">custom element state</a> is not "<code>precustomized</code>" or "<code>custom</code>", then throw a <a id="element-internals:notsupportederror-5" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="element-internals:domexception-5"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <a id="element-internals:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#attached-internals" id="element-internals:attached-internals-2">attached internals</a> to true.<li><p>Return a new <code id="element-internals:elementinternals-4"><a href="#elementinternals">ElementInternals</a></code> instance whose <a href="#internals-target" id="element-internals:internals-target">target element</a> is <a id="element-internals:this-5" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>.</ol>

  <h5 id="the-elementinternals-interface"><span class="secno">4.13.7.1</span> The <code id="the-elementinternals-interface:elementinternals"><a href="#elementinternals">ElementInternals</a></code> interface<a href="#the-elementinternals-interface" class="self-link"></a></h5>

  <p>The IDL for the <code id="the-elementinternals-interface:elementinternals-2"><a href="#elementinternals">ElementInternals</a></code> interface is as follows, with the various operations and attributes defined in the following sections:</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='elementinternals' data-dfn-type='interface'><c- g>ElementInternals</c-></dfn> {
  // <a href='#shadow-root-access'>Shadow root access</a>
  <c- b>readonly</c-> <c- b>attribute</c-> <code id='the-elementinternals-interface:shadowroot'><a data-x-internal='shadowroot' href='https://triple-underscore.github.io/DOM4-ja.html#interface-shadowroot'><c- n>ShadowRoot</c-></a></code>? <a href='#dom-elementinternals-shadowroot' id='the-elementinternals-interface:dom-elementinternals-shadowroot'><c- g>shadowRoot</c-></a>;

  // <a href='#form-associated-custom-elements'>Form-associated custom elements</a>
  <c- b>undefined</c-> <a href='#dom-elementinternals-setformvalue' id='the-elementinternals-interface:dom-elementinternals-setformvalue'><c- g>setFormValue</c-></a>((<a id='the-elementinternals-interface:file' href='https://triple-underscore.github.io/File_API-ja.html#dfn-file' data-x-internal='file'><c- n>File</c-></a> <c- b>or</c-> <a href='https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString' id='the-elementinternals-interface:idl-usvstring' data-x-internal='idl-usvstring'><c- b>USVString</c-></a> <c- b>or</c-> <a id='the-elementinternals-interface:formdata' href='https://triple-underscore.github.io/XHR-ja.html#formdata' data-x-internal='formdata'><c- n>FormData</c-></a>)? <c- g>value</c->,
                         <c- b>optional</c-> (<a id='the-elementinternals-interface:file-2' href='https://triple-underscore.github.io/File_API-ja.html#dfn-file' data-x-internal='file'><c- n>File</c-></a> <c- b>or</c-> <a href='https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString' id='the-elementinternals-interface:idl-usvstring-2' data-x-internal='idl-usvstring'><c- b>USVString</c-></a> <c- b>or</c-> <a id='the-elementinternals-interface:formdata-2' href='https://triple-underscore.github.io/XHR-ja.html#formdata' data-x-internal='formdata'><c- n>FormData</c-></a>)? <c- g>state</c->);

  <c- b>readonly</c-> <c- b>attribute</c-> <a id='the-elementinternals-interface:htmlformelement' href='forms.html#htmlformelement'><c- n>HTMLFormElement</c-></a>? <a href='form-control-infrastructure.html#dom-elementinternals-form' id='the-elementinternals-interface:dom-elementinternals-form'><c- g>form</c-></a>;

  <c- b>undefined</c-> <a href='#dom-elementinternals-setvalidity' id='the-elementinternals-interface:dom-elementinternals-setvalidity'><c- g>setValidity</c-></a>(<c- b>optional</c-> <a href='#validitystateflags' id='the-elementinternals-interface:validitystateflags'><c- n>ValidityStateFlags</c-></a> <c- g>flags</c-> = {},
                        <c- b>optional</c-> <c- b>DOMString</c-> <c- g>message</c->,
                        <c- b>optional</c-> <a id='the-elementinternals-interface:htmlelement' href='dom.html#htmlelement'><c- n>HTMLElement</c-></a> <c- g>anchor</c->);
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='form-control-infrastructure.html#dom-elementinternals-willvalidate' id='the-elementinternals-interface:dom-elementinternals-willvalidate'><c- g>willValidate</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <a id='the-elementinternals-interface:validitystate' href='form-control-infrastructure.html#validitystate'><c- n>ValidityState</c-></a> <a href='form-control-infrastructure.html#dom-elementinternals-validity' id='the-elementinternals-interface:dom-elementinternals-validity'><c- g>validity</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-elementinternals-validationmessage' id='the-elementinternals-interface:dom-elementinternals-validationmessage'><c- g>validationMessage</c-></a>;
  <c- b>boolean</c-> <a href='form-control-infrastructure.html#dom-elementinternals-checkvalidity' id='the-elementinternals-interface:dom-elementinternals-checkvalidity'><c- g>checkValidity</c-></a>();
  <c- b>boolean</c-> <a href='form-control-infrastructure.html#dom-elementinternals-reportvalidity' id='the-elementinternals-interface:dom-elementinternals-reportvalidity'><c- g>reportValidity</c-></a>();

  <c- b>readonly</c-> <c- b>attribute</c-> <a id='the-elementinternals-interface:nodelist' href='https://triple-underscore.github.io/DOM4-ja.html#interface-nodelist' data-x-internal='nodelist'><c- n>NodeList</c-></a> <a href='forms.html#dom-elementinternals-labels' id='the-elementinternals-interface:dom-elementinternals-labels'><c- g>labels</c-></a>;
};

// <a href='#accessibility-semantics'>Accessibility semantics</a>
<c- n>ElementInternals</c-> <c- b>includes</c-> <a id='the-elementinternals-interface:ariamixin' href='https://w3c.github.io/aria/#ARIAMixin' data-x-internal='ariamixin'><c- n>ARIAMixin</c-></a>;

<c- b>dictionary</c-> <dfn id='validitystateflags' data-dfn-type='dictionary'><c- g>ValidityStateFlags</c-></dfn> {
  <c- b>boolean</c-> <c- g>valueMissing</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>typeMismatch</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>patternMismatch</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>tooLong</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>tooShort</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>rangeUnderflow</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>rangeOverflow</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>stepMismatch</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>badInput</c-> = <c- b>false</c->;
  <c- b>boolean</c-> <c- g>customError</c-> = <c- b>false</c->;
};</code></pre>

  <p>各<code id="the-elementinternals-interface:elementinternals-3"><a href="#elementinternals">ElementInternals</a></code>は、<dfn id="internals-target">ターゲット要素</dfn>を持ち、これは<a href="#custom-element" id="the-elementinternals-interface:custom-element">カスタム要素</a>である。
</p>

  

  <h5 id="shadow-root-access"><span class="secno">4.13.7.2</span> シャドウルートアクセス<a href="#shadow-root-access" class="self-link"></a></h5>

  <dl class="domintro"><dt><var>internals</var> . <code id="shadow-root-access:dom-elementinternals-shadowroot"><a href="#dom-elementinternals-shadowroot">shadowRoot</a></code><dd><p><a href="#internals-target" id="shadow-root-access:internals-target-2">ターゲット要素</a>が<a id="shadow-root-access:shadow-host" href="https://triple-underscore.github.io/DOM4-ja.html#element-shadow-host" data-x-internal="shadow-host">シャドウホスト</a>である場合、 <var>internals</var>の<a href="#internals-target" id="shadow-root-access:internals-target">ターゲット要素</a>の<code id="shadow-root-access:shadowroot"><a data-x-internal="shadowroot" href="https://triple-underscore.github.io/DOM4-ja.html#interface-shadowroot">ShadowRoot</a></code>を返し、そうでなければnullを返す。</dl>

  
  <p>The <dfn data-dfn-for="ElementInternals" id="dom-elementinternals-shadowroot" data-dfn-type="attribute"><code>shadowRoot</code></dfn> getter steps are:</p>

  <ol><li><p>Let <var>target</var> be <a id="shadow-root-access:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#internals-target" id="shadow-root-access:internals-target-3">target element</a>.<li><p>If <var>target</var> is not a <a id="shadow-root-access:shadow-host-2" href="https://triple-underscore.github.io/DOM4-ja.html#element-shadow-host" data-x-internal="shadow-host">shadow host</a>, then return null.<li><p>Let <var>shadow</var> be <var>target</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-shadow-root" id="shadow-root-access:concept-element-shadow-root" data-x-internal="concept-element-shadow-root">shadow root</a>.<li><p>If <var>shadow</var>'s <a id="shadow-root-access:available-to-element-internals" href="https://triple-underscore.github.io/DOM4-ja.html#shadowroot-available-to-element-internals" data-x-internal="available-to-element-internals">available to element internals</a> is false, then return null.<li><p>Return <var>shadow</var>.</ol>
  

  <h5 id="form-associated-custom-elements"><span class="secno">4.13.7.3</span> フォームに関連付けられたカスタム要素<a href="#form-associated-custom-elements" class="self-link"></a></h5>

  <dl class="domintro"><dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-setformvalue"><a href="#dom-elementinternals-setformvalue">setFormValue</a></code>(<var>value</var>)<dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target">ターゲット要素</a>の<a href="#face-state" id="form-associated-custom-elements:face-state">状態</a>と<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value">送信値</a>の両方を<var>value</var>に設定する。</p>

    <p><var>value</var>がnullである場合、要素はフォームの送信に参加しない。</p>
   <dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-setformvalue-2"><a href="#dom-elementinternals-setformvalue">setFormValue</a></code>(<var>value</var>, <var>state</var>)<dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-2">ターゲット要素</a>の<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-2">送信値</a>を<var>value</var>に設定し、その<a href="#face-state" id="form-associated-custom-elements:face-state-2">状態</a>を<var>state</var>に設定する。</p>

    <p><var>value</var>がnullである場合、要素はフォームの送信に参加しない。</p>
   <dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-form"><a href="form-control-infrastructure.html#dom-elementinternals-form">form</a></code><dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-3">ターゲット要素</a>の<a id="form-associated-custom-elements:form-owner" href="form-control-infrastructure.html#form-owner">フォーム所有者</a>を返す。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-setvalidity"><a href="#dom-elementinternals-setvalidity">setValidity</a></code>(<var>flags</var>, <var>message</var> [, <var>anchor</var> ])<dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-4">ターゲット要素</a>を<var>flags</var>引数で示された制約の影響を受けるものとしてマークし、要素の検証メッセージを<var>message</var>に設定する。<var>anchor</var>が指定される場合、ユーザーエージェントは、<a id="form-associated-custom-elements:form-owner-2" href="form-control-infrastructure.html#form-owner">フォームの所有者</a>がインタラクティブに検証される、または<code id="form-associated-custom-elements:dom-elementinternals-reportvalidity"><a href="form-control-infrastructure.html#dom-elementinternals-reportvalidity">reportValidity()</a></code>が呼び出されたときに、<var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-5">ターゲット要素</a>の制約に関する問題を示すために使用することがある。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-setvalidity-2"><a href="#dom-elementinternals-setvalidity">setValidity</a></code>({})<dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-6">ターゲット要素</a>を<a href="form-control-infrastructure.html#concept-fv-valid" id="form-associated-custom-elements:concept-fv-valid">その制約を満たす</a>ものとしてマークする。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-willvalidate"><a href="form-control-infrastructure.html#dom-elementinternals-willvalidate">willValidate</a></code><dd><p>フォームの送信時に<var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-7">ターゲット要素</a>が検証される場合はtrueを返す。そうでなけれればfalseを返す。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-validity"><a href="form-control-infrastructure.html#dom-elementinternals-validity">validity</a></code><dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-8">ターゲット要素</a>の<code id="form-associated-custom-elements:validitystate"><a href="form-control-infrastructure.html#validitystate">ValidityState</a></code>オブジェクトを返す。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-validationmessage"><a href="#dom-elementinternals-validationmessage">validationMessage</a></code><dd><p>もし<var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-9">ターゲット要素</a>の妥当性をチェックしたならば、ユーザーに表示されるエラーメッセージを返すだろう。<dt><var>valid</var> = <var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-checkvalidity"><a href="form-control-infrastructure.html#dom-elementinternals-checkvalidity">checkValidity()</a></code><dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-10">ターゲット要素</a>に妥当性の問題がない場合はtrueを返す。 そうでなければfalseを返す。 後者の場合要素で<code id="form-associated-custom-elements:event-invalid"><a href="indices.html#event-invalid">invalid</a></code>イベントを発火する。<dt><var>valid</var> = <var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-reportvalidity-2"><a href="form-control-infrastructure.html#dom-elementinternals-reportvalidity">reportValidity()</a></code><dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-11">ターゲット要素</a>が一切妥当性の問題を持たない場合はtrueを返す。そうでなければfalseを返し、要素で<code id="form-associated-custom-elements:event-invalid-2"><a href="indices.html#event-invalid">invalid</a></code>イベントを発火させ、そして（イベントが中止されない場合）ユーザーに問題を報告する。<dt><var>internals</var> . <code id="form-associated-custom-elements:dom-elementinternals-labels"><a href="forms.html#dom-elementinternals-labels">labels</a></code><dd><p><var>internals</var>の<a href="#internals-target" id="form-associated-custom-elements:internals-target-12">ターゲット要素</a>が関連付けられているすべての<code id="form-associated-custom-elements:the-label-element"><a href="forms.html#the-label-element">label</a></code> 要素の<code id="form-associated-custom-elements:nodelist"><a data-x-internal="nodelist" href="https://triple-underscore.github.io/DOM4-ja.html#interface-nodelist">NodeList</a></code>を返す。</dl>

  <p>それぞれの<a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element">フォームに関連付けられたカスタム要素</a>は<dfn id="face-submission-value">送信値</dfn>を持つ。フォーム送信時に1つ以上の<a href="https://triple-underscore.github.io/XHR-ja.html#concept-formdata-entry" id="form-associated-custom-elements:formdata-entry" data-x-internal="formdata-entry">エントリー</a>を提供するために使用される。<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-3">送信値</a>の初期値はnullであり、<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-4">送信値</a>はnull、文字列、<code id="form-associated-custom-elements:file"><a data-x-internal="file" href="https://triple-underscore.github.io/File_API-ja.html#dfn-file">File</a></code>、または<a href="https://triple-underscore.github.io/XHR-ja.html#concept-formdata-entry" id="form-associated-custom-elements:formdata-entry-2" data-x-internal="formdata-entry">エントリー</a>の<a id="form-associated-custom-elements:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">リスト</a>にすることができる。</p>

  <p>それぞれの<a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-2">フォームに関連付けられたカスタム要素</a>は<dfn id="face-state">状態</dfn>を持つ。これは、ユーザーエージェントが要素に対するユーザーの入力を復元できる情報である。<a href="#face-state" id="form-associated-custom-elements:face-state-3">状態</a>の初期値はnullであり、<a href="#face-state" id="form-associated-custom-elements:face-state-4">状態</a>はnull、文字列、<code id="form-associated-custom-elements:file-2"><a data-x-internal="file" href="https://triple-underscore.github.io/File_API-ja.html#dfn-file">File</a></code>,、または<a href="https://triple-underscore.github.io/XHR-ja.html#concept-formdata-entry" id="form-associated-custom-elements:formdata-entry-3" data-x-internal="formdata-entry">エントリー</a>の<a id="form-associated-custom-elements:list-2" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">リスト</a>にすることができる。</p>

  <p>カスタム要素の著者は<code id="form-associated-custom-elements:dom-elementinternals-setformvalue-3"><a href="#dom-elementinternals-setformvalue">setFormValue()</a></code>メソッドを使用して要素の<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-5">送信値</a>と<a href="#face-state" id="form-associated-custom-elements:face-state-5">状態</a>を設定し、これらをユーザーエージェントに伝達する。</p>

  <p>ユーザーエージェントが、たとえばナビゲーションやユーザーエージェントの再起動後など、<a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-3">フォームに関連付けられたカスタム要素</a>の<a href="#face-state" id="form-associated-custom-elements:face-state-6">状態</a>を復元するのがよいと考えている場合、その要素、コールバック名"<code>formStateRestoreCallback</code>"、復元する状態を含む引数リスト、および<code>"restore"</code>をもつ<a href="#enqueue-a-custom-element-callback-reaction" id="form-associated-custom-elements:enqueue-a-custom-element-callback-reaction">カスタム要素のコールバック反応をエンキュー</a>してもよい。</p>

  <p>ユーザーエージェントがフォーム記入アシスト機能を持っている場合、その機能が呼び出されたときに、<a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-4">フォームに関連付けられたカスタム要素</a>、コールバック名"<code>formStateRestoreCallback</code>"、状態値の履歴といくつかのヒューリスティックによって決定された状態値を含む引数リスト、および<code>"autocomplete"</code>とともに<a href="#enqueue-a-custom-element-callback-reaction" id="form-associated-custom-elements:enqueue-a-custom-element-callback-reaction-2">フォームに関連付けられたカスタム要素のコールバック反応をエンキュー</a>してもよい。</p>

  <p>一般に、<a href="#face-state" id="form-associated-custom-elements:face-state-7">状態</a>はユーザーによって指定された情報であり、<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-6">送信値</a>はサーバーへの送信に適した、正規化またはサニタイズ後の値である。 次の例は、これを具体的に示している：</p>

  <p class="example">ユーザーに日付の指定を求める<a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-5">フォームに関連付けられたカスタム要素</a>があるとする。 ユーザーは<kbd>"3/15/2019"</kbd>を指定するが、コントロールはサーバーに<code>"2019-03-15"</code>を送信しようとする。<kbd>"3/15/2019"</kbd>は要素の<a href="#face-state" id="form-associated-custom-elements:face-state-8">状態</a>であり、<code>"2019-03-15"</code>は<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-7">送信値</a>である。</p>

  <p class="example">既存の<a href="input.html#checkbox-state-(type=checkbox)" id="form-associated-custom-elements:checkbox-state-(type=checkbox)">チェックボックス</a><code id="form-associated-custom-elements:the-input-element"><a href="input.html#the-input-element">input</a></code>タイプの動作をエミュレートするカスタム要素を開発するとする。 その<a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-8">送信値</a>は、その<code>value</code>コンテンツ属性の値、または文字列<code>"on"</code>になる。その<a href="#face-state" id="form-associated-custom-elements:face-state-9">状態</a>は、<code>"checked"</code>、<code>"unchecked"</code>、<code>"checked/indeterminate"</code>、または<code>"unchecked/indeterminate"</code>のいずれかになる。</p>

  

  <p>The <dfn data-dfn-for="ElementInternals" id="dom-elementinternals-setformvalue" data-dfn-type="method"><code>setFormValue(<var>value</var>, <var>state</var>)</code></dfn> method steps are:</p>

  <ol><li><p>Let <var>element</var> be <a id="form-associated-custom-elements:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#internals-target" id="form-associated-custom-elements:internals-target-13">target element</a>.<li><p>If <var>element</var> is not a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-6">form-associated custom element</a>, then throw a <a id="form-associated-custom-elements:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="form-associated-custom-elements:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <a href="#internals-target" id="form-associated-custom-elements:internals-target-14">target element</a>'s <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-9">submission value</a> to <var>value</var> if <var>value</var> is not a <code id="form-associated-custom-elements:formdata"><a data-x-internal="formdata" href="https://triple-underscore.github.io/XHR-ja.html#formdata">FormData</a></code> object, or to a <a href="https://triple-underscore.github.io/infra-ja.html#list-clone" id="form-associated-custom-elements:list-clone" data-x-internal="list-clone">clone</a> of the entry list associated with <var>value</var> otherwise.<li><p>If the <var>state</var> argument of the function is omitted, set <var>element</var>'s <a href="#face-state" id="form-associated-custom-elements:face-state-10">state</a> to its <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-10">submission value</a>.<li><p>Otherwise, if <var>state</var> is a <code id="form-associated-custom-elements:formdata-2"><a data-x-internal="formdata" href="https://triple-underscore.github.io/XHR-ja.html#formdata">FormData</a></code> object, set <var>element</var>'s <a href="#face-state" id="form-associated-custom-elements:face-state-11">state</a> to <a href="https://triple-underscore.github.io/infra-ja.html#list-clone" id="form-associated-custom-elements:list-clone-2" data-x-internal="list-clone">clone</a> of the entry list associated with <var>state</var>.<li><p>Otherwise, set <var>element</var>'s <a href="#face-state" id="form-associated-custom-elements:face-state-12">state</a> to <var>state</var>.</ol>

  <hr>

  <p>Each <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-7">form-associated custom element</a> has validity flags named <code>valueMissing</code>, <code>typeMismatch</code>, <code>patternMismatch</code>, <code>tooLong</code>, <code>tooShort</code>, <code>rangeUnderflow</code>, <code>rangeOverflow</code>, <code>stepMismatch</code>, and <code>customError</code>. They are false initially.</p>

  <p>Each <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-8">form-associated custom element</a> has a <dfn id="face-validation-message">validation message</dfn> string. It is the empty string initially.</p>

  <p>Each <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-9">form-associated custom element</a> has a <dfn id="face-validation-anchor">validation anchor</dfn> element. It is null initially.</p>

  <p>The <dfn data-dfn-for="ElementInternals" id="dom-elementinternals-setvalidity" data-dfn-type="method"><code>setValidity(<var>flags</var>, <var>message</var>, <var>anchor</var>)</code></dfn> method steps are:</p>

  <ol><li><p>Let <var>element</var> be <a id="form-associated-custom-elements:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#internals-target" id="form-associated-custom-elements:internals-target-15">target element</a>.<li><p>If <var>element</var> is not a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-10">form-associated custom element</a>, then throw a <a id="form-associated-custom-elements:notsupportederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="form-associated-custom-elements:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <var>flags</var> contains one or more true values and <var>message</var> is not given or is the empty string, then throw a <code id="form-associated-custom-elements:typeerror"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code>.<li><p>For each entry <var>flag</var> → <var>value</var> of <var>flags</var>, set <var>element</var>'s validity flag with the name <var>flag</var> to <var>value</var>.<li><p>Set <var>element</var>'s <a href="#face-validation-message" id="form-associated-custom-elements:face-validation-message">validation message</a> to the empty string if <var>message</var> is not given or all of <var>element</var>'s validity flags are false, or to <var>message</var> otherwise.<li><p>If <var>element</var>'s <code>customError</code> validity flag is true, then set <var>element</var>'s <a id="form-associated-custom-elements:custom-validity-error-message" href="form-control-infrastructure.html#custom-validity-error-message">custom validity error message</a> to <var>element</var>'s <a href="#face-validation-message" id="form-associated-custom-elements:face-validation-message-2">validation message</a>. Otherwise, set <var>element</var>'s <a id="form-associated-custom-elements:custom-validity-error-message-2" href="form-control-infrastructure.html#custom-validity-error-message">custom validity error message</a> to the empty string.<li><p>Set <var>element</var>'s <a href="#face-validation-anchor" id="form-associated-custom-elements:face-validation-anchor">validation anchor</a> to null if <var>anchor</var> is not given. Otherwise, if <var>anchor</var> is not a <a id="form-associated-custom-elements:shadow-including-descendant" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-descendant" data-x-internal="shadow-including-descendant">shadow-including descendant</a> of <var>element</var>, then throw a <a id="form-associated-custom-elements:notfounderror" href="https://triple-underscore.github.io/WebIDL-ja.html#notfounderror" data-x-internal="notfounderror">"<code>NotFoundError</code>"</a> <code id="form-associated-custom-elements:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>. Otherwise, set <var>element</var>'s <a href="#face-validation-anchor" id="form-associated-custom-elements:face-validation-anchor-2">validation anchor</a> to <var>anchor</var>.</ol>

  <p>The <dfn data-dfn-for="ElementInternals" id="dom-elementinternals-validationmessage" data-dfn-type="attribute"><code>validationMessage</code></dfn> getter steps are to return the <a href="#face-validation-message" id="form-associated-custom-elements:face-validation-message-3">validation message</a> of <a id="form-associated-custom-elements:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#internals-target" id="form-associated-custom-elements:internals-target-16">target element</a>.</p>

  <p>The <dfn id="face-entry-construction">entry construction algorithm</dfn> for a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-11">form-associated custom element</a>, given an element <var>element</var> and a list <var>entry list</var>, consists of the following steps:</p>

  <ol><li><p>If <var>element</var>'s <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-11">submission value</a> is a <a id="form-associated-custom-elements:list-3" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <a href="https://triple-underscore.github.io/XHR-ja.html#concept-formdata-entry" id="form-associated-custom-elements:formdata-entry-4" data-x-internal="formdata-entry">entries</a>, then <a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="form-associated-custom-elements:list-append" data-x-internal="list-append">append</a> each item of <var>element</var>'s <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-12">submission value</a> to <var>entry list</var>, and return.</p>

    <p class="note">In this case, user agent does not refer to the <code id="form-associated-custom-elements:attr-fe-name"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> content attribute value. An implementation of <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-12">form-associated custom element</a> is responsible to decide names of <a href="https://triple-underscore.github.io/XHR-ja.html#concept-formdata-entry" id="form-associated-custom-elements:formdata-entry-5" data-x-internal="formdata-entry">entries</a>. They can be the <code id="form-associated-custom-elements:attr-fe-name-2"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> content attribute value, they can be strings based on the <code id="form-associated-custom-elements:attr-fe-name-3"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> content attribute value, or they can be unrelated to the <code id="form-associated-custom-elements:attr-fe-name-4"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> content attribute.</p>
   <li><p>If the element does not have a <code id="form-associated-custom-elements:attr-fe-name-5"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> attribute specified, or its <code id="form-associated-custom-elements:attr-fe-name-6"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> attribute's value is the empty string, then return.<li><p>If the element's <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-13">submission value</a> is not null, <a id="form-associated-custom-elements:append-an-entry" href="form-control-infrastructure.html#append-an-entry">append an entry</a> to <var>entry list</var> with the <code id="form-associated-custom-elements:attr-fe-name-7"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> attribute value and the <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-14">submission value</a>.</ol>

  

  <h5 id="accessibility-semantics"><span class="secno">4.13.7.4</span> アクセシビリティセマンティックス<a href="#accessibility-semantics" class="self-link"></a></h5>

  <dl class="domintro"><dt><var>internals</var> . <code><a href="#dom-ElementInternals-accessibility-idl-get">role</a></code> [ = <var>value</var> ]<dd><p><var>internals</var>の<a href="#internals-target" id="accessibility-semantics:internals-target">ターゲット要素</a>のデフォルトのARIAロールを設定または取得する。これは、ページの著者が<code id="accessibility-semantics:attr-aria-role"><a href="infrastructure.html#attr-aria-role">role</a></code>属性を使用して上書きしない限り、使用される。<dt><var>internals</var> . <code><a href="#dom-ElementInternals-accessibility-idl-get">aria*</a></code> [ = <var>value</var> ]<dd><p><var>internals</var>の<a href="#internals-target" id="accessibility-semantics:internals-target-2">ターゲット要素</a>のさまざまなデフォルトのARIAステートまたはプロパティを設定または取得する。これは、ページの著者が<code id="accessibility-semantics:attr-aria-*"><a href="infrastructure.html#attr-aria-*">aria-*</a></code>属性を使用してそれらを上書きしない限り、使用される。</dl>

  

  

  <p>Each <a href="#custom-element" id="accessibility-semantics:custom-element">custom element</a> has a <dfn id="native-accessibility-semantics-map">native accessibility semantics map</dfn>, which is a <a id="accessibility-semantics:the-map-element" href="image-maps.html#the-map-element">map</a>, initially empty. See the <a href="dom.html#wai-aria">Requirements related to ARIA and to platform accessibility APIs</a> section for information on how this impacts platform accessibility APIs.</p>

  <p><code id="accessibility-semantics:elementinternals"><a href="#elementinternals">ElementInternals</a></code> includes the <code id="accessibility-semantics:ariamixin"><a data-x-internal="ariamixin" href="https://w3c.github.io/aria/#ARIAMixin">ARIAMixin</a></code> mixin. The accessors provided by this mixin are used to manipulate the <a href="#internals-target" id="accessibility-semantics:internals-target-3">target element</a>'s <a href="#native-accessibility-semantics-map" id="accessibility-semantics:native-accessibility-semantics-map">native accessibility semantics map</a>, as follows:</p>

  <p id="dom-ElementInternals-accessibility-idl">The <a id="accessibility-semantics:ariamixin-getter-steps" href="https://w3c.github.io/aria/#dfn-ariamixin-getter-steps" data-x-internal="ariamixin-getter-steps"><code>ARIAMixin</code> getter steps</a> for <code id="accessibility-semantics:elementinternals-2"><a href="#elementinternals">ElementInternals</a></code>, given <var>internals</var>, <var>idlAttribute</var>, and <var>contentAttribute</var>, are:</p>

  <ol><li><p>Let <var>map</var> be <var>internals</var>'s <a href="#internals-target" id="accessibility-semantics:internals-target-4">target element</a>'s <a href="#native-accessibility-semantics-map" id="accessibility-semantics:native-accessibility-semantics-map-2">native accessibility semantics map</a>.<li><p>If <var>map</var>[<var>contentAttribute</var>] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="accessibility-semantics:map-exists" data-x-internal="map-exists">exists</a>, then return it.<li><p>Return null.</ol>

  <p>The <a id="accessibility-semantics:ariamixin-setter-steps" href="https://w3c.github.io/aria/#dfn-ariamixin-setter-steps" data-x-internal="ariamixin-setter-steps"><code>ARIAMixin</code> setter steps</a> for <code id="accessibility-semantics:elementinternals-3"><a href="#elementinternals">ElementInternals</a></code>, given <var>internals</var>, <var>idlAttribute</var>, <var>contentAttribute</var>, and <var>value</var>, are:</p>

  <ol><li><p>Let <var>map</var> be <var>internals</var>'s <a href="#internals-target" id="accessibility-semantics:internals-target-5">target element</a>'s <a href="#native-accessibility-semantics-map" id="accessibility-semantics:native-accessibility-semantics-map-3">native accessibility semantics map</a>.<li><p>If <var>value</var> is null, then <a href="https://triple-underscore.github.io/infra-ja.html#map-remove" id="accessibility-semantics:map-remove" data-x-internal="map-remove">remove</a> <var>map</var>[<var>contentAttribute</var>].<li><p>Otherwise, <a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="accessibility-semantics:map-set" data-x-internal="map-set">set</a> <var>map</var>[<var>contentAttribute</var>] to <var>value</var>.</ol>

  

  <nav><a href="canvas.html">← 4.12.5 canvas要素</a> – <a href="./">目次</a> – <a href="semantics-other.html">4.14 専用要素なしの一般的語彙 →</a></nav>

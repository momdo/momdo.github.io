<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script async="" crossorigin="" src="./html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">19 March 2021</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="history.html">← 7.9 セッション履歴およびナビゲーション</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav><ol class="toc"><li id="toc-browsers"><ol><li><a href="browsing-the-web.html#browsing-the-web"><span class="secno">7.10</span> ウェブを閲覧する</a><ol><li><a href="browsing-the-web.html#navigating-across-documents"><span class="secno">7.10.1</span> Navigating across documents</a><li><a href="browsing-the-web.html#read-html"><span class="secno">7.10.2</span> Page load processing model for HTML files</a><li><a href="browsing-the-web.html#read-xml"><span class="secno">7.10.3</span> Page load processing model for XML files</a><li><a href="browsing-the-web.html#read-text"><span class="secno">7.10.4</span> Page load processing model for text files</a><li><a href="browsing-the-web.html#read-multipart-x-mixed-replace"><span class="secno">7.10.5</span> Page load processing model for <code>multipart/x-mixed-replace</code> resources</a><li><a href="browsing-the-web.html#read-media"><span class="secno">7.10.6</span> Page load processing model for media</a><li><a href="browsing-the-web.html#read-plugin"><span class="secno">7.10.7</span> Page load processing model for content that uses plugins</a><li><a href="browsing-the-web.html#read-ua-inline"><span class="secno">7.10.8</span> Page load processing model for inline content that doesn't have a DOM</a><li><a href="browsing-the-web.html#scroll-to-fragid"><span class="secno">7.10.9</span> Navigating to a fragment</a><li><a href="browsing-the-web.html#history-traversal"><span class="secno">7.10.10</span> 履歴走査</a><ol><li><a href="browsing-the-web.html#persisted-user-state-restoration"><span class="secno">7.10.10.1</span> Persisted history entry state</a><li><a href="browsing-the-web.html#the-popstateevent-interface"><span class="secno">7.10.10.2</span> <code>PopStateEvent</code>インターフェイス</a><li><a href="browsing-the-web.html#the-hashchangeevent-interface"><span class="secno">7.10.10.3</span> <code>HashChangeEvent</code>インターフェイス</a><li><a href="browsing-the-web.html#the-pagetransitionevent-interface"><span class="secno">7.10.10.4</span> <code>PageTransitionEvent</code>インターフェイス</a></ol><li><a href="browsing-the-web.html#loading-documents"><span class="secno">7.10.11</span> Loading documents</a><li><a href="browsing-the-web.html#unloading-documents"><span class="secno">7.10.12</span> 文書の解放</a><ol><li><a href="browsing-the-web.html#the-beforeunloadevent-interface"><span class="secno">7.10.12.1</span> <code>BeforeUnloadEvent</code>インターフェイス</a></ol><li><a href="browsing-the-web.html#aborting-a-document-load"><span class="secno">7.10.13</span> Aborting a document load</a><li><a href="browsing-the-web.html#the-x-frame-options-header"><span class="secno">7.10.14</span> `<code>X-Frame-Options</code>`ヘッダー</a></ol></ol></ol><h3 id="browsing-the-web"><span class="secno">7.10</span> ウェブを閲覧する<a href="#browsing-the-web" class="self-link"></a></h3>

  

  <h4 id="navigating-across-documents"><span class="secno">7.10.1</span> Navigating across documents<a href="#navigating-across-documents" class="self-link"></a></h4>

  <p>Certain actions cause the <a id="navigating-across-documents:browsing-context" href="browsers.html#browsing-context">browsing context</a> to <i id="navigating-across-documents:navigate"><a href="#navigate">navigate</a></i> to a new resource. A user agent may provide various ways for the user to explicitly cause a browsing context to navigate, in addition to those defined in this specification.</p>

  <p class="example">For example, <a href="links.html#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2">following a hyperlink</a>, <a href="form-control-infrastructure.html#concept-form-submit" id="navigating-across-documents:concept-form-submit">form submission</a>, and the <code id="navigating-across-documents:dom-open"><a href="window-object.html#dom-open">window.open()</a></code> and <code id="navigating-across-documents:dom-location-assign"><a href="history.html#dom-location-assign">location.assign()</a></code> methods can all cause a browsing context to navigate.</p>

  <p class="note">A <i>resource</i> has a URL, but that might not be the only information necessary to identify it. For example, a form submission that uses HTTP POST would also have the HTTP method and payload. Similarly, <a id="navigating-across-documents:an-iframe-srcdoc-document" href="iframe-embed-object.html#an-iframe-srcdoc-document">an <code>iframe</code> <code>srcdoc</code> document</a> needs to know the data it is to use.</p>

  <p>Much of the navigation process is concerned with determining how to create a new <code id="navigating-across-documents:document"><a href="dom.html#document">Document</a></code>, which ultimately happens in the <a href="#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object">create and initialize a <code>Document</code> object</a> algorithm. The parameters to this algorithm are tracked via a <dfn id="navigation-params">navigation params</dfn> <a id="navigating-across-documents:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a>, which has the following <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="navigating-across-documents:struct-item" data-x-internal="struct-item">items</a>:</p>

  <dl><dt><dfn id="navigation-params-request">request</dfn><dd>null or a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request" data-x-internal="concept-request">request</a> that started the navigation<dt><dfn id="navigation-params-response">response</dfn><dd>a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="navigating-across-documents:concept-response" data-x-internal="concept-response">response</a> that ultimately was navigated to (potentially a <a id="navigating-across-documents:network-error" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a>)<dt><dfn id="navigation-params-origin">origin</dfn><dd>an <a id="navigating-across-documents:concept-origin" href="origin.html#concept-origin">origin</a> to use for the new <code id="navigating-across-documents:document-2"><a href="dom.html#document">Document</a></code><dt><dfn id="navigation-params-sandboxing">final sandboxing flag set</dfn><dd>a <a id="navigating-across-documents:sandboxing-flag-set" href="origin.html#sandboxing-flag-set">sandboxing flag set</a> to impose on the new <code id="navigating-across-documents:document-3"><a href="dom.html#document">Document</a></code><dt><dfn id="navigation-params-coop">cross-origin opener policy</dfn><dd>a <a id="navigating-across-documents:cross-origin-opener-policy" href="origin.html#cross-origin-opener-policy">cross-origin opener policy</a> to use for the new <code id="navigating-across-documents:document-4"><a href="dom.html#document">Document</a></code><dt><dfn id="navigation-params-coop-enforcement-result">COOP enforcement result</dfn><dd>a <a href="origin.html#coop-enforcement-result" id="navigating-across-documents:coop-enforcement-result">cross-origin opener policy enforcement result</a>, used for reporting and potentially for causing a <a href="origin.html#browsing-context-group-switches-due-to-cross-origin-opener-policy">browsing context group switch</a><dt><dfn id="navigation-params-reserved-environment">reserved environment</dfn><dd>null or an <a id="navigating-across-documents:environment" href="webappapis.html#environment">environment</a> reserved for the new <code id="navigating-across-documents:document-5"><a href="dom.html#document">Document</a></code><dt><dfn id="navigation-params-browsing-context">browsing context</dfn><dd>the <a id="navigating-across-documents:browsing-context-2" href="browsers.html#browsing-context">browsing context</a> to be navigated (or discarded, if a <a href="origin.html#browsing-context-group-switches-due-to-cross-origin-opener-policy">browsing context group switch</a> occurs)<dt><dfn id="navigation-params-hh">history handling</dfn><dd>a <a href="#history-handling-behavior" id="navigating-across-documents:history-handling-behavior">history handling behavior</a></dl>

  <p class="note">Once a <a href="#navigation-params" id="navigating-across-documents:navigation-params">navigation params</a> struct is created, this standard does not mutate any of its <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="navigating-across-documents:struct-item-2" data-x-internal="struct-item">items</a>. They are only passed onward to other algorithms.</p>

  <p>After <code id="navigating-across-documents:document-6"><a href="dom.html#document">Document</a></code> creation, the <a id="navigating-across-documents:session-history" href="history.html#session-history">session history</a> gets updated. A <dfn id="history-handling-behavior">history handling behavior</dfn> is used to track the desired type of session history update throughout the navigation process. It is one of the following:</p>

  <dl><dt>"<dfn id="hh-default"><code>default</code></dfn>"<dd>A regular navigation which adds a new entry to the session history.<dt>"<dfn id="hh-entry-update"><code>entry update</code></dfn>"<dd>A navigation to an existing <a id="navigating-across-documents:session-history-entry" href="history.html#session-history-entry">session history entry</a> to recreate that entry's <a href="history.html#she-document" id="navigating-across-documents:she-document">document</a>, which was previously <a href="window-object.html#discard-a-document" id="navigating-across-documents:discard-a-document">discarded</a>.<dt>"<dfn id="hh-reload"><code>reload</code></dfn>"<dd>A navigation intended to reload the current page and replace the <a href="history.html#current-entry" id="navigating-across-documents:current-entry">current session history entry</a>.<dt>"<dfn id="hh-replace"><code>replace</code></dfn>"<dd>A non-reload navigation that will replace the <a href="history.html#current-entry" id="navigating-across-documents:current-entry-2">current session history entry</a>.</dl>

  <p>Navigation always involves <dfn id="source-browsing-context" data-export="">source browsing context</dfn>, which is the browsing context which was responsible for starting the navigation.</p>

  <p class="XXX">As explained in <a href="https://github.com/whatwg/html/issues/1130">issue #1130</a> the use of a browsing context as source might not be the correct architecture.</p>

  
  
  <p>To <dfn id="navigate" data-export="">navigate</dfn> a browsing context <var>browsingContext</var> to a resource <var>resource</var>, with an optional boolean <dfn id="exceptions-enabled" data-export=""><var>exceptionsEnabled</var></dfn> (default false), an optional <a href="#history-handling-behavior" id="navigating-across-documents:history-handling-behavior-2">history handling behavior</a> <dfn id="navigation-hh"><var>historyHandling</var></dfn> (default "<code id="navigating-across-documents:hh-default"><a href="#hh-default">default</a></code>"), and an optional string <dfn id="navigation-navigationtype"><var>navigationType</var></dfn> (default "<code>other</code>"):</p>

  <ol><li><p>If <var>resource</var> is a <a id="navigating-across-documents:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, then set <var>resource</var> to a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-2" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url" data-x-internal="concept-request-url">url</a> is <var>resource</var>.<li><p>If <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-3" data-x-internal="concept-request">request</a> and <var>historyHandling</var> is "<code id="navigating-across-documents:hh-reload"><a href="#hh-reload">reload</a></code>", then set <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reload-navigation-flag" id="navigating-across-documents:concept-request-reload-navigation-flag" data-x-internal="concept-request-reload-navigation-flag">reload-navigation flag</a>.<li id="sandboxLinks"><p>If the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context">source browsing context</a> is not <a id="navigating-across-documents:allowed-to-navigate" href="browsers.html#allowed-to-navigate">allowed to navigate</a> <var>browsingContext</var>, then:</p>

    <ol><li><p>If <var>exceptionsEnabled</var> is given and is true, then throw a <a id="navigating-across-documents:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="navigating-across-documents:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Otherwise, the user agent may instead offer to open <var>resource</var> in a new <a id="navigating-across-documents:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a> or in the <a id="navigating-across-documents:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a> of the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-2">source browsing context</a>, at the user's option, in which case the user agent must <a href="#navigate" id="navigating-across-documents:navigate-2">navigate</a> that designated <a id="navigating-across-documents:top-level-browsing-context-3" href="browsers.html#top-level-browsing-context">top-level browsing context</a> to <var>resource</var> as if the user had requested it independently.</p>

      <p class="note">Doing so, however, can be dangerous, as it means that the user is overriding the author's explicit request to sandbox the content.</p>
     </ol>
   <li><p>If there is a preexisting attempt to navigate <var>browsingContext</var>, and the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-3">source browsing context</a> is the same as <var>browsingContext</var>, and that attempt is currently running the <a href="#unload-a-document" id="navigating-across-documents:unload-a-document">unload a document</a> algorithm, then return without affecting the preexisting attempt to navigate <var>browsingContext</var>.<li><p>If the <a href="#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document">prompt to unload</a> algorithm is being run for the <a id="navigating-across-documents:active-document" href="browsers.html#active-document">active document</a> of <var>browsingContext</var>, then return without affecting the <a href="#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-2">prompt to unload</a> algorithm.<li id="navigate-fragid-step"><p>If <var>historyHandling</var> is not "<code id="navigating-across-documents:hh-reload-2"><a href="#hh-reload">reload</a></code>", <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-4" data-x-internal="concept-request">request</a>, <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-2" data-x-internal="concept-request-url">url</a> <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-equals" id="navigating-across-documents:concept-url-equals" data-x-internal="concept-url-equals">equals</a> <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-2" href="browsers.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address" data-x-internal="the-document's-address">URL</a> with <a href="https://url.spec.whatwg.org/#url-equals-exclude-fragments" id="navigating-across-documents:url-equals-exclude-fragments" data-x-internal="url-equals-exclude-fragments"><i>exclude fragments</i></a> set to true, and <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-3" data-x-internal="concept-request-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a> is non-null, then:</p>

    <ol><li><p><a href="#navigate-fragid" id="navigating-across-documents:navigate-fragid">Navigate to a fragment</a> given <var>browsingContext</var>, <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-4" data-x-internal="concept-request-url">url</a>, and <var>historyHandling</var>.<li><p>Return.</ol>
   <li><p>If <var>historyHandling</var> is "<code id="navigating-across-documents:hh-default-2"><a href="#hh-default">default</a></code>", <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-5" data-x-internal="concept-request">request</a>, and either <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-5" data-x-internal="concept-request-url">url</a> <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-equals" id="navigating-across-documents:concept-url-equals-2" data-x-internal="concept-url-equals">equals</a> <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-3" href="browsers.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-2" data-x-internal="the-document's-address">URL</a> or <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-6" data-x-internal="concept-request-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> is "<code id="navigating-across-documents:javascript-protocol"><a href="#javascript-protocol">javascript</a></code>"', then set <var>historyHandling</var> to "<code id="navigating-across-documents:hh-replace"><a href="#hh-replace">replace</a></code>".<li><p>Let <var>activeDocumentNavigationOrigin</var> be the <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin" data-x-internal="concept-document-origin">origin</a> of the <a id="navigating-across-documents:active-document-4" href="browsers.html#active-document">active document</a> of <var>browsingContext</var>.<li><p>Let <var>incumbentNavigationOrigin</var> be the <a id="navigating-across-documents:concept-origin-2" href="origin.html#concept-origin">origin</a> of the <a id="navigating-across-documents:incumbent-settings-object" href="webappapis.html#incumbent-settings-object">incumbent settings object</a>, or if no <a id="navigating-across-documents:the-script-element" href="scripting.html#the-script-element">script</a> was involved, the <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-2" data-x-internal="concept-document-origin">origin</a> of the <a id="navigating-across-documents:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a> of the element that initiated the <a href="#navigate" id="navigating-across-documents:navigate-3">navigation</a>.<li><p>Cancel any preexisting but not yet <a href="#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature">mature</a> attempt to navigate <var>browsingContext</var>, including canceling any instances of the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="navigating-across-documents:concept-fetch" data-x-internal="concept-fetch">fetch</a> algorithm started by those attempts. If one of those attempts has already <a href="#initialise-the-document-object" id="navigating-across-documents:initialise-the-document-object-2">created and initialized a new <code>Document</code> object</a>, <a href="#abort-a-document" id="navigating-across-documents:abort-a-document">abort</a> that <code id="navigating-across-documents:document-7"><a href="dom.html#document">Document</a></code> also. (Navigation attempts that have <a href="#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-2">matured</a> already have session history entries, and are therefore handled during the <a href="#update-the-session-history-with-the-new-page" id="navigating-across-documents:update-the-session-history-with-the-new-page">update the session history with the new page</a> algorithm, later.)<li><p><a href="#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-3">Prompt to unload</a> the <a id="navigating-across-documents:active-document-5" href="browsers.html#active-document">active document</a> of <var>browsingContext</var>. If the user <a href="#refused-to-allow-the-document-to-be-unloaded" id="navigating-across-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then return.</p>

    <p>If this instance of the <a href="#navigate" id="navigating-across-documents:navigate-4">navigation</a> algorithm gets canceled while this step is running, the <a href="#prompt-to-unload-a-document" id="navigating-across-documents:prompt-to-unload-a-document-4">prompt to unload</a> algorithm must nonetheless be run to completion.</p>
   <li><p><a href="#abort-a-document" id="navigating-across-documents:abort-a-document-2">Abort</a> the <a id="navigating-across-documents:active-document-6" href="browsers.html#active-document">active document</a> of <var>browsingContext</var>.<li><p>If <var>browsingContext</var> is a <a id="navigating-across-documents:child-browsing-context" href="browsers.html#child-browsing-context">child browsing context</a>, then put it in the <a id="navigating-across-documents:delaying-load-events-mode" href="browsers.html#delaying-load-events-mode">delaying <code>load</code> events mode</a>.</p>

    <p>The user agent must take this <a id="navigating-across-documents:child-browsing-context-2" href="browsers.html#child-browsing-context">child browsing context</a> out of the <a id="navigating-across-documents:delaying-load-events-mode-2" href="browsers.html#delaying-load-events-mode">delaying <code>load</code> events mode</a> when this <a href="#navigate" id="navigating-across-documents:navigate-5">navigation</a> algorithm later <a href="#concept-navigate-mature" id="navigating-across-documents:concept-navigate-mature-3">matures</a>, or when it terminates (whether due to having run all the steps, or being canceled, or being aborted), whichever happens first.</p>

    
   <li><p>Let <var>sandboxFlags</var> be the result of <a id="navigating-across-documents:determining-the-creation-sandboxing-flags" href="origin.html#determining-the-creation-sandboxing-flags">determining the creation sandboxing flags</a> given <var>browsingContext</var> and <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container">container</a>.<li><p>Let <var>allowedToDownload</var> be the result of running the <a id="navigating-across-documents:allowed-to-download" href="links.html#allowed-to-download">allowed to download</a> algorithm given the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-4">source browsing context</a> and <var>browsingContext</var>.<li><p>Return to whatever algorithm invoked the navigation steps and continue running these steps <a id="navigating-across-documents:in-parallel" href="infrastructure.html#in-parallel">in parallel</a>.<li><p>This is the step that attempts to obtain <var>resource</var>, if necessary. Jump to the first appropriate substep:</p>

    <dl><dt>If <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="navigating-across-documents:concept-response-2" data-x-internal="concept-response">response</a><dd><ol><li><p>Assert: <var>browsingContext</var> is not a <a id="navigating-across-documents:top-level-browsing-context-4" href="browsers.html#top-level-browsing-context">top-level browsing context</a>.<li><p>Let <var>finalSandboxFlags</var> be the <a href="https://triple-underscore.github.io/infra-ja.html#set-union" id="navigating-across-documents:set-union" data-x-internal="set-union">union</a> of <var>browsingContext</var>'s <a href="origin.html#concept-bc-sandboxing-flags" id="navigating-across-documents:concept-bc-sandboxing-flags">sandboxing flags</a> and <var>resource</var>'s <a id="navigating-across-documents:forced-sandboxing-flag-set" href="origin.html#forced-sandboxing-flag-set">forced sandboxing flag set</a>.<li><p>Let <var>responseOrigin</var> be the result of <a id="navigating-across-documents:determining-the-origin" href="browsers.html#determining-the-origin">determining the origin</a> given <var>browsingContext</var>, <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="navigating-across-documents:concept-response-url" data-x-internal="concept-response-url">url</a>, <var>finalSandboxFlags</var>, <var>incumbentNavigationOrigin</var>, and <var>activeDocumentNavigationOrigin</var>.<li><p>Let <var>coop</var> be a new <a id="navigating-across-documents:cross-origin-opener-policy-2" href="origin.html#cross-origin-opener-policy">cross-origin opener policy</a>.<li><p>Let <var>coopEnforcementResult</var> be a new <a href="origin.html#coop-enforcement-result" id="navigating-across-documents:coop-enforcement-result-2">cross-origin opener policy enforcement result</a> whose <a href="origin.html#coop-enforcement-bcg-switch" id="navigating-across-documents:coop-enforcement-bcg-switch">needs a browsing context group switch</a> is false, <a href="origin.html#coop-enforcement-bcg-switch-report-only" id="navigating-across-documents:coop-enforcement-bcg-switch-report-only">would need a browsing context group switch due to report-only</a> is false, <a href="origin.html#coop-enforcement-url" id="navigating-across-documents:coop-enforcement-url">url</a> is <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="navigating-across-documents:concept-response-url-2" data-x-internal="concept-response-url">url</a>, <a href="origin.html#coop-enforcement-origin" id="navigating-across-documents:coop-enforcement-origin">origin</a> is <var>responseOrigin</var>, <a href="origin.html#coop-enforcement-coop" id="navigating-across-documents:coop-enforcement-coop">cross-origin opener policy</a> is <var>coop</var>, and <a href="origin.html#coop-enforcement-source" id="navigating-across-documents:coop-enforcement-source">current context is navigation source</a> is false.<li><p>Let <var>navigationParams</var> be a new <a href="#navigation-params" id="navigating-across-documents:navigation-params-2">navigation params</a> whose <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request">request</a> is null, <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response">response</a> is <var>resource</var>, <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin">origin</a> is <var>responseOrigin</var>, <a href="#navigation-params-sandboxing" id="navigating-across-documents:navigation-params-sandboxing">final sandboxing flag set</a> is <var>finalSandboxFlags</var>, <a href="#navigation-params-coop" id="navigating-across-documents:navigation-params-coop">cross-origin opener policy</a> is <var>coop</var>, <a href="#navigation-params-coop-enforcement-result" id="navigating-across-documents:navigation-params-coop-enforcement-result">COOP enforcement result</a> is <var>coopEnforcementResult</var>, <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment">reserved environment</a> is null, <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context">browsing context</a> is <var>browsingContext</var>, and <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh">history handling</a> is <var>historyHandling</var>.<li><p>Run <a href="#process-a-navigate-response" id="navigating-across-documents:process-a-navigate-response">process a navigate response</a> with <var>navigationType</var>, <var>allowedToDownload</var>, and <var>navigationParams</var>.</ol>
     <dt>If <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-6" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-7" data-x-internal="concept-request-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-2" data-x-internal="concept-url-scheme">scheme</a> is "<code id="navigating-across-documents:javascript-protocol-2"><a href="#javascript-protocol">javascript</a></code>"<dd><p><a id="navigating-across-documents:queue-a-global-task" href="webappapis.html#queue-a-global-task">Queue a global task</a> on the <a id="navigating-across-documents:dom-manipulation-task-source" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>browsingContext</var>'s <a id="navigating-across-documents:active-window" href="browsers.html#active-window">active window</a> to run these steps:</p>

      <ol><li><p>Let <var>response</var> be the result of <a href="#javascript-protocol" id="navigating-across-documents:javascript-protocol-3">executing a <code>javascript:</code> URL request</a> given <var>resource</var>, the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-5">source browsing context</a>, and <var>browsingContext</var>.<li><p>Let <var>finalSandboxFlags</var> be the <a href="https://triple-underscore.github.io/infra-ja.html#set-union" id="navigating-across-documents:set-union-2" data-x-internal="set-union">union</a> of <var>browsingContext</var>'s <a href="origin.html#concept-bc-sandboxing-flags" id="navigating-across-documents:concept-bc-sandboxing-flags-2">sandboxing flags</a> and <var>response</var>'s <a id="navigating-across-documents:forced-sandboxing-flag-set-2" href="origin.html#forced-sandboxing-flag-set">forced sandboxing flag set</a>.<li><p>Let <var>coopEnforcementResult</var> be a new <a href="origin.html#coop-enforcement-result" id="navigating-across-documents:coop-enforcement-result-3">cross-origin opener policy enforcement result</a> whose <a href="origin.html#coop-enforcement-bcg-switch" id="navigating-across-documents:coop-enforcement-bcg-switch-2">needs a browsing context group switch</a> is false, <a href="origin.html#coop-enforcement-bcg-switch-report-only" id="navigating-across-documents:coop-enforcement-bcg-switch-report-only-2">would need a browsing context group switch due to report-only</a> is false, <a href="origin.html#coop-enforcement-url" id="navigating-across-documents:coop-enforcement-url-2">url</a> is <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-8" data-x-internal="concept-request-url">url</a>, <a href="origin.html#coop-enforcement-origin" id="navigating-across-documents:coop-enforcement-origin-2">origin</a> is <var>activeDocumentNavigationOrigin</var>, <a href="origin.html#coop-enforcement-coop" id="navigating-across-documents:coop-enforcement-coop-2">cross-origin opener policy</a> is <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-7" href="browsers.html#active-document">active document</a>'s <a href="dom.html#concept-document-coop" id="navigating-across-documents:concept-document-coop">cross-origin opener policy</a>, and <a href="origin.html#coop-enforcement-source" id="navigating-across-documents:coop-enforcement-source-2">current context is navigation source</a> is false.<li><p>Let <var>navigationParams</var> be a new <a href="#navigation-params" id="navigating-across-documents:navigation-params-3">navigation params</a> whose <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-2">request</a> is <var>resource</var>, <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-2">response</a> is <var>response</var>, <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-2">origin</a> is <var>activeDocumentNavigationOrigin</var>, <a href="#navigation-params-sandboxing" id="navigating-across-documents:navigation-params-sandboxing-2">final sandboxing flag set</a> is <var>finalSandboxFlags</var>, <a href="#navigation-params-coop" id="navigating-across-documents:navigation-params-coop-2">cross-origin opener policy</a> is <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-8" href="browsers.html#active-document">active document</a>'s <a href="dom.html#concept-document-coop" id="navigating-across-documents:concept-document-coop-2">cross-origin opener policy</a>, <a href="#navigation-params-coop-enforcement-result" id="navigating-across-documents:navigation-params-coop-enforcement-result-2">COOP enforcement result</a> is <var>coopEnforcementResult</var>, <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-2">reserved environment</a> is null, <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context-2">browsing context</a> is <var>browsingContext</var>, and <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh-2">history handling</a> is <var>historyHandling</var>.<li><p>Run <a href="#process-a-navigate-response" id="navigating-across-documents:process-a-navigate-response-2">process a navigate response</a> with <var>navigationType</var>, <var>allowedToDownload</var>, and <var>navigationParams</var>.</ol>

      <p class="example">So for example a <a href="#javascript-protocol" id="navigating-across-documents:javascript-protocol-4"><code>javascript:</code> URL</a> in an <code id="navigating-across-documents:attr-hyperlink-href"><a href="links.html#attr-hyperlink-href">href</a></code> attribute of an <code id="navigating-across-documents:the-a-element"><a href="text-level-semantics.html#the-a-element">a</a></code> element would only be evaluated when the link was <a href="links.html#following-hyperlinks-2" id="navigating-across-documents:following-hyperlinks-2-2">followed</a>, while such a URL in the <code id="navigating-across-documents:attr-iframe-src"><a href="iframe-embed-object.html#attr-iframe-src">src</a></code> attribute of an <code id="navigating-across-documents:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> element would be evaluated in the context of the <code id="navigating-across-documents:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>'s <a id="navigating-across-documents:nested-browsing-context" href="browsers.html#nested-browsing-context">nested browsing context</a> when the <code id="navigating-across-documents:the-iframe-element-3"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> is being set up. Once evaluated, its return value (if it was a string) would replace that <a id="navigating-across-documents:browsing-context-3" href="browsers.html#browsing-context">browsing context</a>'s <a id="navigating-across-documents:active-document-9" href="browsers.html#active-document">active document</a>, thus also changing the corresponding <code id="navigating-across-documents:window"><a href="window-object.html#window">Window</a></code> object.</p>
     <dt>If <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-7" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-9" data-x-internal="concept-request-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-3" data-x-internal="concept-url-scheme">scheme</a> is a <a id="navigating-across-documents:fetch-scheme" href="https://triple-underscore.github.io/Fetch-ja.html#fetch-scheme" data-x-internal="fetch-scheme">fetch scheme</a><dd><p>Run <a href="#process-a-navigate-fetch" id="navigating-across-documents:process-a-navigate-fetch">process a navigate fetch</a> given <var>resource</var>, the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-6">source browsing context</a>, <var>browsingContext</var>, <var>navigationType</var>, <var>sandboxFlags</var>, <var>allowedToDownload</var>, <var>incumbentNavigationOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and <var>historyHandling</var>.<dt>Otherwise, <var>resource</var> is a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-8" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-10" data-x-internal="concept-request-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-4" data-x-internal="concept-url-scheme">scheme</a> is neither "<code id="navigating-across-documents:javascript-protocol-5"><a href="#javascript-protocol">javascript</a></code>" nor a <a id="navigating-across-documents:fetch-scheme-2" href="https://triple-underscore.github.io/Fetch-ja.html#fetch-scheme" data-x-internal="fetch-scheme">fetch scheme</a><dd><p>Run <a href="#process-a-navigate-url-scheme" id="navigating-across-documents:process-a-navigate-url-scheme">process a navigate URL scheme</a> given <var>resource</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-11" data-x-internal="concept-request-url">url</a> and <var>browsingContext</var>.</dl>
   </ol>

  <p>To <dfn id="process-a-navigate-fetch" data-export="">process a navigate fetch</dfn>, given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-9" data-x-internal="concept-request">request</a> <var>request</var>, two <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-4">browsing contexts</a> <var>sourceBrowsingContext</var> and <var>browsingContext</var>, a string <var>navigationType</var>, a <a id="navigating-across-documents:sandboxing-flag-set-2" href="origin.html#sandboxing-flag-set">sandboxing flag set</a> <var>sandboxFlags</var>, a boolean <var>allowedToDownload</var>, two <a href="origin.html#concept-origin" id="navigating-across-documents:concept-origin-3">origins</a> <var>incumbentNavigationOrigin</var> and <var>activeDocumentNavigationOrigin</var>, and a <a href="#history-handling-behavior" id="navigating-across-documents:history-handling-behavior-3">history handling behavior</a> <var>historyHandling</var>:</p>

  <ol><li><p>Let <var>response</var> be null.<li><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="navigating-across-documents:concept-request-client" data-x-internal="concept-request-client">client</a> to <var>sourceBrowsingContext</var>'s <a id="navigating-across-documents:active-document-10" href="browsers.html#active-document">active document</a>'s <a id="navigating-across-documents:relevant-settings-object" href="webappapis.html#relevant-settings-object">relevant settings object</a>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="navigating-across-documents:concept-request-destination" data-x-internal="concept-request-destination">destination</a> to "<code>document</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode" id="navigating-across-documents:concept-request-mode" data-x-internal="concept-request-mode">mode</a> to "<code>navigate</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="navigating-across-documents:concept-request-credentials-mode" data-x-internal="concept-request-credentials-mode">credentials mode</a> to "<code>include</code>", <a id="navigating-across-documents:use-url-credentials-flag" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-redirect-mode" id="navigating-across-documents:concept-request-redirect-mode" data-x-internal="concept-request-redirect-mode">redirect mode</a> to "<code>manual</code>", and <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-replaces-client-id" id="navigating-across-documents:concept-request-replaces-client-id" data-x-internal="concept-request-replaces-client-id">replaces client id</a> to <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-11" href="browsers.html#active-document">active document</a>'s <a id="navigating-across-documents:relevant-settings-object-2" href="webappapis.html#relevant-settings-object">relevant settings object</a>'s <a href="webappapis.html#concept-environment-id" id="navigating-across-documents:concept-environment-id">id</a>.<li><p>If <var>sourceBrowsingContext</var>'s <code id="navigating-across-documents:windowproxy"><a href="window-object.html#windowproxy">WindowProxy</a></code>'s [[Window]] value has <a id="navigating-across-documents:transient-activation" href="interaction.html#transient-activation">transient activation</a>, then set <var>request</var>'s <a href="https://fetch.spec.whatwg.org/#request-user-activation" id="navigating-across-documents:concept-request-user-activation" data-x-internal="concept-request-user-activation">user-activation</a> to true.<li><p>If <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container-2">container</a> is non-null:</p>

    <ol><li><p>If the <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container-3">container</a> has a <a id="navigating-across-documents:browsing-context-scope-origin" href="browsers.html#browsing-context-scope-origin">browsing context scope origin</a>, then set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-origin" id="navigating-across-documents:concept-request-origin" data-x-internal="concept-request-origin">origin</a> to that <a id="navigating-across-documents:browsing-context-scope-origin-2" href="browsers.html#browsing-context-scope-origin">browsing context scope origin</a>.<li><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="navigating-across-documents:concept-request-destination-2" data-x-internal="concept-request-destination">destination</a> to <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container-4">container</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-local-name" id="navigating-across-documents:concept-element-local-name" data-x-internal="concept-element-local-name">local name</a>.</ol>
   <li><p>Let <var>responseOrigin</var> be null.<li><p>Let <var>currentContextIsSource</var> be the result of whether <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-12" href="browsers.html#active-document">active document</a> is <a id="navigating-across-documents:same-origin" href="origin.html#same-origin">same origin</a> with <var>source</var>'s <a id="navigating-across-documents:active-document-13" href="browsers.html#active-document">active document</a>.<li><p>Let <var>coopEnforcementResult</var> be a new <a href="origin.html#coop-enforcement-result" id="navigating-across-documents:coop-enforcement-result-4">cross-origin opener policy enforcement result</a> whose <a href="origin.html#coop-enforcement-bcg-switch" id="navigating-across-documents:coop-enforcement-bcg-switch-3">needs a browsing context group switch</a> is false, <a href="origin.html#coop-enforcement-bcg-switch-report-only" id="navigating-across-documents:coop-enforcement-bcg-switch-report-only-3">would need a browsing context group switch due to report-only</a> is false, <a href="origin.html#coop-enforcement-url" id="navigating-across-documents:coop-enforcement-url-3">url</a> is <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-14" href="browsers.html#active-document">active document</a>'s <a id="navigating-across-documents:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">url</a>, <a href="origin.html#coop-enforcement-origin" id="navigating-across-documents:coop-enforcement-origin-3">origin</a> is <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-15" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-3" data-x-internal="concept-document-origin">origin</a>, <a href="origin.html#coop-enforcement-coop" id="navigating-across-documents:coop-enforcement-coop-3">cross-origin opener policy</a> is <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-16" href="browsers.html#active-document">active document</a>'s <a href="dom.html#concept-document-coop" id="navigating-across-documents:concept-document-coop-3">cross-origin opener policy</a>, and <a href="origin.html#coop-enforcement-source" id="navigating-across-documents:coop-enforcement-source-3">current context is navigation source</a> is <var>currentContextIsSource</var>.<li><p>Let <var>finalSandboxFlags</var> be an empty <a id="navigating-across-documents:sandboxing-flag-set-3" href="origin.html#sandboxing-flag-set">sandboxing flag set</a>.<li><p>Let <var>locationURL</var> be null.<li><p>Let <var>currentURL</var> be <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-current-url" id="navigating-across-documents:concept-request-current-url" data-x-internal="concept-request-current-url">current URL</a>.<li><p>While true:</p>

    <ol><li><p>If <var>locationURL</var> is non-null, then set <var>currentURL</var> to <var>locationURL</var>.<li><p>If <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client" data-x-internal="concept-request-reserved-client">reserved client</a> is not null and <var>currentURL</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="navigating-across-documents:concept-url-origin" data-x-internal="concept-url-origin">origin</a> is not the <a href="origin.html#same-origin" id="navigating-across-documents:same-origin-2">same</a> as <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-2" data-x-internal="concept-request-reserved-client">reserved client</a>'s <a href="webappapis.html#concept-environment-creation-url" id="navigating-across-documents:concept-environment-creation-url">creation URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="navigating-across-documents:concept-url-origin-2" data-x-internal="concept-url-origin">origin</a>, then:</p>

      <ol><li><p>Run the <a id="navigating-across-documents:environment-discarding-steps" href="webappapis.html#environment-discarding-steps">environment discarding steps</a> for <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-3" data-x-internal="concept-request-reserved-client">reserved client</a>.<li><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-4" data-x-internal="concept-request-reserved-client">reserved client</a> to null.</ol>
     <li><p>If <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-5" data-x-internal="concept-request-reserved-client">reserved client</a> is null, then:</p>

      <ol><li><p>Let <var>topLevelCreationURL</var> be <var>currentURL</var>.<li><p>Let <var>topLevelOrigin</var> be null.<li><p>If <var>browsingContext</var> is not a <a id="navigating-across-documents:top-level-browsing-context-5" href="browsers.html#top-level-browsing-context">top-level browsing context</a>, then:</p>

        <ol><li><p>Let <var>parentEnvironment</var> be <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container-5">container</a>'s <a id="navigating-across-documents:relevant-settings-object-3" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>Set <var>topLevelCreationURL</var> to <var>parentEnvironment</var>'s <a id="navigating-across-documents:concept-environment-top-level-creation-url" href="webappapis.html#concept-environment-top-level-creation-url">top-level creation URL</a> and <var>topLevelOrigin</var> to <var>parentEnvironment</var>'s <a id="navigating-across-documents:concept-environment-top-level-origin" href="webappapis.html#concept-environment-top-level-origin">top-level origin</a>.</ol>
       <li><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-6" data-x-internal="concept-request-reserved-client">reserved client</a> to a new <a id="navigating-across-documents:environment-2" href="webappapis.html#environment">environment</a> whose <a href="webappapis.html#concept-environment-id" id="navigating-across-documents:concept-environment-id-2">id</a> is a unique opaque string, <a href="webappapis.html#concept-environment-target-browsing-context" id="navigating-across-documents:concept-environment-target-browsing-context">target browsing context</a> is <var>browsingContext</var>, <a href="webappapis.html#concept-environment-creation-url" id="navigating-across-documents:concept-environment-creation-url-2">creation URL</a> is <var>currentURL</var>, <a id="navigating-across-documents:concept-environment-top-level-creation-url-2" href="webappapis.html#concept-environment-top-level-creation-url">top-level creation URL</a> is <var>topLevelCreationURL</var>, and <a id="navigating-across-documents:concept-environment-top-level-origin-2" href="webappapis.html#concept-environment-top-level-origin">top-level origin</a> is <var>topLevelOrigin</var>.</p>

        <p class="note">The created environment's <a href="webappapis.html#concept-environment-active-service-worker" id="navigating-across-documents:concept-environment-active-service-worker">active service worker</a> is set in the <a href="https://triple-underscore.github.io/service-workers-ja.html#on-fetch-request-algorithm" id="navigating-across-documents:on-fetch-request-algorithm" data-x-internal="on-fetch-request-algorithm">Handle Fetch</a> algorithm during the fetch if the request URL matches a service worker registration. <a href="references.html#refsSW">[SW]</a></p>
       </ol>
     <li><p>If the result of <a id="navigating-across-documents:should-navigation-request-of-type-be-blocked-by-content-security-policy" href="https://triple-underscore.github.io/CSP3-ja.html#should-block-navigation-request" data-x-internal="should-navigation-request-of-type-be-blocked-by-content-security-policy">Should navigation request of type be blocked by Content Security Policy?</a> given <var>request</var> and <var>navigationType</var> is "<code>Blocked</code>", then set <var>response</var> to a <a id="navigating-across-documents:network-error-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a> and <a id="navigating-across-documents:break" href="https://triple-underscore.github.io/infra-ja.html#iteration-break" data-x-internal="break">break</a>. <a href="references.html#refsCSP">[CSP]</a><li><p>Otherwise:</p>

      <ol><li><p>If <var>response</var> is null, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="navigating-across-documents:concept-fetch-2" data-x-internal="concept-fetch">fetch</a> <var>request</var>.<li><p>Otherwise, perform <a id="navigating-across-documents:http-redirect-fetch" href="https://triple-underscore.github.io/Fetch-ja.html#concept-http-redirect-fetch" data-x-internal="http-redirect-fetch">HTTP-redirect fetch</a> using <var>request</var> and <var>response</var>.<li><p>Wait for the <a href="webappapis.html#concept-task" id="navigating-across-documents:concept-task">task</a> on the <a id="navigating-across-documents:networking-task-source" href="webappapis.html#networking-task-source">networking task source</a> to <a id="navigating-across-documents:process-response" href="https://triple-underscore.github.io/Fetch-ja.html#process-response" data-x-internal="process-response">process response</a> and set <var>response</var> to the result.<li><p>Set <var>finalSandboxFlags</var> to the <a href="https://triple-underscore.github.io/infra-ja.html#set-union" id="navigating-across-documents:set-union-3" data-x-internal="set-union">union</a> of <var>browsingContext</var>'s <a href="origin.html#concept-bc-sandboxing-flags" id="navigating-across-documents:concept-bc-sandboxing-flags-3">sandboxing flags</a> and <var>response</var>'s <a id="navigating-across-documents:forced-sandboxing-flag-set-3" href="origin.html#forced-sandboxing-flag-set">forced sandboxing flag set</a>.<li><p>Set <var>responseOrigin</var> to the result of <a id="navigating-across-documents:determining-the-origin-2" href="browsers.html#determining-the-origin">determining the origin</a> given <var>browsingContext</var>, <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-12" data-x-internal="concept-request-url">url</a>, <var>finalSandboxFlags</var>, <var>incumbentNavigationOrigin</var>, and <var>activeDocumentNavigationOrigin</var>.<li><p>If <var>browsingContext</var> is a <a id="navigating-across-documents:top-level-browsing-context-6" href="browsers.html#top-level-browsing-context">top-level browsing context</a>, then:</p>

        <ol><li><p>Set <var>responseCOOP</var> to the result of <a href="origin.html#obtain-coop" id="navigating-across-documents:obtain-coop">obtaining a cross-origin opener policy</a> given <var>response</var> and <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-7" data-x-internal="concept-request-reserved-client">reserved client</a>.<li><p>If <var>sandboxFlags</var> is not empty and <var>responseCOOP</var>'s <a href="origin.html#coop-struct-value" id="navigating-across-documents:coop-struct-value">value</a> is not "<code id="navigating-across-documents:coop-unsafe-none"><a href="origin.html#coop-unsafe-none">unsafe-none</a></code>", then set <var>response</var> to an appropriate <a id="navigating-across-documents:network-error-3" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a> and <a id="navigating-across-documents:break-2" href="https://triple-underscore.github.io/infra-ja.html#iteration-break" data-x-internal="break">break</a>.</p>

          <p class="note">This results in a network error as one cannot simultaneously provide a clean slate to a response using cross-origin opener policy and sandbox the result of navigating to that response.</p>
         <li><p>Set <var>coopEnforcementResult</var> to the result of <a href="origin.html#coop-enforce" id="navigating-across-documents:coop-enforce">enforcing the response's cross-origin opener policy</a> given <var>browsingContext</var>, <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-13" data-x-internal="concept-request-url">url</a>, <var>responseOrigin</var>, <var>responseCOOP</var>, <var>coopEnforcementResult</var> and <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="navigating-across-documents:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a>.</ol>
       <li><p>If <var>response</var> is not a <a id="navigating-across-documents:network-error-4" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a>, <var>browsingContext</var> is a <a id="navigating-across-documents:child-browsing-context-3" href="browsers.html#child-browsing-context">child browsing context</a>, and the result of performing a <a id="navigating-across-documents:cross-origin-resource-policy-check" href="https://triple-underscore.github.io/Fetch-ja.html#cross-origin-resource-policy-check" data-x-internal="cross-origin-resource-policy-check">cross-origin resource policy check</a> with <var>browsingContext</var>'s <a href="browsers.html#bc-container-document" id="navigating-across-documents:bc-container-document">container document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-4" data-x-internal="concept-document-origin">origin</a>, <var>browsingContext</var>'s <a href="browsers.html#bc-container-document" id="navigating-across-documents:bc-container-document-2">container document</a>'s <a id="navigating-across-documents:relevant-settings-object-4" href="webappapis.html#relevant-settings-object">relevant settings object</a>, <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="navigating-across-documents:concept-request-destination-3" data-x-internal="concept-request-destination">destination</a>, <var>response</var>, and true is <b>blocked</b>, then set <var>response</var> to a <a id="navigating-across-documents:network-error-5" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a> and <a id="navigating-across-documents:break-3" href="https://triple-underscore.github.io/infra-ja.html#iteration-break" data-x-internal="break">break</a>.</p>

        <p class="note">Here we're running the <a id="navigating-across-documents:cross-origin-resource-policy-check-2" href="https://triple-underscore.github.io/Fetch-ja.html#cross-origin-resource-policy-check" data-x-internal="cross-origin-resource-policy-check">cross-origin resource policy check</a> against the <a id="navigating-across-documents:parent-browsing-context" href="browsers.html#parent-browsing-context">parent browsing context</a> rather than <var>sourceBrowsingContext</var>. This is because we care about the same-originness of the embedded content against the parent context, not the navigation source.</p>
       <li><p>Set <var>locationURL</var> to <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-location-url" id="navigating-across-documents:concept-response-location-url" data-x-internal="concept-response-location-url">location URL</a> given <var>currentURL</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragment</a>.<li><p>If <var>locationURL</var> is not a <a id="navigating-across-documents:url-3" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> whose <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-5" data-x-internal="concept-url-scheme">scheme</a> is an <a id="navigating-across-documents:http(s)-scheme" href="https://triple-underscore.github.io/Fetch-ja.html#http-scheme" data-x-internal="http(s)-scheme">HTTP(S) scheme</a>, then <a id="navigating-across-documents:break-4" href="https://triple-underscore.github.io/infra-ja.html#iteration-break" data-x-internal="break">break</a>.</p>

        <p class="note">Navigation handles redirects manually as navigation is the only place in the web platform that cares for redirects to <code id="navigating-across-documents:mailto-protocol"><a data-x-internal="mailto-protocol" href="https://tools.ietf.org/html/rfc6068#section-2">mailto:</a></code> URLs and such.</p>
       </ol>
     </ol>
   <li><p>If <var>locationURL</var> is failure, then set <var>response</var> to a <a id="navigating-across-documents:network-error-6" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a>.<li><p>Otherwise, if <var>locationURL</var> is a <a id="navigating-across-documents:url-4" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> whose <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-6" data-x-internal="concept-url-scheme">scheme</a> is "<code>blob</code>", "<code>file</code>", "<code>filesystem</code>", or "<code>javascript</code>", then set <var>response</var> to a network error.<li><p>Otherwise, if <var>locationURL</var> is a <a id="navigating-across-documents:url-5" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> whose <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-7" data-x-internal="concept-url-scheme">scheme</a> is a <a id="navigating-across-documents:fetch-scheme-3" href="https://triple-underscore.github.io/Fetch-ja.html#fetch-scheme" data-x-internal="fetch-scheme">fetch scheme</a>, then run <a href="#process-a-navigate-fetch" id="navigating-across-documents:process-a-navigate-fetch-2">process a navigate fetch</a> with a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-10" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-14" data-x-internal="concept-request-url">url</a> is <var>locationURL</var>, <var>sourceBrowsingContext</var>, <var>browsingContext</var>, <var>navigationType</var>, <var>allowedToDownload</var>, <var>sandboxFlags</var>, <var>incumbentNavigationOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and <var>historyHandling</var>, and return.<li><p>Otherwise, if <var>locationURL</var> is a <a id="navigating-across-documents:url-6" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, run the <a href="#process-a-navigate-url-scheme" id="navigating-across-documents:process-a-navigate-url-scheme-2">process a navigate URL scheme</a> given <var>locationURL</var> and <var>browsingContext</var>, and return.<li><p>Let <var>navigationParams</var> be a new <a href="#navigation-params" id="navigating-across-documents:navigation-params-4">navigation params</a> whose <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-3">request</a> is <var>request</var>, <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-3">response</a> is <var>response</var>, <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-3">origin</a> is <var>responseOrigin</var>, <a href="#navigation-params-sandboxing" id="navigating-across-documents:navigation-params-sandboxing-3">final sandboxing flag set</a> is <var>finalSandboxFlags</var>, <a href="#navigation-params-coop" id="navigating-across-documents:navigation-params-coop-3">cross-origin opener policy</a> is <var>responseCOOP</var>, <a href="#navigation-params-coop-enforcement-result" id="navigating-across-documents:navigation-params-coop-enforcement-result-3">COOP enforcement result</a> is <var>coopEnforcementResult</var>, <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-3">reserved environment</a> is <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-reserved-client" id="navigating-across-documents:concept-request-reserved-client-8" data-x-internal="concept-request-reserved-client">reserved client</a>, <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context-3">browsing context</a> is <var>browsingContext</var>, and <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh-3">history handling</a> is <var>historyHandling</var>.<li><p>Run <a href="#process-a-navigate-response" id="navigating-across-documents:process-a-navigate-response-3">process a navigate response</a> with <var>navigationType</var>, <var>allowedToDownload</var>, and <var>navigationParams</var>.</ol>

  <p>To <dfn id="process-a-navigate-response" data-export="">process a navigate response</dfn>, given a string <var>navigationType</var>, a boolean <var>allowedToDownload</var>, and a <a href="#navigation-params" id="navigating-across-documents:navigation-params-5">navigation params</a> <var>navigationParams</var>:</p>

  <ol><li><p>Let <var>response</var> be <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-4">response</a>.<li><p>Let <var>browsingContext</var> be <var>navigationParams</var>'s <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context-4">browsing context</a>.<li><p>Let <var>failure</var> be false.<li><p>If <var>response</var> is a <a id="navigating-across-documents:network-error-7" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a>, then set <var>failure</var> to true.</p>

    <p>Otherwise, if the result of <a id="navigating-across-documents:should-navigation-response-to-navigation-request-of-type-in-target-be-blocked-by-content-security-policy" href="https://triple-underscore.github.io/CSP3-ja.html#should-block-navigation-response" data-x-internal="should-navigation-response-to-navigation-request-of-type-in-target-be-blocked-by-content-security-policy">Should navigation response to navigation request of type in target be blocked by Content Security Policy?</a> given <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-4">request</a>, <var>response</var>, <var>navigationType</var>, and <var>browsingContext</var> is "<code>Blocked</code>", then set <var>failure</var> to true. <a href="references.html#refsCSP">[CSP]</a></p>

    <p>Otherwise, if <var>navigationParams</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-4">reserved environment</a> is non-null and the result of <a href="origin.html#check-a-navigation-response's-adherence-to-its-embedder-policy" id="navigating-across-documents:check-a-navigation-response's-adherence-to-its-embedder-policy">checking a navigation response's adherence to its embedder policy</a> given <var>response</var>, <var>browsingContext</var>, and <var>navigationParams</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-5">reserved environment</a> is false, then set <var>failure</var> to true.</p>

    <p>Otherwise, if the result of <a href="#check-a-navigation-response's-adherence-to-x-frame-options" id="navigating-across-documents:check-a-navigation-response's-adherence-to-x-frame-options">checking a navigation response's adherence to `<code>X-Frame-Options</code>`</a> given <var>response</var>, <var>browsingContext</var>, and <var>navigationParams</var>'s <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-4">origin</a> is false, then set <var>failure</var> to true.</p>
   <li><p>If <var>failure</var> is true, then:</p>

    <ol><li><p><a href="#read-ua-inline" id="navigating-across-documents:read-ua-inline">Display the inline content with an appropriate error shown to the user</a> given <var>browsingContext</var>.<li><p>Run the <a href="webappapis.html#environment-discarding-steps" id="navigating-across-documents:environment-discarding-steps-2">environment discarding steps</a> for <var>navigationParams</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-6">reserved environment</a>.<li><p>Return.</ol>

    <p class="note">This is where the network errors defined and propagated by <cite>Fetch</cite>, such as DNS or TLS errors, end up being displayed to users. <a href="references.html#refsFETCH">[FETCH]</a></p>
   <li><p>If <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="navigating-across-documents:concept-response-status" data-x-internal="concept-response-status">status</a> is 204 or 205, then return.<li><p>If <var>response</var> has a `<code id="navigating-across-documents:http-content-disposition"><a data-x-internal="http-content-disposition" href="https://tools.ietf.org/html/rfc6266">Content-Disposition</a></code>` header specifying the <code>attachment</code> disposition type, then:</p>

    <ol><li><p>If <var>allowedToDownload</var> is true, then handle <var>response</var> <a id="navigating-across-documents:as-a-download" href="links.html#as-a-download">as a download</a>.<li><p>Return.</ol>
   <li><p>Let <var>type</var> be the <a href="https://triple-underscore.github.io/mimesniff-ja.html#computed-mime-type" id="navigating-across-documents:content-type-sniffing-2" data-x-internal="content-type-sniffing-2">computed type of <var>response</var></a>.<li><p>If the user agent has been configured to process resources of the given <var>type</var> using some mechanism other than rendering the content in a <a id="navigating-across-documents:browsing-context-5" href="browsers.html#browsing-context">browsing context</a>, then skip this step. Otherwise, if the <var>type</var> is one of the following types, jump to the appropriate entry in the following list, and process <var>response</var> as described there:</p>

    <dl class="switch"><dt>an <a id="navigating-across-documents:html-mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#html-mime-type" data-x-internal="html-mime-type">HTML MIME type</a><dd>Follow the steps given in the <a href="#navigate-html" id="navigating-across-documents:navigate-html">HTML document</a> section providing <var>navigationParams</var>. Once the steps have completed, return.<dt>an <a id="navigating-across-documents:xml-mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#xml-mime-type" data-x-internal="xml-mime-type">XML MIME type</a> that is not an <a href="#explicitly-supported-xml-mime-type" id="navigating-across-documents:explicitly-supported-xml-mime-type">explicitly supported XML MIME type</a><dd>Follow the steps given in the <a href="#read-xml" id="navigating-across-documents:read-xml">XML document</a> section providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed, return.<dt>a <a id="navigating-across-documents:javascript-mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#javascript-mime-type" data-x-internal="javascript-mime-type">JavaScript MIME type</a><dt>a <a id="navigating-across-documents:json-mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#json-mime-type" data-x-internal="json-mime-type">JSON MIME type</a> that is not an <a href="#explicitly-supported-json-mime-type" id="navigating-across-documents:explicitly-supported-json-mime-type">explicitly supported JSON MIME type</a><dt>"<code id="navigating-across-documents:text/css"><a href="indices.html#text/css">text/css</a></code>"<dt>"<code id="navigating-across-documents:text/plain"><a data-x-internal="text/plain" href="https://tools.ietf.org/html/rfc2046#section-4.1.3">text/plain</a></code>"<dt>"<code id="navigating-across-documents:text/vtt"><a href="indices.html#text/vtt">text/vtt</a></code>"<dd>Follow the steps given in the <a href="#read-text" id="navigating-across-documents:read-text">plain text file</a> section providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed, return.<dt>"<code id="navigating-across-documents:multipart/x-mixed-replace"><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code>"<dd>Follow the steps given in the <a href="#read-multipart-x-mixed-replace" id="navigating-across-documents:read-multipart-x-mixed-replace">multipart/x-mixed-replace</a> section providing <var>navigationParams</var>. Once the steps have completed, return.<dt>A supported image, video, or audio type<dd>Follow the steps given in the <a href="#read-media" id="navigating-across-documents:read-media">media</a> section providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed, return.<dt>A type that will use an external application to render the content in <var>browsingContext</var><dd>Follow the steps given in the <a href="#read-plugin" id="navigating-across-documents:read-plugin">plugin</a> section providing <var>navigationParams</var> and <var>type</var>. Once the steps have completed, return.</dl>

    <p>An <dfn id="explicitly-supported-xml-mime-type">explicitly supported XML MIME type</dfn> is an <a id="navigating-across-documents:xml-mime-type-2" href="https://triple-underscore.github.io/mimesniff-ja.html#xml-mime-type" data-x-internal="xml-mime-type">XML MIME type</a> for which the user agent is configured to use an external application to render the content (either a <a id="navigating-across-documents:plugin" href="infrastructure.html#plugin">plugin</a> rendering directly in <var>browsingContext</var>, or a separate application), or one for which the user agent has dedicated processing rules (e.g., a web browser with a built-in Atom feed viewer would be said to explicitly support the <code id="navigating-across-documents:application/atom+xml"><a href="indices.html#application/atom+xml">application/atom+xml</a></code> MIME type), or one for which the user agent has a dedicated handler.</p>

    <p>An <dfn id="explicitly-supported-json-mime-type">explicitly supported JSON MIME type</dfn> is a <a id="navigating-across-documents:json-mime-type-2" href="https://triple-underscore.github.io/mimesniff-ja.html#json-mime-type" data-x-internal="json-mime-type">JSON MIME type</a> for which the user agent is configured to use an external application to render the content (either a <a id="navigating-across-documents:plugin-2" href="infrastructure.html#plugin">plugin</a> rendering directly in <var>browsingContext</var>, or a separate application), or one for which the user agent has dedicated processing rules, or one for which the user agent has a dedicated handler.</p>
   <li id="navigate-non-Document"><p><i>Non-document content</i>: If, given <var>type</var>, the new resource is to be handled by displaying some sort of inline content, e.g., a native rendering of the content or an error message because the specified type is not supported, then <a href="#read-ua-inline" id="navigating-across-documents:read-ua-inline-2">display the inline content</a> given <var>browsingContext</var>, and then return.<li><p>Otherwise, the document's <var>type</var> is such that the resource will not affect <var>browsingContext</var>, e.g., because the resource is to be handed to an external application or because it is an unknown type that will be processed <a id="navigating-across-documents:as-a-download-2" href="links.html#as-a-download">as a download</a>. <a href="#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software">Process the resource appropriately</a>.</p>
  </ol>

  <p>To <dfn id="process-a-navigate-url-scheme">process a navigate URL scheme</dfn>, given a <a id="navigating-across-documents:url-7" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>url</var> and <a id="navigating-across-documents:browsing-context-6" href="browsers.html#browsing-context">browsing context</a> <var>browsingContext</var>, run these steps:</p>

  <ol><li><p>If <var>url</var> is to be handled using a mechanism that does not affect <var>browsingContext</var>, e.g., because <var>url</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="navigating-across-documents:concept-url-scheme-8" data-x-internal="concept-url-scheme">scheme</a> is handled externally, then <a href="#hand-off-to-external-software" id="navigating-across-documents:hand-off-to-external-software-2">proceed with that mechanism instead</a>.<li><p>Otherwise, <var>url</var> is to be handled by displaying some sort of inline content, e.g., an error message because the specified scheme is not one of the supported protocols, or an inline prompt to allow the user to select <a href="system-state.html#dom-navigator-registerprotocolhandler" id="navigating-across-documents:dom-navigator-registerprotocolhandler">a registered handler</a> for the given scheme. <a href="#read-ua-inline" id="navigating-across-documents:read-ua-inline-3">Display the inline content</a> given <var>browsingContext</var>.</p>

    <p class="note">In the case of a registered handler being used, <a href="#navigate" id="navigating-across-documents:navigate-6">navigate</a> will be invoked with a new URL.</p>
   </ol>

  <p>When a resource is handled by <dfn id="hand-off-to-external-software">passing its URL or data to an external software package</dfn> separate from the user agent (e.g. handing a <code id="navigating-across-documents:mailto-protocol-2"><a data-x-internal="mailto-protocol" href="https://tools.ietf.org/html/rfc6068#section-2">mailto:</a></code> URL to a mail client, or a Word document to a word processor), user agents should attempt to mitigate the risk that this is an attempt to exploit the target software, e.g. by prompting the user to confirm that the <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-7">source browsing context</a>'s <a id="navigating-across-documents:active-document-17" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-5" data-x-internal="concept-document-origin">origin</a> is to be allowed to invoke the specified software. In particular, if the <a href="#navigate" id="navigating-across-documents:navigate-7">navigate</a> algorithm was invoked when <a href="#source-browsing-context" id="navigating-across-documents:source-browsing-context-8">source browsing context</a>'s <a id="navigating-across-documents:active-window-2" href="browsers.html#active-window">active window</a> does not have <a id="navigating-across-documents:transient-activation-2" href="interaction.html#transient-activation">transient activation</a>, the user agent should not invoke the external software package without prior user confirmation.</p>

  <p class="example">For example, there could be a vulnerability in the target software's URL handler which a hostile page would attempt to exploit by tricking a user into clicking a link.</p>

  <p>To <dfn id="javascript-protocol">execute a <code>javascript:</code> URL request</dfn>, given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="navigating-across-documents:concept-request-11" data-x-internal="concept-request">request</a> <var>request</var> and two <a href="browsers.html#browsing-context" id="navigating-across-documents:browsing-context-7">browsing contexts</a> <var>source</var> and <var>browsingContext</var>, run these steps:</p>

  <ol id="concept-js-deref"><li><p>Let <var>response</var> be a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="navigating-across-documents:concept-response-3" data-x-internal="concept-response">response</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="navigating-across-documents:concept-response-status-2" data-x-internal="concept-response-status">status</a> is <code>204</code>.<li><p>If both of the following are true:</p>

    <ul><li><p><var>source</var>'s <a id="navigating-across-documents:active-document-18" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-6" data-x-internal="concept-document-origin">origin</a> is <a id="navigating-across-documents:same-origin-3" href="origin.html#same-origin">same origin</a> with <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-19" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-7" data-x-internal="concept-document-origin">origin</a>.</p>

      <p class="XXX">As explained in <a href="https://github.com/whatwg/html/issues/2591">issue #2591</a> this step does not work and presents a security issue.</p>
     <li><p>The result of <a id="navigating-across-documents:should-navigation-request-of-type-be-blocked-by-content-security-policy-2" href="https://triple-underscore.github.io/CSP3-ja.html#should-block-navigation-request" data-x-internal="should-navigation-request-of-type-be-blocked-by-content-security-policy">Should navigation request of type be blocked by Content Security Policy?</a> given <var>request</var> and "<code>other</code>" is "<code>Allowed</code>". <a href="references.html#refsCSP">[CSP]</a></ul>

    <p>then:</p>

    <ol><li><p>Let <var>urlString</var> be the result of running the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="navigating-across-documents:concept-url-serializer" data-x-internal="concept-url-serializer">URL serializer</a> on <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="navigating-across-documents:concept-request-url-15" data-x-internal="concept-request-url">url</a>.<li><p>Let <var>encodedScriptSource</var> be the result of removing the leading "<code>javascript:</code>" from <var>urlString</var>.<li><p>Let <var>scriptSource</var> be the <a href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" id="navigating-across-documents:utf-8-decode" data-x-internal="utf-8-decode">UTF-8 decoding</a> of the <a href="https://triple-underscore.github.io/URL-ja.html#string-percent-decode" id="navigating-across-documents:percent-decode" data-x-internal="percent-decode">percent-decoding</a> of <var>encodedScriptSource</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="navigating-across-documents:list-append" data-x-internal="list-append">Append</a> <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-20" href="browsers.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-3" data-x-internal="the-document's-address">URL</a> to <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url-list" id="navigating-across-documents:concept-request-url-list" data-x-internal="concept-request-url-list">URL list</a>.<li><p>Let <var>settings</var> be <var>browsingContext</var>'s <a id="navigating-across-documents:active-document-21" href="browsers.html#active-document">active document</a>'s <a id="navigating-across-documents:relevant-settings-object-5" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>Let <var>baseURL</var> be <var>settings</var>'s <a id="navigating-across-documents:api-base-url" href="webappapis.html#api-base-url">API base URL</a>.<li><p>Let <var>script</var> be the result of <a id="navigating-across-documents:creating-a-classic-script" href="webappapis.html#creating-a-classic-script">creating a classic script</a> given <var>scriptSource</var>, <var>settings</var>, <var>baseURL</var>, and the <a id="navigating-across-documents:default-classic-script-fetch-options" href="webappapis.html#default-classic-script-fetch-options">default classic script fetch options</a>.<li><p>Let <var>evaluationStatus</var> be the result of <a href="webappapis.html#run-a-classic-script" id="navigating-across-documents:run-a-classic-script">running the classic script</a> <var>script</var>.<li><p>Let <var>result</var> be undefined if <var>evaluationStatus</var> is an <a id="navigating-across-documents:abrupt-completion" href="https://tc39.es/ecma262/#sec-completion-record-specification-type" data-x-internal="abrupt-completion">abrupt completion</a> or <var>evaluationStatus</var>.[[Value]] is empty, or <var>evaluationStatus</var>.[[Value]] otherwise.<li><p>If <a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values" id="navigating-across-documents:js-type" data-x-internal="js-type">Type</a>(<var>result</var>) is String, then set <var>response</var> to a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="navigating-across-documents:concept-response-4" data-x-internal="concept-response">response</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="navigating-across-documents:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a> consists of `<code id="navigating-across-documents:content-type"><a href="urls-and-fetching.html#content-type">Content-Type</a></code>`/`<code id="navigating-across-documents:text/html"><a href="iana.html#text/html">text/html</a></code>` and `<code id="navigating-across-documents:http-referrer-policy"><a data-x-internal="http-referrer-policy" href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#referrer-policy-header-dfn">Referrer-Policy</a></code>`/<var>settings</var>'s <a id="navigating-across-documents:referrer-policy" href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#referrer-policy" data-x-internal="referrer-policy">referrer policy</a>, and whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="navigating-across-documents:concept-response-body" data-x-internal="concept-response-body">body</a> is <var>result</var>.</p>

      <p class="XXX">The exact conversion between the string <var>result</var> and the bytes that comprise a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="navigating-across-documents:concept-response-body-2" data-x-internal="concept-response-body">response body</a> is not yet specified, pending further investigation into user agent behavior. See <a href="https://github.com/whatwg/html/issues/1129">issue #1129</a>.</p>
     </ol>
   <li><p>Return <var>response</var>.</ol>

  <p class="XXX">In addition to the specific issues linked above, <code id="navigating-across-documents:javascript-protocol-6"><a href="#javascript-protocol">javascript:</a></code> URLs have a <a href="https://github.com/whatwg/html/labels/topic%3A%20javascript%3A%20URLs">dedicated label</a> on the issue tracker documenting various problems with their specification.</p>

  <hr>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, use the following steps to <dfn id="initialise-the-document-object">create and initialize a <code>Document</code> object</dfn>, given a <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-type" id="navigating-across-documents:concept-document-type" data-x-internal="concept-document-type">type</a> <var>type</var>, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type" id="navigating-across-documents:concept-document-content-type" data-x-internal="concept-document-content-type">content type</a> <var>contentType</var>, and <a href="#navigation-params" id="navigating-across-documents:navigation-params-6">navigation params</a> <var>navigationParams</var>:</p>

  <ol><li><p>Let <var>browsingContext</var> be the result of the <a href="origin.html#obtain-browsing-context-navigation" id="navigating-across-documents:obtain-browsing-context-navigation">obtaining a browsing context to use for a navigation response</a> given <var>navigationParams</var>'s <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context-5">browsing context</a>, <var>navigationParams</var>'s <a href="#navigation-params-sandboxing" id="navigating-across-documents:navigation-params-sandboxing-4">final sandboxing flag set</a>, <var>navigationParams</var>'s <a href="#navigation-params-coop" id="navigating-across-documents:navigation-params-coop-4">cross-origin opener policy</a>, and <var>navigationParams</var>'s <a href="#navigation-params-coop-enforcement-result" id="navigating-across-documents:navigation-params-coop-enforcement-result-4">COOP enforcement result</a>.<li><p>Let <var>permissionsPolicy</var> be the result of <a id="navigating-across-documents:creating-a-permissions-policy-from-a-response" href="https://triple-underscore.github.io/webappsec-permissions-policy-ja.html#create-from-response" data-x-internal="creating-a-permissions-policy-from-a-response">creating a permissions policy from a response</a> given <var>browsingContext</var>, <var>navigationParams</var>'s <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-5">origin</a>, and <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-5">response</a>. <a href="references.html#refsPERMISSIONSPOLICY">[PERMISSIONSPOLICY]</a></p>

    <div class="note"><p>The <a id="navigating-across-documents:creating-a-permissions-policy-from-a-response-2" href="https://triple-underscore.github.io/webappsec-permissions-policy-ja.html#create-from-response" data-x-internal="creating-a-permissions-policy-from-a-response">creating a permissions policy from a response</a> algorithm makes use of the passed <a id="navigating-across-documents:concept-origin-4" href="origin.html#concept-origin">origin</a>. If <code id="navigating-across-documents:dom-document-domain"><a href="origin.html#dom-document-domain">document.domain</a></code> has been used for <var>browsingContext</var>'s <a href="browsers.html#bc-container-document" id="navigating-across-documents:bc-container-document-3">container document</a>, then its <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-8" data-x-internal="concept-document-origin">origin</a> cannot be <a id="navigating-across-documents:same-origin-domain" href="origin.html#same-origin-domain">same origin-domain</a> with the passed origin, because these steps run before the <var>document</var> is created, so it cannot itself yet have used <code id="navigating-across-documents:dom-document-domain-2"><a href="origin.html#dom-document-domain">document.domain</a></code>. Note that this means that Permissions Policy checks are less permissive compared to doing a <a id="navigating-across-documents:same-origin-4" href="origin.html#same-origin">same origin</a> check instead.</p>

     <p>See below for some examples of this in action.</p>
    </div>
   <li><p>Let <var>creationURL</var> be <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-6">response</a>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="navigating-across-documents:concept-response-url-3" data-x-internal="concept-response-url">URL</a>.<li><p>If <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-5">request</a> is non-null, then set <var>creationURL</var> to <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-6">request</a>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-current-url" id="navigating-across-documents:concept-request-current-url-2" data-x-internal="concept-request-current-url">current URL</a>.<li><p>If <var>browsingContext</var>'s only entry in its <a id="navigating-across-documents:session-history-2" href="history.html#session-history">session history</a> is the initial <code id="navigating-across-documents:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="navigating-across-documents:document-8"><a href="dom.html#document">Document</a></code> that was added when that <a id="navigating-across-documents:browsing-context-8" href="browsers.html#browsing-context">browsing context</a> was <a href="browsers.html#creating-a-new-browsing-context" id="navigating-across-documents:creating-a-new-browsing-context">created</a>, and <var>navigationParams</var>'s <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh-4">history handling</a> is "<code id="navigating-across-documents:hh-replace-2"><a href="#hh-replace">replace</a></code>", and that <code id="navigating-across-documents:document-9"><a href="dom.html#document">Document</a></code>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-9" data-x-internal="concept-document-origin">origin</a> is <a id="navigating-across-documents:same-origin-domain-2" href="origin.html#same-origin-domain">same origin-domain</a> with <var>navigationParams</var>'s <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-6">origin</a>, then do nothing.</p>

    <p class="note">This means that both the initial <code id="navigating-across-documents:about:blank-2"><a href="infrastructure.html#about:blank">about:blank</a></code> <code id="navigating-across-documents:document-10"><a href="dom.html#document">Document</a></code>, and the new <code id="navigating-across-documents:document-11"><a href="dom.html#document">Document</a></code> that is about to be created, will share the same <code id="navigating-across-documents:window-2"><a href="window-object.html#window">Window</a></code> object.</p>
  <li><p>Otherwise:</p>

    <ol><li><p>Let <var>oacHeader</var> be the result of <a id="navigating-across-documents:getting-a-structured-field-value" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> given `<code id="navigating-across-documents:origin-agent-cluster"><a href="iana.html#origin-agent-cluster">Origin-Agent-Cluster</a></code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="navigating-across-documents:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a>.<li><p>Let <var>requestsOAC</var> be true if <var>oacHeader</var> is not null and <var>oacHeader</var>[0] is the <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#boolean" id="navigating-across-documents:http-structured-header-boolean" data-x-internal="http-structured-header-boolean">boolean</a> true; otherwise false.<li><p>If <var>navigationParams</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-7">reserved environment</a> is a <a id="navigating-across-documents:non-secure-context" href="webappapis.html#non-secure-context">non-secure context</a>, then set <var>requestsOAC</var> to false.<li><p>Let <var>agent</var> be the result of <a href="webappapis.html#obtain-similar-origin-window-agent" id="navigating-across-documents:obtain-similar-origin-window-agent">obtaining a similar-origin window agent</a> given <var>navigationParams</var>'s <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-7">origin</a>, <var>browsingContext</var>'s <a href="browsers.html#tlbc-group" id="navigating-across-documents:tlbc-group">group</a>, and <var>requestsOAC</var>.<li><p>Let <var>realm execution context</var> be the result of <a id="navigating-across-documents:creating-a-new-javascript-realm" href="webappapis.html#creating-a-new-javascript-realm">creating a new JavaScript realm</a> given <var>agent</var> and the following customizations:</p>

      <ul><li><p>For the global object, create a new <code id="navigating-across-documents:window-3"><a href="window-object.html#window">Window</a></code> object.<li><p>For the global <b>this</b> binding, use <var>browsingContext</var>'s <code id="navigating-across-documents:windowproxy-2"><a href="window-object.html#windowproxy">WindowProxy</a></code> object.</ul>
     <li><p>Let <var>topLevelCreationURL</var> be <var>creationURL</var>.<li><p>Let <var>topLevelOrigin</var> be <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-7">origin</a>.<li><p>If <var>browsingContext</var> is not a <a id="navigating-across-documents:top-level-browsing-context-7" href="browsers.html#top-level-browsing-context">top-level browsing context</a>, then:</p>

      <ol><li><p>Let <var>parentEnvironment</var> be <var>browsingContext</var>'s <a href="browsers.html#bc-container" id="navigating-across-documents:bc-container-6">container</a>'s <a id="navigating-across-documents:relevant-settings-object-6" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>Set <var>topLevelCreationURL</var> to <var>parentEnvironment</var>'s <a id="navigating-across-documents:concept-environment-top-level-creation-url-3" href="webappapis.html#concept-environment-top-level-creation-url">top-level creation URL</a>.<li><p>Set <var>topLevelOrigin</var> to <var>parentEnvironment</var>'s <a id="navigating-across-documents:concept-environment-top-level-origin-3" href="webappapis.html#concept-environment-top-level-origin">top-level origin</a>.</ol>
     <li><p><a id="navigating-across-documents:set-up-a-window-environment-settings-object" href="window-object.html#set-up-a-window-environment-settings-object">Set up a window environment settings object</a> with <var>creationURL</var>, <var>realm execution context</var>, <var>navigationParams</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-8">reserved environment</a>, <var>topLevelCreationURL</var>, and <var>topLevelOrigin</var>.</ol>

    <p class="note">This is the usual case, where the new <code id="navigating-across-documents:document-12"><a href="dom.html#document">Document</a></code> we're about to create gets a new <code id="navigating-across-documents:window-4"><a href="window-object.html#window">Window</a></code> to go along with it.</p>
   <li><p>Let <var>document</var> be a new <code id="navigating-across-documents:document-13"><a href="dom.html#document">Document</a></code>, whose <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-type" id="navigating-across-documents:concept-document-type-2" data-x-internal="concept-document-type">type</a> is <var>type</var>, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-content-type" id="navigating-across-documents:concept-document-content-type-2" data-x-internal="concept-document-content-type">content type</a> is <var>contentType</var>, <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="navigating-across-documents:concept-document-origin-10" data-x-internal="concept-document-origin">origin</a> is <var>navigationParams</var>'s <a href="#navigation-params-origin" id="navigating-across-documents:navigation-params-origin-8">origin</a>, <a href="dom.html#concept-document-permissions-policy" id="navigating-across-documents:concept-document-permissions-policy">permissions policy</a> is <var>permissionsPolicy</var>, <a id="navigating-across-documents:active-sandboxing-flag-set" href="origin.html#active-sandboxing-flag-set">active sandboxing flag set</a> is <var>navigationParams</var>'s <a href="#navigation-params-sandboxing" id="navigating-across-documents:navigation-params-sandboxing-5">final sandboxing flag set</a>, and <a href="dom.html#concept-document-coop" id="navigating-across-documents:concept-document-coop-4">cross-origin opener policy</a> is <var>navigationParams</var>'s <a href="#navigation-params-coop" id="navigating-across-documents:navigation-params-coop-5">cross-origin opener policy</a>.</p>

    <p class="note">The new <code id="navigating-across-documents:window-5"><a href="window-object.html#window">Window</a></code>'s <a href="window-object.html#concept-document-window" id="navigating-across-documents:concept-document-window">associated <code>Document</code></a> is set to <var>document</var> later, when the caller of this algorithm <a href="#update-the-session-history-with-the-new-page" id="navigating-across-documents:update-the-session-history-with-the-new-page-2">updates the session history with the new page</a>. That algorithm <a href="browsers.html#set-the-active-document" id="navigating-across-documents:set-the-active-document">sets the active document</a> as part of its larger role of synchronizing the <code id="navigating-across-documents:window-6"><a href="window-object.html#window">Window</a></code>, <code id="navigating-across-documents:document-14"><a href="dom.html#document">Document</a></code>, <a id="navigating-across-documents:browsing-context-9" href="browsers.html#browsing-context">browsing context</a>, and <a id="navigating-across-documents:session-history-3" href="history.html#session-history">session history</a>.</p>
  <li id="set-the-document's-address"><p>Set <var>document</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-4" data-x-internal="the-document's-address">URL</a> to <var>creationURL</var>.<li><p>Set <var>document</var>'s <a href="dom.html#concept-document-referrer-policy" id="navigating-across-documents:concept-document-referrer-policy">referrer policy</a> to the result of <a href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#parse-referrer-policy-from-header" id="navigating-across-documents:parse-referrer-policy-header" data-x-internal="parse-referrer-policy-header">parsing the `<code>Referrer-Policy</code>` header</a> of <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-7">response</a>. <a href="references.html#refsREFERRERPOLICY">[REFERRERPOLICY]</a><li><p>If <var>navigationParam</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-9">reserved environment</a> is non-null, then set <var>document</var>'s <a href="dom.html#concept-document-embedder-policy" id="navigating-across-documents:concept-document-embedder-policy">embedder policy</a> to the result of <a href="origin.html#obtain-an-embedder-policy" id="navigating-across-documents:obtain-an-embedder-policy">obtaining an embedder policy</a> given <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-8">response</a> and <var>navigationParam</var>'s <a href="#navigation-params-reserved-environment" id="navigating-across-documents:navigation-params-reserved-environment-10">reserved environment</a>. Otherwise, set it to "<code id="navigating-across-documents:coep-unsafe-none"><a href="origin.html#coep-unsafe-none">unsafe-none</a></code>".<li><p><a id="navigating-across-documents:initialize-a-document's-csp-list" href="https://triple-underscore.github.io/CSP3-ja.html#initialize-document-csp" data-x-internal="initialize-a-document's-csp-list">Initialize a <code>Document</code>'s CSP list</a> given <var>document</var>, <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-9">response</a>, and <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-8">request</a>. <a href="references.html#refsCSP">[CSP]</a></p>

   <li><p>If <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-9">request</a> is non-null, then:</p>

    <ol><li><p>Set <var>document</var>'s <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer">referrer</a> to the empty string.<li><p>Let <var>referrer</var> be <var>navigationParams</var>'s <a href="#navigation-params-request" id="navigating-across-documents:navigation-params-request-10">request</a>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="navigating-across-documents:concept-request-referrer-2" data-x-internal="concept-request-referrer">referrer</a>.<li><p>If <var>referrer</var> is a <a id="navigating-across-documents:url-record" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a>, then set <var>document</var>'s <a href="dom.html#the-document's-referrer" id="navigating-across-documents:the-document's-referrer-2">referrer</a> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="navigating-across-documents:concept-url-serializer-2" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.</p>

      <p class="note">Per <cite>Fetch</cite>, <var>referrer</var> will be either a <a id="navigating-across-documents:url-record-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> or "<code>no-referrer</code>" at this point.</p>
     </ol>
   <li><p>If <var>navigationParams</var>'s <a href="#navigation-params-response" id="navigating-across-documents:navigation-params-response-10">response</a> has a `<code id="navigating-across-documents:refresh"><a href="iana.html#refresh">Refresh</a></code>` header, then:</p>

    <ol><li><p>Let <var>value</var> be the <a href="https://triple-underscore.github.io/infra-ja.html#isomorphic-decode" id="navigating-across-documents:isomorphic-decode" data-x-internal="isomorphic-decode">isomorphic decoding</a> of the value of the header.<li><p>Run the <a id="navigating-across-documents:shared-declarative-refresh-steps" href="semantics.html#shared-declarative-refresh-steps">shared declarative refresh steps</a> with <var>document</var> and <var>value</var>.</ol>

    <p class="XXX">We do not currently have a spec for how to handle multiple `<code id="navigating-across-documents:refresh-2"><a href="iana.html#refresh">Refresh</a></code>` headers. This is tracked as <a href="https://github.com/whatwg/html/issues/2900">issue #2900</a>.</p>
   <li><p><var>document</var>を返す。</ol>

  <div class="example"><p>In this example, the child document is not allowed to use <code id="navigating-across-documents:paymentrequest"><a data-x-internal="paymentrequest" href="https://w3c.github.io/payment-request/#dom-paymentrequest">PaymentRequest</a></code>, despite being <a id="navigating-across-documents:same-origin-domain-3" href="origin.html#same-origin-domain">same origin-domain</a> at the time the child document tries to use it. At the time the child document is initialized, only the parent document has set <code id="navigating-across-documents:dom-document-domain-3"><a href="origin.html#dom-document-domain">document.domain</a></code>, and the child document has not.</p>

   <pre><code class='html'><c- c>&lt;!-- https://foo.example.com/a.html --></c->
<c- cp>&lt;!doctype html></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
document<c- p>.</c->domain <c- o>=</c-> <c- t>'example.com'</c-><c- p>;</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>b.html</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c-></code></pre>

  <pre><code class='html'><c- c>&lt;!-- https://bar.example.com/b.html --></c->
<c- cp>&lt;!doctype html></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
document<c- p>.</c->domain <c- o>=</c-> <c- t>'example.com'</c-><c- p>;</c-> <c- c1>// This happens after the document is initialized</c->
<c- k>new</c-> PaymentRequest<c- p>(</c->…<c- p>);</c-> <c- c1>// Not allowed to use</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>
  </div>

  <div class="example"><p>In this example, the child document <em>is</em> allowed to use <code id="navigating-across-documents:paymentrequest-2"><a data-x-internal="paymentrequest" href="https://w3c.github.io/payment-request/#dom-paymentrequest">PaymentRequest</a></code>, despite not being <a id="navigating-across-documents:same-origin-domain-4" href="origin.html#same-origin-domain">same origin-domain</a> at the time the child document tries to use it. At the time the child document is initialized, none of the documents have set <code id="navigating-across-documents:dom-document-domain-4"><a href="origin.html#dom-document-domain">document.domain</a></code> yet so <a id="navigating-across-documents:same-origin-domain-5" href="origin.html#same-origin-domain">same origin-domain</a> falls back to a normal <a id="navigating-across-documents:same-origin-5" href="origin.html#same-origin">same origin</a> check.</p>

   <pre><code class='html'><c- c>&lt;!-- https://example.com/a.html --></c->
<c- cp>&lt;!doctype html></c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>b.html</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- c>&lt;!-- The child document is now initialized, before the script below is run. --></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
document<c- p>.</c->domain <c- o>=</c-> <c- t>'example.com'</c-><c- p>;</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <pre><code class='html'><c- c>&lt;!-- https://example.com/b.html --></c->
<c- cp>&lt;!doctype html></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- k>new</c-> PaymentRequest<c- p>(</c->…<c- p>);</c-> <c- c1>// Allowed to use</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>
  </div>

  <p>Some of the sections below, to which the above algorithm defers in certain cases, require the user agent to <dfn id="update-the-session-history-with-the-new-page">update the session history with the new page</dfn>, given some <a href="#navigation-params" id="navigating-across-documents:navigation-params-7">navigation params</a> <var>navigationParams</var> and a <code id="navigating-across-documents:document-15"><a href="dom.html#document">Document</a></code> <var>newDocument</var>. When a user agent is required to do this, it must <a id="navigating-across-documents:queue-a-global-task-2" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="navigating-across-documents:networking-task-source-2" href="webappapis.html#networking-task-source">networking task source</a>, given the <a id="navigating-across-documents:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> of the <code id="navigating-across-documents:document-16"><a href="dom.html#document">Document</a></code> object of the <a id="navigating-across-documents:current-entry-3" href="history.html#current-entry">current entry</a> (not the new one), to run the following steps:</p>

  <ol><li><p>Let <var>sessionHistory</var> be <var>navigationParams</var>'s <a href="#navigation-params-browsing-context" id="navigating-across-documents:navigation-params-browsing-context-6">browsing context</a>'s <a id="navigating-across-documents:session-history-4" href="history.html#session-history">session history</a>.<li><p><a href="#unload-a-document" id="navigating-across-documents:unload-a-document-2">Unload</a> <var>sessionHistory</var>'s <a id="navigating-across-documents:current-entry-4" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="navigating-across-documents:she-document-2">document</a>.</p>

    <p>If this instance of the <a href="#navigate" id="navigating-across-documents:navigate-8">navigation</a> algorithm is canceled while this step is running the <a href="#unload-a-document" id="navigating-across-documents:unload-a-document-3">unload a document</a> algorithm, then the <a href="#unload-a-document" id="navigating-across-documents:unload-a-document-4">unload a document</a> algorithm must be allowed to run to completion, but this instance of the <a href="#navigate" id="navigating-across-documents:navigate-9">navigation</a> algorithm must not run beyond this step. (In particular, for instance, the cancelation of this algorithm does not abort any event dispatch or script execution occurring as part of unloading the document or its descendants.)</p>
   <li><p>Switch on <var>navigationParams</var>'s <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh-5">history handling</a>:</p>
    <dl class="switch"><dt>"<code id="navigating-across-documents:hh-entry-update"><a href="#hh-entry-update">entry update</a></code>"<dt>"<code id="navigating-across-documents:hh-reload-3"><a href="#hh-reload">reload</a></code>"<dd><ol><li><p>Let <var>oldDocument</var> be <var>sessionHistory</var>'s <a id="navigating-across-documents:current-entry-5" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="navigating-across-documents:she-document-3">document</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="navigating-across-documents:list-iterate" data-x-internal="list-iterate">For each</a> <var>entry</var> of <var>sessionHistory</var>: if <var>entry</var>'s <a href="history.html#she-document" id="navigating-across-documents:she-document-4">document</a> is <var>oldDocument</var>, then set <var>entry</var>'s <a href="history.html#she-document" id="navigating-across-documents:she-document-5">document</a> to <var>newDocument</var>.<li><p><a href="#traverse-the-history" id="navigating-across-documents:traverse-the-history">Traverse the history</a> to <var>sessionHistory</var>'s <a id="navigating-across-documents:current-entry-6" href="history.html#current-entry">current entry</a> with <var id="navigating-across-documents:traverse-history-hh"><a href="#traverse-history-hh">historyHandling</a></var> set to <var>navigationParams</var>'s <a href="#navigation-params-hh" id="navigating-across-documents:navigation-params-hh-6">history handling</a>.</ol>
     <dt>"<code id="navigating-across-documents:hh-replace-3"><a href="#hh-replace">replace</a></code>"<dd><ol><li><p>Let <var>newEntry</var> be a new <a id="navigating-across-documents:session-history-entry-2" href="history.html#session-history-entry">session history entry</a> whose <a href="history.html#she-url" id="navigating-across-documents:she-url">URL</a> is <var>newDocument</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-5" data-x-internal="the-document's-address">URL</a> and <a href="history.html#she-document" id="navigating-across-documents:she-document-6">document</a> is <var>newDocument</var>.</p>

        <p class="XXX">Some browsers copy over the serialized state <var>sessionHistory</var>'s <a id="navigating-across-documents:current-entry-7" href="history.html#current-entry">current entry</a> in cases where its <a href="history.html#she-url" id="navigating-across-documents:she-url-2">URL</a> <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-equals" id="navigating-across-documents:concept-url-equals-3" data-x-internal="concept-url-equals">equals</a> that of <var>newDocument</var>, but this is inconsistent. See <a href="https://github.com/whatwg/html/issues/6213">issue #6213</a> for more discussion on this.</p>
       <li><p>Insert <var>newEntry</var> into <var>sessionHistory</var> after its <a id="navigating-across-documents:current-entry-8" href="history.html#current-entry">current entry</a>.<li><p><a href="#traverse-the-history" id="navigating-across-documents:traverse-the-history-2">Traverse the history</a> to <var>newEntry</var> with <var id="navigating-across-documents:traverse-history-hh-2"><a href="#traverse-history-hh">historyHandling</a></var> set to "<code id="navigating-across-documents:hh-replace-4"><a href="#hh-replace">replace</a></code>".</ol>
     <dt>"<code id="navigating-across-documents:hh-default-3"><a href="#hh-default">default</a></code>"<dd><ol><li><p>Remove all the entries in <var>sessionHistory</var> after its <a id="navigating-across-documents:current-entry-9" href="history.html#current-entry">current entry</a>. (If the <a id="navigating-across-documents:current-entry-10" href="history.html#current-entry">current entry</a> is the last entry in the session history, then no entries are removed.)</p>

        <p class="note">This <a href="history.html#history-notes">doesn't necessarily have to affect</a> the user agent's user interface.</p>
       <li><p>Let <var>newEntry</var> be a new <a id="navigating-across-documents:session-history-entry-3" href="history.html#session-history-entry">session history entry</a> whose <a href="history.html#she-url" id="navigating-across-documents:she-url-3">URL</a> is <var>newDocument</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-6" data-x-internal="the-document's-address">URL</a> and <a href="history.html#she-document" id="navigating-across-documents:she-document-7">document</a> is <var>newDocument</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="navigating-across-documents:list-append-2" data-x-internal="list-append">Append</a> <var>newEntry</var> to <var>sessionHistory</var>.<li><p><a href="#traverse-the-history" id="navigating-across-documents:traverse-the-history-3">Traverse the history</a> to <var>newEntry</var>.</ol>
     </dl>
   <li><p>The <a href="#navigate" id="navigating-across-documents:navigate-10">navigation algorithm</a> has now <dfn id="concept-navigate-mature">matured</dfn>.<li><p><a href="#try-to-scroll-to-the-fragment" id="navigating-across-documents:try-to-scroll-to-the-fragment">Try to scroll to the fragment</a> for <var>newDocument</var>.</ol>

  <p>To <dfn id="try-to-scroll-to-the-fragment">try to scroll to the fragment</dfn> for a <code id="navigating-across-documents:document-17"><a href="dom.html#document">Document</a></code> <var>document</var>, perform the following steps <a id="navigating-across-documents:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a>:</p>

  <ol><li><p>Wait for an <a id="navigating-across-documents:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> amount of time. (This is intended to allow the user agent to optimize the user experience in the face of performance concerns.)<li><p><a id="navigating-across-documents:queue-a-global-task-3" href="webappapis.html#queue-a-global-task">Queue a global task</a> on the <a id="navigating-across-documents:networking-task-source-3" href="webappapis.html#networking-task-source">networking task source</a> given <var>document</var>'s <a id="navigating-across-documents:concept-relevant-global-2" href="webappapis.html#concept-relevant-global">relevant global object</a> to run these steps:</p>

    <ol><li><p>If <var>document</var> has no parser, or its parser has <a href="parsing.html#stop-parsing" id="navigating-across-documents:stop-parsing">stopped parsing</a>, or the user agent has reason to believe the user is no longer interested in scrolling to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="navigating-across-documents:concept-url-fragment-3" data-x-internal="concept-url-fragment">fragment</a>, then abort these steps.<li><p><a href="#scroll-to-the-fragment-identifier" id="navigating-across-documents:scroll-to-the-fragment-identifier">Scroll to the fragment</a> given in <var>document</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="navigating-across-documents:the-document's-address-7" data-x-internal="the-document's-address">URL</a>. If this does not find <a href="#the-indicated-part-of-the-document" id="navigating-across-documents:the-indicated-part-of-the-document">an indicated part of the document</a>, then <a href="#try-to-scroll-to-the-fragment" id="navigating-across-documents:try-to-scroll-to-the-fragment-2">try to scroll to the fragment</a> for <var>document</var>.</ol>
   </ol>


  <h4 id="read-html"><span class="secno">7.10.2</span> Page load processing model for HTML files<a href="#read-html" class="self-link"></a></h4>

  <p>When <dfn id="navigate-html">an HTML document is to be loaded</dfn>, given <a href="#navigation-params" id="read-html:navigation-params">navigation params</a> <var>navigationParams</var>, the user agent must <a id="read-html:queue-a-task" href="webappapis.html#queue-a-task">queue a task</a> on the <a id="read-html:networking-task-source" href="webappapis.html#networking-task-source">networking task source</a> to:</p>

  <ol><li><p>Let <var>document</var> be the result of <a href="#initialise-the-document-object" id="read-html:initialise-the-document-object">creating and initializing a <code>Document</code> object</a> given "<code>html</code>", "<code>text/html</code>", and <var>navigationParams</var>.<li><p>Create an <a id="read-html:html-parser" href="parsing.html#html-parser">HTML parser</a> and associate it with the <var>document</var>. Each <a href="webappapis.html#concept-task" id="read-html:concept-task">task</a> that the <a id="read-html:networking-task-source-2" href="webappapis.html#networking-task-source">networking task source</a> places on the <a id="read-html:task-queue" href="webappapis.html#task-queue">task queue</a> while fetching runs must then fill the parser's <a id="read-html:the-input-byte-stream" href="parsing.html#the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a id="read-html:html-parser-2" href="parsing.html#html-parser">HTML parser</a> to perform the appropriate processing of the input stream.</p>

    <p class="note">The <a id="read-html:the-input-byte-stream-2" href="parsing.html#the-input-byte-stream">input byte stream</a> converts bytes into characters for use in the <a href="parsing.html#tokenization" id="read-html:tokenization">tokenizer</a>. This process relies, in part, on character encoding information found in the real <a href="urls-and-fetching.html#content-type" id="read-html:content-type">Content-Type metadata</a> of the resource; the computed type is not used for this purpose.</p>
   </ol>

  

  <p>When no more bytes are available, the user agent must <a id="read-html:queue-a-global-task" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="read-html:networking-task-source-3" href="webappapis.html#networking-task-source">networking task source</a> given the newly-created <code id="read-html:document"><a href="dom.html#document">Document</a></code>'s <a id="read-html:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> for the parser to process the implied EOF character, which eventually causes a <code id="read-html:event-load"><a href="indices.html#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-html:document-2"><a href="dom.html#document">Document</a></code> object, but before any script execution, certainly before the parser <a href="parsing.html#stop-parsing" id="read-html:stop-parsing">stops</a>, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-html:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-html:document-3"><a href="dom.html#document">Document</a></code>.</p>



  <h4 id="read-xml"><span class="secno">7.10.3</span> <dfn>Page load processing model for XML files</dfn><a href="#read-xml" class="self-link"></a></h4>

  <p>When faced with displaying an XML file inline, provided <a href="#navigation-params" id="read-xml:navigation-params">navigation params</a> <var>navigationParams</var> and a string <var>type</var>, user agents must follow the requirements defined in <cite>XML</cite> and <cite>Namespaces in XML</cite>, <cite>XML Media Types</cite>, <cite>DOM</cite>, and other relevant specifications to <a href="#initialise-the-document-object" id="read-xml:initialise-the-document-object">create and initialize a <code>Document</code> object</a> given "<code>xml</code>", <var>type</var>, and <var>navigationParams</var>. They must also create a corresponding <a id="read-xml:xml-parser" href="xhtml.html#xml-parser">XML parser</a>. <a href="references.html#refsXML">[XML]</a> <a href="references.html#refsXMLNS">[XMLNS]</a> <a href="references.html#refsRFC7303">[RFC7303]</a> <a href="references.html#refsDOM">[DOM]</a></p>

  <p class="note">At the time of writing, the XML specification community had not actually yet specified how XML and the DOM interact.</p> 

  <p>The actual HTTP headers and other metadata, not the headers as mutated or implied by the algorithms given in this specification, are the ones that must be used when determining the character encoding according to the rules given in the above specifications. Once the character encoding is established, the <a id="read-xml:document's-character-encoding" href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding" data-x-internal="document's-character-encoding">document's character encoding</a> must be set to that character encoding.</p>

  <p>Then, with the newly created <code id="read-xml:document"><a href="dom.html#document">Document</a></code>, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-xml:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-xml:document-2"><a href="dom.html#document">Document</a></code>. User agents may do this before the complete document has been parsed (thus achieving <i>incremental rendering</i>), and must do this before any scripts are to be executed.</p>

  <p>Error messages from the parse process (e.g., XML namespace well-formedness errors) may be reported inline by mutating the <code id="read-xml:document-3"><a href="dom.html#document">Document</a></code>.</p>


  <h4 id="read-text"><span class="secno">7.10.4</span> <dfn>Page load processing model for text files</dfn><a href="#read-text" class="self-link"></a></h4>

  <p>When a plain text document is to be loaded, provided <a href="#navigation-params" id="read-text:navigation-params">navigation params</a> <var>navigationParams</var> and a string <var>type</var>, the user agent must <a id="read-text:queue-a-task" href="webappapis.html#queue-a-task">queue a task</a> on the <a id="read-text:networking-task-source" href="webappapis.html#networking-task-source">networking task source</a> to:<ol><li><p>Let <var>document</var> be the result of <a href="#initialise-the-document-object" id="read-text:initialise-the-document-object">creating and initializing a <code>Document</code> object</a> given "<code>html</code>", <var>type</var>, and <var>navigationParams</var>.<li><p>Create an <a id="read-text:html-parser" href="parsing.html#html-parser">HTML parser</a> and associate it with the <var>document</var>. Act as if the tokenizer had emitted a start tag token with the tag name "pre" followed by a single U+000A LINE FEED (LF) character, and switch the <a id="read-text:html-parser-2" href="parsing.html#html-parser">HTML parser</a>'s tokenizer to the <a id="read-text:plaintext-state" href="parsing.html#plaintext-state">PLAINTEXT state</a>. Each <a href="webappapis.html#concept-task" id="read-text:concept-task">task</a> that the <a id="read-text:networking-task-source-2" href="webappapis.html#networking-task-source">networking task source</a> places on the <a id="read-text:task-queue" href="webappapis.html#task-queue">task queue</a> while fetching runs must then fill the parser's <a id="read-text:the-input-byte-stream" href="parsing.html#the-input-byte-stream">input byte stream</a> with the fetched bytes and cause the <a id="read-text:html-parser-3" href="parsing.html#html-parser">HTML parser</a> to perform the appropriate processing of the input stream.</ol>

  <p>The rules for how to convert the bytes of the plain text document into actual characters, and the rules for actually rendering the text to the user, are defined by the specifications for the <a href="https://triple-underscore.github.io/mimesniff-ja.html#computed-mime-type" id="read-text:content-type-sniffing-2" data-x-internal="content-type-sniffing-2">computed MIME type</a> of the resource (i.e., <var>type</var>).</p>

  <p>The <a id="read-text:document's-character-encoding" href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-encoding" data-x-internal="document's-character-encoding">document's character encoding</a> must be set to the character encoding used to decode the document.</p>

  

  <p>When no more bytes are available, the user agent must <a id="read-text:queue-a-global-task" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="read-text:networking-task-source-3" href="webappapis.html#networking-task-source">networking task source</a> given the newly-created <code id="read-text:document"><a href="dom.html#document">Document</a></code>'s <a id="read-text:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> for the parser to process the implied EOF character, which eventually causes a <code id="read-text:event-load"><a href="indices.html#event-load">load</a></code> event to be fired.</p>

  <p>After creating the <code id="read-text:document-2"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished parsing, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-text:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-text:document-3"><a href="dom.html#document">Document</a></code>.</p>

  <p>User agents may add content to the <code id="read-text:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-text:document-4"><a href="dom.html#document">Document</a></code>, e.g., linking to a style sheet, providing script, or giving the document a <code id="read-text:the-title-element"><a href="semantics.html#the-title-element">title</a></code>.</p>

  <p class="note">In particular, if the user agent supports the <code>Format=Flowed</code> feature of RFC 3676 then the user agent would need to apply extra styling to cause the text to wrap correctly and to handle the quoting feature. This could be performed using, e.g., a CSS extension.</p>


  <h4 id="read-multipart-x-mixed-replace"><span class="secno">7.10.5</span> <dfn>Page load processing model for <code>multipart/x-mixed-replace</code> resources</dfn><a href="#read-multipart-x-mixed-replace" class="self-link"></a></h4>

  <p>When a resource with the type <code id="read-multipart-x-mixed-replace:multipart/x-mixed-replace"><a href="iana.html#multipart/x-mixed-replace">multipart/x-mixed-replace</a></code> is to be loaded in a <a id="read-multipart-x-mixed-replace:browsing-context" href="browsers.html#browsing-context">browsing context</a>, the user agent must parse the resource using the rules for multipart types. <a href="references.html#refsRFC2046">[RFC2046]</a></p>

  <p class="XXX">This algorithm is passed <a href="#navigation-params" id="read-multipart-x-mixed-replace:navigation-params">navigation params</a>, but it's unclear how exactly to use them.</p>

  <p>For each body part obtained from the resource, the user agent must run <a href="#process-a-navigate-response" id="read-multipart-x-mixed-replace:process-a-navigate-response">process a navigate response</a> using the new body part and the same <a id="read-multipart-x-mixed-replace:browsing-context-2" href="browsers.html#browsing-context">browsing context</a>, with <a href="#navigation-params-hh" id="read-multipart-x-mixed-replace:navigation-params-hh">history handling</a> set to "<code id="read-multipart-x-mixed-replace:hh-replace"><a href="#hh-replace">replace</a></code>" if a previous body part from the same resource resulted in a <a href="#initialise-the-document-object" id="read-multipart-x-mixed-replace:initialise-the-document-object">creating and initializing a <code>Document</code> object</a>, and otherwise using the same setup as the <a href="#navigate" id="read-multipart-x-mixed-replace:navigate">navigate</a> attempt that caused this section to be invoked in the first place.</p>

  <p>For the purposes of algorithms processing these body parts as if they were complete stand-alone resources, the user agent must act as if there were no more bytes for those resources whenever the boundary following the body part is reached.</p>

  <p class="note">Thus, <code id="read-multipart-x-mixed-replace:event-load"><a href="indices.html#event-load">load</a></code> events (and for that matter <code id="read-multipart-x-mixed-replace:event-unload"><a href="indices.html#event-unload">unload</a></code> events) do fire for each body part loaded.</p>


  <h4 id="read-media"><span class="secno">7.10.6</span> <dfn>Page load processing model for media</dfn><a href="#read-media" class="self-link"></a></h4>

  <p>When an image, video, or audio resource is to be loaded, provided <a href="#navigation-params" id="read-media:navigation-params">navigation params</a> <var>navigationParams</var> and a string <var>type</var>, the user agent should:<ol><li><p>Let <var>document</var> be the result of <a href="#initialise-the-document-object" id="read-media:initialise-the-document-object">creating and initializing a <code>Document</code> object</a> given "<code>html</code>", <var>type</var>, and <var>navigationParams</var>.<li><p>Append an <code id="read-media:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element to <var>document</var>.<li><p>Append a <code id="read-media:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element to the <code id="read-media:the-html-element-2"><a href="semantics.html#the-html-element">html</a></code> element.<li><p>Append a <code id="read-media:the-body-element"><a href="sections.html#the-body-element">body</a></code> element to the <code id="read-media:the-html-element-3"><a href="semantics.html#the-html-element">html</a></code> element.<li><p>Append an element <var>host element</var> for the media, as described below, to the <code id="read-media:the-body-element-2"><a href="sections.html#the-body-element">body</a></code> element.<li><p>Set the appropriate attribute of the element <var>host element</var>, as described below, to the address of the image, video, or audio resource.</ol>

  <p>The element <var>host element</var> to create for the media is the element given in the table below in the second cell of the row whose first cell describes the media. The appropriate attribute to set is the one given by the third cell in that same row.</p>

  <table><thead><tr><th>Type of media<th>Element for the media<th>Appropriate attribute<tbody><tr><td>画像<td><code id="read-media:the-img-element"><a href="embedded-content.html#the-img-element">img</a></code><td><code id="read-media:attr-img-src"><a href="embedded-content.html#attr-img-src">src</a></code><tr><td>Video<td><code id="read-media:the-video-element"><a href="media.html#the-video-element">video</a></code><td><code id="read-media:attr-media-src"><a href="media.html#attr-media-src">src</a></code><tr><td>Audio<td><code id="read-media:the-audio-element"><a href="media.html#the-audio-element">audio</a></code><td><code id="read-media:attr-media-src-2"><a href="media.html#attr-media-src">src</a></code></table>

  

  <p>Then, the user agent must act as if it had <a href="parsing.html#stop-parsing" id="read-media:stop-parsing">stopped parsing</a>.</p>

  <p>After creating the <code id="read-media:document"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished fully loading, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-media:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-media:document-2"><a href="dom.html#document">Document</a></code>.</p>

  <p>User agents may add content to the <code id="read-media:the-head-element-2"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-media:document-3"><a href="dom.html#document">Document</a></code>, or attributes to the element <var>host element</var>, e.g., to link to a style sheet, to provide a script, to give the document a <code id="read-media:the-title-element"><a href="semantics.html#the-title-element">title</a></code>, or to make the media <a href="media.html#attr-media-autoplay" id="read-media:attr-media-autoplay">autoplay</a>.</p>


  <h4 id="read-plugin"><span class="secno">7.10.7</span> <dfn>Page load processing model for content that uses plugins</dfn><a href="#read-plugin" class="self-link"></a></h4>

  <p>When a resource that requires an external resource to be rendered is to be loaded, provided <a href="#navigation-params" id="read-plugin:navigation-params">navigation params</a> <var>navigationParams</var> and a string <var>type</var>, the user agent should:<ol><li><p>Let <var>document</var> be the result of <a href="#initialise-the-document-object" id="read-plugin:initialise-the-document-object">creating and initializing a <code>Document</code> object</a> given "<code>html</code>", <var>type</var>, and <var>navigationParmas</var>.<li><p>Mark <var>document</var> as being a <dfn id="plugin-document">plugin document</dfn><li><p>Append an <code id="read-plugin:the-html-element"><a href="semantics.html#the-html-element">html</a></code> element to <var>document</var>.<li><p>Append a <code id="read-plugin:the-head-element"><a href="semantics.html#the-head-element">head</a></code> element to the <code id="read-plugin:the-html-element-2"><a href="semantics.html#the-html-element">html</a></code> element.<li><p>Append a <code id="read-plugin:the-body-element"><a href="sections.html#the-body-element">body</a></code> element to the <code id="read-plugin:the-html-element-3"><a href="semantics.html#the-html-element">html</a></code> element.<li><p>Append an <code id="read-plugin:the-embed-element"><a href="iframe-embed-object.html#the-embed-element">embed</a></code> to the <code id="read-plugin:the-body-element-2"><a href="sections.html#the-body-element">body</a></code> element<li><p>Set the <code id="read-plugin:attr-embed-src"><a href="iframe-embed-object.html#attr-embed-src">src</a></code> attribute of the <code id="read-plugin:the-embed-element-2"><a href="iframe-embed-object.html#the-embed-element">embed</a></code> element to the address of the resource.</ol>

  <p class="note">The term <a href="#plugin-document" id="read-plugin:plugin-document">plugin document</a> is used by <cite>Content Security Policy</cite> as part of the mechanism that ensures <code id="read-plugin:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>s can't be used to evade <code>plugin-types</code> directives. <a href="references.html#refsCSP">[CSP]</a></p>

  

  <p>Then, the user agent must act as if it had <a href="parsing.html#stop-parsing" id="read-plugin:stop-parsing">stopped parsing</a>.</p>

  <p>After creating the <code id="read-plugin:document"><a href="dom.html#document">Document</a></code> object, but potentially before the page has finished fully loading, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-plugin:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-plugin:document-2"><a href="dom.html#document">Document</a></code>.</p>

  <p>User agents may add content to the <code id="read-plugin:the-head-element-2"><a href="semantics.html#the-head-element">head</a></code> element of the <code id="read-plugin:document-3"><a href="dom.html#document">Document</a></code>, or attributes to the <code id="read-plugin:the-embed-element-3"><a href="iframe-embed-object.html#the-embed-element">embed</a></code> element, e.g. to link to a style sheet or to give the document a <code id="read-plugin:the-title-element"><a href="semantics.html#the-title-element">title</a></code>.</p>

  <p id="sandboxPluginNavigate" class="note">If the <code id="read-plugin:document-4"><a href="dom.html#document">Document</a></code>'s <a id="read-plugin:active-sandboxing-flag-set" href="origin.html#active-sandboxing-flag-set">active sandboxing flag set</a> has its <a id="read-plugin:sandboxed-plugins-browsing-context-flag" href="origin.html#sandboxed-plugins-browsing-context-flag">sandboxed plugins browsing context flag</a> set, the synthesized <code id="read-plugin:the-embed-element-4"><a href="iframe-embed-object.html#the-embed-element">embed</a></code> element will <a href="iframe-embed-object.html#sandboxPluginEmbed">fail to render the content</a> if the relevant <a id="read-plugin:plugin" href="infrastructure.html#plugin">plugin</a> cannot be <a href="infrastructure.html#concept-plugin-secure" id="read-plugin:concept-plugin-secure">secured</a>.</p>


  <h4 id="read-ua-inline"><span class="secno">7.10.8</span> <dfn>Page load processing model for inline content that doesn't have a DOM</dfn><a href="#read-ua-inline" class="self-link"></a></h4>

  <p>When the user agent is to display a user agent page inline, provided a <a id="read-ua-inline:browsing-context" href="browsers.html#browsing-context">browsing context</a> <var>browsingContext</var>, the user agent should:</p>

  <ol><li><p>Let <var>navigationParams</var> be a new <a href="#navigation-params" id="read-ua-inline:navigation-params">navigation params</a> whose <a href="#navigation-params-request" id="read-ua-inline:navigation-params-request">request</a> is null, <a href="#navigation-params-response" id="read-ua-inline:navigation-params-response">response</a> is null, <a href="#navigation-params-origin" id="read-ua-inline:navigation-params-origin">origin</a> is a new <a href="origin.html#concept-origin-opaque" id="read-ua-inline:concept-origin-opaque">opaque origin</a>, <a href="#navigation-params-sandboxing" id="read-ua-inline:navigation-params-sandboxing">final sandboxing flag set</a> is an empty set, <a href="#navigation-params-coop" id="read-ua-inline:navigation-params-coop">cross-origin opener policy</a> is a new <a id="read-ua-inline:cross-origin-opener-policy" href="origin.html#cross-origin-opener-policy">cross-origin opener policy</a>, <a href="#navigation-params-coop-enforcement-result" id="read-ua-inline:navigation-params-coop-enforcement-result">COOP enforcement result</a> is a new <a href="origin.html#coop-enforcement-result" id="read-ua-inline:coop-enforcement-result">cross-origin opener policy enforcement result</a>, <a href="#navigation-params-reserved-environment" id="read-ua-inline:navigation-params-reserved-environment">reserved environment</a> is null, and <a href="#navigation-params-browsing-context" id="read-ua-inline:navigation-params-browsing-context">browsing context</a> is <var>browsingContext</var>.</p>

    <p class="XXX">The algorithm called in the next step is not prepared to deal with a null <a href="#navigation-params-response" id="read-ua-inline:navigation-params-response-2">response</a>. Probably we should synthesize one instead.</p>
   <li><p>Let <var>document</var> be the result of <a href="#initialise-the-document-object" id="read-ua-inline:initialise-the-document-object">creating and initializing a <code>Document</code> object</a> given "<code>html</code>", "<code>text/html</code>", and <var>navigationParams</var>.<li><p>Either associate <var>document</var> with a custom rendering that is not rendered using the normal <code id="read-ua-inline:document"><a href="dom.html#document">Document</a></code> rendering rules, or mutate <var>document</var> until it represents the content the user agent wants to render.</p>
  </ol>

  

  <p>Once the page has been set up, the user agent must act as if it had <a href="parsing.html#stop-parsing" id="read-ua-inline:stop-parsing">stopped parsing</a>.</p>

  <p>After creating the <code id="read-ua-inline:document-2"><a href="dom.html#document">Document</a></code> object, but potentially before the page has been completely set up, the user agent must <a href="#update-the-session-history-with-the-new-page" id="read-ua-inline:update-the-session-history-with-the-new-page">update the session history with the new page</a> given <var>navigationParams</var> and the newly-created <code id="read-ua-inline:document-3"><a href="dom.html#document">Document</a></code>.</p>



  <h4 id="scroll-to-fragid"><span class="secno">7.10.9</span> Navigating to a fragment<a href="#scroll-to-fragid" class="self-link"></a></h4>

  <p>To <dfn id="navigate-fragid">navigate to a fragment</dfn> given a <a id="scroll-to-fragid:browsing-context" href="browsers.html#browsing-context">browsing context</a> <var>browsingContext</var>, a <a id="scroll-to-fragid:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>url</var>, and a <a href="#history-handling-behavior" id="scroll-to-fragid:history-handling-behavior">history handling behavior</a> <var>historyHandling</var>:</p>

  <ol><li><p>If <var>historyHandling</var> is not "<code id="scroll-to-fragid:hh-replace"><a href="#hh-replace">replace</a></code>", then remove all the entries in <var>browsingContext</var>'s <a id="scroll-to-fragid:session-history" href="history.html#session-history">session history</a> after the <a id="scroll-to-fragid:current-entry" href="history.html#current-entry">current entry</a>. (If the <a id="scroll-to-fragid:current-entry-2" href="history.html#current-entry">current entry</a> is the last entry in the session history, then no entries are removed.)</p>

    <p class="note">This <a href="history.html#history-notes">doesn't necessarily have to affect</a> the user agent's user interface.</p>
   <li><p>Remove any <a href="webappapis.html#concept-task" id="scroll-to-fragid:concept-task">tasks</a> queued by the <a id="scroll-to-fragid:history-traversal-task-source" href="webappapis.html#history-traversal-task-source">history traversal task source</a> that are associated with any <code id="scroll-to-fragid:document"><a href="dom.html#document">Document</a></code> objects in <var>browsingContext</var>'s <a id="scroll-to-fragid:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="scroll-to-fragid:document-family" href="browsers.html#document-family">document family</a>.<li><p>Append a new <a id="scroll-to-fragid:session-history-entry" href="history.html#session-history-entry">session history entry</a> to the <a id="scroll-to-fragid:session-history-2" href="history.html#session-history">session history</a> whose <a href="history.html#she-url" id="scroll-to-fragid:she-url">URL</a> is <var>url</var>, <a href="history.html#she-document" id="scroll-to-fragid:she-document">document</a> is the <a id="scroll-to-fragid:current-entry-3" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="scroll-to-fragid:she-document-2">document</a>, and <a href="history.html#she-scroll-restoration-mode" id="scroll-to-fragid:she-scroll-restoration-mode">scroll restoration mode</a> is the <a id="scroll-to-fragid:current-entry-4" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-scroll-restoration-mode" id="scroll-to-fragid:she-scroll-restoration-mode-2">scroll restoration mode</a>.<li><p><a href="#traverse-the-history" id="scroll-to-fragid:traverse-the-history">Traverse the history</a> to the new entry, with <var id="scroll-to-fragid:traverse-history-hh"><a href="#traverse-history-hh">historyHandling</a></var> set to <var>historyHandling</var> and with <var><a href="#nonblockingevents" id="scroll-to-fragid:nonblockingevents">nonBlockingEvents</a></var> set to true. This will <a href="#scroll-to-the-fragment-identifier" id="scroll-to-fragid:scroll-to-the-fragment-identifier">scroll to the fragment</a> given in what is now the document's <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="scroll-to-fragid:the-document's-address" data-x-internal="the-document's-address">URL</a>.</ol>

  <p class="note">If the scrolling fails because the relevant <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-id" id="scroll-to-fragid:concept-id" data-x-internal="concept-id">ID</a> has not yet been parsed, then the original <a href="#navigate" id="scroll-to-fragid:navigate">navigation</a> algorithm will take care of the scrolling instead, as the last few steps of its <a href="#update-the-session-history-with-the-new-page" id="scroll-to-fragid:update-the-session-history-with-the-new-page">update the session history with the new page</a> algorithm.</p>

  <hr>

  <p>When the user agent is required to <dfn id="scroll-to-the-fragment-identifier">scroll to the fragment</dfn> and <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document">the indicated part of the document</a>, if any, is <a id="scroll-to-fragid:being-rendered" href="rendering.html#being-rendered">being rendered</a>, the user agent must either change the scrolling position of the document using the following algorithm, or perform some other action such that <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-2">the indicated part of the document</a> is brought to the user's attention. If there is no indicated part, or if the indicated part is not <a id="scroll-to-fragid:being-rendered-2" href="rendering.html#being-rendered">being rendered</a>, then the user agent must do nothing. The aforementioned algorithm is as follows:</p>

  <ol><li><p>If there is no <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-3">indicated part of the document</a>, set the <code id="scroll-to-fragid:document-2"><a href="dom.html#document">Document</a></code>'s <a href="#target-element" id="scroll-to-fragid:target-element">target element</a> to null.<li><p>If the <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-4">indicated part of the document</a> is the top of the document, then:</p>

    <ol><li><p>Set the <code id="scroll-to-fragid:document-3"><a href="dom.html#document">Document</a></code>'s <a href="#target-element" id="scroll-to-fragid:target-element-2">target element</a> to null.<li><p><a id="scroll-to-fragid:scroll-to-the-beginning-of-the-document" href="https://triple-underscore.github.io/cssom-view-ja.html#scroll-to-the-beginning-of-the-document" data-x-internal="scroll-to-the-beginning-of-the-document">Scroll to the beginning of the document</a> for the <code id="scroll-to-fragid:document-4"><a href="dom.html#document">Document</a></code>. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a></ol>
   <li><p>Otherwise:</p>

    <ol><li><p>Let <var>target</var> be element that is <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-5">the indicated part of the document</a>.<li><p>Set the <code id="scroll-to-fragid:document-5"><a href="dom.html#document">Document</a></code>'s <a href="#target-element" id="scroll-to-fragid:target-element-3">target element</a> to <var>target</var>.<li><p><a href="https://triple-underscore.github.io/cssom-view-ja.html#scroll-an-element-into-view" id="scroll-to-fragid:scroll-an-element-into-view" data-x-internal="scroll-an-element-into-view">Scroll <var>target</var> into view</a>, with <var>behavior</var> set to "auto", <var>block</var> set to "start", and <var>inline</var> set to "nearest". <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a><li><p>Run the <a id="scroll-to-fragid:focusing-steps" href="interaction.html#focusing-steps">focusing steps</a> for <var>target</var>, with the <code id="scroll-to-fragid:document-6"><a href="dom.html#document">Document</a></code>'s <a id="scroll-to-fragid:viewport" href="https://drafts.csswg.org/css2/#viewport" data-x-internal="viewport">viewport</a> as the <var>fallback target</var>.<li><p>Move the <a id="scroll-to-fragid:sequential-focus-navigation-starting-point" href="interaction.html#sequential-focus-navigation-starting-point">sequential focus navigation starting point</a> to <var>target</var>.</ol>
   </ol>

  <p><dfn id="the-indicated-part-of-the-document">The indicated part of the document</dfn> is the one that the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a>, if any, identifies. The semantics of the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragment</a> in terms of mapping it to a node is defined by the specification that defines the <a id="scroll-to-fragid:mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#mime-type" data-x-internal="mime-type">MIME type</a> used by the <code id="scroll-to-fragid:document-7"><a href="dom.html#document">Document</a></code> (for example, the processing of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment-3" data-x-internal="concept-url-fragment">fragments</a> for <a href="https://triple-underscore.github.io/mimesniff-ja.html#xml-mime-type" id="scroll-to-fragid:xml-mime-type" data-x-internal="xml-mime-type">XML MIME types</a> is the responsibility of RFC7303). <a href="references.html#refsRFC7303">[RFC7303]</a></p>

  <p>There is also a <dfn id="target-element">target element</dfn> for each <code id="scroll-to-fragid:document-8"><a href="dom.html#document">Document</a></code>, which is used in defining the <code id="scroll-to-fragid:selector-target"><a href="semantics-other.html#selector-target">:target</a></code> pseudo-class and is updated by the above algorithm. 最初はnullである。</p>

  <p>For HTML documents (and <a href="https://triple-underscore.github.io/mimesniff-ja.html#html-mime-type" id="scroll-to-fragid:html-mime-type" data-x-internal="html-mime-type">HTML MIME types</a>), the following processing model must be followed to determine what <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-6">the indicated part of the document</a> is.</p>

  <ol><li><p>Let <var>fragment</var> be the document's <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="scroll-to-fragid:the-document's-address-2" data-x-internal="the-document's-address">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="scroll-to-fragid:concept-url-fragment-4" data-x-internal="concept-url-fragment">fragment</a>.<li><p>If <var>fragment</var> is the empty string, then <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-7">the indicated part of the document</a> is the top of the document; return.<li><p>If <a href="#find-a-potential-indicated-element" id="scroll-to-fragid:find-a-potential-indicated-element">find a potential indicated element</a> with <var>fragment</var> returns non-null, then the return value is <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-8">the indicated part of the document</a>; return.<li><p>Let <var>fragmentBytes</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#string-percent-decode" id="scroll-to-fragid:percent-decode" data-x-internal="percent-decode">percent-decoding</a> <var>fragment</var>.<li><p>Let <var>decodedFragment</var> be the result of running <a id="scroll-to-fragid:utf-8-decode-without-bom" href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode-without-bom" data-x-internal="utf-8-decode-without-bom">UTF-8 decode without BOM</a> on <var>fragmentBytes</var>.<li><p>If <a href="#find-a-potential-indicated-element" id="scroll-to-fragid:find-a-potential-indicated-element-2">find a potential indicated element</a> with <var>decodedFragment</var> returns non-null, then the return value is <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-9">the indicated part of the document</a>; return.<li><p>If <var>decodedFragment</var> is an <a id="scroll-to-fragid:ascii-case-insensitive" href="https://triple-underscore.github.io/infra-ja.html#ascii-case-insensitive" data-x-internal="ascii-case-insensitive">ASCII case-insensitive</a> match for the string <code>top</code>, then <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-10">the indicated part of the document</a> is the top of the document; return.<li><p>There is no <a href="#the-indicated-part-of-the-document" id="scroll-to-fragid:the-indicated-part-of-the-document-11">indicated part of the document</a>.</ol>

  <p>To <dfn id="find-a-potential-indicated-element">find a potential indicated element</dfn> given a string <var>fragment</var>, run these steps:</p>

  <ol><li><p>If there is an element <a href="https://triple-underscore.github.io/DOM4-ja.html#in-a-document" id="scroll-to-fragid:in-a-document-tree" data-x-internal="in-a-document-tree">in the document tree</a> that has an <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-id" id="scroll-to-fragid:concept-id-2" data-x-internal="concept-id">ID</a> equal to <var>fragment</var>, then return the first such element in <a id="scroll-to-fragid:tree-order" href="https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order" data-x-internal="tree-order">tree order</a>.<li><p>If there is an <code id="scroll-to-fragid:the-a-element"><a href="text-level-semantics.html#the-a-element">a</a></code> element <a href="https://triple-underscore.github.io/DOM4-ja.html#in-a-document" id="scroll-to-fragid:in-a-document-tree-2" data-x-internal="in-a-document-tree">in the document tree</a> that has a <code id="scroll-to-fragid:attr-a-name"><a href="obsolete.html#attr-a-name">name</a></code> attribute whose value is equal to <var>fragment</var>, then return the first such element in <a id="scroll-to-fragid:tree-order-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order" data-x-internal="tree-order">tree order</a>.<li><p>Return null.</ol>

  



  <h4 id="history-traversal"><span class="secno">7.10.10</span> 履歴走査<a href="#history-traversal" class="self-link"></a></h4> 

  

  <p>To <dfn id="traverse-the-history">traverse the history</dfn> to a <a id="history-traversal:session-history-entry" href="history.html#session-history-entry">session history entry</a> <var>entry</var>, with an optional <a href="#history-handling-behavior" id="history-traversal:history-handling-behavior">history handling behavior</a> <dfn id="traverse-history-hh"><var>historyHandling</var></dfn> (default "<code id="history-traversal:hh-default"><a href="#hh-default">default</a></code>"), an optional boolean <dfn id="nonblockingevents"><var>nonBlockingEvents</var></dfn> (default false), and an optional boolean <dfn id="explicithistorynavigation"><var>explicitHistoryNavigation</var></dfn> (default false):</p>

  <p class="note">This algorithm is not just invoked when <a href="history.html#traverse-the-history-by-a-delta" id="history-traversal:traverse-the-history-by-a-delta">explicitly going back or forwards in the session history</a> — it is also invoked in other situations, for example when <a href="#navigate" id="history-traversal:navigate">navigating a browsing context</a>, as part of <a href="#update-the-session-history-with-the-new-page" id="history-traversal:update-the-session-history-with-the-new-page">updating the session history with the new page</a>.</p>

  <ol><li><p>If <var>entry</var>'s <a href="history.html#she-document" id="history-traversal:she-document">document</a> is null, then:</p>

    <ol><li><p>Assert: <var>historyHandling</var> is "<code id="history-traversal:hh-default-2"><a href="#hh-default">default</a></code>".<li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="history-traversal:concept-request" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="history-traversal:concept-request-url" data-x-internal="concept-request-url">url</a> is <var>entry</var>'s <a href="history.html#she-url" id="history-traversal:she-url">URL</a>.<li><p>If <var>explicitHistoryNavigation</var> is true, then set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-history-navigation-flag" id="history-traversal:concept-request-history-navigation-flag" data-x-internal="concept-request-history-navigation-flag">history-navigation flag</a>.<li><p><a href="#navigate" id="history-traversal:navigate-2">Navigate</a> the <a id="history-traversal:browsing-context" href="browsers.html#browsing-context">browsing context</a> to <var>request</var> with <var id="history-traversal:navigation-hh"><a href="#navigation-hh">historyHandling</a></var> set to "<code id="history-traversal:hh-entry-update"><a href="#hh-entry-update">entry update</a></code>". The navigation must be done using the same <a href="#source-browsing-context" id="history-traversal:source-browsing-context">source browsing context</a> as was used the first time <var>entry</var> was created.</p>

      <p class="note">The "<a href="#navigate" id="history-traversal:navigate-3">navigate</a>" algorithm reinvokes this "traverse" algorithm to complete the traversal, at which point <var>entry</var>'s <a href="history.html#she-document" id="history-traversal:she-document-2">document</a> is non-null.</p>

      <p class="note">If the resource was obtained using a non-idempotent action, for example a POST form submission, or if the resource is no longer available, for example because the computer is now offline and the page wasn't cached, navigating to it again might not be possible. In this case, the navigation will result in a different page than previously; for example, it might be an error message explaining the problem or offering to resubmit the form.</p>
     <li><p>Return.</ol>
   <li><p><a href="#save-persisted-state" id="history-traversal:save-persisted-state">Save persisted state</a> to the <a id="history-traversal:current-entry" href="history.html#current-entry">current entry</a>.<li><p>Let <var>newDocument</var> be <var>entry</var>'s <a href="history.html#she-document" id="history-traversal:she-document-3">document</a>.<li><p>If <var>newDocument</var> is different than the <a id="history-traversal:current-entry-2" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="history-traversal:she-document-4">document</a>, or <var>historyHandling</var> is "<code id="history-traversal:hh-entry-update-2"><a href="#hh-entry-update">entry update</a></code>" or "<code id="history-traversal:hh-reload"><a href="#hh-reload">reload</a></code>", then:</p>

    <ol><li><p>Remove any <a href="webappapis.html#concept-task" id="history-traversal:concept-task">tasks</a> queued by the <a id="history-traversal:history-traversal-task-source" href="webappapis.html#history-traversal-task-source">history traversal task source</a> that are associated with any <code id="history-traversal:document"><a href="dom.html#document">Document</a></code> objects in the <a id="history-traversal:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="history-traversal:document-family" href="browsers.html#document-family">document family</a>.<li><p>If <var>newDocument</var>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="history-traversal:concept-document-origin" data-x-internal="concept-document-origin">origin</a> is not <a id="history-traversal:same-origin" href="origin.html#same-origin">same origin</a> with the <a id="history-traversal:current-entry-3" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="history-traversal:she-document-5">document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="history-traversal:concept-document-origin-2" data-x-internal="concept-document-origin">origin</a>, then:</p>

      <ol><li><p>Let <var>entriesToUpdate</var> be all <a href="history.html#session-history-entry" id="history-traversal:session-history-entry-2">entries</a> in the <a id="history-traversal:session-history" href="history.html#session-history">session history</a> whose <a href="history.html#she-document" id="history-traversal:she-document-6">document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="history-traversal:concept-document-origin-3" data-x-internal="concept-document-origin">origin</a> is <a id="history-traversal:same-origin-2" href="origin.html#same-origin">same origin</a> as the <a id="history-traversal:active-document" href="browsers.html#active-document">active document</a> <em>and</em> that are contiguous with the <a id="history-traversal:current-entry-4" href="history.html#current-entry">current entry</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="history-traversal:list-iterate" data-x-internal="list-iterate">For each</a> <var>entryToUpdate</var> of <var>entriesToUpdate</var>, set <var>entryToUpdate</var>'s <a href="history.html#she-bc-name" id="history-traversal:she-bc-name">browsing context name</a> to the current <a id="history-traversal:browsing-context-name" href="browsers.html#browsing-context-name">browsing context name</a>.<li id="resetBCName"><p>If the browsing context is a <a id="history-traversal:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a>, but not an <a id="history-traversal:auxiliary-browsing-context" href="browsers.html#auxiliary-browsing-context">auxiliary browsing context</a> whose <a id="history-traversal:disowned-its-opener" href="browsers.html#disowned-its-opener">disowned</a> is false, then set the browsing context's <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-2">name</a> to the empty string.</ol>
     <li><p><a id="history-traversal:set-the-active-document" href="browsers.html#set-the-active-document">Set the active document</a> of the <a id="history-traversal:browsing-context-2" href="browsers.html#browsing-context">browsing context</a> to <var>newDocument</var>.<li><p>If <var>entry</var>'s <a href="history.html#she-bc-name" id="history-traversal:she-bc-name-2">browsing context name</a> is not null, then:</p>

      <ol><li><p>Set the browsing context's <a href="browsers.html#browsing-context-name" id="history-traversal:browsing-context-name-3">name</a> to <var>entry</var>'s <a href="history.html#she-bc-name" id="history-traversal:she-bc-name-3">browsing context name</a>.<li><p>Let <var>entriesToUpdate</var> be all <a href="history.html#session-history-entry" id="history-traversal:session-history-entry-3">entries</a> in the <a id="history-traversal:session-history-2" href="history.html#session-history">session history</a> whose <a href="history.html#she-document" id="history-traversal:she-document-7">document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="history-traversal:concept-document-origin-4" data-x-internal="concept-document-origin">origin</a> is <a id="history-traversal:same-origin-3" href="origin.html#same-origin">same origin</a> as the new <a id="history-traversal:active-document-2" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="history-traversal:concept-document-origin-5" data-x-internal="concept-document-origin">origin</a> and that are contiguous with <var>entry</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="history-traversal:list-iterate-2" data-x-internal="list-iterate">For each</a> <var>entryToUpdate</var> of <var>entriesToUpdate</var>, set <var>entryToUpdate</var>'s <a href="history.html#she-bc-name" id="history-traversal:she-bc-name-4">browsing context name</a> to null.</ol>
     <li id="history-autocomplete"><p>If <var>newDocument</var> has any form controls whose <a id="history-traversal:autofill-field-name" href="form-control-infrastructure.html#autofill-field-name">autofill field name</a> is "<code id="history-traversal:attr-fe-autocomplete-off"><a href="form-control-infrastructure.html#attr-fe-autocomplete-off">off</a></code>", invoke the <a href="form-control-infrastructure.html#concept-form-reset-control" id="history-traversal:concept-form-reset-control">reset algorithm</a> of each of those elements.<li><p>If <var>newDocument</var>'s <a id="history-traversal:current-document-readiness" href="dom.html#current-document-readiness">current document readiness</a> "<code>complete</code>", then <a id="history-traversal:queue-a-global-task" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="history-traversal:dom-manipulation-task-source" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>newDocument</var>'s <a id="history-traversal:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> to run the following steps:</p>

      <ol><li><p>If <var>newDocument</var>'s <a href="#page-showing" id="history-traversal:page-showing">page showing</a> flag is true, then abort these steps.<li><p>Set <var>newDocument</var>'s <a href="#page-showing" id="history-traversal:page-showing-2">page showing</a> flag to true.<li><p>Run any <dfn id="session-history-document-visibility-change-steps">session history document visibility change steps</dfn> for <var>newDocument</var> that are defined by <a id="history-traversal:other-applicable-specifications" href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</p>

        <p class="note">This is specifically intended for use by <cite>Page Visibility</cite>. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>
       <li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="history-traversal:concept-event-fire" data-x-internal="concept-event-fire">Fire an event</a> named <code id="history-traversal:event-pageshow"><a href="indices.html#event-pageshow">pageshow</a></code> at <var>newDocument</var>'s <a id="history-traversal:concept-relevant-global-2" href="webappapis.html#concept-relevant-global">relevant global object</a>, using <code id="history-traversal:pagetransitionevent"><a href="#pagetransitionevent">PageTransitionEvent</a></code>, with the <code id="history-traversal:dom-pagetransitionevent-persisted"><a href="#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialized to true, and <var>legacy target override flag</var> set.</ol>

      
     </ol>
   <li><p>Set <var>newDocument</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="history-traversal:the-document's-address" data-x-internal="the-document's-address">URL</a> to <var>entry</var>'s <a href="history.html#she-url" id="history-traversal:she-url-2">URL</a>.<li><p>Let <var>hashChanged</var> be false, and let <var>oldURL</var> and <var>newURL</var> be null.<li><p>If <var>entry</var>'s <a href="history.html#she-url" id="history-traversal:she-url-3">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="history-traversal:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a> is not <a id="history-traversal:identical-to" href="https://triple-underscore.github.io/infra-ja.html#string-is" data-x-internal="identical-to">identical to</a> the <a id="history-traversal:current-entry-5" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-url" id="history-traversal:she-url-4">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="history-traversal:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragment</a>, and <var>entry</var>'s <a href="history.html#she-document" id="history-traversal:she-document-8">document</a> equals the <a id="history-traversal:current-entry-6" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-document" id="history-traversal:she-document-9">document</a>, then set <var>hashChanged</var> to true, set <var>oldURL</var> to the <a id="history-traversal:current-entry-7" href="history.html#current-entry">current entry</a>'s <a href="history.html#she-url" id="history-traversal:she-url-5">URL</a>, and set <var>newURL</var> to <var>entry</var>'s <a href="history.html#she-url" id="history-traversal:she-url-6">URL</a>.<li><p>If <var>historyHandling</var> is "<code id="history-traversal:hh-replace"><a href="#hh-replace">replace</a></code>", then remove the entry immediately before <var>entry</var> in the <a id="history-traversal:session-history-3" href="history.html#session-history">session history</a>.<li><p>If <var>entry</var>'s <a href="history.html#she-other" id="history-traversal:she-other">persisted user state</a> is null, and its <a href="history.html#she-url" id="history-traversal:she-url-7">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="history-traversal:concept-url-fragment-3" data-x-internal="concept-url-fragment">fragment</a> is non-null, then <a href="#scroll-to-the-fragment-identifier" id="history-traversal:scroll-to-the-fragment-identifier">scroll to the fragment</a>.<li><p>Set the <a id="history-traversal:current-entry-8" href="history.html#current-entry">current entry</a> to <var>entry</var>.<li><p>Let <var>targetRealm</var> be the <a id="history-traversal:current-realm-record" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a>.<li><p>Let <var>state</var> be null.<li><p>If <var>entry</var>'s <a href="history.html#she-serialized-state" id="history-traversal:she-serialized-state">serialized state</a> is not null, then set <var>state</var> to <a id="history-traversal:structureddeserialize" href="structured-data.html#structureddeserialize">StructuredDeserialize</a>(<var>entry</var>'s <a href="history.html#she-serialized-state" id="history-traversal:she-serialized-state-2">serialized state</a>, <var>targetRealm</var>). If this throws an exception, catch it and ignore the exception.<li><p>Set <var>newDocument</var>'s <code id="history-traversal:history-3"><a href="history.html#history-3">History</a></code> object's <a href="history.html#concept-history-state" id="history-traversal:concept-history-state">state</a> to <var>state</var>.<li><p>Let <var>stateChanged</var> be true if <var>newDocument</var> has a <a id="history-traversal:latest-entry" href="history.html#latest-entry">latest entry</a>, and that entry is not <var>entry</var>; otherwise let it be false.</p>

   <li><p>Set <var>newDocument</var>'s <a id="history-traversal:latest-entry-2" href="history.html#latest-entry">latest entry</a> to <var>entry</var>.<li><p>If <var>nonBlockingEvents</var> is false, then run the following steps <a id="history-traversal:immediately" href="infrastructure.html#immediately">immediately</a>. Otherwise, <a id="history-traversal:queue-a-global-task-2" href="webappapis.html#queue-a-global-task">queue a global task</a> on the <a id="history-traversal:dom-manipulation-task-source-2" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>newDocument</var>'s <a id="history-traversal:concept-relevant-global-3" href="webappapis.html#concept-relevant-global">relevant global object</a> to run the following steps instead.</p>

    <ol><li><p>If <var>stateChanged</var> is true, then <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="history-traversal:concept-event-fire-2" data-x-internal="concept-event-fire">fire an event</a> named <code id="history-traversal:event-popstate"><a href="indices.html#event-popstate">popstate</a></code> at <var>newDocument</var>'s <a id="history-traversal:concept-relevant-global-4" href="webappapis.html#concept-relevant-global">relevant global object</a>, using <code id="history-traversal:popstateevent"><a href="#popstateevent">PopStateEvent</a></code>, with the <code id="history-traversal:dom-popstateevent-state"><a href="#dom-popstateevent-state">state</a></code> attribute initialized to <var>state</var>.<li><p><a href="#restore-persisted-state" id="history-traversal:restore-persisted-state">Restore persisted state</a> from <var>entry</var>.<li><p>If <var>hashChanged</var> is true, then <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="history-traversal:concept-event-fire-3" data-x-internal="concept-event-fire">fire an event</a> named <code id="history-traversal:event-hashchange"><a href="indices.html#event-hashchange">hashchange</a></code> at the <a id="history-traversal:browsing-context-3" href="browsers.html#browsing-context">browsing context</a>'s <a id="history-traversal:active-window" href="browsers.html#active-window">active window</a>, using <code id="history-traversal:hashchangeevent"><a href="#hashchangeevent">HashChangeEvent</a></code>, with the <code id="history-traversal:dom-hashchangeevent-oldurl"><a href="#dom-hashchangeevent-oldurl">oldURL</a></code> attribute initialized to <var>oldURL</var> and the <code id="history-traversal:dom-hashchangeevent-newurl"><a href="#dom-hashchangeevent-newurl">newURL</a></code> attribute initialized to <var>newURL</var>.</ol>
   </ol>


  <h5 id="persisted-user-state-restoration"><span class="secno">7.10.10.1</span> Persisted history entry state<a href="#persisted-user-state-restoration" class="self-link"></a></h5>

  <p>To <dfn id="save-persisted-state">save persisted state</dfn> to a <a id="persisted-user-state-restoration:session-history-entry" href="history.html#session-history-entry">session history entry</a> <var>entry</var>:</p>

  <ol><li><p>Set the <a href="history.html#she-scroll-position" id="persisted-user-state-restoration:she-scroll-position">scroll position data</a> of <var>entry</var> to contain the scroll positions for all of <var>entry</var>'s <a href="history.html#she-document" id="persisted-user-state-restoration:she-document">document</a>'s <a href="#restorable-scrollable-regions" id="persisted-user-state-restoration:restorable-scrollable-regions">restorable scrollable regions</a>.<li><p>Optionally, update <var>entry</var>'s <a href="history.html#she-other" id="persisted-user-state-restoration:she-other">persisted user state</a> to reflect any state that the user agent wishes to persist, such as the values of form fields.</ol>

  <p id="restore-persisted-user-state">To <dfn id="restore-persisted-state">restore persisted state</dfn> from a <a id="persisted-user-state-restoration:session-history-entry-2" href="history.html#session-history-entry">session history entry</a> <var>entry</var>:</p>

  <ol><li><p>If <var>entry</var>'s <a href="history.html#she-scroll-restoration-mode" id="persisted-user-state-restoration:she-scroll-restoration-mode">scroll restoration mode</a> is "<code id="persisted-user-state-restoration:dom-scrollrestoration-auto"><a href="history.html#dom-scrollrestoration-auto">auto</a></code>", then the user agent may use <var>entry</var>'s <a href="history.html#she-scroll-position" id="persisted-user-state-restoration:she-scroll-position-2">scroll position data</a> to restore the scroll positions of <var>entry</var>'s <a href="history.html#she-document" id="persisted-user-state-restoration:she-document-2">document</a>'s <a href="#restorable-scrollable-regions" id="persisted-user-state-restoration:restorable-scrollable-regions-2">restorable scrollable regions</a>.</p>

    <p class="note">The user agent not restoring scroll positions does not imply that scroll positions will be left at any particular value (e.g., (0,0)). The actual scroll position depends on the navigation type and the user agent's particular caching strategy. So web applications cannot assume any particular scroll position but rather are urged to set it to what they want it to be.</p>
   <li><p>Optionally, update other aspects of <var>entry</var>'s <a href="history.html#she-document" id="persisted-user-state-restoration:she-document-3">document</a> and its rendering, for instance values of form fields, that the user agent had previously recorded in <var>entry</var>'s <a href="history.html#she-other" id="persisted-user-state-restoration:she-other-2">persisted user state</a>.</p>

    <p class="note">This can even include updating the <code id="persisted-user-state-restoration:attr-dir"><a href="dom.html#attr-dir">dir</a></code> attribute of <code id="persisted-user-state-restoration:the-textarea-element"><a href="form-elements.html#the-textarea-element">textarea</a></code> elements or <code id="persisted-user-state-restoration:the-input-element"><a href="input.html#the-input-element">input</a></code> elements whose <code id="persisted-user-state-restoration:attr-input-type"><a href="input.html#attr-input-type">type</a></code> attribute is in either the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)">Text</a> state or the <a href="input.html#text-(type=text)-state-and-search-state-(type=search)" id="persisted-user-state-restoration:text-(type=text)-state-and-search-state-(type=search)-2">Search</a> state, if the persisted state includes the directionality of user input in such controls.</p>
   </ol>

  <hr>

  <p>The <dfn id="restorable-scrollable-regions">restorable scrollable regions</dfn> of a <code id="persisted-user-state-restoration:document"><a href="dom.html#document">Document</a></code> <var>document</var> are <var>document</var>'s <a id="persisted-user-state-restoration:viewport" href="https://drafts.csswg.org/css2/#viewport" data-x-internal="viewport">viewport</a>, and all of <var>document</var>'s scrollable regions excepting any <a href="browsers.html#child-browsing-context" id="persisted-user-state-restoration:child-browsing-context">child browsing contexts</a> of <var>document</var>.</p>

  <p class="note"><a id="persisted-user-state-restoration:child-browsing-context-2" href="browsers.html#child-browsing-context">Child browsing context</a> scroll restoration is handled by the history entry for those browsing contexts' <code id="persisted-user-state-restoration:document-2"><a href="dom.html#document">Document</a></code>s.</p>

  


  <h5 id="the-popstateevent-interface"><span class="secno">7.10.10.2</span> <code id="the-popstateevent-interface:popstateevent"><a href="#popstateevent">PopStateEvent</a></code>インターフェイス<a href="#the-popstateevent-interface" class="self-link"></a></h5>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PopStateEvent" title="PopStateEvent is an event handler for the popstate event on the window.">PopStateEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>4+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='popstateevent'><c- g>PopStateEvent</c-></dfn> : <a id='the-popstateevent-interface:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <c- g>constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#popstateeventinit' id='the-popstateevent-interface:popstateeventinit'><c- n>PopStateEventInit</c-></a> <c- g>eventInitDict</c-> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>any</c-> <a href='#dom-popstateevent-state' id='the-popstateevent-interface:dom-popstateevent-state'><c- g>state</c-></a>;
};

<c- b>dictionary</c-> <dfn id='popstateeventinit'><c- g>PopStateEventInit</c-></dfn> : <a id='the-popstateevent-interface:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>any</c-> <c- g>state</c-> = <c- b>null</c->;
};</code></pre>

  <dl class="domintro"><dt><var>event</var> . <code id="dom-popstateevent-state-dev"><a href="#dom-popstateevent-state">state</a></code><dd><p><code id="the-popstateevent-interface:dom-history-pushstate"><a href="history.html#dom-history-pushstate">pushState()</a></code>または<code id="the-popstateevent-interface:dom-history-replacestate"><a href="history.html#dom-history-replacestate">replaceState()</a></code>へ提供される情報のコピーを返す。</p>
   </dl>

  

  <p>The <dfn id="dom-popstateevent-state"><code>state</code></dfn> attribute must return the value it was initialized to. It represents the context information for the event, or null, if the state represented is the initial state of the <code id="the-popstateevent-interface:document"><a href="dom.html#document">Document</a></code>.</p>

  


  <h5 id="the-hashchangeevent-interface"><span class="secno">7.10.10.3</span> <code id="the-hashchangeevent-interface:hashchangeevent"><a href="#hashchangeevent">HashChangeEvent</a></code>インターフェイス<a href="#the-hashchangeevent-interface" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent" title="The HashChangeEvent interface represents events that fire when the fragment identifier of the URL has changed.">HashChangeEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.6+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>5+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=hashchange" title="Hashchange event">caniuse.com table</a></span></span></div></div></div>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='hashchangeevent'><c- g>HashChangeEvent</c-></dfn> : <a id='the-hashchangeevent-interface:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <c- g>constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#hashchangeeventinit' id='the-hashchangeevent-interface:hashchangeeventinit'><c- n>HashChangeEventInit</c-></a> <c- g>eventInitDict</c-> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-hashchangeevent-oldurl' id='the-hashchangeevent-interface:dom-hashchangeevent-oldurl'><c- g>oldURL</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-hashchangeevent-newurl' id='the-hashchangeevent-interface:dom-hashchangeevent-newurl'><c- g>newURL</c-></a>;
};

<c- b>dictionary</c-> <dfn id='hashchangeeventinit'><c- g>HashChangeEventInit</c-></dfn> : <a id='the-hashchangeevent-interface:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>USVString</c-> <c- g>oldURL</c-> = "";
  <c- b>USVString</c-> <c- g>newURL</c-> = "";
};</code></pre>

  <dl class="domintro"><dt><var>event</var> . <code id="dom-hashchangeevent-oldurl-dev"><a href="#dom-hashchangeevent-oldurl">oldURL</a></code><dd><p>以前に現在であった<a id="the-hashchangeevent-interface:session-history-entry" href="history.html#session-history-entry">セッション履歴のエントリー</a>の<a id="the-hashchangeevent-interface:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>を返す。</p>
   <dt><var>event</var> . <code id="dom-hashchangeevent-newurl-dev"><a href="#dom-hashchangeevent-newurl">newURL</a></code><dd><p>今現在である<a id="the-hashchangeevent-interface:session-history-entry-2" href="history.html#session-history-entry">セッション履歴のエントリー</a>の<a id="the-hashchangeevent-interface:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>を返す。</p>
   </dl>

  

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/oldURL" title="The oldURL read-only property of the HashChangeEvent interface returns the previous URL from which the window was navigated.">HashChangeEvent/oldURL</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id="dom-hashchangeevent-oldurl"><code>oldURL</code></dfn> attribute must return the value it was initialized to. It represents context information for the event, specifically the URL of the <a id="the-hashchangeevent-interface:session-history-entry-3" href="history.html#session-history-entry">session history entry</a> that was traversed from.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HashChangeEvent/newURL" title="The newURL read-only property of the HashChangeEvent interface returns the new URL to which the window is navigating.">HashChangeEvent/newURL</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id="dom-hashchangeevent-newurl"><code>newURL</code></dfn> attribute must return the value it was initialized to. It represents context information for the event, specifically the URL of the <a id="the-hashchangeevent-interface:session-history-entry-4" href="history.html#session-history-entry">session history entry</a> that was traversed to.</p>

  


  <h5 id="the-pagetransitionevent-interface"><span class="secno">7.10.10.4</span> <code id="the-pagetransitionevent-interface:pagetransitionevent"><a href="#pagetransitionevent">PageTransitionEvent</a></code>インターフェイス<a href="#the-pagetransitionevent-interface" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent" title="The PageTransitionEvent event object is available inside handler functions for the pageshow and pagehide events, fired when a document is being loaded or unloaded.">PageTransitionEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='pagetransitionevent'><c- g>PageTransitionEvent</c-></dfn> : <a id='the-pagetransitionevent-interface:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <c- g>constructor</c->(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#pagetransitioneventinit' id='the-pagetransitionevent-interface:pagetransitioneventinit'><c- n>PageTransitionEventInit</c-></a> <c- g>eventInitDict</c-> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-pagetransitionevent-persisted' id='the-pagetransitionevent-interface:dom-pagetransitionevent-persisted'><c- g>persisted</c-></a>;
};

<c- b>dictionary</c-> <dfn id='pagetransitioneventinit'><c- g>PageTransitionEventInit</c-></dfn> : <a id='the-pagetransitionevent-interface:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>boolean</c-> <c- g>persisted</c-> = <c- b>false</c->;
};</code></pre>

  <dl class="domintro"><dt><var>event</var> . <code id="dom-pagetransitionevent-persisted-dev"><a href="#dom-pagetransitionevent-persisted">persisted</a></code><dd><p><code id="the-pagetransitionevent-interface:event-pageshow"><a href="indices.html#event-pageshow">pageshow</a></code>に対して、ページが新しく読み込まれている（および<code id="the-pagetransitionevent-interface:event-load"><a href="indices.html#event-load">load</a></code>イベントが発生する）場合にfalseを返す。そうでなければ、trueを返す。</p>

    <p><code id="the-pagetransitionevent-interface:event-pagehide"><a href="indices.html#event-pagehide">pagehide</a></code>イベントに対して、ページが最後の時間まで出かける場合はfalseを返す。そうでなければ、（何もページを最上にしないよう共謀しない場合）、ユーザーがこのページに戻る場合、ページが再利用されるかもしれないことを意味し、trueを返す。</p>

    <p>最上でないページを含む可能性があるもの：</p>

    <ul class="brief"><li>The user agent decided to not keep the <code id="the-pagetransitionevent-interface:document"><a href="dom.html#document">Document</a></code> alive in a <a id="the-pagetransitionevent-interface:session-history-entry" href="history.html#session-history-entry">session history entry</a> after <a href="#unload-a-document" id="the-pagetransitionevent-interface:unload-a-document">unload</a><li>最上でない<code id="the-pagetransitionevent-interface:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>を持っている<li>アクティブな<code id="the-pagetransitionevent-interface:websocket"><a href="web-sockets.html#websocket">WebSocket</a></code>オブジェクト<li><a href="#abort-a-document" id="the-pagetransitionevent-interface:abort-a-document"><code>Document</code>の中止</a></ul>
   </dl>

  

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PageTransitionEvent/persisted" title="The persisted read-only property indicates if a webpage is loading from a cache.">PageTransitionEvent/persisted</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>11</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><p>The <dfn id="dom-pagetransitionevent-persisted"><code>persisted</code></dfn> attribute must return the value it was initialized to. It represents the context information for the event.</p>

  <h4 id="loading-documents"><span class="secno">7.10.11</span> Loading documents<a href="#loading-documents" class="self-link"></a></h4>

  <p>A <code id="loading-documents:document"><a href="dom.html#document">Document</a></code> has a <dfn id="completely-loaded-time">completely loaded time</dfn> (a time or null), which is initially null.</p>

  <p>A <code id="loading-documents:document-2"><a href="dom.html#document">Document</a></code> is considered <dfn id="completely-loaded">completely loaded</dfn> if its <a href="#completely-loaded-time" id="loading-documents:completely-loaded-time">completely loaded time</a> is non-null.<p>To <dfn id="completely-finish-loading">completely finish loading</dfn> a <code id="loading-documents:document-3"><a href="dom.html#document">Document</a></code> <var>document</var>:</p>

  <ol><li><p>Assert: <var>document</var>'s <a href="browsers.html#concept-document-bc" id="loading-documents:concept-document-bc">browsing context</a> is non-null.<li><p>Set <var>document</var>'s <a href="#completely-loaded-time" id="loading-documents:completely-loaded-time-2">completely loaded time</a> to the current time.<li><p>Let <var>container</var> be <var>document</var>'s <a href="browsers.html#concept-document-bc" id="loading-documents:concept-document-bc-2">browsing context</a>'s <a href="browsers.html#bc-container" id="loading-documents:bc-container">container</a>.<li><p>If <var>container</var> is an <code id="loading-documents:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> element, then <a id="loading-documents:queue-an-element-task" href="webappapis.html#queue-an-element-task">queue an element task</a> on the <a id="loading-documents:dom-manipulation-task-source" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>container</var> to run the <a id="loading-documents:iframe-load-event-steps" href="iframe-embed-object.html#iframe-load-event-steps">iframe load event steps</a> given <var>container</var>.<li><p>Otherwise, if <var>container</var> is non-null, then <a id="loading-documents:queue-an-element-task-2" href="webappapis.html#queue-an-element-task">queue an element task</a> on the <a id="loading-documents:dom-manipulation-task-source-2" href="webappapis.html#dom-manipulation-task-source">DOM manipulation task source</a> given <var>container</var> to <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="loading-documents:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="loading-documents:event-load"><a href="indices.html#event-load">load</a></code> at <var>container</var>.</p>
  </ol>

  

  <h4 id="unloading-documents"><span class="secno">7.10.12</span> 文書の解放<a href="#unloading-documents" class="self-link"></a></h4>

  

  <p>A <code id="unloading-documents:document"><a href="dom.html#document">Document</a></code> has a <dfn id="concept-document-salvageable"><i>salvageable</i></dfn> state, which must initially be true, and a <dfn id="page-showing">page showing</dfn> flag, which must initially be false. The <a href="#page-showing" id="unloading-documents:page-showing">page showing</a> flag is used to ensure that scripts receive <code id="unloading-documents:event-pageshow"><a href="indices.html#event-pageshow">pageshow</a></code> and <code id="unloading-documents:event-pagehide"><a href="indices.html#event-pagehide">pagehide</a></code> events in a consistent manner (e.g. that they never receive two <code id="unloading-documents:event-pagehide-2"><a href="indices.html#event-pagehide">pagehide</a></code> events in a row without an intervening <code id="unloading-documents:event-pageshow-2"><a href="indices.html#event-pageshow">pageshow</a></code>, or vice versa).</p>

  <p><a href="webappapis.html#event-loop" id="unloading-documents:event-loop">Event loops</a> have a <dfn id="termination-nesting-level">termination nesting level</dfn> counter, which must initially be 0.</p>

  <p>To <dfn id="prompt-to-unload-a-document">prompt to unload</dfn>, given a <code id="unloading-documents:document-2"><a href="dom.html#document">Document</a></code> object <var>document</var> and optionally a <var>recursiveFlag</var>, run these steps:</p>

  <ol><li><p>Increase the <a id="unloading-documents:event-loop-2" href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level" id="unloading-documents:termination-nesting-level">termination nesting level</a> by 1.<li><p>Increase the <var>document</var>'s <a id="unloading-documents:ignore-opens-during-unload-counter" href="dynamic-markup-insertion.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by 1.<li><p>Let <var>event</var> be the result of <a id="unloading-documents:creating-an-event" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-create" data-x-internal="creating-an-event">creating an event</a> using <code id="unloading-documents:beforeunloadevent"><a href="#beforeunloadevent">BeforeUnloadEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id="unloading-documents:dom-event-type"><a data-x-internal="dom-event-type" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-type">type</a></code> attribute to <code id="unloading-documents:event-beforeunload"><a href="indices.html#event-beforeunload">beforeunload</a></code> and its <code id="unloading-documents:dom-event-cancelable"><a data-x-internal="dom-event-cancelable" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-cancelable">cancelable</a></code> attribute true.<li><p><i>Dispatch</i>: <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-dispatch" id="unloading-documents:concept-event-dispatch" data-x-internal="concept-event-dispatch">Dispatch</a> <var>event</var> at <var>document</var>'s <a id="unloading-documents:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a>.<li><p>Decrease the <a id="unloading-documents:event-loop-3" href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level" id="unloading-documents:termination-nesting-level-2">termination nesting level</a> by 1.<li><p>If all of the following are true:</p>

    <ul class="brief"><li><p><var>document</var>'s <a id="unloading-documents:active-sandboxing-flag-set" href="origin.html#active-sandboxing-flag-set">active sandboxing flag set</a> does not have its <a id="unloading-documents:sandboxed-modals-flag" href="origin.html#sandboxed-modals-flag">sandboxed modals flag</a> set<li><p><var>document</var>'s <a id="unloading-documents:concept-relevant-global-2" href="webappapis.html#concept-relevant-global">relevant global object</a> has <a id="unloading-documents:sticky-activation" href="interaction.html#sticky-activation">sticky activation</a><li><p><var>event</var>'s <a id="unloading-documents:canceled-flag" href="https://triple-underscore.github.io/DOM4-ja.html#canceled-flag" data-x-internal="canceled-flag">canceled flag</a> is set, or the <code id="unloading-documents:dom-beforeunloadevent-returnvalue"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute of <var>event</var> is not the empty string</ul>

    <p>then the user agent may ask the user to confirm that they wish to unload the document.</p>

    <p class="note">The message shown to the user is not customizable, but instead determined by the user agent. In particular, the actual value of the <code id="unloading-documents:dom-beforeunloadevent-returnvalue-2"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute is ignored.</p>

    <p>The user agent is encouraged to avoid asking the user for confirmation if it judges that doing so would be annoying, deceptive, or pointless.</p>

    <p>If the user agent asks the user for confirmation, it must <a id="unloading-documents:pause" href="webappapis.html#pause">pause</a> while waiting for the user's response.</p>

    <p>If the user did not confirm the page navigation, then the user agent <dfn id="refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</dfn>.</p>
   <li><p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id="unloading-documents:list-of-the-descendant-browsing-contexts" href="browsers.html#list-of-the-descendant-browsing-contexts">list of the descendant browsing contexts</a> of <var>document</var>.<li><p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href="#prompt-to-unload-a-document" id="unloading-documents:prompt-to-unload-a-document">Prompt to unload</a> <var>browsingContext</var>'s <a id="unloading-documents:active-document" href="browsers.html#active-document">active document</a> with the <var>recursiveFlag</var> set.<li><p>If the user <a href="#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded">refused to allow the document to be unloaded</a>, then the user implicitly also <a href="#refused-to-allow-the-document-to-be-unloaded" id="unloading-documents:refused-to-allow-the-document-to-be-unloaded-2">refused to allow <var>document</var> to be unloaded</a>; <a id="unloading-documents:break" href="https://triple-underscore.github.io/infra-ja.html#iteration-break" data-x-internal="break">break</a>.</ol>
     </ol>
   <li><p>Decrease the <var>document</var>'s <a id="unloading-documents:ignore-opens-during-unload-counter-2" href="dynamic-markup-insertion.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by 1.</ol>

  <p>To <dfn id="unload-a-document" data-lt="unload a document" data-export="">unload</dfn> a <code id="unloading-documents:document-3"><a href="dom.html#document">Document</a></code> <var>document</var>, optionally given a <var>recursiveFlag</var>:</p>

  <ol><li><p>Increase the <a id="unloading-documents:event-loop-4" href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level" id="unloading-documents:termination-nesting-level-3">termination nesting level</a> by one.<li><p>Increase <var>document</var>'s <a id="unloading-documents:ignore-opens-during-unload-counter-3" href="dynamic-markup-insertion.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by one.<li><p>If <var>document</var>'s <a href="#page-showing" id="unloading-documents:page-showing-2">page showing</a> flag is false, then jump to the step labeled <i>unload event</i> below (i.e. skip firing the <code id="unloading-documents:event-pagehide-3"><a href="indices.html#event-pagehide">pagehide</a></code> event and don't rerun the <a href="#unloading-document-visibility-change-steps" id="unloading-documents:unloading-document-visibility-change-steps">unloading document visibility change steps</a>).<li><p>Set <var>document</var>'s <a href="#page-showing" id="unloading-documents:page-showing-3">page showing</a> flag to false.<li><p>If the user agent does not intend to keep <var>document</var> alive in a <a id="unloading-documents:session-history-entry" href="history.html#session-history-entry">session history entry</a> (such that it can be reused later on <a href="#traverse-the-history" id="unloading-documents:traverse-the-history">history traversal</a>), set <var>document</var>'s <i id="unloading-documents:concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state to false.<li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="unloading-documents:concept-event-fire" data-x-internal="concept-event-fire">Fire an event</a> named <code id="unloading-documents:event-pagehide-4"><a href="indices.html#event-pagehide">pagehide</a></code> at <var>document</var>'s <a id="unloading-documents:concept-relevant-global-3" href="webappapis.html#concept-relevant-global">relevant global object</a>, using <code id="unloading-documents:pagetransitionevent"><a href="#pagetransitionevent">PageTransitionEvent</a></code>, with the <code id="unloading-documents:dom-pagetransitionevent-persisted"><a href="#dom-pagetransitionevent-persisted">persisted</a></code> attribute initialized to true if <var>document</var>'s <i id="unloading-documents:concept-document-salvageable-2"><a href="#concept-document-salvageable">salvageable</a></i> state is true, and false otherwise, and <var>legacy target override flag</var> set.<li><p>Run any <dfn id="unloading-document-visibility-change-steps">unloading document visibility change steps</dfn> for <var>document</var> that are defined by <a id="unloading-documents:other-applicable-specifications" href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.</p>

    <p class="note">This is specifically intended for use by <cite>Page Visibility</cite>. <a href="references.html#refsPAGEVIS">[PAGEVIS]</a></p>
   <li><p><i>Unload event</i>: If <var>document</var>'s <i id="unloading-documents:concept-document-salvageable-3"><a href="#concept-document-salvageable">salvageable</a></i> state is false, then <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="unloading-documents:concept-event-fire-2" data-x-internal="concept-event-fire">fire an event</a> named <code id="unloading-documents:event-unload"><a href="indices.html#event-unload">unload</a></code> at <var>document</var>'s <a id="unloading-documents:concept-relevant-global-4" href="webappapis.html#concept-relevant-global">relevant global object</a>, with <var>legacy target override flag</var> set.<li><p>Decrease the <a id="unloading-documents:event-loop-5" href="webappapis.html#event-loop">event loop</a>'s <a href="#termination-nesting-level" id="unloading-documents:termination-nesting-level-4">termination nesting level</a> by one.<li><p>Run any <a href="#unloading-document-cleanup-steps" id="unloading-documents:unloading-document-cleanup-steps">unloading document cleanup steps</a> for <var>document</var> that are defined by this specification and <a id="unloading-documents:other-applicable-specifications-2" href="infrastructure.html#other-applicable-specifications">other applicable specifications</a>.<li><p>If the <var>recursiveFlag</var> is not set, then:</p>

    <ol><li><p>Let <var>descendants</var> be the <a id="unloading-documents:list-of-the-descendant-browsing-contexts-2" href="browsers.html#list-of-the-descendant-browsing-contexts">list of the descendant browsing contexts</a> of <var>document</var>.<li><p>For each <var>browsingContext</var> in <var>descendants</var>:</p>

      <ol><li><p><a href="#unload-a-document" id="unloading-documents:unload-a-document">Unload</a> the <a id="unloading-documents:active-document-2" href="browsers.html#active-document">active document</a> of <var>browsingContext</var> with the <var>recursiveFlag</var> set.<li><p>If the <i id="unloading-documents:concept-document-salvageable-4"><a href="#concept-document-salvageable">salvageable</a></i> state of the <a id="unloading-documents:active-document-3" href="browsers.html#active-document">active document</a> of <var>browsingContext</var> is false, then set the <i id="unloading-documents:concept-document-salvageable-5"><a href="#concept-document-salvageable">salvageable</a></i> state of <var>document</var> to false also.</ol>
     <li><p>If <var>document</var>'s <i id="unloading-documents:concept-document-salvageable-6"><a href="#concept-document-salvageable">salvageable</a></i> state is false, then <a href="window-object.html#discard-a-document" id="unloading-documents:discard-a-document">discard</a><var>document</var>.</ol>
   <li><p>Decrease <var>document</var>'s <a id="unloading-documents:ignore-opens-during-unload-counter-4" href="dynamic-markup-insertion.html#ignore-opens-during-unload-counter">ignore-opens-during-unload counter</a> by one.</ol>

  <p>This specification defines the following <dfn id="unloading-document-cleanup-steps" data-export="">unloading document cleanup steps</dfn>. Other specifications can define more. Given a <code id="unloading-documents:document-4"><a href="dom.html#document">Document</a></code> <var>document</var>:</p>

  <ol><li><p><var>window</var>を<var>document</var>の<a id="unloading-documents:concept-relevant-global-5" href="webappapis.html#concept-relevant-global">関連するグローバルオブジェクト</a>にする。<li><p>For each <code id="unloading-documents:websocket"><a href="web-sockets.html#websocket">WebSocket</a></code> object <var>webSocket</var> whose <a id="unloading-documents:concept-relevant-global-6" href="webappapis.html#concept-relevant-global">relevant global object</a> is <var>window</var>, <a id="unloading-documents:make-disappear" href="web-sockets.html#make-disappear">make disappear</a> <var>webSocket</var>.</p>

    <p>If this affected any <code id="unloading-documents:websocket-2"><a href="web-sockets.html#websocket">WebSocket</a></code> objects, then set <var>document</var>'s <i id="unloading-documents:concept-document-salvageable-7"><a href="#concept-document-salvageable">salvageable</a></i> state to false.</p>
   <li><p>If <var>document</var>'s <i id="unloading-documents:concept-document-salvageable-8"><a href="#concept-document-salvageable">salvageable</a></i> state is false, then:</p>

    <ol><li><p>For each <code id="unloading-documents:eventsource"><a href="server-sent-events.html#eventsource">EventSource</a></code> object <var>eventSource</var> whose <a id="unloading-documents:concept-relevant-global-7" href="webappapis.html#concept-relevant-global">relevant global object</a> is equal to <var>window</var>, <a href="server-sent-events.html#concept-eventsource-forcibly-close" id="unloading-documents:concept-eventsource-forcibly-close">forcibly close</a> <var>eventSource</var>.<li><p>Empty <var>window</var>'s <a id="unloading-documents:list-of-active-timers" href="timers-and-user-prompts.html#list-of-active-timers">list of active timers</a>.</ol>
   </ol>

  



  <h5 id="the-beforeunloadevent-interface"><span class="secno">7.10.12.1</span> <code id="the-beforeunloadevent-interface:beforeunloadevent"><a href="#beforeunloadevent">BeforeUnloadEvent</a></code>インターフェイス<a href="#the-beforeunloadevent-interface" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BeforeUnloadEvent" title="The beforeunload event is fired when the window, the document and its resources are about to be unloaded.">BeforeUnloadEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>30+</span></span><hr><span class="opera yes"><span>Opera</span><span>17+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>30+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>3.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>18+</span></span></div></div></div>

  <pre><code class='idl'>[<c- g>Exposed</c->=<c- n>Window</c->]
<c- b>interface</c-> <dfn id='beforeunloadevent'><c- g>BeforeUnloadEvent</c-></dfn> : <a id='the-beforeunloadevent-interface:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-beforeunloadevent-returnvalue' id='the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue'><c- g>returnValue</c-></a>;
};</code></pre>

  <p class="note"><code id="the-beforeunloadevent-interface:beforeunloadevent-2"><a href="#beforeunloadevent">BeforeUnloadEvent</a></code>固有の初期化メソッドは存在しない。</p>

  <p><code id="the-beforeunloadevent-interface:beforeunloadevent-3"><a href="#beforeunloadevent">BeforeUnloadEvent</a></code>インターフェイスは、イベントをキャンセルするだけでなく、<code id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-2"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code>属性を空文字列以外の値に設定することで、<a href="#prompt-to-unload-a-document" id="the-beforeunloadevent-interface:prompt-to-unload-a-document">アンロードのプロンプト</a>を制御できるようにするレガシーインターフェイスである。 著者は、<code id="the-beforeunloadevent-interface:dom-beforeunloadevent-returnvalue-3"><a href="#dom-beforeunloadevent-returnvalue">returnValue</a></code>を使用する代わりに、<code id="the-beforeunloadevent-interface:dom-event-preventdefault"><a data-x-internal="dom-event-preventdefault" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-preventdefault">preventDefault()</a></code>メソッド、またはイベントをキャンセルするその他の手段を使用すべきである。</p>

  

  <p>The <dfn id="dom-beforeunloadevent-returnvalue"><code>returnValue</code></dfn> attribute controls the process of <a href="#prompt-to-unload-a-document" id="the-beforeunloadevent-interface:prompt-to-unload-a-document-2">prompting to unload</a>. When the event is created, the attribute must be set to the empty string. On getting, it must return the last value it was set to. On setting, the attribute must be set to the new value.</p>

  <p class="note">This attribute is a <code>DOMString</code> only for historical reasons. Any value besides the empty string will be treated as a request to ask the user for confirmation.</p>

  


  

  <h4 id="aborting-a-document-load"><span class="secno">7.10.13</span> Aborting a document load<a href="#aborting-a-document-load" class="self-link"></a></h4>

  <p>To <dfn id="abort-a-document">abort</dfn> a <code id="aborting-a-document-load:document"><a href="dom.html#document">Document</a></code> <var>document</var>:</p>

  <ol><li><p><a href="#abort-a-document" id="aborting-a-document-load:abort-a-document">Abort</a> the <a href="browsers.html#active-document" id="aborting-a-document-load:active-document">active documents</a> of every <a id="aborting-a-document-load:child-browsing-context" href="browsers.html#child-browsing-context">child browsing context</a>. If this results in any of those <code id="aborting-a-document-load:document-2"><a href="dom.html#document">Document</a></code> objects having their <i id="aborting-a-document-load:concept-document-salvageable"><a href="#concept-document-salvageable">salvageable</a></i> state set to false, then set <var>document</var>'s <i id="aborting-a-document-load:concept-document-salvageable-2"><a href="#concept-document-salvageable">salvageable</a></i> state to false also.<li><p>Cancel any instances of the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="aborting-a-document-load:concept-fetch" data-x-internal="concept-fetch">fetch</a> algorithm in the context of <var>document</var>, discarding any <a href="webappapis.html#concept-task" id="aborting-a-document-load:concept-task">tasks</a> <a href="webappapis.html#queue-a-task" id="aborting-a-document-load:queue-a-task">queued</a> for them, and discarding any further data received from the network for them. If this resulted in any instances of the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="aborting-a-document-load:concept-fetch-2" data-x-internal="concept-fetch">fetch</a> algorithm being canceled or any <a href="webappapis.html#queue-a-task" id="aborting-a-document-load:queue-a-task-2">queued</a> <a href="webappapis.html#concept-task" id="aborting-a-document-load:concept-task-2">tasks</a> or any network data getting discarded, then set <var>document</var>'s <i id="aborting-a-document-load:concept-document-salvageable-3"><a href="#concept-document-salvageable">salvageable</a></i> state to false.<li><p>If <var>document</var> has an <a id="aborting-a-document-load:active-parser" href="dom.html#active-parser">active parser</a>, then:</p>

    <ol><li><p>Set <var>document</var>'s <a id="aborting-a-document-load:active-parser-was-aborted" href="dynamic-markup-insertion.html#active-parser-was-aborted">active parser was aborted</a> to true.<li><p><a href="parsing.html#abort-a-parser" id="aborting-a-document-load:abort-a-parser">Abort that parser</a>.<li><p>Set <var>document</var>'s <i id="aborting-a-document-load:concept-document-salvageable-4"><a href="#concept-document-salvageable">salvageable</a></i> state to false.</ol>
   </ol>

  <p>User agents may allow users to explicitly invoke the <a href="#abort-a-document" id="aborting-a-document-load:abort-a-document-2">abort a document</a> algorithm for a <code id="aborting-a-document-load:document-3"><a href="dom.html#document">Document</a></code>. If the user does so, then, if that <code id="aborting-a-document-load:document-4"><a href="dom.html#document">Document</a></code> is an <a id="aborting-a-document-load:active-document-2" href="browsers.html#active-document">active document</a>, the user agent should <a id="aborting-a-document-load:queue-a-task-3" href="webappapis.html#queue-a-task">queue a task</a> to <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="aborting-a-document-load:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="aborting-a-document-load:event-abort"><a href="indices.html#event-abort">abort</a></code> at that <code id="aborting-a-document-load:document-5"><a href="dom.html#document">Document</a></code> object's <a id="aborting-a-document-load:concept-relevant-global" href="webappapis.html#concept-relevant-global">relevant global object</a> before invoking the <a href="#abort-a-document" id="aborting-a-document-load:abort-a-document-3">abort</a> algorithm.</p>

  

  <p>To <dfn id="stop-document-loading">stop document loading</dfn> given a <code id="aborting-a-document-load:document-6"><a href="dom.html#document">Document</a></code> object <var>document</var>, run these steps:</p>

  <ol><li><p>If <var>document</var> is not an <a id="aborting-a-document-load:active-document-3" href="browsers.html#active-document">active document</a>, then return.<li><p>Let <var>browsingContext</var> be <var>document</var>'s <a href="browsers.html#concept-document-bc" id="aborting-a-document-load:concept-document-bc">browsing context</a>.<li><p>If there is an existing attempt to <a href="#navigate" id="aborting-a-document-load:navigate">navigate</a> <var>browsingContext</var> and that attempt is not currently running the <a href="#unload-a-document" id="aborting-a-document-load:unload-a-document">unload a document</a> algorithm, then cancel that <a href="#navigate" id="aborting-a-document-load:navigate-2">navigation</a>.<li><p><a href="#abort-a-document" id="aborting-a-document-load:abort-a-document-4">Abort</a> <var>document</var>.</ol>

  

  <h4 id="the-x-frame-options-header"><span class="secno">7.10.14</span> `<code id="the-x-frame-options-header:x-frame-options"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>`ヘッダー<a href="#the-x-frame-options-header" class="self-link"></a></h4>

  <p> `<code id="the-x-frame-options-header:x-frame-options-2"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>` HTTP レスポンスヘッダーは、<a id="the-x-frame-options-header:child-browsing-context" href="browsers.html#child-browsing-context">子ブラウジングコンテキスト</a>内で<code id="the-x-frame-options-header:document"><a href="dom.html#document">Document</a></code>をロードしてもよいかどうか、およびどのようにロードするかを制御するためのレガシーな方法である。それは同じ状況をより細かく制御できる<code id="the-x-frame-options-header:frame-ancestors-directive"><a data-x-internal="frame-ancestors-directive" href="https://triple-underscore.github.io/CSP3-ja.html#frame-ancestors">frame-ancestors</a></code> CSPディレクティブによって廃止された。 もともとは<cite>HTTPヘッダーフィールドX-Frame-Options</cite>で定義されていたが、ここでの定義はその文書に取って代わる。<a href="references.html#refsCSP">[CSP]</a> <a href="references.html#refsRFC7034">[RFC7034]</a><p class="note">特に、<cite>HTTPヘッダーフィールドX-Frame-Options</cite>はヘッダーの`<code>ALLOW-FROM</code>`バリアントを指定したが、これは実装されない。</p>

  <p class="note">以下の処理モデルに従って、<code id="the-x-frame-options-header:frame-ancestors-directive-2"><a data-x-internal="frame-ancestors-directive" href="https://triple-underscore.github.io/CSP3-ja.html#frame-ancestors">frame-ancestors</a></code>ディレクティブと`<code id="the-x-frame-options-header:x-frame-options-3"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>`ヘッダーの両方が同じ<a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-x-frame-options-header:concept-response" data-x-internal="concept-response">レスポンス</a>で使用される場合、`<code id="the-x-frame-options-header:x-frame-options-4"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>`は無視される。</p>

  <p>ウェブ開発者および適合性チェッカーにとって、その値の<a href="https://fetch.spec.whatwg.org/#abnf" id="the-x-frame-options-header:header-abnf" data-x-internal="header-abnf">ABNF</a>は次のとおりである：</p>

  <pre><code class='abnf'><c- nc>X-Frame-Options</c-> <c- o>=</c-> <c- l>"DENY"</c-> <c- o>/</c-> <c- l>"SAMEORIGIN"</c-></code></pre>

  

  <p>To <dfn id="check-a-navigation-response's-adherence-to-x-frame-options">check a navigation response's adherence to `<code>X-Frame-Options</code>`</dfn>, given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-x-frame-options-header:concept-response-2" data-x-internal="concept-response">response</a> <var>response</var>, a <a id="the-x-frame-options-header:browsing-context" href="browsers.html#browsing-context">browsing context</a> <var>browsingContext</var>, and an <a id="the-x-frame-options-header:concept-origin" href="origin.html#concept-origin">origin</a> <var>destinationOrigin</var>:</p>

  <ol><li><p>If <var>browsingContext</var> is not a <a id="the-x-frame-options-header:child-browsing-context-2" href="browsers.html#child-browsing-context">child browsing context</a>, then return true.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="the-x-frame-options-header:list-iterate" data-x-internal="list-iterate">For each</a> <var>policy</var> of <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-csp-list" id="the-x-frame-options-header:concept-response-csp-list" data-x-internal="concept-response-csp-list">CSP list</a>:</p>

    <ol><li><p>If <var>policy</var>'s <a href="https://triple-underscore.github.io/CSP3-ja.html#policy-disposition" id="the-x-frame-options-header:csp-disposition" data-x-internal="csp-disposition">disposition</a> is not "<code>enforce</code>", then <a id="the-x-frame-options-header:continue" href="https://triple-underscore.github.io/infra-ja.html#iteration-continue" data-x-internal="continue">continue</a>.<li><p>If <var>policy</var>'s <a href="https://triple-underscore.github.io/CSP3-ja.html#policy-directive-set" id="the-x-frame-options-header:csp-directive-set" data-x-internal="csp-directive-set">directive set</a> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="the-x-frame-options-header:list-contains" data-x-internal="list-contains">contains</a> a <code id="the-x-frame-options-header:frame-ancestors-directive-3"><a data-x-internal="frame-ancestors-directive" href="https://triple-underscore.github.io/CSP3-ja.html#frame-ancestors">frame-ancestors</a></code> directive, then return true.</ol>
   <li><p>Let <var>rawXFrameOptions</var> be the result of <a href="https://fetch.spec.whatwg.org/#concept-header-list-get-decode-split" id="the-x-frame-options-header:concept-header-list-get-decode-split" data-x-internal="concept-header-list-get-decode-split">getting, decoding, and splitting</a> `<code id="the-x-frame-options-header:x-frame-options-5"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>` from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-x-frame-options-header:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a>.<li><p>Let <var>xFrameOptions</var> be a new <a id="the-x-frame-options-header:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="the-x-frame-options-header:list-iterate-2" data-x-internal="list-iterate">For each</a> <var>value</var> of <var>rawXFrameOptions</var>, <a href="https://triple-underscore.github.io/infra-ja.html#set-append" id="the-x-frame-options-header:set-append" data-x-internal="set-append">append</a> <var>value</var>, <a id="the-x-frame-options-header:converted-to-ascii-lowercase" href="https://triple-underscore.github.io/infra-ja.html#ascii-lowercase" data-x-internal="converted-to-ascii-lowercase">converted to ASCII lowercase</a>, to <var>xFrameOptions</var>.<li><p>If <var>xFrameOptions</var>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="the-x-frame-options-header:list-size" data-x-internal="list-size">size</a> is greater than 1, and <var>xFrameOptions</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="the-x-frame-options-header:list-contains-2" data-x-internal="list-contains">contains</a> any of "<code>deny</code>", "<code>allowall</code>", or "<code>sameorigin</code>", then return false.</p>

    <p class="note">The intention here is to block any attempts at applying `<code id="the-x-frame-options-header:x-frame-options-6"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>` which were trying to do something valid, but appear confused.</p>

    <p class="note">This is the only impact of the legacy `<code>ALLOWALL</code>` value on the processing model.</p>
   <li><p>If <var>xFrameOptions</var>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="the-x-frame-options-header:list-size-2" data-x-internal="list-size">size</a> is greater than 1, then return true.</p>

    <p class="note">This means it contains multiple invalid values, which we treat the same way as if the header was omitted entirely.</p>
   <li><p>If <var>xFrameOptions</var>[0] is "<code>deny</code>", then return false.<li><p>If <var>xFrameOptions</var>[0] is "<code>sameorigin</code>", then:</p>

    <ol><li><p>Let <var>containerDocument</var> be <var>browsingContext</var>'s <a href="browsers.html#bc-container-document" id="the-x-frame-options-header:bc-container-document">container document</a>.<li><p><a id="the-x-frame-options-header:while" href="https://triple-underscore.github.io/infra-ja.html#iteration-while" data-x-internal="while">While</a> <var>containerDocument</var> is not null:</p>

      <ol><li><p>If <var>containerDocument</var>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="the-x-frame-options-header:concept-document-origin" data-x-internal="concept-document-origin">origin</a> is not <a id="the-x-frame-options-header:same-origin" href="origin.html#same-origin">same origin</a> with <var>destinationOrigin</var>, then return false.<li><p>Let <var>containerBC</var> be <var>containerDocument</var>'s <a href="browsers.html#concept-document-bc" id="the-x-frame-options-header:concept-document-bc">browsing context</a>.</p>

       <li><p>Set <var>containerDocument</var> to <var>containerBC</var>'s <a href="browsers.html#bc-container-document" id="the-x-frame-options-header:bc-container-document-2">container document</a>, if <var>containerBC</var> is non-null; otherwise, null.</ol>
     </ol>
   <li><p>Return true.</p>

    <p class="note">If we've reached this point then we have a lone invalid value (which could potentially be one the legacy `<code>ALLOWALL</code>` or `<code>ALLOW-FROM</code>` forms). These are treated as if the header were omitted entirely.</p>
   </ol>

  <hr>

  

  <div class="example"><p>次の表は、不適合の値を含む、ヘッダーのさまざまな値の処理を示す：</p>

   <table class="data"><thead><tr><th>`<code id="the-x-frame-options-header:x-frame-options-7"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>`<th>妥当<th>結果<tbody><tr><td>`<code>DENY</code>`<td>✅<td>埋め込みを禁止<tr><td>`<code>SAMEORIGIN</code>`<td>✅<td>同一生成元の埋め込みを許可<tr><td>`<code>INVALID</code>`<td>❌<td>埋め込みを許可<tr><td>`<code>ALLOWALL</code>`<td>❌<td>埋め込みを許可<tr><td>`<code>ALLOW-FROM=https://example.com/</code>`<td>❌<td>埋め込みを許可（どこからでも）</table>
  </div>

  <div class="example"><p>次の表は、複数の値が関係するさまざまな不適合のケースがどのように処理されるかを示す：</p>

   <table class="data"><thead><tr><th>`<code id="the-x-frame-options-header:x-frame-options-8"><a href="iana.html#x-frame-options">X-Frame-Options</a></code>`<th>結果<tbody><tr><td>`<code>SAMEORIGIN, SAMEORIGIN</code>`<td>同一生成元の埋め込みを許可<tr><td>`<code>SAMEORIGIN, DENY</code>`<td>埋め込みを禁止<tr><td>`<code>SAMEORIGIN,</code>`<td>埋め込みを禁止<tr><td>`<code>SAMEORIGIN, ALLOWALL</code>`<td>埋め込みを禁止<tr><td>`<code>SAMEORIGIN, INVALID</code>`<td>埋め込みを禁止<tr><td>`<code>ALLOWALL, INVALID</code>`<td>埋め込みを禁止<tr><td>`<code>ALLOWALL,</code>`<td>埋め込みを禁止<tr><td>`<code>INVALID, INVALID</code>`<td>埋め込みを許可</table>

   <p>値がカンマ区切りの単一ヘッダーで配信されるか、複数のヘッダーで配信されるかにかかわらず、同じ結果が得られる。</p>
  </div>



  <nav><a href="history.html">← 7.9 セッション履歴およびナビゲーション</a> — <a href="./">目次</a> — <a href="webappapis.html">8 ウェブアプリケーションAPI →</a></nav>

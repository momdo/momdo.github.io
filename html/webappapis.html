<!DOCTYPE html><html class=split lang=ja>
<script src=/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport>
<title>HTML Standard 日本語訳</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/standard.css><link rel=icon href=https://resources.whatwg.org/logo.svg>
<script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script>
<style>
   .status { min-height: 0.6em; font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status:hover { z-index: 9; }
   .status:focus-within { z-index: 9; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; left: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > p > strong { margin-left: 1.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span.no::before { opacity: 0.5; }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .edge::before { background-image: url(https://resources.whatwg.org/browser-logos/edge.svg); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mini.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .support > .samsung::before { background-image: url(https://resources.whatwg.org/browser-logos/samsung.png); }
   .status > .caniuse { text-align: right; font-style: italic; width: 100%; }
   .status > .caniuse + p { margin-top: 0.5em; border-top: 1px solid silver; }

   @media (max-width: 767px) {
     .status { right: -9em; }
   }
  </style>
<style>
   [hidden] { display: none; }

   .bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   .parse-error-table td > p:first-child { margin-top: 0; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style>
<body>
  
  <script async="" src=/html-dfn.js></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new src=https://resources.whatwg.org/file-issue.js async=""></script>
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>9 February 2018</span></h2></hgroup>
   
   

   
  </header>

  

  
  

  
  

  

  <nav><a href=offline.html>← 7.9 Offline Web applications</a> — <a href=./>Table of Contents</a> — <a href=dynamic-markup-insertion.html>8.4 Dynamic markup insertion →</a></nav><ol class=toc><li id=toc-webappapis><a href=webappapis.html#webappapis><span class=secno>8</span> ウェブアプリケーションAPI</a><ol><li><a href=webappapis.html#scripting><span class=secno>8.1</span> スクリプティング</a><ol><li><a href=webappapis.html#introduction-11><span class=secno>8.1.1</span> 導入</a></li><li><a href=webappapis.html#enabling-and-disabling-scripting><span class=secno>8.1.2</span> Enabling and disabling scripting</a></li><li><a href=webappapis.html#scripting-processing-model><span class=secno>8.1.3</span> Processing model</a><ol><li><a href=webappapis.html#definitions-2><span class=secno>8.1.3.1</span> Definitions</a></li><li><a href=webappapis.html#fetching-scripts><span class=secno>8.1.3.2</span> Fetching scripts</a></li><li><a href=webappapis.html#creating-scripts><span class=secno>8.1.3.3</span> Creating scripts</a></li><li><a href=webappapis.html#calling-scripts><span class=secno>8.1.3.4</span> Calling scripts</a></li><li><a href=webappapis.html#realms-settings-objects-global-objects><span class=secno>8.1.3.5</span> Realms, settings objects, and global objects</a><ol><li><a href=webappapis.html#entry><span class=secno>8.1.3.5.1</span> Entry</a></li><li><a href=webappapis.html#incumbent><span class=secno>8.1.3.5.2</span> Incumbent</a></li><li><a href=webappapis.html#current><span class=secno>8.1.3.5.3</span> Current</a></li><li><a href=webappapis.html#relevant><span class=secno>8.1.3.5.4</span> Relevant</a></li></ol></li><li><a href=webappapis.html#killing-scripts><span class=secno>8.1.3.6</span> Killing scripts</a></li><li><a href=webappapis.html#integration-with-the-javascript-job-queue><span class=secno>8.1.3.7</span> Integration with the JavaScript job queue</a><ol><li><a href=webappapis.html#enqueuejob(queuename,-job,-arguments)><span class=secno>8.1.3.7.1</span> EnqueueJob(<var>queueName</var>, <var>job</var>, <var>arguments</var>)</a></li></ol></li><li><a href=webappapis.html#integration-with-the-javascript-module-system><span class=secno>8.1.3.8</span> Integration with the JavaScript module system</a><ol><li><a href=webappapis.html#hostresolveimportedmodule(referencingscriptormodule,-specifier)><span class=secno>8.1.3.8.1</span> HostResolveImportedModule(<var>referencingScriptOrModule</var>,
  <var>specifier</var>)</a></li><li><a href=webappapis.html#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)><span class=secno>8.1.3.8.2</span> HostImportModuleDynamically(<var>referencingScriptOrModule</var>,
  <var>specifier</var>, <var>promiseCapability</var>)</a></li><li><a href=webappapis.html#hostgetimportmetaproperties><span class=secno>8.1.3.8.3</span> HostGetImportMetaProperties(<var>moduleRecord</var>)</a></li></ol></li><li><a href=webappapis.html#integration-with-the-javascript-agent-formalism><span class=secno>8.1.3.9</span> Integration with the JavaScript agent formalism</a></li><li><a href=webappapis.html#integration-with-the-javascript-agent-cluster-formalism><span class=secno>8.1.3.10</span> Integration with the JavaScript agent cluster formalism</a></li><li><a href=webappapis.html#runtime-script-errors><span class=secno>8.1.3.11</span> ランタイムスクリプトエラー</a><ol><li><a href=webappapis.html#runtime-script-errors-in-documents><span class=secno>8.1.3.11.1</span> Runtime script errors in documents</a></li><li><a href=webappapis.html#the-errorevent-interface><span class=secno>8.1.3.11.2</span> The <code>ErrorEvent</code> interface</a></li></ol></li><li><a href=webappapis.html#unhandled-promise-rejections><span class=secno>8.1.3.12</span> Unhandled promise rejections</a><ol><li><a href=webappapis.html#the-hostpromiserejectiontracker-implementation><span class=secno>8.1.3.12.1</span> HostPromiseRejectionTracker(<var>promise</var>, <var>operation</var>)</a></li><li><a href=webappapis.html#the-promiserejectionevent-interface><span class=secno>8.1.3.12.2</span> <code>PromiseRejectionEvent</code>インターフェイス</a></li></ol></li><li><a href=webappapis.html#hostensurecancompilestrings(callerrealm,-calleerealm)><span class=secno>8.1.3.13</span> HostEnsureCanCompileStrings(<var>callerRealm</var>, <var>calleeRealm</var>)</a></li></ol></li><li><a href=webappapis.html#event-loops><span class=secno>8.1.4</span> Event loops</a><ol><li><a href=webappapis.html#definitions-3><span class=secno>8.1.4.1</span> Definitions</a></li><li><a href=webappapis.html#event-loop-processing-model><span class=secno>8.1.4.2</span> Processing model</a></li><li><a href=webappapis.html#generic-task-sources><span class=secno>8.1.4.3</span> Generic task sources</a></li><li><a href=webappapis.html#event-loop-for-spec-authors><span class=secno>8.1.4.4</span> Dealing with the event loop from other specifications</a></li></ol></li><li><a href=webappapis.html#events><span class=secno>8.1.5</span> イベント</a><ol><li><a href=webappapis.html#event-handler-attributes><span class=secno>8.1.5.1</span> イベントハンドラー</a></li><li><a href=webappapis.html#event-handlers-on-elements,-document-objects,-and-window-objects><span class=secno>8.1.5.2</span> 要素のイベントハンドラー、<code>Document</code>オブジェクト、および<code>Window</code>オブジェクト</a><ol><li><a href=webappapis.html#idl-definitions><span class=secno>8.1.5.2.1</span> IDL定義</a></li></ol></li><li><a href=webappapis.html#event-firing><span class=secno>8.1.5.3</span> Event firing</a></li></ol></li></ol></li><li><a href=webappapis.html#windoworworkerglobalscope-mixin><span class=secno>8.2</span> The <code>WindowOrWorkerGlobalScope</code> mixin</a></li><li><a href=webappapis.html#atob><span class=secno>8.3</span> Base64ユーティリティーメソッド</a></li></ol></li></ol><h2 id=webappapis><span class=secno>8</span> ウェブアプリケーションAPI<a href=#webappapis class=self-link></a></h2>

  <h3 id=scripting><span class=secno>8.1</span> スクリプティング<a href=#scripting class=self-link></a></h3>

  <h4 id=introduction-11><span class=secno>8.1.1</span> 導入<a href=#introduction-11 class=self-link></a></h4>

  <p>様々なメカニズムが文書のコンテキストで実行するよう著者が提供する実行可能コードを引き起こすかもしれない。これらのメカニズムは以下を含むが、おそらく以下に限定されない：</p>

  <ul><li><code id=introduction-11:the-script-element><a href=scripting.html#the-script-element>script</a></code>要素の処理。</li><li><a href=browsing-the-web.html#javascript-protocol id=introduction-11:javascript-protocol><code>javascript:</code> URL</a>をナビゲートする。</li><li><code>addEventListener()</code>を使用するDOMを介して、明示的な<a href=#event-handler-content-attributes id=introduction-11:event-handler-content-attributes>イベントハンドラーコンテンツ属性</a>によって、<a href=#event-handler-idl-attributes id=introduction-11:event-handler-idl-attributes>イベントハンドラーIDL属性</a>によって、またはそれ以外で、登録されるかどうかのイベントハンドラー。</li><li>独自のスクリプト機能を持つSVGのような技術の処理。</li></ul>


  

  <h4 id=enabling-and-disabling-scripting><span class=secno>8.1.2</span> Enabling and disabling scripting<a href=#enabling-and-disabling-scripting class=self-link></a></h4>

  <p><dfn id=concept-bc-script>Scripting is enabled</dfn> in a <em><a id=enabling-and-disabling-scripting:browsing-context href=browsers.html#browsing-context>browsing
  context</a></em> when all of the following conditions are true:</p>

  <ul><li>The user agent supports scripting.</li><li>The user has not disabled scripting for this <a id=enabling-and-disabling-scripting:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> at this time.
   (User agents may provide users with the option to disable scripting globally, or in a
   finer-grained manner, e.g. on a per-origin basis.)
   
   <a id=enabling-and-disabling-scripting:fingerprinting-vector title="There is a potential fingerprinting vector here." href=introduction.html#fingerprinting-vector class=fingerprint><img alt="(This is a fingerprinting vector.)" src=https://html.spec.whatwg.org/images/fingerprint.png width=46 height=64></a>
   </li><li id=sandboxScriptBlocked>The <a id=enabling-and-disabling-scripting:browsing-context-3 href=browsers.html#browsing-context>browsing context</a>'s <a id=enabling-and-disabling-scripting:active-document href=browsers.html#active-document>active document</a>'s
   <a id=enabling-and-disabling-scripting:active-sandboxing-flag-set href=origin.html#active-sandboxing-flag-set>active sandboxing flag set</a> does not have its <a id=enabling-and-disabling-scripting:sandboxed-scripts-browsing-context-flag href=origin.html#sandboxed-scripts-browsing-context-flag>sandboxed scripts browsing
   context flag</a> set.</li></ul>

  <p><dfn id=concept-bc-noscript>Scripting is disabled</dfn> in a <a id=enabling-and-disabling-scripting:browsing-context-4 href=browsers.html#browsing-context>browsing context</a>
  when any of the above conditions are false (i.e. when scripting is not <a href=#concept-bc-script id=enabling-and-disabling-scripting:concept-bc-script>enabled</a>).</p>

  <hr>

  <p><dfn id=concept-n-script>Scripting is enabled</dfn> for a <em>node</em> if the node's
  <a id=enabling-and-disabling-scripting:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a> has a <a href=browsers.html#concept-document-bc id=enabling-and-disabling-scripting:concept-document-bc>browsing context</a>, and
  <a href=#concept-bc-script id=enabling-and-disabling-scripting:concept-bc-script-2>scripting is enabled</a> in that <a id=enabling-and-disabling-scripting:browsing-context-5 href=browsers.html#browsing-context>browsing
  context</a>.</p>

  <p><dfn id=concept-n-noscript>Scripting is disabled</dfn> for a node if there is no such
  <a id=enabling-and-disabling-scripting:browsing-context-6 href=browsers.html#browsing-context>browsing context</a>, or if <a href=#concept-bc-noscript id=enabling-and-disabling-scripting:concept-bc-noscript>scripting is
  disabled</a> in that <a id=enabling-and-disabling-scripting:browsing-context-7 href=browsers.html#browsing-context>browsing context</a>.</p>

  


  

  
  <h4 id=scripting-processing-model><span class=secno>8.1.3</span> <span id=processing-model-7></span>Processing model<a href=#scripting-processing-model class=self-link></a></h4>

  <h5 id=definitions-2><span class=secno>8.1.3.1</span> Definitions<a href=#definitions-2 class=self-link></a></h5>

  <p>A <dfn id=concept-script data-export="">script</dfn> is one of two possible <a href=https://triple-underscore.github.io/infra-ja.html#struct id=definitions-2:struct data-x-internal=struct>structs</a>. All scripts have:</p>

  <dl><dt>A <dfn data-dfn-for=script id=settings-object data-export="">settings object</dfn><dd><p>An <a href=#environment-settings-object id=definitions-2:environment-settings-object>environment settings object</a>, containing various settings that are shared
   with other <a href=#concept-script id=definitions-2:concept-script>scripts</a> in the same context.<dt>A <dfn data-dfn-for=script id=concept-script-record data-export="">record</dfn><dd><p>Either a <a id=definitions-2:script-record href=https://tc39.github.io/ecma262/#sec-script-records data-x-internal=script-record>Script Record</a>, for <a href=#classic-script id=definitions-2:classic-script>classic
   scripts</a>; a <a id=definitions-2:source-text-module-record href=https://tc39.github.io/ecma262/#sec-source-text-module-records data-x-internal=source-text-module-record>Source Text Module Record</a>, for <a href=#module-script id=definitions-2:module-script>module scripts</a>; or null. In the former two cases, it represents a parsed script;
   null represents a failure parsing.<dt>A <dfn data-dfn-for=script id=concept-script-parse-error data-export="">parse
   error</dfn><dd><p>A JavaScript value, which has meaning only if the <a href=#concept-script-record id=definitions-2:concept-script-record>record</a> is null, indicating that the corresponding script
   source text could not be parsed.<dt>An <dfn data-dfn-for=script id=concept-script-error-to-rethrow data-export="">error
   to rethrow</dfn><dd>
    <p>A JavaScript value representing an error that will prevent evaluation from succeeding. It
    will be re-thrown by any attempts to <a href=#calling-scripts>run</a> the script.</p>

    <p class=note>Since this exception value is provided by the JavaScript specification, we know
    that it is never null, so we use null to signal that no error has occurred.</p>
   <dt><dfn data-dfn-for=script id=concept-script-script-fetch-options data-export="">Fetch options</dfn><dd>A <a href=#script-fetch-options id=definitions-2:script-fetch-options>script fetch options</a>, containing various options related to fetching this
   script or <a href=#module-script id=definitions-2:module-script-2>module scripts</a> that it imports.<dt>A <dfn data-dfn-for=script id=concept-script-base-url data-export="">base
   URL</dfn><dd><p>A base <a id=definitions-2:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> used for <a href=#resolve-a-module-specifier id=definitions-2:resolve-a-module-specifier>resolving
   module specifiers</a>. This will either be the URL from which the script was obtained, for
   external scripts, or the <a id=definitions-2:document-base-url href=urls-and-fetching.html#document-base-url>document base URL</a> of the containing document, for inline
   scripts.</dl>


  <p>A <dfn id=classic-script data-export="">classic script</dfn> is a type of <a href=#concept-script id=definitions-2:concept-script-2>script</a> that has the following additional <a href=https://infra.spec.whatwg.org/#struct-item id=definitions-2:struct-item data-x-internal=struct-item>item</a>:</p>

  <dl><dt>A <dfn id=muted-errors>muted errors</dfn> boolean<dd><p>A boolean which, if true, means that error information will not be provided for errors in
   this script. This is used to mute errors for cross-origin scripts, since that can leak private
   information.</dl>

  <p>A <dfn id=module-script data-export="">module script</dfn> is another type of <a href=#concept-script id=definitions-2:concept-script-3>script</a>. It has no additional <a href=https://infra.spec.whatwg.org/#struct-item id=definitions-2:struct-item-2 data-x-internal=struct-item>items</a>.</p>

  <p>The <dfn id=active-script>active script</dfn> is determined by the following algorithm:</p>

  <ol><li><p>Let <var>record</var> be <a id=definitions-2:getactivescriptormodule href=https://tc39.github.io/ecma262/#sec-getactivescriptormodule data-x-internal=getactivescriptormodule>GetActiveScriptOrModule</a>().</li><li><p>If <var>record</var> is null, return null.</li><li><p>Return <var>record</var>.[[HostDefined]].</li></ol>

  <hr>

  <p>An <dfn id=environment data-export="">environment</dfn> is an object that identifies the settings of a
  current or potential execution environment. An <a href=#environment id=definitions-2:environment>environment</a> has the following
  fields:</p>

  <dl><dt>An <dfn data-dfn-for=environment id=concept-environment-id data-export="">id</dfn><dd><p>An opaque string that uniquely identifies the <a href=#environment id=definitions-2:environment-2>environment</a>.<dt>A <dfn data-dfn-for=environment id=concept-environment-creation-url data-export="">creation URL</dfn><dd>
    <p>A <a id=definitions-2:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> that represents the location of the resource with which the
    <a href=#environment id=definitions-2:environment-3>environment</a> is associated.</p>

    <p class=note>In the case of an <a href=#environment-settings-object id=definitions-2:environment-settings-object-2>environment settings object</a>, this URL might be
    distinct from the <a href=#environment-settings-object id=definitions-2:environment-settings-object-3>environment settings object</a>'s <a href=#responsible-document id=definitions-2:responsible-document>responsible
    document</a>'s <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="definitions-2:the-document's-address" data-x-internal="the-document's-address">URL</a>, due to mechanisms such as
    <code id=definitions-2:dom-history-pushstate><a href=history.html#dom-history-pushstate>history.pushState()</a></code>.</p>
   <dt>A <dfn data-dfn-for=environment id=concept-environment-target-browsing-context data-export="">target browsing context</dfn><dd><p>Null or a target <a id=definitions-2:browsing-context href=browsers.html#browsing-context>browsing context</a> for a <a href=https://fetch.spec.whatwg.org/#navigation-request id=definitions-2:navigation-request data-x-internal=navigation-request>navigation request</a>.<dt>An <dfn data-dfn-for=environment id=concept-environment-active-service-worker data-export="">active service worker</dfn><dd><p>Null or a <a href=https://w3c.github.io/ServiceWorker/#dfn-service-worker id=definitions-2:dfn-service-worker data-x-internal=dfn-service-worker>service worker</a> that <a href=https://w3c.github.io/ServiceWorker/#dfn-control id=definitions-2:dfn-control data-x-internal=dfn-control>controls</a> the <a href=#environment id=definitions-2:environment-4>environment</a>.<dt>An <dfn data-dfn-for=environment id=concept-environment-execution-ready-flag data-export="">execution ready flag</dfn><dd><p>A flag that indicates whether the environment setup is done. It is initially
   unset.</dl>

  <p>An <dfn id=environment-settings-object data-export="">environment settings object</dfn> is an <a href=#environment id=definitions-2:environment-5>environment</a> that
  additionally specifies algorithms for:</p>

  <dl><dt>A <dfn data-dfn-for="environment settings object" id=realm-execution-context data-export="">realm execution
   context</dfn><dd>

    <p>A <a id=definitions-2:javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution context</a> shared by all
    <a href=scripting.html#the-script-element id=definitions-2:the-script-element>scripts</a> that use this settings object, i.e. all scripts in a given
    <a id=definitions-2:javascript-realm href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a>. When we <a href=#run-a-classic-script id=definitions-2:run-a-classic-script>run a classic script</a> or <a href=#run-a-module-script id=definitions-2:run-a-module-script>run a module
    script</a>, this execution context becomes the top of the <a id=definitions-2:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context
    stack</a>, on top of which another execution context specific to the script in question is
    pushed. (This setup ensures <a href=https://tc39.github.io/ecma262/#sec-parse-script id=definitions-2:js-parsescript data-x-internal=js-parsescript>ParseScript</a> and <a id=definitions-2:source-text-module-record-2 href=https://tc39.github.io/ecma262/#sec-source-text-module-records data-x-internal=source-text-module-record>Source
    Text Module Record</a>'s <a href=https://tc39.github.io/ecma262/#sec-moduleevaluation id=definitions-2:js-evaluate data-x-internal=js-evaluate>Evaluate</a> know which Realm to
    use.)</p>

   <dt>A <dfn data-dfn-for="environment
   settings object" id=concept-settings-object-module-map data-export="">module map</dfn><dd>

    <p>A <a href=#module-map id=definitions-2:module-map>module map</a> that is used when importing JavaScript modules.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-browsing-context data-export="">responsible browsing
   context</dfn><dd>

    <p>A <a id=definitions-2:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> that is assigned responsibility for actions taken by the
    scripts that use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-4>environment settings object</a>.</p>

    <p class=example>When a script creates and <a href=browsing-the-web.html#navigate id=definitions-2:navigate>navigates</a> a new
    <a id=definitions-2:top-level-browsing-context href=browsers.html#top-level-browsing-context>top-level browsing context</a>, the <code id=definitions-2:dom-opener><a href=browsers.html#dom-opener>opener</a></code> attribute
    of the new <a id=definitions-2:browsing-context-3 href=browsers.html#browsing-context>browsing context</a>'s <code id=definitions-2:window><a href=window-object.html#window>Window</a></code> object will be set to the
    <a href=#responsible-browsing-context id=definitions-2:responsible-browsing-context>responsible browsing context</a>'s <code id=definitions-2:windowproxy><a href=window-object.html#windowproxy>WindowProxy</a></code> object.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-event-loop data-export="">responsible event
   loop</dfn><dd>

    <p>An <a href=#event-loop id=definitions-2:event-loop>event loop</a> that is used when it would not be immediately clear what event
    loop to use.</p>

   <dt>A <dfn data-dfn-for="environment settings object" id=responsible-document data-export="">responsible document</dfn><dd>

    <p>A <code id=definitions-2:document><a href=dom.html#document>Document</a></code> that is assigned responsibility for actions taken by the scripts that
    use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-5>environment settings object</a>.</p>

    <p class=example>For example, the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="definitions-2:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the
    <a href=#responsible-document id=definitions-2:responsible-document-2>responsible document</a> is used to set the <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-document-url id="definitions-2:the-document's-address-3" data-x-internal="the-document's-address">URL</a> of the <code id=definitions-2:document-2><a href=dom.html#document>Document</a></code> after it has been reset
    using <code id=definitions-2:dom-document-open><a href=dynamic-markup-insertion.html#dom-document-open>document.open()</a></code>.</p>

    <p>If the <a href=#responsible-event-loop id=definitions-2:responsible-event-loop>responsible event loop</a> is not a <a id=definitions-2:browsing-context-4 href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=definitions-2:event-loop-2>event loop</a>,
    then the <a href=#environment-settings-object id=definitions-2:environment-settings-object-6>environment settings object</a> has no <a href=#responsible-document id=definitions-2:responsible-document-3>responsible document</a>.</p>

   <dt>An <dfn data-dfn-for="environment settings object" id=api-url-character-encoding data-export="">API URL character encoding</dfn><dd>

    <p>A character encoding used to encode URLs by APIs called by scripts that use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-7>environment
    settings object</a>.</p>

   <dt>An <dfn data-dfn-for="environment settings object" id=api-base-url data-export="">API base URL</dfn><dd>

    <p>A <a id=definitions-2:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> used by APIs called by scripts that use this <a href=#environment-settings-object id=definitions-2:environment-settings-object-8>environment settings
    object</a> to <a href=urls-and-fetching.html#parse-a-url id=definitions-2:parse-a-url>parse URLs</a>.</p>

   <dt>An <dfn data-dfn-for="environment
   settings object" id=concept-settings-object-origin data-export="">origin</dfn><dd>

    <p>An <a id=definitions-2:concept-origin href=origin.html#concept-origin>origin</a> used in security checks.</p>

   <dt>An <dfn data-dfn-for="environment settings object" id=https-state data-export="">HTTPS state</dfn><dd><p>An <a id=definitions-2:https-state-value href=https://triple-underscore.github.io/Fetch-ja.html#concept-https-state-value data-x-internal=https-state-value>HTTPS state value</a> representing the security properties of the network
   channel used to deliver the resource with which the <a href=#environment-settings-object id=definitions-2:environment-settings-object-9>environment settings object</a> is
   associated.<dt>A <dfn data-dfn-for="environment settings object" id=concept-settings-object-referrer-policy data-export="">referrer policy</dfn><dd><p>The default <a id=definitions-2:referrer-policy href=https://w3c.github.io/webappsec-referrer-policy/#referrer-policy data-x-internal=referrer-policy>referrer policy</a> for <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=definitions-2:concept-fetch data-x-internal=concept-fetch>fetches</a>
   performed using this <a href=#environment-settings-object id=definitions-2:environment-settings-object-10>environment settings object</a> as a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=definitions-2:concept-request-client data-x-internal=concept-request-client>request client</a>. <a href=references.html#refsREFERRERPOLICY>[REFERRERPOLICY]</a>

  </dl>

  <p>An <a href=#environment-settings-object id=definitions-2:environment-settings-object-11>environment settings object</a> also has an <dfn id=outstanding-rejected-promises-weak-set>outstanding rejected promises
  weak set</dfn> and an <dfn id=about-to-be-notified-rejected-promises-list>about-to-be-notified rejected promises list</dfn>, used to track
  <a href=#unhandled-promise-rejections>unhandled promise rejections</a>. The <a href=#outstanding-rejected-promises-weak-set id=definitions-2:outstanding-rejected-promises-weak-set>outstanding
  rejected promises weak set</a> must not create strong references to any of its members, and
  implementations are free to limit its size, e.g. by removing old entries from it when new ones
  are added.</p>

  <h5 id=fetching-scripts><span class=secno>8.1.3.2</span> Fetching scripts<a href=#fetching-scripts class=self-link></a></h5>

  <p>This section introduces a number of algorithms for fetching scripts, taking various necessary
  inputs and resulting in <a href=#classic-script id=fetching-scripts:classic-script>classic</a> or <a href=#module-script id=fetching-scripts:module-script>module scripts</a>.</p>

  <hr>

  <p><dfn id=script-fetch-options>Script fetch options</dfn> is a <a id=fetching-scripts:struct href=https://triple-underscore.github.io/infra-ja.html#struct data-x-internal=struct>struct</a> with the following <a href=https://infra.spec.whatwg.org/#struct-item id=fetching-scripts:struct-item data-x-internal=struct-item>items</a>:</p>

  <dl><dt><dfn id=concept-script-fetch-options-nonce>cryptographic nonce</dfn><dd><p>The <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata id=fetching-scripts:concept-request-nonce-metadata data-x-internal=concept-request-nonce-metadata>cryptographic nonce metadata</a> used
   for the initial fetch and for fetching any imported modules<dt><dfn id=concept-script-fetch-options-integrity>integrity metadata</dfn><dd><p>The <a href=https://fetch.spec.whatwg.org/#concept-request-integrity-metadata id=fetching-scripts:concept-request-integrity-metadata data-x-internal=concept-request-integrity-metadata>integrity metadata</a> used for
   the initial fetch<dt><dfn id=concept-script-fetch-options-parser>パーサーメタデータ</dfn><dd><p>The <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata id=fetching-scripts:concept-request-parser-metadata data-x-internal=concept-request-parser-metadata>parser metadata</a> used for the
   initial fetch and for fetching any imported modules<dt><dfn id=concept-script-fetch-options-credentials>資格情報モード</dfn><dd><p>The <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=fetching-scripts:concept-request-credentials-mode data-x-internal=concept-request-credentials-mode>credentials mode</a> used for the
   initial fetch (for <a href=#module-script id=fetching-scripts:module-script-2>module scripts</a>) and for fetching any
   imported modules (for both <a href=#module-script id=fetching-scripts:module-script-3>module scripts</a> and <a href=#classic-script id=fetching-scripts:classic-script-2>classic scripts</a>)<dt><dfn id=concept-script-fetch-options-referrer-policy>リファラーポリシー</dfn><dd><p>The <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy id=fetching-scripts:concept-request-referrer-policy data-x-internal=concept-request-referrer-policy>referrer policy</a> used for the
   initial fetch and for fetching any imported modules</dl>

  <p class=note>Recall that via the <code id=fetching-scripts:import()><a data-x-internal=import() href=https://tc39.github.io/proposal-dynamic-import/#sec-import-calls>import()</a></code> feature, <a href=#classic-script id=fetching-scripts:classic-script-3>classic scripts</a> can import <a href=#module-script id=fetching-scripts:module-script-4>module scripts</a>.</p>

  <p>The <dfn id=default-classic-script-fetch-options>default classic script fetch options</dfn> are a <a href=#script-fetch-options id=fetching-scripts:script-fetch-options>script fetch options</a>
  whose <a href=#concept-script-fetch-options-nonce id=fetching-scripts:concept-script-fetch-options-nonce>cryptographic nonce</a> is the empty
  string, <a href=#concept-script-fetch-options-integrity id=fetching-scripts:concept-script-fetch-options-integrity>integrity metadata</a> is the
  empty string, <a href=#concept-script-fetch-options-parser id=fetching-scripts:concept-script-fetch-options-parser>parser metadata</a> is "<code>not-parser-inserted</code>", <a href=#concept-script-fetch-options-credentials id=fetching-scripts:concept-script-fetch-options-credentials>credentials mode</a> is "<code>omit</code>", and <a href=#concept-script-fetch-options-referrer-policy id=fetching-scripts:concept-script-fetch-options-referrer-policy>referrer
  policy</a> is the empty string.</p>

  <p>Given a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request data-x-internal=concept-request>request</a> <var>request</var> and a <a href=#script-fetch-options id=fetching-scripts:script-fetch-options-2>script
  fetch options</a> <var>options</var>, we define:</p>

  <dl><dt><dfn id=set-up-the-classic-script-request>set up the classic script request</dfn><dd><p>Set <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata id=fetching-scripts:concept-request-nonce-metadata-2 data-x-internal=concept-request-nonce-metadata>cryptographic nonce
   metadata</a> to <var>options</var>'s <a href=#concept-script-fetch-options-nonce id=fetching-scripts:concept-script-fetch-options-nonce-2>cryptographic nonce</a>, its <a href=https://fetch.spec.whatwg.org/#concept-request-integrity-metadata id=fetching-scripts:concept-request-integrity-metadata-2 data-x-internal=concept-request-integrity-metadata>integrity metadata</a> to <var>options</var>'s
   <a href=#concept-script-fetch-options-integrity id=fetching-scripts:concept-script-fetch-options-integrity-2>integrity metadata</a>, its <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata id=fetching-scripts:concept-request-parser-metadata-2 data-x-internal=concept-request-parser-metadata>parser metadata</a> to <var>options</var>'s <a href=#concept-script-fetch-options-parser id=fetching-scripts:concept-script-fetch-options-parser-2>parser metadata</a>, and its <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy id=fetching-scripts:concept-request-referrer-policy-2 data-x-internal=concept-request-referrer-policy>referrer policy</a> to <var>options</var>'s <a href=#concept-script-fetch-options-referrer-policy id=fetching-scripts:concept-script-fetch-options-referrer-policy-2>referrer policy</a>.<dt><dfn id=set-up-the-module-script-request>set up the module script request</dfn><dd><p>Set <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata id=fetching-scripts:concept-request-nonce-metadata-3 data-x-internal=concept-request-nonce-metadata>cryptographic nonce
   metadata</a> to <var>options</var>'s <a href=#concept-script-fetch-options-nonce id=fetching-scripts:concept-script-fetch-options-nonce-3>cryptographic nonce</a>, its <a href=https://fetch.spec.whatwg.org/#concept-request-integrity-metadata id=fetching-scripts:concept-request-integrity-metadata-3 data-x-internal=concept-request-integrity-metadata>integrity metadata</a> to <var>options</var>'s
   <a href=#concept-script-fetch-options-integrity id=fetching-scripts:concept-script-fetch-options-integrity-3>integrity metadata</a>, its <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata id=fetching-scripts:concept-request-parser-metadata-3 data-x-internal=concept-request-parser-metadata>parser metadata</a> to <var>options</var>'s <a href=#concept-script-fetch-options-parser id=fetching-scripts:concept-script-fetch-options-parser-3>parser metadata</a>, its <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=fetching-scripts:concept-request-credentials-mode-2 data-x-internal=concept-request-credentials-mode>credentials mode</a> to <var>options</var>'s <a href=#concept-script-fetch-options-credentials id=fetching-scripts:concept-script-fetch-options-credentials-2>credentials mode</a>, and its <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy id=fetching-scripts:concept-request-referrer-policy-3 data-x-internal=concept-request-referrer-policy>referrer policy</a> to <var>options</var>'s <a href=#concept-script-fetch-options-referrer-policy id=fetching-scripts:concept-script-fetch-options-referrer-policy-3>referrer policy</a>.</dl>

  <p>For any given <a href=#script-fetch-options id=fetching-scripts:script-fetch-options-3>script fetch options</a> <var>options</var>, the <dfn id=descendant-script-fetch-options>descendant script
  fetch options</dfn> are a new <a href=#script-fetch-options id=fetching-scripts:script-fetch-options-4>script fetch options</a> whose <a href=https://infra.spec.whatwg.org/#struct-item id=fetching-scripts:struct-item-2 data-x-internal=struct-item>items</a> all have the same values, except for the <a href=#concept-script-fetch-options-integrity id=fetching-scripts:concept-script-fetch-options-integrity-4>integrity metadata</a>, which is instead the
  empty string.</p>

  <hr>

  <p>The algorithms below can be customized by optionally supplying a custom <dfn data-dfn-for="fetching scripts" id=fetching-scripts-perform-fetch data-export="">perform the
  fetch</dfn> hook, which takes a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-2 data-x-internal=concept-request>request</a> and an <dfn data-dfn-for="fetching scripts" id=fetching-scripts-is-top-level data-export=""><var>is
  top-level</var></dfn> flag. The algorithm must complete with a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response data-x-internal=concept-response>response</a> (which may be a <a id=fetching-scripts:network-error href=https://triple-underscore.github.io/Fetch-ja.html#concept-network-error data-x-internal=network-error>network error</a>), either
  synchronously (when using <a href=#fetch-a-classic-worker-imported-script id=fetching-scripts:fetch-a-classic-worker-imported-script>fetch a classic worker-imported script</a>) or asynchronously
  (otherwise). The <var id=fetching-scripts:fetching-scripts-is-top-level><a href=#fetching-scripts-is-top-level>is top-level</a></var> flag will be set
  for all <a href=#classic-script id=fetching-scripts:classic-script-4>classic script</a> fetches, and for the initial fetch when <a href=#fetch-a-module-script-tree id=fetching-scripts:fetch-a-module-script-tree>fetching a module script graph</a> or <a href=#fetch-a-module-worker-script-tree id=fetching-scripts:fetch-a-module-worker-script-tree>fetching a module worker script graph</a>, but not for the fetches resulting from
  <code>import</code> statements encountered throughout the graph.</p>

  <div class=note>
   <p>By default, not supplying the <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch>perform the
   fetch</a> will cause the below algorithms to simply <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch data-x-internal=concept-fetch>fetch</a>
   the given <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-3 data-x-internal=concept-request>request</a>, with algorithm-specific customizations
   to the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-4 data-x-internal=concept-request>request</a> and validations of the resulting <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-2 data-x-internal=concept-response>response</a>.</p>

   <p>To layer your own customizations on top of these algorithm-specific ones, supply a <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-2>perform the fetch</a> hook that modifies the given
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-5 data-x-internal=concept-request>request</a>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-2 data-x-internal=concept-fetch>fetches</a> it,
   and then performs specific validations of the resulting <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-3 data-x-internal=concept-response>response</a> (completing with a <a id=fetching-scripts:network-error-2 href=https://triple-underscore.github.io/Fetch-ja.html#concept-network-error data-x-internal=network-error>network error</a> if the
   validations fail).</p>

   <p>The hook can also be used to perform more subtle customizations, such as keeping a cache of
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-4 data-x-internal=concept-response>responses</a> and avoiding performing a <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-3 data-x-internal=concept-fetch>fetch</a> at all.</p>
  </div>

  <p class=note><cite>Service Workers</cite> is an example of a specification that runs these
  algorithms with its own options for the hook. <a href=references.html#refsSW>[SW]</a></p>

  <hr>

  <p>Now for the algorithms themselves.</p>

  <p>To <dfn id=fetch-a-classic-script data-export="">fetch a classic script</dfn> given a <var>url</var>, a <var>settings
  object</var>, some <var>options</var>, a <var>CORS setting</var>, and a <var>character
  encoding</var>, run these steps. The algorithm will asynchronously complete with either null (on
  failure) or a new <a href=#classic-script id=fetching-scripts:classic-script-5>classic script</a> (on success).</p>

  <ol><li><p>Let <var>request</var> be the result of <a href=urls-and-fetching.html#create-a-potential-cors-request id=fetching-scripts:create-a-potential-cors-request>creating a potential-CORS request</a> given <var>url</var>, "<code>script</code>", and <var>CORS setting</var>.</li><li><p>Set <var>request</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=fetching-scripts:concept-request-client data-x-internal=concept-request-client>client</a> to
   <var>settings object</var>.</p>

   </li><li><p><a href=#set-up-the-classic-script-request id=fetching-scripts:set-up-the-classic-script-request>Set up the classic script request</a> given <var>request</var> and
   <var>options</var>.</li><li>
    <p>If the caller specified custom steps to <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-3>perform
    the fetch</a>, perform them on <var>request</var>, with the <var id=fetching-scripts:fetching-scripts-is-top-level-2><a href=#fetching-scripts-is-top-level>is top-level</a></var> flag set. Return from this algorithm,
    and when the custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-4>perform the fetch</a> steps
    complete with <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-5 data-x-internal=concept-response>response</a> <var>response</var>, run the
    remaining steps.</p>

    <p>Otherwise, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-4 data-x-internal=concept-fetch>fetch</a> <var>request</var>. Return from this
    algorithm, and run the remaining steps as part of the fetch's <a id=fetching-scripts:process-response href=https://triple-underscore.github.io/Fetch-ja.html#process-response data-x-internal=process-response>process response</a> for
    the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-6 data-x-internal=concept-response>response</a> <var>response</var>.</p>

    <p class=note><var>response</var> can be either <a id=fetching-scripts:cors-same-origin href=urls-and-fetching.html#cors-same-origin>CORS-same-origin</a> or
    <a id=fetching-scripts:cors-cross-origin href=urls-and-fetching.html#cors-cross-origin>CORS-cross-origin</a>. This only affects how error reporting happens.</p>
   </li><li><p>Let <var>response</var> be <var>response</var>'s <a id=fetching-scripts:unsafe-response href=urls-and-fetching.html#unsafe-response>unsafe response</a>.</li><li><p>If <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-type data-x-internal=concept-response-type>type</a> is "<code>error</code>", or <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-status id=fetching-scripts:concept-response-status data-x-internal=concept-response-status>status</a> is not an <a id=fetching-scripts:ok-status href=https://triple-underscore.github.io/Fetch-ja.html#ok-status data-x-internal=ok-status>ok status</a>, asynchronously
   complete this algorithm with null, and abort these steps.</li><li><p>If <var>response</var>'s <a href=urls-and-fetching.html#content-type id=fetching-scripts:content-type>Content Type metadata</a>, if
   any, specifies a character encoding, and the user agent supports that encoding, then set
   <var>character encoding</var> to that encoding (ignoring the passed-in value).</li><li>
    <p>Let <var>source text</var> be the result of <a href=https://triple-underscore.github.io/Encoding-ja.html#decode id=fetching-scripts:decode data-x-internal=decode>decoding</a>
    <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=fetching-scripts:concept-response-body data-x-internal=concept-response-body>body</a> to Unicode, using
    <var>character encoding</var> as the fallback encoding.</p>

    <p class=note>The <a id=fetching-scripts:decode-2 href=https://triple-underscore.github.io/Encoding-ja.html#decode data-x-internal=decode>decode</a> algorithm overrides <var>character encoding</var> if
    the file contains a BOM.</p>
   </li><li><p>Let <var>muted errors</var> be true if <var>response</var> was
   <a id=fetching-scripts:cors-cross-origin-2 href=urls-and-fetching.html#cors-cross-origin>CORS-cross-origin</a>, and false otherwise.</li><li><p>Let <var>script</var> be the result of <a href=#creating-a-classic-script id=fetching-scripts:creating-a-classic-script>creating a classic script</a> given
   <var>source text</var>, <var>settings object</var>, <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-url id=fetching-scripts:concept-response-url data-x-internal=concept-response-url>url</a>, <var>options</var>, and <var>muted
   errors</var>.</li><li>Asynchronously complete this algorithm with <var>script</var>.</li></ol>

  <p>To <dfn id=fetch-a-classic-worker-script data-export="">fetch a classic worker script</dfn> given a <var>url</var>, a <var>fetch
  client settings object</var>, a <var>destination</var>, and a <var>script settings object</var>,
  run these steps. The algorithm will asynchronously complete with either null (on failure) or a new
  <a href=#classic-script id=fetching-scripts:classic-script-6>classic script</a> (on success).</p>

  <ol><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-6 data-x-internal=concept-request>request</a> whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=fetching-scripts:concept-request-url data-x-internal=concept-request-url>url</a> is <var>url</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=fetching-scripts:concept-request-client-2 data-x-internal=concept-request-client>client</a> is <var>fetch client settings object</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=fetching-scripts:concept-request-destination data-x-internal=concept-request-destination>destination</a> is <var>destination</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode id=fetching-scripts:concept-request-mode data-x-internal=concept-request-mode>mode</a> is "<code>same-origin</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode id=fetching-scripts:concept-request-credentials-mode-3 data-x-internal=concept-request-credentials-mode>credentials mode</a> is "<code>same-origin</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata id=fetching-scripts:concept-request-parser-metadata-4 data-x-internal=concept-request-parser-metadata>parser
   metadata</a> is "<code>not parser-inserted</code>", and whose
   <a id=fetching-scripts:use-url-credentials-flag href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a> is set.</li><li>
    <p>If the caller specified custom steps to <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-5>perform
    the fetch</a>, perform them on <var>request</var>, with the <var id=fetching-scripts:fetching-scripts-is-top-level-3><a href=#fetching-scripts-is-top-level>is top-level</a></var> flag set. Return from this algorithm,
    and when the custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-6>perform the fetch</a> steps
    complete with <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-7 data-x-internal=concept-response>response</a> <var>response</var>, run the
    remaining steps.</p>

    <p>Otherwise, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-5 data-x-internal=concept-fetch>fetch</a> <var>request</var>. Return from this
    algorithm, and run the remaining steps as part of the fetch's <a id=fetching-scripts:process-response-2 href=https://triple-underscore.github.io/Fetch-ja.html#process-response data-x-internal=process-response>process response</a> for
    the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-8 data-x-internal=concept-response>response</a> <var>response</var>.</p>
   </li><li><p>Let <var>response</var> be <var>response</var>'s <a id=fetching-scripts:unsafe-response-2 href=urls-and-fetching.html#unsafe-response>unsafe response</a>.</li><li><p>If <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-type-2 data-x-internal=concept-response-type>type</a> is "<code>error</code>", or <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-status id=fetching-scripts:concept-response-status-2 data-x-internal=concept-response-status>status</a> is not an <a id=fetching-scripts:ok-status-2 href=https://triple-underscore.github.io/Fetch-ja.html#ok-status data-x-internal=ok-status>ok status</a>, asynchronously
   complete this algorithm with null, and abort these steps.</li><li><p>Let <var>source text</var> be the result of <a href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode id=fetching-scripts:utf-8-decode data-x-internal=utf-8-decode>UTF-8
   decoding</a> <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=fetching-scripts:concept-response-body-2 data-x-internal=concept-response-body>body</a>.</li><li><p>Let <var>script</var> be the result of <a href=#creating-a-classic-script id=fetching-scripts:creating-a-classic-script-2>creating a classic script</a> using
   <var>source text</var>, <var>script settings object</var>, <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-url id=fetching-scripts:concept-response-url-2 data-x-internal=concept-response-url>url</a>, and the <a href=#default-classic-script-fetch-options id=fetching-scripts:default-classic-script-fetch-options>default classic script fetch
   options</a>.</li><li>Asynchronously complete this algorithm with <var>script</var>.</li></ol>

  <p>To <dfn id=fetch-a-classic-worker-imported-script data-export="">fetch a classic worker-imported script</dfn> given a <var>url</var> and
  a <var>settings object</var>, run these steps. The algorithm will synchronously complete with a
  <a href=#classic-script id=fetching-scripts:classic-script-7>classic script</a> on success, or throw an exception on failure.</p>

  <ol><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-7 data-x-internal=concept-request>request</a> whose <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=fetching-scripts:concept-request-url-2 data-x-internal=concept-request-url>url</a> is <var>url</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=fetching-scripts:concept-request-client-3 data-x-internal=concept-request-client>client</a> is <var>settings object</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=fetching-scripts:concept-request-destination-2 data-x-internal=concept-request-destination>destination</a> is "<code>script</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata id=fetching-scripts:concept-request-parser-metadata-5 data-x-internal=concept-request-parser-metadata>parser metadata</a> is "<code>not
   parser-inserted</code>", <a id=fetching-scripts:synchronous-flag href=https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag data-x-internal=synchronous-flag>synchronous flag</a> is set, and whose
   <a id=fetching-scripts:use-url-credentials-flag-2 href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag data-x-internal=use-url-credentials-flag>use-URL-credentials flag</a> is set.</li><li>
    <p>If the caller specified custom steps to <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-7>perform
    the fetch</a>, perform them on <var>request</var>, with the <var id=fetching-scripts:fetching-scripts-is-top-level-4><a href=#fetching-scripts-is-top-level>is top-level</a></var> flag set. Let <var>response</var> be
    the result.</p>

    <p>Otherwise, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-6 data-x-internal=concept-fetch>fetch</a> <var>request</var>, and let
    <var>response</var> be the result.</p>

    <p class=note>Unlike other algorithms in this section, the fetching process is synchronous
    here. Thus any <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-8>perform the fetch</a> steps will
    also finish their work synchronously.</p>
   </li><li><p>Let <var>response</var> be <var>response</var>'s <a id=fetching-scripts:unsafe-response-3 href=urls-and-fetching.html#unsafe-response>unsafe response</a>.</li><li><p>If <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-type-3 data-x-internal=concept-response-type>type</a> is "<code>error</code>", or <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-status id=fetching-scripts:concept-response-status-3 data-x-internal=concept-response-status>status</a> is not an <a id=fetching-scripts:ok-status-3 href=https://triple-underscore.github.io/Fetch-ja.html#ok-status data-x-internal=ok-status>ok status</a>, throw a
   <a id=fetching-scripts:networkerror href=https://triple-underscore.github.io/WebIDL-ja.html#networkerror data-x-internal=networkerror>"<code>NetworkError</code>"</a> <code id=fetching-scripts:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>source text</var> be the result of <a href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode id=fetching-scripts:utf-8-decode-2 data-x-internal=utf-8-decode>UTF-8
   decoding</a> <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=fetching-scripts:concept-response-body-3 data-x-internal=concept-response-body>body</a>.</li><li><p>Let <var>muted errors</var> be true if <var>response</var> was
   <a id=fetching-scripts:cors-cross-origin-3 href=urls-and-fetching.html#cors-cross-origin>CORS-cross-origin</a>, and false otherwise.</li><li><p>Let <var>script</var> be the result of <a href=#creating-a-classic-script id=fetching-scripts:creating-a-classic-script-3>creating a classic script</a> given
   <var>source text</var>, <var>settings object</var>, <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-url id=fetching-scripts:concept-response-url-3 data-x-internal=concept-response-url>url</a>, the <a href=#default-classic-script-fetch-options id=fetching-scripts:default-classic-script-fetch-options-2>default classic script fetch options</a>,
   and <var>muted errors</var>.</li><li><p>Return <var>script</var>.</li></ol>

  <p>To <dfn id=fetch-a-module-script-tree data-export="">fetch a module script graph</dfn> given
  a <var>url</var>, a <var>settings object</var>, a <var>destination</var>, and some
  <var>options</var>, run these steps. The algorithm will asynchronously complete with either null
  (on failure) or a <a href=#module-script id=fetching-scripts:module-script-5>module script</a> (on success).</p>

  <ol><li><p>Let <var>visited set</var> be « <var>url</var> ».</li><li><p>Perform the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure>internal module script graph fetching procedure</a> given
   <var>url</var>, <var>settings object</var>, <var>destination</var>, <var>options</var>,
   <var>settings object</var>, <var>visited set</var>, "<code>client</code>", and with the
   <var>top-level module fetch flag</var> set. If the caller of this algorithm specified custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-9>perform the fetch</a> steps, pass those along as
   well.</p>

   </li><li><p>When the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-2>internal module script graph fetching procedure</a> asynchronously
   completes with <var>result</var>, asynchronously complete this algorithm with
   <var>result</var>.</li></ol>

  <p>To <dfn id=fetch-a-module-worker-script-tree data-export="">fetch a module worker script
  graph</dfn> given a <var>url</var>, a <var>fetch client settings object</var>, a
  <var>destination</var>, a <var>credentials mode</var>, and a <var>module map settings
  object</var>, run these steps. The algorithm will asynchronously complete with either null (on
  failure) or a <a href=#module-script id=fetching-scripts:module-script-6>module script</a> (on success).</p>

  <ol><li><p>Let <var>visited set</var> be « <var>url</var> ».</li><li><p>Let <var>options</var> be a <a href=#script-fetch-options id=fetching-scripts:script-fetch-options-5>script fetch options</a> whose <a href=#concept-script-fetch-options-nonce id=fetching-scripts:concept-script-fetch-options-nonce-4>cryptographic nonce</a> is the empty string, <a href=#concept-script-fetch-options-integrity id=fetching-scripts:concept-script-fetch-options-integrity-5>integrity metadata</a> is the empty string,
   <a href=#concept-script-fetch-options-parser id=fetching-scripts:concept-script-fetch-options-parser-4>parser metadata</a> is "<code>not-parser-inserted</code>", <a href=#concept-script-fetch-options-credentials id=fetching-scripts:concept-script-fetch-options-credentials-3>credentials mode</a> is <var>credentials
   mode</var>, and <a href=#concept-script-fetch-options-referrer-policy id=fetching-scripts:concept-script-fetch-options-referrer-policy-4>referrer
   policy</a> is the empty string.</p>

   </li><li><p>Perform the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-3>internal module script graph fetching procedure</a> given
   <var>url</var>, <var>fetch client settings object</var>, <var>destination</var>,
   <var>options</var>, <var>module map settings object</var>, <var>visited set</var>, "<code>client</code>", and with the <var>top-level module fetch flag</var> set. If the caller
   of this algorithm specified custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-10>perform the
   fetch</a> steps, pass those along as well.</p>

   </li><li><p>When the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-4>internal module script graph fetching procedure</a> asynchronously
   completes with <var>result</var>, asynchronously complete this algorithm with
   <var>result</var>.</li></ol>

  <hr>

  <p>The following algorithms are meant for internal use by this specification only as part of <a href=#fetch-a-module-script-tree id=fetching-scripts:fetch-a-module-script-tree-2>fetching a module script graph</a> or <a href=scripting.html#prepare-a-script id=fetching-scripts:prepare-a-script>preparing a script</a>, and should not be used directly by other specifications.</p>

  <p>To perform the <dfn id=internal-module-script-graph-fetching-procedure>internal module script graph fetching procedure</dfn> given a
  <var>url</var>, a <var>fetch client settings object</var>, a <var>destination</var>, a some
  <var>options</var>, a <var>module map settings object</var>, a <var>visited set</var>, a
  <var>referrer</var>, and a <var>top-level module fetch</var> flag, perform these steps. The
  algorithm will asynchronously complete with either null (on failure) or a <a href=#module-script id=fetching-scripts:module-script-7>module
  script</a> (on success).</p>

  <ol><li><p>Assert: <var>visited set</var> <a href=https://triple-underscore.github.io/infra-ja.html#list-contain id=fetching-scripts:list-contains data-x-internal=list-contains>contains</a>
   <var>url</var>.</li><li><p><a href=#fetch-a-single-module-script id=fetching-scripts:fetch-a-single-module-script>Fetch a single module script</a> given <var>url</var>, <var>fetch client settings
   object</var>, <var>destination</var>, <var>options</var>, <var>module map settings object</var>,
   <var>referrer</var>, and the <var>top-level module fetch</var> flag. If the caller of this
   algorithm specified custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-11>perform the fetch</a>
   steps, pass those along while <a href=#fetch-a-single-module-script id=fetching-scripts:fetch-a-single-module-script-2>fetching a single
   module script</a>.</p>

   </li><li><p>Return from this algorithm, and run the following steps when <a href=#fetch-a-single-module-script id=fetching-scripts:fetch-a-single-module-script-3>fetching a single module script</a> asynchronously completes with
   <var>result</var>:</li><li><p>If <var>result</var> is null, asynchronously complete this algorithm with null, and abort
   these steps.</li><li><p>If the <var>top-level module fetch</var> flag is set, <a href=#fetch-the-descendants-of-and-instantiate-a-module-script id=fetching-scripts:fetch-the-descendants-of-and-instantiate-a-module-script>fetch the descendants of and instantiate</a>
   <var>result</var> given <var>destination</var> and <var>visited set</var>. Otherwise,
   <a href=#fetch-the-descendants-of-a-module-script id=fetching-scripts:fetch-the-descendants-of-a-module-script>fetch the descendants of</a>
   <var>result</var> given the same arguments.</li><li><p>When the appropriate algorithm asynchronously completes with <var>final result</var>,
   asynchronously complete this algorithm with <var>final result</var>.</li></ol>

  <p>To <dfn id=fetch-a-single-module-script>fetch a single module script</dfn>, given a <var>url</var>, a <var>fetch client
  settings object</var>, a <var>destination</var>, some <var>options</var>, a <var>module map
  settings object</var>, a <var>referrer</var>, and a <var>top-level module fetch</var> flag, run
  these steps. The algorithm will asynchronously complete with either null (on failure) or a
  <a href=#module-script id=fetching-scripts:module-script-8>module script</a> (on success).</p>

  <ol><li><p>Let <var>moduleMap</var> be <var>module map settings object</var>'s <a href=#concept-settings-object-module-map id=fetching-scripts:concept-settings-object-module-map>module map</a>.</li><li><p>If <var>moduleMap</var>[<var>url</var>] is "<code>fetching</code>", wait
   <a id=fetching-scripts:in-parallel href=infrastructure.html#in-parallel>in parallel</a> until that entry's value changes, then <a href=#queue-a-task id=fetching-scripts:queue-a-task>queue a task</a> on
   the <a href=#networking-task-source id=fetching-scripts:networking-task-source>networking task source</a> to proceed with running the following steps.</li><li><p>If <var>moduleMap</var>[<var>url</var>] <a href=https://triple-underscore.github.io/infra-ja.html#map-exists id=fetching-scripts:map-exists data-x-internal=map-exists>exists</a>,
   asynchronously complete this algorithm with <var>moduleMap</var>[<var>url</var>], and abort
   these steps.</li><li><p><a href=https://triple-underscore.github.io/infra-ja.html#map-set id=fetching-scripts:map-set data-x-internal=map-set>Set</a> <var>moduleMap</var>[<var>url</var>] to "<code>fetching</code>".</p>

   </li><li><p>Let <var>request</var> be a new <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request id=fetching-scripts:concept-request-8 data-x-internal=concept-request>request</a> whose
   <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=fetching-scripts:concept-request-url-3 data-x-internal=concept-request-url>url</a> is <var>url</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination id=fetching-scripts:concept-request-destination-3 data-x-internal=concept-request-destination>destination</a> is <var>destination</var>, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode id=fetching-scripts:concept-request-mode-2 data-x-internal=concept-request-mode>mode</a> is "<code>cors</code>", <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer id=fetching-scripts:concept-request-referrer data-x-internal=concept-request-referrer>referrer</a> is <var>referrer</var>, and <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=fetching-scripts:concept-request-client-4 data-x-internal=concept-request-client>client</a> is <var>fetch client settings
   object</var>.</li><li><p><a href=#set-up-the-module-script-request id=fetching-scripts:set-up-the-module-script-request>Set up the module script request</a> given <var>request</var> and
   <var>options</var>.</li><li>
    <p>If the caller specified custom steps to <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-12>perform
    the fetch</a>, perform them on <var>request</var>, setting the <var id=fetching-scripts:fetching-scripts-is-top-level-5><a href=#fetching-scripts-is-top-level>is top-level</a></var> flag if the <var>top-level module
    fetch</var> flag is set. Return from this algorithm, and when the custom <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-13>perform the fetch</a> steps complete with <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-9 data-x-internal=concept-response>response</a> <var>response</var>, run the remaining steps.</p>

    <p>Otherwise, <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=fetching-scripts:concept-fetch-7 data-x-internal=concept-fetch>fetch</a> <var>request</var>. Return from this
    algorithm, and run the remaining steps as part of the fetch's <a id=fetching-scripts:process-response-3 href=https://triple-underscore.github.io/Fetch-ja.html#process-response data-x-internal=process-response>process response</a> for
    the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-10 data-x-internal=concept-response>response</a> <var>response</var>.</p>

    <p class=note><var>response</var> is always <a id=fetching-scripts:cors-same-origin-2 href=urls-and-fetching.html#cors-same-origin>CORS-same-origin</a>.</p>
   </li><li>
    <p>If any of the following conditions are met, <a href=https://triple-underscore.github.io/infra-ja.html#map-set id=fetching-scripts:map-set-2 data-x-internal=map-set>set</a>
    <var>moduleMap</var>[<var>url</var>] to null, asynchronously complete this algorithm with null,
    and abort these steps:</p>

    <ul class=compact><li><p><var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response id=fetching-scripts:concept-response-type-4 data-x-internal=concept-response-type>type</a> is "<code>error</code>"</li><li><p><var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-status id=fetching-scripts:concept-response-status-4 data-x-internal=concept-response-status>status</a> is not an
     <a id=fetching-scripts:ok-status-4 href=https://triple-underscore.github.io/Fetch-ja.html#ok-status data-x-internal=ok-status>ok status</a></li><li>
      <p>The result of <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-header-extract-mime-type id=fetching-scripts:extract-a-mime-type data-x-internal=extract-a-mime-type>extracting a MIME type</a> from
      <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list id=fetching-scripts:concept-response-header-list data-x-internal=concept-response-header-list>header list</a>
      (ignoring parameters) is not a <a id=fetching-scripts:javascript-mime-type href=scripting.html#javascript-mime-type>JavaScript MIME type</a></p>

      <p class=note>For historical reasons, <a href=#fetch-a-classic-script id=fetching-scripts:fetch-a-classic-script>fetching a
      classic script</a> does not include MIME type checking. In contrast, module scripts will
      fail to load if they are not of a correct MIME type.</p>
     </li></ul>
   </li><li><p>Let <var>source text</var> be the result of <a href=https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode id=fetching-scripts:utf-8-decode-3 data-x-internal=utf-8-decode>UTF-8
   decoding</a> <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-body id=fetching-scripts:concept-response-body-4 data-x-internal=concept-response-body>body</a>.</li><li><p>Let <var>module script</var> be the result of <a href=#creating-a-module-script id=fetching-scripts:creating-a-module-script>creating a module script</a> given
   <var>source text</var>, <var>module map settings object</var>, <var>response</var>'s <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-url id=fetching-scripts:concept-response-url-4 data-x-internal=concept-response-url>url</a>, and <var>options</var>.</li><li>
    <p><a href=https://triple-underscore.github.io/infra-ja.html#map-set id=fetching-scripts:map-set-3 data-x-internal=map-set>Set</a> <var>moduleMap</var>[<var>url</var>] to <var>module
    script</var>, and asynchronously complete this algorithm with <var>module script</var>.</p>

    <p class=note>It is intentional that the <a href=#module-map id=fetching-scripts:module-map>module map</a> is keyed by the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-url id=fetching-scripts:concept-request-url-4 data-x-internal=concept-request-url>request URL</a>, whereas the <a href=#concept-script-base-url id=fetching-scripts:concept-script-base-url>base URL</a> for the <a href=#module-script id=fetching-scripts:module-script-9>module script</a> is
    set to the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-response-url id=fetching-scripts:concept-response-url-5 data-x-internal=concept-response-url>response URL</a>. The former is used to
    deduplicate fetches, while the latter is used for URL resolution.</p>
   </li></ol>

  <p>To <dfn id=fetch-the-descendants-of-a-module-script>fetch the descendants of a module script</dfn> <var>module script</var>, given a
  <var>destination</var> and a <var>visited set</var>, run these steps. The algorithm will
  asynchronously complete with either null (on failure) or with <var>module script</var> (on
  success).</p>

  <ol><li><p>If <var>module script</var>'s <a href=#concept-script-record id=fetching-scripts:concept-script-record>record</a> is null,
   then asynchronously complete this algorithm with <var>module script</var> and abort these
   steps.</li><li><p>Let <var>record</var> be <var>module script</var>'s <a href=#concept-script-record id=fetching-scripts:concept-script-record-2>record</a>.</li><li><p>If <var>record</var>.[[RequestedModules]] <a href=https://triple-underscore.github.io/infra-ja.html#list-empty id=fetching-scripts:list-is-empty data-x-internal=list-is-empty>is empty</a>,
   asynchronously complete this algorithm with <var>module script</var>.</li><li><p>Let <var>urls</var> be a new empty <a id=fetching-scripts:list href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a>.</li><li>
    <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=fetching-scripts:list-iterate data-x-internal=list-iterate>For each</a> string <var>requested</var> of
    <var>record</var>.[[RequestedModules]],</p>

    <ol><li><p>Let <var>url</var> be the result of <a href=#resolve-a-module-specifier id=fetching-scripts:resolve-a-module-specifier>resolving
     a module specifier</a> given <var>module script</var> and <var>requested</var>.</li><li><p>Assert: <var>url</var> is never failure, because <a href=#resolve-a-module-specifier id=fetching-scripts:resolve-a-module-specifier-2>resolving a module specifier</a> must have been <a href=#validate-requested-module-specifiers>previously successful</a> with these same two
     arguments.</li><li>
      <p>If <var>visited set</var> does not <a href=https://triple-underscore.github.io/infra-ja.html#list-contain id=fetching-scripts:list-contains-2 data-x-internal=list-contains>contain</a>
      <var>url</var>, then:</p>

      <ol><li><p><a href=https://infra.spec.whatwg.org/#list-append id=fetching-scripts:list-append data-x-internal=list-append>Append</a> <var>url</var> to <var>urls</var>.</li><li><p><a href=https://triple-underscore.github.io/infra-ja.html#set-append id=fetching-scripts:set-append data-x-internal=set-append>Append</a> <var>url</var> to <var>visited
       set</var>.</li></ol>
     </li></ol>
   </li><li><p>Let <var>options</var> be the <a href=#descendant-script-fetch-options id=fetching-scripts:descendant-script-fetch-options>descendant script fetch options</a> for <var>module
   script</var>'s <a href=#concept-script-script-fetch-options id=fetching-scripts:concept-script-script-fetch-options>fetch options</a>.</li><li>
    <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=fetching-scripts:list-iterate-2 data-x-internal=list-iterate>For each</a> <var>url</var> in <var>urls</var>, perform the
    <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-5>internal module script graph fetching procedure</a> given <var>url</var>,
    <var>options</var>, <var>destination</var>, <var>module script</var>'s <a href=#settings-object id=fetching-scripts:settings-object>settings
    object</a>, <var>module script</var>'s <a href=#settings-object id=fetching-scripts:settings-object-2>settings object</a>, <var>visited set</var>,
    <var>module script</var>'s <a href=#concept-script-base-url id=fetching-scripts:concept-script-base-url-2>base URL</a>, and with the
    <var>top-level module fetch</var> flag unset. If the caller of this algorithm specified custom
    <a href=#fetching-scripts-perform-fetch id=fetching-scripts:fetching-scripts-perform-fetch-14>perform the fetch</a> steps, pass those along
    while performing the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-6>internal module script graph fetching procedure</a>.</p>

    <p>These invocations of the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-7>internal module script graph fetching procedure</a> should
    be performed in parallel to each other.</p>

    <p>If any of the invocations of the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-8>internal module script graph fetching procedure</a>
    asynchronously complete with null, asynchronously complete this algorithm with null, aborting
    these steps.</p>

    <p>Otherwise, wait until all of the <a href=#internal-module-script-graph-fetching-procedure id=fetching-scripts:internal-module-script-graph-fetching-procedure-9>internal module script graph fetching procedure</a>
    invocations have asynchronously completed. Asynchronously complete this algorithm with
    <var>module script</var>.</p>
   </li></ol>

  <p>To <dfn id=fetch-the-descendants-of-and-instantiate-a-module-script>fetch the descendants of and instantiate a module script</dfn> <var>module
  script</var>, given a <var>destination</var> and an optional <var>visited set</var>, run these
  steps. The algorithm will asynchronously complete with either null (on failure) or with
  <var>module script</var> (on success).</p>

  <ol><li><p>If <var>visited set</var> was not given, let it be an empty <a id=fetching-scripts:set href=https://triple-underscore.github.io/infra-ja.html#ordered-set data-x-internal=set>set</a>.</li><li><p><a href=#fetch-the-descendants-of-a-module-script id=fetching-scripts:fetch-the-descendants-of-a-module-script-2>Fetch the descendants of</a>
   <var>module script</var>, given <var>destination</var> and <var>visited set</var>.</li><li><p>Return from this algorithm, and run the following steps when <a href=#fetch-the-descendants-of-a-module-script id=fetching-scripts:fetch-the-descendants-of-a-module-script-3>fetching the descendants of a module script</a> asynchronously
   completes with <var>result</var>.</li><li>
    <p>If <var>result</var> is null, then asynchronously complete this algorithm with
    <var>result</var>.</p>

    <p class=note>In this case, there was an error fetching one or more of the descendants. We
    will not attempt to instantiate.</p>
   </li><li><p>Let <var>parse error</var> be the result of <a href=#finding-the-first-parse-error id=fetching-scripts:finding-the-first-parse-error>finding the first parse error</a>
   given <var>result</var>.</li><li><p>If <var>parse error</var> is null, then:</p>

    <ol><li><p>Let <var>record</var> be <var>result</var>'s <a href=#concept-script-record id=fetching-scripts:concept-script-record-3>record</a>.</li><li>
      <p>Perform <var>record</var>.<a href=https://tc39.github.io/ecma262/#sec-moduledeclarationinstantiation id=fetching-scripts:js-instantiate data-x-internal=js-instantiate>Instantiate</a>().</p>

      <p class=note>This step will recursively call <a href=https://tc39.github.io/ecma262/#sec-moduledeclarationinstantiation id=fetching-scripts:js-instantiate-2 data-x-internal=js-instantiate>Instantiate</a> on all of the module's uninstantiated
      dependencies.</p>

      <p>If this throws an exception, set <var>result</var>'s <a href=#concept-script-error-to-rethrow id=fetching-scripts:concept-script-error-to-rethrow>error to rethrow</a> to that exception.</p>
     </li></ol>
   </li><li><p>Otherwise, set <var>result</var>'s <a href=#concept-script-error-to-rethrow id=fetching-scripts:concept-script-error-to-rethrow-2>error to
   rethrow</a> to <var>parse error</var>.</li><li><p>Asynchronously complete this algorithm with <var>result</var>.</li></ol>

  <p>To <dfn id=finding-the-first-parse-error>find the first parse error</dfn> given a root
  <var>moduleScript</var> and an optional <var>discoveredSet</var>:</p>

  <ol><li><p>Let <var>moduleMap</var> be <var>moduleScript</var>'s <a href=#settings-object id=fetching-scripts:settings-object-3>settings object</a>'s
   <a href=#concept-settings-object-module-map id=fetching-scripts:concept-settings-object-module-map-2>module map</a>.</li><li><p>If <var>discoveredSet</var> was not given, let it be an empty <a id=fetching-scripts:set-2 href=https://triple-underscore.github.io/infra-ja.html#ordered-set data-x-internal=set>set</a>.</li><li><p><a href=https://infra.spec.whatwg.org/#list-append id=fetching-scripts:list-append-2 data-x-internal=list-append>Append</a> <var>moduleScript</var> to
   <var>discoveredSet</var>.</li><li><p>If <var>moduleScript</var>'s <a href=#concept-script-record id=fetching-scripts:concept-script-record-4>record</a> is null,
   then return <var>moduleScript</var>'s <a href=#concept-script-parse-error id=fetching-scripts:concept-script-parse-error>parse
   error</a>.</li><li><p>Let <var>childSpecifiers</var> be the value of <var>moduleScript</var>'s <a href=#concept-script-record id=fetching-scripts:concept-script-record-5>record</a>'s [[RequestedModules]] internal slot.</li><li><p>Let <var>childURLs</var> be the <a id=fetching-scripts:list-2 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> obtained by calling <a href=#resolve-a-module-specifier id=fetching-scripts:resolve-a-module-specifier-3>resolve a
   module specifier</a> once for each item of <var>childSpecifiers</var>,
   given <var>moduleScript</var> and that item. (None of these will ever fail, as otherwise
   <var>moduleScript</var> would have been marked as itself having a parse error.)</li><li><p>Let <var>childModules</var> be the <a id=fetching-scripts:list-3 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> obtained by <a href=https://triple-underscore.github.io/infra-ja.html#map-get id=fetching-scripts:map-get data-x-internal=map-get>getting each value</a> in <var>moduleMap</var> whose key is given by an
   item of <var>childURLs</var>.</li><li>
    <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=fetching-scripts:list-iterate-3 data-x-internal=list-iterate>For each</a> <var>childModule</var> of
    <var>childModules</var>:</p>

    <ol><li><p>Assert: <var>childModule</var> is a <a href=#module-script id=fetching-scripts:module-script-10>module script</a> (i.e., it is not "<code>fetching</code>" or null); by now all <a href=#module-script id=fetching-scripts:module-script-11>module
     scripts</a> in the graph rooted at <var>moduleScript</var> will have successfully been
     fetched.</li><li><p>If <var>discoveredSet</var> already <a href=https://triple-underscore.github.io/infra-ja.html#list-contain id=fetching-scripts:list-contains-3 data-x-internal=list-contains>contains</a>
     <var>childModule</var>, <a id=fetching-scripts:continue href=https://triple-underscore.github.io/infra-ja.html#iteration-continue data-x-internal=continue>continue</a>.</li><li><p>Let <var>childParseError</var> be the result of <a href=#finding-the-first-parse-error id=fetching-scripts:finding-the-first-parse-error-2>finding the first parse
     error</a> given <var>childModule</var> and <var>discoveredSet</var>.</li><li><p>If <var>childParseError</var> is not null, return <var>childParseError</var>.</li></ol>
   </li><li><p>Return null.</li></ol>

  <h5 id=creating-scripts><span class=secno>8.1.3.3</span> Creating scripts<a href=#creating-scripts class=self-link></a></h5>

  <p>To <dfn id=creating-a-classic-script>create a classic script</dfn>, given a
  <a id=creating-scripts:javascript-string href=https://triple-underscore.github.io/infra-ja.html#javascript-string data-x-internal=javascript-string>JavaScript string</a> <var>source</var>, an <a href=#environment-settings-object id=creating-scripts:environment-settings-object>environment settings object</a>
  <var>settings</var>, a <a id=creating-scripts:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> <var>baseURL</var>, some <a href=#script-fetch-options id=creating-scripts:script-fetch-options>script fetch options</a>
  <var>options</var>, and an optional <var>muted errors</var> boolean:</p>

  <ol><li><p>If <var>muted errors</var> was not provided, let it be false.</li><li><p>If <a href=#concept-bc-noscript id=creating-scripts:concept-bc-noscript>scripting is disabled</a> for
   <var>settings</var>'s <a href=#responsible-browsing-context id=creating-scripts:responsible-browsing-context>responsible browsing context</a>, then set <var>source</var> to
   the empty string.</li><li><p>Let <var>script</var> be a new <a href=#classic-script id=creating-scripts:classic-script>classic script</a> that this algorithm will
   subsequently initialize.</li><li><p>Set <var>script</var>'s <a href=#settings-object id=creating-scripts:settings-object>settings object</a> to <var>settings</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-base-url id=creating-scripts:concept-script-base-url>base URL</a> to
   <var>baseURL</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-script-fetch-options id=creating-scripts:concept-script-script-fetch-options>fetch
   options</a> to <var>options</var>.</li><li><p>Set <var>script</var>'s <a href=#muted-errors id=creating-scripts:muted-errors>muted errors</a> to <var>muted errors</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-parse-error id=creating-scripts:concept-script-parse-error>parse error</a> and
   <a href=#concept-script-error-to-rethrow id=creating-scripts:concept-script-error-to-rethrow>error to rethrow</a> to null.</li><li>
    <p>Let <var>result</var> be <a href=https://tc39.github.io/ecma262/#sec-parse-script id=creating-scripts:js-parsescript data-x-internal=js-parsescript>ParseScript</a>(<var>source</var>,
    <var>settings</var>'s <a href="#environment-settings-object's-realm" id="creating-scripts:environment-settings-object's-realm">Realm</a>,
    <var>script</var>).</p>

    <p class=note>Passing <var>script</var> as the last parameter here ensures
    <var>result</var>.[[HostDefined]] will be <var>script</var>.</p>
   </li><li>
    <p>If <var>result</var> is a <a id=creating-scripts:list href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of errors, then:

    

    <ol><li><p>Set <var>script</var>'s <a href=#concept-script-parse-error id=creating-scripts:concept-script-parse-error-2>parse error</a> and
     its <a href=#concept-script-error-to-rethrow id=creating-scripts:concept-script-error-to-rethrow-2>error to rethrow</a> to
     <var>result</var>[0].</li><li><p>Return <var>script</var>.</li></ol>
   </li><li><p>Set <var>script</var>'s <a href=#concept-script-record id=creating-scripts:concept-script-record>record</a> to
   <var>result</var>.</li><li><p>Return <var>script</var>.</li></ol>

  <p>To <dfn id=creating-a-module-script>create a module script</dfn>, given a
  <a id=creating-scripts:javascript-string-2 href=https://triple-underscore.github.io/infra-ja.html#javascript-string data-x-internal=javascript-string>JavaScript string</a> <var>source</var>, an <a href=#environment-settings-object id=creating-scripts:environment-settings-object-2>environment settings object</a>
  <var>settings</var>, a <a id=creating-scripts:url-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> <var>baseURL</var>, and some <a href=#script-fetch-options id=creating-scripts:script-fetch-options-2>script fetch
  options</a> <var>options</var>:</p>

  <ol><li><p>If <a href=#concept-bc-noscript id=creating-scripts:concept-bc-noscript-2>scripting is disabled</a> for
   <var>settings</var>'s <a href=#responsible-browsing-context id=creating-scripts:responsible-browsing-context-2>responsible browsing context</a>, then set <var>source</var> to
   the empty string.</li><li><p>Let <var>script</var> be a new <a href=#module-script id=creating-scripts:module-script>module script</a> that this algorithm will
   subsequently initialize.</li><li><p>Set <var>script</var>'s <a href=#settings-object id=creating-scripts:settings-object-2>settings object</a> to <var>settings</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-base-url id=creating-scripts:concept-script-base-url-2>base URL</a> to
   <var>baseURL</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-script-fetch-options id=creating-scripts:concept-script-script-fetch-options-2>fetch
   options</a> to <var>options</var>.</li><li><p>Set <var>script</var>'s <a href=#concept-script-parse-error id=creating-scripts:concept-script-parse-error-3>parse error</a> and
   <a href=#concept-script-error-to-rethrow id=creating-scripts:concept-script-error-to-rethrow-3>error to rethrow</a> to null.</li><li>
    <p>Let <var>result</var> be <a href=https://tc39.github.io/ecma262/#sec-parsemodule id=creating-scripts:js-parsemodule data-x-internal=js-parsemodule>ParseModule</a>(<var>source</var>,
    <var>settings</var>'s <a href="#environment-settings-object's-realm" id="creating-scripts:environment-settings-object's-realm-2">Realm</a>,
    <var>script</var>).</p>

    <p class=note>Passing <var>script</var> as the last parameter here ensures
    <var>result</var>.[[HostDefined]] will be <var>script</var>.</p>
   </li><li>
    <p>If <var>result</var> is a <a id=creating-scripts:list-2 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of errors, then:</p>

    <ol><li><p>Set <var>script</var>'s <a href=#concept-script-parse-error id=creating-scripts:concept-script-parse-error-4>parse error</a> to
     <var>result</var>[0].</li><li><p>Return <var>script</var>.</li></ol>
   </li><li id=validate-requested-module-specifiers>
    <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=creating-scripts:list-iterate data-x-internal=list-iterate>For each</a> string <var>requested</var> of
    <var>result</var>.[[RequestedModules]]:</p>

    <ol><li><p>Let <var>url</var> be the result of <a href=#resolve-a-module-specifier id=creating-scripts:resolve-a-module-specifier>resolving
     a module specifier</a> given <var>script</var> and <var>requested</var>.</li><li>
      <p>If <var>url</var> is failure, then:</p>

      <ol><li><p>Let <var>error</var> be a new <code id=creating-scripts:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> exception.</li><li><p>Set <var>script</var>'s <a href=#concept-script-parse-error id=creating-scripts:concept-script-parse-error-5>parse error</a>
       to <var>error</var>.</li><li><p>Return <var>script</var>.</li></ol>
     </li></ol>

    <p class=note>This step is essentially validating all of the requested module specifiers. We
    treat a module with unresolvable module specifiers the same as one that cannot be parsed; in
    both cases, a syntactic issue makes it impossible to ever contemplate instantiating the module
    later.</p>
   </li><li><p>Set <var>script</var>'s <a href=#concept-script-record id=creating-scripts:concept-script-record-2>record</a> to
   <var>result</var>.</li><li><p>Return <var>script</var>.</li></ol>

  <h5 id=calling-scripts><span class=secno>8.1.3.4</span> Calling scripts<a href=#calling-scripts class=self-link></a></h5>

  <p>To <dfn id=run-a-classic-script data-export="">run a classic script</dfn> given a <a href=#classic-script id=calling-scripts:classic-script>classic script</a>
  <var>script</var> and an optional <var>rethrow errors</var> boolean:</p>

  <ol><li><p>If <var>rethrow errors</var> is not given, let it be false.</li><li><p>Let <var>settings</var> be the <a href=#settings-object id=calling-scripts:settings-object>settings object</a> of <var>script</var>.</li><li><p><a href=#check-if-we-can-run-script id=calling-scripts:check-if-we-can-run-script>Check if we can run script</a> with <var>settings</var>. If this returns "do
   not run" then return.</li><li><p><a href=#prepare-to-run-script id=calling-scripts:prepare-to-run-script>Prepare to run script</a> given <var>settings</var>.</li><li><p>Let <var>evaluationStatus</var> be null.</li><li><p>If <var>script</var>'s <a href=#concept-script-error-to-rethrow id=calling-scripts:concept-script-error-to-rethrow>error to
   rethrow</a> is not null, then set <var>evaluationStatus</var> to Completion { [[Type]]: throw,
   [[Value]]: <var>script</var>'s <a href=#concept-script-error-to-rethrow id=calling-scripts:concept-script-error-to-rethrow-2>error to
   rethrow</a>, [[Target]]: empty }.</li><li>
    <p>Otherwise, set <var>evaluationStatus</var> to <a href=https://tc39.github.io/ecma262/#sec-runtime-semantics-scriptevaluation id=calling-scripts:js-scriptevaluation data-x-internal=js-scriptevaluation>ScriptEvaluation</a>(<var>script</var>'s <a href=#concept-script-record id=calling-scripts:concept-script-record>record</a>).</p>

    <p>If <a href=https://tc39.github.io/ecma262/#sec-runtime-semantics-scriptevaluation id=calling-scripts:js-scriptevaluation-2 data-x-internal=js-scriptevaluation>ScriptEvaluation</a> does not complete because the
    user agent has <a href=#abort-a-running-script id=calling-scripts:abort-a-running-script>aborted the running script</a>, leave
    <var>evaluationStatus</var> as null.</p>
   </li><li>
    <p>If <var>evaluationStatus</var> is an abrupt completion, then:</p>

    <ol><li>
      <p>If <var>rethrow errors</var> is true and <var>script</var>'s <a href=#muted-errors id=calling-scripts:muted-errors>muted
      errors</a> is false, then:</p>

      <ol><li><p><a href=#clean-up-after-running-script id=calling-scripts:clean-up-after-running-script>Clean up after running script</a> with <var>settings</var>.</li><li><p>Rethrow <var>evaluationStatus</var>.[[Value]].</li></ol>

     </li><li>
      <p>If <var>rethrow errors</var> is true and <var>script</var>'s <a href=#muted-errors id=calling-scripts:muted-errors-2>muted
      errors</a> is true, then:</p>

      <ol><li><p><a href=#clean-up-after-running-script id=calling-scripts:clean-up-after-running-script-2>Clean up after running script</a> with <var>settings</var>.</li><li><p>Throw a <a id=calling-scripts:networkerror href=https://triple-underscore.github.io/WebIDL-ja.html#networkerror data-x-internal=networkerror>"<code>NetworkError</code>"</a> <code id=calling-scripts:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li></ol>
     </li><li>
      <p>Otherwise, <var>rethrow errors</var> is false. Perform the following steps:</p>

      <ol><li><p><a href=#report-the-exception id=calling-scripts:report-the-exception>Report the exception</a> given by <var>evaluationStatus</var>.[[Value]] for
       <var>script</var>.</li><li><p><a href=#clean-up-after-running-script id=calling-scripts:clean-up-after-running-script-3>Clean up after running script</a> with <var>settings</var>.</li><li><p>Return undefined.</li></ol>
     </li></ol>
   </li><li><p><a href=#clean-up-after-running-script id=calling-scripts:clean-up-after-running-script-4>Clean up after running script</a> with <var>settings</var>.</li><li>
    <p>If <var>evaluationStatus</var> is a normal completion, return
    <var>evaluationStatus</var>.[[Value]].</p>

    <p class=note>This value is only ever used by the <a href=browsing-the-web.html#javascript-protocol id=calling-scripts:javascript-protocol><code>javascript:</code> URL steps</a>.</p>
   </li><li><p>If we've reached this point, <var>evaluationStatus</var> was left as null because the
   script was <a href=#abort-a-running-script id=calling-scripts:abort-a-running-script-2>aborted prematurely</a> during evaluation.
   Return undefined.</li></ol>

  <p>To <dfn id=run-a-module-script data-export="">run a module script</dfn> given a <a href=#module-script id=calling-scripts:module-script>module script</a>
  <var>script</var>, with an optional <var>rethrow errors</var> boolean:</p>

  <ol><li><p>If <var>rethrow errors</var> is not given, let it be false.</li><li><p>Let <var>settings</var> be the <a href=#settings-object id=calling-scripts:settings-object-2>settings object</a> of <var>script</var>.</li><li><p><a href=#check-if-we-can-run-script id=calling-scripts:check-if-we-can-run-script-2>Check if we can run script</a> with <var>settings</var>. If this returns "do
   not run" then return.</li><li><p><a href=#prepare-to-run-script id=calling-scripts:prepare-to-run-script-2>Prepare to run script</a> given <var>settings</var>.</li><li><p>Let <var>evaluationStatus</var> be null.</li><li><p>If <var>script</var>'s <a href=#concept-script-error-to-rethrow id=calling-scripts:concept-script-error-to-rethrow-3>error to
   rethrow</a> is not null, then set <var>evaluationStatus</var> to Completion { [[Type]]: throw,
   [[Value]]: <var>script</var>'s <a href=#concept-script-error-to-rethrow id=calling-scripts:concept-script-error-to-rethrow-4>error to
   rethrow</a>, [[Target]]: empty }.</li><li>
    <p>Otherwise:</p>

    <ol><li><p>Let <var>record</var> be <var>script</var>'s <a href=#concept-script-record id=calling-scripts:concept-script-record-2>record</a>.</p>

     </li><li>
      <p>Set <var>evaluationStatus</var> to <var>record</var>.<a href=https://tc39.github.io/ecma262/#sec-moduleevaluation id=calling-scripts:js-evaluate data-x-internal=js-evaluate>Evaluate</a>().</p>

      <p class=note>This step will recursively evaluate all of the module's dependencies.</p>

      <p>If <a href=https://tc39.github.io/ecma262/#sec-moduleevaluation id=calling-scripts:js-evaluate-2 data-x-internal=js-evaluate>Evaluate</a> fails to complete as a result of the user agent
      <a href=#abort-a-running-script id=calling-scripts:abort-a-running-script-3>aborting the running script</a>, then set
      <var>evaluationStatus</var> to Completion { [[Type]]: throw, [[Value]]: a new
      <a id=calling-scripts:quotaexceedederror href=https://triple-underscore.github.io/WebIDL-ja.html#quotaexceedederror data-x-internal=quotaexceedederror>"<code>QuotaExceededError</code>"</a> <code id=calling-scripts:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>, [[Target]]: empty
      }.</p>
     </li></ol>
   </li><li>
    <p>If <var>evaluationStatus</var> is an abrupt completion, then:</p>

    <ol><li><p>If <var>rethrow errors</var> is true, rethrow the exception given by
     <var>evaluationStatus</var>.[[Value]].</li><li><p>Otherwise, <a href=#report-the-exception id=calling-scripts:report-the-exception-2>report the exception</a> given by
     <var>evaluationStatus</var>.[[Value]] for <var>script</var>.</li></ol>
   </li><li><p><a href=#clean-up-after-running-script id=calling-scripts:clean-up-after-running-script-5>Clean up after running script</a> with <var>settings</var>.</li></ol>

  <p>The steps to <dfn id=check-if-we-can-run-script>check if we can run script</dfn> with an <a href=#environment-settings-object id=calling-scripts:environment-settings-object>environment settings
  object</a> <var>settings</var> are as follows. They return either "run" or "do not run".</p>

  <ol><li><p>If the <a href=#concept-settings-object-global id=calling-scripts:concept-settings-object-global>global object</a> specified by
   <var>settings</var> is a <code id=calling-scripts:window><a href=window-object.html#window>Window</a></code> object whose <code id=calling-scripts:document><a href=dom.html#document>Document</a></code> object is not
   <a id=calling-scripts:fully-active href=browsers.html#fully-active>fully active</a>, then return "do not run".</p>

   </li><li><p>If <a href=#concept-bc-noscript id=calling-scripts:concept-bc-noscript>scripting is disabled</a> for the
   <a href=#responsible-browsing-context id=calling-scripts:responsible-browsing-context>responsible browsing context</a> specified by <var>settings</var>, then return "do
   not run".</p>

   </li><li><p>Return "run".</li></ol>

  <p>The steps to <dfn id=prepare-to-run-script data-export="">prepare to run script</dfn> with an <a href=#environment-settings-object id=calling-scripts:environment-settings-object-2>environment settings
  object</a> <var>settings</var> are as follows:</p>

  <ol><li><p>Push <var>settings</var>'s <a href=#realm-execution-context id=calling-scripts:realm-execution-context>realm execution context</a> onto the <a id=calling-scripts:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript
   execution context stack</a>; it is now the <a id=calling-scripts:running-javascript-execution-context href=https://tc39.github.io/ecma262/#running-execution-context data-x-internal=running-javascript-execution-context>running JavaScript execution
   context</a>.</li></ol>

  <p>The steps to <dfn id=clean-up-after-running-script data-export="">clean up after running script</dfn> with an <a href=#environment-settings-object id=calling-scripts:environment-settings-object-3>environment
  settings object</a> <var>settings</var> are as follows:</p>

  <ol><li><p>Assert: <var>settings</var>'s <a href=#realm-execution-context id=calling-scripts:realm-execution-context-2>realm execution context</a> is the <a id=calling-scripts:running-javascript-execution-context-2 href=https://tc39.github.io/ecma262/#running-execution-context data-x-internal=running-javascript-execution-context>running
   JavaScript execution context</a>.</li><li><p>Remove <var>settings</var>'s <a href=#realm-execution-context id=calling-scripts:realm-execution-context-3>realm execution context</a> from the
   <a id=calling-scripts:javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</li><li><p>If the <a id=calling-scripts:javascript-execution-context-stack-3 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a> is now empty, <a href=#perform-a-microtask-checkpoint id=calling-scripts:perform-a-microtask-checkpoint>perform a
   microtask checkpoint</a>. (If this runs scripts, these algorithms will be invoked
   reentrantly.)</li></ol>

  <p class=note>These algorithms are not invoked by one script directly calling another, but they
  can be invoked reentrantly in an indirect manner, e.g. if a script dispatches an event which has
  event listeners registered.</p>

  <p>The <dfn id=running-script>running script</dfn> is the <a id=calling-scripts:the-script-element href=scripting.html#the-script-element>script</a> in the [[HostDefined]] field in the
  ScriptOrModule component of the <a id=calling-scripts:running-javascript-execution-context-3 href=https://tc39.github.io/ecma262/#running-execution-context data-x-internal=running-javascript-execution-context>running JavaScript execution context</a>.</p>

  <h5 id=realms-settings-objects-global-objects><span class=secno>8.1.3.5</span> Realms, settings objects, and global objects<a href=#realms-settings-objects-global-objects class=self-link></a></h5>

  <p>A <dfn id=global-object data-export="">global object</dfn> is a JavaScript object that is the [[GlobalObject]]
  field of a <a id=realms-settings-objects-global-objects:javascript-realm href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a>.</p>

  <p class=note>In this specification, all <a href=https://tc39.github.io/ecma262/#sec-code-realms id=realms-settings-objects-global-objects:javascript-realm-2 data-x-internal=javascript-realm>JavaScript
  realms</a> are <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=realms-settings-objects-global-objects:js-initializehostdefinedrealm data-x-internal=js-initializehostdefinedrealm>initialized</a> with <a href=#global-object id=realms-settings-objects-global-objects:global-object>global objects</a> that are either <code id=realms-settings-objects-global-objects:window><a href=window-object.html#window>Window</a></code> or
  <code id=realms-settings-objects-global-objects:workerglobalscope><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> objects.</p>

  <p>There is always a 1-to-1-to-1 mapping between <a href=https://tc39.github.io/ecma262/#sec-code-realms id=realms-settings-objects-global-objects:javascript-realm-3 data-x-internal=javascript-realm>JavaScript
  realms</a>, <a href=#global-object id=realms-settings-objects-global-objects:global-object-2>global objects</a>, and <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object>environment settings objects</a>:</p>

  <ul><li><p>A <a id=realms-settings-objects-global-objects:javascript-realm-4 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a> has a [[HostDefined]] field, which contains <dfn data-dfn-for=Realm id=concept-realm-settings-object data-lt="settings object" data-export="">the Realm's settings object</dfn>.</li><li><p>A <a id=realms-settings-objects-global-objects:javascript-realm-5 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a> has a [[GlobalObject]] field, which contains <dfn data-dfn-for=Realm id=concept-realm-global data-lt="global object" data-export="">the
   Realm's global object</dfn>.</li><li><p>Each <a href=#global-object id=realms-settings-objects-global-objects:global-object-3>global object</a> in this specification is created during the <a href=https://tc39.github.io/ecma262/#sec-initializehostdefinedrealm id=realms-settings-objects-global-objects:js-initializehostdefinedrealm-2 data-x-internal=js-initializehostdefinedrealm>initialization</a> of a corresponding <a id=realms-settings-objects-global-objects:javascript-realm-6 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript
   realm</a>, known as <dfn data-dfn-for="global object" id=concept-global-object-realm data-lt=Realm data-export="">the global object's Realm</dfn>.</li><li id=relevant-settings-object-for-a-global-object><p>Each <a href=#global-object id=realms-settings-objects-global-objects:global-object-4>global object</a> in this
   specification is created alongside a corresponding <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object-2>environment settings object</a>,
   known as its <a href=#relevant-settings-object id=realms-settings-objects-global-objects:relevant-settings-object>relevant settings object</a>.</p>

   </li><li><p>An <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object-3>environment settings object</a>'s <a href=#realm-execution-context id=realms-settings-objects-global-objects:realm-execution-context>realm execution context</a>'s
   Realm component is <dfn data-dfn-for="environment settings object" id="environment-settings-object's-realm" data-lt=Realm data-export="">the environment settings object's
   Realm</dfn>.</li><li><p>An <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object-4>environment settings object</a>'s <a href="#environment-settings-object's-realm" id="realms-settings-objects-global-objects:environment-settings-object's-realm">Realm</a> then has a [[GlobalObject]] field, which contains <dfn data-dfn-for="environment
   settings object" id=concept-settings-object-global data-lt="global object" data-export="">the environment settings object's global object</dfn>.</li></ul>

  <hr>

  <p>When defining algorithm steps throughout this specification, it is often important to indicate
  what <a id=realms-settings-objects-global-objects:javascript-realm-7 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a> is to be used—or, equivalently, what <a href=#global-object id=realms-settings-objects-global-objects:global-object-5>global object</a>
  or <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object-5>environment settings object</a> is to be used. In general, there are at least four
  possibilities:</p>

  <dl><dt><dfn id=concept-entry-everything>Entry</dfn><dd>This corresponds to the script that initiated the currently running script action: i.e.,
    the function or script that the user agent called into when it called into author code.<dt><dfn id=concept-incumbent-everything>Incumbent</dfn><dd>This corresponds to the most-recently-entered author function or script on the stack, or the
    author function or script that originally scheduled the currently-running callback.<dt><dfn id=concept-current-everything>Current</dfn><dd>This corresponds to the currently-running function object, including built-in user-agent
    functions which might not be implemented as JavaScript. (It is derived from the <a href=https://tc39.github.io/ecma262/#current-realm id=realms-settings-objects-global-objects:current-realm-record data-x-internal=current-realm-record>current JavaScript realm</a>.)<dt><dfn id=concept-relevant-everything>Relevant</dfn><dd>Every <a id=realms-settings-objects-global-objects:platform-object href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> has a <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm>relevant
    Realm</a>, which is roughly the <a id=realms-settings-objects-global-objects:javascript-realm-8 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a> in which it was created. When
    writing algorithms, the most prominent <a id=realms-settings-objects-global-objects:platform-object-2 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> whose <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm-2>relevant Realm</a> might be important is the <b>this</b>
    value of the currently-running function object. In some cases, there can be other important
    <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm-3>relevant Realms</a>, such as those of any
    arguments.</dl>

  <p>Note how the <a href=#concept-entry-everything id=realms-settings-objects-global-objects:concept-entry-everything>entry</a>, <a href=#concept-incumbent-everything id=realms-settings-objects-global-objects:concept-incumbent-everything>incumbent</a>, and <a href=#concept-current-everything id=realms-settings-objects-global-objects:concept-current-everything>current</a> concepts are usable without qualification,
  whereas the <a href=#concept-relevant-everything id=realms-settings-objects-global-objects:concept-relevant-everything>relevant</a> concept must be applied to
  a particular <a id=realms-settings-objects-global-objects:platform-object-3 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a>.</p>

  <div class=example>

   <p>Consider the following pages, with <code>a.html</code> being loaded in a browser
   window, <code>b.html</code> being loaded in an <code id=realms-settings-objects-global-objects:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> as shown, and <code>c.html</code> and <code>d.html</code> omitted (they can simply be empty
   documents):</p>

   <pre>&lt;!-- a.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Entry page&lt;/title&gt;

&lt;iframe src="b.html"&gt;&lt;/iframe&gt;
&lt;button onclick="frames[0].hello()"&gt;Hello&lt;/button&gt;

&lt;!--b.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Incumbent page&lt;/title&gt;

&lt;iframe src="c.html" id="c"&gt;&lt;/iframe&gt;
&lt;iframe src="d.html" id="d"&gt;&lt;/iframe&gt;

&lt;script&gt;
  const c = document.querySelector("#c").contentWindow;
  const d = document.querySelector("#d").contentWindow;

  window.hello = () =&gt; {
    c.print.call(d);
  };
&lt;/script&gt;</pre>

   <p>Each page has its own <a id=realms-settings-objects-global-objects:browsing-context href=browsers.html#browsing-context>browsing context</a>, and thus its own <a id=realms-settings-objects-global-objects:javascript-realm-9 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript
   realm</a>, <a href=#global-object id=realms-settings-objects-global-objects:global-object-6>global object</a>, and <a href=#environment-settings-object id=realms-settings-objects-global-objects:environment-settings-object-6>environment settings object</a>.</p>

   <p>When the <code id=realms-settings-objects-global-objects:dom-print><a href=timers-and-user-prompts.html#dom-print>print()</a></code> method is called in response to pressing the
   button in <code>a.html</code>, then:</p>

   <ul><li><p>The <a href=#concept-entry-realm id=realms-settings-objects-global-objects:concept-entry-realm>entry Realm</a> is that of <code>a.html</code>.</li><li><p>The <a href=#concept-incumbent-realm id=realms-settings-objects-global-objects:concept-incumbent-realm>incumbent Realm</a> is that of <code>b.html</code>.</li><li><p>The <a href=https://tc39.github.io/ecma262/#current-realm id=realms-settings-objects-global-objects:current-realm-record-2 data-x-internal=current-realm-record>current Realm</a> is that of <code>c.html</code> (since it is the <code id=realms-settings-objects-global-objects:dom-print-2><a href=timers-and-user-prompts.html#dom-print>print()</a></code> method from
    <code>c.html</code> whose code is running).</li><li><p>The <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm-4>relevant Realm</a> of the object on which
    the <code id=realms-settings-objects-global-objects:dom-print-3><a href=timers-and-user-prompts.html#dom-print>print()</a></code> method is being called is that of <code>d.html</code>.</li></ul>
  </div>

  <p class=warning>The <a href=#concept-incumbent-everything id=realms-settings-objects-global-objects:concept-incumbent-everything-2>incumbent</a> and <a href=#concept-entry-everything id=realms-settings-objects-global-objects:concept-entry-everything-2>entry</a> concepts should not be used by new specifications,
  as they are excessively complicated and unintuitive to work with. We are working to remove almost
  all existing uses from the platform: see <a href=https://github.com/whatwg/html/issues/1430>issue #1430</a> for <a href=#concept-incumbent-everything id=realms-settings-objects-global-objects:concept-incumbent-everything-3>incumbent</a>, and <a href=https://github.com/whatwg/html/issues/1431>issue #1431</a> for <a href=#concept-entry-everything id=realms-settings-objects-global-objects:concept-entry-everything-3>entry</a>.</p>

  <p>In general, web platform specifications should use the <a href=#concept-relevant-everything id=realms-settings-objects-global-objects:concept-relevant-everything-2>relevant</a> concept, applied to the object being operated
  on (usually the <b>this</b> value of the current method). This mismatches the JavaScript
  specification, where <a href=#concept-current-everything id=realms-settings-objects-global-objects:concept-current-everything-2>current</a> is generally used as
  the default (e.g. in determining the <a id=realms-settings-objects-global-objects:javascript-realm-10 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a> whose <code>Array</code> constructor should be used to construct the result in <code>Array.prototype.map</code>). But this inconsistency is so embedded in the platform that
  we have to accept it going forward.</p>

  <p>Note that in constructors, where there is no <b>this</b> value yet, the <a href=#concept-current-everything id=realms-settings-objects-global-objects:concept-current-everything-3>current</a> concept is the appropriate default.</p>

  <div class=example>
   <p>One reason why the <a href=#concept-relevant-everything id=realms-settings-objects-global-objects:concept-relevant-everything-3>relevant</a> concept is
   generally a better default choice than the <a href=#concept-current-everything id=realms-settings-objects-global-objects:concept-current-everything-4>current</a> concept is that it is more suitable for
   creating an object that is to be persisted and returned multiple times. For example, the <code id=realms-settings-objects-global-objects:dom-navigator-getbattery><a data-x-internal=dom-navigator-getbattery href=https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager>navigator.getBattery()</a></code> method creates promises in the
   <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm-5>relevant Realm</a> for the <code id=realms-settings-objects-global-objects:navigator><a href=system-state.html#navigator>Navigator</a></code> object
   on which it is invoked. This has the following impact: <a href=references.html#refsBATTERY>[BATTERY]</a>

   <pre>&lt;!-- outer.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Relevant Realm demo: outer page&lt;/title&gt;
&lt;script&gt;
  function doTest() {
    const promise = navigator.getBattery.call(frames[0].navigator);

    console.log(promise instanceof Promise);           // logs false
    console.log(promise instanceof frames[0].Promise); // logs true

    frames[0].hello();
  }
&lt;/script&gt;
&lt;iframe src="inner.html" onload="doTest()"&gt;&lt;/iframe&gt;

&lt;!-- inner.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;title&gt;Relevant Realm demo: inner page&lt;/title&gt;
&lt;script&gt;
  function hello() {
    const promise = navigator.getBattery();

    console.log(promise instanceof Promise);        // logs true
    console.log(promise instanceof parent.Promise); // logs false
  }
&lt;/script&gt;</pre>

   <p>If the algorithm for the <code id=realms-settings-objects-global-objects:dom-navigator-getbattery-2><a data-x-internal=dom-navigator-getbattery href=https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager>getBattery()</a></code> method
   had instead used the <a href=https://tc39.github.io/ecma262/#current-realm id=realms-settings-objects-global-objects:current-realm-record-3 data-x-internal=current-realm-record>current Realm</a>, all the results
   would be reversed. That is, after the first call to <code id=realms-settings-objects-global-objects:dom-navigator-getbattery-3><a data-x-internal=dom-navigator-getbattery href=https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager>getBattery()</a></code> in <code>outer.html</code>, the
   <code id=realms-settings-objects-global-objects:navigator-2><a href=system-state.html#navigator>Navigator</a></code> object in <code>inner.html</code> would be permanently storing
   a <code>Promise</code> object created in <code>outer.html</code>'s
   <a id=realms-settings-objects-global-objects:javascript-realm-11 href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a>, and calls like that inside the <code>hello()</code>
   function would thus return a promise from the "wrong" realm. Since this is undesirable, the
   algorithm instead uses the <a href=#concept-relevant-realm id=realms-settings-objects-global-objects:concept-relevant-realm-6>relevant Realm</a>, giving
   the sensible results indicated in the comments above.</p>
  </div>

  <hr>

  <p>The rest of this section deals with formally defining the <a href=#concept-entry-everything id=realms-settings-objects-global-objects:concept-entry-everything-4>entry</a>, <a href=#concept-incumbent-everything id=realms-settings-objects-global-objects:concept-incumbent-everything-4>incumbent</a>, <a href=#concept-current-everything id=realms-settings-objects-global-objects:concept-current-everything-5>current</a>, and <a href=#concept-relevant-everything id=realms-settings-objects-global-objects:concept-relevant-everything-4>relevant</a> concepts.</p>

  <h6 id=entry><span class=secno>8.1.3.5.1</span> Entry<a href=#entry class=self-link></a></h6>

  <p>The process of <a href=#calling-scripts>calling scripts</a> will push or pop <a href=#realm-execution-context id=entry:realm-execution-context>realm execution contexts</a> onto the <a id=entry:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript
  execution context stack</a>, interspersed with other <a href=https://tc39.github.io/ecma262/#sec-execution-contexts id=entry:javascript-execution-context data-x-internal=javascript-execution-context>execution contexts</a>.</p>

  <p>With this in hand, we define the <dfn id=entry-execution-context>entry execution context</dfn> to be the most recently
  pushed item in the <a id=entry:javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a> that is a <a href=#realm-execution-context id=entry:realm-execution-context-2>realm execution context</a>. The <dfn id=concept-entry-realm>entry
  Realm</dfn> is the <a href=#entry-execution-context id=entry:entry-execution-context>entry execution context</a>'s Realm component.</p>

  <p>Then, the <dfn id=entry-settings-object>entry settings object</dfn> is the <a href=#concept-realm-settings-object id=entry:concept-realm-settings-object>environment settings object</a> of the <a href=#concept-entry-realm id=entry:concept-entry-realm>entry Realm</a>.</p>

  <p>Similarly, the <dfn id=entry-global-object>entry global object</dfn> is the <a href=#concept-realm-global id=entry:concept-realm-global>global object</a> of the <a href=#concept-entry-realm id=entry:concept-entry-realm-2>entry
  Realm</a>.</p>

  <h6 id=incumbent><span class=secno>8.1.3.5.2</span> Incumbent<a href=#incumbent class=self-link></a></h6>

  <p>All <a href=https://tc39.github.io/ecma262/#sec-execution-contexts id=incumbent:javascript-execution-context data-x-internal=javascript-execution-context>JavaScript execution contexts</a> must
  contain, as part of their code evaluation state, a <dfn id=skip-when-determining-incumbent-counter>skip-when-determining-incumbent
  counter</dfn> value, which is initially zero. In the process of <a href=#prepare-to-run-a-callback id=incumbent:prepare-to-run-a-callback>preparing to run a callback</a> and <a href=#clean-up-after-running-a-callback id=incumbent:clean-up-after-running-a-callback>cleaning up after running a callback</a>, this value will be incremented and
  decremented.</p>

  <p>Every <a href=#event-loop id=incumbent:event-loop>event loop</a> has an associated <dfn id=backup-incumbent-settings-object-stack>backup incumbent settings object
  stack</dfn>, initially empty. Roughly speaking, it is used to determine the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object>incumbent
  settings object</a> when no author code is on the stack, but author code is responsible for the
  current algorithm having been run in some way. The process of <a href=#prepare-to-run-a-callback id=incumbent:prepare-to-run-a-callback-2>preparing to run a callback</a> and <a href=#clean-up-after-running-a-callback id=incumbent:clean-up-after-running-a-callback-2>cleaning up after running a callback</a> manipulate this stack. <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>

  <p>When Web IDL is used to <a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=incumbent:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>invoke</a> author
  code, or when <a href=#enqueuejob(queuename,-job,-arguments) id=incumbent:enqueuejob(queuename,-job,-arguments)>EnqueueJob</a> invokes a promise job, they use the following algorithms to
  track relevant data for determining the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-2>incumbent settings object</a>:</p>

  <p>To <dfn id=prepare-to-run-a-callback data-export="">prepare to run a callback</dfn> with an <a href=#environment-settings-object id=incumbent:environment-settings-object>environment settings
  object</a> <var>settings</var>:</p>

  <ol><li><p>Push <var>settings</var> onto the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack>backup incumbent settings object
   stack</a>.</li><li><p>Let <var>context</var> be the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context>topmost script-having execution
   context</a>.</li><li><p>If <var>context</var> is not null, increment <var>context</var>'s
   <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter>skip-when-determining-incumbent counter</a>.</li></ol>

  <p>To <dfn id=clean-up-after-running-a-callback data-export="">clean up after running a callback</dfn> with an <a href=#environment-settings-object id=incumbent:environment-settings-object-2>environment
  settings object</a> <var>settings</var>:</p>

  <ol><li>
    <p>Let <var>context</var> be the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-2>topmost script-having execution context</a>.</p>

    <p class=note>This will be the same as the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-3>topmost script-having execution
    context</a> inside the corresponding invocation of <a href=#prepare-to-run-a-callback id=incumbent:prepare-to-run-a-callback-3>prepare to run a
    callback</a>.</p>
   </li><li><p>If <var>context</var> is not null, decrement <var>context</var>'s
   <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-2>skip-when-determining-incumbent counter</a>.</li><li><p>Assert: the topmost entry of the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-2>backup incumbent settings object stack</a> is
   <var>settings</var>.</li><li><p>Remove <var>settings</var> from the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-3>backup incumbent settings object
   stack</a>.</li></ol>

  <p>Here, the <dfn id=topmost-script-having-execution-context>topmost script-having execution context</dfn> is the topmost entry of the
  <a id=incumbent:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a> that has a non-null ScriptOrModule component, or
  null if there is no such entry in the <a id=incumbent:javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</p>

  <p>With all this in place, the <dfn id=incumbent-settings-object data-export="">incumbent settings object</dfn> is determined
  as follows:</p>

  <ol><li><p>Let <var>context</var> be the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-4>topmost script-having execution
   context</a>.</li><li>
    <p>If <var>context</var> is null, or if <var>context</var>'s
    <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-3>skip-when-determining-incumbent counter</a> is greater than zero, then:</p>

    <ol><li>
      <p>Assert: the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-4>backup incumbent settings object stack</a> is not empty.</p>

      <p class=note>This assert would fail if you try to obtain the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-3>incumbent settings
      object</a> from inside an algorithm that was triggered neither by <a href=#calling-scripts>calling scripts</a> nor by Web IDL <a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=incumbent:es-invoking-callback-functions-2 data-x-internal=es-invoking-callback-functions>invoking</a> a callback. For example, it would
      trigger if you tried to obtain the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-4>incumbent settings object</a> inside an algorithm
      that ran periodically as part of the <a href=#event-loop id=incumbent:event-loop-2>event loop</a>, with no involvement of author
      code. In such cases the <a href=#concept-incumbent-everything id=incumbent:concept-incumbent-everything>incumbent</a> concept
      cannot be used.</p>
     </li><li><p>Return the topmost entry of the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-5>backup incumbent settings object
     stack</a>.</li></ol>
   </li><li><p>Return <var>context</var>'s Realm component's <a href=#concept-realm-settings-object id=incumbent:concept-realm-settings-object>settings object</a>.</li></ol>

  <p>Then, the <dfn id=concept-incumbent-realm>incumbent Realm</dfn> is the <a href="#environment-settings-object's-realm" id="incumbent:environment-settings-object's-realm">Realm</a> of the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-5>incumbent settings
  object</a>.</p>

  <p>Similarly, the <dfn id=concept-incumbent-global>incumbent global object</dfn> is the
  <a href=#concept-settings-object-global id=incumbent:concept-settings-object-global>global object</a> of the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-6>incumbent
  settings object</a>.</p>

  <hr>

  <p>The following series of examples is intended to make it clear how all of the different
  mechanisms contribute to the definition of the <a href=#incumbent>incumbent</a> concept:</p>

  <div class=example>
   <p>Consider the following very simple example:</p>

   <pre>&lt;!DOCTYPE html&gt;
&lt;iframe&gt;&lt;/iframe&gt;
&lt;script&gt;
  new frames[0].MessageChannel();
&lt;/script&gt;</pre>

   <p>When the <code id=incumbent:dom-messagechannel><a href=web-messaging.html#dom-messagechannel>MessageChannel()</a></code> constructor looks up the
   <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-7>incumbent settings object</a> to use as the <a href=web-messaging.html#concept-port-owner id=incumbent:concept-port-owner>owner</a> of the new <code id=incumbent:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> objects, the
   <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-5>topmost script-having execution context</a> will be that corresponding to the
   <code id=incumbent:the-script-element><a href=scripting.html#the-script-element>script</a></code> element: it was pushed onto the <a id=incumbent:javascript-execution-context-stack-3 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context
   stack</a> as part of <a href=https://tc39.github.io/ecma262/#sec-runtime-semantics-scriptevaluation id=incumbent:js-scriptevaluation data-x-internal=js-scriptevaluation>ScriptEvaluation</a> during the
   <a href=#run-a-classic-script id=incumbent:run-a-classic-script>run a classic script</a> algorithm. Since there are no Web IDL callback invocations
   involved, the context's <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-4>skip-when-determining-incumbent counter</a> is zero, so it is
   used to determine the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-8>incumbent settings object</a>; the result is the <a href=#environment-settings-object id=incumbent:environment-settings-object-3>environment
   settings object</a> of <code>window</code>.</p>

   <p>(In this example, the <a href=#environment-settings-object id=incumbent:environment-settings-object-4>environment settings object</a> of <code>frames[0]</code> is not involved at all. It is the <a href=#current-settings-object id=incumbent:current-settings-object>current settings
   object</a>, but the <code id=incumbent:dom-messagechannel-2><a href=web-messaging.html#dom-messagechannel>MessageChannel()</a></code> constructor
   cares only about the incumbent, not current.)</p>
  </div>

  <div class=example>
   <p>Consider the following more complicated example:</p>

   <pre>&lt;!DOCTYPE html&gt;
&lt;iframe&gt;&lt;/iframe&gt;
&lt;script&gt;
  const bound = frames[0].postMessage.bind(frames[0], "some data", "*");
  window.setTimeout(bound);
&lt;/script&gt;</pre>

   <p>There are two interesting <a href=#environment-settings-object id=incumbent:environment-settings-object-5>environment settings
   objects</a> here: that of <code>window</code>, and that of <code>frames[0]</code>. Our concern is: what is the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-9>incumbent settings object</a> at
   the time that the algorithm for <code id=incumbent:dom-window-postmessage><a href=web-messaging.html#dom-window-postmessage>postMessage()</a></code>
   executes?</p>

   <p>It should be that of <code>window</code>, to capture the intuitive notion that the
   author script responsible for causing the algorithm to happen is executing in <code>window</code>, not <code>frames[0]</code>. Another way of capturing the
   intuition here is that invoking algorithms asynchronously (in this case via <code id=incumbent:dom-settimeout><a href=timers-and-user-prompts.html#dom-settimeout>setTimeout()</a></code>) should not change the <a href=#concept-incumbent-everything id=incumbent:concept-incumbent-everything-2>incumbent</a> concept.</p>

   <p>Let us now explain how the steps given above give us our intuitively-desired result of <code>window</code>'s <a href=#relevant-settings-object id=incumbent:relevant-settings-object>relevant settings object</a>.</p>

   <p>When <code>bound</code> is <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=incumbent:concept-idl-convert data-x-internal=concept-idl-convert>converted</a> to a
   Web IDL callback type, the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-10>incumbent settings object</a> is that corresponding to <code>window</code> (in the same manner as in our simple example above). Web IDL stores this
   as the resulting callback value's <a id=incumbent:callback-context href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a>.</p>

   <p>When the <a href=#concept-task id=incumbent:concept-task>task</a> posted by <code id=incumbent:dom-settimeout-2><a href=timers-and-user-prompts.html#dom-settimeout>setTimeout()</a></code> executes, the algorithm for that task uses Web IDL to
   <a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=incumbent:es-invoking-callback-functions-3 data-x-internal=es-invoking-callback-functions>invoke</a> the stored callback value. Web IDL in
   turn calls the above <a href=#prepare-to-run-a-callback id=incumbent:prepare-to-run-a-callback-4>prepare to run a callback</a> algorithm. This pushes the stored
   <a id=incumbent:callback-context-2 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a> onto the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-6>backup incumbent settings object stack</a>. At
   this time (inside the timer task) there is no author code on the stack, so the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-6>topmost
   script-having execution context</a> is null, and nothing gets its
   <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-5>skip-when-determining-incumbent counter</a> incremented.</p>

   <p>Invoking the callback then calls <code>bound</code>, which in turn calls
   the <code id=incumbent:dom-window-postmessage-2><a href=web-messaging.html#dom-window-postmessage>postMessage()</a></code> method of <code>frames[0]</code>. When the <code id=incumbent:dom-window-postmessage-3><a href=web-messaging.html#dom-window-postmessage>postMessage()</a></code>
   algorithm looks up the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-11>incumbent settings object</a>, there is still no author code on
   the stack, since the bound function just directly calls the built-in method. So the
   <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-7>topmost script-having execution context</a> will be null: the <a id=incumbent:javascript-execution-context-2 href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
   context</a> stack only contains an execution context corresponding to <code id=incumbent:dom-window-postmessage-4><a href=web-messaging.html#dom-window-postmessage>postMessage()</a></code>, with no <a href=https://tc39.github.io/ecma262/#sec-runtime-semantics-scriptevaluation id=incumbent:js-scriptevaluation-2 data-x-internal=js-scriptevaluation>ScriptEvaluation</a> context or similar below it.</p>

   <p>This is where we fall back to the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-7>backup incumbent settings object stack</a>. As
   noted above, it will contain as its topmost entry the <a href=#relevant-settings-object id=incumbent:relevant-settings-object-2>relevant settings object</a> of
   <code>window</code>. So that is what is used as the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-12>incumbent settings
   object</a> while executing the <code id=incumbent:dom-window-postmessage-5><a href=web-messaging.html#dom-window-postmessage>postMessage()</a></code>
   algorithm.</p>
  </div>

  <div class=example>
   <p>Consider this final, even more convoluted example:</p>

   <pre>&lt;!-- a.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;button&gt;click me&lt;/button&gt;
&lt;iframe&gt;&lt;/iframe&gt;
&lt;script&gt;
const bound = frames[0].location.assign.bind(frames[0].location, "https://example.com/");
document.querySelector("button").addEventListener("click", bound);
&lt;/script&gt;

&lt;!-- b.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;iframe src="a.html"&gt;&lt;/iframe&gt;
&lt;script&gt;
  const iframe = document.querySelector("iframe");
  iframe.onload = function onLoad() {
    iframe.contentWindow.document.querySelector("button").click();
  };
&lt;/script&gt;</pre>

   <p>Again there are two interesting <a href=#environment-settings-object id=incumbent:environment-settings-object-6>environment
   settings objects</a> in play: that of <code>a.html</code>, and that of <code>b.html</code>. When the <code id=incumbent:dom-location-assign><a href=history.html#dom-location-assign>location.assign()</a></code>
   method triggers the <a id=incumbent:location-object-navigate href=history.html#location-object-navigate><code>Location</code>-object navigate</a> algorithm, what will be
   the <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-13>incumbent settings object</a>? As before, it should intuitively be that of <code>a.html</code>: the <code id=incumbent:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> listener was originally
   scheduled by <code>a.html</code>, so even if something involving <code>b.html</code> causes the listener to fire, the <a href=#concept-incumbent-everything id=incumbent:concept-incumbent-everything-3>incumbent</a> responsible is that of <code>a.html</code>.</p>

   <p>The callback setup is similar to the previous example: when <code>bound</code> is
   <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=incumbent:concept-idl-convert-2 data-x-internal=concept-idl-convert>converted</a> to a Web IDL callback type, the
   <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-14>incumbent settings object</a> is that corresponding to <code>a.html</code>,
   which is stored as the callback's <a id=incumbent:callback-context-3 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a>.</p>

   <p>When the <code id=incumbent:dom-click><a href=interaction.html#dom-click>click()</a></code> method is called inside <code>b.html</code>, it <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=incumbent:concept-event-dispatch data-x-internal=concept-event-dispatch>dispatches</a> a <code id=incumbent:event-click-2><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event on the button that is inside <code>a.html</code>. This time, when the <a href=#prepare-to-run-a-callback id=incumbent:prepare-to-run-a-callback-5>prepare to run a callback</a> algorithm
   executes as part of event dispatch, there <em>is</em> author code on the stack; the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-8>topmost
   script-having execution context</a> is that of the <code>onLoad</code> function,
   whose <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-6>skip-when-determining-incumbent counter</a> gets incremented. Additionally, <code>a.html</code>'s <a href=#environment-settings-object id=incumbent:environment-settings-object-7>environment settings object</a> (stored as the
   <code id=incumbent:eventhandler><a href=#eventhandler>EventHandler</a></code>'s <a id=incumbent:callback-context-4 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a>) is pushed onto the
   <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-8>backup incumbent settings object stack</a>.</p>

   <p>Now, when the <a id=incumbent:location-object-navigate-2 href=history.html#location-object-navigate><code>Location</code>-object navigate</a> algorithm looks up the
   <a href=#incumbent-settings-object id=incumbent:incumbent-settings-object-15>incumbent settings object</a>, the <a href=#topmost-script-having-execution-context id=incumbent:topmost-script-having-execution-context-9>topmost script-having execution
   context</a> is still that of the <code>onLoad</code> function (due to the fact we
   are using a bound function as the callback). Its <a href=#skip-when-determining-incumbent-counter id=incumbent:skip-when-determining-incumbent-counter-7>skip-when-determining-incumbent
   counter</a> value is one, however, so we fall back to the <a href=#backup-incumbent-settings-object-stack id=incumbent:backup-incumbent-settings-object-stack-9>backup incumbent settings
   object stack</a>. This gives us the <a href=#environment-settings-object id=incumbent:environment-settings-object-8>environment settings object</a> of <code>a.html</code>, as expected.</p>

   <p>Note that this means that even though it is the <code id=incumbent:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> inside <code>a.html</code> that navigates, it is <code>a.html</code> itself that is used
   as the <a id=incumbent:source-browsing-context href=browsing-the-web.html#source-browsing-context>source browsing context</a>, which determines among other things the <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-request-client id=incumbent:concept-request-client data-x-internal=concept-request-client>request client</a>. This is <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26603#c36">perhaps the only justifiable use
   of the incumbent concept on the web platform</a>; in all other cases the consequences of using it
   are simply confusing and we hope to one day switch them to use <a href=#concept-current-everything id=incumbent:concept-current-everything>current</a> or <a href=#concept-relevant-everything id=incumbent:concept-relevant-everything>relevant</a> as appropriate.</p>
  </div>

  <h6 id=current><span class=secno>8.1.3.5.3</span> Current<a href=#current class=self-link></a></h6>

  <p>The JavaScript specification defines the <a id=current:current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>, sometimes
  abbreviated to the "current Realm". <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <p>Then, the <dfn id=current-settings-object data-export="">current settings object</dfn> is the <a href=#concept-realm-settings-object id=current:concept-realm-settings-object>environment settings object</a> of the <a id=current:current-realm-record-2 href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current
  Realm Record</a>.</p>

  <p>Similarly, the <dfn id=current-global-object data-export="">current global object</dfn> is the <a href=#concept-realm-global id=current:concept-realm-global>global object</a> of the <a id=current:current-realm-record-3 href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.</p>

  <h6 id=relevant><span class=secno>8.1.3.5.4</span> Relevant<a href=#relevant class=self-link></a></h6>

  <p>The <dfn id=relevant-settings-object data-export="">relevant settings object</dfn> for a <a id=relevant:platform-object href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> is
  defined as follows:</p>

  <dl class=switch><dt>If the object is a <a href=#global-object id=relevant:global-object>global object</a><dd>Each <a href=#global-object id=relevant:global-object-2>global object</a> in this specification is created alongside a corresponding
   <a href=#environment-settings-object id=relevant:environment-settings-object>environment settings object</a>; that is its <a href=#relevant-settings-object id=relevant:relevant-settings-object>relevant settings object</a>.<dt>そうでなければ<dd>
    <p>The <a href=#relevant-settings-object id=relevant:relevant-settings-object-2>relevant settings object</a> for a non-global <a id=relevant:platform-object-2 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a>
    <var>o</var> is the <a href=#environment-settings-object id=relevant:environment-settings-object-2>environment settings object</a> whose <a href=#concept-settings-object-global id=relevant:concept-settings-object-global>global object</a> is the global object of the
    <a id=relevant:global-environment-associated-with href=https://triple-underscore.github.io/WebIDL-ja.html#es-platform-objects data-x-internal=global-environment-associated-with>global environment associated with</a> <var>o</var>.</p>

    <p class=note>The "<a id=relevant:global-environment-associated-with-2 href=https://triple-underscore.github.io/WebIDL-ja.html#es-platform-objects data-x-internal=global-environment-associated-with>global environment associated with</a>" concept is from the olden
    days, before the modern JavaScript specification and its concept of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=relevant:javascript-realm data-x-internal=javascript-realm>realms</a>. We expect that as the Web IDL specification gets updated, every
    <a id=relevant:platform-object-3 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> will have a <a href=https://tc39.github.io/ecma262/#sec-code-realms id=relevant:javascript-realm-2 data-x-internal=javascript-realm>Realm</a> associated
    with it, and this definition can be re-cast in those terms. <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a> <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>
   </dl>

  <p>Then, the <dfn id=concept-relevant-realm data-export="">relevant Realm</dfn> for a
  <a id=relevant:platform-object-4 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> is the <a href="#environment-settings-object's-realm" id="relevant:environment-settings-object's-realm">Realm</a> of its <a href=#relevant-settings-object id=relevant:relevant-settings-object-3>relevant settings object</a>.</p>

  <p>Similarly, the <dfn id=concept-relevant-global data-export="">relevant global
  object</dfn> for a <a id=relevant:platform-object-5 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object data-x-internal=platform-object>platform object</a> is the <a href=#concept-settings-object-global id=relevant:concept-settings-object-global-2>global object</a> of its <a href=#relevant-settings-object id=relevant:relevant-settings-object-4>relevant settings
  object</a>.</p>


  <h5 id=killing-scripts><span class=secno>8.1.3.6</span> Killing scripts<a href=#killing-scripts class=self-link></a></h5>

  <p>Although the JavaScript specification does not account for this possibility, it's sometimes
  necessary to <dfn id=abort-a-running-script>abort a running script</dfn>. This causes any <a href=https://tc39.github.io/ecma262/#sec-runtime-semantics-scriptevaluation id=killing-scripts:js-scriptevaluation data-x-internal=js-scriptevaluation>ScriptEvaluation</a> or <a id=killing-scripts:source-text-module-record href=https://tc39.github.io/ecma262/#sec-source-text-module-records data-x-internal=source-text-module-record>Source Text Module Record</a>
  <a href=https://tc39.github.io/ecma262/#sec-moduleevaluation id=killing-scripts:js-evaluate data-x-internal=js-evaluate>Evaluate</a> invocations to cease immediately, emptying the
  <a id=killing-scripts:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a> without triggering any of the normal mechanisms
  like <code>finally</code> blocks. <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <p>User agents may impose resource limitations on scripts, for example CPU quotas, memory limits,
  total execution time limits, or bandwidth limitations. When a script exceeds a limit, the user
  agent may either throw a <a id=killing-scripts:quotaexceedederror href=https://triple-underscore.github.io/WebIDL-ja.html#quotaexceedederror data-x-internal=quotaexceedederror>"<code>QuotaExceededError</code>"</a> <code id=killing-scripts:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>,
  <a href=#abort-a-running-script id=killing-scripts:abort-a-running-script>abort the script</a> without an exception, prompt the
  user, or throttle script execution.</p>

  <div class=example>

   <p>For example, the following script never terminates. A user agent could, after waiting for a
   few seconds, prompt the user to either terminate the script or let it continue.</p>

   <pre>&lt;script&gt;
 while (true) { /* loop */ }
&lt;/script&gt;</pre>

  </div>

  <p>User agents are encouraged to allow users to disable scripting whenever the user is prompted
  either by a script (e.g. using the <code id=killing-scripts:dom-alert><a href=timers-and-user-prompts.html#dom-alert>window.alert()</a></code> API) or because
  of a script's actions (e.g. because it has exceeded a time limit).</p>

  <p>If scripting is disabled while a script is executing, the script should be terminated
  immediately.</p>

  <p>User agents may allow users to specifically disable scripts just for the purposes of closing a
  <a id=killing-scripts:browsing-context href=browsers.html#browsing-context>browsing context</a>.</p>

  <p class=example>For example, the prompt mentioned in the example above could also offer the
  user with a mechanism to just close the page entirely, without running any <code id=killing-scripts:event-unload><a href=indices.html#event-unload>unload</a></code> event handlers.</p>

  <h5 id=integration-with-the-javascript-job-queue><span class=secno>8.1.3.7</span> Integration with the JavaScript job queue<a href=#integration-with-the-javascript-job-queue class=self-link></a></h5>

  <p>The JavaScript specification defines the JavaScript job and job queue abstractions in order to
  specify certain invariants about how promise operations execute with a clean <a id=integration-with-the-javascript-job-queue:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript
  execution context stack</a> and in a certain order. However, as of the time of this writing
  the definition of <a href=https://tc39.github.io/ecma262/#sec-enqueuejob id=integration-with-the-javascript-job-queue:js-enqueuejob data-x-internal=js-enqueuejob>EnqueueJob</a> in that specification is not
  sufficiently flexible to integrate with HTML as a host environment. <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <p class=note>This is not strictly true. It is in fact possible, by taking liberal advantage of
  the many "implementation defined" sections of the algorithm, to contort it to our purposes.
  However, the end result is a mass of messy indirection and workarounds that essentially bypasses
  the job queue infrastructure entirely, albeit in a way that is technically sanctioned within the
  bounds of implementation-defined behavior. We do not take this path, and instead introduce the
  following <a id=integration-with-the-javascript-job-queue:willful-violation href=introduction.html#willful-violation>willful violation</a>.</p>

  <p>As such, user agents must instead use the following definition in place of that in the
  JavaScript specification. These ensure that the promise jobs enqueued by the JavaScript
  specification are properly integrated into the user agent's <a href=#event-loop id=integration-with-the-javascript-job-queue:event-loop>event
  loops</a>.</p>

  <p>The <a id=integration-with-the-javascript-job-queue:runjobs href=https://tc39.github.io/ecma262/#sec-runjobs data-x-internal=runjobs>RunJobs</a> abstract operation from the JavaScript specification must
  not be used by user agents.</p>

  <h6 id=enqueuejob(queuename,-job,-arguments)><span class=secno>8.1.3.7.1</span> <dfn>EnqueueJob</dfn>(<var>queueName</var>, <var>job</var>, <var>arguments</var>)<a href=#enqueuejob(queuename,-job,-arguments) class=self-link></a></h6>

  <p>When the JavaScript specification says to call the EnqueueJob abstract operation, the
  following algorithm must be used in place of JavaScript's <a href=https://tc39.github.io/ecma262/#sec-enqueuejob id=enqueuejob(queuename,-job,-arguments):js-enqueuejob data-x-internal=js-enqueuejob>EnqueueJob</a>:</p>

  <ol><li><p>Assert: <var>queueName</var> is <code>"PromiseJobs"</code>. (<code>"ScriptJobs"</code> must not be used by user agents.)</li><li>
    <p>Let <var>job settings</var> be some appropriate <a href=#environment-settings-object id=enqueuejob(queuename,-job,-arguments):environment-settings-object>environment settings object</a>.</p>

    <p class=warning>It is not yet clear how to specify the <a href=#environment-settings-object id=enqueuejob(queuename,-job,-arguments):environment-settings-object-2>environment settings
    object</a> that should be used here. In practice, this means that the <a href=#concept-entry-everything id=enqueuejob(queuename,-job,-arguments):concept-entry-everything>entry</a> concept is not correctly specified while
    executing a job. See <a href=https://github.com/whatwg/html/pull/1189#issuecomment-224950188>discussion in issue
    #1189</a>.</p>
   </li><li><p>Let <var>incumbent settings</var> be the <a href=#incumbent-settings-object id=enqueuejob(queuename,-job,-arguments):incumbent-settings-object>incumbent settings object</a>.</li><li><p>Let <var>active script</var> be the <a href=#active-script id=enqueuejob(queuename,-job,-arguments):active-script>active script</a>.</li><li><p>Assert: <var>active script</var> is not null, as jobs are only enqueued by the JavaScript
   specification while a script is active.</li><li><p>Let <var>script execution context</var> be a new <a id=enqueuejob(queuename,-job,-arguments):javascript-execution-context href=https://tc39.github.io/ecma262/#sec-execution-contexts data-x-internal=javascript-execution-context>JavaScript execution
   context</a>, with its Function field set to null, its Realm field set to <var>active
   script</var>'s <a href=#settings-object id=enqueuejob(queuename,-job,-arguments):settings-object>settings object</a>'s <a href="#environment-settings-object's-realm" id="enqueuejob(queuename,-job,-arguments):environment-settings-object's-realm">Realm</a>, and its ScriptOrModule set to <var>active script</var>'s <a href=#concept-script-record id=enqueuejob(queuename,-job,-arguments):concept-script-record>record</a>.</li><li>
    <p><a href=#queue-a-microtask id=enqueuejob(queuename,-job,-arguments):queue-a-microtask>Queue a microtask</a>, on <var>job settings</var>'s <a href=#responsible-event-loop id=enqueuejob(queuename,-job,-arguments):responsible-event-loop>responsible event
    loop</a>, to perform the following steps:</p>

    <ol><li><p><a href=#check-if-we-can-run-script id=enqueuejob(queuename,-job,-arguments):check-if-we-can-run-script>Check if we can run script</a> with <var>job settings</var>. If this returns
     "do not run" then return.</li><li>
      <p><a href=#prepare-to-run-script id=enqueuejob(queuename,-job,-arguments):prepare-to-run-script>Prepare to run script</a> with <var>job settings</var>.</p>

      <p class=note>This affects the <a href=#concept-entry-everything id=enqueuejob(queuename,-job,-arguments):concept-entry-everything-2>entry</a> concept
      while the job runs.</p>
     </li><li>
      <p><a href=#prepare-to-run-a-callback id=enqueuejob(queuename,-job,-arguments):prepare-to-run-a-callback>Prepare to run a callback</a> with <var>incumbent settings</var>.</p>

      <p class=note>This affects the <a href=#concept-incumbent-everything id=enqueuejob(queuename,-job,-arguments):concept-incumbent-everything>incumbent</a>
      concept while the job runs.</p>
     </li><li>
      <p><a href=https://triple-underscore.github.io/infra-ja.html#stack-push id=enqueuejob(queuename,-job,-arguments):stack-push data-x-internal=stack-push>Push</a> <var>script execution context</var> onto the
      <a id=enqueuejob(queuename,-job,-arguments):javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</p>

      <p class=note>This affects the <a href=#active-script id=enqueuejob(queuename,-job,-arguments):active-script-2>active script</a> while the job runs, in cases like
      <code>Promise.resolve("...").then(eval)</code> where there would otherwise be no
      active script since <code id=enqueuejob(queuename,-job,-arguments):eval()><a data-x-internal=eval() href=https://tc39.github.io/ecma262/#sec-eval-x>eval()</a></code> is a built-in function that does not originate from
      any particular <a href=#concept-script id=enqueuejob(queuename,-job,-arguments):concept-script>script</a>.</p>
     </li><li><p>Let <var>result</var> be the result of performing the abstract operation specified by
     <var>job</var>, using the elements of <var>arguments</var> as its arguments.</li><li><p><a href=https://triple-underscore.github.io/infra-ja.html#stack-pop id=enqueuejob(queuename,-job,-arguments):stack-pop data-x-internal=stack-pop>Pop</a> <var>script execution context</var> from the
     <a id=enqueuejob(queuename,-job,-arguments):javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</li><li><p><a href=#clean-up-after-running-a-callback id=enqueuejob(queuename,-job,-arguments):clean-up-after-running-a-callback>Clean up after running a callback</a> with <var>incumbent
     settings</var>.</li><li><p><a href=#clean-up-after-running-script id=enqueuejob(queuename,-job,-arguments):clean-up-after-running-script>Clean up after running script</a> with <var>job settings</var>.</li><li><p>If <var>result</var> is an abrupt completion, <a href=#report-the-exception id=enqueuejob(queuename,-job,-arguments):report-the-exception>report the exception</a> given by
     <var>result</var>.[[Value]].</li></ol>
   </li></ol>

  <h5 id=integration-with-the-javascript-module-system><span class=secno>8.1.3.8</span> Integration with the JavaScript module system<a href=#integration-with-the-javascript-module-system class=self-link></a></h5>

  <p>The JavaScript specification defines a syntax for modules, as well as some host-agnostic parts
  of their processing model. This specification defines the rest of their processing model: how the
  module system is bootstrapped, via the <code id=integration-with-the-javascript-module-system:the-script-element><a href=scripting.html#the-script-element>script</a></code> element with <code id=integration-with-the-javascript-module-system:attr-script-type><a href=scripting.html#attr-script-type>type</a></code> attribute set to "<code>module</code>", and how
  modules are fetched, resolved, and executed. <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <p class=note>Although the JavaScript specification speaks in terms of "scripts" versus
  "modules", in general this specification speaks in terms of <a href=#classic-script id=integration-with-the-javascript-module-system:classic-script>classic
  scripts</a> versus <a href=#module-script id=integration-with-the-javascript-module-system:module-script>module scripts</a>, since both of them use
  the <code id=integration-with-the-javascript-module-system:the-script-element-2><a href=scripting.html#the-script-element>script</a></code> element.</p>

  <p>A <dfn id=module-map>module map</dfn> is a <a href=https://triple-underscore.github.io/infra-ja.html#ordered-map id=integration-with-the-javascript-module-system:ordered-map data-x-internal=ordered-map>map</a> of <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=integration-with-the-javascript-module-system:url-record data-x-internal=url-record>URL records</a> to values that are either a <a href=#module-script id=integration-with-the-javascript-module-system:module-script-2>module script</a>, null (used to
  represent failed fetches), or a placeholder value "<code>fetching</code>". <a href=#module-map id=integration-with-the-javascript-module-system:module-map>Module maps</a> are used to ensure that imported JavaScript modules are
  only fetched, parsed, and evaluated once per <code id=integration-with-the-javascript-module-system:document><a href=dom.html#document>Document</a></code> or <a href=workers.html#workers>worker</a>.</p>

  <div class=example>
   <p>Since <a href=#module-map id=integration-with-the-javascript-module-system:module-map-2>module maps</a> are keyed by URL, the following code will
   create three separate entries in the <a href=#module-map id=integration-with-the-javascript-module-system:module-map-3>module map</a>, since it results in three different
   URLs:</p>

   <pre>import "https://example.com/module.js";
import "https://example.com/module.js#map-buster";
import "https://example.com/module.js?debug=true";</pre>

   <p>That is, URL <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-query id=integration-with-the-javascript-module-system:concept-url-query data-x-internal=concept-url-query>queries</a> and <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-fragment id=integration-with-the-javascript-module-system:concept-url-fragment data-x-internal=concept-url-fragment>fragments</a> can be varied to create distinct entries in the
   <a href=#module-map id=integration-with-the-javascript-module-system:module-map-4>module map</a>; they are not ignored. Thus, three separate fetches and three separate
   module evaluations will be performed.</p>

   <p>In contrast, the following code would only create a single entry in the <a href=#module-map id=integration-with-the-javascript-module-system:module-map-5>module
   map</a>, since after applying the <a id=integration-with-the-javascript-module-system:url-parser href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> to these inputs, the resulting <a href=https://triple-underscore.github.io/URL-ja.html#concept-url id=integration-with-the-javascript-module-system:url-record-2 data-x-internal=url-record>URL records</a> are equal:</p>

   <pre>import "https://example.com/module2.js";
import "https:example.com/module2.js";
import "https://///example.com\\module2.js";
import "https://example.com/foo/../module2.js";</pre>

   <p>So in this second example, only one fetch and one module evaluation will occur.</p>

   <p>Note that this behavior is the same as how <a href=workers.html#sharedworker id=integration-with-the-javascript-module-system:sharedworker>shared workers</a> are keyed by their parsed <a href=workers.html#concept-sharedworkerglobalscope-constructor-url id=integration-with-the-javascript-module-system:concept-sharedworkerglobalscope-constructor-url>constructor url</a>.</p>
  </div>

  <p>To <dfn id=resolve-a-module-specifier>resolve a module specifier</dfn> given a <a id=integration-with-the-javascript-module-system:the-script-element-3 href=scripting.html#the-script-element>script</a> <var>script</var> and a
  <a id=integration-with-the-javascript-module-system:javascript-string href=https://triple-underscore.github.io/infra-ja.html#javascript-string data-x-internal=javascript-string>JavaScript string</a> <var>specifier</var>, perform the following steps. It will return
  either a <a id=integration-with-the-javascript-module-system:url-record-3 href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> or failure.</p>

  <ol><li><p>Apply the <a id=integration-with-the-javascript-module-system:url-parser-2 href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> to <var>specifier</var>. If the result is not failure,
   return the result.</li><li>
    <p>If <var>specifier</var> does not start with the character U+002F SOLIDUS (<code>/</code>), the two-character sequence U+002E FULL STOP, U+002F SOLIDUS (<code>./</code>), or the three-character sequence U+002E FULL STOP, U+002E FULL STOP,
    U+002F SOLIDUS (<code>../</code>), return failure.</p>

    <p class=note>This restriction is in place so that in the future we can allow custom module
    loaders to give special meaning to "bare" import specifiers, like <code>import "jquery"</code> or <code>import "web/crypto"</code>. For now any
    such imports will fail, instead of being treated as relative URLs.</p>
   </li><li><p>Return the result of applying the <a id=integration-with-the-javascript-module-system:url-parser-3 href=https://triple-underscore.github.io/URL-ja.html#concept-url-parser data-x-internal=url-parser>URL parser</a> to <var>specifier</var> with
   <var>script</var>'s <a href=#concept-script-base-url id=integration-with-the-javascript-module-system:concept-script-base-url>base URL</a> as the base
   URL.</li></ol>

  <div id=module-specifier-examples class=example>
   <p>The following are valid module specifiers according to the above algorithm:</p>

   <ul class=brief><li><code>https://example.com/apples.js</code></li><li><code>http:example.com\pears.mjs</code> (becomes <code>http://example.com/pears.mjs</code> as step 1 parses with no base URL)</li><li><code>//example.com/bananas</code></li><li><code>./strawberries.js.cgi</code></li><li><code>../lychees</code></li><li><code>/limes.jsx</code></li><li><code>data:text/javascript,export default 'grapes';</code></li><li><code>blob:https://whatwg.org/d0360e2f-caee-469f-9a2f-87d5b0456f6f</code></li></ul>

   <p>The following are valid module specifiers according to the above algorithm, but will
   invariably cause failures when they are <a href=#fetch-a-single-module-script id=integration-with-the-javascript-module-system:fetch-a-single-module-script>fetched</a>:</p>

   <ul class=brief><li><code>javascript:export default 'artichokes';</code></li><li><code>data:text/plain,export default 'kale';</code></li><li><code>about:legumes</code></li><li><code>wss://example.com/celery</code></li></ul>

   <p>The following are not valid module specifiers according to the above algorithm:</p>

   <ul class=brief><li><code>https://eggplant:b/c</code></li><li><code>pumpkins.js</code></li><li><code>.tomato</code></li><li><code>..zucchini.js</code></li><li><code>.\yam.es</code></li></ul>
  </div>

  <h6 id=hostresolveimportedmodule(referencingscriptormodule,-specifier)><span class=secno>8.1.3.8.1</span> <dfn>HostResolveImportedModule</dfn>(<var>referencingScriptOrModule</var>,
  <var>specifier</var>)<a href=#hostresolveimportedmodule(referencingscriptormodule,-specifier) class=self-link></a></h6>

  <p>JavaScript contains an implementation-defined <a href=https://tc39.github.io/ecma262/#sec-hostresolveimportedmodule id=hostresolveimportedmodule(referencingscriptormodule,-specifier):js-hostresolveimportedmodule data-x-internal=js-hostresolveimportedmodule>HostResolveImportedModule</a> abstract operation, very
  slightly updated by the <cite>import()</cite> proposal. User agents must use the following
  implementation: <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a> <a href=references.html#refsJSIMPORT>[JSIMPORT]</a></p>

  <ol><li><p>Let <var>referencing script</var> be
   <var>referencingScriptOrModule</var>.[[HostDefined]].</li><li><p>Let <var>moduleMap</var> be <var>referencing script</var>'s <a href=#settings-object id=hostresolveimportedmodule(referencingscriptormodule,-specifier):settings-object>settings object</a>'s
   <a href=#concept-settings-object-module-map id=hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-settings-object-module-map>module map</a>.</li><li><p>Let <var>url</var> be the result of <a href=#resolve-a-module-specifier id=hostresolveimportedmodule(referencingscriptormodule,-specifier):resolve-a-module-specifier>resolving a
   module specifier</a> given <var>referencing script</var> and <var>specifier</var>.</li><li><p>Assert: <var>url</var> is never failure, because <a href=#resolve-a-module-specifier id=hostresolveimportedmodule(referencingscriptormodule,-specifier):resolve-a-module-specifier-2>resolving a module specifier</a> must have been <a href=#validate-requested-module-specifiers>previously successful</a> with these
   same two arguments.</li><li><p>Let <var>resolved module script</var> be <var>moduleMap</var>[<var>url</var>]. (This entry
   must <a href=https://triple-underscore.github.io/infra-ja.html#map-exists id=hostresolveimportedmodule(referencingscriptormodule,-specifier):map-exists data-x-internal=map-exists>exist</a> for us to have gotten to this point.)</li><li><p>Assert: <var>resolved module script</var> is a <a href=#module-script id=hostresolveimportedmodule(referencingscriptormodule,-specifier):module-script>module script</a> (i.e., is not
   null or "<code>fetching</code>").</li><li><p>Assert: <var>resolved module script</var>'s <a href=#concept-script-record id=hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-script-record>record</a> is not null.</p>

   </li><li><p>Return <var>resolved module script</var>'s <a href=#concept-script-record id=hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-script-record-2>record</a>.</li></ol>

  <h6 id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)><span class=secno>8.1.3.8.2</span> <dfn>HostImportModuleDynamically</dfn>(<var>referencingScriptOrModule</var>,
  <var>specifier</var>, <var>promiseCapability</var>)<a href=#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability) class=self-link></a></h6>

  <p>The <cite>import()</cite> proposal contains an implementation-defined <a href=https://tc39.github.io/proposal-dynamic-import/#sec-hostimportmoduledynamically id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):js-hostimportmoduledynamically data-x-internal=js-hostimportmoduledynamically>HostImportModuleDynamically</a> abstract operation.
  User agents must use the following implementation: <a href=references.html#refsJSIMPORT>[JSIMPORT]</a></p>

  <ol><li><p>Let <var>referencing script</var> be
   <var>referencingScriptOrModule</var>.[[HostDefined]].</li><li>
    <p>Run the following steps <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):in-parallel href=infrastructure.html#in-parallel>in parallel</a>:</p>

    <ol><li><p>Let <var>url</var> be the result of <a href=#resolve-a-module-specifier id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):resolve-a-module-specifier>resolving a
     module specifier</a> given <var>referencing script</var> and <var>specifier</var>.</li><li>
      <p>If <var>url</var> is failure, then:</p>

      <ol><li><p>Let <var>completion</var> be Completion { [[Type]]: throw, [[Value]]: a new
       <code id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code>, [[Target]]: empty }.</li><li><p>Perform <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport href=https://tc39.github.io/proposal-dynamic-import/#sec-finishdynamicimport data-x-internal=finishdynamicimport>FinishDynamicImport</a>(<var>referencingScriptOrModule</var>,
       <var>specifier</var>, <var>promiseCapability</var>, <var>completion</var>).</li><li><p>Return.</li></ol>
     </li><li><p>Let <var>options</var> be the <a href=#descendant-script-fetch-options id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):descendant-script-fetch-options>descendant script fetch options</a> for
     <var>referencing script</var>'s <a href=#concept-script-script-fetch-options id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):concept-script-script-fetch-options>fetch
     options</a>.</li><li><p><a href=#fetch-a-module-script-tree id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):fetch-a-module-script-tree>Fetch a module script graph</a> given <var>url</var>, <var>settings
     object</var>, "<code>script</code>", and <var>options</var>. Wait until the algorithm
     asynchronously completes with <var>result</var>.</li><li>
      <p>If <var>result</var> is null, then:</p>

      <ol><li><p>Let <var>completion</var> be Completion { [[Type]]: throw, [[Value]]: a new
       <code id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code>, [[Target]]: empty }.</li><li><p>Perform <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport-2 href=https://tc39.github.io/proposal-dynamic-import/#sec-finishdynamicimport data-x-internal=finishdynamicimport>FinishDynamicImport</a>(<var>referencingScriptOrModule</var>,
       <var>specifier</var>, <var>promiseCapability</var>, <var>completion</var>).</li><li><p>Return.</li></ol>
     </li><li><p><a href=#run-a-module-script id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):run-a-module-script>Run the module script</a> <var>result</var>, with
     the rethrow errors boolean set to true.</li><li><p>If running the module script throws an exception, then perform
     <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport-3 href=https://tc39.github.io/proposal-dynamic-import/#sec-finishdynamicimport data-x-internal=finishdynamicimport>FinishDynamicImport</a>(<var>referencingScriptOrModule</var>, <var>specifier</var>,
     <var>promiseCapability</var>, the thrown exception completion).</li><li><p>Otherwise, perform
     <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport-4 href=https://tc39.github.io/proposal-dynamic-import/#sec-finishdynamicimport data-x-internal=finishdynamicimport>FinishDynamicImport</a>(<var>referencingScriptOrModule</var>, <var>specifier</var>,
     <var>promiseCapability</var>, <a id=hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):normalcompletion href=https://tc39.github.io/ecma262/#sec-normalcompletion data-x-internal=normalcompletion>NormalCompletion</a>(undefined)).</li></ol>
   </li><li><p>Return undefined.</li></ol>

  <h6 id=hostgetimportmetaproperties><span class=secno>8.1.3.8.3</span> <dfn>HostGetImportMetaProperties</dfn>(<var>moduleRecord</var>)<a href=#hostgetimportmetaproperties class=self-link></a></h6>

  <p>The <cite>import.meta</cite> proposal contains an implementation-defined <a href=https://tc39.github.io/proposal-import-meta/#sec-hostgetimportmetaproperties id=hostgetimportmetaproperties:js-hostgetimportmetaproperties data-x-internal=js-hostgetimportmetaproperties>HostGetImportMetaProperties</a> abstract operation.
  User agents must use the following implementation: <a href=references.html#refsJSIMPORTMETA>[JSIMPORTMETA]</a></p>

  <ol><li><p>Let <var>module script</var> be <var>moduleRecord</var>.[[HostDefined]].</li><li><p>Let <var>urlString</var> be <var>module script</var>'s <a href=#concept-script-base-url id=hostgetimportmetaproperties:concept-script-base-url>base URL</a>, <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=hostgetimportmetaproperties:concept-url-serializer data-x-internal=concept-url-serializer>serialized</a>.</li><li><p>Return « Record { [[Key]]: "url", [[Value]]: <var>urlString</var> } ».</li></ol>

  <h5 id=integration-with-the-javascript-agent-formalism><span class=secno>8.1.3.9</span> Integration with the JavaScript agent formalism<a href=#integration-with-the-javascript-agent-formalism class=self-link></a></h5>

  <p>JavaScript defines the concept of an <a id=integration-with-the-javascript-agent-formalism:agent href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a>. Until such a time that this standard
  has a better handle on lifetimes, we define five types of <a href=https://tc39.github.io/ecma262/#sec-agents id=integration-with-the-javascript-agent-formalism:agent-2 data-x-internal=agent>agents</a> that
  user agents must allocate at the appropriate time.</p>

  <p class=note>In the future, when this specification has a better handle on lifetimes, we hope
  to define exactly when <a href=https://tc39.github.io/ecma262/#sec-agents id=integration-with-the-javascript-agent-formalism:agent-3 data-x-internal=agent>agents</a> and <a href=https://tc39.github.io/ecma262/#sec-agent-clusters id=integration-with-the-javascript-agent-formalism:agent-cluster data-x-internal=agent-cluster>agent
  clusters</a> are created.</p>

  <p class=XXX>JavaScript is expected to define <a href=https://tc39.github.io/ecma262/#sec-agents id=integration-with-the-javascript-agent-formalism:agent-4 data-x-internal=agent>agents</a> in more detail; in particular that they hold a set of <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm>realms</a>: <a href=https://github.com/tc39/ecma262/issues/882>tc39/ecma262 issue #882</a>.</p>

  <dl><dt><dfn id=similar-origin-window-agent data-export="">Similar-origin window agent</dfn><dd>
    <p>An <a id=integration-with-the-javascript-agent-formalism:agent-5 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> whose [[CanBlock]] is false and whose set of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-formalism:javascript-realm data-x-internal=javascript-realm>realms</a> consists of all <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm-2>realms</a> of <code id=integration-with-the-javascript-agent-formalism:window><a href=window-object.html#window>Window</a></code> objects whose
    <a href=#relevant-settings-object id=integration-with-the-javascript-agent-formalism:relevant-settings-object>relevant settings object</a>'s <a href=#responsible-browsing-context id=integration-with-the-javascript-agent-formalism:responsible-browsing-context>responsible browsing context</a> is in the same
    <a id=integration-with-the-javascript-agent-formalism:unit-of-related-similar-origin-browsing-contexts href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing contexts</a>.</p>

    <p class=note>Two <code id=integration-with-the-javascript-agent-formalism:window-2><a href=window-object.html#window>Window</a></code> objects that are <a id=integration-with-the-javascript-agent-formalism:same-origin href=origin.html#same-origin>same origin</a> can be in
    different <a href=#similar-origin-window-agent id=integration-with-the-javascript-agent-formalism:similar-origin-window-agent>similar-origin window agents</a>, for
    instance if they are each in their own <a id=integration-with-the-javascript-agent-formalism:unit-of-related-similar-origin-browsing-contexts-2 href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing
    contexts</a>.</p>
   <dt><dfn id=dedicated-worker-agent data-export="">Dedicated worker agent</dfn><dd><p>An <a id=integration-with-the-javascript-agent-formalism:agent-6 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> whose [[CanBlock]] is true and whose set of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-formalism:javascript-realm-2 data-x-internal=javascript-realm>realms</a> consists of a single <code id=integration-with-the-javascript-agent-formalism:dedicatedworkerglobalscope><a href=workers.html#dedicatedworkerglobalscope>DedicatedWorkerGlobalScope</a></code> object's <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm-3>Realm</a>.<dt><dfn id=shared-worker-agent data-export="">Shared worker agent</dfn><dd><p>An <a id=integration-with-the-javascript-agent-formalism:agent-7 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> whose [[CanBlock]] is true and whose set of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-formalism:javascript-realm-3 data-x-internal=javascript-realm>realms</a> consists a single <code id=integration-with-the-javascript-agent-formalism:sharedworkerglobalscope><a href=workers.html#sharedworkerglobalscope>SharedWorkerGlobalScope</a></code> object's <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm-4>Realm</a>.<dt><dfn id=service-worker-agent data-export="">Service worker agent</dfn><dd><p>An <a id=integration-with-the-javascript-agent-formalism:agent-8 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> whose [[CanBlock]] is false and whose set of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-formalism:javascript-realm-4 data-x-internal=javascript-realm>realms</a> consists of a single <code id=integration-with-the-javascript-agent-formalism:serviceworkerglobalscope><a data-x-internal=serviceworkerglobalscope href=https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope>ServiceWorkerGlobalScope</a></code> object's <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm-5>Realm</a>.<dt><dfn id=worklet-agent data-export="">Worklet agent</dfn><dd>
    <p>An <a id=integration-with-the-javascript-agent-formalism:agent-9 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> whose [[CanBlock]] is false and whose set of <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-formalism:javascript-realm-5 data-x-internal=javascript-realm>realms</a> consists of a single <code id=integration-with-the-javascript-agent-formalism:workletglobalscope><a data-x-internal=workletglobalscope href=https://drafts.css-houdini.org/worklets/#workletglobalscope>WorkletGlobalScope</a></code>
    object's <a href=#concept-global-object-realm id=integration-with-the-javascript-agent-formalism:concept-global-object-realm-6>Realm</a>.</p>

    <p class=note>While conceptually it might be cleaner for worklets that end up with multiple
    realms to put all those in the same agent, it is not observable in practice.</p>
   </dl>

  <h5 id=integration-with-the-javascript-agent-cluster-formalism><span class=secno>8.1.3.10</span> Integration with the JavaScript agent cluster formalism<a href=#integration-with-the-javascript-agent-cluster-formalism class=self-link></a></h5>

  <p><dfn id=can-share-memory-with>Can share memory with</dfn> defines an equivalence relation. An <a id=integration-with-the-javascript-agent-cluster-formalism:agent-cluster href=https://tc39.github.io/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent cluster</a>
  consists of all <a href=https://tc39.github.io/ecma262/#sec-agents id=integration-with-the-javascript-agent-cluster-formalism:agent data-x-internal=agent>agents</a> in the same equivalence class with respect to
  the <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with>can share memory with</a> equivalence relation.</p>

  <p>A <a href=#similar-origin-window-agent id=integration-with-the-javascript-agent-cluster-formalism:similar-origin-window-agent>similar-origin window agent</a>, <a href=#dedicated-worker-agent id=integration-with-the-javascript-agent-cluster-formalism:dedicated-worker-agent>dedicated worker agent</a>, <a href=#shared-worker-agent id=integration-with-the-javascript-agent-cluster-formalism:shared-worker-agent>shared
  worker agent</a>, or <a href=#service-worker-agent id=integration-with-the-javascript-agent-cluster-formalism:service-worker-agent>service worker agent</a>, <var>agent</var>, <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with-2>can share
  memory with</a> any <a href=#dedicated-worker-agent id=integration-with-the-javascript-agent-cluster-formalism:dedicated-worker-agent-2>dedicated worker agent</a> whose single <a href=https://tc39.github.io/ecma262/#sec-code-realms id=integration-with-the-javascript-agent-cluster-formalism:javascript-realm data-x-internal=javascript-realm>realm</a>'s <a href=#concept-realm-global id=integration-with-the-javascript-agent-cluster-formalism:concept-realm-global>global object</a>'s <a id=integration-with-the-javascript-agent-cluster-formalism:concept-WorkerGlobalScope-owner-set href=workers.html#concept-WorkerGlobalScope-owner-set>owner
  set</a> contains an item whose <a href=#concept-relevant-realm id=integration-with-the-javascript-agent-cluster-formalism:concept-relevant-realm>relevant Realm</a>
  belongs to <var>agent</var>.</p>

  <p class=note>We use item above as an <a id=integration-with-the-javascript-agent-cluster-formalism:concept-WorkerGlobalScope-owner-set-2 href=workers.html#concept-WorkerGlobalScope-owner-set>owner set</a> can contain <code id=integration-with-the-javascript-agent-cluster-formalism:document><a href=dom.html#document>Document</a></code>
  objects.</p>

  <p class=XXX>A <a href=#worklet-agent id=integration-with-the-javascript-agent-cluster-formalism:worklet-agent>worklet agent</a> … currently worklets have
  no clearly defined owner, see: <a href=https://github.com/w3c/css-houdini-drafts/issues/224>w3c/css-houdini-drafts issue
  #224</a>.</p>

  <p>In addition, any <a id=integration-with-the-javascript-agent-cluster-formalism:agent-2 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> <var>A</var> <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with-3>can share memory with</a>:</p>

  <ul class=brief><li><var>A</var>,</li><li>any <a id=integration-with-the-javascript-agent-cluster-formalism:agent-3 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> <var>B</var> such that <var>B</var> <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with-4>can share memory with</a>
   <var>A</var>, and</li><li>any <a id=integration-with-the-javascript-agent-cluster-formalism:agent-4 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a> <var>B</var> such that there exists an <a id=integration-with-the-javascript-agent-cluster-formalism:agent-5 href=https://tc39.github.io/ecma262/#sec-agents data-x-internal=agent>agent</a>
   <var>C</var>, where <var>A</var> <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with-5>can share memory with</a> <var>C</var> and <var>C</var>
   <a href=#can-share-memory-with id=integration-with-the-javascript-agent-cluster-formalism:can-share-memory-with-6>can share memory with</a> <var>B</var>.</li></ul>

  <p>The <a id=integration-with-the-javascript-agent-cluster-formalism:agent-cluster-2 href=https://tc39.github.io/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent cluster</a> concept is crucial for defining the JavaScript memory model, and
  in particular among which <a href=https://tc39.github.io/ecma262/#sec-agents id=integration-with-the-javascript-agent-cluster-formalism:agent-6 data-x-internal=agent>agents</a> the backing data of
  <code id=integration-with-the-javascript-agent-cluster-formalism:sharedarraybuffer><a data-x-internal=sharedarraybuffer href=https://tc39.github.io/ecma262/#sec-sharedarraybuffer-objects>SharedArrayBuffer</a></code> objects can be shared.</p>

  <div class=example>
   <p>The following pairs of global objects are each within the same <a id=integration-with-the-javascript-agent-cluster-formalism:agent-cluster-3 href=https://tc39.github.io/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent cluster</a>, and
   thus can use <code id=integration-with-the-javascript-agent-cluster-formalism:sharedarraybuffer-2><a data-x-internal=sharedarraybuffer href=https://tc39.github.io/ecma262/#sec-sharedarraybuffer-objects>SharedArrayBuffer</a></code> instances to share memory with each other:</p>

   <ul class=brief><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window><a href=window-object.html#window>Window</a></code> object and a dedicated worker that it created.</li><li>A worker (of any type) and a dedicated worker it created.</li><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window-2><a href=window-object.html#window>Window</a></code> object <var>A</var> and the <code id=integration-with-the-javascript-agent-cluster-formalism:window-3><a href=window-object.html#window>Window</a></code> object of an
    <code id=integration-with-the-javascript-agent-cluster-formalism:the-iframe-element><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> element that <var>A</var> created that could be <a id=integration-with-the-javascript-agent-cluster-formalism:same-origin-domain href=origin.html#same-origin-domain>same
    origin-domain</a> with <var>A</var>.</li><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window-4><a href=window-object.html#window>Window</a></code> object and a <a id=integration-with-the-javascript-agent-cluster-formalism:same-origin-domain-2 href=origin.html#same-origin-domain>same origin-domain</a> <code id=integration-with-the-javascript-agent-cluster-formalism:window-5><a href=window-object.html#window>Window</a></code>
    object that opened it.</li></ul>

   <p>The following pairs of global objects are <em>not</em> within the same <a id=integration-with-the-javascript-agent-cluster-formalism:agent-cluster-4 href=https://tc39.github.io/ecma262/#sec-agent-clusters data-x-internal=agent-cluster>agent
   cluster</a>, and thus cannot share memory:</p>

   <ul class=brief><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window-6><a href=window-object.html#window>Window</a></code> object and a shared worker it created.</li><li>A worker (of any type) and a shared worker it created.</li><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window-7><a href=window-object.html#window>Window</a></code> object and a service worker it created.</li><li>A <code id=integration-with-the-javascript-agent-cluster-formalism:window-8><a href=window-object.html#window>Window</a></code> object <var></var> and the <code id=integration-with-the-javascript-agent-cluster-formalism:window-9><a href=window-object.html#window>Window</a></code> object of an
    <code id=integration-with-the-javascript-agent-cluster-formalism:the-iframe-element-2><a href=iframe-embed-object.html#the-iframe-element>iframe</a></code> element that <var>A</var> created that cannot be <a id=integration-with-the-javascript-agent-cluster-formalism:same-origin-domain-3 href=origin.html#same-origin-domain>same
    origin-domain</a> with <var>A</var>.</li></ul>
  </div>

  


  <h5 id=runtime-script-errors><span class=secno>8.1.3.11</span> ランタイムスクリプトエラー<a href=#runtime-script-errors class=self-link></a></h5>

  

  <p>When the user agent is required to <dfn id=report-the-error>report an error</dfn> for a
  particular <a href=#concept-script id=runtime-script-errors:concept-script>script</a> <var>script</var> with a particular
  position <var>line</var>:<var>col</var>, using a particular target <var>target</var>, it must run these steps, after which the error is either <dfn id=concept-error-handled><i>handled</i></dfn> or <dfn id=concept-error-nothandled><i>not
  handled</i></dfn>:</p>

  <ol><li><p>If <var>target</var> is <a href=#in-error-reporting-mode id=runtime-script-errors:in-error-reporting-mode>in error reporting mode</a>, then return; the error is <i id=runtime-script-errors:concept-error-nothandled><a href=#concept-error-nothandled>not handled</a></i>.</li><li><p>Let <var>target</var> be <dfn id=in-error-reporting-mode>in error reporting mode</dfn>.</li><li><p>Let <var>message</var> be a user-agent-defined string describing the error in a
   helpful manner.
   
   <a id=runtime-script-errors:fingerprinting-vector title="There is a potential fingerprinting vector here." href=introduction.html#fingerprinting-vector class=fingerprint><img alt="(This is a fingerprinting vector.)" src=https://html.spec.whatwg.org/images/fingerprint.png width=46 height=64></a>
   </li><li><p>Let <var>errorValue</var> be the value that represents the error: in the case of an
   uncaught exception, that would be the value that was thrown; in the case of a JavaScript error
   that would be an <code id=runtime-script-errors:idl-error><a data-x-internal=idl-error href=https://triple-underscore.github.io/WebIDL-ja.html#idl-Error>Error</a></code> object. If there is no corresponding
   value, then the null value must be used instead.</li><li>

    <p>Let <var>urlString</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=runtime-script-errors:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> to the <a id=runtime-script-errors:url-record href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url-record>URL record</a> that
    corresponds to the resource from which <var>script</var> was obtained.</p>

    <p class=note>The resource containing the script will typically be the file from which the
    <code id=runtime-script-errors:document><a href=dom.html#document>Document</a></code> was parsed, e.g. for inline <code id=runtime-script-errors:the-script-element><a href=scripting.html#the-script-element>script</a></code> elements or <a href=#event-handler-content-attributes id=runtime-script-errors:event-handler-content-attributes>event
    handler content attributes</a>; or the JavaScript file that the script was in, for external
    scripts. Even for dynamically-generated scripts, user agents are strongly encouraged to attempt
    to keep track of the original source of a script. For example, if an external script uses the
    <code id=runtime-script-errors:dom-document-write><a href=dynamic-markup-insertion.html#dom-document-write>document.write()</a></code> API to insert an inline
    <code id=runtime-script-errors:the-script-element-2><a href=scripting.html#the-script-element>script</a></code> element during parsing, the URL of the resource containing the script would
    ideally be reported as being the external script, and the line number might ideally be reported
    as the line with the <code id=runtime-script-errors:dom-document-write-2><a href=dynamic-markup-insertion.html#dom-document-write>document.write()</a></code> call or where the
    string passed to that call was first constructed. Naturally, implementing this can be somewhat
    non-trivial.</p>

    <p class=note>User agents are similarly encouraged to keep careful track of the original line
    numbers, even in the face of <code id=runtime-script-errors:dom-document-write-3><a href=dynamic-markup-insertion.html#dom-document-write>document.write()</a></code> calls
    mutating the document as it is parsed, or <a href=#event-handler-content-attributes id=runtime-script-errors:event-handler-content-attributes-2>event handler content attributes</a> spanning
    multiple lines.</p>

   </li><li><p>If <var>script</var>'s <a href=#muted-errors id=runtime-script-errors:muted-errors>muted errors</a> is true, then set <var>message</var> to
   "<code>Script error.</code>", <var>urlString</var> to the empty string, <var>line</var>
   and <var>col</var> to 0, and <var>errorValue</var> to null.</li><li><p>Let <var>notHandled</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=runtime-script-errors:concept-event-fire data-x-internal=concept-event-fire>firing an
   event</a> named <code id=runtime-script-errors:event-error><a href=indices.html#event-error>error</a></code> at <var>target</var>, using
   <code id=runtime-script-errors:errorevent><a href=#errorevent>ErrorEvent</a></code>, with the <code id=runtime-script-errors:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute
   initialized to true, the <code id=runtime-script-errors:dom-errorevent-message><a href=#dom-errorevent-message>message</a></code> attribute
   initialized to <var>message</var>, the <code id=runtime-script-errors:dom-errorevent-filename><a href=#dom-errorevent-filename>filename</a></code>
   attribute initialized to <var>urlString</var>, the <code id=runtime-script-errors:dom-errorevent-lineno><a href=#dom-errorevent-lineno>lineno</a></code> attribute initialized to <var>line</var>, the <code id=runtime-script-errors:dom-errorevent-colno><a href=#dom-errorevent-colno>colno</a></code> attribute initialized to <var>col</var>, and the <code id=runtime-script-errors:dom-errorevent-error><a href=#dom-errorevent-error>error</a></code> attribute initialized to
   <var>errorValue</var>.</li><li><p>Let <var>target</var> no longer be <a href=#in-error-reporting-mode id=runtime-script-errors:in-error-reporting-mode-2>in error reporting mode</a>.</li><li>
    <p>If <var>notHandled</var> is false, then the error is <i id=runtime-script-errors:concept-error-handled><a href=#concept-error-handled>handled</a></i>. Otherwise, the error is <i id=runtime-script-errors:concept-error-nothandled-2><a href=#concept-error-nothandled>not handled</a></i>.</p>

    <p class=note>Returning true in an event handler cancels the event per <a href=#the-event-handler-processing-algorithm id=runtime-script-errors:the-event-handler-processing-algorithm>the event handler
    processing algorithm</a>.</p>
   </li></ol>


  <h6 id=runtime-script-errors-in-documents><span class=secno>8.1.3.11.1</span> Runtime script errors in documents<a href=#runtime-script-errors-in-documents class=self-link></a></h6>

  <p>When the user agent is to <dfn id=report-the-exception data-lt="report the
  exception|report an exception" data-export="">report an exception</dfn> <var>E</var>, the user
  agent must <a href=#report-the-error id=runtime-script-errors-in-documents:report-the-error>report the error</a> for the relevant <a href=#concept-script id=runtime-script-errors-in-documents:concept-script>script</a>, with the problematic position (line number and column
  number) in the resource containing the script, using the <a href=#concept-settings-object-global id=runtime-script-errors-in-documents:concept-settings-object-global>global object</a> specified by the script's
  <a href=#settings-object id=runtime-script-errors-in-documents:settings-object>settings object</a> as the target. If the error is still <i id=runtime-script-errors-in-documents:concept-error-nothandled><a href=#concept-error-nothandled>not handled</a></i> after this, then the error may be reported to a
  developer console.</p>


  <h6 id=the-errorevent-interface><span class=secno>8.1.3.11.2</span> The <code id=the-errorevent-interface:errorevent><a href=#errorevent>ErrorEvent</a></code> interface<a href=#the-errorevent-interface class=self-link></a></h6>

  

  <pre class=idl>[Constructor(DOMString type, optional <a href=#erroreventinit id=the-errorevent-interface:erroreventinit>ErrorEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id=errorevent>ErrorEvent</dfn> : <a id=the-errorevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  readonly attribute DOMString <a href=#dom-errorevent-message id=the-errorevent-interface:dom-errorevent-message>message</a>;
  readonly attribute USVString <a href=#dom-errorevent-filename id=the-errorevent-interface:dom-errorevent-filename>filename</a>;
  readonly attribute unsigned long <a href=#dom-errorevent-lineno id=the-errorevent-interface:dom-errorevent-lineno>lineno</a>;
  readonly attribute unsigned long <a href=#dom-errorevent-colno id=the-errorevent-interface:dom-errorevent-colno>colno</a>;
  readonly attribute any <a href=#dom-errorevent-error id=the-errorevent-interface:dom-errorevent-error>error</a>;
};

dictionary <dfn id=erroreventinit>ErrorEventInit</dfn> : <a id=the-errorevent-interface:eventinit href=https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  DOMString message = "";
  USVString filename = "";
  unsigned long lineno = 0;
  unsigned long colno = 0;
  any error = null;
};</pre>

  <p><dfn id=dom-errorevent-message><code>message</code></dfn>属性は、属性が初期化された値を返さなければならない。これはエラーメッセージを表す。</p>

  <p><dfn id=dom-errorevent-filename><code>filename</code></dfn>属性は、属性が初期化された値を返さなければならない。It represents the <a id=the-errorevent-interface:url href=https://triple-underscore.github.io/URL-ja.html#concept-url data-x-internal=url>URL</a> of the script in which the error originally occurred.</p>

  <p><dfn id=dom-errorevent-lineno><code>lineno</code></dfn>属性は、属性が初期化された値を返さなければならない。これは、スクリプトでエラーが発生した行番号を表す。</p>

  <p><dfn id=dom-errorevent-colno><code>colno</code></dfn>属性は、属性が初期化された値を返さなければならない。これは、スクリプトでエラーが発生した列番号を表す。</p>

  <p><dfn id=dom-errorevent-error><code>error</code></dfn>属性は、属性が初期化された値を返さなければならない。Where appropriate, it is set to the object representing the error (e.g., the exception object in the case of an uncaught DOM exception).</p>

  <h5 id=unhandled-promise-rejections><span class=secno>8.1.3.12</span> Unhandled promise rejections<a href=#unhandled-promise-rejections class=self-link></a></h5>

  <p>In addition to synchronous <a href=#runtime-script-errors>runtime script errors</a>, scripts
  may experience asynchronous promise rejections, tracked via the <code id=unhandled-promise-rejections:event-unhandledrejection><a href=indices.html#event-unhandledrejection>unhandledrejection</a></code> and <code id=unhandled-promise-rejections:event-rejectionhandled><a href=indices.html#event-rejectionhandled>rejectionhandled</a></code> events.<div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> unhandledrejection<span class="and_chr yes"><span>Chrome for Android</span> <span>64+</span></span><span class="chrome yes"><span>Chrome</span> <span>49+</span></span><span class="ios_saf no"><span>iOS Safari</span> <span>None</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11.8+</span></span><span class="firefox no"><span>Firefox</span> <span>None</span></span><span class="ie no"><span>IE</span> <span>None</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>5+</span></span><span class="op_mini no"><span>Opera Mini</span> <span>None</span></span><span class="safari yes"><span>Safari</span> <span>11+</span></span><span class="edge no"><span>Edge</span> <span>None</span></span><span class="android yes"><span>Android Browser</span> <span>62+</span></span><span class="opera yes"><span>Opera</span> <span>36+</span></span><p class=caniuse>Source: <a href="https://caniuse.com/#feat=unhandledrejection">caniuse.com</a></div>

  <p>When the user agent is to <dfn id=notify-about-rejected-promises>notify about rejected promises</dfn> on a given
  <a href=#environment-settings-object id=unhandled-promise-rejections:environment-settings-object>environment settings object</a> <var>settings object</var>, it must run these steps:</p>

  <ol><li><p>Let <var>list</var> be a copy of <var>settings object</var>'s <a href=#about-to-be-notified-rejected-promises-list id=unhandled-promise-rejections:about-to-be-notified-rejected-promises-list>about-to-be-notified
   rejected promises list</a>.</li><li><p>If <var>list</var> is empty, return.</li><li><p>Clear <var>settings object</var>'s <a href=#about-to-be-notified-rejected-promises-list id=unhandled-promise-rejections:about-to-be-notified-rejected-promises-list-2>about-to-be-notified rejected promises
   list</a>.</li><li>

    <p><a href=#queue-a-task id=unhandled-promise-rejections:queue-a-task>Queue a task</a> to run the following substep:</p>

    <ol><li><p>For each promise <var>p</var> in <var>list</var>:</p>

      <ol><li><p>If <var>p</var>'s [[PromiseIsHandled]] internal slot is true, continue to the next
       iteration of the loop.</li><li><p>Let <var>notHandled</var> be the result of <a href=https://dom.spec.whatwg.org/#concept-event-fire id=unhandled-promise-rejections:concept-event-fire data-x-internal=concept-event-fire>firing an
       event</a> named <code id=unhandled-promise-rejections:event-unhandledrejection-2><a href=indices.html#event-unhandledrejection>unhandledrejection</a></code> at
       <var>settings object</var>'s <a href=#concept-settings-object-global id=unhandled-promise-rejections:concept-settings-object-global>global
       object</a>, using <code id=unhandled-promise-rejections:promiserejectionevent><a href=#promiserejectionevent>PromiseRejectionEvent</a></code>, with the <code id=unhandled-promise-rejections:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attribute initialized to true, the <code id=unhandled-promise-rejections:dom-promiserejectionevent-promise><a href=#dom-promiserejectionevent-promise>promise</a></code> attribute initialized to
       <var>p</var>, and the <code id=unhandled-promise-rejections:dom-promiserejectionevent-reason><a href=#dom-promiserejectionevent-reason>reason</a></code> attribute
       initialized to the value of <var>p</var>'s [[PromiseResult]] internal slot.</li><li><p>If <var>notHandled</var> is false, then the promise rejection is <i id=unhandled-promise-rejections:concept-promise-rejection-handled><a href=#concept-promise-rejection-handled>handled</a></i>. Otherwise, the promise rejection is
       <i id=unhandled-promise-rejections:concept-promise-rejection-nothandled><a href=#concept-promise-rejection-nothandled>not handled</a></i>.</li><li><p>If <var>p</var>'s [[PromiseIsHandled]] internal slot is false, add <var>p</var> to
       <var>settings object</var>'s <a href=#outstanding-rejected-promises-weak-set id=unhandled-promise-rejections:outstanding-rejected-promises-weak-set>outstanding rejected promises weak set</a>.

      

      </li></ol>
     </li></ol>
   </li></ol>

  <p>This algorithm results in promise rejections being marked as <dfn id=concept-promise-rejection-handled><i>handled</i></dfn> or <dfn id=concept-promise-rejection-nothandled><i>not handled</i></dfn>. These concepts parallel
  <i id=unhandled-promise-rejections:concept-error-handled><a href=#concept-error-handled>handled</a></i> and <i id=unhandled-promise-rejections:concept-error-nothandled><a href=#concept-error-nothandled>not
  handled</a></i> script errors. If a rejection is still <i id=unhandled-promise-rejections:concept-promise-rejection-nothandled-2><a href=#concept-promise-rejection-nothandled>not handled</a></i> after this, then the rejection may
  be reported to a developer console.</p>


  <h6 id=the-hostpromiserejectiontracker-implementation><span class=secno>8.1.3.12.1</span> <dfn>HostPromiseRejectionTracker</dfn>(<var>promise</var>, <var>operation</var>)<a href=#the-hostpromiserejectiontracker-implementation class=self-link></a></h6>

  <p>JavaScript contains an implementation-defined <a href=https://tc39.github.io/ecma262/#sec-host-promise-rejection-tracker id=the-hostpromiserejectiontracker-implementation:js-hostpromiserejectiontracker data-x-internal=js-hostpromiserejectiontracker>HostPromiseRejectionTracker</a>(<var>promise</var>,
  <var>operation</var>) abstract operation. User agents must use the following implementation:
  <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a></p>

  <ol><li><p>Let <var>script</var> be the <a href=#running-script id=the-hostpromiserejectiontracker-implementation:running-script>running script</a>.</li><li><p>If <var>script</var>'s <a href=#muted-errors id=the-hostpromiserejectiontracker-implementation:muted-errors>muted errors</a> is true, terminate these steps.</li><li><p>Let <var>settings object</var> be <var>script</var>'s <a href=#settings-object id=the-hostpromiserejectiontracker-implementation:settings-object>settings object</a>.</p>
   </li><li>
    <p>If <var>operation</var> is <code>"reject"</code>,

    

    <ol><li><p>Add <var>promise</var> to <var>settings object</var>'s <a href=#about-to-be-notified-rejected-promises-list id=the-hostpromiserejectiontracker-implementation:about-to-be-notified-rejected-promises-list>about-to-be-notified
     rejected promises list</a>.</li></ol>
   </li><li>
    <p>If <var>operation</var> is <code>"handle"</code>,

    

    <ol><li><p>If <var>settings object</var>'s <a href=#about-to-be-notified-rejected-promises-list id=the-hostpromiserejectiontracker-implementation:about-to-be-notified-rejected-promises-list-2>about-to-be-notified rejected promises
     list</a> contains <var>promise</var>, then remove <var>promise</var> from that list and
     return.</li><li><p>If <var>settings object</var>'s <a href=#outstanding-rejected-promises-weak-set id=the-hostpromiserejectiontracker-implementation:outstanding-rejected-promises-weak-set>outstanding rejected promises weak set</a>
     does not contain <var>promise</var>, then return.</li><li><p>Remove <var>promise</var> from <var>settings object</var>'s <a href=#outstanding-rejected-promises-weak-set id=the-hostpromiserejectiontracker-implementation:outstanding-rejected-promises-weak-set-2>outstanding rejected
     promises weak set</a>.</li><li><p><a href=#queue-a-task id=the-hostpromiserejectiontracker-implementation:queue-a-task>Queue a task</a> to <a href=https://dom.spec.whatwg.org/#concept-event-fire id=the-hostpromiserejectiontracker-implementation:concept-event-fire data-x-internal=concept-event-fire>fire an event</a>
     named <code id=the-hostpromiserejectiontracker-implementation:event-rejectionhandled><a href=indices.html#event-rejectionhandled>rejectionhandled</a></code> at <var>settings
     object</var>'s <a href=#concept-settings-object-global id=the-hostpromiserejectiontracker-implementation:concept-settings-object-global>global object</a>, using
     <code id=the-hostpromiserejectiontracker-implementation:promiserejectionevent><a href=#promiserejectionevent>PromiseRejectionEvent</a></code>, with the <code id=the-hostpromiserejectiontracker-implementation:dom-promiserejectionevent-promise><a href=#dom-promiserejectionevent-promise>promise</a></code> attribute initialized to
     <var>promise</var>, and the <code id=the-hostpromiserejectiontracker-implementation:dom-promiserejectionevent-reason><a href=#dom-promiserejectionevent-reason>reason</a></code>
     attribute initialized to the value of <var>promise</var>'s [[PromiseResult]] internal
     slot.</li></ol>
   </li></ol>

  <h6 id=the-promiserejectionevent-interface><span class=secno>8.1.3.12.2</span> The <code id=the-promiserejectionevent-interface:promiserejectionevent><a href=#promiserejectionevent>PromiseRejectionEvent</a></code> interface<a href=#the-promiserejectionevent-interface class=self-link></a></h6>

  <pre class=idl>[Constructor(DOMString type, <a href=#promiserejectioneventinit id=the-promiserejectionevent-interface:promiserejectioneventinit>PromiseRejectionEventInit</a> eventInitDict), Exposed=(Window,Worker)]
interface <dfn id=promiserejectionevent>PromiseRejectionEvent</dfn> : <a id=the-promiserejectionevent-interface:event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> {
  readonly attribute Promise&lt;any&gt; <a href=#dom-promiserejectionevent-promise id=the-promiserejectionevent-interface:dom-promiserejectionevent-promise>promise</a>;
  readonly attribute any <a href=#dom-promiserejectionevent-reason id=the-promiserejectionevent-interface:dom-promiserejectionevent-reason>reason</a>;
};

dictionary <dfn id=promiserejectioneventinit>PromiseRejectionEventInit</dfn> : <a id=the-promiserejectionevent-interface:eventinit href=https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit data-x-internal=eventinit>EventInit</a> {
  required Promise&lt;any&gt; promise;
  any reason;
};</pre>

  <p>The <dfn id=dom-promiserejectionevent-promise><code>promise</code></dfn> attribute must
  return the value it was initialized to. It represents the promise which this notification is about.</p>

  <p>The <dfn id=dom-promiserejectionevent-reason><code>reason</code></dfn> attribute must
  return the value it was initialized to. It represents the rejection reason for the promise.</p>

  <h5 id=hostensurecancompilestrings(callerrealm,-calleerealm)><span class=secno>8.1.3.13</span> <dfn>HostEnsureCanCompileStrings</dfn>(<var>callerRealm</var>, <var>calleeRealm</var>)<a href=#hostensurecancompilestrings(callerrealm,-calleerealm) class=self-link></a></h5>

  <p>JavaScript contains an implementation-defined <a href=https://tc39.github.io/ecma262/#sec-hostensurecancompilestrings id=hostensurecancompilestrings(callerrealm,-calleerealm):js-hostensurecancompilestrings data-x-internal=js-hostensurecancompilestrings>HostEnsureCanCompileStrings</a>(<var>callerRealm</var>,
  <var>calleeRealm</var>) abstract operation. User agents must use the following implementation:
  <a href=references.html#refsJAVASCRIPT>[JAVASCRIPT]</a>

  <ol><li><p>Perform ? <a href=https://triple-underscore.github.io/CSP3-ja.html#can-compile-strings id=hostensurecancompilestrings(callerrealm,-calleerealm):csp-ensurecspdoesnotblockstringcompilation data-x-internal=csp-ensurecspdoesnotblockstringcompilation>EnsureCSPDoesNotBlockStringCompilation</a>(<var>callerRealm</var>,
   <var>calleeRealm</var>). <a href=references.html#refsCSP>[CSP]</a></li></ol>

  

  <h4 id=event-loops><span class=secno>8.1.4</span> Event loops<a href=#event-loops class=self-link></a></h4> 

  <h5 id=definitions-3><span class=secno>8.1.4.1</span> Definitions<a href=#definitions-3 class=self-link></a></h5>

  <p>To coordinate events, user interaction, scripts, rendering, networking, and so forth, user
  agents must use <dfn id=event-loop data-lt="event loop" data-export="">event loops</dfn> as
  described in this section. There are two kinds of event loops: those for <a href=browsers.html#browsing-context id=definitions-3:browsing-context>browsing contexts</a>, and those for <a href=workers.html#workers>workers</a>.</p>

  <p>There must be at least one <a id=definitions-3:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=definitions-3:event-loop>event loop</a> per user
  agent, and at most one per <a id=definitions-3:unit-of-related-similar-origin-browsing-contexts href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing contexts</a>.</p>

  <p class=note>When there is more than one <a href=#event-loop id=definitions-3:event-loop-2>event loop</a> for a <a id=definitions-3:unit-of-related-browsing-contexts href=browsers.html#unit-of-related-browsing-contexts>unit of related
  browsing contexts</a>, complications arise when a <a id=definitions-3:browsing-context-3 href=browsers.html#browsing-context>browsing context</a> in that group
  is <a href=browsing-the-web.html#navigate id=definitions-3:navigate>navigated</a> such that it switches from one <a id=definitions-3:unit-of-related-similar-origin-browsing-contexts-2 href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related
  similar-origin browsing contexts</a> to another. This specification does not currently describe
  how to handle these complications.</p>

  <p>A <a id=definitions-3:browsing-context-4 href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=definitions-3:event-loop-3>event loop</a> always has at least one <a id=definitions-3:browsing-context-5 href=browsers.html#browsing-context>browsing
  context</a>. If such an <a href=#event-loop id=definitions-3:event-loop-4>event loop</a>'s <a href=browsers.html#browsing-context id=definitions-3:browsing-context-6>browsing
  contexts</a> all go away, then the <a href=#event-loop id=definitions-3:event-loop-5>event loop</a> goes away as well. A <a id=definitions-3:browsing-context-7 href=browsers.html#browsing-context>browsing
  context</a> always has an <a href=#event-loop id=definitions-3:event-loop-6>event loop</a> coordinating its activities.</p>

  <p><a href=workers.html#worker-event-loop>Worker event loops</a> are simpler: each worker has one
  <a href=#event-loop id=definitions-3:event-loop-7>event loop</a>, and the <a href=workers.html#run-a-worker id=definitions-3:run-a-worker>worker processing model</a>
  manages the <a href=#event-loop id=definitions-3:event-loop-8>event loop</a>'s lifetime.</p>

  <hr>

  <p>An <a href=#event-loop id=definitions-3:event-loop-9>event loop</a> has one or more <dfn id=task-queue>task queues</dfn>. A
  <a href=#task-queue id=definitions-3:task-queue>task queue</a> is an ordered list of <dfn id=concept-task data-lt=task data-export="">tasks</dfn>, which are algorithms that are responsible for such work as:</p>

  <dl><dt> イベント<dd>

    <p>Dispatching an <code id=definitions-3:event><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code> object at a particular
    <code id=definitions-3:eventtarget><a data-x-internal=eventtarget href=https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget>EventTarget</a></code> object is often done by a dedicated task.</p>

    <p class=note>Not all events are dispatched using the <a href=#task-queue id=definitions-3:task-queue-2>task queue</a>, many are
    dispatched during other tasks.</p>

   <dt>Parsing<dd><p>The <a id=definitions-3:html-parser href=parsing.html#html-parser>HTML parser</a> tokenizing one or more bytes, and then processing any
   resulting tokens, is typically a task.<dt>Callbacks<dd><p>Calling a callback is often done by a dedicated task.<dt>Using a resource<dd><p>When an algorithm <a href=https://triple-underscore.github.io/Fetch-ja.html#concept-fetch id=definitions-3:concept-fetch data-x-internal=concept-fetch>fetches</a> a resource, if the fetching
   occurs in a non-blocking fashion then the processing of the resource once some or all of the
   resource is available is performed by a task.<dt>Reacting to DOM manipulation<dd><p>Some elements have tasks that trigger in response to DOM manipulation, e.g. when that
   element is <a href=infrastructure.html#insert-an-element-into-a-document id=definitions-3:insert-an-element-into-a-document>inserted into the document</a>.</p>

  </dl>

  <p>Each <a href=#concept-task id=definitions-3:concept-task>task</a> in a <a id=definitions-3:browsing-context-8 href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=definitions-3:event-loop-10>event
  loop</a> is associated with a <code id=definitions-3:document><a href=dom.html#document>Document</a></code>; if the task was queued in the context of
  an element, then it is the element's <a id=definitions-3:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>; if the task was queued in the context
  of a <a id=definitions-3:browsing-context-9 href=browsers.html#browsing-context>browsing context</a>, then it is the <a id=definitions-3:browsing-context-10 href=browsers.html#browsing-context>browsing context</a>'s <a id=definitions-3:active-document href=browsers.html#active-document>active
  document</a> at the time the task was queued; if the task was queued by or for a <a href=#concept-script id=definitions-3:concept-script>script</a> then the document is the <a href=#responsible-document id=definitions-3:responsible-document>responsible document</a>
  specified by the script's <a href=#settings-object id=definitions-3:settings-object>settings object</a>.</p>

  <p>A <a href=#concept-task id=definitions-3:concept-task-2>task</a> is intended for a specific <a href=#event-loop id=definitions-3:event-loop-11>event loop</a>:
  the <a href=#event-loop id=definitions-3:event-loop-12>event loop</a> that is handling <a href=#concept-task id=definitions-3:concept-task-3>tasks</a> for the
  <a href=#concept-task id=definitions-3:concept-task-4>task</a>'s associated <code id=definitions-3:document-2><a href=dom.html#document>Document</a></code> or <a href=workers.html#workers>worker</a>.</p>

  <p>When a user agent is to <dfn id=queue-a-task data-export="">queue a task</dfn>, it must add the given task to
  one of the <a href=#task-queue id=definitions-3:task-queue-3>task queues</a> of the relevant <a href=#event-loop id=definitions-3:event-loop-13>event
  loop</a>.</p>

  <p>Each <a href=#concept-task id=definitions-3:concept-task-5>task</a> is defined as coming from a specific <dfn id=task-source data-export="">task source</dfn>. All the tasks from one particular <a href=#task-source id=definitions-3:task-source>task source</a> and
  destined to a particular <a href=#event-loop id=definitions-3:event-loop-14>event loop</a> (e.g. the callbacks generated by timers of a
  <code id=definitions-3:document-3><a href=dom.html#document>Document</a></code>, the events fired for mouse movements over that <code id=definitions-3:document-4><a href=dom.html#document>Document</a></code>, the
  tasks queued for the parser of that <code id=definitions-3:document-5><a href=dom.html#document>Document</a></code>) must always be added to the same
  <a href=#task-queue id=definitions-3:task-queue-4>task queue</a>, but <a href=#concept-task id=definitions-3:concept-task-6>tasks</a> from different <a href=#task-source id=definitions-3:task-source-2>task sources</a> may be placed in different <a href=#task-queue id=definitions-3:task-queue-5>task
  queues</a>.</p>

  <p class=example>For example, a user agent could have one <a href=#task-queue id=definitions-3:task-queue-6>task queue</a> for mouse and
  key events (the <a href=#user-interaction-task-source id=definitions-3:user-interaction-task-source>user interaction task source</a>), and another for everything else. The
  user agent could then give keyboard and mouse events preference over other tasks three quarters of
  the time, keeping the interface responsive but not starving other task queues, and never
  processing events from any one <a href=#task-source id=definitions-3:task-source-3>task source</a> out of order.</p>

  <p>Each <a href=#event-loop id=definitions-3:event-loop-15>event loop</a> has a <dfn id=currently-running-task>currently running task</dfn>. Initially, this is null.
  It is used to handle reentrancy. Each <a href=#event-loop id=definitions-3:event-loop-16>event loop</a> also has a <dfn id=performing-a-microtask-checkpoint>performing a
  microtask checkpoint</dfn> flag, which must initially be false. It is used to prevent reentrant
  invocation of the <a href=#perform-a-microtask-checkpoint id=definitions-3:perform-a-microtask-checkpoint>perform a microtask checkpoint</a> algorithm.</p>

  <h5 id=event-loop-processing-model data-dfn-type=dfn data-lt="event loop processing model" data-export=""><span class=secno>8.1.4.2</span> <span id=processing-model-8></span>Processing model<a href=#event-loop-processing-model class=self-link></a></h5>
  

  <p>An <a href=#event-loop id=event-loop-processing-model:event-loop>event loop</a> must continually run through the following steps for as long as it
  exists:</p>

  <ol><li id=step1><p>Let <var>oldestTask</var> be the oldest <a href=#concept-task id=event-loop-processing-model:concept-task>task</a>
   on one of the <a href=#event-loop id=event-loop-processing-model:event-loop-2>event loop</a>'s <a href=#task-queue id=event-loop-processing-model:task-queue>task queues</a>, if any,
   ignoring, in the case of a <a id=event-loop-processing-model:browsing-context href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=event-loop-processing-model:event-loop-3>event loop</a>, tasks whose
   associated <code id=event-loop-processing-model:document><a href=dom.html#document>Document</a></code>s are not <a id=event-loop-processing-model:fully-active href=browsers.html#fully-active>fully active</a>. The user agent may pick any
   <a href=#task-queue id=event-loop-processing-model:task-queue-2>task queue</a>. If there is no task to select, then jump to the <i>microtasks</i> step
   below.</li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-4>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task>currently running task</a> to
   <var>oldestTask</var>.</li><li><p>Run <var>oldestTask</var>.</li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-5>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-2>currently running task</a> back to
   null.</li><li><p>Remove <var>oldestTask</var> from its <a href=#task-queue id=event-loop-processing-model:task-queue-3>task queue</a>.</li><li><p><i>Microtasks</i>: <a href=#perform-a-microtask-checkpoint id=event-loop-processing-model:perform-a-microtask-checkpoint>Perform a microtask checkpoint</a>.</li><li>
    <p><dfn id=update-the-rendering data-export="">Update the rendering</dfn>: If this <a href=#event-loop id=event-loop-processing-model:event-loop-6>event loop</a> is a
    <a id=event-loop-processing-model:browsing-context-2 href=browsers.html#browsing-context>browsing context</a> <a href=#event-loop id=event-loop-processing-model:event-loop-7>event loop</a> (as opposed to a <a href=workers.html#workers>worker</a> <a href=#event-loop id=event-loop-processing-model:event-loop-8>event loop</a>), then run the following substeps.</p>

    <ol><li><p>Let <var>now</var> be the value that would be returned by the <code id=event-loop-processing-model:performance><a data-x-internal=performance href=https://w3c.github.io/hr-time/#the-performance-interface>Performance</a></code>
     object's <code id=event-loop-processing-model:dom-performance-now><a data-x-internal=dom-performance-now href=https://w3c.github.io/hr-time/#dom-performance-now()>now()</a></code> method. <a href=references.html#refsHRT>[HRT]</a></p>

     </li><li>
      <p>Let <var>docs</var> be the list of <code id=event-loop-processing-model:document-2><a href=dom.html#document>Document</a></code> objects associated with the
      <a href=#event-loop id=event-loop-processing-model:event-loop-9>event loop</a> in question, sorted arbitrarily except that the following conditions
      must be met:</p>

      <ul><li><p>Any <code id=event-loop-processing-model:document-3><a href=dom.html#document>Document</a></code> <var>B</var> that is <a href=browsers.html#browsing-context-nested-through id=event-loop-processing-model:browsing-context-nested-through>nested through</a> a <code id=event-loop-processing-model:document-4><a href=dom.html#document>Document</a></code> <var>A</var> must be listed after
       <var>A</var> in the list.</li><li><p>If there are two documents <var>A</var> and <var>B</var> whose <a href=browsers.html#concept-document-bc id=event-loop-processing-model:concept-document-bc>browsing contexts</a> are both <a href=browsers.html#nested-browsing-context id=event-loop-processing-model:nested-browsing-context>nested browsing contexts</a> and their <a href=browsers.html#browsing-context-container id=event-loop-processing-model:browsing-context-container>browsing context containers</a> are both elements in the same
       <code id=event-loop-processing-model:document-5><a href=dom.html#document>Document</a></code> <var>C</var>, then the order of <var>A</var> and <var>B</var> in the
       list must match the relative <a id=event-loop-processing-model:tree-order href=https://triple-underscore.github.io/DOM4-ja.html#concept-tree-order data-x-internal=tree-order>tree order</a> of their respective <a href=browsers.html#browsing-context-container id=event-loop-processing-model:browsing-context-container-2>browsing context containers</a> in
       <var>C</var>.</li></ul>

      <p>In the steps below that iterate over <var>docs</var>, each <code id=event-loop-processing-model:document-6><a href=dom.html#document>Document</a></code> must be
      processed in the order it is found in the list.</p>
     </li><li>
      <p>If there are <a href=browsers.html#top-level-browsing-context id=event-loop-processing-model:top-level-browsing-context>top-level browsing contexts</a>
      <var>B</var> that the user agent believes would not benefit from having their rendering
      updated at this time, then remove from <var>docs</var> all <code id=event-loop-processing-model:document-7><a href=dom.html#document>Document</a></code> objects whose
      <a href=browsers.html#concept-document-bc id=event-loop-processing-model:concept-document-bc-2>browsing context</a>'s <a id=event-loop-processing-model:top-level-browsing-context-2 href=browsers.html#top-level-browsing-context>top-level browsing
      context</a> is in <var>B</var>.</p>

      <div class=note>
       <p>Whether a <a id=event-loop-processing-model:top-level-browsing-context-3 href=browsers.html#top-level-browsing-context>top-level browsing context</a> would benefit from having its rendering
       updated depends on various factors, such as the update frequency. For example, if the browser
       is attempting to achieve a 60Hz refresh rate, then these steps are only necessary every 60th
       of a second (about 16.7ms). If the browser finds that a <a id=event-loop-processing-model:top-level-browsing-context-4 href=browsers.html#top-level-browsing-context>top-level browsing
       context</a> is not able to sustain this rate, it might drop to a more sustainable 30Hz for
       that set of <code id=event-loop-processing-model:document-8><a href=dom.html#document>Document</a></code>s, rather than occasionally dropping frames. (This
       specification does not mandate any particular model for when to update the rendering.)
       Similarly, if a <a id=event-loop-processing-model:top-level-browsing-context-5 href=browsers.html#top-level-browsing-context>top-level browsing context</a> is in the background, the user agent
       might decide to drop that page to a much slower 4Hz, or even less.</p>

       <p>Another example of why a browser might skip updating the rendering is to ensure certain
       <a href=#concept-task id=event-loop-processing-model:concept-task-2>tasks</a> are executed immediately after each other, with only
       <a href=#perform-a-microtask-checkpoint id=event-loop-processing-model:perform-a-microtask-checkpoint-2>microtask checkpoints</a> interleaved (and
       without, e.g., <a href=imagebitmap-and-animations.html#run-the-animation-frame-callbacks id=event-loop-processing-model:run-the-animation-frame-callbacks>animation frame
       callbacks</a> interleaved). For example, a user agent might wish to coalesce timer
       callbacks together, with no intermediate rendering updates.</p>
      </div>
     </li><li>
      <p>If there are a <a href=browsers.html#nested-browsing-context id=event-loop-processing-model:nested-browsing-context-2>nested browsing contexts</a>
      <var>B</var> that the user agent believes would not benefit from having their rendering
      updated at this time, then remove from <var>docs</var> all <code id=event-loop-processing-model:document-9><a href=dom.html#document>Document</a></code> objects whose
      <a href=browsers.html#concept-document-bc id=event-loop-processing-model:concept-document-bc-3>browsing context</a> is in <var>B</var>.</p>

      <p class=note>As with <a href=browsers.html#top-level-browsing-context id=event-loop-processing-model:top-level-browsing-context-6>top-level browsing
      contexts</a>, a variety of factors can influence whether it is profitable for a browser to
      update the rendering of <a href=browsers.html#nested-browsing-context id=event-loop-processing-model:nested-browsing-context-3>nested browsing
      contexts</a>. For example, a user agent might wish to spend less resources rendering
      third-party content, especially if it is not currently visible to the user or if resources are
      constrained. In such cases, the browser could decide to update the rendering for such content
      infrequently or never.</p>
     </li><li><p>For each <a id=event-loop-processing-model:fully-active-2 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-10><a href=dom.html#document>Document</a></code> in <var>docs</var>, <a id=event-loop-processing-model:run-the-resize-steps href=https://triple-underscore.github.io/cssom-view-ja.html#run-the-resize-steps data-x-internal=run-the-resize-steps>run
     the resize steps</a> for that <code id=event-loop-processing-model:document-11><a href=dom.html#document>Document</a></code>, passing in <var>now</var> as the
     timestamp. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-3 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-12><a href=dom.html#document>Document</a></code> in <var>docs</var>, <a id=event-loop-processing-model:run-the-scroll-steps href=https://triple-underscore.github.io/cssom-view-ja.html#run-the-scroll-steps data-x-internal=run-the-scroll-steps>run
     the scroll steps</a> for that <code id=event-loop-processing-model:document-13><a href=dom.html#document>Document</a></code>, passing in <var>now</var> as the
     timestamp. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-4 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-14><a href=dom.html#document>Document</a></code> in <var>docs</var>,
     <a id=event-loop-processing-model:evaluate-media-queries-and-report-changes href=https://triple-underscore.github.io/cssom-view-ja.html#evaluate-media-queries-and-report-changes data-x-internal=evaluate-media-queries-and-report-changes>evaluate media queries and report changes</a> for that <code id=event-loop-processing-model:document-15><a href=dom.html#document>Document</a></code>, passing
     in <var>now</var> as the timestamp. <a href=references.html#refsCSSOMVIEW>[CSSOMVIEW]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-5 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-16><a href=dom.html#document>Document</a></code> in <var>docs</var>,
     <a id=event-loop-processing-model:update-animations-and-send-events href=https://drafts.csswg.org/web-animations/#update-animations-and-send-events data-x-internal=update-animations-and-send-events>update animations and send events</a> for that <code id=event-loop-processing-model:document-17><a href=dom.html#document>Document</a></code>, passing in
     <var>now</var> as the timestamp. <a href=references.html#refsWEBANIMATIONS>[WEBANIMATIONS]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-6 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-18><a href=dom.html#document>Document</a></code> in <var>docs</var>, <a id=event-loop-processing-model:run-the-fullscreen-steps href=https://fullscreen.spec.whatwg.org/#run-the-fullscreen-steps data-x-internal=run-the-fullscreen-steps>run
     the fullscreen steps</a> for that <code id=event-loop-processing-model:document-19><a href=dom.html#document>Document</a></code>, passing in <var>now</var> as the
     timestamp. <a href=references.html#refsFULLSCREEN>[FULLSCREEN]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-7 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-20><a href=dom.html#document>Document</a></code> in <var>docs</var>, <a id=event-loop-processing-model:run-the-animation-frame-callbacks-2 href=imagebitmap-and-animations.html#run-the-animation-frame-callbacks>run
     the animation frame callbacks</a> for that <code id=event-loop-processing-model:document-21><a href=dom.html#document>Document</a></code>, passing in <var>now</var>
     as the timestamp.</li><li><p>For each <a id=event-loop-processing-model:fully-active-8 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-22><a href=dom.html#document>Document</a></code> in <var>docs</var>, <a id=event-loop-processing-model:run-the-update-intersection-observations-steps href=https://w3c.github.io/IntersectionObserver/#run-the-update-intersection-observations-steps data-x-internal=run-the-update-intersection-observations-steps>run
     the update intersection observations steps</a> for that <code id=event-loop-processing-model:document-23><a href=dom.html#document>Document</a></code>, passing in
     <var>now</var> as the timestamp. <a href=references.html#refsINTERSECTIONOBSERVER>[INTERSECTIONOBSERVER]</a></li><li><p>For each <a id=event-loop-processing-model:fully-active-9 href=browsers.html#fully-active>fully active</a> <code id=event-loop-processing-model:document-24><a href=dom.html#document>Document</a></code> in <var>docs</var>, update the
     rendering or user interface of that <code id=event-loop-processing-model:document-25><a href=dom.html#document>Document</a></code> and its <a href=browsers.html#concept-document-bc id=event-loop-processing-model:concept-document-bc-4>browsing context</a> to reflect the current state.</li></ol>
   </li><li><p>If this is a <a href=workers.html#workers>worker</a> <a href=#event-loop id=event-loop-processing-model:event-loop-10>event loop</a> (i.e. one running for a
   <code id=event-loop-processing-model:workerglobalscope><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code>), but there are no <a href=#concept-task id=event-loop-processing-model:concept-task-3>tasks</a> in the
   <a href=#event-loop id=event-loop-processing-model:event-loop-11>event loop</a>'s <a href=#task-queue id=event-loop-processing-model:task-queue-4>task queues</a> and the
   <code id=event-loop-processing-model:workerglobalscope-2><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> object's <a href=workers.html#dom-workerglobalscope-closing id=event-loop-processing-model:dom-workerglobalscope-closing>closing</a> flag is true, then destroy the <a href=#event-loop id=event-loop-processing-model:event-loop-12>event
   loop</a>, aborting these steps, resuming the <a id=event-loop-processing-model:run-a-worker href=workers.html#run-a-worker>run a worker</a> steps described in the
   <a href=workers.html#workers>Web workers</a> section below.</li></ol>

  <hr>

  <p>Each <a href=#event-loop id=event-loop-processing-model:event-loop-13>event loop</a> has a <dfn id=microtask-queue>microtask queue</dfn>. A <dfn id=microtask data-export="">microtask</dfn> is a <a href=#concept-task id=event-loop-processing-model:concept-task-4>task</a> that is originally to
  be queued on the <a href=#microtask-queue id=event-loop-processing-model:microtask-queue>microtask queue</a> rather than a <a href=#task-queue id=event-loop-processing-model:task-queue-5>task queue</a>. There are two
  kinds of <a href=#microtask id=event-loop-processing-model:microtask>microtasks</a>: <dfn id=solitary-callback-microtask data-lt="solitary callback microtask" data-export="">solitary callback
  microtasks</dfn>, and <dfn id=compound-microtask data-lt="compound microtask" data-export="">compound microtasks</dfn>.</p>

  <p class=note>This specification only has <a href=#solitary-callback-microtask id=event-loop-processing-model:solitary-callback-microtask>solitary
  callback microtasks</a>. Specifications that use <a href=#compound-microtask id=event-loop-processing-model:compound-microtask>compound
  microtasks</a> have to take extra care to <a href=#execute-a-compound-microtask-subtask id=event-loop-processing-model:execute-a-compound-microtask-subtask>wrap callbacks</a> to handle <a href=#spin-the-event-loop id=event-loop-processing-model:spin-the-event-loop>spinning the event
  loop</a>.</p>

  <p>When an algorithm requires a <a href=#microtask id=event-loop-processing-model:microtask-2>microtask</a> to be <dfn id=queue-a-microtask data-lt="queue a microtask" data-export="">queued</dfn>, it must be appended to the
  relevant <a href=#event-loop id=event-loop-processing-model:event-loop-14>event loop</a>'s <a href=#microtask-queue id=event-loop-processing-model:microtask-queue-2>microtask queue</a>; the <a href=#task-source id=event-loop-processing-model:task-source>task source</a> of
  such a <a href=#microtask id=event-loop-processing-model:microtask-3>microtask</a> is the <dfn id=microtask-task-source>microtask task source</dfn>.</p>

  <p class=note>It is possible for a <a href=#microtask id=event-loop-processing-model:microtask-4>microtask</a> to be moved to a regular <a href=#task-queue id=event-loop-processing-model:task-queue-6>task
  queue</a>, if, during its initial execution, it <a href=#spin-the-event-loop id=event-loop-processing-model:spin-the-event-loop-2>spins the
  event loop</a>. In that case, the <a href=#microtask-task-source id=event-loop-processing-model:microtask-task-source>microtask task source</a> is the <a href=#task-source id=event-loop-processing-model:task-source-2>task
  source</a> used. Normally, the <a href=#task-source id=event-loop-processing-model:task-source-3>task source</a> of a <a href=#microtask id=event-loop-processing-model:microtask-5>microtask</a> is
  irrelevant.</p>

  <p>When a user agent is to <dfn id=perform-a-microtask-checkpoint data-export="">perform a microtask checkpoint</dfn>, if the
  <a href=#performing-a-microtask-checkpoint id=event-loop-processing-model:performing-a-microtask-checkpoint>performing a microtask checkpoint</a> flag is false, then the user agent must run the
  following steps:</p>

  <ol><li><p>Set the <a href=#performing-a-microtask-checkpoint id=event-loop-processing-model:performing-a-microtask-checkpoint-2>performing a microtask checkpoint</a> flag to true.</li><li>
    <p>While the <a href=#event-loop id=event-loop-processing-model:event-loop-15>event loop</a>'s <a href=#microtask-queue id=event-loop-processing-model:microtask-queue-3>microtask queue</a> is not empty:</p>

    <ol><li><p>Let <var>oldestMicrotask</var> be the oldest <a href=#microtask id=event-loop-processing-model:microtask-6>microtask</a> on the <a href=#event-loop id=event-loop-processing-model:event-loop-16>event
     loop</a>'s <a href=#microtask-queue id=event-loop-processing-model:microtask-queue-4>microtask queue</a>.</li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-17>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-3>currently running task</a> to
     <var>oldestMicrotask</var>.</li><li>
      <p>Run <var>oldestMicrotask</var>.</p>

      <p class=note>This might involve invoking scripted callbacks, which eventually calls the
      <a href=#clean-up-after-running-script id=event-loop-processing-model:clean-up-after-running-script>clean up after running script</a> steps, which call this <a href=#perform-a-microtask-checkpoint id=event-loop-processing-model:perform-a-microtask-checkpoint-3>perform a microtask
      checkpoint</a> algorithm again, which is why we use the <a href=#performing-a-microtask-checkpoint id=event-loop-processing-model:performing-a-microtask-checkpoint-3>performing a microtask
      checkpoint</a> flag to avoid reentrancy.</p>
     </li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-18>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-4>currently running task</a> back to
     null.</li><li><p>Remove <var>oldestMicrotask</var> from the <a href=#microtask-queue id=event-loop-processing-model:microtask-queue-5>microtask queue</a>.</li></ol>
   </li><li><p>For each <a href=#environment-settings-object id=event-loop-processing-model:environment-settings-object>environment settings object</a> whose <a href=#responsible-event-loop id=event-loop-processing-model:responsible-event-loop>responsible event
   loop</a> is this <a href=#event-loop id=event-loop-processing-model:event-loop-19>event loop</a>, <a href=#notify-about-rejected-promises id=event-loop-processing-model:notify-about-rejected-promises>notify about rejected promises</a> on that
   <a href=#environment-settings-object id=event-loop-processing-model:environment-settings-object-2>environment settings object</a>.</li><li><p><a id=event-loop-processing-model:cleanup-indexed-database-transactions href=https://w3c.github.io/IndexedDB/#cleanup-indexed-database-transactions data-x-internal=cleanup-indexed-database-transactions>Cleanup Indexed Database transactions</a>.</li><li><p>Set the <a href=#performing-a-microtask-checkpoint id=event-loop-processing-model:performing-a-microtask-checkpoint-4>performing a microtask checkpoint</a> flag to false.</li></ol>

  <p>If, while a <a href=#compound-microtask id=event-loop-processing-model:compound-microtask-2>compound microtask</a> is running, the user agent is required to
  <dfn id=execute-a-compound-microtask-subtask data-export="">execute a compound microtask subtask</dfn> to run a series of steps, the user
  agent must run the following steps:</p>

  <ol><li><p>Let <var>parent</var> be the <a href=#event-loop id=event-loop-processing-model:event-loop-20>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-5>currently running
   task</a> (the currently running <a href=#compound-microtask id=event-loop-processing-model:compound-microtask-3>compound microtask</a>).</li><li><p>Let <var>subtask</var> be a new <a href=#concept-task id=event-loop-processing-model:concept-task-5>task</a> that
   consists of running the given series of steps. The <a href=#task-source id=event-loop-processing-model:task-source-4>task source</a> of such a
   <a href=#microtask id=event-loop-processing-model:microtask-7>microtask</a> is the <a href=#microtask-task-source id=event-loop-processing-model:microtask-task-source-2>microtask task source</a>. This is a <dfn id=compound-microtask-subtask>compound
   microtask subtask</dfn>.</li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-21>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-6>currently running task</a> to <var>subtask</var>.</li><li><p>Run <var>subtask</var>.</li><li><p>Set the <a href=#event-loop id=event-loop-processing-model:event-loop-22>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-7>currently running task</a> back to <var>parent</var>.</li></ol>

  <hr>

  <p>When an algorithm running <a id=event-loop-processing-model:in-parallel href=infrastructure.html#in-parallel>in parallel</a> is to <dfn id=await-a-stable-state>await a stable state</dfn>, the
  user agent must <a href=#queue-a-microtask id=event-loop-processing-model:queue-a-microtask>queue a microtask</a> that runs the following steps, and must then stop
  executing (execution of the algorithm resumes when the microtask is run, as described in the
  following steps):</p>

  <ol><li><p>Run the algorithm's <dfn id=synchronous-section>synchronous section</dfn>.</li><li><p>Resumes execution of the algorithm <a id=event-loop-processing-model:in-parallel-2 href=infrastructure.html#in-parallel>in parallel</a>, if appropriate, as described
   in the algorithm's steps.</li></ol>

  <p class=note>Steps in <a href=#synchronous-section id=event-loop-processing-model:synchronous-section>synchronous sections</a> are marked
  with ⌛.</p>

  <hr>

  <p>When an algorithm says to <dfn id=spin-the-event-loop>spin the event loop</dfn> until a condition <var>goal</var> is met, the user agent must run the following steps:</p>

  <ol><li>

    <p>Let <var>task</var> be the <a href=#event-loop id=event-loop-processing-model:event-loop-23>event loop</a>'s <a href=#currently-running-task id=event-loop-processing-model:currently-running-task-8>currently running
    task</a>.</p>

    <p class=note>This might be a <a href=#microtask id=event-loop-processing-model:microtask-8>microtask</a>, in which case it is a <a href=#solitary-callback-microtask id=event-loop-processing-model:solitary-callback-microtask-2>solitary
    callback microtask</a>. It could also be a <a href=#compound-microtask-subtask id=event-loop-processing-model:compound-microtask-subtask>compound microtask subtask</a>, or a
    regular <a href=#concept-task id=event-loop-processing-model:concept-task-6>task</a> that is not a <a href=#microtask id=event-loop-processing-model:microtask-9>microtask</a>. It will
    <em>not</em> be a <a href=#compound-microtask id=event-loop-processing-model:compound-microtask-4>compound microtask</a>.</p> 

   </li><li><p>Let <var>task source</var> be <var>task</var>'s <a href=#task-source id=event-loop-processing-model:task-source-5>task
   source</a>.</li><li><p>Let <var>old stack</var> be a copy of the <a id=event-loop-processing-model:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context
   stack</a>.</li><li><p>Empty the <a id=event-loop-processing-model:javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</li><li><p><a href=#perform-a-microtask-checkpoint id=event-loop-processing-model:perform-a-microtask-checkpoint-4>Perform a microtask checkpoint</a>.</li><li>

    <p>Stop <var>task</var>, allowing whatever algorithm that invoked it to resume, but
    continue these steps <a id=event-loop-processing-model:in-parallel-3 href=infrastructure.html#in-parallel>in parallel</a>.</p>

    <p class=note>This causes one of the following algorithms to continue: the <a href=#event-loop id=event-loop-processing-model:event-loop-24>event
    loop</a>'s main set of steps, the <a href=#perform-a-microtask-checkpoint id=event-loop-processing-model:perform-a-microtask-checkpoint-5>perform a microtask checkpoint</a> algorithm, or
    the <a href=#execute-a-compound-microtask-subtask id=event-loop-processing-model:execute-a-compound-microtask-subtask-2>execute a compound microtask subtask</a> algorithm.</p>

   </li><li><p>Wait until the condition <var>goal</var> is met.</li><li><p><a href=#queue-a-task id=event-loop-processing-model:queue-a-task>Queue a task</a> to continue running these steps, using the <a href=#task-source id=event-loop-processing-model:task-source-6>task
   source</a> <var>task source</var>. Wait until this new task runs before continuing
   these steps.</li><li><p>Replace the <a id=event-loop-processing-model:javascript-execution-context-stack-3 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a> with the <var>old
   stack</var>.</li><li><p>Return to the caller.</li></ol>

  <hr>

  <p>Some of the algorithms in this specification, for historical reasons, require the user agent to
  <dfn id=pause>pause</dfn> while running a <a href=#concept-task id=event-loop-processing-model:concept-task-7>task</a> until a condition <var>goal</var> is met. This means running the following steps:</p>

  <ol><li><p>If necessary, update the rendering or user interface of any <code id=event-loop-processing-model:document-26><a href=dom.html#document>Document</a></code> or
   <a id=event-loop-processing-model:browsing-context-3 href=browsers.html#browsing-context>browsing context</a> to reflect the current state.</li><li><p>Wait until the condition <var>goal</var> is met. While a user agent has a paused
   <a href=#concept-task id=event-loop-processing-model:concept-task-8>task</a>, the corresponding <a href=#event-loop id=event-loop-processing-model:event-loop-25>event loop</a> must not run
   further <a href=#concept-task id=event-loop-processing-model:concept-task-9>tasks</a>, and any script in the currently running <a href=#concept-task id=event-loop-processing-model:concept-task-10>task</a> must block. User agents should remain responsive to user input
   while paused, however, albeit in a reduced capacity since the <a href=#event-loop id=event-loop-processing-model:event-loop-26>event loop</a> will not be
   doing anything.</li></ol>

  <div class=warning>
   <p><a href=#pause id=event-loop-processing-model:pause>Pausing</a> is highly detrimental to the user experience, especially
   in scenarios where a single <a href=#event-loop id=event-loop-processing-model:event-loop-27>event loop</a> is shared among multiple documents. User
   agents are encouraged to experiment with alternatives to <a href=#pause id=event-loop-processing-model:pause-2>pausing</a>,
   such as <a href=#spin-the-event-loop id=event-loop-processing-model:spin-the-event-loop-3>spinning the event loop</a> or even simply
   proceeding without any kind of suspended execution at all, insofar as it is possible to do so
   while preserving compatibility with existing content. This specification will happily change if
   a less-drastic alternative is discovered to be web-compatible.</p>

   <p>In the interim, implementers should be aware that the variety of alternatives that user agents
   might experiment with can change subtle aspects of <a href=#event-loop id=event-loop-processing-model:event-loop-28>event loop</a> behavior, including
   <a href=#concept-task id=event-loop-processing-model:concept-task-11>task</a> and <a href=#microtask id=event-loop-processing-model:microtask-10>microtask</a> timing. Implementations should
   continue experimenting even if doing so causes them to violate the exact semantics implied by the
   <a href=#pause id=event-loop-processing-model:pause-3>pause</a> operation.</p>
  </div>

  <h5 id=generic-task-sources><span class=secno>8.1.4.3</span> Generic task sources<a href=#generic-task-sources class=self-link></a></h5>

  <p>The following <a href=#task-source id=generic-task-sources:task-source>task sources</a> are used by a number of mostly
  unrelated features in this and other specifications.</p>

  <dl><dt>The <dfn id=dom-manipulation-task-source data-dfn-type=dfn data-export="">DOM manipulation task source</dfn><dd>

    <p>This <a href=#task-source id=generic-task-sources:task-source-2>task source</a> is used for features that react to DOM manipulations, such as
    things that happen in a non-blocking fashion when an element is <a href=infrastructure.html#insert-an-element-into-a-document id=generic-task-sources:insert-an-element-into-a-document>inserted into the document</a>.</p>

   <dt>The <dfn id=user-interaction-task-source data-export="">user interaction task source</dfn><dd>

    <p>This <a href=#task-source id=generic-task-sources:task-source-3>task source</a> is used for features that react to user interaction, for
    example keyboard or mouse input.</p>

    <p>Events sent in response to user input (e.g. <code id=generic-task-sources:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> events) must be fired using <a href=#concept-task id=generic-task-sources:concept-task>tasks</a> <a href=#queue-a-task id=generic-task-sources:queue-a-task>queued</a> with the <a href=#user-interaction-task-source id=generic-task-sources:user-interaction-task-source>user
    interaction task source</a>. <a href=references.html#refsUIEVENTS>[UIEVENTS]</a></p> 

   <dt>The <dfn id=networking-task-source data-export="">networking task source</dfn><dd>

    <p>This <a href=#task-source id=generic-task-sources:task-source-4>task source</a> is used for features that trigger in response to network
    activity.</p>

   <dt>The <dfn id=history-traversal-task-source data-export="">history traversal task source</dfn><dd>

    <p>This <a href=#task-source id=generic-task-sources:task-source-5>task source</a> is used to queue calls to <code id=generic-task-sources:dom-history-back><a href=history.html#dom-history-back>history.back()</a></code> and similar APIs.</p>

   </dl>

  <h5 id=event-loop-for-spec-authors><span class=secno>8.1.4.4</span> Dealing with the event loop from other specifications<a href=#event-loop-for-spec-authors class=self-link></a></h5>

  <p>Writing specifications that correctly interact with the <a href=#event-loop id=event-loop-for-spec-authors:event-loop>event loop</a> can be tricky.
  This is compounded by how this specification uses concurrency-model-independent terminology, so we
  say things like "<a href=#event-loop id=event-loop-for-spec-authors:event-loop-2>event loop</a>" and "<a id=event-loop-for-spec-authors:in-parallel href=infrastructure.html#in-parallel>in parallel</a>" instead of using more
  familiar model-specific terms like "main thread" or "on a background thread".</p>

  <p>By default, specification text generally runs on the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-3>event loop</a>. This falls out
  from the formal <a href=#event-loop-processing-model>event loop processing model</a>, in that
  you can eventually trace most algorithms back to a <a href=#concept-task id=event-loop-for-spec-authors:concept-task>task</a> <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task>queued</a> there.</p>

  <p class=example>The algorithm steps for any JavaScript method will be invoked by author code
  calling that method. And author code can only be run via queued tasks, usually originating
  somewhere in the <a href=script-processing-model><code>script</code> processing model</a>.</p>

  <p>From this starting point, the overriding guideline is that any work a specification needs to
  perform that would otherwise block the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-4>event loop</a> must instead be performed <a id=event-loop-for-spec-authors:in-parallel-2 href=infrastructure.html#in-parallel>in
  parallel</a> with it. This includes (but is not limited to):</p>

  <ul><li><p>performing heavy computation;</li><li><p>displaying a user-facing prompt;</li><li><p>performing operations which could require involving outside systems (i.e. "going out of
   process").</li></ul>

  <p>The next complication is that, in algorithm sections that are <a id=event-loop-for-spec-authors:in-parallel-3 href=infrastructure.html#in-parallel>in parallel</a>, you
  must not create or manipulate objects associated to a specific <a id=event-loop-for-spec-authors:javascript-realm href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript realm</a>,
  <a href=#global-object id=event-loop-for-spec-authors:global-object>global</a>, or <a href=#environment-settings-object id=event-loop-for-spec-authors:environment-settings-object>environment settings object</a>. (Stated
  in more familiar terms, you must not directly access main-thread artifacts from a background
  thread.) Doing so would create data races observable to JavaScript code, since after all, your
  algorithm steps are running <em><a id=event-loop-for-spec-authors:in-parallel-4 href=infrastructure.html#in-parallel>in parallel</a></em> to the JavaScript code.</p>

  <p>You can, however, manipulate specification-level data structures and values from the WHATWG
  Infra Standard, as those are realm-agnostic. They are never directly exposed to JavaScript without
  a specific conversion taking place (often <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=event-loop-for-spec-authors:concept-idl-convert data-x-internal=concept-idl-convert>via Web IDL</a>).
  <a href=references.html#refsINFRA>[INFRA]</a> <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>

  <p>To affect the world of observable JavaScript objects, then, you must <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-2>queue a task</a>
  to perform any such manipulations. This ensures your steps are properly interleaved with respect
  to other things happening on the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-5>event loop</a>. Furthermore, you must choose a
  <a href=#task-source id=event-loop-for-spec-authors:task-source>task source</a> when <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-3>queueing a task</a>; this governs the
  relative order of your steps versus others. If you are unsure which <a href=#task-source id=event-loop-for-spec-authors:task-source-2>task source</a> to
  use, pick one of the <a href=#generic-task-sources>generic task sources</a> that sounds most
  applicable.</p>

  <p>Most invocations of <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-4>queue a task</a> implicitly use "the relevant <a href=#event-loop id=event-loop-for-spec-authors:event-loop-6>event
  loop</a>", i.e., the one that is obvious from context. That is because it is very rare for
  algorithms to be invoked in contexts involving multiple event loops. (Unlike contexts involving
  multiple global objects, which happen all the time!) So unless you are writing a specification
  which, e.g., deals with manipulating <a href=workers.html#workers>workers</a>, you can omit this argument
  when <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-5>queueing a task</a>.</p>

  <p>Putting this all together, we can provide a template for a typical algorithm that needs to do
  work asynchronously:</p>

  <ol><li><p>Do any synchronous setup work, while still on the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-7>event loop</a>. This may
   include converting <a href=https://tc39.github.io/ecma262/#sec-code-realms id=event-loop-for-spec-authors:javascript-realm-2 data-x-internal=javascript-realm>realm</a>-specific JavaScript values into
   realm-agnostic specification-level values.</li><li><p>Perform a set of potentially-expensive steps <a id=event-loop-for-spec-authors:in-parallel-5 href=infrastructure.html#in-parallel>in parallel</a>, operating entirely on
   realm-agnostic values, and producing a realm-agnostic result.</li><li><p><a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-6>Queue a task</a>, on a specified <a href=#task-source id=event-loop-for-spec-authors:task-source-3>task source</a>, to convert the
   realm-agnostic result back into observable effects on the observable world of JavaScript objects
   on the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-8>event loop</a>.</li></ol>

  <div id=example-event-loop-using-algorithm class=example>

   <p>The following is an algorithm that "encrypts" a passed-in <a id=event-loop-for-spec-authors:list href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of <a href=https://triple-underscore.github.io/infra-ja.html#scalar-value-string id=event-loop-for-spec-authors:scalar-value-string data-x-internal=scalar-value-string>scalar value strings</a> <var>input</var>, after parsing them as
   URLs:</p>

   <ol><li><p>Let <var>urls</var> be an empty <a id=event-loop-for-spec-authors:list-2 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a>.</li><li>
     <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=event-loop-for-spec-authors:list-iterate data-x-internal=list-iterate>For each</a> <var>string</var> of <var>input</var>:</p>

     <ol><li><p>Let <var>parsed</var> be the result of <a href=urls-and-fetching.html#parse-a-url id=event-loop-for-spec-authors:parse-a-url>parsing</a>
      <var>string</var> relative to the <a href=#current-settings-object id=event-loop-for-spec-authors:current-settings-object>current settings object</a>.</li><li><p>If <var>parsed</var> is failure, return a promise rejected with a
      <a id=event-loop-for-spec-authors:syntaxerror href=https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=event-loop-for-spec-authors:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Let <var>serialized</var> be the result of applying the <a href=https://triple-underscore.github.io/URL-ja.html#concept-url-serializer id=event-loop-for-spec-authors:concept-url-serializer data-x-internal=concept-url-serializer>URL serializer</a> to <var>parsed</var>.</li><li><p><a href=https://infra.spec.whatwg.org/#list-append id=event-loop-for-spec-authors:list-append data-x-internal=list-append>Append</a> <var>serialized</var> to <var>urls</var>.</li></ol>
    </li><li><p>Let <var>realm</var> be the <a id=event-loop-for-spec-authors:current-realm-record href=https://tc39.github.io/ecma262/#current-realm data-x-internal=current-realm-record>current Realm Record</a>.</li><li><p>Let <var>p</var> be a new promise.</li><li>
     <p>Run the following steps <a id=event-loop-for-spec-authors:in-parallel-6 href=infrastructure.html#in-parallel>in parallel</a>:</p>

     <ol><li><p>Let <var>encryptedURLs</var> be an empty <a id=event-loop-for-spec-authors:list-3 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a>.</li><li>
       <p><a href=https://triple-underscore.github.io/infra-ja.html#list-iterate id=event-loop-for-spec-authors:list-iterate-2 data-x-internal=list-iterate>For each</a> <var>url</var> of <var>urls</var>:</p>

       <ol><li><p>Wait 100 milliseconds, so that people think we're doing heavy-duty encryption.</li><li><p>Let <var>encrypted</var> be a new <a id=event-loop-for-spec-authors:javascript-string href=https://triple-underscore.github.io/infra-ja.html#javascript-string data-x-internal=javascript-string>JavaScript string</a> derived from
        <var>url</var>, whose <var>n</var>th <a id=event-loop-for-spec-authors:code-unit href=https://triple-underscore.github.io/infra-ja.html#code-unit data-x-internal=code-unit>code unit</a> is equal to <var>url</var>'s
        <var>n</var>th <a id=event-loop-for-spec-authors:code-unit-2 href=https://triple-underscore.github.io/infra-ja.html#code-unit data-x-internal=code-unit>code unit</a> plus 13.</li><li><p><a href=https://infra.spec.whatwg.org/#list-append id=event-loop-for-spec-authors:list-append-2 data-x-internal=list-append>Append</a> <var>encrypted</var> to
        <var>encryptedURLs</var>.</p>
       </li></ol>
      </li><li>
       <p><a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-7>Queue a task</a>, on the <a href=#networking-task-source id=event-loop-for-spec-authors:networking-task-source>networking task source</a>, to perform the
       following steps:</p>

       <ol><li><p>Let <var>array</var> be the result of <a href=https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping id=event-loop-for-spec-authors:concept-idl-convert-2 data-x-internal=concept-idl-convert>converting</a> <var>encryptedURLs</var> to a JavaScript
        array, in <var>realm</var>.</li><li><p>Resolve <var>p</var> with <var>array</var>.</li></ol>
      </li></ol>
    </li><li><p>Return <var>p</var>.</li></ol>

   <p>Here are several things to notice about this algorithm:</p>

   <ul><li><p>It does its URL parsing up front, on the <a href=#event-loop id=event-loop-for-spec-authors:event-loop-9>event loop</a>, before going to the
    <a id=event-loop-for-spec-authors:in-parallel-7 href=infrastructure.html#in-parallel>in parallel</a> steps. This is necessary, since parsing depends on the <a href=#current-settings-object id=event-loop-for-spec-authors:current-settings-object-2>current
    settings object</a>, which would no longer be current after going <a id=event-loop-for-spec-authors:in-parallel-8 href=infrastructure.html#in-parallel>in
    parallel</a>.</li><li><p>Alternately, it could have saved a reference to the <a href=#current-settings-object id=event-loop-for-spec-authors:current-settings-object-3>current settings
    object</a>'s <a href=#api-base-url id=event-loop-for-spec-authors:api-base-url>API base URL</a> and used it during the <a id=event-loop-for-spec-authors:in-parallel-9 href=infrastructure.html#in-parallel>in parallel</a> steps;
    that would have been equivalent. However, we recommend instead doing as much work as possible up
    front, as this example does. Attempting to save the correct values can be error prone; for
    example, if we'd saved just the <a href=#current-settings-object id=event-loop-for-spec-authors:current-settings-object-4>current settings object</a>, instead of its <a href=#api-base-url id=event-loop-for-spec-authors:api-base-url-2>API
    base URL</a>, there would have been a potential race.</li><li><p>It implicitly passes a <a id=event-loop-for-spec-authors:list-4 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of <a href=https://triple-underscore.github.io/infra-ja.html#javascript-string id=event-loop-for-spec-authors:javascript-string-2 data-x-internal=javascript-string>JavaScript
    strings</a> from the initial steps to the <a id=event-loop-for-spec-authors:in-parallel-10 href=infrastructure.html#in-parallel>in parallel</a> steps. This is OK, as
    both <a href=https://triple-underscore.github.io/infra-ja.html#list id=event-loop-for-spec-authors:list-5 data-x-internal=list>lists</a> and <a href=https://triple-underscore.github.io/infra-ja.html#javascript-string id=event-loop-for-spec-authors:javascript-string-3 data-x-internal=javascript-string>JavaScript
    strings</a> are <a href=https://tc39.github.io/ecma262/#sec-code-realms id=event-loop-for-spec-authors:javascript-realm-3 data-x-internal=javascript-realm>realm</a>-agnostic.</li><li><p>It performs "expensive computation" (waiting for 100 milliseconds per input URL) during
    the <a id=event-loop-for-spec-authors:in-parallel-11 href=infrastructure.html#in-parallel>in parallel</a> steps, thus not blocking the main <a href=#event-loop id=event-loop-for-spec-authors:event-loop-10>event loop</a>.</li><li><p>Promises, as observable JavaScript objects, are never created and manipulated during the
    <a id=event-loop-for-spec-authors:in-parallel-12 href=infrastructure.html#in-parallel>in parallel</a> steps. <var>p</var> is created before entering those steps, and then is
    manipulated during a <a href=#concept-task id=event-loop-for-spec-authors:concept-task-2>task</a> that is <a href=#queue-a-task id=event-loop-for-spec-authors:queue-a-task-8>queued</a> specifically for that purpose.</li><li><p>The creation of a JavaScript array object also happens during the queued task, and is
    careful to specify which realm it creates the array in since that is no longer obvious from
    context.</li></ul>

   <p>(On these last two points, see also <a href=https://github.com/w3ctag/promises-guide/issues/52>w3ctag/promises-guide#52</a>, <a href=https://github.com/heycam/webidl/issues/135>heycam/webidl#135</a>, and <a href=https://github.com/heycam/webidl/issues/371>heycam/webidl#371</a>, where we are still
   mulling over the subtleties of the above promise-resolution pattern.)</p>

   <p>Another thing to note is that, in the event this algorithm was called from a Web IDL-specified
   operation taking a <code>sequence</code>&lt;<code id=event-loop-for-spec-authors:idl-usvstring><a data-x-internal=idl-usvstring href=https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString>USVString</a></code>&gt;, there was an automatic conversion from <a href=https://tc39.github.io/ecma262/#sec-code-realms id=event-loop-for-spec-authors:javascript-realm-4 data-x-internal=javascript-realm>realm</a>-specific JavaScript objects provided by the author as
   input, into the realm-agnostic <code>sequence</code>&lt;<code id=event-loop-for-spec-authors:idl-usvstring-2><a data-x-internal=idl-usvstring href=https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString>USVString</a></code>&gt; Web IDL type, which we then treat as a
   <a id=event-loop-for-spec-authors:list-6 href=https://triple-underscore.github.io/infra-ja.html#list data-x-internal=list>list</a> of <a href=https://triple-underscore.github.io/infra-ja.html#scalar-value-string id=event-loop-for-spec-authors:scalar-value-string-2 data-x-internal=scalar-value-string>scalar value strings</a>. So depending
   on how your specification is structured, there may be other implicit steps happening on the main
   <a href=#event-loop id=event-loop-for-spec-authors:event-loop-11>event loop</a> that play a part in this whole process of getting you ready to go
   <a id=event-loop-for-spec-authors:in-parallel-13 href=infrastructure.html#in-parallel>in parallel</a>.</p>

  </div>


  

  <h4 id=events><span class=secno>8.1.5</span> イベント<a href=#events class=self-link></a></h4>

  <h5 id=event-handler-attributes><span class=secno>8.1.5.1</span> イベントハンドラー<a href=#event-handler-attributes class=self-link></a></h5>

  

  <p>多くのオブジェクトは、指定した<dfn id=event-handlers data-lt="event handler" data-export="">イベントハンドラー</dfn>を持つことができる。これらは、それらが指定されるオブジェクトに対する非キャプチャーイベントリスナーとして作動する。<a href=references.html#refsDOM>[DOM]</a></p>

  <p><a href=#event-handlers id=event-handler-attributes:event-handlers>イベントハンドラー</a>は、常に"<code>on</code>"で始まり、意図されるイベントの名前が後に続く名前を持つ。</p>

  <p><a href=#event-handlers id=event-handler-attributes:event-handlers-2>イベントハンドラー</a>は、nullである、またはコールバックオブジェクトである、または<a href=#internal-raw-uncompiled-handler id=event-handler-attributes:internal-raw-uncompiled-handler>初期生未コンパイルハンドラー</a>であるかのいずれかとなる値を持つ。The <code id=event-handler-attributes:eventhandler><a href=#eventhandler>EventHandler</a></code>コールバック関数型は、これがスクリプトに公開される方法を説明する。最初に、<a href=#event-handlers id=event-handler-attributes:event-handlers-3>イベントハンドラー</a>の値は、nullに設定されなければならない。</p>

  <p>イベントハンドラーは、2つの方法のいずれかで公開される。</p>

  <p>1つ目の方法は、すべてのイベントハンドラーに共通する、<a href=#event-handler-idl-attributes id=event-handler-attributes:event-handler-idl-attributes>イベントハンドラーIDL属性</a>としてである。</p>

  <p>2つ目の方法は、<a href=#event-handler-content-attributes id=event-handler-attributes:event-handler-content-attributes>イベントハンドラーコンテンツ属性</a>としてである。<a id=event-handler-attributes:html-elements href=infrastructure.html#html-elements>HTML要素</a>のイベントハンドラーおよび<code id=event-handler-attributes:window><a href=window-object.html#window>Window</a></code>オブジェクトのイベントハンドラーの一部は、この方法で公開される。</p>

  

  <hr>

  <p><dfn id=event-handler-idl-attributes data-export="">イベントハンドラーIDL属性</dfn>は、特定の<a href=#event-handlers id=event-handler-attributes:event-handlers-4>イベントハンドラー</a>に対するIDL属性である。IDL属性の名前は、<a href=#event-handlers id=event-handler-attributes:event-handlers-5>イベントハンドラー</a>の名前と同じである。</p>

  <p><a href=#event-handler-idl-attributes id=event-handler-attributes:event-handler-idl-attributes-2>Event handler IDL attributes</a>, on setting, must set the corresponding <a href=#event-handlers id=event-handler-attributes:event-handlers-6>event handler</a> to their new value, and on getting, must return the
  result of <a href=#getting-the-current-value-of-the-event-handler id=event-handler-attributes:getting-the-current-value-of-the-event-handler>getting the current value of the event handler</a> in question.</p>

  <p>If an <a href=#event-handler-idl-attributes id=event-handler-attributes:event-handler-idl-attributes-3>event handler IDL attribute</a> exposes an
  <a href=#event-handlers id=event-handler-attributes:event-handlers-7>event handler</a> of an object that doesn't exist, it must always
  return null on getting and must do nothing on setting.</p>

  <p class=note>This can happen in particular for <a href=#event-handler-idl-attributes id=event-handler-attributes:event-handler-idl-attributes-4>event
  handler IDL attribute</a> on <code id=event-handler-attributes:the-body-element><a href=sections.html#the-body-element>body</a></code> elements that do not have corresponding
  <code id=event-handler-attributes:window-2><a href=window-object.html#window>Window</a></code> objects.</p>

  <p class=note>Certain event handler IDL attributes have additional requirements, in particular
  the <code id=event-handler-attributes:handler-messageport-onmessage><a href=web-messaging.html#handler-messageport-onmessage>onmessage</a></code> attribute of
  <code id=event-handler-attributes:messageport><a href=web-messaging.html#messageport>MessagePort</a></code> objects.</p>

  <hr>

  

  <p><dfn id=event-handler-content-attributes data-export="">イベントハンドラーコンテンツ属性</dfn>は、特定の<a href=#event-handlers id=event-handler-attributes:event-handlers-8>イベントハンドラー</a>に対するコンテンツ属性である。コンテンツ属性の名前は、<a href=#event-handlers id=event-handler-attributes:event-handlers-9>イベントハンドラー</a>の名前と同じである。</p>

  <p><a href=#event-handler-content-attributes id=event-handler-attributes:event-handler-content-attributes-2>イベントハンドラーコンテンツ属性</a>が指定される場合、解析される際に、<a id=event-handler-attributes:automatic-semicolon-insertion href=https://tc39.github.io/ecma262/#sec-automatic-semicolon-insertion data-x-internal=automatic-semicolon-insertion>自動セミコロン挿入</a>後の<i id=event-handler-attributes:js-prod-functionbody><a data-x-internal=js-prod-functionbody href=https://tc39.github.io/ecma262/#prod-FunctionBody>FunctionBody</a></i>生成物と一致する、妥当なJavaScriptコードを含まなければならない。</p>

  

  <p>When an <a href=#event-handler-content-attributes id=event-handler-attributes:event-handler-content-attributes-3>event handler content attribute</a>
  is set, execute the following steps:</p>

  <ol><li><p>If the <a id="event-handler-attributes:should-element's-inline-behavior-be-blocked-by-content-security-policy" href=https://triple-underscore.github.io/CSP3-ja.html#should-block-inline data-x-internal="should-element's-inline-behavior-be-blocked-by-content-security-policy">Should element's inline behavior be blocked by Content Security
   Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon the
   attribute's <a id=event-handler-attributes:element href=https://triple-underscore.github.io/DOM4-ja.html#interface-element data-x-internal=element>element</a>, "<code>script attribute</code>", and the attribute's
   value, then return. <a href=references.html#refsCSP>[CSP]</a></li><li><p>Set the corresponding <a href=#event-handlers id=event-handler-attributes:event-handlers-10>event handler</a> to an
   <a href=#internal-raw-uncompiled-handler id=event-handler-attributes:internal-raw-uncompiled-handler-2>internal raw uncompiled handler</a> consisting of the attribute's new value and the
   script location where the attribute was set to this value</li></ol>

  <p>When an event handler content attribute is removed, the user agent must set the corresponding
  <a href=#event-handlers id=event-handler-attributes:event-handlers-11>event handler</a> to null.</p>
  

  <hr>

  <p>When an <a href=#event-handlers id=event-handler-attributes:event-handlers-12>event handler</a> <var>H</var> of an element or object
  <var>T</var> implementing the <code id=event-handler-attributes:eventtarget><a data-x-internal=eventtarget href=https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget>EventTarget</a></code> interface is first set to a non-null value,
  the user agent must append an <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener id=event-handler-attributes:concept-event-listener data-x-internal=concept-event-listener>event listener</a> to the
  list of <a href=https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener id=event-handler-attributes:concept-event-listener-2 data-x-internal=concept-event-listener>event listeners</a> associated with <var>T</var>
  with <b>type</b> set to the <dfn id=event-handler-event-type data-export="">event handler event type</dfn> corresponding to
  <var>H</var> and <b>callback</b> set to the result of creating a Web IDL <code id=event-handler-attributes:dom-eventlistener><a data-x-internal=dom-eventlistener href=https://dom.spec.whatwg.org/#callbackdef-eventlistener>EventListener</a></code> instance representing a reference to a function of
  one argument that executes the steps of <a href=#the-event-handler-processing-algorithm id=event-handler-attributes:the-event-handler-processing-algorithm>the event handler processing algorithm</a>, given
  <var>H</var> and its argument. The <code id=event-handler-attributes:dom-eventlistener-2><a data-x-internal=dom-eventlistener href=https://dom.spec.whatwg.org/#callbackdef-eventlistener>EventListener</a></code>'s
  <a id=event-handler-attributes:callback-context href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a> can be arbitrary; it does not impact the steps of <a href=#the-event-handler-processing-algorithm id=event-handler-attributes:the-event-handler-processing-algorithm-2>the event
  handler processing algorithm</a>. <a href=references.html#refsDOM>[DOM]</a></p>

  <p class=note>The <b>callback</b> is emphatically <em>not</em> the <a href=#event-handlers id=event-handler-attributes:event-handlers-13>event handler</a> itself. Every event handler ends up registering the same
  <b>callback</b>, the algorithm defined below, which takes care of invoking the right callback, and
  processing the callback's return value.</p>

  <p class=note>This only happens the first time the <a href=#event-handlers id=event-handler-attributes:event-handlers-14>event
  handler</a>'s value is set. Since listeners are called in the order they were registered, the
  order of event listeners for a particular event type will always be first the event listeners
  registered with <code id=event-handler-attributes:dom-eventtarget-addeventlistener><a data-x-internal=dom-eventtarget-addeventlistener href=https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener>addEventListener()</a></code> before
  the first time the <a href=#event-handlers id=event-handler-attributes:event-handlers-15>event handler</a> was set to a non-null value,
  then the callback to which it is currently set, if any, and finally the event listeners registered
  with <code id=event-handler-attributes:dom-eventtarget-addeventlistener-2><a data-x-internal=dom-eventtarget-addeventlistener href=https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener>addEventListener()</a></code> <em>after</em> the
  first time the <a href=#event-handlers id=event-handler-attributes:event-handlers-16>event handler</a> was set to a non-null value.</p>

  

  <div class=example>

   <p>この例は、イベントリスナーが呼び出される順序を示す。この例でボタンがユーザーによってクリックされる場合、ページはそれぞれテキスト"ONE"、"TWO"、"THREE"、"FOUR"をもつ4つの警告を表示する。</p>

   <pre>&lt;button id="test"&gt;Start Demo&lt;/button&gt;
&lt;script&gt;
 var button = document.getElementById('test');
 button.addEventListener('click', function () { alert('ONE') }, false);
 button.setAttribute('onclick', "alert('NOT CALLED')"); // event handler listener is registered here
 button.addEventListener('click', function () { alert('THREE') }, false);
 button.onclick = function () { alert('TWO'); };
 button.addEventListener('click', function () { alert('FOUR') }, false);
&lt;/script&gt;</pre>

  </div>

  

  <p class=note>The interfaces implemented by the event object do not influence whether an <a href=#event-handlers id=event-handler-attributes:event-handlers-17>event handler</a> is triggered or not.</p>

  <p><dfn id=the-event-handler-processing-algorithm>The event handler processing algorithm</dfn> for an <a href=#event-handlers id=event-handler-attributes:event-handlers-18>event
  handler</a> <var>H</var> and an <code id=event-handler-attributes:event><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code> object <var>E</var> is as
  follows:</p>

  <ol><li>

    <p>Let <var>callback</var> be the result of <a href=#getting-the-current-value-of-the-event-handler id=event-handler-attributes:getting-the-current-value-of-the-event-handler-2>getting the current value of the
    event handler</a> <var>H</var>.</p>

   </li><li><p>If <var>callback</var> is null, then return.</li><li><p>Let <var>special error event handling</var> be true if <var>E</var> is an
   <code id=event-handler-attributes:errorevent><a href=#errorevent>ErrorEvent</a></code> object, <var>E</var>'s <code id=event-handler-attributes:dom-event-type><a data-x-internal=dom-event-type href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-type>type</a></code> is <code id=event-handler-attributes:event-error><a href=indices.html#event-error>error</a></code>, and <var>E</var>'s <code id=event-handler-attributes:dom-event-currenttarget><a data-x-internal=dom-event-currenttarget href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget>currentTarget</a></code> implements the
   <code id=event-handler-attributes:windoworworkerglobalscope><a href=#windoworworkerglobalscope>WindowOrWorkerGlobalScope</a></code> mixin. Otherwise, let <var>special error event
   handling</var> be false.</li><li>

    <p>Process the <code id=event-handler-attributes:event-2><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code> object <var>E</var> as follows:</p>

    <dl class=switch><dt>If <var>special error event handling</var> is true<dd>

      <p><a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=event-handler-attributes:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>callback</var> with five
      arguments, the first one having the value of <var>E</var>'s <code id=event-handler-attributes:dom-errorevent-message><a href=#dom-errorevent-message>message</a></code> attribute, the second having the value of
      <var>E</var>'s <code id=event-handler-attributes:dom-errorevent-filename><a href=#dom-errorevent-filename>filename</a></code> attribute, the third
      having the value of <var>E</var>'s <code id=event-handler-attributes:dom-errorevent-lineno><a href=#dom-errorevent-lineno>lineno</a></code>
      attribute, the fourth having the value of <var>E</var>'s <code id=event-handler-attributes:dom-errorevent-colno><a href=#dom-errorevent-colno>colno</a></code> attribute, the fifth having the value of
      <var>E</var>'s <code id=event-handler-attributes:dom-errorevent-error><a href=#dom-errorevent-error>error</a></code> attribute, and with the <i id=event-handler-attributes:dfn-callback-this-value><a data-x-internal=dfn-callback-this-value href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value>callback this value</a></i> set to <var>E</var>'s <code id=event-handler-attributes:dom-event-currenttarget-2><a data-x-internal=dom-event-currenttarget href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget>currentTarget</a></code>. Let <var>return value</var> be the
      callback's return value. <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>

     <dt>そうでなければ<dd>

      <p><a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=event-handler-attributes:es-invoking-callback-functions-2 data-x-internal=es-invoking-callback-functions>Invoke</a> <var>callback</var>
      with one argument, the value of which is the <code id=event-handler-attributes:event-3><a data-x-internal=event href=https://triple-underscore.github.io/DOM4-ja.html#interface-event>Event</a></code> object <var>E</var>,
      with the <i id=event-handler-attributes:dfn-callback-this-value-2><a data-x-internal=dfn-callback-this-value href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value>callback this value</a></i> set to <var>E</var>'s <code id=event-handler-attributes:dom-event-currenttarget-3><a data-x-internal=dom-event-currenttarget href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget>currentTarget</a></code>. Let <var>return value</var> be the callback's return value. <a href=references.html#refsWEBIDL>[WEBIDL]</a></p>

     </dl>

    <p>If an exception gets thrown by the callback, end these steps and allow the exception to
    propagate. (It will propagate to the <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=event-handler-attributes:concept-event-dispatch data-x-internal=concept-event-dispatch>DOM event dispatch
    logic</a>, which will then <a href=#report-the-exception id=event-handler-attributes:report-the-exception>report the exception</a>.)</p>

   </li><li>

    <p>Process <var>return value</var> as follows:</p>

    <dl class=switch><dt>If <var>E</var> is a <code id=event-handler-attributes:beforeunloadevent><a href=browsing-the-web.html#beforeunloadevent>BeforeUnloadEvent</a></code> object and <var>E</var>'s <code id=event-handler-attributes:dom-event-type-2><a data-x-internal=dom-event-type href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-type>type</a></code> is <code id=event-handler-attributes:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code><dd>
      <p class=note>In this case, the <a href=#event-handler-idl-attributes id=event-handler-attributes:event-handler-idl-attributes-5>event handler
      IDL attribute</a>'s type will be <code id=event-handler-attributes:onbeforeunloadeventhandler><a href=#onbeforeunloadeventhandler>OnBeforeUnloadEventHandler</a></code>, so <var>return
      value</var> will have been coerced into either null or a <code id=event-handler-attributes:idl-domstring><a data-x-internal=idl-domstring href=https://triple-underscore.github.io/WebIDL-ja.html#idl-DOMString>DOMString</a></code>.</p>

      <p>If <var>return value</var> is not null, then:</p>

      <ol><li><p>Set <var>E</var>'s <a id=event-handler-attributes:canceled-flag href=https://dom.spec.whatwg.org/#canceled-flag data-x-internal=canceled-flag>canceled flag</a>.</li><li><p>If <var>E</var>'s <code id=event-handler-attributes:dom-beforeunloadevent-returnvalue><a href=browsing-the-web.html#dom-beforeunloadevent-returnvalue>returnValue</a></code>
       attribute's value is the empty string, then set <var>E</var>'s <code id=event-handler-attributes:dom-beforeunloadevent-returnvalue-2><a href=browsing-the-web.html#dom-beforeunloadevent-returnvalue>returnValue</a></code> attribute's value to
       <var>return value</var>.</li></ol>
     <dt>If <var>special error event handling</var> is true<dd><p>If <var>return value</var> is true, then set <var>E</var>'s <a id=event-handler-attributes:canceled-flag-2 href=https://dom.spec.whatwg.org/#canceled-flag data-x-internal=canceled-flag>canceled
     flag</a>.<dt>そうでなければ<dd>
      <p>If <var>return value</var> is false, then set <var>E</var>'s <a id=event-handler-attributes:canceled-flag-3 href=https://dom.spec.whatwg.org/#canceled-flag data-x-internal=canceled-flag>canceled
      flag</a>.</p>

      <p class=note>If we've gotten to this "Otherwise" clause because <var>E</var>'s <code id=event-handler-attributes:dom-event-type-3><a data-x-internal=dom-event-type href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-type>type</a></code> is <code id=event-handler-attributes:event-beforeunload-2><a href=indices.html#event-beforeunload>beforeunload</a></code> but <var>E</var> is <em>not</em> a
      <code id=event-handler-attributes:beforeunloadevent-2><a href=browsing-the-web.html#beforeunloadevent>BeforeUnloadEvent</a></code> object, then <var>return value</var> will never be false, since
      in such cases <var>return value</var> will have been coerced into either null or a <code id=event-handler-attributes:idl-domstring-2><a data-x-internal=idl-domstring href=https://triple-underscore.github.io/WebIDL-ja.html#idl-DOMString>DOMString</a></code>.</p>
     </dl>

   </li></ol>

  

  <hr>

  <p><code id=event-handler-attributes:eventhandler-2><a href=#eventhandler>EventHandler</a></code>コールバック関数型は、イベントハンドラーに対して使用されるコールバックを表す。これは以下のようにWeb IDLで表される：</p>

  <pre class=idl>[TreatNonObjectAsNull]
callback <dfn id=eventhandlernonnull>EventHandlerNonNull</dfn> = any (<a id=event-handler-attributes:event-4 href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> event);
typedef <a href=#eventhandlernonnull id=event-handler-attributes:eventhandlernonnull>EventHandlerNonNull</a>? <dfn id=eventhandler>EventHandler</dfn>;</pre>

  <p class=note>In JavaScript, any <code id=event-handler-attributes:idl-function><a data-x-internal=idl-function href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function>Function</a></code> object implements
  this interface.</p>

  <div class=example>

   <p>たとえば、次の文書断片で：</p>

   <pre>&lt;body onload="alert(this)" onclick="alert(this)"&gt;</pre>

   <p>文書がロードされるときに"<code>[object&nbsp;Window]</code>"という警告を、ページでユーザーが何かをクリックするときはいつでも"<code>[object&nbsp;HTMLBodyElement]</code>"という警告を流す。</p>

  </div>

  <div class=note>
   <p>The return value of the function affects whether the event is canceled or not: as described above, if the return value is false, the event is canceled.</p>

   <p>There are two exceptions in the platform, for historical reasons:</p>

   <ul><li><p>The <code id=event-handler-attributes:handler-onerror><a href=#handler-onerror>onerror</a></code> handlers on global objects, where
    returning <em>true</em> cancels the event</li><li><p>The <code id=event-handler-attributes:handler-window-onbeforeunload><a href=#handler-window-onbeforeunload>onbeforeunload</a></code> handler, where
    returning any non-null and non-undefined value will cancel the event.</li></ul>
  </div>

  <p>歴史的な理由により、<code id=event-handler-attributes:handler-onerror-2><a href=#handler-onerror>onerror</a></code>ハンドラーは、異なる引数を持つ。</p>

  <pre class=idl>[TreatNonObjectAsNull]
callback <dfn id=onerroreventhandlernonnull>OnErrorEventHandlerNonNull</dfn> = any ((<a id=event-handler-attributes:event-5 href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> or DOMString) event, optional DOMString source, optional unsigned long lineno, optional unsigned long colno, optional any error);
typedef <a href=#onerroreventhandlernonnull id=event-handler-attributes:onerroreventhandlernonnull>OnErrorEventHandlerNonNull</a>? <dfn id=onerroreventhandler>OnErrorEventHandler</dfn>;</pre>

  <div class=example>
   <pre>window.onerror = (message, source, lineno, colno, error) =&gt; { … };</pre>
  </div>

  <p>同様に、<code id=event-handler-attributes:handler-window-onbeforeunload-2><a href=#handler-window-onbeforeunload>onbeforeunload</a></code>ハンドラーは異なる戻り値を持つ：</p>

  <pre class=idl>[TreatNonObjectAsNull]
callback <dfn id=onbeforeunloadeventhandlernonnull>OnBeforeUnloadEventHandlerNonNull</dfn> = DOMString? (<a id=event-handler-attributes:event-6 href=https://triple-underscore.github.io/DOM4-ja.html#interface-event data-x-internal=event>Event</a> event);
typedef <a href=#onbeforeunloadeventhandlernonnull id=event-handler-attributes:onbeforeunloadeventhandlernonnull>OnBeforeUnloadEventHandlerNonNull</a>? <dfn id=onbeforeunloadeventhandler>OnBeforeUnloadEventHandler</dfn>;</pre>

  

  

  <hr>

  <p>An <dfn id=internal-raw-uncompiled-handler>internal raw uncompiled handler</dfn> is a tuple with the following information:</p>

  <ul class=brief><li>An uncompiled script body

   

   </li><li>A location where the script body originated, in case an error needs to be reported

  

  </li></ul>

  <p>When the user agent is to <dfn id=getting-the-current-value-of-the-event-handler>get the
  current value of the event handler</dfn> <var>H</var>, it must run these steps:</p>

  <ol><li>

    <p>If <var>H</var>'s value is an <a href=#internal-raw-uncompiled-handler id=event-handler-attributes:internal-raw-uncompiled-handler-3>internal raw uncompiled handler</a>, run these
    substeps:</p>

    <ol><li>

      <p>If <var>H</var> is an element's <a href=#event-handlers id=event-handler-attributes:event-handlers-19>event
      handler</a>, then let <var>element</var> be the element, and <var>document</var> be the element's <a id=event-handler-attributes:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>.</p>

      <p>Otherwise, <var>H</var> is a <code id=event-handler-attributes:window-3><a href=window-object.html#window>Window</a></code> object's <a href=#event-handlers id=event-handler-attributes:event-handlers-20>event handler</a>:
      let <var>element</var> be null, and let <var>document</var> be <var>H</var>'s <a href=window-object.html#concept-document-window id=event-handler-attributes:concept-document-window>associated <code>Document</code></a>.</p>

     </li><li><p>If <a href=#concept-n-noscript id=event-handler-attributes:concept-n-noscript>scripting is disabled</a> for
     <var>document</var>, then return null.</li><li><p>Let <var>body</var> be the uncompiled script body in the <a href=#internal-raw-uncompiled-handler id=event-handler-attributes:internal-raw-uncompiled-handler-4>internal raw
     uncompiled handler</a>.</li><li><p>Let <var>location</var> be the location where the script body originated, as
     given by the <a href=#internal-raw-uncompiled-handler id=event-handler-attributes:internal-raw-uncompiled-handler-5>internal raw uncompiled handler</a>.</li><li><p>If <var>element</var> is not null and <var>element</var> has a
     <a id=event-handler-attributes:form-owner href=form-control-infrastructure.html#form-owner>form owner</a>, let <var>form owner</var> be that <a id=event-handler-attributes:form-owner-2 href=form-control-infrastructure.html#form-owner>form owner</a>.
     Otherwise, let <var>form owner</var> be null.</li><li><p>Let <var>settings object</var> be the <a href=#relevant-settings-object id=event-handler-attributes:relevant-settings-object>relevant settings object</a> of
     <var>document</var>.</li><li>

      <p>If <var>body</var> is not parsable as <i id=event-handler-attributes:js-prod-functionbody-2><a data-x-internal=js-prod-functionbody href=https://tc39.github.io/ecma262/#prod-FunctionBody>FunctionBody</a></i>
      or if parsing detects an <a id=event-handler-attributes:early-error href=https://tc39.github.io/ecma262/#early-error-rule data-x-internal=early-error>early error</a>, then follow these substeps:</p>

      <ol><li><p>Set <var>H</var>'s value to null.</li><li><p><a href=#report-the-error id=event-handler-attributes:report-the-error>Report the error</a> for the appropriate <a href=#concept-script id=event-handler-attributes:concept-script>script</a> and with the appropriate position (line number and
       column number) given by <var>location</var>, using <var>settings object</var>'s <a href=#concept-settings-object-global id=event-handler-attributes:concept-settings-object-global>global object</a>. If the error is still <i id=event-handler-attributes:concept-error-nothandled><a href=#concept-error-nothandled>not handled</a></i> after this, then the error may be reported
       to a developer console.</li><li><p>Return null.</li></ol>

     </li><li>

      <p>If <var>body</var> begins with a <a id=event-handler-attributes:directive-prologue href=https://tc39.github.io/ecma262/#directive-prologue data-x-internal=directive-prologue>Directive Prologue</a> that contains a <a id=event-handler-attributes:use-strict-directive href=https://tc39.github.io/ecma262/#use-strict-directive data-x-internal=use-strict-directive>Use
      Strict Directive</a> then let <var>strict</var> be true, otherwise let <var>strict</var>
      be false.</p> 

     </li><li>
      <p>Push <var>settings object</var>'s <a href=#realm-execution-context id=event-handler-attributes:realm-execution-context>realm execution context</a> onto the
      <a id=event-handler-attributes:javascript-execution-context-stack href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>; it is now the <a id=event-handler-attributes:running-javascript-execution-context href=https://tc39.github.io/ecma262/#running-execution-context data-x-internal=running-javascript-execution-context>running JavaScript
      execution context</a>.</p>

      <p class=note>This is necessary so the subsequent invocation of <a href=https://tc39.github.io/ecma262/#sec-functioncreate id=event-handler-attributes:js-functioncreate data-x-internal=js-functioncreate>FunctionCreate</a> takes place in the correct <a id=event-handler-attributes:javascript-realm href=https://tc39.github.io/ecma262/#sec-code-realms data-x-internal=javascript-realm>JavaScript
      Realm</a>.</p>
     </li><li>

      <p>Let <var>function</var> be the result of calling <a href=https://tc39.github.io/ecma262/#sec-functioncreate id=event-handler-attributes:js-functioncreate-2 data-x-internal=js-functioncreate>FunctionCreate</a>, with arguments:</p>

      <dl><dt><var>kind</var><dd>Normal<dt><var>ParameterList</var><dd>

        <dl class=switch><dt>If <var>H</var> is an <code id=event-handler-attributes:handler-onerror-3><a href=#handler-onerror>onerror</a></code> <a href=#event-handlers id=event-handler-attributes:event-handlers-21>event handler</a> of a <code id=event-handler-attributes:window-4><a href=window-object.html#window>Window</a></code> object<dd>Let the function have five arguments, named <code>event</code>, <code>source</code>, <code>lineno</code>, <code>colno</code>, and
         <code>error</code>.<dt>そうでなければ<dd>Let the function have a single argument called <code>event</code>.</dl>

       <dt><var>Body</var><dd>The result of parsing <var>body</var> above.<dt><var> 範囲</var><dd>

        <ol><li>

          <p>If <var>H</var> is an element's <a href=#event-handlers id=event-handler-attributes:event-handlers-22>event
          handler</a>, then let <var>Scope</var> be <a href=https://tc39.github.io/ecma262/#sec-newobjectenvironment id=event-handler-attributes:js-newobjectenvironment data-x-internal=js-newobjectenvironment>NewObjectEnvironment</a>(<var>document</var>,
          the <var>global environment</var>).</p>

          <p>Otherwise, <var>H</var> is a <code id=event-handler-attributes:window-5><a href=window-object.html#window>Window</a></code> object's <a href=#event-handlers id=event-handler-attributes:event-handlers-23>event handler</a>: let <var>Scope</var> be the <var>global environment</var>.</p>

         </li><li><p>If <var>form owner</var> is not null, let <var>Scope</var> be
         <a href=https://tc39.github.io/ecma262/#sec-newobjectenvironment id=event-handler-attributes:js-newobjectenvironment-2 data-x-internal=js-newobjectenvironment>NewObjectEnvironment</a>(<var>form owner</var>,
         <var>Scope</var>).</li><li><p>If <var>element</var> is not null, let <var>Scope</var> be <a href=https://tc39.github.io/ecma262/#sec-newobjectenvironment id=event-handler-attributes:js-newobjectenvironment-3 data-x-internal=js-newobjectenvironment>NewObjectEnvironment</a>(<var>element</var>,
         <var>Scope</var>).</li></ol>

       <dt><var>Strict</var><dd>The value of <var>strict</var>.</dl>

     </li><li><p>Remove <var>settings object</var>'s <a href=#realm-execution-context id=event-handler-attributes:realm-execution-context-2>realm execution context</a> from the
     <a id=event-handler-attributes:javascript-execution-context-stack-2 href=https://tc39.github.io/ecma262/#execution-context-stack data-x-internal=javascript-execution-context-stack>JavaScript execution context stack</a>.</li><li><p>Set <var>H</var>'s value to the result of creating a Web IDL callback function whose
     object reference is <var>function</var> and whose <a id=event-handler-attributes:callback-context-2 href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context data-x-internal=callback-context>callback context</a> is
     <var>settings object</var>.</li></ol>

   </li><li><p>Return <var>H</var>'s value.</li></ol>

  



  <h5 id=event-handlers-on-elements,-document-objects,-and-window-objects><span class=secno>8.1.5.2</span> Event handlers on elements, <code id=event-handlers-on-elements,-document-objects,-and-window-objects:document><a href=dom.html#document>Document</a></code> objects, and <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window><a href=window-object.html#window>Window</a></code> objects<a href=#event-handlers-on-elements,-document-objects,-and-window-objects class=self-link></a></h5>

  <p>The following are the <a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type>event handler event types</a>) that must be
  supported by all <a id=event-handlers-on-elements,-document-objects,-and-window-objects:html-elements href=infrastructure.html#html-elements>HTML elements</a>, as both <a href=#event-handler-content-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes>event handler content attributes</a>
  and <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes>event handler IDL attributes</a>; and that must be
  supported by all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:document-2><a href=dom.html#document>Document</a></code> and <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-2><a href=window-object.html#window>Window</a></code> objects, as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-2>event handler IDL
  attributes</a>:</p>

  <table><thead><tr><th><a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-2>イベントハンドラー</a> </th><th><a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-2>イベントハンドラーイベント型</a>
   <tbody></th></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onabort data-dfn-type=attribute data-export=""><code>onabort</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-abort><a href=indices.html#event-abort>abort</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onauxclick data-dfn-type=attribute data-export=""><code>onauxclick</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-auxclick><a data-x-internal=event-auxclick href=https://w3c.github.io/uievents/#event-type-auxclick>auxclick</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oncancel data-dfn-type=attribute data-export=""><code>oncancel</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-cancel><a href=indices.html#event-cancel>cancel</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oncanplay data-dfn-type=attribute data-export=""><code>oncanplay</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-canplay><a href=media.html#event-media-canplay>canplay</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oncanplaythrough data-dfn-type=attribute data-export=""><code>oncanplaythrough</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-canplaythrough><a href=media.html#event-media-canplaythrough>canplaythrough</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onchange data-dfn-type=attribute data-export=""><code>onchange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-change><a href=indices.html#event-change>change</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onclick data-dfn-type=attribute data-export=""><code>onclick</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onclose data-dfn-type=attribute data-export=""><code>onclose</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-close><a href=indices.html#event-close>close</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oncontextmenu data-dfn-type=attribute data-export=""><code>oncontextmenu</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-contextmenu><a href=indices.html#event-contextmenu>contextmenu</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oncuechange data-dfn-type=attribute data-export=""><code>oncuechange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-cuechange><a href=media.html#event-media-cuechange>cuechange</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondblclick data-dfn-type=attribute data-export=""><code>ondblclick</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dblclick><a data-x-internal=event-dblclick href=https://w3c.github.io/uievents/#event-type-dblclick>dblclick</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondrag data-dfn-type=attribute data-export=""><code>ondrag</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-drag><a href=dnd.html#event-dnd-drag>drag</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragend data-dfn-type=attribute data-export=""><code>ondragend</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragend><a href=dnd.html#event-dnd-dragend>dragend</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragenter data-dfn-type=attribute data-export=""><code>ondragenter</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragenter><a href=dnd.html#event-dnd-dragenter>dragenter</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragexit data-dfn-type=attribute data-export=""><code>ondragexit</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragexit><a href=dnd.html#event-dnd-dragexit>dragexit</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragleave data-dfn-type=attribute data-export=""><code>ondragleave</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragleave><a href=dnd.html#event-dnd-dragleave>dragleave</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragover data-dfn-type=attribute data-export=""><code>ondragover</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragover><a href=dnd.html#event-dnd-dragover>dragover</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondragstart data-dfn-type=attribute data-export=""><code>ondragstart</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragstart><a href=dnd.html#event-dnd-dragstart>dragstart</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondrop data-dfn-type=attribute data-export=""><code>ondrop</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-drop><a href=dnd.html#event-dnd-drop>drop</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ondurationchange data-dfn-type=attribute data-export=""><code>ondurationchange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-durationchange><a href=media.html#event-media-durationchange>durationchange</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onemptied data-dfn-type=attribute data-export=""><code>onemptied</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-emptied><a href=media.html#event-media-emptied>emptied</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onended data-dfn-type=attribute data-export=""><code>onended</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-ended><a href=media.html#event-media-ended>ended</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oninput data-dfn-type=attribute data-export=""><code>oninput</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-input><a href=indices.html#event-input>input</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-oninvalid data-dfn-type=attribute data-export=""><code>oninvalid</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-invalid><a href=indices.html#event-invalid>invalid</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onkeydown data-dfn-type=attribute data-export=""><code>onkeydown</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onkeypress data-dfn-type=attribute data-export=""><code>onkeypress</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-keypress><a data-x-internal=event-keypress href=https://w3c.github.io/uievents/#event-type-keypress>keypress</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onkeyup data-dfn-type=attribute data-export=""><code>onkeyup</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-keyup><a data-x-internal=event-keyup href=https://w3c.github.io/uievents/#event-type-keyup>keyup</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onloadeddata data-dfn-type=attribute data-export=""><code>onloadeddata</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadeddata><a href=media.html#event-media-loadeddata>loadeddata</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onloadedmetadata data-dfn-type=attribute data-export=""><code>onloadedmetadata</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadedmetadata><a href=media.html#event-media-loadedmetadata>loadedmetadata</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onloadend data-dfn-type=attribute data-export=""><code>onloadend</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-loadend><a href=indices.html#event-loadend>loadend</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onloadstart data-dfn-type=attribute data-export=""><code>onloadstart</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadstart><a href=media.html#event-media-loadstart>loadstart</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmousedown data-dfn-type=attribute data-export=""><code>onmousedown</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mousedown><a data-x-internal=event-mousedown href=https://w3c.github.io/uievents/#event-type-mousedown>mousedown</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmouseenter data-dfn-type=attribute data-export=""><code>onmouseenter</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseenter><a data-x-internal=event-mouseenter href=https://w3c.github.io/uievents/#event-type-mouseenter>mouseenter</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmouseleave data-dfn-type=attribute data-export=""><code>onmouseleave</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseleave><a data-x-internal=event-mouseleave href=https://w3c.github.io/uievents/#event-type-mouseleave>mouseleave</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmousemove data-dfn-type=attribute data-export=""><code>onmousemove</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mousemove><a data-x-internal=event-mousemove href=https://w3c.github.io/uievents/#event-type-mousemove>mousemove</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmouseout data-dfn-type=attribute data-export=""><code>onmouseout</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseout><a data-x-internal=event-mouseout href=https://w3c.github.io/uievents/#event-type-mouseout>mouseout</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmouseover data-dfn-type=attribute data-export=""><code>onmouseover</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseover><a data-x-internal=event-mouseover href=https://w3c.github.io/uievents/#event-type-mouseover>mouseover</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onmouseup data-dfn-type=attribute data-export=""><code>onmouseup</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseup><a data-x-internal=event-mouseup href=https://w3c.github.io/uievents/#event-type-mouseup>mouseup</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onwheel data-dfn-type=attribute data-export=""><code>onwheel</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-wheel><a data-x-internal=event-wheel href=https://w3c.github.io/uievents/#event-type-wheel>wheel</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onpause data-dfn-type=attribute data-export=""><code>onpause</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-pause><a href=media.html#event-media-pause>pause</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onplay data-dfn-type=attribute data-export=""><code>onplay</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-play><a href=media.html#event-media-play>play</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onplaying data-dfn-type=attribute data-export=""><code>onplaying</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-playing><a href=media.html#event-media-playing>playing</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onprogress data-dfn-type=attribute data-export=""><code>onprogress</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-progress><a href=media.html#event-media-progress>progress</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onratechange data-dfn-type=attribute data-export=""><code>onratechange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-ratechange><a href=media.html#event-media-ratechange>ratechange</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onreset data-dfn-type=attribute data-export=""><code>onreset</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-reset><a href=indices.html#event-reset>reset</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onsecuritypolicyviolation data-dfn-type=attribute data-export=""><code>onsecuritypolicyviolation</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-securitypolicyviolation><a href=indices.html#event-securitypolicyviolation>securitypolicyviolation</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onseeked data-dfn-type=attribute data-export=""><code>onseeked</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-seeked><a href=media.html#event-media-seeked>seeked</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onseeking data-dfn-type=attribute data-export=""><code>onseeking</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-seeking><a href=media.html#event-media-seeking>seeking</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onselect data-dfn-type=attribute data-export=""><code>onselect</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-select><a href=indices.html#event-select>select</a></code>  
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onstalled data-dfn-type=attribute data-export=""><code>onstalled</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-stalled><a href=media.html#event-media-stalled>stalled</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onsubmit data-dfn-type=attribute data-export=""><code>onsubmit</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-submit><a href=indices.html#event-submit>submit</a></code> 
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onsuspend data-dfn-type=attribute data-export=""><code>onsuspend</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-suspend><a href=media.html#event-media-suspend>suspend</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ontimeupdate data-dfn-type=attribute data-export=""><code>ontimeupdate</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-timeupdate><a href=media.html#event-media-timeupdate>timeupdate</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-ontoggle data-dfn-type=attribute data-export=""><code>ontoggle</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-toggle><a href=indices.html#event-toggle>toggle</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onvolumechange data-dfn-type=attribute data-export=""><code>onvolumechange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-volumechange><a href=media.html#event-media-volumechange>volumechange</a></code>
    </td></tr><tr><td><dfn data-dfn-for=HTMLElement,Document,Window,GlobalEventHandlers id=handler-onwaiting data-dfn-type=attribute data-export=""><code>onwaiting</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-media-waiting><a href=media.html#event-media-waiting>waiting</a></code>


 
 
 

 
  </td></tr></table>

  <hr>

  <p>The following are the <a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-3>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-3>event handler event types</a>) that must be
  supported by all <a id=event-handlers-on-elements,-document-objects,-and-window-objects:html-elements-2 href=infrastructure.html#html-elements>HTML elements</a> other than <code id=event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element><a href=sections.html#the-body-element>body</a></code> and <code id=event-handlers-on-elements,-document-objects,-and-window-objects:frameset><a href=obsolete.html#frameset>frameset</a></code>
  elements, as both <a href=#event-handler-content-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-2>event handler content attributes</a> and <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-3>event handler IDL
  attributes</a>; that must be supported by all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:document-3><a href=dom.html#document>Document</a></code>
  objects, as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-4>event handler IDL attributes</a>; and that must be
  supported by all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-3><a href=window-object.html#window>Window</a></code> objects, as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-5>event handler IDL attributes</a> on the
  <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-4><a href=window-object.html#window>Window</a></code> objects themselves, and with corresponding <a href=#event-handler-content-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-3>event handler content
  attributes</a> and <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-6>event handler IDL attributes</a> exposed on all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element-2><a href=sections.html#the-body-element>body</a></code>
  and <code id=event-handlers-on-elements,-document-objects,-and-window-objects:frameset-2><a href=obsolete.html#frameset>frameset</a></code> elements that are owned by that <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-5><a href=window-object.html#window>Window</a></code> object's <a href=window-object.html#concept-document-window id=event-handlers-on-elements,-document-objects,-and-window-objects:concept-document-window>associated <code>Document</code></a>:</p>

  <table><thead><tr><th><a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-4>イベントハンドラー</a> </th><th><a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-4>イベントハンドラーイベント型</a>
   <tbody></th></tr><tr><td><dfn id=handler-onblur><code>onblur</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-blur><a href=indices.html#event-blur>blur</a></code> 
    </td></tr><tr><td><dfn id=handler-onerror><code>onerror</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-error><a href=indices.html#event-error>error</a></code>
    </td></tr><tr><td><dfn id=handler-onfocus><code>onfocus</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-focus><a href=indices.html#event-focus>focus</a></code> 
    </td></tr><tr><td><dfn id=handler-onload><code>onload</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-load><a href=indices.html#event-load>load</a></code>
    </td></tr><tr><td><dfn id=handler-onresize><code>onresize</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-resize><a data-x-internal=event-resize href=https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize>resize</a></code>
    </td></tr><tr><td><dfn id=handler-onscroll><code>onscroll</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-scroll><a data-x-internal=event-scroll href=https://triple-underscore.github.io/cssom-view-ja.html#eventdef-document-scroll>scroll</a></code>
  </td></tr></table>

  <hr>

  <p>The following are the <a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-5>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-5>event handler event types</a>) that must be
  supported by <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-6><a href=window-object.html#window>Window</a></code> objects, as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-7>event handler IDL attributes</a> on the
  <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-7><a href=window-object.html#window>Window</a></code> objects themselves, and with corresponding <a href=#event-handler-content-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-4>event handler content
  attributes</a> and <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-8>event handler IDL attributes</a> exposed on all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element-3><a href=sections.html#the-body-element>body</a></code>
  and <code id=event-handlers-on-elements,-document-objects,-and-window-objects:frameset-3><a href=obsolete.html#frameset>frameset</a></code> elements that are owned by that <code id=event-handlers-on-elements,-document-objects,-and-window-objects:window-8><a href=window-object.html#window>Window</a></code> object's <a href=window-object.html#concept-document-window id=event-handlers-on-elements,-document-objects,-and-window-objects:concept-document-window-2>associated <code>Document</code></a>:</p>

  <table><thead><tr><th><a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-6>イベントハンドラー</a> </th><th><a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-6>イベントハンドラーイベント型</a>
   <tbody></th></tr><tr><td><dfn id=handler-window-onafterprint><code>onafterprint</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-afterprint><a href=indices.html#event-afterprint>afterprint</a></code>
    </td></tr><tr><td><dfn id=handler-window-onbeforeprint><code>onbeforeprint</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-beforeprint><a href=indices.html#event-beforeprint>beforeprint</a></code>
    </td></tr><tr><td><dfn id=handler-window-onbeforeunload><code>onbeforeunload</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-beforeunload><a href=indices.html#event-beforeunload>beforeunload</a></code>
    </td></tr><tr><td><dfn id=handler-window-onhashchange><code>onhashchange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-hashchange><a href=indices.html#event-hashchange>hashchange</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onlanguagechange><code>onlanguagechange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-languagechange><a href=indices.html#event-languagechange>languagechange</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onmessage><code>onmessage</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-message><a href=indices.html#event-message>message</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onmessageerror><code>onmessageerror</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-messageerror><a href=indices.html#event-messageerror>messageerror</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onoffline><code>onoffline</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-offline><a href=indices.html#event-offline>offline</a></code> 
    </td></tr><tr><td><dfn id=handler-window-ononline><code>ononline</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-online><a href=indices.html#event-online>online</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onpagehide><code>onpagehide</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-pagehide><a href=indices.html#event-pagehide>pagehide</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onpageshow><code>onpageshow</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-pageshow><a href=indices.html#event-pageshow>pageshow</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onpopstate><code>onpopstate</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-popstate><a href=indices.html#event-popstate>popstate</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onrejectionhandled><code>onrejectionhandled</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-rejectionhandled><a href=indices.html#event-rejectionhandled>rejectionhandled</a></code>
    </td></tr><tr><td><dfn id=handler-window-onstorage><code>onstorage</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-storage><a href=indices.html#event-storage>storage</a></code> 
    </td></tr><tr><td><dfn id=handler-window-onunhandledrejection><code>onunhandledrejection</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-unhandledrejection><a href=indices.html#event-unhandledrejection>unhandledrejection</a></code>
    </td></tr><tr><td><dfn id=handler-window-onunload><code>onunload</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-unload><a href=indices.html#event-unload>unload</a></code> 
  </td></tr></table>

  <hr>

  <p>The following are the <a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-7>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-7>event handler event types</a>) that must be
  supported by all <a id=event-handlers-on-elements,-document-objects,-and-window-objects:html-elements-3 href=infrastructure.html#html-elements>HTML elements</a>, as both <a href=#event-handler-content-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-5>event handler content attributes</a>
  and <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-9>event handler IDL attributes</a>; and that must be
  supported by all <code id=event-handlers-on-elements,-document-objects,-and-window-objects:document-4><a href=dom.html#document>Document</a></code> objects, as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-10>event handler IDL attributes</a>:</p>

  <table><thead><tr><th><a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-8>イベントハンドラー</a> </th><th><a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-8>イベントハンドラーイベント型</a>
   <tbody></th></tr><tr><td><dfn id=handler-oncut><code>oncut</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-cut><a href=indices.html#event-cut>cut</a></code>
    </td></tr><tr><td><dfn id=handler-oncopy><code>oncopy</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-copy><a href=indices.html#event-copy>copy</a></code>
    </td></tr><tr><td><dfn id=handler-onpaste><code>onpaste</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-paste><a href=indices.html#event-paste>paste</a></code>
  </td></tr></table>

  <hr>

  <p>The following are the <a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-9>event handlers</a> (and their corresponding <a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-9>event handler event types</a>) that must be
  supported on <code id=event-handlers-on-elements,-document-objects,-and-window-objects:document-5><a href=dom.html#document>Document</a></code> objects as <a href=#event-handler-idl-attributes id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-11>event handler IDL attributes</a>:</p>

  

  <table><thead><tr><th><a href=#event-handlers id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-10>イベントハンドラー</a> </th><th><a href=#event-handler-event-type id=event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-10>イベントハンドラーイベント型</a>
   <tbody></th></tr><tr><td><dfn data-dfn-for=Document id=handler-onreadystatechange data-dfn-type=attribute data-export=""><code>onreadystatechange</code></dfn> </td><td> <code id=event-handlers-on-elements,-document-objects,-and-window-objects:event-readystatechange><a href=indices.html#event-readystatechange>readystatechange</a></code>
  </td></tr></table>


  

  <h6 id=idl-definitions><span class=secno>8.1.5.2.1</span> IDL定義<a href=#idl-definitions class=self-link></a></h6>

  <pre class=idl>interface mixin <dfn id=globaleventhandlers>GlobalEventHandlers</dfn> {
  attribute <a href=#eventhandler id=idl-definitions:eventhandler>EventHandler</a> <a href=#handler-onabort id=idl-definitions:handler-onabort>onabort</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-2>EventHandler</a> <a href=#handler-onauxclick id=idl-definitions:handler-onauxclick>onauxclick</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-3>EventHandler</a> <a href=#handler-onblur id=idl-definitions:handler-onblur>onblur</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-4>EventHandler</a> <a href=#handler-oncancel id=idl-definitions:handler-oncancel>oncancel</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-5>EventHandler</a> <a href=#handler-oncanplay id=idl-definitions:handler-oncanplay>oncanplay</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-6>EventHandler</a> <a href=#handler-oncanplaythrough id=idl-definitions:handler-oncanplaythrough>oncanplaythrough</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-7>EventHandler</a> <a href=#handler-onchange id=idl-definitions:handler-onchange>onchange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-8>EventHandler</a> <a href=#handler-onclick id=idl-definitions:handler-onclick>onclick</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-9>EventHandler</a> <a href=#handler-onclose id=idl-definitions:handler-onclose>onclose</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-10>EventHandler</a> <a href=#handler-oncontextmenu id=idl-definitions:handler-oncontextmenu>oncontextmenu</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-11>EventHandler</a> <a href=#handler-oncuechange id=idl-definitions:handler-oncuechange>oncuechange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-12>EventHandler</a> <a href=#handler-ondblclick id=idl-definitions:handler-ondblclick>ondblclick</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-13>EventHandler</a> <a href=#handler-ondrag id=idl-definitions:handler-ondrag>ondrag</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-14>EventHandler</a> <a href=#handler-ondragend id=idl-definitions:handler-ondragend>ondragend</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-15>EventHandler</a> <a href=#handler-ondragenter id=idl-definitions:handler-ondragenter>ondragenter</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-16>EventHandler</a> <a href=#handler-ondragexit id=idl-definitions:handler-ondragexit>ondragexit</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-17>EventHandler</a> <a href=#handler-ondragleave id=idl-definitions:handler-ondragleave>ondragleave</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-18>EventHandler</a> <a href=#handler-ondragover id=idl-definitions:handler-ondragover>ondragover</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-19>EventHandler</a> <a href=#handler-ondragstart id=idl-definitions:handler-ondragstart>ondragstart</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-20>EventHandler</a> <a href=#handler-ondrop id=idl-definitions:handler-ondrop>ondrop</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-21>EventHandler</a> <a href=#handler-ondurationchange id=idl-definitions:handler-ondurationchange>ondurationchange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-22>EventHandler</a> <a href=#handler-onemptied id=idl-definitions:handler-onemptied>onemptied</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-23>EventHandler</a> <a href=#handler-onended id=idl-definitions:handler-onended>onended</a>;
  attribute <a href=#onerroreventhandler id=idl-definitions:onerroreventhandler>OnErrorEventHandler</a> <a href=#handler-onerror id=idl-definitions:handler-onerror>onerror</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-24>EventHandler</a> <a href=#handler-onfocus id=idl-definitions:handler-onfocus>onfocus</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-25>EventHandler</a> <a href=#handler-oninput id=idl-definitions:handler-oninput>oninput</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-26>EventHandler</a> <a href=#handler-oninvalid id=idl-definitions:handler-oninvalid>oninvalid</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-27>EventHandler</a> <a href=#handler-onkeydown id=idl-definitions:handler-onkeydown>onkeydown</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-28>EventHandler</a> <a href=#handler-onkeypress id=idl-definitions:handler-onkeypress>onkeypress</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-29>EventHandler</a> <a href=#handler-onkeyup id=idl-definitions:handler-onkeyup>onkeyup</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-30>EventHandler</a> <a href=#handler-onload id=idl-definitions:handler-onload>onload</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-31>EventHandler</a> <a href=#handler-onloadeddata id=idl-definitions:handler-onloadeddata>onloadeddata</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-32>EventHandler</a> <a href=#handler-onloadedmetadata id=idl-definitions:handler-onloadedmetadata>onloadedmetadata</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-33>EventHandler</a> <a href=#handler-onloadend id=idl-definitions:handler-onloadend>onloadend</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-34>EventHandler</a> <a href=#handler-onloadstart id=idl-definitions:handler-onloadstart>onloadstart</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-35>EventHandler</a> <a href=#handler-onmousedown id=idl-definitions:handler-onmousedown>onmousedown</a>;
  [LenientThis] attribute <a href=#eventhandler id=idl-definitions:eventhandler-36>EventHandler</a> <a href=#handler-onmouseenter id=idl-definitions:handler-onmouseenter>onmouseenter</a>;
  [LenientThis] attribute <a href=#eventhandler id=idl-definitions:eventhandler-37>EventHandler</a> <a href=#handler-onmouseleave id=idl-definitions:handler-onmouseleave>onmouseleave</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-38>EventHandler</a> <a href=#handler-onmousemove id=idl-definitions:handler-onmousemove>onmousemove</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-39>EventHandler</a> <a href=#handler-onmouseout id=idl-definitions:handler-onmouseout>onmouseout</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-40>EventHandler</a> <a href=#handler-onmouseover id=idl-definitions:handler-onmouseover>onmouseover</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-41>EventHandler</a> <a href=#handler-onmouseup id=idl-definitions:handler-onmouseup>onmouseup</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-42>EventHandler</a> <a href=#handler-onwheel id=idl-definitions:handler-onwheel>onwheel</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-43>EventHandler</a> <a href=#handler-onpause id=idl-definitions:handler-onpause>onpause</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-44>EventHandler</a> <a href=#handler-onplay id=idl-definitions:handler-onplay>onplay</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-45>EventHandler</a> <a href=#handler-onplaying id=idl-definitions:handler-onplaying>onplaying</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-46>EventHandler</a> <a href=#handler-onprogress id=idl-definitions:handler-onprogress>onprogress</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-47>EventHandler</a> <a href=#handler-onratechange id=idl-definitions:handler-onratechange>onratechange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-48>EventHandler</a> <a href=#handler-onreset id=idl-definitions:handler-onreset>onreset</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-49>EventHandler</a> <a href=#handler-onresize id=idl-definitions:handler-onresize>onresize</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-50>EventHandler</a> <a href=#handler-onscroll id=idl-definitions:handler-onscroll>onscroll</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-51>EventHandler</a> <a href=#handler-onsecuritypolicyviolation id=idl-definitions:handler-onsecuritypolicyviolation>onsecuritypolicyviolation</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-52>EventHandler</a> <a href=#handler-onseeked id=idl-definitions:handler-onseeked>onseeked</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-53>EventHandler</a> <a href=#handler-onseeking id=idl-definitions:handler-onseeking>onseeking</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-54>EventHandler</a> <a href=#handler-onselect id=idl-definitions:handler-onselect>onselect</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-55>EventHandler</a> <a href=#handler-onstalled id=idl-definitions:handler-onstalled>onstalled</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-56>EventHandler</a> <a href=#handler-onsubmit id=idl-definitions:handler-onsubmit>onsubmit</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-57>EventHandler</a> <a href=#handler-onsuspend id=idl-definitions:handler-onsuspend>onsuspend</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-58>EventHandler</a> <a href=#handler-ontimeupdate id=idl-definitions:handler-ontimeupdate>ontimeupdate</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-59>EventHandler</a> <a href=#handler-ontoggle id=idl-definitions:handler-ontoggle>ontoggle</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-60>EventHandler</a> <a href=#handler-onvolumechange id=idl-definitions:handler-onvolumechange>onvolumechange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-61>EventHandler</a> <a href=#handler-onwaiting id=idl-definitions:handler-onwaiting>onwaiting</a>;
};

interface mixin <dfn id=windoweventhandlers>WindowEventHandlers</dfn> {
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-62>EventHandler</a> <a href=#handler-window-onafterprint id=idl-definitions:handler-window-onafterprint>onafterprint</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-63>EventHandler</a> <a href=#handler-window-onbeforeprint id=idl-definitions:handler-window-onbeforeprint>onbeforeprint</a>;
  attribute <a href=#onbeforeunloadeventhandler id=idl-definitions:onbeforeunloadeventhandler>OnBeforeUnloadEventHandler</a> <a href=#handler-window-onbeforeunload id=idl-definitions:handler-window-onbeforeunload>onbeforeunload</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-64>EventHandler</a> <a href=#handler-window-onhashchange id=idl-definitions:handler-window-onhashchange>onhashchange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-65>EventHandler</a> <a href=#handler-window-onlanguagechange id=idl-definitions:handler-window-onlanguagechange>onlanguagechange</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-66>EventHandler</a> <a href=#handler-window-onmessage id=idl-definitions:handler-window-onmessage>onmessage</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-67>EventHandler</a> <a href=#handler-window-onmessageerror id=idl-definitions:handler-window-onmessageerror>onmessageerror</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-68>EventHandler</a> <a href=#handler-window-onoffline id=idl-definitions:handler-window-onoffline>onoffline</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-69>EventHandler</a> <a href=#handler-window-ononline id=idl-definitions:handler-window-ononline>ononline</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-70>EventHandler</a> <a href=#handler-window-onpagehide id=idl-definitions:handler-window-onpagehide>onpagehide</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-71>EventHandler</a> <a href=#handler-window-onpageshow id=idl-definitions:handler-window-onpageshow>onpageshow</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-72>EventHandler</a> <a href=#handler-window-onpopstate id=idl-definitions:handler-window-onpopstate>onpopstate</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-73>EventHandler</a> <a href=#handler-window-onrejectionhandled id=idl-definitions:handler-window-onrejectionhandled>onrejectionhandled</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-74>EventHandler</a> <a href=#handler-window-onstorage id=idl-definitions:handler-window-onstorage>onstorage</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-75>EventHandler</a> <a href=#handler-window-onunhandledrejection id=idl-definitions:handler-window-onunhandledrejection>onunhandledrejection</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-76>EventHandler</a> <a href=#handler-window-onunload id=idl-definitions:handler-window-onunload>onunload</a>;
};

interface mixin <dfn id=documentandelementeventhandlers>DocumentAndElementEventHandlers</dfn> {
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-77>EventHandler</a> <a href=#handler-oncopy id=idl-definitions:handler-oncopy>oncopy</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-78>EventHandler</a> <a href=#handler-oncut id=idl-definitions:handler-oncut>oncut</a>;
  attribute <a href=#eventhandler id=idl-definitions:eventhandler-79>EventHandler</a> <a href=#handler-onpaste id=idl-definitions:handler-onpaste>onpaste</a>;
};</pre>

  <h5 id=event-firing><span class=secno>8.1.5.3</span> Event firing<a href=#event-firing class=self-link></a></h5>

  <p>Certain operations and methods are defined as firing events on elements. For example, the <code id=event-firing:dom-click><a href=interaction.html#dom-click>click()</a></code> method on the <code id=event-firing:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code> interface is defined as
  firing a <code id=event-firing:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> event on the element. <a href=references.html#refsUIEVENTS>[UIEVENTS]</a></p>

  <p><dfn id=fire-a-synthetic-mouse-event>Firing a synthetic mouse event named
  <var>e</var></dfn> at <var>target</var>, with an optional <var>not trusted flag</var>, means
  running these steps:</p>

  <ol><li><p>Let <var>event</var> be the result of <a id=event-firing:creating-an-event href=https://dom.spec.whatwg.org/#concept-event-create data-x-internal=creating-an-event>creating an event</a> using
   <code id=event-firing:mouseevent><a data-x-internal=mouseevent href=https://w3c.github.io/uievents/#mouseevent>MouseEvent</a></code>.</li><li><p>Initialize <var>event</var>'s <code id=event-firing:dom-event-type><a data-x-internal=dom-event-type href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-type>type</a></code> attribute to
   <var>e</var>.</li><li><p>Initialize <var>event</var>'s <code id=event-firing:dom-event-bubbles><a data-x-internal=dom-event-bubbles href=https://dom.spec.whatwg.org/#dom-event-bubbles>bubbles</a></code> and <code id=event-firing:dom-event-cancelable><a data-x-internal=dom-event-cancelable href=https://dom.spec.whatwg.org/#dom-event-cancelable>cancelable</a></code> attributes to true.</li><li><p>Set <var>event</var>'s <a id=event-firing:composed-flag href=https://dom.spec.whatwg.org/#composed-flag data-x-internal=composed-flag>composed flag</a>.</li><li><p>If the <var>not trusted flag</var> is set, initialize <var>event</var>'s <code id=event-firing:dom-event-istrusted><a data-x-internal=dom-event-istrusted href=https://triple-underscore.github.io/DOM4-ja.html#dom-event-istrusted>isTrusted</a></code> attribute to false.</li><li><p>Initialize <var>event</var>'s <code>ctrlKey</code>, <code>shiftKey</code>, <code>altKey</code>, and <code>metaKey</code>
   attributes according to the current state of the key input device, if any (false for any keys
   that are not available).</li><li><p>Initialize <var>event</var>'s <code id=event-firing:dom-uievent-view><a data-x-internal=dom-uievent-view href=https://w3c.github.io/uievents/#dom-uievent-view>view</a></code> attribute to
   <var>target</var>'s <a id=event-firing:node-document href=https://triple-underscore.github.io/DOM4-ja.html#concept-node-document data-x-internal=node-document>node document</a>'s <code id=event-firing:window><a href=window-object.html#window>Window</a></code> object, if any, and null
   otherwise.</li><li><p><var>event</var>'s <code>getModifierState()</code> method is to return values
   appropriately describing the current state of the key input device.</li><li><p>Return the result of <a href=https://dom.spec.whatwg.org/#concept-event-dispatch id=event-firing:concept-event-dispatch data-x-internal=concept-event-dispatch>dispatching</a>
   <var>event</var> at <var>target</var>.</li></ol>

  <p><dfn id=fire-a-click-event>Firing a <code>click</code> event</dfn>
  at <var>target</var> means <a href=#fire-a-synthetic-mouse-event id=event-firing:fire-a-synthetic-mouse-event>firing a synthetic mouse
  event named <code>click</code></a> at <var>target</var>.</p>

  


  <h3 id=windoworworkerglobalscope-mixin><span class=secno>8.2</span> The <code id=windoworworkerglobalscope-mixin:windoworworkerglobalscope><a href=#windoworworkerglobalscope>WindowOrWorkerGlobalScope</a></code> mixin<a href=#windoworworkerglobalscope-mixin class=self-link></a></h3>

  <p>The <code id=windoworworkerglobalscope-mixin:windoworworkerglobalscope-2><a href=#windoworworkerglobalscope>WindowOrWorkerGlobalScope</a></code> mixin is for use of APIs that are to be exposed on
  <code id=windoworworkerglobalscope-mixin:window><a href=window-object.html#window>Window</a></code> and <code id=windoworworkerglobalscope-mixin:workerglobalscope><a href=workers.html#workerglobalscope>WorkerGlobalScope</a></code> objects.</p>

  <p class=note>Other standards are encouraged to further extend it using <code>partial
  interface <a href=#windoworworkerglobalscope id=windoworworkerglobalscope-mixin:windoworworkerglobalscope-3>WindowOrWorkerGlobalScope</a> { … };</code> along with an appropriate
  reference.</p>

  <pre class=idl>typedef (DOMString or <a href=https://triple-underscore.github.io/WebIDL-ja.html#common-Function id=windoworworkerglobalscope-mixin:idl-function data-x-internal=idl-function>Function</a>) <dfn id=timerhandler>TimerHandler</dfn>;

interface mixin <dfn id=windoworworkerglobalscope>WindowOrWorkerGlobalScope</dfn> {
  [Replaceable] readonly attribute USVString <a href=#dom-origin id=windoworworkerglobalscope-mixin:dom-origin>origin</a>;

  // base64 utility methods
  DOMString <a href=#dom-btoa id=windoworworkerglobalscope-mixin:dom-btoa>btoa</a>(DOMString data);
  ByteString <a href=#dom-atob id=windoworworkerglobalscope-mixin:dom-atob>atob</a>(DOMString data);

  // timers
  long <a href=timers-and-user-prompts.html#dom-settimeout id=windoworworkerglobalscope-mixin:dom-settimeout>setTimeout</a>(<a href=#timerhandler id=windoworworkerglobalscope-mixin:timerhandler>TimerHandler</a> handler, optional long timeout = 0, any... arguments);
  void <a href=timers-and-user-prompts.html#dom-cleartimeout id=windoworworkerglobalscope-mixin:dom-cleartimeout>clearTimeout</a>(optional long handle = 0);
  long <a href=timers-and-user-prompts.html#dom-setinterval id=windoworworkerglobalscope-mixin:dom-setinterval>setInterval</a>(<a href=#timerhandler id=windoworworkerglobalscope-mixin:timerhandler-2>TimerHandler</a> handler, optional long timeout = 0, any... arguments);
  void <a href=timers-and-user-prompts.html#dom-clearinterval id=windoworworkerglobalscope-mixin:dom-clearinterval>clearInterval</a>(optional long handle = 0);

  // ImageBitmap
  Promise&lt;<a id=windoworworkerglobalscope-mixin:imagebitmap href=imagebitmap-and-animations.html#imagebitmap>ImageBitmap</a>&gt; <a href=imagebitmap-and-animations.html#dom-createimagebitmap id=windoworworkerglobalscope-mixin:dom-createimagebitmap>createImageBitmap</a>(<a id=windoworworkerglobalscope-mixin:imagebitmapsource href=imagebitmap-and-animations.html#imagebitmapsource>ImageBitmapSource</a> image, optional <a id=windoworworkerglobalscope-mixin:imagebitmapoptions href=imagebitmap-and-animations.html#imagebitmapoptions>ImageBitmapOptions</a> options);
  Promise&lt;<a id=windoworworkerglobalscope-mixin:imagebitmap-2 href=imagebitmap-and-animations.html#imagebitmap>ImageBitmap</a>&gt; <a href=imagebitmap-and-animations.html#dom-createimagebitmap id=windoworworkerglobalscope-mixin:dom-createimagebitmap-2>createImageBitmap</a>(<a id=windoworworkerglobalscope-mixin:imagebitmapsource-2 href=imagebitmap-and-animations.html#imagebitmapsource>ImageBitmapSource</a> image, long sx, long sy, long sw, long sh, optional <a id=windoworworkerglobalscope-mixin:imagebitmapoptions-2 href=imagebitmap-and-animations.html#imagebitmapoptions>ImageBitmapOptions</a> options);
};
<a id=windoworworkerglobalscope-mixin:window-2 href=window-object.html#window>Window</a> includes <a href=#windoworworkerglobalscope id=windoworworkerglobalscope-mixin:windoworworkerglobalscope-4>WindowOrWorkerGlobalScope</a>;
<a id=windoworworkerglobalscope-mixin:workerglobalscope-2 href=workers.html#workerglobalscope>WorkerGlobalScope</a> includes <a href=#windoworworkerglobalscope id=windoworworkerglobalscope-mixin:windoworworkerglobalscope-5>WindowOrWorkerGlobalScope</a>;</pre>

  <dl class=domintro><dt><var>origin</var> = self . <code id=dom-origin-dev><a href=#dom-origin>origin</a></code><dd><p>Returns the global object's <a id=windoworworkerglobalscope-mixin:concept-origin href=origin.html#concept-origin>origin</a>, serialized as string.</dl>

  <div class=example>
   <p>Developers are strongly encouraged to use <code>self.origin</code> over <code>location.origin</code>. The former returns the <a id=windoworworkerglobalscope-mixin:concept-origin-2 href=origin.html#concept-origin>origin</a> of the environment,
   the latter of the URL of the environment. Imagine the following script executing in a document on
   <code>https://stargate.example/</code>:</p>

   <pre>var frame = document.createElement("iframe")
frame.onload = function() {
  var frameWin = frame.contentWindow
  console.log(frameWin.location.origin) // "null"
  console.log(frameWin.origin) // "https://stargate.example"
}
document.body.appendChild(frame)</pre>

   <p><code>self.origin</code> is a more reliable security indicator.</p>
  </div>

  <p>The <dfn id=dom-origin><code>origin</code></dfn> attribute's getter must return this
  object's <a href=#relevant-settings-object id=windoworworkerglobalscope-mixin:relevant-settings-object>relevant settings object</a>'s <a href=#concept-settings-object-origin id=windoworworkerglobalscope-mixin:concept-settings-object-origin>origin</a>, <a href=origin.html#ascii-serialisation-of-an-origin id=windoworworkerglobalscope-mixin:ascii-serialisation-of-an-origin>serialized</a>.</p>


  <h3 id=atob><span class=secno>8.3</span> Base64ユーティリティーメソッド<a href=#atob class=self-link></a></h3><div class=status><input onclick=toggleStatus(this) value=⋰ type=button><p class=support><strong>Support:</strong> atob-btoa<span class="and_chr yes"><span>Chrome for Android</span> <span>64+</span></span><span class="chrome yes"><span>Chrome</span> <span>4+</span></span><span class="ios_saf yes"><span>iOS Safari</span> <span>3.2+</span></span><span class="and_uc yes"><span>UC Browser for Android</span> <span>11.8+</span></span><span class="firefox yes"><span>Firefox</span> <span>2+</span></span><span class="ie yes"><span>IE</span> <span>10+</span></span><span class="samsung yes"><span>Samsung Internet</span> <span>4+</span></span><span class="op_mini yes"><span>Opera Mini</span> <span>all+</span></span><span class="safari yes"><span>Safari</span> <span>3.1+</span></span><span class="edge yes"><span>Edge</span> <span>12+</span></span><span class="android yes"><span>Android Browser</span> <span>2.1+</span></span><span class="opera yes"><span>Opera</span> <span>10.6+</span></span><p class=caniuse>Source: <a href="https://caniuse.com/#feat=atob-btoa">caniuse.com</a></div>

  <p>The <code id=atob:dom-atob><a href=#dom-atob>atob()</a></code> and <code id=atob:dom-btoa><a href=#dom-btoa>btoa()</a></code> methods
  allow developers to transform content to and from the base64 encoding.</p>

  <p class=note>これらAPIにおいて、簡略のために、"b"は"binary"、"a"は"ASCII"を表すと考えることができる。ただし実際には、主に歴史的な理由で、これらの関数の入力と出力の両方にはUnicode文字列である。</p>

  <dl class=domintro><dt><var>result</var> = self . <code id=dom-btoa-dev><a href=#dom-btoa>btoa</a></code>( <var>data</var> )<dd>

    <p>入力データを取得し、U+0000からU+00FFまでの範囲で文字のみを含むUnicode文字列の形式で、それぞれ値0x00から0xFFまでを持つバイナリーバイトを表し、そのbase64表現に変換したものを返す。</p>

    <p>Throws an <a id=atob:invalidcharactererror href=https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror data-x-internal=invalidcharactererror>"<code>InvalidCharacterError</code>"</a> <code id=atob:domexception><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>
    exception if the input string contains any out-of-range characters.</p>

   <dt><var>result</var> = self . <code id=dom-atob-dev><a href=#dom-atob>atob</a></code>( <var>data</var> )<dd>

    <p>入力データを取得し、base64でエンコードされたバイナリーデータを含むUnicode文字列の形式で、これをデコードし、それぞれ0x00から0xFFまでの値を持つバイナリーバイトを表す、そのバイナリーデータに対応した、範囲U+0000からU+00FFまでの文字から成る文字列を返す。</p>

    <p>Throws an <a id=atob:invalidcharactererror-2 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror data-x-internal=invalidcharactererror>"<code>InvalidCharacterError</code>"</a> <code id=atob:domexception-2><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code> if the
    input string is not valid base64 data.</p>

   </dl>

  

  <p>The <dfn id=dom-btoa><code id=dom-windowbase64-btoa>btoa(<var>data</var>)</code></dfn>
  method must throw an <a id=atob:invalidcharactererror-3 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror data-x-internal=invalidcharactererror>"<code>InvalidCharacterError</code>"</a> <code id=atob:domexception-3><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>
  if <var>data</var> contains any character whose code point is greater than U+00FF. Otherwise, the
  user agent must convert <var>data</var> to a byte sequence whose <var>n</var>th byte is the
  eight-bit representation of the <var>n</var>th code point of <var>data</var>, and then must apply
  <a id=atob:forgiving-base64-encode href=https://triple-underscore.github.io/infra-ja.html#forgiving-base64-encode data-x-internal=forgiving-base64-encode>forgiving-base64 encode</a> to that byte sequence and return the result.</p>

  <p>The <dfn id=dom-atob><code id=dom-windowbase64-atob>atob(<var>data</var>)</code></dfn>
  method, when invoked, must run the following steps:</p>

  <ol><li><p>Let <var>decodedData</var> be the result of running <a id=atob:forgiving-base64-decode href=https://triple-underscore.github.io/infra-ja.html#forgiving-base64-decode data-x-internal=forgiving-base64-decode>forgiving-base64 decode</a>
   on <var>data</var>.</li><li><p>If <var>decodedData</var> is failure, then throw an
   <a id=atob:invalidcharactererror-4 href=https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror data-x-internal=invalidcharactererror>"<code>InvalidCharacterError</code>"</a> <code id=atob:domexception-4><a data-x-internal=domexception href=https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException>DOMException</a></code>.</li><li><p>Return <var>decodedData</var>.</li></ol>

  


  <nav><a href=offline.html>← 7.9 Offline Web applications</a> — <a href=./>Table of Contents</a> — <a href=dynamic-markup-insertion.html>8.4 Dynamic markup insertion →</a></nav>
</body></html>
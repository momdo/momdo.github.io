<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script async="" crossorigin="" src="./html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">20 August 2020</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="offline.html">← 7.11 オフラインウェブアプリケーション</a> — <a href="./">目次</a> — <a href="dynamic-markup-insertion.html">8.4 動的マークアップの挿入 →</a></nav><ol class="toc"><li id="toc-webappapis"><a href="webappapis.html#webappapis"><span class="secno">8</span> ウェブアプリケーションAPI</a><ol><li><a href="webappapis.html#scripting"><span class="secno">8.1</span> スクリプティング</a><ol><li><a href="webappapis.html#introduction-12"><span class="secno">8.1.1</span> 導入</a><li><a href="webappapis.html#agents-and-agent-clusters"><span class="secno">8.1.2</span> Agents and agent clusters</a><ol><li><a href="webappapis.html#integration-with-the-javascript-agent-formalism"><span class="secno">8.1.2.1</span> Integration with the JavaScript agent formalism</a><li><a href="webappapis.html#integration-with-the-javascript-agent-cluster-formalism"><span class="secno">8.1.2.2</span> Integration with the JavaScript agent cluster formalism</a></ol><li><a href="webappapis.html#realms-and-their-counterparts"><span class="secno">8.1.3</span> Realms and their counterparts</a><ol><li><a href="webappapis.html#environments"><span class="secno">8.1.3.1</span> Environments</a><li><a href="webappapis.html#environment-settings-objects"><span class="secno">8.1.3.2</span> Environment settings objects</a><li><a href="webappapis.html#realms-settings-objects-global-objects"><span class="secno">8.1.3.3</span> Realms, settings objects, and global objects</a><ol><li><a href="webappapis.html#entry"><span class="secno">8.1.3.3.1</span> Entry</a><li><a href="webappapis.html#incumbent"><span class="secno">8.1.3.3.2</span> Incumbent</a><li><a href="webappapis.html#current"><span class="secno">8.1.3.3.3</span> Current</a><li><a href="webappapis.html#relevant"><span class="secno">8.1.3.3.4</span> Relevant</a></ol><li><a href="webappapis.html#enabling-and-disabling-scripting"><span class="secno">8.1.3.4</span> Enabling and disabling scripting</a><li><a href="webappapis.html#secure-contexts"><span class="secno">8.1.3.5</span> Secure contexts</a></ol><li><a href="webappapis.html#scripting-processing-model"><span class="secno">8.1.4</span> Script processing model</a><ol><li><a href="webappapis.html#script-structs"><span class="secno">8.1.4.1</span> Scripts</a><li><a href="webappapis.html#fetching-scripts"><span class="secno">8.1.4.2</span> Fetching scripts</a><li><a href="webappapis.html#creating-scripts"><span class="secno">8.1.4.3</span> Creating scripts</a><li><a href="webappapis.html#calling-scripts"><span class="secno">8.1.4.4</span> Calling scripts</a><li><a href="webappapis.html#killing-scripts"><span class="secno">8.1.4.5</span> Killing scripts</a><li><a href="webappapis.html#runtime-script-errors"><span class="secno">8.1.4.6</span> Runtime script errors</a><li><a href="webappapis.html#unhandled-promise-rejections"><span class="secno">8.1.4.7</span> Unhandled promise rejections</a></ol><li><a href="webappapis.html#javascript-specification-host-hooks"><span class="secno">8.1.5</span> JavaScript specification host hooks</a><ol><li><a href="webappapis.html#hostenqueuepromisejob"><span class="secno">8.1.5.1</span> HostEnqueuePromiseJob(<var>job</var>, <var>realm</var>)</a><li><a href="webappapis.html#hostensurecancompilestrings(callerrealm,-calleerealm)"><span class="secno">8.1.5.2</span> HostEnsureCanCompileStrings(<var>callerRealm</var>, <var>calleeRealm</var>)</a><li><a href="webappapis.html#the-hostpromiserejectiontracker-implementation"><span class="secno">8.1.5.3</span> HostPromiseRejectionTracker(<var>promise</var>, <var>operation</var>)</a><li><a href="webappapis.html#integration-with-the-javascript-module-system"><span class="secno">8.1.5.4</span> Module-related host hooks</a><ol><li><a href="webappapis.html#hostgetimportmetaproperties"><span class="secno">8.1.5.4.1</span> HostGetImportMetaProperties(<var>moduleRecord</var>)</a><li><a href="webappapis.html#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)"><span class="secno">8.1.5.4.2</span> HostImportModuleDynamically(<var>referencingScriptOrModule</var>, <var>specifier</var>, <var>promiseCapability</var>)</a><li><a href="webappapis.html#hostresolveimportedmodule(referencingscriptormodule,-specifier)"><span class="secno">8.1.5.4.3</span> HostResolveImportedModule(<var>referencingScriptOrModule</var>, <var>specifier</var>)</a></ol></ol><li><a href="webappapis.html#event-loops"><span class="secno">8.1.6</span> Event loops</a><ol><li><a href="webappapis.html#definitions-3"><span class="secno">8.1.6.1</span> Definitions</a><li><a href="webappapis.html#queuing-tasks"><span class="secno">8.1.6.2</span> Queuing tasks</a><li><a href="webappapis.html#event-loop-processing-model"><span class="secno">8.1.6.3</span> Processing model</a><li><a href="webappapis.html#generic-task-sources"><span class="secno">8.1.6.4</span> Generic task sources</a><li><a href="webappapis.html#event-loop-for-spec-authors"><span class="secno">8.1.6.5</span> Dealing with the event loop from other specifications</a></ol><li><a href="webappapis.html#events"><span class="secno">8.1.7</span> イベント</a><ol><li><a href="webappapis.html#event-handler-attributes"><span class="secno">8.1.7.1</span> イベントハンドラー</a><li><a href="webappapis.html#event-handlers-on-elements,-document-objects,-and-window-objects"><span class="secno">8.1.7.2</span> 要素のイベントハンドラー、<code>Document</code>オブジェクト、および<code>Window</code>オブジェクト</a><ol><li><a href="webappapis.html#idl-definitions"><span class="secno">8.1.7.2.1</span> IDL definitions</a></ol><li><a href="webappapis.html#event-firing"><span class="secno">8.1.7.3</span> Event firing</a></ol></ol><li><a href="webappapis.html#windoworworkerglobalscope-mixin"><span class="secno">8.2</span> <code>WindowOrWorkerGlobalScope</code>ミックスイン</a><li><a href="webappapis.html#atob"><span class="secno">8.3</span> Base64ユーティリティーメソッド</a></ol></ol><h2 id="webappapis"><span class="secno">8</span> ウェブアプリケーションAPI<a href="#webappapis" class="self-link"></a></h2>

  <h3 id="scripting"><span class="secno">8.1</span> スクリプティング<a href="#scripting" class="self-link"></a></h3>

  <h4 id="introduction-12"><span class="secno">8.1.1</span> 導入<a href="#introduction-12" class="self-link"></a></h4>

  <p>様々なメカニズムが文書のコンテキストで実行するよう著者が提供する実行可能コードを引き起こすかもしれない。これらのメカニズムは以下を含むが、おそらく以下に限定されない：</p>

  <ul><li><code id="introduction-12:the-script-element"><a href="scripting.html#the-script-element">script</a></code>要素の処理。<li><a href="browsing-the-web.html#javascript-protocol" id="introduction-12:javascript-protocol"><code>javascript:</code> URL</a>をナビゲートする。<li><code>addEventListener()</code>を使用するDOMを介して、明示的な<a href="#event-handler-content-attributes" id="introduction-12:event-handler-content-attributes">イベントハンドラーコンテンツ属性</a>によって、<a href="#event-handler-idl-attributes" id="introduction-12:event-handler-idl-attributes">イベントハンドラーIDL属性</a>によって、またはそれ以外で、登録されるかどうかのイベントハンドラー。<li>独自のスクリプト機能を持つSVGのような技術の処理。</ul>

  <h4 id="agents-and-agent-clusters"><span class="secno">8.1.2</span> Agents and agent clusters<a href="#agents-and-agent-clusters" class="self-link"></a></h4>

  <h5 id="integration-with-the-javascript-agent-formalism"><span class="secno">8.1.2.1</span> Integration with the JavaScript agent formalism<a href="#integration-with-the-javascript-agent-formalism" class="self-link"></a></h5>

  <p>JavaScript defines the concept of an <a id="integration-with-the-javascript-agent-formalism:agent" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a>. This section gives the mapping of that language-level concept on to the web platform.</p>

  <div class="note"><p>Conceptually, the <a id="integration-with-the-javascript-agent-formalism:agent-2" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> concept is an architecture-independent, idealized "thread" in which JavaScript code runs. Such code can involve multiple globals/<a href="#concept-global-object-realm" id="integration-with-the-javascript-agent-formalism:concept-global-object-realm">realms</a> that can synchronously access each other, and thus needs to run in a single execution thread.</p>

   <p>Two <code id="integration-with-the-javascript-agent-formalism:window"><a href="window-object.html#window">Window</a></code> objects having the same <a id="integration-with-the-javascript-agent-formalism:agent-3" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> does not indicate they can directly access all objects created in each other's realms. They would have to be <a id="integration-with-the-javascript-agent-formalism:same-origin-domain" href="origin.html#same-origin-domain">same origin-domain</a>; see <a id="integration-with-the-javascript-agent-formalism:isplatformobjectsameorigin-(-o-)" href="browsers.html#isplatformobjectsameorigin-(-o-)">IsPlatformObjectSameOrigin</a>.</p>
  </div>

  <p>The following types of agents exist on the web platform:</p>

  <dl><dt><dfn id="similar-origin-window-agent" data-export="">Similar-origin window agent</dfn><dd><p>Contains various <code id="integration-with-the-javascript-agent-formalism:window-2"><a href="window-object.html#window">Window</a></code> objects which can potentially reach each other, either directly or by using <code id="integration-with-the-javascript-agent-formalism:dom-document-domain"><a href="origin.html#dom-document-domain">document.domain</a></code>.</p>

    <p>If the encompassing <a id="integration-with-the-javascript-agent-formalism:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>'s <a href="#cross-origin-isolated" id="integration-with-the-javascript-agent-formalism:cross-origin-isolated">cross-origin isolated</a> is true, then all the <code id="integration-with-the-javascript-agent-formalism:window-3"><a href="window-object.html#window">Window</a></code> objects will be <a id="integration-with-the-javascript-agent-formalism:same-origin" href="origin.html#same-origin">same origin</a>, can reach each other directly, and <code id="integration-with-the-javascript-agent-formalism:dom-document-domain-2"><a href="origin.html#dom-document-domain">document.domain</a></code> will no-op.</p>

    <p class="note">Two <code id="integration-with-the-javascript-agent-formalism:window-4"><a href="window-object.html#window">Window</a></code> objects that are <a id="integration-with-the-javascript-agent-formalism:same-origin-2" href="origin.html#same-origin">same origin</a> can be in different <a href="#similar-origin-window-agent" id="integration-with-the-javascript-agent-formalism:similar-origin-window-agent">similar-origin window agents</a>, for instance if they are each in their own <a id="integration-with-the-javascript-agent-formalism:browsing-context-group" href="browsers.html#browsing-context-group">browsing context group</a>.</p>
   <dt><dfn id="dedicated-worker-agent" data-export="">Dedicated worker agent</dfn><dd><p>Contains a single <code id="integration-with-the-javascript-agent-formalism:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>.<dt><dfn id="shared-worker-agent" data-export="">Shared worker agent</dfn><dd><p>Contains a single <code id="integration-with-the-javascript-agent-formalism:sharedworkerglobalscope"><a href="workers.html#sharedworkerglobalscope">SharedWorkerGlobalScope</a></code>.<dt><dfn id="service-worker-agent" data-export="">Service worker agent</dfn><dd><p>Contains a single <code id="integration-with-the-javascript-agent-formalism:serviceworkerglobalscope"><a data-x-internal="serviceworkerglobalscope" href="https://w3c.github.io/ServiceWorker/#serviceworkerglobalscope">ServiceWorkerGlobalScope</a></code>.<dt><dfn id="worklet-agent" data-export="">Worklet agent</dfn><dd><p>Contains a single <code id="integration-with-the-javascript-agent-formalism:workletglobalscope"><a data-x-internal="workletglobalscope" href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a></code> object.</p>

    <p class="note">Although a given worklet can have multiple realms, each such realm needs its own agent, as each realm can be executing code independently and at the same time as the others.</p>
   </dl>

  <p>Only <a href="#shared-worker-agent" id="integration-with-the-javascript-agent-formalism:shared-worker-agent">shared</a> and <a href="#dedicated-worker-agent" id="integration-with-the-javascript-agent-formalism:dedicated-worker-agent">dedicated worker agents</a> allow the use of JavaScript <code id="integration-with-the-javascript-agent-formalism:atomics"><a data-x-internal="atomics" href="https://tc39.es/ecma262/#sec-atomics-object">Atomics</a></code> APIs to potentially <a href="https://tc39.es/ecma262/#sec-forward-progress" id="integration-with-the-javascript-agent-formalism:forward-progress" data-x-internal="forward-progress">block</a>.</p>

  

  <p>To <dfn id="create-an-agent">create an agent</dfn>, given a boolean <var>canBlock</var>:</p>

  <ol><li><p>Let <var>signifier</var> be a new unique internal value.<li><p>Let <var>candidateExecution</var> be a new <a id="integration-with-the-javascript-agent-formalism:candidate-execution" href="https://tc39.es/ecma262/#sec-candidate-executions" data-x-internal="candidate-execution">candidate execution</a>.<li><p>Let <var>agent</var> be a new <a id="integration-with-the-javascript-agent-formalism:agent-4" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> whose [[CanBlock]] is <var>canBlock</var>, [[Signifier]] is <var>signifier</var>, [[CandidateExecution]] is <var>candidateExecution</var>, and [[IsLockFree1]], [[IsLockFree2]], and [[LittleEndian]] are set at the implementation's discretion.<li><p>Set <var>agent</var>'s <a href="#concept-agent-event-loop" id="integration-with-the-javascript-agent-formalism:concept-agent-event-loop">event loop</a> to a new <a href="#event-loop" id="integration-with-the-javascript-agent-formalism:event-loop">event loop</a>.<li><p>Return <var>agent</var>.</ol>

  <p>The <dfn id="relevant-agent" data-export="">relevant agent</dfn> for a <a id="integration-with-the-javascript-agent-formalism:platform-object" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> <var>platformObject</var> is <var>platformObject</var>'s <a href="#concept-relevant-realm" id="integration-with-the-javascript-agent-formalism:concept-relevant-realm">relevant Realm</a>'s <a id="integration-with-the-javascript-agent-formalism:agent-5" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a>. <span class="XXX">This pointer is not yet defined in the JavaScript specification; see <a href="https://github.com/tc39/ecma262/issues/1357">tc39/ecma262#1357</a>.</span></p>

  <p class="note">The agent equivalent of the <a id="integration-with-the-javascript-agent-formalism:current-realm-record" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a> is the <a id="integration-with-the-javascript-agent-formalism:surrounding-agent" href="https://tc39.es/ecma262/#surrounding-agent" data-x-internal="surrounding-agent">surrounding agent</a>.</p>

  

  <h5 id="integration-with-the-javascript-agent-cluster-formalism"><span class="secno">8.1.2.2</span> Integration with the JavaScript agent cluster formalism<a href="#integration-with-the-javascript-agent-cluster-formalism" class="self-link"></a></h5>

  <p>JavaScript also defines the concept of an <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>, which this standard maps to the web platform by placing agents appropriately when they are created using the <a href="#obtain-similar-origin-window-agent" id="integration-with-the-javascript-agent-cluster-formalism:obtain-similar-origin-window-agent">obtain a similar-origin window agent</a> or <a href="#obtaining-a-worker/worklet-agent" id="integration-with-the-javascript-agent-cluster-formalism:obtaining-a-worker/worklet-agent">obtain a worker/worklet agent</a> algorithms.</p>

  <p>The <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-2" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a> concept is crucial for defining the JavaScript memory model, and in particular among which <a href="https://tc39.es/ecma262/#sec-agents" id="integration-with-the-javascript-agent-cluster-formalism:agent" data-x-internal="agent">agents</a> the backing data of <code id="integration-with-the-javascript-agent-cluster-formalism:sharedarraybuffer"><a data-x-internal="sharedarraybuffer" href="https://tc39.es/ecma262/#sec-sharedarraybuffer-objects">SharedArrayBuffer</a></code> objects can be shared.</p>

  <p class="note">Conceptually, the <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-3" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a> concept is an architecture-independent, idealized "process boundary" that groups together multiple "threads" (<a href="https://tc39.es/ecma262/#sec-agents" id="integration-with-the-javascript-agent-cluster-formalism:agent-2" data-x-internal="agent">agents</a>). The <a href="https://tc39.es/ecma262/#sec-agent-clusters" id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-4" data-x-internal="agent-cluster">agent clusters</a> defined by the specification are generally more restrictive than the actual process boundaries implemented in user agents. By enforcing these idealized divisions at the specification level, we ensure that web developers see interoperable behavior with regard to shared memory, even in the face of varying and changing user agent process models.</p>

  <p>An <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-5" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a> has an associated <dfn id="cross-origin-isolated">cross-origin isolated</dfn> (a boolean), which is initially false.</p>

  

  <hr>

  <p>The following defines the allocation of the <a href="https://tc39.es/ecma262/#sec-agent-clusters" id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-6" data-x-internal="agent-cluster">agent clusters</a> of <a href="#similar-origin-window-agent" id="integration-with-the-javascript-agent-cluster-formalism:similar-origin-window-agent">similar-origin window agents</a>.</p>

  <p>An <dfn id="agent-cluster-key">agent cluster key</dfn> is a <a id="integration-with-the-javascript-agent-cluster-formalism:site" href="origin.html#site">site</a> or <a href="origin.html#concept-origin-tuple" id="integration-with-the-javascript-agent-cluster-formalism:concept-origin-tuple">tuple origin</a> whose <a href="origin.html#concept-origin-host" id="integration-with-the-javascript-agent-cluster-formalism:concept-origin-host">host</a>'s <a id="integration-with-the-javascript-agent-cluster-formalism:registrable-domain" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a> is non-null. I.e., an <a href="#agent-cluster-key" id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-key">agent cluster key</a> can be a <a id="integration-with-the-javascript-agent-cluster-formalism:scheme-and-registrable-domain" href="origin.html#scheme-and-registrable-domain">scheme-and-registrable-domain</a> or any <a id="integration-with-the-javascript-agent-cluster-formalism:concept-origin" href="origin.html#concept-origin">origin</a>.</p>

  <p>To <dfn id="obtain-similar-origin-window-agent">obtain a similar-origin window agent</dfn>, given an <a id="integration-with-the-javascript-agent-cluster-formalism:concept-origin-2" href="origin.html#concept-origin">origin</a> <var>origin</var> and <a id="integration-with-the-javascript-agent-cluster-formalism:browsing-context-group" href="browsers.html#browsing-context-group">browsing context group</a> <var>group</var>, run these steps:</p>

  <ol><li><p>Let <var>key</var> be the result of <a href="origin.html#obtain-a-site" id="integration-with-the-javascript-agent-cluster-formalism:obtain-a-site">obtaining a site</a> with <var>origin</var>.<li><p>If <var>group</var>'s <a href="browsers.html#bcg-cross-origin-isolated" id="integration-with-the-javascript-agent-cluster-formalism:bcg-cross-origin-isolated">cross-origin isolated</a> is true, then set <var>key</var> to <var>origin</var>.<li><p>If <var>group</var>'s <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-map" href="browsers.html#agent-cluster-map">agent cluster map</a>[<var>key</var>] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="integration-with-the-javascript-agent-cluster-formalism:map-exists" data-x-internal="map-exists">does not exist</a>, then:</p>

    <ol><li><p>Let <var>agentCluster</var> be a new <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-7" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>.<li><p>Set <var>agentCluster</var>'s <a href="#cross-origin-isolated" id="integration-with-the-javascript-agent-cluster-formalism:cross-origin-isolated">cross-origin isolated</a> to <var>group</var>'s <a href="browsers.html#bcg-cross-origin-isolated" id="integration-with-the-javascript-agent-cluster-formalism:bcg-cross-origin-isolated-2">cross-origin isolated</a>.<li><p>Add the result of <a href="#create-an-agent" id="integration-with-the-javascript-agent-cluster-formalism:create-an-agent">creating an agent</a>, given false, to <var>agentCluster</var>.<li><p>Set <var>group</var>'s <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-map-2" href="browsers.html#agent-cluster-map">agent cluster map</a>[<var>key</var>] to <var>agentCluster</var>.</ol>
   <li><p>Return the single <a href="#similar-origin-window-agent" id="integration-with-the-javascript-agent-cluster-formalism:similar-origin-window-agent-2">similar-origin window agent</a> contained in <var>group</var>'s <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-map-3" href="browsers.html#agent-cluster-map">agent cluster map</a>[<var>key</var>].</ol>

  <p class="note">This means that there is only one <a href="#similar-origin-window-agent" id="integration-with-the-javascript-agent-cluster-formalism:similar-origin-window-agent-3">similar-origin window agent</a> per browsing context agent cluster. (However, <a href="#dedicated-worker-agent" id="integration-with-the-javascript-agent-cluster-formalism:dedicated-worker-agent">dedicated worker</a> and <a href="#worklet-agent" id="integration-with-the-javascript-agent-cluster-formalism:worklet-agent">worklet agents</a> might be in the same cluster.)</p>

  <hr>

  <p>The following defines the allocation of the <a href="https://tc39.es/ecma262/#sec-agent-clusters" id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-8" data-x-internal="agent-cluster">agent clusters</a> of all other types of agents.</p>

  <p>To <dfn id="obtaining-a-worker/worklet-agent">obtain a worker/worklet agent</dfn>, given an <a href="#environment-settings-object" id="integration-with-the-javascript-agent-cluster-formalism:environment-settings-object">environment settings object</a> or null <var>outside settings</var>, a boolean <var>isTopLevel</var>, and a boolean <var>canBlock</var>, run these steps:</p>

  <ol><li><p>Let <var>agentCluster</var> be null.<li><p>If <var>isTopLevel</var> is true, then set <var>agentCluster</var> to a new <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-9" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>.<li><p>Otherwise:</p>

    <ol><li><p>Assert: <var>outside settings</var> is not null.<li><p>Let <var>ownerAgent</var> be <var>outside settings</var>'s <a href="#environment-settings-object's-realm" id="integration-with-the-javascript-agent-cluster-formalism:environment-settings-object's-realm">Realm</a>'s agent.<li><p>Set <var>agentCluster</var> to the agent cluster which contains <var>ownerAgent</var>.</ol>
   <li><p>Let <var>agent</var> be the result of <a href="#create-an-agent" id="integration-with-the-javascript-agent-cluster-formalism:create-an-agent-2">creating an agent</a> given <var>canBlock</var>.<li><p>Add <var>agent</var> to <var>agentCluster</var>.<li><p>Return <var>agent</var>.</ol>

  <p>To <dfn id="obtain-a-dedicated/shared-worker-agent">obtain a dedicated/shared worker agent</dfn>, given an <a href="#environment-settings-object" id="integration-with-the-javascript-agent-cluster-formalism:environment-settings-object-2">environment settings object</a> <var>outside settings</var> and a boolean <var>isShared</var>, return the result of <a href="#obtaining-a-worker/worklet-agent" id="integration-with-the-javascript-agent-cluster-formalism:obtaining-a-worker/worklet-agent-2">obtaining a worker/worklet agent</a> given <var>outside settings</var>, <var>isShared</var>, and true.</p>

  <p>To <dfn id="obtain-a-worklet-agent" data-export="">obtain a worklet agent</dfn>, given an <a href="#environment-settings-object" id="integration-with-the-javascript-agent-cluster-formalism:environment-settings-object-3">environment settings object</a> <var>outside settings</var>, return the result of <a href="#obtaining-a-worker/worklet-agent" id="integration-with-the-javascript-agent-cluster-formalism:obtaining-a-worker/worklet-agent-3">obtaining a worker/worklet agent</a> given <var>outside settings</var>, false, and false.</p>

  <p>To <dfn id="obtain-a-service-worker-agent" data-export="">obtain a service worker agent</dfn>, return the result of <a href="#obtaining-a-worker/worklet-agent" id="integration-with-the-javascript-agent-cluster-formalism:obtaining-a-worker/worklet-agent-4">obtaining a worker/worklet agent</a> given null, true, and false.</p>

  <hr>

  

  <div id="can-share-memory-with" class="example"><p>The following pairs of global objects are each within the same <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-10" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>, and thus can use <code id="integration-with-the-javascript-agent-cluster-formalism:sharedarraybuffer-2"><a data-x-internal="sharedarraybuffer" href="https://tc39.es/ecma262/#sec-sharedarraybuffer-objects">SharedArrayBuffer</a></code> instances to share memory with each other:</p>

   <ul class="brief"><li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window"><a href="window-object.html#window">Window</a></code> object and a dedicated worker that it created.<li>A worker (of any type) and a dedicated worker it created.<li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-2"><a href="window-object.html#window">Window</a></code> object <var>A</var> and the <code id="integration-with-the-javascript-agent-cluster-formalism:window-3"><a href="window-object.html#window">Window</a></code> object of an <code id="integration-with-the-javascript-agent-cluster-formalism:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> element that <var>A</var> created that could be <a id="integration-with-the-javascript-agent-cluster-formalism:same-origin-domain" href="origin.html#same-origin-domain">same origin-domain</a> with <var>A</var>.<li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-4"><a href="window-object.html#window">Window</a></code> object and a <a id="integration-with-the-javascript-agent-cluster-formalism:same-origin-domain-2" href="origin.html#same-origin-domain">same origin-domain</a> <code id="integration-with-the-javascript-agent-cluster-formalism:window-5"><a href="window-object.html#window">Window</a></code> object that opened it.<li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-6"><a href="window-object.html#window">Window</a></code> object and a worklet that it created.</ul>

   <p>The following pairs of global objects are <em>not</em> within the same <a id="integration-with-the-javascript-agent-cluster-formalism:agent-cluster-11" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>, and thus cannot share memory:</p>

   <ul class="brief"><li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-7"><a href="window-object.html#window">Window</a></code> object and a shared worker it created.<li>A worker (of any type) and a shared worker it created.<li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-8"><a href="window-object.html#window">Window</a></code> object and a service worker it created.<li>A <code id="integration-with-the-javascript-agent-cluster-formalism:window-9"><a href="window-object.html#window">Window</a></code> object <var></var> and the <code id="integration-with-the-javascript-agent-cluster-formalism:window-10"><a href="window-object.html#window">Window</a></code> object of an <code id="integration-with-the-javascript-agent-cluster-formalism:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> element that <var>A</var> created that cannot be <a id="integration-with-the-javascript-agent-cluster-formalism:same-origin-domain-3" href="origin.html#same-origin-domain">same origin-domain</a> with <var>A</var>.<li>Any two <code id="integration-with-the-javascript-agent-cluster-formalism:window-11"><a href="window-object.html#window">Window</a></code> objects whose <a href="browsers.html#browsing-context" id="integration-with-the-javascript-agent-cluster-formalism:browsing-context">browsing contexts</a> do not have a non-null <a href="browsers.html#opener-browsing-context" id="integration-with-the-javascript-agent-cluster-formalism:opener-browsing-context">opener</a> or <a href="browsers.html#ancestor-browsing-context" id="integration-with-the-javascript-agent-cluster-formalism:ancestor-browsing-context">ancestor</a> relationship. This holds even if the two <code id="integration-with-the-javascript-agent-cluster-formalism:window-12"><a href="window-object.html#window">Window</a></code> objects are <a id="integration-with-the-javascript-agent-cluster-formalism:same-origin" href="origin.html#same-origin">same origin</a>.</ul>
  </div>

  

  <h4 id="realms-and-their-counterparts"><span class="secno">8.1.3</span> Realms and their counterparts<a href="#realms-and-their-counterparts" class="self-link"></a></h4>

  <p>The JavaScript specification introduces the <a href="https://tc39.es/ecma262/#sec-code-realms" id="realms-and-their-counterparts:javascript-realm" data-x-internal="javascript-realm">realm</a> concept, representing a global environment in which script is run. Each realm comes with an <a id="realms-and-their-counterparts:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="#global-object" id="realms-and-their-counterparts:global-object">global object</a>; much of this specification is devoted to defining that global object and its properties.</p>

  <p>For web specifications, it is often useful to associate values or algorithms with a realm/global object pair. When the values are specific to a particular type of realm, they are associated directly with the global object in question, e.g., in the definition of the <code id="realms-and-their-counterparts:window"><a href="window-object.html#window">Window</a></code> or <code id="realms-and-their-counterparts:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> interfaces. When the values have utility across multiple realms, we use the <a href="#environment-settings-object" id="realms-and-their-counterparts:environment-settings-object">environment settings object</a> concept.</p>

  <p>Finally, in some cases it is necessary to track associated values before a realm/global object/environment settings object even comes into existence (for example, during <a href="browsing-the-web.html#navigate" id="realms-and-their-counterparts:navigate">navigation</a>). These values are tracked in the <a href="#environment" id="realms-and-their-counterparts:environment">environment</a> concept.</p>

  <h5 id="environments"><span class="secno">8.1.3.1</span> Environments<a href="#environments" class="self-link"></a></h5>

  <p>An <dfn id="environment" data-export="">environment</dfn> is an object that identifies the settings of a current or potential execution environment. An <a href="#environment" id="environments:environment">environment</a> has the following fields:</p>

  <dl><dt>An <dfn data-dfn-for="environment" id="concept-environment-id" data-export="">id</dfn><dd><p>An opaque string that uniquely identifies this <a href="#environment" id="environments:environment-2">environment</a>.<dt>A <dfn data-dfn-for="environment" id="concept-environment-creation-url" data-export="">creation URL</dfn><dd><p>A <a id="environments:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> that represents the location of the resource with which this <a href="#environment" id="environments:environment-3">environment</a> is associated.</p>

    <p class="note">In the case of an <a href="#environment-settings-object" id="environments:environment-settings-object">environment settings object</a>, this URL might be distinct from the <a href="#environment-settings-object" id="environments:environment-settings-object-2">environment settings object</a>'s <a href="#responsible-document" id="environments:responsible-document">responsible document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="environments:the-document's-address" data-x-internal="the-document's-address">URL</a>, due to mechanisms such as <code id="environments:dom-history-pushstate"><a href="history.html#dom-history-pushstate">history.pushState()</a></code>.</p>
   <dt>A <dfn data-dfn-for="environment" id="concept-environment-top-level-creation-url" data-export="">top-level creation URL</dfn><dd><p>Null or a <a id="environments:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> that represents the <a href="#concept-environment-creation-url" id="environments:concept-environment-creation-url">creation URL</a> of the "top-level" <a href="#environment" id="environments:environment-4">environment</a>. It is null for workers and worklets.<dt>A <dfn data-dfn-for="environment" id="concept-environment-top-level-origin" data-export="">top-level origin</dfn><dd><p>A <span class="XXX">for now</span> <a id="environments:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> value, null, or an <a id="environments:concept-origin" href="origin.html#concept-origin">origin</a>. For a "top-level" potential execution environment it is null (i.e., when there is no response yet); otherwise it is the "top-level" <a href="#environment" id="environments:environment-5">environment</a>'s <a href="#concept-settings-object-origin" id="environments:concept-settings-object-origin">origin</a>. For a dedicated worker or worklet it is the <a href="#concept-environment-top-level-origin" id="environments:concept-environment-top-level-origin">top-level origin</a> of its creator. For a shared or service worker it is an <a id="environments:implementation-defined-2" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> value.</p>

    <p class="note">This is distinct from the <a href="#concept-environment-top-level-creation-url" id="environments:concept-environment-top-level-creation-url">top-level creation URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="environments:concept-url-origin" data-x-internal="concept-url-origin">origin</a> when sandboxing, workers, and worklets are involved.</p>
   <dt>A <dfn data-dfn-for="environment" id="concept-environment-target-browsing-context" data-export="">target browsing context</dfn><dd><p>Null or a target <a id="environments:browsing-context" href="browsers.html#browsing-context">browsing context</a> for a <a href="https://triple-underscore.github.io/Fetch-ja.html#navigation-request" id="environments:navigation-request" data-x-internal="navigation-request">navigation request</a>.<dt>An <dfn data-dfn-for="environment" id="concept-environment-active-service-worker" data-export="">active service worker</dfn><dd><p>Null or a <a href="https://w3c.github.io/ServiceWorker/#dfn-service-worker" id="environments:dfn-service-worker" data-x-internal="dfn-service-worker">service worker</a> that <a href="https://w3c.github.io/ServiceWorker/#dfn-control" id="environments:dfn-control" data-x-internal="dfn-control">controls</a> the <a href="#environment" id="environments:environment-6">environment</a>.<dt>An <dfn data-dfn-for="environment" id="concept-environment-execution-ready-flag" data-export="">execution ready flag</dfn><dd><p>A flag that indicates whether the environment setup is done. It is initially unset.</dl>

  <p>Specifications may define <dfn id="environment-discarding-steps" data-export="">environment discarding steps</dfn> for environments. The steps take an <a href="#environment" id="environments:environment-7">environment</a> as input.</p>

  <p class="note">The <a href="#environment-discarding-steps" id="environments:environment-discarding-steps">environment discarding steps</a> are run for only a select few environments: the ones that will never become execution ready because, for example, they failed to load.</p>

  <h5 id="environment-settings-objects"><span class="secno">8.1.3.2</span> Environment settings objects<a href="#environment-settings-objects" class="self-link"></a></h5>

  <p>An <dfn id="environment-settings-object" data-export="">environment settings object</dfn> is an <a href="#environment" id="environment-settings-objects:environment">environment</a> that additionally specifies algorithms for:</p>

  <dl><dt>A <dfn data-dfn-for="environment settings object" id="realm-execution-context" data-export="">realm execution context</dfn><dd><p>A <a id="environment-settings-objects:javascript-execution-context" href="https://tc39.es/ecma262/#sec-execution-contexts" data-x-internal="javascript-execution-context">JavaScript execution context</a> shared by all <a href="scripting.html#the-script-element" id="environment-settings-objects:the-script-element">scripts</a> that use this settings object, i.e. all scripts in a given <a id="environment-settings-objects:javascript-realm" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>. When we <a href="#run-a-classic-script" id="environment-settings-objects:run-a-classic-script">run a classic script</a> or <a href="#run-a-module-script" id="environment-settings-objects:run-a-module-script">run a module script</a>, this execution context becomes the top of the <a id="environment-settings-objects:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>, on top of which another execution context specific to the script in question is pushed. (This setup ensures <a href="https://tc39.es/ecma262/#sec-parse-script" id="environment-settings-objects:js-parsescript" data-x-internal="js-parsescript">ParseScript</a> and <a id="environment-settings-objects:source-text-module-record" href="https://tc39.es/ecma262/#sec-source-text-module-records" data-x-internal="source-text-module-record">Source Text Module Record</a>'s <a href="https://tc39.es/ecma262/#sec-moduleevaluation" id="environment-settings-objects:js-evaluate" data-x-internal="js-evaluate">Evaluate</a> know which Realm to use.)</p>
   <dt>A <dfn data-dfn-for="environment
   settings object" id="concept-settings-object-module-map" data-export="">module map</dfn><dd><p>A <a href="#module-map" id="environment-settings-objects:module-map">module map</a> that is used when importing JavaScript modules.</p>
   <dt>A <dfn data-dfn-for="environment settings object" id="responsible-document" data-export="">responsible document</dfn><dd><p>A <code id="environment-settings-objects:document"><a href="dom.html#document">Document</a></code> that is assigned responsibility for actions taken by the scripts that use this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object">environment settings object</a>.</p>

    <p class="example">For example, the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="environment-settings-objects:the-document's-address" data-x-internal="the-document's-address">URL</a> of the <a href="#responsible-document" id="environment-settings-objects:responsible-document">responsible document</a> is used to set the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="environment-settings-objects:the-document's-address-2" data-x-internal="the-document's-address">URL</a> of the <code id="environment-settings-objects:document-2"><a href="dom.html#document">Document</a></code> after it has been reset using <code id="environment-settings-objects:dom-document-open"><a href="dynamic-markup-insertion.html#dom-document-open">document.open()</a></code>.</p>

    <p>If the <a href="#responsible-event-loop" id="environment-settings-objects:responsible-event-loop">responsible event loop</a> is not a <a href="#window-event-loop" id="environment-settings-objects:window-event-loop">window event loop</a>, then the <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-2">environment settings object</a> has no <a href="#responsible-document" id="environment-settings-objects:responsible-document-2">responsible document</a>.</p>
   <dt>An <dfn data-dfn-for="environment settings object" id="api-url-character-encoding" data-export="">API URL character encoding</dfn><dd><p>A character encoding used to encode URLs by APIs called by scripts that use this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-3">environment settings object</a>.</p>
   <dt>An <dfn data-dfn-for="environment settings object" id="api-base-url" data-export="">API base URL</dfn><dd><p>A <a id="environment-settings-objects:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> used by APIs called by scripts that use this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-4">environment settings object</a> to <a href="urls-and-fetching.html#parse-a-url" id="environment-settings-objects:parse-a-url">parse URLs</a>.</p>
   <dt>An <dfn data-dfn-for="environment
   settings object" id="concept-settings-object-origin" data-export="">origin</dfn><dd><p>An <a id="environment-settings-objects:concept-origin" href="origin.html#concept-origin">origin</a> used in security checks.</p>
   <dt>A <dfn data-dfn-for="environment settings object" id="concept-settings-object-referrer-policy" data-export="">referrer policy</dfn><dd><p>The default <a id="environment-settings-objects:referrer-policy" href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#referrer-policy" data-x-internal="referrer-policy">referrer policy</a> for <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="environment-settings-objects:concept-fetch" data-x-internal="concept-fetch">fetches</a> performed using this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-5">environment settings object</a> as a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="environment-settings-objects:concept-request-client" data-x-internal="concept-request-client">request client</a>. <a href="references.html#refsREFERRERPOLICY">[REFERRERPOLICY]</a><dt>An <dfn data-dfn-for="environment settings object" id="concept-settings-object-embedder-policy" data-export="">embedder policy</dfn><dd><p>An <a id="environment-settings-objects:embedder-policy" href="origin.html#embedder-policy">embedder policy</a> used by <a href="https://triple-underscore.github.io/Fetch-ja.html#cross-origin-resource-policy-check" id="environment-settings-objects:cross-origin-resource-policy-check" data-x-internal="cross-origin-resource-policy-check">cross-origin resource policy checks</a> for <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="environment-settings-objects:concept-fetch-2" data-x-internal="concept-fetch">fetches</a> performed using this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-6">environment settings object</a> as a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="environment-settings-objects:concept-request-client-2" data-x-internal="concept-request-client">request client</a>.<dt>A <dfn data-dfn-for="environment settings object" id="concept-settings-object-cross-origin-isolated-capability" data-export="">cross-origin isolated capability</dfn><dd><p>A boolean representing whether scripts that use this <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-7">environment settings object</a> are allowed to use APIs that require cross-origin isolation.</dl>

  <p>An <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-8">environment settings object</a> also has an <dfn id="outstanding-rejected-promises-weak-set">outstanding rejected promises weak set</dfn> and an <dfn id="about-to-be-notified-rejected-promises-list">about-to-be-notified rejected promises list</dfn>, used to track <a href="#unhandled-promise-rejections">unhandled promise rejections</a>. The <a href="#outstanding-rejected-promises-weak-set" id="environment-settings-objects:outstanding-rejected-promises-weak-set">outstanding rejected promises weak set</a> must not create strong references to any of its members, and implementations are free to limit its size, e.g. by removing old entries from it when new ones are added.</p>

  <p>An <a href="#environment-settings-object" id="environment-settings-objects:environment-settings-object-9">environment settings object</a>'s <dfn data-dfn-for="environment
  settings object" id="responsible-event-loop" data-export="">responsible event loop</dfn> is its <a href="#concept-settings-object-global" id="environment-settings-objects:concept-settings-object-global">global object</a>'s <a href="#relevant-agent" id="environment-settings-objects:relevant-agent">relevant agent</a>'s <a href="#concept-agent-event-loop" id="environment-settings-objects:concept-agent-event-loop">event loop</a>.</p>

  <h5 id="realms-settings-objects-global-objects"><span class="secno">8.1.3.3</span> Realms, settings objects, and global objects<a href="#realms-settings-objects-global-objects" class="self-link"></a></h5>

  <p>A <dfn id="global-object" data-export="">global object</dfn> is a JavaScript object that is the [[GlobalObject]] field of a <a id="realms-settings-objects-global-objects:javascript-realm" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>.</p>

  <p class="note">In this specification, all <a href="https://tc39.es/ecma262/#sec-code-realms" id="realms-settings-objects-global-objects:javascript-realm-2" data-x-internal="javascript-realm">JavaScript realms</a> are <a href="#creating-a-new-javascript-realm" id="realms-settings-objects-global-objects:creating-a-new-javascript-realm">created</a> with <a href="#global-object" id="realms-settings-objects-global-objects:global-object">global objects</a> that are either <code id="realms-settings-objects-global-objects:window"><a href="window-object.html#window">Window</a></code> or <code id="realms-settings-objects-global-objects:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> objects.</p>

  <p>There is always a 1-to-1-to-1 mapping between <a href="https://tc39.es/ecma262/#sec-code-realms" id="realms-settings-objects-global-objects:javascript-realm-3" data-x-internal="javascript-realm">JavaScript realms</a>, <a href="#global-object" id="realms-settings-objects-global-objects:global-object-2">global objects</a>, and <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object">environment settings objects</a>:</p>

  <ul><li><p>A <a id="realms-settings-objects-global-objects:javascript-realm-4" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a> has a [[HostDefined]] field, which contains <dfn data-dfn-for="Realm" id="concept-realm-settings-object" data-lt="settings object" data-export="">the Realm's settings object</dfn>.<li><p>A <a id="realms-settings-objects-global-objects:javascript-realm-5" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a> has a [[GlobalObject]] field, which contains <dfn data-dfn-for="Realm" id="concept-realm-global" data-lt="global object" data-export="">the Realm's global object</dfn>.<li><p>Each <a href="#global-object" id="realms-settings-objects-global-objects:global-object-3">global object</a> in this specification is created during the <a href="#creating-a-new-javascript-realm" id="realms-settings-objects-global-objects:creating-a-new-javascript-realm-2">creation</a> of a corresponding <a id="realms-settings-objects-global-objects:javascript-realm-6" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>, known as <dfn data-dfn-for="global object" id="concept-global-object-realm" data-lt="Realm" data-export="">the global object's Realm</dfn>.<li id="relevant-settings-object-for-a-global-object"><p>Each <a href="#global-object" id="realms-settings-objects-global-objects:global-object-4">global object</a> in this specification is created alongside a corresponding <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object-2">environment settings object</a>, known as its <a href="#relevant-settings-object" id="realms-settings-objects-global-objects:relevant-settings-object">relevant settings object</a>.</p>

   <li><p>An <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object-3">environment settings object</a>'s <a href="#realm-execution-context" id="realms-settings-objects-global-objects:realm-execution-context">realm execution context</a>'s Realm component is <dfn data-dfn-for="environment settings object" id="environment-settings-object's-realm" data-lt="Realm" data-export="">the environment settings object's Realm</dfn>.<li><p>An <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object-4">environment settings object</a>'s <a href="#environment-settings-object's-realm" id="realms-settings-objects-global-objects:environment-settings-object's-realm">Realm</a> then has a [[GlobalObject]] field, which contains <dfn data-dfn-for="environment
   settings object" id="concept-settings-object-global" data-lt="global object" data-export="">the environment settings object's global object</dfn>.</ul>

  <p>To <dfn id="creating-a-new-javascript-realm" data-export="">create a new JavaScript realm</dfn> in an <a id="realms-settings-objects-global-objects:agent" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> <var>agent</var>, optionally with instructions to create a global object or a global <b>this</b> binding (or both), the following steps are taken:</p>

  <ol><li><p>Perform <a href="https://tc39.es/ecma262/#sec-initializehostdefinedrealm" id="realms-settings-objects-global-objects:js-initializehostdefinedrealm" data-x-internal="js-initializehostdefinedrealm">InitializeHostDefinedRealm</a>() with the provided customizations for creating the global object and the global <b>this</b> binding.<li><p>Let <var>realm execution context</var> be the <a id="realms-settings-objects-global-objects:running-javascript-execution-context" href="https://tc39.es/ecma262/#running-execution-context" data-x-internal="running-javascript-execution-context">running JavaScript execution context</a>.</p>

    <p class="note">This is the <a id="realms-settings-objects-global-objects:javascript-execution-context" href="https://tc39.es/ecma262/#sec-execution-contexts" data-x-internal="javascript-execution-context">JavaScript execution context</a> created in the previous step.</p>
   <li><p>Remove <var>realm execution context</var> from the <a id="realms-settings-objects-global-objects:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>Let <var>realm</var> be <var>realm execution context</var>'s Realm component.<li><p>Set <var>realm</var>'s agent to <var>agent</var>. <span class="XXX">This pointer is not yet defined in the JavaScript specification; see <a href="https://github.com/tc39/ecma262/issues/1357">tc39/ecma262#1357</a>.</span><li><p>If <var>agent</var>'s <a id="realms-settings-objects-global-objects:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>'s <a href="#cross-origin-isolated" id="realms-settings-objects-global-objects:cross-origin-isolated">cross-origin isolated</a> is false, then:</p>

    <ol><li><p>Let <var>global</var> be <var>realm</var>'s <a href="#concept-realm-global" id="realms-settings-objects-global-objects:concept-realm-global">global object</a>.<li><p>Let <var>status</var> be ! <var>global</var>.[[Delete]]("<code>SharedArrayBuffer</code>").<li><p>Assert: <var>status</var> is true.</ol>

    <p class="note">This is done for compatibility with web content and there is some hope that this can be removed in the future. Web developers can still get at the constructor through <code class="js">new WebAssembly.Memory({ shared:true, initial:0, maximum:0 }).buffer.constructor</code>.</p>
   <li><p>Return <var>realm execution context</var>.</ol>

  <hr>

  <p>When defining algorithm steps throughout this specification, it is often important to indicate what <a id="realms-settings-objects-global-objects:javascript-realm-7" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a> is to be used—or, equivalently, what <a href="#global-object" id="realms-settings-objects-global-objects:global-object-5">global object</a> or <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object-5">environment settings object</a> is to be used. In general, there are at least four possibilities:</p>

  <dl><dt><dfn id="concept-entry-everything">Entry</dfn><dd>This corresponds to the script that initiated the currently running script action: i.e., the function or script that the user agent called into when it called into author code.<dt><dfn id="concept-incumbent-everything">Incumbent</dfn><dd>This corresponds to the most-recently-entered author function or script on the stack, or the author function or script that originally scheduled the currently-running callback.<dt><dfn id="concept-current-everything">Current</dfn><dd>This corresponds to the currently-running function object, including built-in user-agent functions which might not be implemented as JavaScript. (It is derived from the <a href="https://tc39.es/ecma262/#current-realm" id="realms-settings-objects-global-objects:current-realm-record" data-x-internal="current-realm-record">current JavaScript realm</a>.)<dt><dfn id="concept-relevant-everything">Relevant</dfn><dd>Every <a id="realms-settings-objects-global-objects:platform-object" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> has a <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm">relevant Realm</a>, which is roughly the <a id="realms-settings-objects-global-objects:javascript-realm-8" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a> in which it was created. When writing algorithms, the most prominent <a id="realms-settings-objects-global-objects:platform-object-2" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> whose <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm-2">relevant Realm</a> might be important is the <b>this</b> value of the currently-running function object. In some cases, there can be other important <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm-3">relevant Realms</a>, such as those of any arguments.</dl>

  <p>Note how the <a href="#concept-entry-everything" id="realms-settings-objects-global-objects:concept-entry-everything">entry</a>, <a href="#concept-incumbent-everything" id="realms-settings-objects-global-objects:concept-incumbent-everything">incumbent</a>, and <a href="#concept-current-everything" id="realms-settings-objects-global-objects:concept-current-everything">current</a> concepts are usable without qualification, whereas the <a href="#concept-relevant-everything" id="realms-settings-objects-global-objects:concept-relevant-everything">relevant</a> concept must be applied to a particular <a id="realms-settings-objects-global-objects:platform-object-3" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a>.</p>

  <p class="warning">The <a href="#concept-incumbent-everything" id="realms-settings-objects-global-objects:concept-incumbent-everything-2">incumbent</a> and <a href="#concept-entry-everything" id="realms-settings-objects-global-objects:concept-entry-everything-2">entry</a> concepts should not be used by new specifications, as they are excessively complicated and unintuitive to work with. We are working to remove almost all existing uses from the platform: see <a href="https://github.com/whatwg/html/issues/1430">issue #1430</a> for <a href="#concept-incumbent-everything" id="realms-settings-objects-global-objects:concept-incumbent-everything-3">incumbent</a>, and <a href="https://github.com/whatwg/html/issues/1431">issue #1431</a> for <a href="#concept-entry-everything" id="realms-settings-objects-global-objects:concept-entry-everything-3">entry</a>.</p>

  <p>In general, web platform specifications should use the <a href="#concept-relevant-everything" id="realms-settings-objects-global-objects:concept-relevant-everything-2">relevant</a> concept, applied to the object being operated on (usually the <b>this</b> value of the current method). This mismatches the JavaScript specification, where <a href="#concept-current-everything" id="realms-settings-objects-global-objects:concept-current-everything-2">current</a> is generally used as the default (e.g. in determining the <a id="realms-settings-objects-global-objects:javascript-realm-9" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a> whose <code>Array</code> constructor should be used to construct the result in <code>Array.prototype.map</code>). But this inconsistency is so embedded in the platform that we have to accept it going forward.</p>

  <div class="example"><p>Consider the following pages, with <code>a.html</code> being loaded in a browser window, <code>b.html</code> being loaded in an <code id="realms-settings-objects-global-objects:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> as shown, and <code>c.html</code> and <code>d.html</code> omitted (they can simply be empty documents):</p>

   <pre><code class='html'><c- c>&lt;!-- a.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Entry page<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"b.html"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>button</c-> <c- e>onclick</c-><c- o>=</c-><c- s>"frames[0].hello()"</c-><c- p>></c->Hello<c- p>&lt;/</c-><c- f>button</c-><c- p>></c->

<c- c>&lt;!--b.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Incumbent page<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"c.html"</c-> <c- e>id</c-><c- o>=</c-><c- s>"c"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"d.html"</c-> <c- e>id</c-><c- o>=</c-><c- s>"d"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- kr>const</c-> c <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"#c"</c-><c- p>).</c->contentWindow<c- p>;</c->
  <c- kr>const</c-> d <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"#d"</c-><c- p>).</c->contentWindow<c- p>;</c->

  window<c- p>.</c->hello <c- o>=</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
    c<c- p>.</c->print<c- p>.</c->call<c- p>(</c->d<c- p>);</c->
  <c- p>};</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>Each page has its own <a id="realms-settings-objects-global-objects:browsing-context" href="browsers.html#browsing-context">browsing context</a>, and thus its own <a id="realms-settings-objects-global-objects:javascript-realm-10" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>, <a href="#global-object" id="realms-settings-objects-global-objects:global-object-6">global object</a>, and <a href="#environment-settings-object" id="realms-settings-objects-global-objects:environment-settings-object-6">environment settings object</a>.</p>

   <p>When the <code id="realms-settings-objects-global-objects:dom-print"><a href="timers-and-user-prompts.html#dom-print">print()</a></code> method is called in response to pressing the button in <code>a.html</code>, then:</p>

   <ul><li><p>The <a href="#concept-entry-realm" id="realms-settings-objects-global-objects:concept-entry-realm">entry Realm</a> is that of <code>a.html</code>.<li><p>The <a href="#concept-incumbent-realm" id="realms-settings-objects-global-objects:concept-incumbent-realm">incumbent Realm</a> is that of <code>b.html</code>.<li><p>The <a href="https://tc39.es/ecma262/#current-realm" id="realms-settings-objects-global-objects:current-realm-record-2" data-x-internal="current-realm-record">current Realm</a> is that of <code>c.html</code> (since it is the <code id="realms-settings-objects-global-objects:dom-print-2"><a href="timers-and-user-prompts.html#dom-print">print()</a></code> method from <code>c.html</code> whose code is running).<li><p>The <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm-4">relevant Realm</a> of the object on which the <code id="realms-settings-objects-global-objects:dom-print-3"><a href="timers-and-user-prompts.html#dom-print">print()</a></code> method is being called is that of <code>d.html</code>.</ul>
  </div>

  <div class="example"><p>One reason why the <a href="#concept-relevant-everything" id="realms-settings-objects-global-objects:concept-relevant-everything-3">relevant</a> concept is generally a better default choice than the <a href="#concept-current-everything" id="realms-settings-objects-global-objects:concept-current-everything-3">current</a> concept is that it is more suitable for creating an object that is to be persisted and returned multiple times. For example, the <code id="realms-settings-objects-global-objects:dom-navigator-getbattery"><a data-x-internal="dom-navigator-getbattery" href="https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager">navigator.getBattery()</a></code> method creates promises in the <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm-5">relevant Realm</a> for the <code id="realms-settings-objects-global-objects:navigator"><a href="system-state.html#navigator">Navigator</a></code> object on which it is invoked. This has the following impact: <a href="references.html#refsBATTERY">[BATTERY]</a><pre><code class='html'><c- c>&lt;!-- outer.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Relevant Realm demo: outer page<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>function</c-> doTest<c- p>()</c-> <c- p>{</c->
    <c- kr>const</c-> promise <c- o>=</c-> navigator<c- p>.</c->getBattery<c- p>.</c->call<c- p>(</c->frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->navigator<c- p>);</c->

    console<c- p>.</c->log<c- p>(</c->promise <c- k>instanceof</c-> Promise<c- p>);</c->           <c- c1>// logs false</c->
    console<c- p>.</c->log<c- p>(</c->promise <c- k>instanceof</c-> frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->Promise<c- p>);</c-> <c- c1>// logs true</c->

    frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->hello<c- p>();</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"inner.html"</c-> <c- e>onload</c-><c- o>=</c-><c- s>"doTest()"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->

<c- c>&lt;!-- inner.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Relevant Realm demo: inner page<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- a>function</c-> hello<c- p>()</c-> <c- p>{</c->
    <c- kr>const</c-> promise <c- o>=</c-> navigator<c- p>.</c->getBattery<c- p>();</c->

    console<c- p>.</c->log<c- p>(</c->promise <c- k>instanceof</c-> Promise<c- p>);</c->        <c- c1>// logs true</c->
    console<c- p>.</c->log<c- p>(</c->promise <c- k>instanceof</c-> parent<c- p>.</c->Promise<c- p>);</c-> <c- c1>// logs false</c->
  <c- p>}</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>If the algorithm for the <code id="realms-settings-objects-global-objects:dom-navigator-getbattery-2"><a data-x-internal="dom-navigator-getbattery" href="https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager">getBattery()</a></code> method had instead used the <a href="https://tc39.es/ecma262/#current-realm" id="realms-settings-objects-global-objects:current-realm-record-3" data-x-internal="current-realm-record">current Realm</a>, all the results would be reversed. That is, after the first call to <code id="realms-settings-objects-global-objects:dom-navigator-getbattery-3"><a data-x-internal="dom-navigator-getbattery" href="https://w3c.github.io/battery/#widl-Navigator-getBattery-Promise-BatteryManager">getBattery()</a></code> in <code>outer.html</code>, the <code id="realms-settings-objects-global-objects:navigator-2"><a href="system-state.html#navigator">Navigator</a></code> object in <code>inner.html</code> would be permanently storing a <code>Promise</code> object created in <code>outer.html</code>'s <a id="realms-settings-objects-global-objects:javascript-realm-11" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>, and calls like that inside the <code>hello()</code> function would thus return a promise from the "wrong" realm. Since this is undesirable, the algorithm instead uses the <a href="#concept-relevant-realm" id="realms-settings-objects-global-objects:concept-relevant-realm-6">relevant Realm</a>, giving the sensible results indicated in the comments above.</p>
  </div>

  <hr>

  <p>The rest of this section deals with formally defining the <a href="#concept-entry-everything" id="realms-settings-objects-global-objects:concept-entry-everything-4">entry</a>, <a href="#concept-incumbent-everything" id="realms-settings-objects-global-objects:concept-incumbent-everything-4">incumbent</a>, <a href="#concept-current-everything" id="realms-settings-objects-global-objects:concept-current-everything-4">current</a>, and <a href="#concept-relevant-everything" id="realms-settings-objects-global-objects:concept-relevant-everything-4">relevant</a> concepts.</p>

  <h6 id="entry"><span class="secno">8.1.3.3.1</span> Entry<a href="#entry" class="self-link"></a></h6>

  <p>The process of <a href="#calling-scripts">calling scripts</a> will push or pop <a href="#realm-execution-context" id="entry:realm-execution-context">realm execution contexts</a> onto the <a id="entry:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>, interspersed with other <a href="https://tc39.es/ecma262/#sec-execution-contexts" id="entry:javascript-execution-context" data-x-internal="javascript-execution-context">execution contexts</a>.</p>

  <p>With this in hand, we define the <dfn id="entry-execution-context">entry execution context</dfn> to be the most recently pushed item in the <a id="entry:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> that is a <a href="#realm-execution-context" id="entry:realm-execution-context-2">realm execution context</a>. The <dfn id="concept-entry-realm">entry Realm</dfn> is the <a href="#entry-execution-context" id="entry:entry-execution-context">entry execution context</a>'s Realm component.</p>

  <p>Then, the <dfn id="entry-settings-object">entry settings object</dfn> is the <a href="#concept-realm-settings-object" id="entry:concept-realm-settings-object">environment settings object</a> of the <a href="#concept-entry-realm" id="entry:concept-entry-realm">entry Realm</a>.</p>

  <p>Similarly, the <dfn id="entry-global-object">entry global object</dfn> is the <a href="#concept-realm-global" id="entry:concept-realm-global">global object</a> of the <a href="#concept-entry-realm" id="entry:concept-entry-realm-2">entry Realm</a>.</p>

  <h6 id="incumbent"><span class="secno">8.1.3.3.2</span> Incumbent<a href="#incumbent" class="self-link"></a></h6>

  <p>All <a href="https://tc39.es/ecma262/#sec-execution-contexts" id="incumbent:javascript-execution-context" data-x-internal="javascript-execution-context">JavaScript execution contexts</a> must contain, as part of their code evaluation state, a <dfn id="skip-when-determining-incumbent-counter">skip-when-determining-incumbent counter</dfn> value, which is initially zero. In the process of <a href="#prepare-to-run-a-callback" id="incumbent:prepare-to-run-a-callback">preparing to run a callback</a> and <a href="#clean-up-after-running-a-callback" id="incumbent:clean-up-after-running-a-callback">cleaning up after running a callback</a>, this value will be incremented and decremented.</p>

  <p>Every <a href="#event-loop" id="incumbent:event-loop">event loop</a> has an associated <dfn id="backup-incumbent-settings-object-stack">backup incumbent settings object stack</dfn>, initially empty. Roughly speaking, it is used to determine the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object">incumbent settings object</a> when no author code is on the stack, but author code is responsible for the current algorithm having been run in some way. The process of <a href="#prepare-to-run-a-callback" id="incumbent:prepare-to-run-a-callback-2">preparing to run a callback</a> and <a href="#clean-up-after-running-a-callback" id="incumbent:clean-up-after-running-a-callback-2">cleaning up after running a callback</a> manipulate this stack. <a href="references.html#refsWEBIDL">[WEBIDL]</a></p>

  <p>When Web IDL is used to <a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="incumbent:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">invoke</a> author code, or when <a href="#hostenqueuepromisejob" id="incumbent:hostenqueuepromisejob">HostEnqueuePromiseJob</a> invokes a promise job, they use the following algorithms to track relevant data for determining the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-2">incumbent settings object</a>:</p>

  <p>To <dfn id="prepare-to-run-a-callback" data-export="">prepare to run a callback</dfn> with an <a href="#environment-settings-object" id="incumbent:environment-settings-object">environment settings object</a> <var>settings</var>:</p>

  <ol><li><p>Push <var>settings</var> onto the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack">backup incumbent settings object stack</a>.<li><p>Let <var>context</var> be the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context">topmost script-having execution context</a>.<li><p>If <var>context</var> is not null, increment <var>context</var>'s <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter">skip-when-determining-incumbent counter</a>.</ol>

  <p>To <dfn id="clean-up-after-running-a-callback" data-export="">clean up after running a callback</dfn> with an <a href="#environment-settings-object" id="incumbent:environment-settings-object-2">environment settings object</a> <var>settings</var>:</p>

  <ol><li><p>Let <var>context</var> be the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-2">topmost script-having execution context</a>.</p>

    <p class="note">This will be the same as the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-3">topmost script-having execution context</a> inside the corresponding invocation of <a href="#prepare-to-run-a-callback" id="incumbent:prepare-to-run-a-callback-3">prepare to run a callback</a>.</p>
   <li><p>If <var>context</var> is not null, decrement <var>context</var>'s <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-2">skip-when-determining-incumbent counter</a>.<li><p>Assert: the topmost entry of the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-2">backup incumbent settings object stack</a> is <var>settings</var>.<li><p>Remove <var>settings</var> from the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-3">backup incumbent settings object stack</a>.</ol>

  <p>Here, the <dfn id="topmost-script-having-execution-context">topmost script-having execution context</dfn> is the topmost entry of the <a id="incumbent:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> that has a non-null ScriptOrModule component, or null if there is no such entry in the <a id="incumbent:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.</p>

  <p>With all this in place, the <dfn id="incumbent-settings-object" data-export="">incumbent settings object</dfn> is determined as follows:</p>

  <ol><li><p>Let <var>context</var> be the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-4">topmost script-having execution context</a>.<li><p>If <var>context</var> is null, or if <var>context</var>'s <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-3">skip-when-determining-incumbent counter</a> is greater than zero, then:</p>

    <ol><li><p>Assert: the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-4">backup incumbent settings object stack</a> is not empty.</p>

      <p class="note">This assert would fail if you try to obtain the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-3">incumbent settings object</a> from inside an algorithm that was triggered neither by <a href="#calling-scripts">calling scripts</a> nor by Web IDL <a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="incumbent:es-invoking-callback-functions-2" data-x-internal="es-invoking-callback-functions">invoking</a> a callback. For example, it would trigger if you tried to obtain the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-4">incumbent settings object</a> inside an algorithm that ran periodically as part of the <a href="#event-loop" id="incumbent:event-loop-2">event loop</a>, with no involvement of author code. In such cases the <a href="#concept-incumbent-everything" id="incumbent:concept-incumbent-everything">incumbent</a> concept cannot be used.</p>
     <li><p>Return the topmost entry of the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-5">backup incumbent settings object stack</a>.</ol>
   <li><p>Return <var>context</var>'s Realm component's <a href="#concept-realm-settings-object" id="incumbent:concept-realm-settings-object">settings object</a>.</ol>

  <p>Then, the <dfn id="concept-incumbent-realm">incumbent Realm</dfn> is the <a href="#environment-settings-object's-realm" id="incumbent:environment-settings-object's-realm">Realm</a> of the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-5">incumbent settings object</a>.</p>

  <p>Similarly, the <dfn id="concept-incumbent-global">incumbent global object</dfn> is the <a href="#concept-settings-object-global" id="incumbent:concept-settings-object-global">global object</a> of the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-6">incumbent settings object</a>.</p>

  <hr>

  <p>The following series of examples is intended to make it clear how all of the different mechanisms contribute to the definition of the <a href="#incumbent">incumbent</a> concept:</p>

  <div id="example-incumbent-1" class="example"><p>Consider the following starter example:</p>

   <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>iframe</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->postMessage<c- p>(</c-><c- u>"some data"</c-><c- p>,</c-> <c- u>"*"</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>There are two interesting <a href="#environment-settings-object" id="incumbent:environment-settings-object-3">environment settings objects</a> here: that of <code>window</code>, and that of <code>frames[0]</code>. Our concern is: what is the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-7">incumbent settings object</a> at the time that the algorithm for <code id="incumbent:dom-window-postmessage"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code> executes?</p>

   <p>It should be that of <code>window</code>, to capture the intuitive notion that the author script responsible for causing the algorithm to happen is executing in <code>window</code>, not <code>frames[0]</code>. This makes sense: the <a id="incumbent:window-post-message-steps" href="web-messaging.html#window-post-message-steps">window post message steps</a> use the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-8">incumbent settings object</a> to determine the <code id="incumbent:dom-messageevent-source"><a href="comms.html#dom-messageevent-source">source</a></code> property of the resulting <code id="incumbent:messageevent"><a href="comms.html#messageevent">MessageEvent</a></code>, and in this case <code>window</code> is definitely the source of the message.</p>

   <p>Let us now explain how the steps given above give us our intuitively-desired result of <code>window</code>'s <a href="#relevant-settings-object" id="incumbent:relevant-settings-object">relevant settings object</a>.</p>

   <p>When the <a id="incumbent:window-post-message-steps-2" href="web-messaging.html#window-post-message-steps">window post message steps</a> look up the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-9">incumbent settings object</a>, the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-5">topmost script-having execution context</a> will be that corresponding to the <code id="incumbent:the-script-element"><a href="scripting.html#the-script-element">script</a></code> element: it was pushed onto the <a id="incumbent:javascript-execution-context-stack-3" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> as part of <a href="https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation" id="incumbent:js-scriptevaluation" data-x-internal="js-scriptevaluation">ScriptEvaluation</a> during the <a href="#run-a-classic-script" id="incumbent:run-a-classic-script">run a classic script</a> algorithm. Since there are no Web IDL callback invocations involved, the context's <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-4">skip-when-determining-incumbent counter</a> is zero, so it is used to determine the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-10">incumbent settings object</a>; the result is the <a href="#environment-settings-object" id="incumbent:environment-settings-object-4">environment settings object</a> of <code>window</code>.</p>

   <p>(Note how the <a href="#environment-settings-object" id="incumbent:environment-settings-object-5">environment settings object</a> of <code>frames[0]</code> is the <a href="#relevant-settings-object" id="incumbent:relevant-settings-object-2">relevant settings object</a> of <a id="incumbent:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> at the time the <code id="incumbent:dom-window-postmessage-2"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code> method is called, and thus is involved in determining the <em>target</em> of the message. Whereas the incumbent is used to determine the <em>source</em>.)</div>

  <div id="example-incumbent-2" class="example"><p>Consider the following more complicated example:</p>

   <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>iframe</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- kr>const</c-> bound <c- o>=</c-> frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->postMessage<c- p>.</c->bind<c- p>(</c->frames<c- p>[</c-><c- mi>0</c-><c- p>],</c-> <c- u>"some data"</c-><c- p>,</c-> <c- u>"*"</c-><c- p>);</c->
  window<c- p>.</c->setTimeout<c- p>(</c->bound<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>This example is very similar to the previous one, but with an extra indirection through <code>Function.prototype.bind</code> as well as <code id="incumbent:dom-settimeout"><a href="timers-and-user-prompts.html#dom-settimeout">setTimeout()</a></code>. But, the answer should be the same: invoking algorithms asynchronously should not change the <a href="#concept-incumbent-everything" id="incumbent:concept-incumbent-everything-2">incumbent</a> concept.</p>

   <p>This time, the result involves more complicated mechanisms:</p>

   <p>When <code>bound</code> is <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="incumbent:concept-idl-convert" data-x-internal="concept-idl-convert">converted</a> to a Web IDL callback type, the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-11">incumbent settings object</a> is that corresponding to <code>window</code> (in the same manner as in our starter example above). Web IDL stores this as the resulting callback value's <a id="incumbent:callback-context" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a>.</p>

   <p>When the <a href="#concept-task" id="incumbent:concept-task">task</a> posted by <code id="incumbent:dom-settimeout-2"><a href="timers-and-user-prompts.html#dom-settimeout">setTimeout()</a></code> executes, the algorithm for that task uses Web IDL to <a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="incumbent:es-invoking-callback-functions-3" data-x-internal="es-invoking-callback-functions">invoke</a> the stored callback value. Web IDL in turn calls the above <a href="#prepare-to-run-a-callback" id="incumbent:prepare-to-run-a-callback-4">prepare to run a callback</a> algorithm. This pushes the stored <a id="incumbent:callback-context-2" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a> onto the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-6">backup incumbent settings object stack</a>. At this time (inside the timer task) there is no author code on the stack, so the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-6">topmost script-having execution context</a> is null, and nothing gets its <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-5">skip-when-determining-incumbent counter</a> incremented.</p>

   <p>Invoking the callback then calls <code>bound</code>, which in turn calls the <code id="incumbent:dom-window-postmessage-3"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code> method of <code>frames[0]</code>. When the <code id="incumbent:dom-window-postmessage-4"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code> algorithm looks up the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-12">incumbent settings object</a>, there is still no author code on the stack, since the bound function just directly calls the built-in method. So the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-7">topmost script-having execution context</a> will be null: the <a id="incumbent:javascript-execution-context-2" href="https://tc39.es/ecma262/#sec-execution-contexts" data-x-internal="javascript-execution-context">JavaScript execution context</a> stack only contains an execution context corresponding to <code id="incumbent:dom-window-postmessage-5"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code>, with no <a href="https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation" id="incumbent:js-scriptevaluation-2" data-x-internal="js-scriptevaluation">ScriptEvaluation</a> context or similar below it.</p>

   <p>This is where we fall back to the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-7">backup incumbent settings object stack</a>. As noted above, it will contain as its topmost entry the <a href="#relevant-settings-object" id="incumbent:relevant-settings-object-3">relevant settings object</a> of <code>window</code>. So that is what is used as the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-13">incumbent settings object</a> while executing the <code id="incumbent:dom-window-postmessage-6"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code> algorithm.</p>
  </div>

  <div id="example-incumbent-3" class="example"><p>Consider this final, even more convoluted example:</p>

   <pre><code class='html'><c- c>&lt;!-- a.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>button</c-><c- p>></c->click me<c- p>&lt;/</c-><c- f>button</c-><c- p>></c->
<c- p>&lt;</c-><c- f>iframe</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- kr>const</c-> bound <c- o>=</c-> frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->location<c- p>.</c->assign<c- p>.</c->bind<c- p>(</c->frames<c- p>[</c-><c- mi>0</c-><c- p>].</c->location<c- p>,</c-> <c- u>"https://example.com/"</c-><c- p>);</c->
document<c- p>.</c->querySelector<c- p>(</c-><c- u>"button"</c-><c- p>).</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> bound<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <pre><code class='html'><c- c>&lt;!-- b.html --></c->
<c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>iframe</c-> <c- e>src</c-><c- o>=</c-><c- s>"a.html"</c-><c- p>>&lt;/</c-><c- f>iframe</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- kr>const</c-> iframe <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"iframe"</c-><c- p>);</c->
  iframe<c- p>.</c->onload <c- o>=</c-> <c- a>function</c-> onLoad<c- p>()</c-> <c- p>{</c->
    iframe<c- p>.</c->contentWindow<c- p>.</c->document<c- p>.</c->querySelector<c- p>(</c-><c- u>"button"</c-><c- p>).</c->click<c- p>();</c->
  <c- p>};</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>Again there are two interesting <a href="#environment-settings-object" id="incumbent:environment-settings-object-6">environment settings objects</a> in play: that of <code>a.html</code>, and that of <code>b.html</code>. When the <code id="incumbent:dom-location-assign"><a href="history.html#dom-location-assign">location.assign()</a></code> method triggers the <a id="incumbent:location-object-navigate" href="history.html#location-object-navigate"><code>Location</code>-object navigate</a> algorithm, what will be the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-14">incumbent settings object</a>? As before, it should intuitively be that of <code>a.html</code>: the <code id="incumbent:event-click"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code> listener was originally scheduled by <code>a.html</code>, so even if something involving <code>b.html</code> causes the listener to fire, the <a href="#concept-incumbent-everything" id="incumbent:concept-incumbent-everything-3">incumbent</a> responsible is that of <code>a.html</code>.</p>

   <p>The callback setup is similar to the previous example: when <code>bound</code> is <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="incumbent:concept-idl-convert-2" data-x-internal="concept-idl-convert">converted</a> to a Web IDL callback type, the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-15">incumbent settings object</a> is that corresponding to <code>a.html</code>, which is stored as the callback's <a id="incumbent:callback-context-3" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a>.</p>

   <p>When the <code id="incumbent:dom-click"><a href="interaction.html#dom-click">click()</a></code> method is called inside <code>b.html</code>, it <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-dispatch" id="incumbent:concept-event-dispatch" data-x-internal="concept-event-dispatch">dispatches</a> a <code id="incumbent:event-click-2"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code> event on the button that is inside <code>a.html</code>. This time, when the <a href="#prepare-to-run-a-callback" id="incumbent:prepare-to-run-a-callback-5">prepare to run a callback</a> algorithm executes as part of event dispatch, there <em>is</em> author code on the stack; the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-8">topmost script-having execution context</a> is that of the <code>onLoad</code> function, whose <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-6">skip-when-determining-incumbent counter</a> gets incremented. Additionally, <code>a.html</code>'s <a href="#environment-settings-object" id="incumbent:environment-settings-object-7">environment settings object</a> (stored as the <code id="incumbent:eventhandler"><a href="#eventhandler">EventHandler</a></code>'s <a id="incumbent:callback-context-4" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a>) is pushed onto the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-8">backup incumbent settings object stack</a>.</p>

   <p>Now, when the <a id="incumbent:location-object-navigate-2" href="history.html#location-object-navigate"><code>Location</code>-object navigate</a> algorithm looks up the <a href="#incumbent-settings-object" id="incumbent:incumbent-settings-object-16">incumbent settings object</a>, the <a href="#topmost-script-having-execution-context" id="incumbent:topmost-script-having-execution-context-9">topmost script-having execution context</a> is still that of the <code>onLoad</code> function (due to the fact we are using a bound function as the callback). Its <a href="#skip-when-determining-incumbent-counter" id="incumbent:skip-when-determining-incumbent-counter-7">skip-when-determining-incumbent counter</a> value is one, however, so we fall back to the <a href="#backup-incumbent-settings-object-stack" id="incumbent:backup-incumbent-settings-object-stack-9">backup incumbent settings object stack</a>. This gives us the <a href="#environment-settings-object" id="incumbent:environment-settings-object-8">environment settings object</a> of <code>a.html</code>, as expected.</p>

   <p>Note that this means that even though it is the <code id="incumbent:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> inside <code>a.html</code> that navigates, it is <code>a.html</code> itself that is used as the <a id="incumbent:source-browsing-context" href="browsing-the-web.html#source-browsing-context">source browsing context</a>, which determines among other things the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="incumbent:concept-request-client" data-x-internal="concept-request-client">request client</a>. This is <a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=26603#c36">perhaps the only justifiable use of the incumbent concept on the web platform</a>; in all other cases the consequences of using it are simply confusing and we hope to one day switch them to use <a href="#concept-current-everything" id="incumbent:concept-current-everything">current</a> or <a href="#concept-relevant-everything" id="incumbent:concept-relevant-everything">relevant</a> as appropriate.</p>
  </div>

  <h6 id="current"><span class="secno">8.1.3.3.3</span> Current<a href="#current" class="self-link"></a></h6>

  <p>The JavaScript specification defines the <a id="current:current-realm-record" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a>, sometimes abbreviated to the "current Realm". <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <p>Then, the <dfn id="current-settings-object" data-export="">current settings object</dfn> is the <a href="#concept-realm-settings-object" id="current:concept-realm-settings-object">environment settings object</a> of the <a id="current:current-realm-record-2" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a>.</p>

  <p>Similarly, the <dfn id="current-global-object" data-export="">current global object</dfn> is the <a href="#concept-realm-global" id="current:concept-realm-global">global object</a> of the <a id="current:current-realm-record-3" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a>.</p>

  <h6 id="relevant"><span class="secno">8.1.3.3.4</span> Relevant<a href="#relevant" class="self-link"></a></h6>

  <p>The <dfn id="concept-relevant-realm" data-export="">relevant Realm</dfn> for a <a id="relevant:platform-object" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> is the value of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-platform-objects" id="relevant:realm-field-of-a-platform-object" data-x-internal="realm-field-of-a-platform-object">its [[Realm]] field</a>.</p>

  <p>Then, the <dfn id="relevant-settings-object" data-export="">relevant settings object</dfn> for a <a id="relevant:platform-object-2" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> <var>o</var> is the <a href="#concept-realm-settings-object" id="relevant:concept-realm-settings-object">environment settings object</a> of the <a href="#concept-relevant-realm" id="relevant:concept-relevant-realm">relevant Realm</a> for <var>o</var>.</p>

  <p>Similarly, the <dfn id="concept-relevant-global" data-export="">relevant global object</dfn> for a <a id="relevant:platform-object-3" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-platform-object" data-x-internal="platform-object">platform object</a> <var>o</var> is the <a href="#concept-realm-global" id="relevant:concept-realm-global">global object</a> of the <a href="#concept-relevant-realm" id="relevant:concept-relevant-realm-2">relevant Realm</a> for <var>o</var>.</p>

  <h5 id="enabling-and-disabling-scripting"><span class="secno">8.1.3.4</span> Enabling and disabling scripting<a href="#enabling-and-disabling-scripting" class="self-link"></a></h5>

  <p id="concept-bc-script"><dfn id="concept-environment-script">Scripting is enabled</dfn> for an <a href="#environment-settings-object" id="enabling-and-disabling-scripting:environment-settings-object">environment settings object</a> <var>settings</var> when all of the following conditions are true:</p>

  <ul><li>The user agent supports scripting.<li><a id="enabling-and-disabling-scripting:tracking-vector" title="There is a tracking vector here." href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" class="tracking-vector" data-x-internal="tracking-vector"><img width="46" alt="(This is a tracking vector.)" crossorigin="" src="https://resources.whatwg.org/tracking-vector.svg" height="64"></a> The user has not disabled scripting for <var>settings</var> at this time. (User agents may provide users with the option to disable scripting globally, or in a finer-grained manner, e.g., on a per-origin basis, down to the level of individual <a href="#environment-settings-object" id="enabling-and-disabling-scripting:environment-settings-object-2">environment settings objects</a>.)<li id="sandboxScriptBlocked">Either <var>settings</var>'s <a href="#concept-settings-object-global" id="enabling-and-disabling-scripting:concept-settings-object-global">global object</a> is not a <code id="enabling-and-disabling-scripting:window"><a href="window-object.html#window">Window</a></code> object, or <var>settings</var>'s <a href="#concept-settings-object-global" id="enabling-and-disabling-scripting:concept-settings-object-global-2">global object</a>'s <a href="window-object.html#concept-document-window" id="enabling-and-disabling-scripting:concept-document-window">associated <code>Document</code></a>'s <a id="enabling-and-disabling-scripting:active-sandboxing-flag-set" href="origin.html#active-sandboxing-flag-set">active sandboxing flag set</a> does not have its <a id="enabling-and-disabling-scripting:sandboxed-scripts-browsing-context-flag" href="origin.html#sandboxed-scripts-browsing-context-flag">sandboxed scripts browsing context flag</a> set.</ul>

  <p id="concept-bc-noscript"><dfn id="concept-environment-noscript">Scripting is disabled</dfn> for an <a href="#environment-settings-object" id="enabling-and-disabling-scripting:environment-settings-object-3">environment settings object</a> when scripting is not <a href="#concept-environment-script" id="enabling-and-disabling-scripting:concept-environment-script">enabled</a> for it, i.e., when any of the above conditions are false.</p>

  <hr>

  <p><dfn id="concept-n-script">Scripting is enabled</dfn> for a node <var>node</var> if <var>node</var>'s <a id="enabling-and-disabling-scripting:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s <a href="browsers.html#concept-document-bc" id="enabling-and-disabling-scripting:concept-document-bc">browsing context</a> is non-null, and <a href="#concept-environment-script" id="enabling-and-disabling-scripting:concept-environment-script-2">scripting is enabled</a> for <var>node</var>'s <a href="#relevant-settings-object" id="enabling-and-disabling-scripting:relevant-settings-object">relevant settings object</a>.</p>

  <p><dfn id="concept-n-noscript">Scripting is disabled</dfn> for a node when scripting is not <a href="#concept-n-script" id="enabling-and-disabling-scripting:concept-n-script">enabled</a>, i.e., when its <a id="enabling-and-disabling-scripting:node-document-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s <a href="browsers.html#concept-document-bc" id="enabling-and-disabling-scripting:concept-document-bc-2">browsing context</a> is null or when <a href="#concept-environment-noscript" id="enabling-and-disabling-scripting:concept-environment-noscript">scripting is disabled</a> for its <a href="#relevant-settings-object" id="enabling-and-disabling-scripting:relevant-settings-object-2">relevant settings object</a>.</p>

  <h5 id="secure-contexts"><span class="secno">8.1.3.5</span> Secure contexts<a href="#secure-contexts" class="self-link"></a></h5>

  <p>An <a href="#environment" id="secure-contexts:environment">environment</a> <var>environment</var> is a <dfn id="secure-context" data-lt="secure
  context|Is an environment settings object contextually secure?" data-export="">secure context</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>environment</var> is an <a href="#environment-settings-object" id="secure-contexts:environment-settings-object">environment settings object</a>, then:</p>

    <ol><li><p>Let <var>global</var> be <var>environment</var>'s <a href="#concept-settings-object-global" id="secure-contexts:concept-settings-object-global">global object</a>.<li><p>If <var>global</var> is a <code id="secure-contexts:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code>, then:<ol><li><p>If <var>global</var>'s <a id="secure-contexts:concept-WorkerGlobalScope-owner-set" href="workers.html#concept-WorkerGlobalScope-owner-set">owner set</a>[0]'s <a href="#relevant-settings-object" id="secure-contexts:relevant-settings-object">relevant settings object</a> is a <a href="#secure-context" id="secure-contexts:secure-context">secure context</a>, then return true.</p>

        <p class="note">We only need to check the 0th item since they will necessarily all be consistent.</p>
       <li><p>Return false.</ol>
     <li><p>If <var>global</var> is a <code id="secure-contexts:workletglobalscope"><a data-x-internal="workletglobalscope" href="https://drafts.css-houdini.org/worklets/#workletglobalscope">WorkletGlobalScope</a></code>, then:</p>

      <ol><li><p>If <var>global</var>'s <a href="https://drafts.css-houdini.org/worklets/#workletglobalscope-owner-document" id="secure-contexts:concept-worklet-owner-document" data-x-internal="concept-worklet-owner-document">owner document</a>'s <a href="#relevant-settings-object" id="secure-contexts:relevant-settings-object-2">relevant settings object</a> is a <a href="#secure-context" id="secure-contexts:secure-context-2">secure context</a>, then return true.<li><p>Return false.</ol>
     </ol>
   <li><p>If the result of <a id="secure-contexts:is-url-potentially-trustworthy" href="https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url" data-x-internal="is-url-potentially-trustworthy">Is url potentially trustworthy?</a> given <var>environment</var>'s <a href="#concept-environment-top-level-creation-url" id="secure-contexts:concept-environment-top-level-creation-url">top-level creation URL</a> is "<code>Potentially Trustworthy</code>", then return true.<li><p>Return false.</ol>

  <p>An <a href="#environment" id="secure-contexts:environment-2">environment</a> is a <dfn id="non-secure-context" data-export="">non-secure context</dfn> if it is not a <a href="#secure-context" id="secure-contexts:secure-context-3">secure context</a>.</p>

  

  <h4 id="scripting-processing-model"><span class="secno">8.1.4</span> <span id="processing-model-7"></span>Script processing model<a href="#scripting-processing-model" class="self-link"></a></h4>

  

  <h5 id="script-structs"><span class="secno">8.1.4.1</span> <span id="definitions-2"></span>Scripts<a href="#script-structs" class="self-link"></a></h5>

  <p>A <dfn id="concept-script" data-export="">script</dfn> is one of two possible <a href="https://triple-underscore.github.io/infra-ja.html#struct" id="script-structs:struct" data-x-internal="struct">structs</a>. All scripts have:</p>

  <dl><dt>A <dfn data-dfn-for="script" id="settings-object" data-export="">settings object</dfn><dd><p>An <a href="#environment-settings-object" id="script-structs:environment-settings-object">environment settings object</a>, containing various settings that are shared with other <a href="#concept-script" id="script-structs:concept-script">scripts</a> in the same context.<dt>A <dfn data-dfn-for="script" id="concept-script-record" data-export="">record</dfn><dd><p>Either a <a id="script-structs:script-record" href="https://tc39.es/ecma262/#sec-script-records" data-x-internal="script-record">Script Record</a>, for <a href="#classic-script" id="script-structs:classic-script">classic scripts</a>; a <a id="script-structs:source-text-module-record" href="https://tc39.es/ecma262/#sec-source-text-module-records" data-x-internal="source-text-module-record">Source Text Module Record</a>, for <a href="#module-script" id="script-structs:module-script">module scripts</a>; or null. In the former two cases, it represents a parsed script; null represents a failure parsing.<dt>A <dfn data-dfn-for="script" id="concept-script-parse-error">parse error</dfn><dd><p>A JavaScript value, which has meaning only if the <a href="#concept-script-record" id="script-structs:concept-script-record">record</a> is null, indicating that the corresponding script source text could not be parsed.</p>

    <p class="note">This value is used for internal tracking of immediate parse errors when <a href="#creating-scripts">creating scripts</a>, and is not to be used directly. Instead, consult the <a href="#concept-script-error-to-rethrow" id="script-structs:concept-script-error-to-rethrow">error to rethrow</a> when determining "what went wrong" for this script.</p>
  <dt>An <dfn data-dfn-for="script" id="concept-script-error-to-rethrow" data-export="">error to rethrow</dfn><dd><p>A JavaScript value representing an error that will prevent evaluation from succeeding. It will be re-thrown by any attempts to <a href="#calling-scripts">run</a> the script.</p>

    <p class="note">This could be the script's <a href="#concept-script-parse-error" id="script-structs:concept-script-parse-error">parse error</a>, but in the case of a <a href="#module-script" id="script-structs:module-script-2">module script</a> it could instead be the <a href="#concept-script-parse-error" id="script-structs:concept-script-parse-error-2">parse error</a> from one of its dependencies, or an error from <a href="#resolve-a-module-specifier" id="script-structs:resolve-a-module-specifier">resolve a module specifier</a>.</p>

    <p class="note">Since this exception value is provided by the JavaScript specification, we know that it is never null, so we use null to signal that no error has occurred.</p>
   <dt><dfn data-dfn-for="script" id="concept-script-script-fetch-options" data-export="">Fetch options</dfn><dd>A <a href="#script-fetch-options" id="script-structs:script-fetch-options">script fetch options</a>, containing various options related to fetching this script or <a href="#module-script" id="script-structs:module-script-3">module scripts</a> that it imports.<dt>A <dfn data-dfn-for="script" id="concept-script-base-url" data-export="">base URL</dfn><dd><p>A base <a id="script-structs:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> used for <a href="#resolve-a-module-specifier" id="script-structs:resolve-a-module-specifier-2">resolving module specifiers</a>. This will either be the URL from which the script was obtained, for external scripts, or the <a id="script-structs:document-base-url" href="urls-and-fetching.html#document-base-url">document base URL</a> of the containing document, for inline scripts.</dl>


  <p>A <dfn id="classic-script" data-export="">classic script</dfn> is a type of <a href="#concept-script" id="script-structs:concept-script-2">script</a> that has the following additional <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="script-structs:struct-item" data-x-internal="struct-item">item</a>:</p>

  <dl><dt>A <dfn id="muted-errors">muted errors</dfn> boolean<dd><p>A boolean which, if true, means that error information will not be provided for errors in this script. This is used to mute errors for cross-origin scripts, since that can leak private information.</dl>

  <p>A <dfn id="module-script" data-export="">module script</dfn> is another type of <a href="#concept-script" id="script-structs:concept-script-3">script</a>. It has no additional <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="script-structs:struct-item-2" data-x-internal="struct-item">items</a>.</p>

  <p>The <dfn id="active-script">active script</dfn> is determined by the following algorithm:</p>

  <ol><li><p>Let <var>record</var> be <a id="script-structs:getactivescriptormodule" href="https://tc39.es/ecma262/#sec-getactivescriptormodule" data-x-internal="getactivescriptormodule">GetActiveScriptOrModule</a>().<li><p>If <var>record</var> is null, return null.<li><p>Return <var>record</var>.[[HostDefined]].</ol>

  <p class="note">The <a href="#active-script" id="script-structs:active-script">active script</a> concept is so far only used by the <code id="script-structs:import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> feature, to determine the <a href="#concept-script-base-url" id="script-structs:concept-script-base-url">base URL</a> to use for resolving relative module specifiers.</p>

  <h5 id="fetching-scripts"><span class="secno">8.1.4.2</span> Fetching scripts<a href="#fetching-scripts" class="self-link"></a></h5>

  <p>This section introduces a number of algorithms for fetching scripts, taking various necessary inputs and resulting in <a href="#classic-script" id="fetching-scripts:classic-script">classic</a> or <a href="#module-script" id="fetching-scripts:module-script">module scripts</a>.</p>

  <hr>

  <p><dfn id="script-fetch-options">Script fetch options</dfn> is a <a id="fetching-scripts:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a> with the following <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="fetching-scripts:struct-item" data-x-internal="struct-item">items</a>:</p>

  <dl><dt><dfn id="concept-script-fetch-options-nonce">cryptographic nonce</dfn><dd><p>The <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata" id="fetching-scripts:concept-request-nonce-metadata" data-x-internal="concept-request-nonce-metadata">cryptographic nonce metadata</a> used for the initial fetch and for fetching any imported modules<dt><dfn id="concept-script-fetch-options-integrity">integrity metadata</dfn><dd><p>The <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-integrity-metadata" id="fetching-scripts:concept-request-integrity-metadata" data-x-internal="concept-request-integrity-metadata">integrity metadata</a> used for the initial fetch<dt><dfn id="concept-script-fetch-options-parser">parser metadata</dfn><dd><p>The <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata" id="fetching-scripts:concept-request-parser-metadata" data-x-internal="concept-request-parser-metadata">parser metadata</a> used for the initial fetch and for fetching any imported modules<dt><dfn id="concept-script-fetch-options-credentials">credentials mode</dfn><dd><p>The <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="fetching-scripts:concept-request-credentials-mode" data-x-internal="concept-request-credentials-mode">credentials mode</a> used for the initial fetch (for <a href="#module-script" id="fetching-scripts:module-script-2">module scripts</a>) and for fetching any imported modules (for both <a href="#module-script" id="fetching-scripts:module-script-3">module scripts</a> and <a href="#classic-script" id="fetching-scripts:classic-script-2">classic scripts</a>)<dt><dfn id="concept-script-fetch-options-referrer-policy">referrer policy</dfn><dd><p>The <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy" id="fetching-scripts:concept-request-referrer-policy" data-x-internal="concept-request-referrer-policy">referrer policy</a> used for the initial fetch and for fetching any imported modules</dl>

  <p class="note">Recall that via the <code id="fetching-scripts:import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> feature, <a href="#classic-script" id="fetching-scripts:classic-script-3">classic scripts</a> can import <a href="#module-script" id="fetching-scripts:module-script-4">module scripts</a>.</p>

  <p>The <dfn id="default-classic-script-fetch-options">default classic script fetch options</dfn> are a <a href="#script-fetch-options" id="fetching-scripts:script-fetch-options">script fetch options</a> whose <a href="#concept-script-fetch-options-nonce" id="fetching-scripts:concept-script-fetch-options-nonce">cryptographic nonce</a> is the empty string, <a href="#concept-script-fetch-options-integrity" id="fetching-scripts:concept-script-fetch-options-integrity">integrity metadata</a> is the empty string, <a href="#concept-script-fetch-options-parser" id="fetching-scripts:concept-script-fetch-options-parser">parser metadata</a> is "<code>not-parser-inserted</code>", <a href="#concept-script-fetch-options-credentials" id="fetching-scripts:concept-script-fetch-options-credentials">credentials mode</a> is "<code>same-origin</code>", and <a href="#concept-script-fetch-options-referrer-policy" id="fetching-scripts:concept-script-fetch-options-referrer-policy">referrer policy</a> is the empty string.</p>

  <p>Given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request" data-x-internal="concept-request">request</a> <var>request</var> and a <a href="#script-fetch-options" id="fetching-scripts:script-fetch-options-2">script fetch options</a> <var>options</var>, we define:</p>

  <dl><dt><dfn id="set-up-the-classic-script-request">set up the classic script request</dfn><dd><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata" id="fetching-scripts:concept-request-nonce-metadata-2" data-x-internal="concept-request-nonce-metadata">cryptographic nonce metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-nonce" id="fetching-scripts:concept-script-fetch-options-nonce-2">cryptographic nonce</a>, its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-integrity-metadata" id="fetching-scripts:concept-request-integrity-metadata-2" data-x-internal="concept-request-integrity-metadata">integrity metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-integrity" id="fetching-scripts:concept-script-fetch-options-integrity-2">integrity metadata</a>, its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata" id="fetching-scripts:concept-request-parser-metadata-2" data-x-internal="concept-request-parser-metadata">parser metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-parser" id="fetching-scripts:concept-script-fetch-options-parser-2">parser metadata</a>, and its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy" id="fetching-scripts:concept-request-referrer-policy-2" data-x-internal="concept-request-referrer-policy">referrer policy</a> to <var>options</var>'s <a href="#concept-script-fetch-options-referrer-policy" id="fetching-scripts:concept-script-fetch-options-referrer-policy-2">referrer policy</a>.<dt><dfn id="set-up-the-module-script-request">set up the module script request</dfn><dd><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-nonce-metadata" id="fetching-scripts:concept-request-nonce-metadata-3" data-x-internal="concept-request-nonce-metadata">cryptographic nonce metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-nonce" id="fetching-scripts:concept-script-fetch-options-nonce-3">cryptographic nonce</a>, its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-integrity-metadata" id="fetching-scripts:concept-request-integrity-metadata-3" data-x-internal="concept-request-integrity-metadata">integrity metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-integrity" id="fetching-scripts:concept-script-fetch-options-integrity-3">integrity metadata</a>, its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata" id="fetching-scripts:concept-request-parser-metadata-3" data-x-internal="concept-request-parser-metadata">parser metadata</a> to <var>options</var>'s <a href="#concept-script-fetch-options-parser" id="fetching-scripts:concept-script-fetch-options-parser-3">parser metadata</a>, its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="fetching-scripts:concept-request-credentials-mode-2" data-x-internal="concept-request-credentials-mode">credentials mode</a> to <var>options</var>'s <a href="#concept-script-fetch-options-credentials" id="fetching-scripts:concept-script-fetch-options-credentials-2">credentials mode</a>, and its <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer-policy" id="fetching-scripts:concept-request-referrer-policy-3" data-x-internal="concept-request-referrer-policy">referrer policy</a> to <var>options</var>'s <a href="#concept-script-fetch-options-referrer-policy" id="fetching-scripts:concept-script-fetch-options-referrer-policy-3">referrer policy</a>.</dl>

  <p>For any given <a href="#script-fetch-options" id="fetching-scripts:script-fetch-options-3">script fetch options</a> <var>options</var>, the <dfn id="descendant-script-fetch-options">descendant script fetch options</dfn> are a new <a href="#script-fetch-options" id="fetching-scripts:script-fetch-options-4">script fetch options</a> whose <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="fetching-scripts:struct-item-2" data-x-internal="struct-item">items</a> all have the same values, except for the <a href="#concept-script-fetch-options-integrity" id="fetching-scripts:concept-script-fetch-options-integrity-4">integrity metadata</a>, which is instead the empty string.</p>

  <hr>

  <p>The algorithms below can be customized by optionally supplying a custom <dfn data-dfn-for="fetching scripts" id="fetching-scripts-perform-fetch" data-export="">perform the fetch</dfn> hook, which takes a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-2" data-x-internal="concept-request">request</a> and an <dfn data-dfn-for="fetching scripts" id="fetching-scripts-is-top-level" data-export=""><var>is top-level</var></dfn> flag. The algorithm must complete with a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response" data-x-internal="concept-response">response</a> (which may be a <a id="fetching-scripts:network-error" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a>), either synchronously (when using <a href="#fetch-a-classic-worker-imported-script" id="fetching-scripts:fetch-a-classic-worker-imported-script">fetch a classic worker-imported script</a>) or asynchronously (otherwise). The <var id="fetching-scripts:fetching-scripts-is-top-level"><a href="#fetching-scripts-is-top-level">is top-level</a></var> flag will be set for all <a href="#classic-script" id="fetching-scripts:classic-script-4">classic script</a> fetches, and for the initial fetch when <a href="#fetch-a-module-script-tree" id="fetching-scripts:fetch-a-module-script-tree">fetching an external module script graph</a>, <a href="#fetch-a-module-worker-script-tree" id="fetching-scripts:fetch-a-module-worker-script-tree">fetching a module worker script graph</a>, or <a href="#fetch-an-import()-module-script-graph" id="fetching-scripts:fetch-an-import()-module-script-graph">fetching an import() module script graph</a>, but not for the fetches resulting from <code>import</code> statements encountered throughout the graph.</p>

  <div class="note"><p>By default, not supplying the <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch">perform the fetch</a> will cause the below algorithms to simply <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch" data-x-internal="concept-fetch">fetch</a> the given <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-3" data-x-internal="concept-request">request</a>, with algorithm-specific customizations to the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-4" data-x-internal="concept-request">request</a> and validations of the resulting <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-2" data-x-internal="concept-response">response</a>.</p>

   <p>To layer your own customizations on top of these algorithm-specific ones, supply a <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-2">perform the fetch</a> hook that modifies the given <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-5" data-x-internal="concept-request">request</a>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-2" data-x-internal="concept-fetch">fetches</a> it, and then performs specific validations of the resulting <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-3" data-x-internal="concept-response">response</a> (completing with a <a id="fetching-scripts:network-error-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-network-error" data-x-internal="network-error">network error</a> if the validations fail).</p>

   <p>The hook can also be used to perform more subtle customizations, such as keeping a cache of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-4" data-x-internal="concept-response">responses</a> and avoiding performing a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-3" data-x-internal="concept-fetch">fetch</a> at all.</p>
  </div>

  <p class="note"><cite>Service Workers</cite> is an example of a specification that runs these algorithms with its own options for the hook. <a href="references.html#refsSW">[SW]</a></p>

  <hr>

  <p>Now for the algorithms themselves.</p>

  <p>To <dfn id="fetch-a-classic-script" data-export="">fetch a classic script</dfn> given a <var>url</var>, a <var>settings object</var>, some <var>options</var>, a <var>CORS setting</var>, and a <var>character encoding</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a new <a href="#classic-script" id="fetching-scripts:classic-script-5">classic script</a> (on success).</p>

  <ol><li><p>Let <var>request</var> be the result of <a href="urls-and-fetching.html#create-a-potential-cors-request" id="fetching-scripts:create-a-potential-cors-request">creating a potential-CORS request</a> given <var>url</var>, "<code>script</code>", and <var>CORS setting</var>.<li><p>Set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="fetching-scripts:concept-request-client" data-x-internal="concept-request-client">client</a> to <var>settings object</var>.</p>

   <li><p><a href="#set-up-the-classic-script-request" id="fetching-scripts:set-up-the-classic-script-request">Set up the classic script request</a> given <var>request</var> and <var>options</var>.<li><p>If the caller specified custom steps to <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-3">perform the fetch</a>, perform them on <var>request</var>, with the <var id="fetching-scripts:fetching-scripts-is-top-level-2"><a href="#fetching-scripts-is-top-level">is top-level</a></var> flag set. Return from this algorithm, and when the custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-4">perform the fetch</a> steps complete with <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-5" data-x-internal="concept-response">response</a> <var>response</var>, run the remaining steps.</p>

    <p>Otherwise, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-4" data-x-internal="concept-fetch">fetch</a> <var>request</var>. Return from this algorithm, and run the remaining steps as part of the fetch's <a id="fetching-scripts:process-response" href="https://triple-underscore.github.io/Fetch-ja.html#process-response" data-x-internal="process-response">process response</a> for the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-6" data-x-internal="concept-response">response</a> <var>response</var>.</p>

    <p class="note"><var>response</var> can be either <a id="fetching-scripts:cors-same-origin" href="urls-and-fetching.html#cors-same-origin">CORS-same-origin</a> or <a id="fetching-scripts:cors-cross-origin" href="urls-and-fetching.html#cors-cross-origin">CORS-cross-origin</a>. This only affects how error reporting happens.</p>
   <li><p>Set <var>response</var> to <var>response</var>'s <a id="fetching-scripts:unsafe-response" href="urls-and-fetching.html#unsafe-response">unsafe response</a>.<li><p>If <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-type" data-x-internal="concept-response-type">type</a> is "<code>error</code>", or <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="fetching-scripts:concept-response-status" data-x-internal="concept-response-status">status</a> is not an <a id="fetching-scripts:ok-status" href="https://triple-underscore.github.io/Fetch-ja.html#ok-status" data-x-internal="ok-status">ok status</a>, then asynchronously complete this algorithm with null, and return.</p>

    <p class="note">For historical reasons, this algorithm does not include MIME type checking, unlike the other script-fetching algorithms in this section.</p>
   <li><p>If <var>response</var>'s <a href="urls-and-fetching.html#content-type" id="fetching-scripts:content-type">Content Type metadata</a>, if any, specifies a character encoding, and the user agent supports that encoding, then set <var>character encoding</var> to that encoding (ignoring the passed-in value).<li><p>Let <var>source text</var> be the result of <a href="https://triple-underscore.github.io/Encoding-ja.html#decode" id="fetching-scripts:decode" data-x-internal="decode">decoding</a> <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="fetching-scripts:concept-response-body" data-x-internal="concept-response-body">body</a> to Unicode, using <var>character encoding</var> as the fallback encoding.</p>

    <p class="note">The <a id="fetching-scripts:decode-2" href="https://triple-underscore.github.io/Encoding-ja.html#decode" data-x-internal="decode">decode</a> algorithm overrides <var>character encoding</var> if the file contains a BOM.</p>
   <li><p>Let <var>muted errors</var> be true if <var>response</var> was <a id="fetching-scripts:cors-cross-origin-2" href="urls-and-fetching.html#cors-cross-origin">CORS-cross-origin</a>, and false otherwise.<li><p>Let <var>script</var> be the result of <a href="#creating-a-classic-script" id="fetching-scripts:creating-a-classic-script">creating a classic script</a> given <var>source text</var>, <var>settings object</var>, <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url" data-x-internal="concept-response-url">url</a>, <var>options</var>, and <var>muted errors</var>.<li>Asynchronously complete this algorithm with <var>script</var>.</ol>

  <p>To <dfn id="fetch-a-classic-worker-script" data-export="">fetch a classic worker script</dfn> given a <var>url</var>, a <var>fetch client settings object</var>, a <var>destination</var>, and a <var>script settings object</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a new <a href="#classic-script" id="fetching-scripts:classic-script-6">classic script</a> (on success).</p>

  <ol><li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-6" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="fetching-scripts:concept-request-url" data-x-internal="concept-request-url">url</a> is <var>url</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="fetching-scripts:concept-request-client-2" data-x-internal="concept-request-client">client</a> is <var>fetch client settings object</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="fetching-scripts:concept-request-destination" data-x-internal="concept-request-destination">destination</a> is <var>destination</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode" id="fetching-scripts:concept-request-mode" data-x-internal="concept-request-mode">mode</a> is "<code>same-origin</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-credentials-mode" id="fetching-scripts:concept-request-credentials-mode-3" data-x-internal="concept-request-credentials-mode">credentials mode</a> is "<code>same-origin</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata" id="fetching-scripts:concept-request-parser-metadata-4" data-x-internal="concept-request-parser-metadata">parser metadata</a> is "<code>not parser-inserted</code>", and whose <a id="fetching-scripts:use-url-credentials-flag" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a> is set.<li><p>If the caller specified custom steps to <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-5">perform the fetch</a>, perform them on <var>request</var>, with the <var id="fetching-scripts:fetching-scripts-is-top-level-3"><a href="#fetching-scripts-is-top-level">is top-level</a></var> flag set. Return from this algorithm, and when the custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-6">perform the fetch</a> steps complete with <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-7" data-x-internal="concept-response">response</a> <var>response</var>, run the remaining steps.</p>

    <p>Otherwise, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-5" data-x-internal="concept-fetch">fetch</a> <var>request</var>. Return from this algorithm, and run the remaining steps as part of the fetch's <a id="fetching-scripts:process-response-2" href="https://triple-underscore.github.io/Fetch-ja.html#process-response" data-x-internal="process-response">process response</a> for the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-8" data-x-internal="concept-response">response</a> <var>response</var>.</p>
   <li><p>Set <var>response</var> to <var>response</var>'s <a id="fetching-scripts:unsafe-response-2" href="urls-and-fetching.html#unsafe-response">unsafe response</a>.<li><p>If either of the following conditions are met:</p>

    <ul><li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-type-2" data-x-internal="concept-response-type">type</a> is "<code>error</code>"; or<li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="fetching-scripts:concept-response-status-2" data-x-internal="concept-response-status">status</a> is not an <a id="fetching-scripts:ok-status-2" href="https://triple-underscore.github.io/Fetch-ja.html#ok-status" data-x-internal="ok-status">ok status</a>,</ul>

    <p>then asynchronously complete this algorithm with null, and return.</p>
   <li><p>If both of the following conditions are met:</p>

    <ul><li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url-2" data-x-internal="concept-response-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="fetching-scripts:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> is an <a id="fetching-scripts:http(s)-scheme" href="https://triple-underscore.github.io/Fetch-ja.html#http-scheme" data-x-internal="http(s)-scheme">HTTP(S) scheme</a>; and<li><p>the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-extract-mime-type" id="fetching-scripts:extract-a-mime-type" data-x-internal="extract-a-mime-type">extracting a MIME type</a> from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="fetching-scripts:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a> is not a <a id="fetching-scripts:javascript-mime-type" href="https://triple-underscore.github.io/mimesniff-ja.html#javascript-mime-type" data-x-internal="javascript-mime-type">JavaScript MIME type</a>,</p>
    </ul>

    <p>then asynchronously complete this algorithm with null, and return.</p>

    <p class="note">Other <a href="https://triple-underscore.github.io/Fetch-ja.html#fetch-scheme" id="fetching-scripts:fetch-scheme" data-x-internal="fetch-scheme">fetch schemes</a> are exempted from MIME type checking for historical web-compatibility reasons. We might be able to tighten this in the future; see <a href="https://github.com/whatwg/html/issues/3255">issue #3255</a>.</p>
   <li><p>Let <var>source text</var> be the result of <a href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" id="fetching-scripts:utf-8-decode" data-x-internal="utf-8-decode">UTF-8 decoding</a> <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="fetching-scripts:concept-response-body-2" data-x-internal="concept-response-body">body</a>.<li><p>Let <var>script</var> be the result of <a href="#creating-a-classic-script" id="fetching-scripts:creating-a-classic-script-2">creating a classic script</a> using <var>source text</var>, <var>script settings object</var>, <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url-3" data-x-internal="concept-response-url">url</a>, and the <a href="#default-classic-script-fetch-options" id="fetching-scripts:default-classic-script-fetch-options">default classic script fetch options</a>.<li>Asynchronously complete this algorithm with <var>script</var>.</ol>

  <p>To <dfn id="fetch-a-classic-worker-imported-script" data-export="">fetch a classic worker-imported script</dfn> given a <var>url</var> and a <var>settings object</var>, run these steps. The algorithm will synchronously complete with a <a href="#classic-script" id="fetching-scripts:classic-script-7">classic script</a> on success, or throw an exception on failure.</p>

  <ol><li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-7" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="fetching-scripts:concept-request-url-2" data-x-internal="concept-request-url">url</a> is <var>url</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="fetching-scripts:concept-request-client-3" data-x-internal="concept-request-client">client</a> is <var>settings object</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="fetching-scripts:concept-request-destination-2" data-x-internal="concept-request-destination">destination</a> is "<code>script</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-parser-metadata" id="fetching-scripts:concept-request-parser-metadata-5" data-x-internal="concept-request-parser-metadata">parser metadata</a> is "<code>not parser-inserted</code>", <a id="fetching-scripts:synchronous-flag" href="https://triple-underscore.github.io/Fetch-ja.html#synchronous-flag" data-x-internal="synchronous-flag">synchronous flag</a> is set, and whose <a id="fetching-scripts:use-url-credentials-flag-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-use-url-credentials-flag" data-x-internal="use-url-credentials-flag">use-URL-credentials flag</a> is set.<li><p>If the caller specified custom steps to <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-7">perform the fetch</a>, perform them on <var>request</var>, with the <var id="fetching-scripts:fetching-scripts-is-top-level-4"><a href="#fetching-scripts-is-top-level">is top-level</a></var> flag set. Let <var>response</var> be the result.</p>

    <p>Otherwise, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-6" data-x-internal="concept-fetch">fetch</a> <var>request</var>, and let <var>response</var> be the result.</p>

    <p class="note">Unlike other algorithms in this section, the fetching process is synchronous here. Thus any <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-8">perform the fetch</a> steps will also finish their work synchronously.</p>
   <li><p>Set <var>response</var> to <var>response</var>'s <a id="fetching-scripts:unsafe-response-3" href="urls-and-fetching.html#unsafe-response">unsafe response</a>.<li><p>If any of the following conditions are met:</p>

    <ul><li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-type-3" data-x-internal="concept-response-type">type</a> is "<code>error</code>"; or<li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="fetching-scripts:concept-response-status-3" data-x-internal="concept-response-status">status</a> is not an <a id="fetching-scripts:ok-status-3" href="https://triple-underscore.github.io/Fetch-ja.html#ok-status" data-x-internal="ok-status">ok status</a>; or<li><p>the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-extract-mime-type" id="fetching-scripts:extract-a-mime-type-2" data-x-internal="extract-a-mime-type">extracting a MIME type</a> from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="fetching-scripts:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a> is not a <a id="fetching-scripts:javascript-mime-type-2" href="https://triple-underscore.github.io/mimesniff-ja.html#javascript-mime-type" data-x-internal="javascript-mime-type">JavaScript MIME type</a>,</p>
    </ul>

    <p>then throw a <a id="fetching-scripts:networkerror" href="https://triple-underscore.github.io/WebIDL-ja.html#networkerror" data-x-internal="networkerror">"<code>NetworkError</code>"</a> <code id="fetching-scripts:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.</p>
   <li><p>Let <var>source text</var> be the result of <a href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" id="fetching-scripts:utf-8-decode-2" data-x-internal="utf-8-decode">UTF-8 decoding</a> <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="fetching-scripts:concept-response-body-3" data-x-internal="concept-response-body">body</a>.<li><p>Let <var>muted errors</var> be true if <var>response</var> was <a id="fetching-scripts:cors-cross-origin-3" href="urls-and-fetching.html#cors-cross-origin">CORS-cross-origin</a>, and false otherwise.<li><p>Let <var>script</var> be the result of <a href="#creating-a-classic-script" id="fetching-scripts:creating-a-classic-script-3">creating a classic script</a> given <var>source text</var>, <var>settings object</var>, <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url-4" data-x-internal="concept-response-url">url</a>, the <a href="#default-classic-script-fetch-options" id="fetching-scripts:default-classic-script-fetch-options-2">default classic script fetch options</a>, and <var>muted errors</var>.<li><p>Return <var>script</var>.</ol>

  <p>To <dfn id="fetch-a-module-script-tree" data-export="">fetch an external module script graph</dfn> given a <var>url</var>, a <var>settings object</var>, and some <var>options</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-5">module script</a> (on success).</p>

  <ol><li><p><a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script">Fetch a single module script</a> given <var>url</var>, <var>settings object</var>, "<code>script</code>", <var>options</var>, <var>settings object</var>, "<code>client</code>", and with the <var>top-level module fetch flag</var> set. If the caller of this algorithm specified custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-9">perform the fetch</a> steps, pass those along as well. Wait until the algorithm asynchronously completes with <var>result</var>.<li><p>If <var>result</var> is null, asynchronously complete this algorithm with null, and return.<li><p>Let <var>visited set</var> be « <var>url</var> ».<li><p><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script">Fetch the descendants of and link</a> <var>result</var> given <var>settings object</var>, <var>destination</var>, and <var>visited set</var>. When this asynchronously completes with <var>final result</var>, asynchronously complete this algorithm with <var>final result</var>.</ol>

  <p>To <dfn id="fetch-an-import()-module-script-graph">fetch an import() module script graph</dfn> given a <var>specifier</var>, a <var>base URL</var>, a <var>settings object</var>, and some <var>options</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-6">module script</a> (on success).</p>

  <ol><li><p>Let <var>url</var> be the result of <a href="#resolve-a-module-specifier" id="fetching-scripts:resolve-a-module-specifier">resolving a module specifier</a> given <var>base URL</var> and <var>specifier</var>.<li><p>If <var>url</var> is failure, then asynchronously complete this algorithm with null, and return.<li><p><a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-2">Fetch a single module script</a> given <var>url</var>, <var>settings object</var>, "<code>script</code>", <var>options</var>, <var>settings object</var>, "<code>client</code>", and with the <var>top-level module fetch flag</var> set. If the caller of this algorithm specified custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-10">perform the fetch</a> steps, pass those along as well. Wait until the algorithm asynchronously completes with <var>result</var>.<li><p>If <var>result</var> is null, asynchronously complete this algorithm with null, and return.<li><p>Let <var>visited set</var> be « <var>url</var> ».<li><p><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script-2">Fetch the descendants of and link</a> <var>result</var> given <var>settings object</var>, <var>destination</var>, and <var>visited set</var>. When this asynchronously completes with <var>final result</var>, asynchronously complete this algorithm with <var>final result</var>.</ol>

  <p>To <dfn id="fetch-a-modulepreload-module-script-graph">fetch a modulepreload module script graph</dfn> given a <var>url</var>, a <var>destination</var>, a <var>settings object</var>, and some <var>options</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-7">module script</a> (on success), although it will perform optional steps even after completing.</p>

  <ol><li><p><a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-3">Fetch a single module script</a> given <var>url</var>, <var>settings object</var>, <var>destination</var>, <var>options</var>, <var>settings object</var>, "<code>client</code>", and with the <var>top-level module fetch</var> flag set. Wait until algorithm asynchronously completes with <var>result</var>.<li><p>Asynchronously complete this algorithm with <var>result</var>, but do <em>not</em> return.<li><p>If <var>result</var> is not null, optionally perform the following steps:</p>

    <ol><li><p>Let <var>visited set</var> be « <var>url</var> ».<li><p><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script-3">Fetch the descendants of and link</a> <var>result</var> given <var>settings object</var>, <var>destination</var>, and <var>visited set</var>.</ol>

    <p class="note">Generally, performing these steps will be beneficial for performance, as it allows pre-loading the modules that will invariably be requested later, via algorithms such as <a href="#fetch-a-module-script-tree" id="fetching-scripts:fetch-a-module-script-tree-2">fetch an external module script graph</a> that fetch the entire graph. However, user agents might wish to skip them in bandwidth-constrained situations, or situations where the relevant fetches are already in flight.</p>
   </ol>

  <p>To <dfn id="fetch-an-inline-module-script-graph">fetch an inline module script graph</dfn> given a <var>source text</var>, <var>base URL</var>, <var>settings object</var>, and <var>options</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-8">module script</a> (on success).</p>

  <ol><li><p>Let <var>script</var> be the result of <a href="#creating-a-module-script" id="fetching-scripts:creating-a-module-script">creating a module script</a> using <var>source text</var>, <var>settings object</var>, <var>base URL</var>, and <var>options</var>.<li><p>If <var>script</var> is null, asynchronously complete this algorithm with null, and return.<li><p>Let <var>visited set</var> be an empty <a id="fetching-scripts:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script-4">Fetch the descendants of and link</a> <var>script</var>, given <var>settings object</var>, the destination "<code>script</code>", and <var>visited set</var>. When this asynchronously completes with <var>final result</var>, asynchronously complete this algorithm with <var>final result</var>.</ol>

  <p>To <dfn id="fetch-a-module-worker-script-tree" data-export="">fetch a module worker script graph</dfn> given a <var>url</var>, a <var>fetch client settings object</var>, a <var>destination</var>, a <var>credentials mode</var>, and a <var>module map settings object</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-9">module script</a> (on success).</p>

  <ol><li><p>Let <var>options</var> be a <a href="#script-fetch-options" id="fetching-scripts:script-fetch-options-5">script fetch options</a> whose <a href="#concept-script-fetch-options-nonce" id="fetching-scripts:concept-script-fetch-options-nonce-4">cryptographic nonce</a> is the empty string, <a href="#concept-script-fetch-options-integrity" id="fetching-scripts:concept-script-fetch-options-integrity-5">integrity metadata</a> is the empty string, <a href="#concept-script-fetch-options-parser" id="fetching-scripts:concept-script-fetch-options-parser-4">parser metadata</a> is "<code>not-parser-inserted</code>", <a href="#concept-script-fetch-options-credentials" id="fetching-scripts:concept-script-fetch-options-credentials-3">credentials mode</a> is <var>credentials mode</var>, and <a href="#concept-script-fetch-options-referrer-policy" id="fetching-scripts:concept-script-fetch-options-referrer-policy-4">referrer policy</a> is the empty string.</p>

   <li><p><a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-4">Fetch a single module script</a> given <var>url</var>, <var>fetch client settings object</var>, <var>destination</var>, <var>options</var>, <var>module map settings object</var>, "<code>client</code>", and with the <var>top-level module fetch flag</var> set. If the caller of this algorithm specified custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-11">perform the fetch</a> steps, pass those along as well. Wait until the algorithm asynchronously completes with <var>result</var>.<li><p>If <var>result</var> is null, asynchronously complete this algorithm with null, and return.<li><p>Let <var>visited set</var> be « <var>url</var> ».<li><p><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script-5">Fetch the descendants of and link</a> <var>result</var> given <var>fetch client settings object</var>, <var>destination</var>, and <var>visited set</var>. When this asynchronously completes with <var>final result</var>, asynchronously complete this algorithm with <var>final result</var>.</ol>

  <hr>

  <p>The following algorithms are meant for internal use by this specification only as part of <a href="#fetch-a-module-script-tree" id="fetching-scripts:fetch-a-module-script-tree-3">fetching an external module script graph</a> or other similar concepts above, and should not be used directly by other specifications.</p>

  <p>This diagram illustrates how these algorithms relate to the ones above, as well as to each other:</p>

  <svg id="module-script-fetching-diagram" style="width: 100%;" role="img" viewBox="0 0 941 186" aria-label="Fetch an external module script, fetch an import() module script graph, fetch a modulepreload module script graph, fetch an inline module script graph, and fetch a module worker script graph all call fetch the descendants of and link a module script. It, in turn, calls fetch the descendants of a module script, which then calls the internal module script graph fetching procedure. Finally, the internal module script graph fetching procedure loops back to call fetch the descendants of a module script.">
   <style>
   #module-script-fetching-diagram rect {
    stroke: black;
    fill: transparent;
   }

   #module-script-fetching-diagram path {
    stroke: black;
   }
   #module-script-fetching-diagram path[marker-end] {
    fill: transparent;
   }

   #module-script-fetching-diagram a {
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
   }
   </style>

   <defs>
    <marker markerHeight="6" id="module-script-fetching-diagram-arrow" orient="auto" markerWidth="6" refX="5" refY="3">
     <path fill="black" d="M0,0 V6 L5,3 Z"></path>
    </marker>
   </defs>

   <g transform="translate(0.5,0.5)" class="caller">
    <rect width="180" height="50"></rect>
    <foreignObject width="180" height="50"><a href="#fetch-a-module-script-tree" id="fetching-scripts:fetch-a-module-script-tree-4" xmlns="http://www.w3.org/1999/xhtml">fetch an external module script graph</a></foreignObject>
   </g>
   <path d="M90.5,50.5 L470.5,70.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(190.5,0.5)" class="caller">
    <rect width="180" height="50"></rect>
    <foreignObject width="180" height="50"><a href="#fetch-an-import()-module-script-graph" id="fetching-scripts:fetch-an-import()-module-script-graph-2" xmlns="http://www.w3.org/1999/xhtml">fetch an import() module script graph</a></foreignObject>
   </g>
   <path d="M280.5,50.5 L470.5,70.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(380.5,0.5)" class="caller">
    <rect width="180" height="50"></rect>
    <foreignObject width="180" height="50"><a href="#fetch-a-modulepreload-module-script-graph" id="fetching-scripts:fetch-a-modulepreload-module-script-graph" xmlns="http://www.w3.org/1999/xhtml">fetch a modulepreload module script graph</a></foreignObject>
   </g>
   <path d="M470.5,50.5 L470.5,70.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(570.5,0.5)" class="caller">
    <rect width="180" height="50"></rect>
    <foreignObject width="180" height="50"><a href="#fetch-an-inline-module-script-graph" id="fetching-scripts:fetch-an-inline-module-script-graph" xmlns="http://www.w3.org/1999/xhtml">fetch an inline module script graph</a></foreignObject>
   </g>
   <path d="M660.5,50.5 L470.5,70.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(760.5,0.5)" class="caller">
    <rect width="180" height="50"></rect>
    <foreignObject width="180" height="50"><a href="#fetch-a-module-worker-script-tree" id="fetching-scripts:fetch-a-module-worker-script-tree-2" xmlns="http://www.w3.org/1999/xhtml">fetch a module worker script graph</a></foreignObject>
   </g>
   <path d="M850.5,50.5 L470.5,70.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(260.5,70.5)" class="subalgorithm">
    <rect width="420" height="25"></rect>
    <foreignObject width="420" height="25"><a href="#fetch-the-descendants-of-and-link-a-module-script" id="fetching-scripts:fetch-the-descendants-of-and-link-a-module-script-6" xmlns="http://www.w3.org/1999/xhtml">fetch the descendants of and link a module script</a></foreignObject>
   </g>
   <path d="M470.5,95.5 L470.5,115.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(260.5,115.5)" class="subalgorithm">
    <rect width="420" height="25"></rect>
    <foreignObject width="420" height="25"><a href="#fetch-the-descendants-of-a-module-script" id="fetching-scripts:fetch-the-descendants-of-a-module-script" xmlns="http://www.w3.org/1999/xhtml">fetch the descendants of a module script</a></foreignObject>
   </g>
   <path d="M470.5,140.5 L470.5,160.5" marker-end="url(#module-script-fetching-diagram-arrow)"></path>

   <g transform="translate(260.5,160.5)" class="subalgorithm">
    <rect width="420" height="25"></rect>
    <foreignObject width="420" height="25"><a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure" xmlns="http://www.w3.org/1999/xhtml">internal module script graph fetching procedure</a></foreignObject>
   </g>
   <path d="M680.5,172 Q 720,150 680.5,128" marker-end="url(#module-script-fetching-diagram-arrow)"></path>
  </svg>

  <p>To <dfn id="fetch-the-descendants-of-and-link-a-module-script">fetch the descendants of and link a module script</dfn> <var>module script</var>, given a <var>fetch client settings object</var>, a <var>destination</var>, and a <var>visited set</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or with <var>module script</var> (on success).</p>

  <ol><li><p><a href="#fetch-the-descendants-of-a-module-script" id="fetching-scripts:fetch-the-descendants-of-a-module-script-2">Fetch the descendants of</a> <var>module script</var>, given <var>fetch client settings object</var>, <var>destination</var>, and <var>visited set</var>.<li><p>Return from this algorithm, and run the following steps when <a href="#fetch-the-descendants-of-a-module-script" id="fetching-scripts:fetch-the-descendants-of-a-module-script-3">fetching the descendants of a module script</a> asynchronously completes with <var>result</var>.<li><p>If <var>result</var> is null, then asynchronously complete this algorithm with <var>result</var>.</p>

    <p class="note">In this case, there was an error fetching one or more of the descendants. We will not attempt to link.</p>
   <li><p>Let <var>parse error</var> be the result of <a href="#finding-the-first-parse-error" id="fetching-scripts:finding-the-first-parse-error">finding the first parse error</a> given <var>result</var>.<li><p>If <var>parse error</var> is null, then:</p>

    <ol><li><p>Let <var>record</var> be <var>result</var>'s <a href="#concept-script-record" id="fetching-scripts:concept-script-record">record</a>.<li><p>Perform <var>record</var>.<a href="https://tc39.es/ecma262/#sec-moduledeclarationlinking" id="fetching-scripts:js-link" data-x-internal="js-link">Link</a>().</p>

      <p class="note">This step will recursively call <a href="https://tc39.es/ecma262/#sec-moduledeclarationlinking" id="fetching-scripts:js-link-2" data-x-internal="js-link">Link</a> on all of the module's unlinked dependencies.</p>

      <p>If this throws an exception, set <var>result</var>'s <a href="#concept-script-error-to-rethrow" id="fetching-scripts:concept-script-error-to-rethrow">error to rethrow</a> to that exception.</p>
     </ol>
   <li><p>Otherwise, set <var>result</var>'s <a href="#concept-script-error-to-rethrow" id="fetching-scripts:concept-script-error-to-rethrow-2">error to rethrow</a> to <var>parse error</var>.<li><p>Asynchronously complete this algorithm with <var>result</var>.</ol>

  <p>To <dfn id="fetch-the-descendants-of-a-module-script">fetch the descendants of a module script</dfn> <var>module script</var>, given a <var>fetch client settings object</var>, a <var>destination</var>, and a <var>visited set</var>, run these steps. The algorithm will asynchronously complete with either null (on failure) or with <var>module script</var> (on success).</p>

  <ol><li><p>If <var>module script</var>'s <a href="#concept-script-record" id="fetching-scripts:concept-script-record-2">record</a> is null, then asynchronously complete this algorithm with <var>module script</var> and return.<li><p>Let <var>record</var> be <var>module script</var>'s <a href="#concept-script-record" id="fetching-scripts:concept-script-record-3">record</a>.<li><p>If <var>record</var> is not a <a id="fetching-scripts:cyclic-module-record" href="https://tc39.es/ecma262/#sec-cyclic-module-records" data-x-internal="cyclic-module-record">Cyclic Module Record</a>, or if <var>record</var>.[[RequestedModules]] <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="fetching-scripts:list-is-empty" data-x-internal="list-is-empty">is empty</a>, asynchronously complete this algorithm with <var>module script</var>.<li><p>Let <var>urls</var> be a new empty <a id="fetching-scripts:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="fetching-scripts:list-iterate" data-x-internal="list-iterate">For each</a> string <var>requested</var> of <var>record</var>.[[RequestedModules]],</p>

    <ol><li><p>Let <var>url</var> be the result of <a href="#resolve-a-module-specifier" id="fetching-scripts:resolve-a-module-specifier-2">resolving a module specifier</a> given <var>module script</var>'s <a href="#concept-script-base-url" id="fetching-scripts:concept-script-base-url">base URL</a> and <var>requested</var>.<li><p>Assert: <var>url</var> is never failure, because <a href="#resolve-a-module-specifier" id="fetching-scripts:resolve-a-module-specifier-3">resolving a module specifier</a> must have been <a href="#validate-requested-module-specifiers">previously successful</a> with these same two arguments.<li><p>If <var>visited set</var> does not <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="fetching-scripts:list-contains" data-x-internal="list-contains">contain</a> <var>url</var>, then:</p>

      <ol><li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="fetching-scripts:list-append" data-x-internal="list-append">Append</a> <var>url</var> to <var>urls</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#set-append" id="fetching-scripts:set-append" data-x-internal="set-append">Append</a> <var>url</var> to <var>visited set</var>.</ol>
     </ol>
   <li><p>Let <var>options</var> be the <a href="#descendant-script-fetch-options" id="fetching-scripts:descendant-script-fetch-options">descendant script fetch options</a> for <var>module script</var>'s <a href="#concept-script-script-fetch-options" id="fetching-scripts:concept-script-script-fetch-options">fetch options</a>.<li><p>Assert: <var>options</var> is not null, as <var>module script</var> is a <a href="#module-script" id="fetching-scripts:module-script-10">module script</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="fetching-scripts:list-iterate-2" data-x-internal="list-iterate">For each</a> <var>url</var> in <var>urls</var>, perform the <a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure-2">internal module script graph fetching procedure</a> given <var>url</var>, <var>fetch client settings object</var>, <var>destination</var>, <var>options</var>, <var>module script</var>'s <a href="#settings-object" id="fetching-scripts:settings-object">settings object</a>, <var>visited set</var>, and <var>module script</var>'s <a href="#concept-script-base-url" id="fetching-scripts:concept-script-base-url-2">base URL</a>. If the caller of this algorithm specified custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-12">perform the fetch</a> steps, pass those along while performing the <a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure-3">internal module script graph fetching procedure</a>.</p>

    <p>These invocations of the <a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure-4">internal module script graph fetching procedure</a> should be performed in parallel to each other.</p>

    <p>If any of the invocations of the <a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure-5">internal module script graph fetching procedure</a> asynchronously complete with null, asynchronously complete this algorithm with null, and return.</p>

    <p>Otherwise, wait until all of the <a href="#internal-module-script-graph-fetching-procedure" id="fetching-scripts:internal-module-script-graph-fetching-procedure-6">internal module script graph fetching procedure</a> invocations have asynchronously completed. Asynchronously complete this algorithm with <var>module script</var>.</p>
   </ol>

  <p>To perform the <dfn id="internal-module-script-graph-fetching-procedure">internal module script graph fetching procedure</dfn> given a <var>url</var>, a <var>fetch client settings object</var>, a <var>destination</var>, some <var>options</var>, a <var>module map settings object</var>, a <var>visited set</var>, and a <var>referrer</var>, perform these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-11">module script</a> (on success).</p>

  <ol><li><p>Assert: <var>visited set</var> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="fetching-scripts:list-contains-2" data-x-internal="list-contains">contains</a> <var>url</var>.<li><p><a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-5">Fetch a single module script</a> given <var>url</var>, <var>fetch client settings object</var>, <var>destination</var>, <var>options</var>, <var>module map settings object</var>, <var>referrer</var>, and with the <var>top-level module fetch flag</var> unset. If the caller of this algorithm specified custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-13">perform the fetch</a> steps, pass those along while <a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-6">fetching a single module script</a>.</p>

   <li><p>Return from this algorithm, and run the following steps when <a href="#fetch-a-single-module-script" id="fetching-scripts:fetch-a-single-module-script-7">fetching a single module script</a> asynchronously completes with <var>result</var>:<li><p>If <var>result</var> is null, asynchronously complete this algorithm with null, and return.<li><p><a href="#fetch-the-descendants-of-a-module-script" id="fetching-scripts:fetch-the-descendants-of-a-module-script-4">Fetch the descendants of</a> <var>result</var> given <var>fetch client settings object</var>, <var>destination</var>, and <var>visited set</var>.<li><p>When the appropriate algorithm asynchronously completes with <var>final result</var>, asynchronously complete this algorithm with <var>final result</var>.</ol>

  <p>To <dfn id="fetch-a-single-module-script">fetch a single module script</dfn>, given a <var>url</var>, a <var>fetch client settings object</var>, a <var>destination</var>, some <var>options</var>, a <var>module map settings object</var>, a <var>referrer</var>, and a <var>top-level module fetch</var> flag, run these steps. The algorithm will asynchronously complete with either null (on failure) or a <a href="#module-script" id="fetching-scripts:module-script-12">module script</a> (on success).</p>

  <ol><li><p>Let <var>moduleMap</var> be <var>module map settings object</var>'s <a href="#concept-settings-object-module-map" id="fetching-scripts:concept-settings-object-module-map">module map</a>.<li><p>If <var>moduleMap</var>[<var>url</var>] is "<code>fetching</code>", wait <a id="fetching-scripts:in-parallel" href="infrastructure.html#in-parallel">in parallel</a> until that entry's value changes, then <a href="#queue-a-task" id="fetching-scripts:queue-a-task">queue a task</a> on the <a href="#networking-task-source" id="fetching-scripts:networking-task-source">networking task source</a> to proceed with running the following steps.<li><p>If <var>moduleMap</var>[<var>url</var>] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="fetching-scripts:map-exists" data-x-internal="map-exists">exists</a>, asynchronously complete this algorithm with <var>moduleMap</var>[<var>url</var>], and return.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="fetching-scripts:map-set" data-x-internal="map-set">Set</a> <var>moduleMap</var>[<var>url</var>] to "<code>fetching</code>".</p>

   <li><p>Let <var>request</var> be a new <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request" id="fetching-scripts:concept-request-8" data-x-internal="concept-request">request</a> whose <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="fetching-scripts:concept-request-url-3" data-x-internal="concept-request-url">url</a> is <var>url</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-destination" id="fetching-scripts:concept-request-destination-3" data-x-internal="concept-request-destination">destination</a> is <var>destination</var>, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode" id="fetching-scripts:concept-request-mode-2" data-x-internal="concept-request-mode">mode</a> is "<code>cors</code>", <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="fetching-scripts:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> is <var>referrer</var>, and <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-client" id="fetching-scripts:concept-request-client-4" data-x-internal="concept-request-client">client</a> is <var>fetch client settings object</var>.<li><p>If <var>destination</var> is "<code>worker</code>" or "<code>sharedworker</code>" and the <var>top-level module fetch</var> flag is set, then set <var>request</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-mode" id="fetching-scripts:concept-request-mode-3" data-x-internal="concept-request-mode">mode</a> to "<code>same-origin</code>".<li><p><a href="#set-up-the-module-script-request" id="fetching-scripts:set-up-the-module-script-request">Set up the module script request</a> given <var>request</var> and <var>options</var>.<li><p>If the caller specified custom steps to <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-14">perform the fetch</a>, perform them on <var>request</var>, setting the <var id="fetching-scripts:fetching-scripts-is-top-level-5"><a href="#fetching-scripts-is-top-level">is top-level</a></var> flag if the <var>top-level module fetch</var> flag is set. Return from this algorithm, and when the custom <a href="#fetching-scripts-perform-fetch" id="fetching-scripts:fetching-scripts-perform-fetch-15">perform the fetch</a> steps complete with <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-9" data-x-internal="concept-response">response</a> <var>response</var>, run the remaining steps.</p>

    <p>Otherwise, <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="fetching-scripts:concept-fetch-7" data-x-internal="concept-fetch">fetch</a> <var>request</var>. Return from this algorithm, and run the remaining steps as part of the fetch's <a id="fetching-scripts:process-response-3" href="https://triple-underscore.github.io/Fetch-ja.html#process-response" data-x-internal="process-response">process response</a> for the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-10" data-x-internal="concept-response">response</a> <var>response</var>.</p>

    <p class="note"><var>response</var> is always <a id="fetching-scripts:cors-same-origin-2" href="urls-and-fetching.html#cors-same-origin">CORS-same-origin</a>.</p>
   <li><p>If any of the following conditions are met:</p>

    <ul><li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="fetching-scripts:concept-response-type-4" data-x-internal="concept-response-type">type</a> is "<code>error</code>"; or<li><p><var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-status" id="fetching-scripts:concept-response-status-4" data-x-internal="concept-response-status">status</a> is not an <a id="fetching-scripts:ok-status-4" href="https://triple-underscore.github.io/Fetch-ja.html#ok-status" data-x-internal="ok-status">ok status</a>; or<li><p>the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-extract-mime-type" id="fetching-scripts:extract-a-mime-type-3" data-x-internal="extract-a-mime-type">extracting a MIME type</a> from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="fetching-scripts:concept-response-header-list-3" data-x-internal="concept-response-header-list">header list</a> is not a <a id="fetching-scripts:javascript-mime-type-3" href="https://triple-underscore.github.io/mimesniff-ja.html#javascript-mime-type" data-x-internal="javascript-mime-type">JavaScript MIME type</a>,</ul>

    <p>then <a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="fetching-scripts:map-set-2" data-x-internal="map-set">set</a> <var>moduleMap</var>[<var>url</var>] to null, asynchronously complete this algorithm with null, and return.</p>
   <li><p>Let <var>source text</var> be the result of <a href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode" id="fetching-scripts:utf-8-decode-3" data-x-internal="utf-8-decode">UTF-8 decoding</a> <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-body" id="fetching-scripts:concept-response-body-4" data-x-internal="concept-response-body">body</a>.<li><p>Let <var>module script</var> be the result of <a href="#creating-a-module-script" id="fetching-scripts:creating-a-module-script-2">creating a module script</a> given <var>source text</var>, <var>module map settings object</var>, <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url-5" data-x-internal="concept-response-url">url</a>, and <var>options</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="fetching-scripts:map-set-3" data-x-internal="map-set">Set</a> <var>moduleMap</var>[<var>url</var>] to <var>module script</var>, and asynchronously complete this algorithm with <var>module script</var>.</p>

    <p class="note">It is intentional that the <a href="#module-map" id="fetching-scripts:module-map">module map</a> is keyed by the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-url" id="fetching-scripts:concept-request-url-4" data-x-internal="concept-request-url">request URL</a>, whereas the <a href="#concept-script-base-url" id="fetching-scripts:concept-script-base-url-3">base URL</a> for the <a href="#module-script" id="fetching-scripts:module-script-13">module script</a> is set to the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="fetching-scripts:concept-response-url-6" data-x-internal="concept-response-url">response URL</a>. The former is used to deduplicate fetches, while the latter is used for URL resolution.</p>
   </ol>

  <p>To <dfn id="finding-the-first-parse-error">find the first parse error</dfn> given a root <var>moduleScript</var> and an optional <var>discoveredSet</var>:</p>

  <ol><li><p>Let <var>moduleMap</var> be <var>moduleScript</var>'s <a href="#settings-object" id="fetching-scripts:settings-object-2">settings object</a>'s <a href="#concept-settings-object-module-map" id="fetching-scripts:concept-settings-object-module-map-2">module map</a>.<li><p>If <var>discoveredSet</var> was not given, let it be an empty <a id="fetching-scripts:set-2" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="fetching-scripts:list-append-2" data-x-internal="list-append">Append</a> <var>moduleScript</var> to <var>discoveredSet</var>.<li><p>If <var>moduleScript</var>'s <a href="#concept-script-record" id="fetching-scripts:concept-script-record-4">record</a> is null, then return <var>moduleScript</var>'s <a href="#concept-script-parse-error" id="fetching-scripts:concept-script-parse-error">parse error</a>.<li><p>Let <var>childSpecifiers</var> be the value of <var>moduleScript</var>'s <a href="#concept-script-record" id="fetching-scripts:concept-script-record-5">record</a>'s [[RequestedModules]] internal slot.<li><p>Let <var>childURLs</var> be the <a id="fetching-scripts:list-2" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> obtained by calling <a href="#resolve-a-module-specifier" id="fetching-scripts:resolve-a-module-specifier-4">resolve a module specifier</a> once for each item of <var>childSpecifiers</var>, given <var>moduleScript</var>'s <a href="#concept-script-base-url" id="fetching-scripts:concept-script-base-url-4">base URL</a> and that item. (None of these will ever fail, as otherwise <var>moduleScript</var> would have been marked as itself having a parse error.)<li><p>Let <var>childModules</var> be the <a id="fetching-scripts:list-3" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> obtained by <a href="https://triple-underscore.github.io/infra-ja.html#map-get" id="fetching-scripts:map-get" data-x-internal="map-get">getting each value</a> in <var>moduleMap</var> whose key is given by an item of <var>childURLs</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="fetching-scripts:list-iterate-3" data-x-internal="list-iterate">For each</a> <var>childModule</var> of <var>childModules</var>:</p>

    <ol><li><p>Assert: <var>childModule</var> is a <a href="#module-script" id="fetching-scripts:module-script-14">module script</a> (i.e., it is not "<code>fetching</code>" or null); by now all <a href="#module-script" id="fetching-scripts:module-script-15">module scripts</a> in the graph rooted at <var>moduleScript</var> will have successfully been fetched.<li><p>If <var>discoveredSet</var> already <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="fetching-scripts:list-contains-3" data-x-internal="list-contains">contains</a> <var>childModule</var>, <a id="fetching-scripts:continue" href="https://triple-underscore.github.io/infra-ja.html#iteration-continue" data-x-internal="continue">continue</a>.<li><p>Let <var>childParseError</var> be the result of <a href="#finding-the-first-parse-error" id="fetching-scripts:finding-the-first-parse-error-2">finding the first parse error</a> given <var>childModule</var> and <var>discoveredSet</var>.<li><p>If <var>childParseError</var> is not null, return <var>childParseError</var>.</ol>
   <li><p>Return null.</ol>

  <h5 id="creating-scripts"><span class="secno">8.1.4.3</span> Creating scripts<a href="#creating-scripts" class="self-link"></a></h5>

  <p>To <dfn id="creating-a-classic-script">create a classic script</dfn>, given a <a id="creating-scripts:string" href="https://triple-underscore.github.io/infra-ja.html#string" data-x-internal="string">string</a> <var>source</var>, an <a href="#environment-settings-object" id="creating-scripts:environment-settings-object">environment settings object</a> <var>settings</var>, a <a id="creating-scripts:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>baseURL</var>, some <a href="#script-fetch-options" id="creating-scripts:script-fetch-options">script fetch options</a> <var>options</var>, and an optional <var>muted errors</var> boolean:</p>

  <ol><li><p>If <var>muted errors</var> was not provided, let it be false.<li><p>If <var>muted errors</var> is true, then set <var>baseURL</var> to <code id="creating-scripts:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code>.</p>

    <p class="note">When <var>muted errors</var> is true, <var>baseURL</var> is the script's <a id="creating-scripts:cors-cross-origin" href="urls-and-fetching.html#cors-cross-origin">CORS-cross-origin</a> <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="creating-scripts:concept-response" data-x-internal="concept-response">response</a>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="creating-scripts:concept-response-url" data-x-internal="concept-response-url">url</a>, which shouldn't be exposed to JavaScript. Therefore, <var>baseURL</var> is sanitized here.</p>
   <li><p>If <a href="#concept-environment-noscript" id="creating-scripts:concept-environment-noscript">scripting is disabled</a> for <var>settings</var>, then set <var>source</var> to the empty string.<li><p>Let <var>script</var> be a new <a href="#classic-script" id="creating-scripts:classic-script">classic script</a> that this algorithm will subsequently initialize.<li><p>Set <var>script</var>'s <a href="#settings-object" id="creating-scripts:settings-object">settings object</a> to <var>settings</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-base-url" id="creating-scripts:concept-script-base-url">base URL</a> to <var>baseURL</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-script-fetch-options" id="creating-scripts:concept-script-script-fetch-options">fetch options</a> to <var>options</var>.<li><p>Set <var>script</var>'s <a href="#muted-errors" id="creating-scripts:muted-errors">muted errors</a> to <var>muted errors</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-parse-error" id="creating-scripts:concept-script-parse-error">parse error</a> and <a href="#concept-script-error-to-rethrow" id="creating-scripts:concept-script-error-to-rethrow">error to rethrow</a> to null.<li><p>Let <var>result</var> be <a href="https://tc39.es/ecma262/#sec-parse-script" id="creating-scripts:js-parsescript" data-x-internal="js-parsescript">ParseScript</a>(<var>source</var>, <var>settings</var>'s <a href="#environment-settings-object's-realm" id="creating-scripts:environment-settings-object's-realm">Realm</a>, <var>script</var>).</p>

    <p class="note">Passing <var>script</var> as the last parameter here ensures <var>result</var>.[[HostDefined]] will be <var>script</var>.</p>
   <li><p>If <var>result</var> is a <a id="creating-scripts:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of errors, then:<ol><li><p>Set <var>script</var>'s <a href="#concept-script-parse-error" id="creating-scripts:concept-script-parse-error-2">parse error</a> and its <a href="#concept-script-error-to-rethrow" id="creating-scripts:concept-script-error-to-rethrow-2">error to rethrow</a> to <var>result</var>[0].<li><p>Return <var>script</var>.</ol>
   <li><p>Set <var>script</var>'s <a href="#concept-script-record" id="creating-scripts:concept-script-record">record</a> to <var>result</var>.<li><p>Return <var>script</var>.</ol>

  <p>To <dfn id="creating-a-module-script">create a module script</dfn>, given a <a id="creating-scripts:string-2" href="https://triple-underscore.github.io/infra-ja.html#string" data-x-internal="string">string</a> <var>source</var>, an <a href="#environment-settings-object" id="creating-scripts:environment-settings-object-2">environment settings object</a> <var>settings</var>, a <a id="creating-scripts:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>baseURL</var>, and some <a href="#script-fetch-options" id="creating-scripts:script-fetch-options-2">script fetch options</a> <var>options</var>:</p>

  <ol><li><p>If <a href="#concept-environment-noscript" id="creating-scripts:concept-environment-noscript-2">scripting is disabled</a> for <var>settings</var>, then set <var>source</var> to the empty string.<li><p>Let <var>script</var> be a new <a href="#module-script" id="creating-scripts:module-script">module script</a> that this algorithm will subsequently initialize.<li><p>Set <var>script</var>'s <a href="#settings-object" id="creating-scripts:settings-object-2">settings object</a> to <var>settings</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-base-url" id="creating-scripts:concept-script-base-url-2">base URL</a> to <var>baseURL</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-script-fetch-options" id="creating-scripts:concept-script-script-fetch-options-2">fetch options</a> to <var>options</var>.<li><p>Set <var>script</var>'s <a href="#concept-script-parse-error" id="creating-scripts:concept-script-parse-error-3">parse error</a> and <a href="#concept-script-error-to-rethrow" id="creating-scripts:concept-script-error-to-rethrow-3">error to rethrow</a> to null.<li><p>Let <var>result</var> be <a href="https://tc39.es/ecma262/#sec-parsemodule" id="creating-scripts:js-parsemodule" data-x-internal="js-parsemodule">ParseModule</a>(<var>source</var>, <var>settings</var>'s <a href="#environment-settings-object's-realm" id="creating-scripts:environment-settings-object's-realm-2">Realm</a>, <var>script</var>).</p>

    <p class="note">Passing <var>script</var> as the last parameter here ensures <var>result</var>.[[HostDefined]] will be <var>script</var>.</p>
   <li><p>If <var>result</var> is a <a id="creating-scripts:list-2" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of errors, then:</p>

    <ol><li><p>Set <var>script</var>'s <a href="#concept-script-parse-error" id="creating-scripts:concept-script-parse-error-4">parse error</a> to <var>result</var>[0].<li><p>Return <var>script</var>.</ol>
   <li id="validate-requested-module-specifiers"><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="creating-scripts:list-iterate" data-x-internal="list-iterate">For each</a> string <var>requested</var> of <var>result</var>.[[RequestedModules]]:</p>

    <ol><li><p>Let <var>url</var> be the result of <a href="#resolve-a-module-specifier" id="creating-scripts:resolve-a-module-specifier">resolving a module specifier</a> given <var>script</var>'s <a href="#concept-script-base-url" id="creating-scripts:concept-script-base-url-3">base URL</a> and <var>requested</var>.<li><p>If <var>url</var> is failure, then:</p>

      <ol><li><p>Let <var>error</var> be a new <code id="creating-scripts:typeerror"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code> exception.<li><p>Set <var>script</var>'s <a href="#concept-script-parse-error" id="creating-scripts:concept-script-parse-error-5">parse error</a> to <var>error</var>.<li><p>Return <var>script</var>.</ol>
     </ol>

    <p class="note">This step is essentially validating all of the requested module specifiers. We treat a module with unresolvable module specifiers the same as one that cannot be parsed; in both cases, a syntactic issue makes it impossible to ever contemplate linking the module later.</p>
   <li><p>Set <var>script</var>'s <a href="#concept-script-record" id="creating-scripts:concept-script-record-2">record</a> to <var>result</var>.<li><p>Return <var>script</var>.</ol>

  <h5 id="calling-scripts"><span class="secno">8.1.4.4</span> Calling scripts<a href="#calling-scripts" class="self-link"></a></h5>

  <p>To <dfn id="run-a-classic-script" data-export="">run a classic script</dfn> given a <a href="#classic-script" id="calling-scripts:classic-script">classic script</a> <var>script</var> and an optional <var>rethrow errors</var> boolean:</p>

  <ol><li><p>If <var>rethrow errors</var> is not given, let it be false.<li><p>Let <var>settings</var> be the <a href="#settings-object" id="calling-scripts:settings-object">settings object</a> of <var>script</var>.<li><p><a href="#check-if-we-can-run-script" id="calling-scripts:check-if-we-can-run-script">Check if we can run script</a> with <var>settings</var>. If this returns "do not run" then return <a id="calling-scripts:normalcompletion" href="https://tc39.es/ecma262/#sec-normalcompletion" data-x-internal="normalcompletion">NormalCompletion</a>(empty).<li><p><a href="#prepare-to-run-script" id="calling-scripts:prepare-to-run-script">Prepare to run script</a> given <var>settings</var>.<li><p>Let <var>evaluationStatus</var> be null.<li><p>If <var>script</var>'s <a href="#concept-script-error-to-rethrow" id="calling-scripts:concept-script-error-to-rethrow">error to rethrow</a> is not null, then set <var>evaluationStatus</var> to Completion { [[Type]]: throw, [[Value]]: <var>script</var>'s <a href="#concept-script-error-to-rethrow" id="calling-scripts:concept-script-error-to-rethrow-2">error to rethrow</a>, [[Target]]: empty }.<li><p>Otherwise, set <var>evaluationStatus</var> to <a href="https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation" id="calling-scripts:js-scriptevaluation" data-x-internal="js-scriptevaluation">ScriptEvaluation</a>(<var>script</var>'s <a href="#concept-script-record" id="calling-scripts:concept-script-record">record</a>).</p>

    <p>If <a href="https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation" id="calling-scripts:js-scriptevaluation-2" data-x-internal="js-scriptevaluation">ScriptEvaluation</a> does not complete because the user agent has <a href="#abort-a-running-script" id="calling-scripts:abort-a-running-script">aborted the running script</a>, leave <var>evaluationStatus</var> as null.</p>
   <li><p>If <var>evaluationStatus</var> is an <a id="calling-scripts:abrupt-completion" href="https://tc39.es/ecma262/#sec-completion-record-specification-type" data-x-internal="abrupt-completion">abrupt completion</a>, then:</p>

    <ol><li><p>If <var>rethrow errors</var> is true and <var>script</var>'s <a href="#muted-errors" id="calling-scripts:muted-errors">muted errors</a> is false, then:</p>

      <ol><li><p><a href="#clean-up-after-running-script" id="calling-scripts:clean-up-after-running-script">Clean up after running script</a> with <var>settings</var>.<li><p>Rethrow <var>evaluationStatus</var>.[[Value]].</ol>

     <li><p>If <var>rethrow errors</var> is true and <var>script</var>'s <a href="#muted-errors" id="calling-scripts:muted-errors-2">muted errors</a> is true, then:</p>

      <ol><li><p><a href="#clean-up-after-running-script" id="calling-scripts:clean-up-after-running-script-2">Clean up after running script</a> with <var>settings</var>.<li><p>Throw a <a id="calling-scripts:networkerror" href="https://triple-underscore.github.io/WebIDL-ja.html#networkerror" data-x-internal="networkerror">"<code>NetworkError</code>"</a> <code id="calling-scripts:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.</ol>
     <li><p>Otherwise, <var>rethrow errors</var> is false. Perform the following steps:</p>

      <ol><li><p><a href="#report-the-exception" id="calling-scripts:report-the-exception">Report the exception</a> given by <var>evaluationStatus</var>.[[Value]] for <var>script</var>.<li><p><a href="#clean-up-after-running-script" id="calling-scripts:clean-up-after-running-script-3">Clean up after running script</a> with <var>settings</var>.<li><p>Return <var>evaluationStatus</var>.</ol>
     </ol>
   <li><p><a href="#clean-up-after-running-script" id="calling-scripts:clean-up-after-running-script-4">Clean up after running script</a> with <var>settings</var>.<li><p>If <var>evaluationStatus</var> is a normal completion, then return <var>evaluationStatus</var>.<li><p>If we've reached this point, <var>evaluationStatus</var> was left as null because the script was <a href="#abort-a-running-script" id="calling-scripts:abort-a-running-script-2">aborted prematurely</a> during evaluation. Return Completion { [[Type]]: throw, [[Value]]: a new <a id="calling-scripts:quotaexceedederror" href="https://triple-underscore.github.io/WebIDL-ja.html#quotaexceedederror" data-x-internal="quotaexceedederror">"<code>QuotaExceededError</code>"</a> <code id="calling-scripts:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>, [[Target]]: empty }.</ol>

  <p>To <dfn id="run-a-module-script" data-export="">run a module script</dfn> given a <a href="#module-script" id="calling-scripts:module-script">module script</a> <var>script</var>, with an optional <var>rethrow errors</var> boolean:</p>

  <ol><li><p>If <var>rethrow errors</var> is not given, let it be false.<li><p>Let <var>settings</var> be the <a href="#settings-object" id="calling-scripts:settings-object-2">settings object</a> of <var>script</var>.<li><p><a href="#check-if-we-can-run-script" id="calling-scripts:check-if-we-can-run-script-2">Check if we can run script</a> with <var>settings</var>. If this returns "do not run" then return <a id="calling-scripts:normalcompletion-2" href="https://tc39.es/ecma262/#sec-normalcompletion" data-x-internal="normalcompletion">NormalCompletion</a>(empty).<li><p><a href="#prepare-to-run-script" id="calling-scripts:prepare-to-run-script-2">Prepare to run script</a> given <var>settings</var>.<li><p>Let <var>evaluationStatus</var> be null.<li><p>If <var>script</var>'s <a href="#concept-script-error-to-rethrow" id="calling-scripts:concept-script-error-to-rethrow-3">error to rethrow</a> is not null, then set <var>evaluationStatus</var> to Completion { [[Type]]: throw, [[Value]]: <var>script</var>'s <a href="#concept-script-error-to-rethrow" id="calling-scripts:concept-script-error-to-rethrow-4">error to rethrow</a>, [[Target]]: empty }.<li><p>Otherwise:</p>

    <ol><li><p>Let <var>record</var> be <var>script</var>'s <a href="#concept-script-record" id="calling-scripts:concept-script-record-2">record</a>.</p>

     <li><p>Set <var>evaluationStatus</var> to <var>record</var>.<a href="https://tc39.es/ecma262/#sec-moduleevaluation" id="calling-scripts:js-evaluate" data-x-internal="js-evaluate">Evaluate</a>().</p>

      <p class="note">This step will recursively evaluate all of the module's dependencies.</p>

      <p>If <a href="https://tc39.es/ecma262/#sec-moduleevaluation" id="calling-scripts:js-evaluate-2" data-x-internal="js-evaluate">Evaluate</a> fails to complete as a result of the user agent <a href="#abort-a-running-script" id="calling-scripts:abort-a-running-script-3">aborting the running script</a>, then set <var>evaluationStatus</var> to Completion { [[Type]]: throw, [[Value]]: a new <a id="calling-scripts:quotaexceedederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#quotaexceedederror" data-x-internal="quotaexceedederror">"<code>QuotaExceededError</code>"</a> <code id="calling-scripts:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>, [[Target]]: empty }.</p>
      </ol>
   <li><p>If <var>evaluationStatus</var> is an <a id="calling-scripts:abrupt-completion-2" href="https://tc39.es/ecma262/#sec-completion-record-specification-type" data-x-internal="abrupt-completion">abrupt completion</a>, then:</p>

    <ol><li><p>If <var>rethrow errors</var> is true, rethrow the exception given by <var>evaluationStatus</var>.[[Value]].<li><p>Otherwise, <a href="#report-the-exception" id="calling-scripts:report-the-exception-2">report the exception</a> given by <var>evaluationStatus</var>.[[Value]] for <var>script</var>.</ol>
   <li><p><a href="#clean-up-after-running-script" id="calling-scripts:clean-up-after-running-script-5">Clean up after running script</a> with <var>settings</var>.<li><p>Return <var>evaluationStatus</var>.</ol>

  <p>The steps to <dfn id="check-if-we-can-run-script">check if we can run script</dfn> with an <a href="#environment-settings-object" id="calling-scripts:environment-settings-object">environment settings object</a> <var>settings</var> are as follows. They return either "run" or "do not run".</p>

  <ol><li><p>If the <a href="#concept-settings-object-global" id="calling-scripts:concept-settings-object-global">global object</a> specified by <var>settings</var> is a <code id="calling-scripts:window"><a href="window-object.html#window">Window</a></code> object whose <code id="calling-scripts:document"><a href="dom.html#document">Document</a></code> object is not <a id="calling-scripts:fully-active" href="browsers.html#fully-active">fully active</a>, then return "do not run".</p>

   <li><p>If <a href="#concept-environment-noscript" id="calling-scripts:concept-environment-noscript">scripting is disabled</a> for <var>settings</var>, then return "do not run".</p>

   <li><p>Return "run".</ol>

  <p>The steps to <dfn id="prepare-to-run-script" data-export="">prepare to run script</dfn> with an <a href="#environment-settings-object" id="calling-scripts:environment-settings-object-2">environment settings object</a> <var>settings</var> are as follows:</p>

  <ol><li><p>Push <var>settings</var>'s <a href="#realm-execution-context" id="calling-scripts:realm-execution-context">realm execution context</a> onto the <a id="calling-scripts:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>; it is now the <a id="calling-scripts:running-javascript-execution-context" href="https://tc39.es/ecma262/#running-execution-context" data-x-internal="running-javascript-execution-context">running JavaScript execution context</a>.<li><p>Add <var>settings</var> to the currently running <a href="#concept-task" id="calling-scripts:concept-task">task</a>'s <a href="#script-evaluation-environment-settings-object-set" id="calling-scripts:script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a>.</ol>

  <p>The steps to <dfn id="clean-up-after-running-script" data-export="">clean up after running script</dfn> with an <a href="#environment-settings-object" id="calling-scripts:environment-settings-object-3">environment settings object</a> <var>settings</var> are as follows:</p>

  <ol><li><p>Assert: <var>settings</var>'s <a href="#realm-execution-context" id="calling-scripts:realm-execution-context-2">realm execution context</a> is the <a id="calling-scripts:running-javascript-execution-context-2" href="https://tc39.es/ecma262/#running-execution-context" data-x-internal="running-javascript-execution-context">running JavaScript execution context</a>.<li><p>Remove <var>settings</var>'s <a href="#realm-execution-context" id="calling-scripts:realm-execution-context-3">realm execution context</a> from the <a id="calling-scripts:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>If the <a id="calling-scripts:javascript-execution-context-stack-3" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> is now empty, <a href="#perform-a-microtask-checkpoint" id="calling-scripts:perform-a-microtask-checkpoint">perform a microtask checkpoint</a>. (If this runs scripts, these algorithms will be invoked reentrantly.)</ol>

  <p class="note">These algorithms are not invoked by one script directly calling another, but they can be invoked reentrantly in an indirect manner, e.g. if a script dispatches an event which has event listeners registered.</p>

  <p>The <dfn id="running-script">running script</dfn> is the <a href="#concept-script" id="calling-scripts:concept-script">script</a> in the [[HostDefined]] field in the ScriptOrModule component of the <a id="calling-scripts:running-javascript-execution-context-3" href="https://tc39.es/ecma262/#running-execution-context" data-x-internal="running-javascript-execution-context">running JavaScript execution context</a>.</p>


  <h5 id="killing-scripts"><span class="secno">8.1.4.5</span> Killing scripts<a href="#killing-scripts" class="self-link"></a></h5>

  <p>Although the JavaScript specification does not account for this possibility, it's sometimes necessary to <dfn id="abort-a-running-script">abort a running script</dfn>. This causes any <a href="https://tc39.es/ecma262/#sec-runtime-semantics-scriptevaluation" id="killing-scripts:js-scriptevaluation" data-x-internal="js-scriptevaluation">ScriptEvaluation</a> or <a id="killing-scripts:source-text-module-record" href="https://tc39.es/ecma262/#sec-source-text-module-records" data-x-internal="source-text-module-record">Source Text Module Record</a> <a href="https://tc39.es/ecma262/#sec-moduleevaluation" id="killing-scripts:js-evaluate" data-x-internal="js-evaluate">Evaluate</a> invocations to cease immediately, emptying the <a id="killing-scripts:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> without triggering any of the normal mechanisms like <code>finally</code> blocks. <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <p>User agents may impose resource limitations on scripts, for example CPU quotas, memory limits, total execution time limits, or bandwidth limitations. When a script exceeds a limit, the user agent may either throw a <a id="killing-scripts:quotaexceedederror" href="https://triple-underscore.github.io/WebIDL-ja.html#quotaexceedederror" data-x-internal="quotaexceedederror">"<code>QuotaExceededError</code>"</a> <code id="killing-scripts:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>, <a href="#abort-a-running-script" id="killing-scripts:abort-a-running-script">abort the script</a> without an exception, prompt the user, or throttle script execution.</p>

  <div class="example"><p>For example, the following script never terminates. A user agent could, after waiting for a few seconds, prompt the user to either terminate the script or let it continue.</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- k>while</c-> <c- p>(</c-><c- kc>true</c-><c- p>)</c-> <c- p>{</c-> <c- d>/* loop */</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  </div>

  <p>User agents are encouraged to allow users to disable scripting whenever the user is prompted either by a script (e.g. using the <code id="killing-scripts:dom-alert"><a href="timers-and-user-prompts.html#dom-alert">window.alert()</a></code> API) or because of a script's actions (e.g. because it has exceeded a time limit).</p>

  <p>If scripting is disabled while a script is executing, the script should be terminated immediately.</p>

  <p>User agents may allow users to specifically disable scripts just for the purposes of closing a <a id="killing-scripts:browsing-context" href="browsers.html#browsing-context">browsing context</a>.</p>

  <p class="example">For example, the prompt mentioned in the example above could also offer the user with a mechanism to just close the page entirely, without running any <code id="killing-scripts:event-unload"><a href="indices.html#event-unload">unload</a></code> event handlers.</p>

  

  <h5 id="runtime-script-errors"><span class="secno">8.1.4.6</span> Runtime script errors<a href="#runtime-script-errors" class="self-link"></a></h5>

  

  

  <p>When the user agent is required to <dfn id="report-the-error">report an error</dfn> for a particular <a href="#concept-script" id="runtime-script-errors:concept-script">script</a> <var>script</var> with a particular position <var>line</var>:<var>col</var>, using a particular target <var>target</var>, it must run these steps, after which the error is either <dfn id="concept-error-handled"><i>handled</i></dfn> or <dfn id="concept-error-nothandled"><i>not handled</i></dfn>:</p>

  <ol><li><p>If <var>target</var> is <a href="#in-error-reporting-mode" id="runtime-script-errors:in-error-reporting-mode">in error reporting mode</a>, then return; the error is <i id="runtime-script-errors:concept-error-nothandled"><a href="#concept-error-nothandled">not handled</a></i>.<li><p>Let <var>target</var> be <dfn id="in-error-reporting-mode">in error reporting mode</dfn>.<li><p><a id="runtime-script-errors:tracking-vector" title="There is a tracking vector here." href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" class="tracking-vector" data-x-internal="tracking-vector"><img width="46" alt="(This is a tracking vector.)" crossorigin="" src="https://resources.whatwg.org/tracking-vector.svg" height="64"></a> Let <var>message</var> be an <a id="runtime-script-errors:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> string describing the error in a helpful manner.<li><p>Let <var>errorValue</var> be the value that represents the error: in the case of an uncaught exception, that would be the value that was thrown; in the case of a JavaScript error that would be an <code id="runtime-script-errors:idl-error"><a data-x-internal="idl-error" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-Error">Error</a></code> object. If there is no corresponding value, then the null value must be used instead.<li><p>Let <var>urlString</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="runtime-script-errors:concept-url-serializer" data-x-internal="concept-url-serializer">URL serializer</a> to the <a id="runtime-script-errors:url-record" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> that corresponds to the resource from which <var>script</var> was obtained.</p>

    <p class="note">The resource containing the script will typically be the file from which the <code id="runtime-script-errors:document"><a href="dom.html#document">Document</a></code> was parsed, e.g. for inline <code id="runtime-script-errors:the-script-element"><a href="scripting.html#the-script-element">script</a></code> elements or <a href="#event-handler-content-attributes" id="runtime-script-errors:event-handler-content-attributes">event handler content attributes</a>; or the JavaScript file that the script was in, for external scripts. Even for dynamically-generated scripts, user agents are strongly encouraged to attempt to keep track of the original source of a script. For example, if an external script uses the <code id="runtime-script-errors:dom-document-write"><a href="dynamic-markup-insertion.html#dom-document-write">document.write()</a></code> API to insert an inline <code id="runtime-script-errors:the-script-element-2"><a href="scripting.html#the-script-element">script</a></code> element during parsing, the URL of the resource containing the script would ideally be reported as being the external script, and the line number might ideally be reported as the line with the <code id="runtime-script-errors:dom-document-write-2"><a href="dynamic-markup-insertion.html#dom-document-write">document.write()</a></code> call or where the string passed to that call was first constructed. Naturally, implementing this can be somewhat non-trivial.</p>

    <p class="note">User agents are similarly encouraged to keep careful track of the original line numbers, even in the face of <code id="runtime-script-errors:dom-document-write-3"><a href="dynamic-markup-insertion.html#dom-document-write">document.write()</a></code> calls mutating the document as it is parsed, or <a href="#event-handler-content-attributes" id="runtime-script-errors:event-handler-content-attributes-2">event handler content attributes</a> spanning multiple lines.</p>
   <li><p>If <var>script</var>'s <a href="#muted-errors" id="runtime-script-errors:muted-errors">muted errors</a> is true, then set <var>message</var> to "<code>Script error.</code>", <var>urlString</var> to the empty string, <var>line</var> and <var>col</var> to 0, and <var>errorValue</var> to null.<li><p>Let <var>notHandled</var> be the result of <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="runtime-script-errors:concept-event-fire" data-x-internal="concept-event-fire">firing an event</a> named <code id="runtime-script-errors:event-error"><a href="indices.html#event-error">error</a></code> at <var>target</var>, using <code id="runtime-script-errors:errorevent"><a href="#errorevent">ErrorEvent</a></code>, with the <code id="runtime-script-errors:dom-event-cancelable"><a data-x-internal="dom-event-cancelable" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-cancelable">cancelable</a></code> attribute initialized to true, the <code id="runtime-script-errors:dom-errorevent-message"><a href="#dom-errorevent-message">message</a></code> attribute initialized to <var>message</var>, the <code id="runtime-script-errors:dom-errorevent-filename"><a href="#dom-errorevent-filename">filename</a></code> attribute initialized to <var>urlString</var>, the <code id="runtime-script-errors:dom-errorevent-lineno"><a href="#dom-errorevent-lineno">lineno</a></code> attribute initialized to <var>line</var>, the <code id="runtime-script-errors:dom-errorevent-colno"><a href="#dom-errorevent-colno">colno</a></code> attribute initialized to <var>col</var>, and the <code id="runtime-script-errors:dom-errorevent-error"><a href="#dom-errorevent-error">error</a></code> attribute initialized to <var>errorValue</var>.<li><p>Let <var>target</var> no longer be <a href="#in-error-reporting-mode" id="runtime-script-errors:in-error-reporting-mode-2">in error reporting mode</a>.<li><p>If <var>notHandled</var> is false, then the error is <i id="runtime-script-errors:concept-error-handled"><a href="#concept-error-handled">handled</a></i>. Otherwise, the error is <i id="runtime-script-errors:concept-error-nothandled-2"><a href="#concept-error-nothandled">not handled</a></i>.</p>

    <p class="note">Returning true in an event handler cancels the event per <a href="#the-event-handler-processing-algorithm" id="runtime-script-errors:the-event-handler-processing-algorithm">the event handler processing algorithm</a>.</p>
   </ol>

  <p id="runtime-script-errors-in-documents">When the user agent is to <dfn id="report-the-exception" data-lt="report the exception|report an exception" data-export="">report an exception</dfn> <var>E</var>, the user agent must <a href="#report-the-error" id="runtime-script-errors:report-the-error">report the error</a> for the relevant <a href="#concept-script" id="runtime-script-errors:concept-script-2">script</a>, with the problematic position (line number and column number) in the resource containing the script, using the <a href="#concept-settings-object-global" id="runtime-script-errors:concept-settings-object-global">global object</a> specified by the script's <a href="#settings-object" id="runtime-script-errors:settings-object">settings object</a> as the target. If the error is still <i id="runtime-script-errors:concept-error-nothandled-3"><a href="#concept-error-nothandled">not handled</a></i> after this, then the error may be reported to a developer console.</p>

  <p class="XXX">The existence of both <a href="#report-the-error" id="runtime-script-errors:report-the-error-2">report an error</a> and <a href="#report-the-exception" id="runtime-script-errors:report-the-exception">report an exception</a> is confusing, and both algorithms have known problems. You can track future cleanup in this area in <a href="https://github.com/whatwg/html/issues/958">issue #958</a>.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ErrorEvent" title="The ErrorEvent interface represents events providing information related to errors in scripts or in files.">ErrorEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>10+</span></span><hr><span class="opera yes"><span>Opera</span><span>11+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><p id="the-errorevent-interface">The <code id="runtime-script-errors:errorevent-2"><a href="#errorevent">ErrorEvent</a></code> interface is defined as follows:</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='errorevent'><c- g>ErrorEvent</c-></dfn> : <a id='runtime-script-errors:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <a href='https://triple-underscore.github.io/DOM4-ja.html#concept-event-constructor' id='runtime-script-errors:dom-event-constructor' data-x-internal='dom-event-constructor'><c- g>constructor</c-></a>(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#erroreventinit' id='runtime-script-errors:erroreventinit'><c- n>ErrorEventInit</c-></a> <c- g>eventInitDict</c-> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-errorevent-message' id='runtime-script-errors:dom-errorevent-message-2'><c- g>message</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-errorevent-filename' id='runtime-script-errors:dom-errorevent-filename-2'><c- g>filename</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-errorevent-lineno' id='runtime-script-errors:dom-errorevent-lineno-2'><c- g>lineno</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-errorevent-colno' id='runtime-script-errors:dom-errorevent-colno-2'><c- g>colno</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>any</c-> <a href='#dom-errorevent-error' id='runtime-script-errors:dom-errorevent-error-2'><c- g>error</c-></a>;
};

<c- b>dictionary</c-> <dfn id='erroreventinit'><c- g>ErrorEventInit</c-></dfn> : <a id='runtime-script-errors:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>DOMString</c-> <c- g>message</c-> = "";
  <c- b>USVString</c-> <c- g>filename</c-> = "";
  <c- b>unsigned</c-> <c- b>long</c-> <c- g>lineno</c-> = 0;
  <c- b>unsigned</c-> <c- b>long</c-> <c- g>colno</c-> = 0;
  <c- b>any</c-> <c- g>error</c-> = <c- b>null</c->;
};</code></pre>

  <p><dfn id="dom-errorevent-message"><code>message</code></dfn>属性は、属性が初期化された値を返さなければならない。これはエラーメッセージを表す。</p>

  <p><dfn id="dom-errorevent-filename"><code>filename</code></dfn>属性は、属性が初期化された値を返さなければならない。It represents the <a id="runtime-script-errors:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> of the script in which the error originally occurred.</p>

  <p><dfn id="dom-errorevent-lineno"><code>lineno</code></dfn>属性は、属性が初期化された値を返さなければならない。これは、スクリプトでエラーが発生した行番号を表す。</p>

  <p><dfn id="dom-errorevent-colno"><code>colno</code></dfn>属性は、属性が初期化された値を返さなければならない。これは、スクリプトでエラーが発生した列番号を表す。</p>

  <p><dfn id="dom-errorevent-error"><code>error</code></dfn>属性は、属性が初期化された値を返さなければならない。Where appropriate, it is set to the object representing the error (e.g., the exception object in the case of an uncaught DOM exception).</p>

  

  <h5 id="unhandled-promise-rejections"><span class="secno">8.1.4.7</span> Unhandled promise rejections<a href="#unhandled-promise-rejections" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/rejectionhandled_event" title="The rejectionhandled event is sent to the script's global scope (usually window but also Worker) whenever a JavaScript Promise is rejected but after the promise rejection has been handled.">Window/rejectionhandled_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=unhandledrejection" title="unhandledrejection/rejectionhandled events">caniuse.com table</a></span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/unhandledrejection_event" title="The unhandledrejection event is sent to the global scope of a script when a JavaScript Promise that has no rejection handler is rejected; typically, this is the window, but may also be a Worker.">Window/unhandledrejection_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=unhandledrejection" title="unhandledrejection/rejectionhandled events">caniuse.com table</a></span></span></div></div></div>

  <p>In addition to synchronous <a href="#runtime-script-errors">runtime script errors</a>, scripts may experience asynchronous promise rejections, tracked via the <code id="unhandled-promise-rejections:event-unhandledrejection"><a href="indices.html#event-unhandledrejection">unhandledrejection</a></code> and <code id="unhandled-promise-rejections:event-rejectionhandled"><a href="indices.html#event-rejectionhandled">rejectionhandled</a></code> events. Tracking these rejections is done via the <a href="#the-hostpromiserejectiontracker-implementation" id="unhandled-promise-rejections:the-hostpromiserejectiontracker-implementation">HostPromiseRejectionTracker</a> abstract operation, but reporting them is defined here.</p>

  

  <p>To <dfn id="notify-about-rejected-promises">notify about rejected promises</dfn> on a given <a href="#environment-settings-object" id="unhandled-promise-rejections:environment-settings-object">environment settings object</a> <var>settings object</var>:</p>

  <ol><li><p>Let <var>list</var> be a copy of <var>settings object</var>'s <a href="#about-to-be-notified-rejected-promises-list" id="unhandled-promise-rejections:about-to-be-notified-rejected-promises-list">about-to-be-notified rejected promises list</a>.<li><p>If <var>list</var> is empty, return.<li><p>Clear <var>settings object</var>'s <a href="#about-to-be-notified-rejected-promises-list" id="unhandled-promise-rejections:about-to-be-notified-rejected-promises-list-2">about-to-be-notified rejected promises list</a>.<li><p>Let <var>global</var> be <var>settings object</var>'s <a href="#concept-settings-object-global" id="unhandled-promise-rejections:concept-settings-object-global">global object</a>.<li><p><a href="#queue-a-global-task" id="unhandled-promise-rejections:queue-a-global-task">Queue a global task</a> on the <a href="#dom-manipulation-task-source" id="unhandled-promise-rejections:dom-manipulation-task-source">DOM manipulation task source</a> given <var>global</var> to run the following substep:</p>

    <ol><li><p>For each promise <var>p</var> in <var>list</var>:</p>

      <ol><li><p>If <var>p</var>'s [[PromiseIsHandled]] internal slot is true, continue to the next iteration of the loop.<li><p>Let <var>notHandled</var> be the result of <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="unhandled-promise-rejections:concept-event-fire" data-x-internal="concept-event-fire">firing an event</a> named <code id="unhandled-promise-rejections:event-unhandledrejection-2"><a href="indices.html#event-unhandledrejection">unhandledrejection</a></code> at <var>global</var> , using <code id="unhandled-promise-rejections:promiserejectionevent"><a href="#promiserejectionevent">PromiseRejectionEvent</a></code>, with the <code id="unhandled-promise-rejections:dom-event-cancelable"><a data-x-internal="dom-event-cancelable" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-cancelable">cancelable</a></code> attribute initialized to true, the <code id="unhandled-promise-rejections:dom-promiserejectionevent-promise"><a href="#dom-promiserejectionevent-promise">promise</a></code> attribute initialized to <var>p</var>, and the <code id="unhandled-promise-rejections:dom-promiserejectionevent-reason"><a href="#dom-promiserejectionevent-reason">reason</a></code> attribute initialized to the value of <var>p</var>'s [[PromiseResult]] internal slot.<li><p>If <var>notHandled</var> is false, then the promise rejection is <i id="unhandled-promise-rejections:concept-promise-rejection-handled"><a href="#concept-promise-rejection-handled">handled</a></i>. Otherwise, the promise rejection is <i id="unhandled-promise-rejections:concept-promise-rejection-nothandled"><a href="#concept-promise-rejection-nothandled">not handled</a></i>.<li><p>If <var>p</var>'s [[PromiseIsHandled]] internal slot is false, add <var>p</var> to <var>settings object</var>'s <a href="#outstanding-rejected-promises-weak-set" id="unhandled-promise-rejections:outstanding-rejected-promises-weak-set">outstanding rejected promises weak set</a>.</ol>
     </ol>
   </ol>

  <p>This algorithm results in promise rejections being marked as <dfn id="concept-promise-rejection-handled"><i>handled</i></dfn> or <dfn id="concept-promise-rejection-nothandled"><i>not handled</i></dfn>. These concepts parallel <i id="unhandled-promise-rejections:concept-error-handled"><a href="#concept-error-handled">handled</a></i> and <i id="unhandled-promise-rejections:concept-error-nothandled"><a href="#concept-error-nothandled">not handled</a></i> script errors. If a rejection is still <i id="unhandled-promise-rejections:concept-promise-rejection-nothandled-2"><a href="#concept-promise-rejection-nothandled">not handled</a></i> after this, then the rejection may be reported to a developer console.</p>


  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent/PromiseRejectionEvent" title="The PromiseRejectionEvent() constructor returns a newly created PromiseRejectionEvent, which represents events fired when a JavaScript Promise is rejected.">PromiseRejectionEvent/PromiseRejectionEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span></div></div></div><p id="the-promiserejectionevent-interface">The <code id="unhandled-promise-rejections:promiserejectionevent-2"><a href="#promiserejectionevent">PromiseRejectionEvent</a></code> interface is defined as follows:</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent" title="The PromiseRejectionEvent interface represents events which are sent to the global script context when JavaScript Promises are rejected.">PromiseRejectionEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span></div></div></div><pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='promiserejectionevent'><c- g>PromiseRejectionEvent</c-></dfn> : <a id='unhandled-promise-rejections:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <a href='https://triple-underscore.github.io/DOM4-ja.html#concept-event-constructor' id='unhandled-promise-rejections:dom-event-constructor' data-x-internal='dom-event-constructor'><c- g>constructor</c-></a>(<c- b>DOMString</c-> <c- g>type</c->, <a href='#promiserejectioneventinit' id='unhandled-promise-rejections:promiserejectioneventinit'><c- n>PromiseRejectionEventInit</c-></a> <c- g>eventInitDict</c->);

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>Promise</c->&lt;<c- b>any</c->> <a href='#dom-promiserejectionevent-promise' id='unhandled-promise-rejections:dom-promiserejectionevent-promise-2'><c- g>promise</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>any</c-> <a href='#dom-promiserejectionevent-reason' id='unhandled-promise-rejections:dom-promiserejectionevent-reason-2'><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <dfn id='promiserejectioneventinit'><c- g>PromiseRejectionEventInit</c-></dfn> : <a id='unhandled-promise-rejections:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>required</c-> <c- b>Promise</c->&lt;<c- b>any</c->> <c- g>promise</c->;
  <c- b>any</c-> <c- g>reason</c->;
};</code></pre>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent/promise" title="The PromiseRejectionEvent interface's promise read-only property indicates the JavaScript Promise which was rejected. You can examine the event's PromiseRejectionEvent.reason property to learn why the promise was rejected.">PromiseRejectionEvent/promise</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span></div></div></div><p>The <dfn id="dom-promiserejectionevent-promise"><code>promise</code></dfn> attribute must return the value it was initialized to. It represents the promise which this notification is about.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PromiseRejectionEvent/reason" title="The PromiseRejectionEvent reason read-only property is any JavaScript value or Object which provides the reason passed into Promise.reject(). This in theory provides information about why the promise was rejected.">PromiseRejectionEvent/reason</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>36+</span></span></div></div></div><p>The <dfn id="dom-promiserejectionevent-reason"><code>reason</code></dfn> attribute must return the value it was initialized to. It represents the rejection reason for the promise.</p>

  <h4 id="javascript-specification-host-hooks"><span class="secno">8.1.5</span> JavaScript specification host hooks<a href="#javascript-specification-host-hooks" class="self-link"></a></h4>

  <p>The JavaScript specification contains a number of <a id="javascript-specification-host-hooks:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> abstract operations, that vary depending on the host environment. This section defines them for user agent hosts.</p><span id="integration-with-the-javascript-job-queue"></span> <span id="enqueuejob(queuename,-job,-arguments)"></span><h5 id="hostenqueuepromisejob"><span class="secno">8.1.5.1</span> <dfn>HostEnqueuePromiseJob</dfn>(<var>job</var>, <var>realm</var>)<a href="#hostenqueuepromisejob" class="self-link"></a></h5>

  <p>JavaScript contains an <a id="hostenqueuepromisejob:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/ecma262/#sec-hostenqueuepromisejob" id="hostenqueuepromisejob:js-hostenqueuepromisejob" data-x-internal="js-hostenqueuepromisejob">HostEnqueuePromiseJob</a>(<var>job</var>, <var>realm</var>) abstract operation to schedule Promise-related operations. HTML schedules these operations in the microtask queue. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <ol><li><p>If <var>realm</var> is not null, then let <var>job settings</var> be the <a href="#concept-realm-settings-object" id="hostenqueuepromisejob:concept-realm-settings-object">settings object</a> for <var>realm</var>. Otherwise, let <var>job settings</var> be null.</p>

     <div class="note"><p>If <var>realm</var> is not null, it is the <a href="https://tc39.es/ecma262/#sec-code-realms" id="hostenqueuepromisejob:javascript-realm" data-x-internal="javascript-realm">Realm</a> of the author code that will run. When <var>job</var> is returned by <a id="hostenqueuepromisejob:newpromisereactionjob" href="https://tc39.es/ecma262/#sec-newpromisereactionjob" data-x-internal="newpromisereactionjob">NewPromiseReactionJob</a>, it is the realm of the promise's handler function. When <var>job</var> is returned by <a id="hostenqueuepromisejob:newpromiseresolvethenablejob" href="https://tc39.es/ecma262/#sec-newpromiseresolvethenablejob" data-x-internal="newpromiseresolvethenablejob">NewPromiseResolveThenableJob</a>, it is the realm of the <code>then</code> function.<p>If <var>realm</var> is null, either no author code will run or author code is guaranteed to throw. For the former, the author may not have passed in code to run, such as in <code>promise.then(null, null)</code>. For the latter, it is because a revoked Proxy was passed. In both cases, all the steps below that would otherwise use <var>job settings</var> get skipped.</p>
     </div>
   <li><p>Let <var>incumbent settings</var> be the <a href="#incumbent-settings-object" id="hostenqueuepromisejob:incumbent-settings-object">incumbent settings object</a>.<li><p>Let <var>active script</var> be the <a href="#active-script" id="hostenqueuepromisejob:active-script">active script</a>.<li><p>Let <var>script execution context</var> be null.<li><p>If <var>active script</var> is not null, set <var>script execution context</var> to a new <a id="hostenqueuepromisejob:javascript-execution-context" href="https://tc39.es/ecma262/#sec-execution-contexts" data-x-internal="javascript-execution-context">JavaScript execution context</a>, with its Function field set to null, its Realm field set to <var>active script</var>'s <a href="#settings-object" id="hostenqueuepromisejob:settings-object">settings object</a>'s <a href="#environment-settings-object's-realm" id="hostenqueuepromisejob:environment-settings-object's-realm">Realm</a>, and its ScriptOrModule set to <var>active script</var>'s <a href="#concept-script-record" id="hostenqueuepromisejob:concept-script-record">record</a>.</p>

    <p class="note">As seen below, this is used in order to propagate the current <a href="#active-script" id="hostenqueuepromisejob:active-script-2">active script</a> forward to the time when the job is executed.</p>

    <div class="example"><p>A case where <var>active script</var> is non-null, and saving it in this way is useful, is the following:</p>

     <pre><code class='js'>Promise<c- p>.</c->resolve<c- p>(</c-><c- t>'import(`./example.mjs`)'</c-><c- p>).</c->then<c- p>(</c->eval<c- p>);</c-></code></pre>

     <p>Without this step (and the steps below that use it), there would be no <a href="#active-script" id="hostenqueuepromisejob:active-script-3">active script</a> when the <code id="hostenqueuepromisejob:import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> expression is evaluated, since <code id="hostenqueuepromisejob:eval()"><a data-x-internal="eval()" href="https://tc39.es/ecma262/#sec-eval-x">eval()</a></code> is a built-in function that does not originate from any particular <a href="#concept-script" id="hostenqueuepromisejob:concept-script">script</a>.</p>

     <p>With this step in place, the active script is propagated from the above code into the job, allowing <code id="hostenqueuepromisejob:import()-2"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> to use the original script's <a href="#concept-script-base-url" id="hostenqueuepromisejob:concept-script-base-url">base URL</a> appropriately.</p>
    </div>

    <div class="example"><p><var>active script</var> can be null if the user clicks on the following button:</p>

     <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>onclick</c-><c- o>=</c-><c- s>"Promise.resolve('import(`./example.mjs`)').then(eval)"</c-><c- p>></c->Click me<c- p>&lt;/</c-><c- f>button</c-><c- p>></c-></code></pre>

     <p>In this case, the JavaScript function for the <a href="#event-handlers" id="hostenqueuepromisejob:event-handlers">event handler</a> will be created by the <a href="#getting-the-current-value-of-the-event-handler" id="hostenqueuepromisejob:getting-the-current-value-of-the-event-handler">get the current value of the event handler</a> algorithm, which creates a function with null [[ScriptOrModule]] value. Thus, when the promise machinery calls <a href="#hostenqueuepromisejob" id="hostenqueuepromisejob:hostenqueuepromisejob">HostEnqueuePromiseJob</a>, there will be no <a href="#active-script" id="hostenqueuepromisejob:active-script-4">active script</a> to pass along.</p>

     <p>As a consequence, this means that when the <code id="hostenqueuepromisejob:import()-3"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> expression is evaluated, there will still be no <a href="#active-script" id="hostenqueuepromisejob:active-script-5">active script</a>. Fortunately that is handled by our implementations of <a href="#hostresolveimportedmodule(referencingscriptormodule,-specifier)" id="hostenqueuepromisejob:hostresolveimportedmodule(referencingscriptormodule,-specifier)">HostResolveImportedModule</a> and <a href="#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)" id="hostenqueuepromisejob:hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)">HostImportModuleDynamically</a>, by falling back to using the <a href="#current-settings-object" id="hostenqueuepromisejob:current-settings-object">current settings object</a>'s <a href="#api-base-url" id="hostenqueuepromisejob:api-base-url">API base URL</a>.</p>
    </div>
   <li><p><a href="#queue-a-microtask" id="hostenqueuepromisejob:queue-a-microtask">Queue a microtask</a> on the <a id="hostenqueuepromisejob:surrounding-agent" href="https://tc39.es/ecma262/#surrounding-agent" data-x-internal="surrounding-agent">surrounding agent</a>'s <a href="#concept-agent-event-loop" id="hostenqueuepromisejob:concept-agent-event-loop">event loop</a> to perform the following steps:</p>

    <ol><li><p>If <var>job settings</var> is not null, then <a href="#check-if-we-can-run-script" id="hostenqueuepromisejob:check-if-we-can-run-script">check if we can run script</a> with <var>job settings</var>. If this returns "do not run" then return.<li><p>If <var>job settings</var> is not null, then <a href="#prepare-to-run-script" id="hostenqueuepromisejob:prepare-to-run-script">prepare to run script</a> with <var>job settings</var>.</p>

      <p class="note">This affects the <a href="#concept-entry-everything" id="hostenqueuepromisejob:concept-entry-everything">entry</a> concept while the job runs.</p>
     <li><p><a href="#prepare-to-run-a-callback" id="hostenqueuepromisejob:prepare-to-run-a-callback">Prepare to run a callback</a> with <var>incumbent settings</var>.</p>

      <p class="note">This affects the <a href="#concept-incumbent-everything" id="hostenqueuepromisejob:concept-incumbent-everything">incumbent</a> concept while the job runs.</p>
     <li><p>If <var>script execution context</var> is not null, then <a href="https://triple-underscore.github.io/infra-ja.html#stack-push" id="hostenqueuepromisejob:stack-push" data-x-internal="stack-push">push</a> <var>script execution context</var> onto the <a id="hostenqueuepromisejob:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.</p>

      <p class="note">As explained above, this affects the <a href="#active-script" id="hostenqueuepromisejob:active-script-6">active script</a> while the job runs.</p>
     <li><p>Let <var>result</var> be <var>job</var>().</p>

      <p class="note"><var>job</var> is an <a id="hostenqueuepromisejob:abstract-closure" href="https://tc39.es/ecma262/#sec-abstract-closure" data-x-internal="abstract-closure">abstract closure</a> returned by <a id="hostenqueuepromisejob:newpromisereactionjob-2" href="https://tc39.es/ecma262/#sec-newpromisereactionjob" data-x-internal="newpromisereactionjob">NewPromiseReactionJob</a> or <a id="hostenqueuepromisejob:newpromiseresolvethenablejob-2" href="https://tc39.es/ecma262/#sec-newpromiseresolvethenablejob" data-x-internal="newpromiseresolvethenablejob">NewPromiseResolveThenableJob</a>.</p>
    <li><p>If <var>script execution context</var> is not null, then <a href="https://triple-underscore.github.io/infra-ja.html#stack-pop" id="hostenqueuepromisejob:stack-pop" data-x-internal="stack-pop">pop</a> <var>script execution context</var> from the <a id="hostenqueuepromisejob:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p><a href="#clean-up-after-running-a-callback" id="hostenqueuepromisejob:clean-up-after-running-a-callback">Clean up after running a callback</a> with <var>incumbent settings</var>.<li><p>If <var>job settings</var> is not null, then <a href="#clean-up-after-running-script" id="hostenqueuepromisejob:clean-up-after-running-script">clean up after running script</a> with <var>job settings</var>.<li><p>If <var>result</var> is an <a id="hostenqueuepromisejob:abrupt-completion" href="https://tc39.es/ecma262/#sec-completion-record-specification-type" data-x-internal="abrupt-completion">abrupt completion</a>, then <a href="#report-the-exception" id="hostenqueuepromisejob:report-the-exception">report the exception</a> given by <var>result</var>.[[Value]].</ol>
   </ol>

  <h5 id="hostensurecancompilestrings(callerrealm,-calleerealm)"><span class="secno">8.1.5.2</span> <dfn>HostEnsureCanCompileStrings</dfn>(<var>callerRealm</var>, <var>calleeRealm</var>)<a href="#hostensurecancompilestrings(callerrealm,-calleerealm)" class="self-link"></a></h5>

  <p>JavaScript contains an <a id="hostensurecancompilestrings(callerrealm,-calleerealm):implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/ecma262/#sec-hostensurecancompilestrings" id="hostensurecancompilestrings(callerrealm,-calleerealm):js-hostensurecancompilestrings" data-x-internal="js-hostensurecancompilestrings">HostEnsureCanCompileStrings</a>(<var>callerRealm</var>, <var>calleeRealm</var>) abstract operation. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a><ol><li><p>Perform ? <a href="https://triple-underscore.github.io/CSP3-ja.html#can-compile-strings" id="hostensurecancompilestrings(callerrealm,-calleerealm):csp-ensurecspdoesnotblockstringcompilation" data-x-internal="csp-ensurecspdoesnotblockstringcompilation">EnsureCSPDoesNotBlockStringCompilation</a>(<var>callerRealm</var>, <var>calleeRealm</var>). <a href="references.html#refsCSP">[CSP]</a></ol>

  <h5 id="the-hostpromiserejectiontracker-implementation"><span class="secno">8.1.5.3</span> <dfn>HostPromiseRejectionTracker</dfn>(<var>promise</var>, <var>operation</var>)<a href="#the-hostpromiserejectiontracker-implementation" class="self-link"></a></h5>

  <p>JavaScript contains an <a id="the-hostpromiserejectiontracker-implementation:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/ecma262/#sec-host-promise-rejection-tracker" id="the-hostpromiserejectiontracker-implementation:js-hostpromiserejectiontracker" data-x-internal="js-hostpromiserejectiontracker">HostPromiseRejectionTracker</a>(<var>promise</var>, <var>operation</var>) abstract operation. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <ol><li><p>Let <var>script</var> be the <a href="#running-script" id="the-hostpromiserejectiontracker-implementation:running-script">running script</a>.<li><p>If <var>script</var>'s <a href="#muted-errors" id="the-hostpromiserejectiontracker-implementation:muted-errors">muted errors</a> is true, terminate these steps.<li><p>Let <var>settings object</var> be <var>script</var>'s <a href="#settings-object" id="the-hostpromiserejectiontracker-implementation:settings-object">settings object</a>.</p>
   <li><p>If <var>operation</var> is <code>"reject"</code>,<ol><li><p>Add <var>promise</var> to <var>settings object</var>'s <a href="#about-to-be-notified-rejected-promises-list" id="the-hostpromiserejectiontracker-implementation:about-to-be-notified-rejected-promises-list">about-to-be-notified rejected promises list</a>.</ol>
   <li><p>If <var>operation</var> is <code>"handle"</code>,<ol><li><p>If <var>settings object</var>'s <a href="#about-to-be-notified-rejected-promises-list" id="the-hostpromiserejectiontracker-implementation:about-to-be-notified-rejected-promises-list-2">about-to-be-notified rejected promises list</a> contains <var>promise</var>, then remove <var>promise</var> from that list and return.<li><p>If <var>settings object</var>'s <a href="#outstanding-rejected-promises-weak-set" id="the-hostpromiserejectiontracker-implementation:outstanding-rejected-promises-weak-set">outstanding rejected promises weak set</a> does not contain <var>promise</var>, then return.<li><p>Remove <var>promise</var> from <var>settings object</var>'s <a href="#outstanding-rejected-promises-weak-set" id="the-hostpromiserejectiontracker-implementation:outstanding-rejected-promises-weak-set-2">outstanding rejected promises weak set</a>.<li><p>Let <var>global</var> be <var>settings object</var>'s <a href="#concept-settings-object-global" id="the-hostpromiserejectiontracker-implementation:concept-settings-object-global">global object</a>.<li><p><a href="#queue-a-global-task" id="the-hostpromiserejectiontracker-implementation:queue-a-global-task">Queue a global task</a> on the <a href="#dom-manipulation-task-source" id="the-hostpromiserejectiontracker-implementation:dom-manipulation-task-source">DOM manipulation task source</a> given <var>global</var> to <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="the-hostpromiserejectiontracker-implementation:concept-event-fire" data-x-internal="concept-event-fire">fire an event</a> named <code id="the-hostpromiserejectiontracker-implementation:event-rejectionhandled"><a href="indices.html#event-rejectionhandled">rejectionhandled</a></code> at <var>global</var>, using <code id="the-hostpromiserejectiontracker-implementation:promiserejectionevent"><a href="#promiserejectionevent">PromiseRejectionEvent</a></code>, with the <code id="the-hostpromiserejectiontracker-implementation:dom-promiserejectionevent-promise"><a href="#dom-promiserejectionevent-promise">promise</a></code> attribute initialized to <var>promise</var>, and the <code id="the-hostpromiserejectiontracker-implementation:dom-promiserejectionevent-reason"><a href="#dom-promiserejectionevent-reason">reason</a></code> attribute initialized to the value of <var>promise</var>'s [[PromiseResult]] internal slot.</ol>
   </ol>

  

  <h5 id="integration-with-the-javascript-module-system"><span class="secno">8.1.5.4</span> Module-related host hooks<a href="#integration-with-the-javascript-module-system" class="self-link"></a></h5>

  <p>The JavaScript specification defines a syntax for modules, as well as some host-agnostic parts of their processing model. This specification defines the rest of their processing model: how the module system is bootstrapped, via the <code id="integration-with-the-javascript-module-system:the-script-element"><a href="scripting.html#the-script-element">script</a></code> element with <code id="integration-with-the-javascript-module-system:attr-script-type"><a href="scripting.html#attr-script-type">type</a></code> attribute set to "<code>module</code>", and how modules are fetched, resolved, and executed. <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <p class="note">Although the JavaScript specification speaks in terms of "scripts" versus "modules", in general this specification speaks in terms of <a href="#classic-script" id="integration-with-the-javascript-module-system:classic-script">classic scripts</a> versus <a href="#module-script" id="integration-with-the-javascript-module-system:module-script">module scripts</a>, since both of them use the <code id="integration-with-the-javascript-module-system:the-script-element-2"><a href="scripting.html#the-script-element">script</a></code> element.</p>

  <dl class="domintro"><dt><var>modulePromise</var> = <code id="integration-with-the-javascript-module-system:import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import(<var>specifier</var>)</a></code><dd><p>Returns a promise for the module namespace object for the <a href="#module-script" id="integration-with-the-javascript-module-system:module-script-2">module script</a> identified by <var>specifier</var>. This allows dynamic importing of module scripts at runtime, instead of statically using the <code>import</code> statement form. The specifier will be <a href="#resolve-a-module-specifier" id="integration-with-the-javascript-module-system:resolve-a-module-specifier">resolved</a> relative to the <a href="#active-script" id="integration-with-the-javascript-module-system:active-script">active script</a>'s <a href="#concept-script-base-url" id="integration-with-the-javascript-module-system:concept-script-base-url">base URL</a>.</p>

    <p>The returned promise will be rejected if an invalid specifier is given, or if a failure is encountered while <a href="#fetch-an-import()-module-script-graph" id="integration-with-the-javascript-module-system:fetch-an-import()-module-script-graph">fetching</a> or <a href="#run-a-module-script" id="integration-with-the-javascript-module-system:run-a-module-script">evaluating</a> the resulting module graph.</p>

    <p>This syntax can be used inside both <a href="#classic-script" id="integration-with-the-javascript-module-system:classic-script-2">classic</a> and <a href="#module-script" id="integration-with-the-javascript-module-system:module-script-3">module scripts</a>. It thus provides a bridge into the module-script world, from the classic-script world.</p>
   <dt><var>url</var> = <code id="integration-with-the-javascript-module-system:import.meta"><a data-x-internal="import.meta" href="https://tc39.es/ecma262/#sec-meta-properties">import . meta </a></code><code> . url</code><dd><p>Returns the <a href="#active-script" id="integration-with-the-javascript-module-system:active-script-2">active module script</a>'s <a href="#concept-script-base-url" id="integration-with-the-javascript-module-system:concept-script-base-url-2">base URL</a>.</p>

    <p>This syntax can only be used inside <a href="#module-script" id="integration-with-the-javascript-module-system:module-script-4">module scripts</a>.</p>
   </dl>

  <p>A <dfn id="module-map">module map</dfn> is a <a href="https://triple-underscore.github.io/infra-ja.html#ordered-map" id="integration-with-the-javascript-module-system:ordered-map" data-x-internal="ordered-map">map</a> of <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="integration-with-the-javascript-module-system:url-record" data-x-internal="url-record">URL records</a> to values that are either a <a href="#module-script" id="integration-with-the-javascript-module-system:module-script-5">module script</a>, null (used to represent failed fetches), or a placeholder value "<code>fetching</code>". <a href="#module-map" id="integration-with-the-javascript-module-system:module-map">Module maps</a> are used to ensure that imported JavaScript modules are only fetched, parsed, and evaluated once per <code id="integration-with-the-javascript-module-system:document"><a href="dom.html#document">Document</a></code> or <a href="workers.html#workers">worker</a>.</p>

  <div class="example"><p>Since <a href="#module-map" id="integration-with-the-javascript-module-system:module-map-2">module maps</a> are keyed by URL, the following code will create three separate entries in the <a href="#module-map" id="integration-with-the-javascript-module-system:module-map-3">module map</a>, since it results in three different URLs:</p>

   <pre><code class='js'><c- kr>import</c-> <c- u>"https://example.com/module.mjs"</c-><c- p>;</c->
<c- kr>import</c-> <c- u>"https://example.com/module.mjs#map-buster"</c-><c- p>;</c->
<c- kr>import</c-> <c- u>"https://example.com/module.mjs?debug=true"</c-><c- p>;</c-></code></pre>

   <p>That is, URL <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-query" id="integration-with-the-javascript-module-system:concept-url-query" data-x-internal="concept-url-query">queries</a> and <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="integration-with-the-javascript-module-system:concept-url-fragment" data-x-internal="concept-url-fragment">fragments</a> can be varied to create distinct entries in the <a href="#module-map" id="integration-with-the-javascript-module-system:module-map-4">module map</a>; they are not ignored. Thus, three separate fetches and three separate module evaluations will be performed.</p>

   <p>In contrast, the following code would only create a single entry in the <a href="#module-map" id="integration-with-the-javascript-module-system:module-map-5">module map</a>, since after applying the <a id="integration-with-the-javascript-module-system:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> to these inputs, the resulting <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="integration-with-the-javascript-module-system:url-record-2" data-x-internal="url-record">URL records</a> are equal:</p>

   <pre><code class='js'><c- kr>import</c-> <c- u>"https://example.com/module2.mjs"</c-><c- p>;</c->
<c- kr>import</c-> <c- u>"https:example.com/module2.mjs"</c-><c- p>;</c->
<c- kr>import</c-> <c- u>"https://///example.com\\module2.mjs"</c-><c- p>;</c->
<c- kr>import</c-> <c- u>"https://example.com/foo/../module2.mjs"</c-><c- p>;</c-></code></pre>

   <p>So in this second example, only one fetch and one module evaluation will occur.</p>

   <p>Note that this behavior is the same as how <a href="workers.html#sharedworker" id="integration-with-the-javascript-module-system:sharedworker">shared workers</a> are keyed by their parsed <a href="workers.html#concept-sharedworkerglobalscope-constructor-url" id="integration-with-the-javascript-module-system:concept-sharedworkerglobalscope-constructor-url">constructor url</a>.</p>
  </div>

  

  <p>To <dfn id="resolve-a-module-specifier">resolve a module specifier</dfn> given a <a id="integration-with-the-javascript-module-system:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>base URL</var> and a <a id="integration-with-the-javascript-module-system:string" href="https://triple-underscore.github.io/infra-ja.html#string" data-x-internal="string">string</a> <var>specifier</var>, perform the following steps. It will return either a <a id="integration-with-the-javascript-module-system:url-record-3" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a> or failure.</p>

  <ol><li><p>Apply the <a id="integration-with-the-javascript-module-system:url-parser-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> to <var>specifier</var>. If the result is not failure, return the result.<li><p>If <var>specifier</var> does not start with the character U+002F SOLIDUS (<code>/</code>), the two-character sequence U+002E FULL STOP, U+002F SOLIDUS (<code>./</code>), or the three-character sequence U+002E FULL STOP, U+002E FULL STOP, U+002F SOLIDUS (<code>../</code>), return failure.</p>

    <p class="note">This restriction is in place so that in the future we can allow custom module loaders to give special meaning to "bare" import specifiers, like <code>import "jquery"</code> or <code>import "web/crypto"</code>. For now any such imports will fail, instead of being treated as relative URLs.</p>
   <li><p>Return the result of applying the <a id="integration-with-the-javascript-module-system:url-parser-3" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> to <var>specifier</var> with <var>base URL</var> as the base URL.</ol>

  

  <div id="module-specifier-examples" class="example"><p>The following are valid module specifiers according to the above algorithm:</p>

   <ul class="brief"><li><code>https://example.com/apples.mjs</code><li><code>http:example.com\pears.js</code> (becomes <code>http://example.com/pears.js</code> as step 1 parses with no base URL)<li><code>//example.com/bananas</code><li><code>./strawberries.mjs.cgi</code><li><code>../lychees</code><li><code>/limes.jsx</code><li><code>data:text/javascript,export default 'grapes';</code><li><code>blob:https://whatwg.org/d0360e2f-caee-469f-9a2f-87d5b0456f6f</code></ul>

   <p>The following are valid module specifiers according to the above algorithm, but will invariably cause failures when they are <a href="#fetch-a-single-module-script" id="integration-with-the-javascript-module-system:fetch-a-single-module-script">fetched</a>:</p>

   <ul class="brief"><li><code>javascript:export default 'artichokes';</code><li><code>data:text/plain,export default 'kale';</code><li><code>about:legumes</code><li><code>wss://example.com/celery</code></ul>

   <p>The following are not valid module specifiers according to the above algorithm:</p>

   <ul class="brief"><li><code>https://eggplant:b/c</code><li><code>pumpkins.js</code><li><code>.tomato</code><li><code>..zucchini.mjs</code><li><code>.\yam.es</code></ul>
  </div>

  

  <h6 id="hostgetimportmetaproperties"><span class="secno">8.1.5.4.1</span> <dfn>HostGetImportMetaProperties</dfn>(<var>moduleRecord</var>)<a href="#hostgetimportmetaproperties" class="self-link"></a></h6><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import.meta" title="The import.meta object exposes context-specific metadata to a JavaScript module. It contains information about the module, like the module's URL.">Reference/Statements/import.meta</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>62+</span></span><span class="safari yes"><span>Safari</span><span>11.1+</span></span><span class="chrome yes"><span>Chrome</span><span>64+</span></span><hr><span class="opera yes"><span>Opera</span><span>51+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>62+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>12+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>64+</span></span><span class="webview_android yes"><span>WebView Android</span><span>64+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div>

  <p>JavaScript contains an <a id="hostgetimportmetaproperties:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/ecma262/#sec-hostgetimportmetaproperties" id="hostgetimportmetaproperties:js-hostgetimportmetaproperties" data-x-internal="js-hostgetimportmetaproperties">HostGetImportMetaProperties</a> abstract operation. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <ol><li><p>Let <var>module script</var> be <var>moduleRecord</var>.[[HostDefined]].<li><p>Let <var>urlString</var> be <var>module script</var>'s <a href="#concept-script-base-url" id="hostgetimportmetaproperties:concept-script-base-url">base URL</a>, <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="hostgetimportmetaproperties:concept-url-serializer" data-x-internal="concept-url-serializer">serialized</a>.<li><p>Return « Record { [[Key]]: "url", [[Value]]: <var>urlString</var> } ».</ol>

  <h6 id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)"><span class="secno">8.1.5.4.2</span> <dfn>HostImportModuleDynamically</dfn>(<var>referencingScriptOrModule</var>, <var>specifier</var>, <var>promiseCapability</var>)<a href="#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)" class="self-link"></a></h6>

  <p>JavaScript contains an <a id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/proposal-dynamic-import/#sec-hostimportmoduledynamically" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):js-hostimportmoduledynamically" data-x-internal="js-hostimportmoduledynamically">HostImportModuleDynamically</a> abstract operation. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <ol><li><p>Let <var>settings object</var> be the <a href="#current-settings-object" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):current-settings-object">current settings object</a>.<li><p>Let <var>base URL</var> be <var>settings object</var>'s <a href="#api-base-url" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):api-base-url">API base URL</a>.<li><p>Let <var>fetch options</var> be the <a href="#default-classic-script-fetch-options" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):default-classic-script-fetch-options">default classic script fetch options</a>.<li><p>If <var>referencingScriptOrModule</var> is not null, then:</p>

    <ol><li><p>Let <var>referencing script</var> be <var>referencingScriptOrModule</var>.[[HostDefined]].</p>

     <li><p>Set <var>settings object</var> to <var>referencing script</var>'s <a href="#settings-object" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):settings-object">settings object</a>.<li><p>Set <var>base URL</var> to <var>referencing script</var>'s <a href="#concept-script-base-url" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):concept-script-base-url">base URL</a>.<li><p>Set <var>fetch options</var> to the <a href="#descendant-script-fetch-options" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):descendant-script-fetch-options">descendant script fetch options</a> for <var>referencing script</var>'s <a href="#concept-script-script-fetch-options" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):concept-script-script-fetch-options">fetch options</a>.</ol>

    <p class="note">As explained above for <a href="#hostresolveimportedmodule(referencingscriptormodule,-specifier)" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):hostresolveimportedmodule(referencingscriptormodule,-specifier)">HostResolveImportedModule</a>, in the common case, <var>referencingScriptOrModule</var> is non-null.</p>
   <li><p><a href="#fetch-an-import()-module-script-graph" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):fetch-an-import()-module-script-graph">Fetch an import() module script graph</a> given <var>specifier</var>, <var>base URL</var>, <var>settings object</var>, and <var>fetch options</var>. Wait until the algorithm asynchronously completes with <var>result</var>.<li><p>If <var>result</var> is null, then:</p>

    <ol><li><p>Let <var>completion</var> be Completion { [[Type]]: throw, [[Value]]: a new <code id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):typeerror"><a data-x-internal="typeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-typeerror">TypeError</a></code>, [[Target]]: empty }.<li><p>Perform <a id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport" href="https://tc39.es/ecma262/#sec-finishdynamicimport" data-x-internal="finishdynamicimport">FinishDynamicImport</a>(<var>referencingScriptOrModule</var>, <var>specifier</var>, <var>promiseCapability</var>, <var>completion</var>).<li><p>Return.</ol>
   <li><p><a href="#run-a-module-script" id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):run-a-module-script">Run the module script</a> <var>result</var>, with the rethrow errors boolean set to true.<li><p>If running the module script throws an exception, then perform <a id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport-2" href="https://tc39.es/ecma262/#sec-finishdynamicimport" data-x-internal="finishdynamicimport">FinishDynamicImport</a>(<var>referencingScriptOrModule</var>, <var>specifier</var>, <var>promiseCapability</var>, the thrown exception completion).<li><p>Otherwise, perform <a id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):finishdynamicimport-3" href="https://tc39.es/ecma262/#sec-finishdynamicimport" data-x-internal="finishdynamicimport">FinishDynamicImport</a>(<var>referencingScriptOrModule</var>, <var>specifier</var>, <var>promiseCapability</var>, <a id="hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability):normalcompletion" href="https://tc39.es/ecma262/#sec-normalcompletion" data-x-internal="normalcompletion">NormalCompletion</a>(undefined)).<li><p>Return undefined.</ol>

  <h6 id="hostresolveimportedmodule(referencingscriptormodule,-specifier)"><span class="secno">8.1.5.4.3</span> <dfn>HostResolveImportedModule</dfn>(<var>referencingScriptOrModule</var>, <var>specifier</var>)<a href="#hostresolveimportedmodule(referencingscriptormodule,-specifier)" class="self-link"></a></h6>

  <p>JavaScript contains an <a id="hostresolveimportedmodule(referencingscriptormodule,-specifier):implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):js-hostresolveimportedmodule" data-x-internal="js-hostresolveimportedmodule">HostResolveImportedModule</a> abstract operation. User agents must use the following implementation: <a href="references.html#refsJAVASCRIPT">[JAVASCRIPT]</a></p>

  <ol><li><p>Let <var>settings object</var> be the <a href="#current-settings-object" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):current-settings-object">current settings object</a>.<li><p>Let <var>base URL</var> be <var>settings object</var>'s <a href="#api-base-url" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):api-base-url">API base URL</a>.<li><p>If <var>referencingScriptOrModule</var> is not null, then:</p>

    <ol><li><p>Let <var>referencing script</var> be <var>referencingScriptOrModule</var>.[[HostDefined]].<li><p>Set <var>settings object</var> to <var>referencing script</var>'s <a href="#settings-object" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):settings-object">settings object</a>.<li><p>Set <var>base URL</var> to <var>referencing script</var>'s <a href="#concept-script-base-url" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-script-base-url">base URL</a>.</ol>

    <div class="example"><p><var>referencingScriptOrModule</var> is not usually null, but will be so for event handlers per the <a href="#getting-the-current-value-of-the-event-handler" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):getting-the-current-value-of-the-event-handler">get the current value of the event handler</a> algorithm. For example, given:</p>

     <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>onclick</c-><c- o>=</c-><c- s>"import('./foo.mjs')"</c-><c- p>></c->Click me<c- p>&lt;/</c-><c- f>button</c-><c- p>></c-></code></pre>

     <p>If a <code id="hostresolveimportedmodule(referencingscriptormodule,-specifier):event-click" class="no-backref"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code> event occurs, then at the time the <code id="hostresolveimportedmodule(referencingscriptormodule,-specifier):import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code> expression runs, <a id="hostresolveimportedmodule(referencingscriptormodule,-specifier):getactivescriptormodule" href="https://tc39.es/ecma262/#sec-getactivescriptormodule" data-x-internal="getactivescriptormodule">GetActiveScriptOrModule</a> will return null, which will be passed to this abstract operation when <a href="https://tc39.es/ecma262/#sec-hostresolveimportedmodule" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):js-hostresolveimportedmodule-2" data-x-internal="js-hostresolveimportedmodule">HostResolveImportedModule</a> is called by <a id="hostresolveimportedmodule(referencingscriptormodule,-specifier):finishdynamicimport" href="https://tc39.es/ecma262/#sec-finishdynamicimport" data-x-internal="finishdynamicimport">FinishDynamicImport</a>.</p>
    </div>
   <li><p>Let <var>moduleMap</var> be <var>settings object</var>'s <a href="#concept-settings-object-module-map" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-settings-object-module-map">module map</a>.<li><p>Let <var>url</var> be the result of <a href="#resolve-a-module-specifier" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):resolve-a-module-specifier">resolving a module specifier</a> given <var>base URL</var> and <var>specifier</var>.<li><p>Assert: <var>url</var> is never failure, because <a href="#resolve-a-module-specifier" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):resolve-a-module-specifier-2">resolving a module specifier</a> must have been previously successful with these same two arguments (either <a href="#validate-requested-module-specifiers">while creating the corresponding module script</a>, or in <a href="#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)">HostImportModuleDynamically</a>).<li><p>Let <var>resolved module script</var> be <var>moduleMap</var>[<var>url</var>]. (This entry must <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):map-exists" data-x-internal="map-exists">exist</a> for us to have gotten to this point.)<li><p>Assert: <var>resolved module script</var> is a <a href="#module-script" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):module-script">module script</a> (i.e., is not null or "<code>fetching</code>").<li><p>Assert: <var>resolved module script</var>'s <a href="#concept-script-record" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-script-record">record</a> is not null.</p>

   <li><p>Return <var>resolved module script</var>'s <a href="#concept-script-record" id="hostresolveimportedmodule(referencingscriptormodule,-specifier):concept-script-record-2">record</a>.</ol>

  

  <h4 id="event-loops"><span class="secno">8.1.6</span> Event loops<a href="#event-loops" class="self-link"></a></h4>

  <h5 id="definitions-3"><span class="secno">8.1.6.1</span> Definitions<a href="#definitions-3" class="self-link"></a></h5>

  <p>To coordinate events, user interaction, scripts, rendering, networking, and so forth, user agents must use <dfn id="event-loop" data-lt="event loop" data-export="">event loops</dfn> as described in this section. Each <a id="definitions-3:agent" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> has an associated <dfn data-dfn-for="agent" id="concept-agent-event-loop" data-export="">event loop</dfn>, which is unique to that agent.</p>

  <p>The <a href="#concept-agent-event-loop" id="definitions-3:concept-agent-event-loop">event loop</a> of a <a href="#similar-origin-window-agent" id="definitions-3:similar-origin-window-agent">similar-origin window agent</a> is known as a <dfn id="window-event-loop">window event loop</dfn>. The <a href="#concept-agent-event-loop" id="definitions-3:concept-agent-event-loop-2">event loop</a> of a <a href="#dedicated-worker-agent" id="definitions-3:dedicated-worker-agent">dedicated worker agent</a>, <a href="#shared-worker-agent" id="definitions-3:shared-worker-agent">shared worker agent</a>, or <a href="#service-worker-agent" id="definitions-3:service-worker-agent">service worker agent</a> is known as a <dfn id="worker-event-loop-2">worker event loop</dfn>. And the <a href="#concept-agent-event-loop" id="definitions-3:concept-agent-event-loop-3">event loop</a> of a <a href="#worklet-agent" id="definitions-3:worklet-agent">worklet agent</a> is known as a <dfn id="worklet-event-loop">worklet event loop</dfn>.</p>

  <div class="note"><p><a href="#event-loop" id="definitions-3:event-loop">Event loops</a> do not necessarily correspond to implementation threads. For example, multiple <a href="#window-event-loop" id="definitions-3:window-event-loop">window event loops</a> could be cooperatively scheduled in a single thread.</p>

   <p>However, for the various worker <a href="https://tc39.es/ecma262/#sec-agents" id="definitions-3:agent-2" data-x-internal="agent">agents</a> that are allocated with [[CanBlock]] set to true, the JavaScript specification does place requirements on them regarding <a id="definitions-3:forward-progress" href="https://tc39.es/ecma262/#sec-forward-progress" data-x-internal="forward-progress">forward progress</a>, which effectively amount to requiring dedicated per-agent threads in those cases.</p>
  </div>

  

  <hr>

  <p>An <a href="#event-loop" id="definitions-3:event-loop-2">event loop</a> has one or more <dfn id="task-queue">task queues</dfn>. A <a href="#task-queue" id="definitions-3:task-queue">task queue</a> is a <a id="definitions-3:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a> of <a href="#concept-task" id="definitions-3:concept-task">tasks</a>.</p>

  <p class="note"><a href="#task-queue" id="definitions-3:task-queue-2">Task queues</a> are <a href="https://triple-underscore.github.io/infra-ja.html#ordered-set" id="definitions-3:set-2" data-x-internal="set">sets</a>, not <a href="https://triple-underscore.github.io/infra-ja.html#queue" id="definitions-3:queue" data-x-internal="queue">queues</a>, because <a href="#step1">step one of the event loop processing model</a> grabs the first <a href="#concept-task-runnable" id="definitions-3:concept-task-runnable"><em>runnable</em></a> <a href="#concept-task" id="definitions-3:concept-task-2">task</a> from the chosen queue, instead of <a href="https://triple-underscore.github.io/infra-ja.html#queue-dequeue" id="definitions-3:dequeue" data-x-internal="dequeue">dequeuing</a> the first task.</p>

  <p class="note">The <a href="#microtask-queue" id="definitions-3:microtask-queue">microtask queue</a> is not a <a href="#task-queue" id="definitions-3:task-queue-3">task queue</a>.</p>

  <p>Tasks encapsulate algorithms that are responsible for such work as:</p>

  <dl><dt> イベント<dd><p>Dispatching an <code id="definitions-3:event"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code> object at a particular <code id="definitions-3:eventtarget"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object is often done by a dedicated task.</p>

    <p class="note">Not all events are dispatched using the <a href="#task-queue" id="definitions-3:task-queue-4">task queue</a>; many are dispatched during other tasks.</p>
   <dt>Parsing<dd><p>The <a id="definitions-3:html-parser" href="parsing.html#html-parser">HTML parser</a> tokenizing one or more bytes, and then processing any resulting tokens, is typically a task.<dt>Callbacks<dd><p>Calling a callback is often done by a dedicated task.<dt>Using a resource<dd><p>When an algorithm <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-fetch" id="definitions-3:concept-fetch" data-x-internal="concept-fetch">fetches</a> a resource, if the fetching occurs in a non-blocking fashion then the processing of the resource once some or all of the resource is available is performed by a task.<dt>Reacting to DOM manipulation<dd><p>Some elements have tasks that trigger in response to DOM manipulation, e.g. when that element is <a href="infrastructure.html#insert-an-element-into-a-document" id="definitions-3:insert-an-element-into-a-document">inserted into the document</a>.</p>
  </dl>

  <p>Formally, a <dfn id="concept-task" data-lt="task" data-export="">task</dfn> is a <a id="definitions-3:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a> which has:</p>

  <dl><dt><dfn id="concept-task-steps">Steps</dfn><dd>A series of steps specifying the work to be done by the task.<dt>A <dfn id="concept-task-source">source</dfn><dd>One of the <a href="#task-source" id="definitions-3:task-source">task sources</a>, used to group and serialize related tasks.<dt>A <dfn id="concept-task-document">document</dfn><dd>A <code id="definitions-3:document"><a href="dom.html#document">Document</a></code> associated with the task, or null for tasks that are not in a <a href="#window-event-loop" id="definitions-3:window-event-loop-2">window event loop</a>.<dt>A <dfn id="script-evaluation-environment-settings-object-set" data-export="">script evaluation environment settings object set</dfn><dd>A <a id="definitions-3:set-3" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a> of <a href="#environment-settings-object" id="definitions-3:environment-settings-object">environment settings objects</a> used for tracking script evaluation during the task.</dl>

  <p>A <a href="#concept-task" id="definitions-3:concept-task-3">task</a> is <dfn id="concept-task-runnable">runnable</dfn> if its <a href="#concept-task-document" id="definitions-3:concept-task-document">document</a> is either null or <a id="definitions-3:fully-active" href="browsers.html#fully-active">fully active</a>.</p>

  <p>Per its <a href="#concept-task-source" id="definitions-3:concept-task-source">source</a> field, each <a href="#concept-task" id="definitions-3:concept-task-4">task</a> is defined as coming from a specific <dfn id="task-source" data-export="">task source</dfn>. For each <a href="#event-loop" id="definitions-3:event-loop-3">event loop</a>, every <a href="#task-source" id="definitions-3:task-source-2">task source</a> must be associated with a specific <a href="#task-queue" id="definitions-3:task-queue-5">task queue</a>.</p>

  <p class="note">Essentially, <a href="#task-source" id="definitions-3:task-source-3">task sources</a> are used within standards to separate logically-different types of tasks, which a user agent might wish to distinguish between. <a href="#task-queue" id="definitions-3:task-queue-6">Task queues</a> are used by user agents to coalesce task sources within a given <a href="#event-loop" id="definitions-3:event-loop-4">event loop</a>.</p>

  <p class="example">For example, a user agent could have one <a href="#task-queue" id="definitions-3:task-queue-7">task queue</a> for mouse and key events (to which the <a href="#user-interaction-task-source" id="definitions-3:user-interaction-task-source">user interaction task source</a> is associated), and another to which all other <a href="#task-source" id="definitions-3:task-source-4">task sources</a> are associated. Then, using the freedom granted in the initial step of the <a href="#event-loop-processing-model">event loop processing model</a>, it could give keyboard and mouse events preference over other tasks three-quarters of the time, keeping the interface responsive but not starving other task queues. Note that in this setup, the processing model still enforces that the user agent would never process events from any one <a href="#task-source" id="definitions-3:task-source-5">task source</a> out of order.</p>

  <hr>

  <p>Each <a href="#event-loop" id="definitions-3:event-loop-5">event loop</a> has a <dfn id="currently-running-task">currently running task</dfn>, which is either a <a href="#concept-task" id="definitions-3:concept-task-5">task</a> or null. Initially, this is null. It is used to handle reentrancy.</p>

  <p>Each <a href="#event-loop" id="definitions-3:event-loop-6">event loop</a> has a <dfn id="microtask-queue">microtask queue</dfn>, which is a <a id="definitions-3:queue-2" href="https://triple-underscore.github.io/infra-ja.html#queue" data-x-internal="queue">queue</a> of <a href="#microtask" id="definitions-3:microtask">microtasks</a>, initially empty. A <dfn id="microtask" data-export="">microtask</dfn> is a colloquial way of referring to a <a href="#concept-task" id="definitions-3:concept-task-6">task</a> that was created via the <a href="#queue-a-microtask" id="definitions-3:queue-a-microtask">queue a microtask</a> algorithm.</p>

  <p>Each <a href="#event-loop" id="definitions-3:event-loop-7">event loop</a> has a <dfn id="performing-a-microtask-checkpoint">performing a microtask checkpoint</dfn> boolean, which is initially false. It is used to prevent reentrant invocation of the <a href="#perform-a-microtask-checkpoint" id="definitions-3:perform-a-microtask-checkpoint">perform a microtask checkpoint</a> algorithm.</p>


  <h5 id="queuing-tasks"><span class="secno">8.1.6.2</span> Queuing tasks<a href="#queuing-tasks" class="self-link"></a></h5>

  <p>To <dfn id="queue-a-task" data-export="">queue a task</dfn> on a <a href="#task-source" id="queuing-tasks:task-source">task source</a> <var>source</var>, which performs a series of steps <var>steps</var>, optionally given an event loop <var>event loop</var> and a document <var>document</var>:</p>

  <ol><li><p>If <var>event loop</var> was not given, set <var>event loop</var> to the <a href="#implied-event-loop" id="queuing-tasks:implied-event-loop">implied event loop</a>.<li><p>If <var>document</var> was not given, set <var>document</var> to the <a href="#implied-document" id="queuing-tasks:implied-document">implied document</a>.<li><p>Let <var>task</var> be a new <a href="#concept-task" id="queuing-tasks:concept-task">task</a>.<li><p>Set <var>task</var>'s <a href="#concept-task-steps" id="queuing-tasks:concept-task-steps">steps</a> to <var>steps</var>.<li><p>Set <var>task</var>'s <a href="#concept-task-source" id="queuing-tasks:concept-task-source">source</a> to <var>source</var>.<li><p>Set <var>task</var>'s <a href="#concept-task-document" id="queuing-tasks:concept-task-document">document</a> to the <var>document</var>.<li><p>Set <var>task</var>'s <a href="#script-evaluation-environment-settings-object-set" id="queuing-tasks:script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a> to an empty <a id="queuing-tasks:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p>Let <var>queue</var> be the <a href="#task-queue" id="queuing-tasks:task-queue">task queue</a> to which <var>source</var> is associated on <var>event loop</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="queuing-tasks:list-append" data-x-internal="list-append">Append</a> <var>task</var> to <var>queue</var>.</ol>

  <p>To <dfn id="queue-a-global-task" data-export="">queue a global task</dfn> on a <a href="#task-source" id="queuing-tasks:task-source-2">task source</a> <var>source</var>, with a <a href="#global-object" id="queuing-tasks:global-object">global object</a> <var>global</var> and a series of steps <var>steps</var>:</p>

  <ol><li><p>Let <var>event loop</var> be <var>global</var>'s <a href="#relevant-agent" id="queuing-tasks:relevant-agent">relevant agent</a>'s <a href="#concept-agent-event-loop" id="queuing-tasks:concept-agent-event-loop">event loop</a>.<li><p>Let <var>document</var> be <var>global</var>'s <a href="window-object.html#concept-document-window" id="queuing-tasks:concept-document-window">associated <code>Document</code></a>, if <var>global</var> is a <code id="queuing-tasks:window"><a href="window-object.html#window">Window</a></code> object; otherwise null.</p>

   <li><p><a href="#queue-a-task" id="queuing-tasks:queue-a-task">Queue a task</a> given <var>source</var>, <var>event loop</var>, <var>document</var>, and <var>steps</var>.</ol>

  <p>To <dfn id="queue-an-element-task" data-export="">queue an element task</dfn> on a <a href="#task-source" id="queuing-tasks:task-source-3">task source</a> <var>source</var>, with an element <var>element</var> and a series of steps <var>steps</var>:</p>

  <ol><li><p>Let <var>global</var> be <var>element</var>'s <a href="#concept-relevant-global" id="queuing-tasks:concept-relevant-global">relevant global object</a>.<li><p><a href="#queue-a-global-task" id="queuing-tasks:queue-a-global-task">Queue a global task</a> given <var>source</var>, <var>global</var>, and <var>steps</var>.</ol>

  <p>To <dfn id="queue-a-microtask" data-export="">queue a microtask</dfn> which performs a series of steps <var>steps</var>, optionally given an event loop <var>event loop</var> and a document <var>document</var>:</p>

  <ol><li><p>If <var>event loop</var> was not given, set <var>event loop</var> to the <a href="#implied-event-loop" id="queuing-tasks:implied-event-loop-2">implied event loop</a>.<li><p>If <var>document</var> was not given, set <var>document</var> to the <a href="#implied-document" id="queuing-tasks:implied-document-2">implied document</a>.<li><p>Let <var>microtask</var> be a new <a href="#concept-task" id="queuing-tasks:concept-task-2">task</a>.<li><p>Set <var>microtask</var>'s <a href="#concept-task-steps" id="queuing-tasks:concept-task-steps-2">steps</a> to <var>steps</var>.<li><p>Set <var>microtask</var>'s <a href="#concept-task-source" id="queuing-tasks:concept-task-source-2">source</a> to the <dfn id="microtask-task-source">microtask task source</dfn>.<li><p>Set <var>microtask</var>'s <a href="#concept-task-document" id="queuing-tasks:concept-task-document-2">document</a> to <var>document</var>.<li><p>Set <var>task</var>'s <a href="#script-evaluation-environment-settings-object-set" id="queuing-tasks:script-evaluation-environment-settings-object-set-2">script evaluation environment settings object set</a> to an empty <a id="queuing-tasks:set-2" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p><a id="queuing-tasks:enqueue" href="https://triple-underscore.github.io/infra-ja.html#queue-enqueue" data-x-internal="enqueue">Enqueue</a> <var>task</var> on <var>event loop</var>'s <a href="#microtask-queue" id="queuing-tasks:microtask-queue">microtask queue</a>.</ol>

  <p class="note">It is possible for a <a href="#microtask" id="queuing-tasks:microtask">microtask</a> to be moved to a regular <a href="#task-queue" id="queuing-tasks:task-queue-2">task queue</a>, if, during its initial execution, it <a href="#spin-the-event-loop" id="queuing-tasks:spin-the-event-loop">spins the event loop</a>. This is the only case in which the <a href="#concept-task-source" id="queuing-tasks:concept-task-source-3">source</a>, <a href="#concept-task-document" id="queuing-tasks:concept-task-document-3">document</a>, and <a href="#script-evaluation-environment-settings-object-set" id="queuing-tasks:script-evaluation-environment-settings-object-set-3">script evaluation environment settings object set</a> of the microtask are consulted; they are ignored by the <a href="#perform-a-microtask-checkpoint" id="queuing-tasks:perform-a-microtask-checkpoint">perform a microtask checkpoint</a> algorithm.</p>

  <p>The <dfn id="implied-event-loop">implied event loop</dfn> when queuing a task is the one that can deduced from the context of the calling algorithm. This is generally unambiguous, as most specification algorithms only ever involve a single <a id="queuing-tasks:agent" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a> (and thus a single <a href="#event-loop" id="queuing-tasks:event-loop">event loop</a>). The exception is algorithms involving or specifying cross-agent communication (e.g., between a window and a worker); for those cases, the <a href="#implied-event-loop" id="queuing-tasks:implied-event-loop-3">implied event loop</a> concept must not be relied upon and specifications must explicitly provide an <a href="#event-loop" id="queuing-tasks:event-loop-2">event loop</a> when <a href="#queue-a-task" id="queuing-tasks:queue-a-task-2">queuing a task</a> or <a href="#queue-a-microtask" id="queuing-tasks:queue-a-microtask">microtask</a>.</p>

  <p>The <dfn id="implied-document">implied document</dfn> when queuing a task on an <a href="#event-loop" id="queuing-tasks:event-loop-3">event loop</a> <var>event loop</var> is determined as follows:</p>

  <ol><li><p>If <var>event loop</var> is not a <a href="#window-event-loop" id="queuing-tasks:window-event-loop">window event loop</a>, then return null.<li><p>If the task is being queued in the context of an element, then return the element's <a id="queuing-tasks:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>.<li><p>If the task is being queued in the context of a <a id="queuing-tasks:browsing-context" href="browsers.html#browsing-context">browsing context</a>, then return the browsing context's <a id="queuing-tasks:active-document" href="browsers.html#active-document">active document</a>.<li><p>If the task is being queued by or for a <a href="#concept-script" id="queuing-tasks:concept-script">script</a>, then return the script's <a href="#settings-object" id="queuing-tasks:settings-object">settings object</a>'s <a href="#responsible-document" id="queuing-tasks:responsible-document">responsible document</a>.<li><p>Assert: this step is never reached, because one of the previous conditions must be true. <span class="XXX">Really?</span></ol>

  <p class="XXX">Both <a href="#implied-event-loop" id="queuing-tasks:implied-event-loop-4">implied event loop</a> and <a href="#implied-document" id="queuing-tasks:implied-document-3">implied document</a> are vaguely-defined and have a lot of action-at-a-distance. Perhaps we can come up with a more explicit architecture, while still avoiding all callers needing to explicitly specify the event loop and document.</p>


  <h5 id="event-loop-processing-model" data-dfn-type="dfn" data-lt="event loop processing model" data-export=""><span class="secno">8.1.6.3</span> <span id="processing-model-8"></span>Processing model<a href="#event-loop-processing-model" class="self-link"></a></h5>
  

  <p>An <a href="#event-loop" id="event-loop-processing-model:event-loop">event loop</a> must continually run through the following steps for as long as it exists:</p>

  <ol><li id="step1"><p>Let <var>taskQueue</var> be one of the <a href="#event-loop" id="event-loop-processing-model:event-loop-2">event loop</a>'s <a href="#task-queue" id="event-loop-processing-model:task-queue">task queues</a>, chosen in an <a id="event-loop-processing-model:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a> manner, with the constraint that the chosen task queue must contain at least one <a href="#concept-task-runnable" id="event-loop-processing-model:concept-task-runnable">runnable</a> <a href="#concept-task" id="event-loop-processing-model:concept-task">task</a>. If there is no such task queue, then jump to the <i>microtasks</i> step below.</p>

    <p class="note">Remember that the <a href="#microtask-queue" id="event-loop-processing-model:microtask-queue">microtask queue</a> is not a <a href="#task-queue" id="event-loop-processing-model:task-queue-2">task queue</a>, so it will not be chosen in this step. However, a <a href="#task-queue" id="event-loop-processing-model:task-queue-3">task queue</a> to which the <a href="#microtask-task-source" id="event-loop-processing-model:microtask-task-source">microtask task source</a> is associated might be chosen in this step. In that case, the <a href="#concept-task" id="event-loop-processing-model:concept-task-2">task</a> chosen in the next step was originally a <a href="#microtask" id="event-loop-processing-model:microtask">microtask</a>, but it got moved as part of <a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop">spinning the event loop</a>.</p>
   <li><p>Let <var>oldestTask</var> be the first <a href="#concept-task-runnable" id="event-loop-processing-model:concept-task-runnable-2">runnable</a> <a href="#concept-task" id="event-loop-processing-model:concept-task-3">task</a> in <var>taskQueue</var>, and <a href="https://triple-underscore.github.io/infra-ja.html#list-remove" id="event-loop-processing-model:list-remove" data-x-internal="list-remove">remove</a> it from <var>taskQueue</var>.<li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-3">event loop</a>'s <a href="#currently-running-task" id="event-loop-processing-model:currently-running-task">currently running task</a> to <var>oldestTask</var>.<li><p>Let <var>taskStartTime</var> be the <a id="event-loop-processing-model:current-high-resolution-time" href="https://w3c.github.io/hr-time/#dfn-current-high-resolution-time" data-x-internal="current-high-resolution-time">current high resolution time</a>.<li><p>Perform <var>oldestTask</var>'s <a href="#concept-task-steps" id="event-loop-processing-model:concept-task-steps">steps</a>.<li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-4">event loop</a>'s <a href="#currently-running-task" id="event-loop-processing-model:currently-running-task-2">currently running task</a> back to null.<li><p><i>Microtasks</i>: <a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint">Perform a microtask checkpoint</a>.<li><p>Let <var>hasARenderingOpportunity</var> be false.<li><p>Let <var>now</var> be the <a id="event-loop-processing-model:current-high-resolution-time-2" href="https://w3c.github.io/hr-time/#dfn-current-high-resolution-time" data-x-internal="current-high-resolution-time">current high resolution time</a>. <a href="references.html#refsHRT">[HRT]</a><li><p>Report the <a href="#concept-task" id="event-loop-processing-model:concept-task-4">task</a>'s duration by performing the following steps:</p>

    <ol><li><p>Let <var>top-level browsing contexts</var> be an empty <a id="event-loop-processing-model:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a>.<li><p>For each <a href="#environment-settings-object" id="event-loop-processing-model:environment-settings-object">environment settings object</a> <var>settings</var> of <var>oldestTask</var>'s <a href="#script-evaluation-environment-settings-object-set" id="event-loop-processing-model:script-evaluation-environment-settings-object-set">script evaluation environment settings object set</a>, <a href="https://triple-underscore.github.io/infra-ja.html#set-append" id="event-loop-processing-model:set-append" data-x-internal="set-append">append</a> <var>setting</var>'s <a id="event-loop-processing-model:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a> to <var>top-level browsing contexts</var>.<li><p><a id="event-loop-processing-model:report-long-tasks" href="https://w3c.github.io/longtasks/#report-long-tasks" data-x-internal="report-long-tasks">Report long tasks</a>, passing in <var>taskStartTime</var>, <var>now</var> (the end time of the task), <var>top-level browsing contexts</var>, and <var>oldestTask</var>.</ol>
   <li><p><dfn id="update-the-rendering" data-export="">Update the rendering</dfn>: if this is a <a href="#window-event-loop" id="event-loop-processing-model:window-event-loop">window event loop</a>, then:</p>

    <ol><li><p>Let <var>docs</var> be all <code id="event-loop-processing-model:document"><a href="dom.html#document">Document</a></code> objects whose <a href="#relevant-agent" id="event-loop-processing-model:relevant-agent">relevant agent</a>'s <a href="#concept-agent-event-loop" id="event-loop-processing-model:concept-agent-event-loop">event loop</a> is this event loop, sorted arbitrarily except that the following conditions must be met:</p>

      <ul><li><p>Any <code id="event-loop-processing-model:document-2"><a href="dom.html#document">Document</a></code> <var>B</var> whose <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc">browsing context</a>'s <a href="browsers.html#bc-container-document" id="event-loop-processing-model:bc-container-document">container document</a> is <var>A</var> must be listed after <var>A</var> in the list.<li><p>If there are two documents <var>A</var> and <var>B</var> whose <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc-2">browsing contexts</a> are both <a href="browsers.html#child-browsing-context" id="event-loop-processing-model:child-browsing-context">child browsing contexts</a> whose <a href="browsers.html#bc-container-document" id="event-loop-processing-model:bc-container-document-2">container documents</a> are another <code id="event-loop-processing-model:document-3"><a href="dom.html#document">Document</a></code> <var>C</var>, then the order of <var>A</var> and <var>B</var> in the list must match the <a id="event-loop-processing-model:shadow-including-tree-order" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-including-tree-order" data-x-internal="shadow-including-tree-order">shadow-including tree order</a> of their respective <a href="browsers.html#browsing-context-container" id="event-loop-processing-model:browsing-context-container">browsing context containers</a> in <var>C</var>'s <a id="event-loop-processing-model:node-tree" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-tree" data-x-internal="node-tree">node tree</a>.</ul>

      <p>In the steps below that iterate over <var>docs</var>, each <code id="event-loop-processing-model:document-4"><a href="dom.html#document">Document</a></code> must be processed in the order it is found in the list.</p>
     <li><p><i>Rendering opportunities</i>: Remove from <var>docs</var> all <code id="event-loop-processing-model:document-5"><a href="dom.html#document">Document</a></code> objects whose <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc-3">browsing context</a> do not have a <a href="#rendering-opportunity" id="event-loop-processing-model:rendering-opportunity">rendering opportunity</a>.</p>

      <p>A <a id="event-loop-processing-model:browsing-context" href="browsers.html#browsing-context">browsing context</a> has a <dfn id="rendering-opportunity">rendering opportunity</dfn> if the user agent is currently able to present the contents of the <a id="event-loop-processing-model:browsing-context-2" href="browsers.html#browsing-context">browsing context</a> to the user, accounting for hardware refresh rate constraints and user agent throttling for performance reasons, but considering content presentable even if it's outside the viewport.</p>

      <p><a id="event-loop-processing-model:browsing-context-3" href="browsers.html#browsing-context">Browsing context</a> <a href="#rendering-opportunity" id="event-loop-processing-model:rendering-opportunity-2">rendering opportunities</a> are determined based on hardware constraints such as display refresh rates and other factors such as page performance or whether the page is in the background. Rendering opportunities typically occur at regular intervals.</p>

      <p class="note">This specification does not mandate any particular model for selecting rendering opportunities. But for example, if the browser is attempting to achieve a 60Hz refresh rate, then rendering opportunities occur at a maximum of every 60th of a second (about 16.7ms). If the browser finds that a <a id="event-loop-processing-model:browsing-context-4" href="browsers.html#browsing-context">browsing context</a> is not able to sustain this rate, it might drop to a more sustainable 30 rendering opportunities per second for that <a id="event-loop-processing-model:browsing-context-5" href="browsers.html#browsing-context">browsing context</a>, rather than occasionally dropping frames. Similarly, if a <a id="event-loop-processing-model:browsing-context-6" href="browsers.html#browsing-context">browsing context</a> is not visible, the user agent might decide to drop that page to a much slower 4 rendering opportunities per second, or even less.</p>
     <li><p>If <var>docs</var> is not empty, then set <var>hasARenderingOpportunity</var> to true.<li><p><i>Unnecessary rendering</i>: Remove from <var>docs</var> all <code id="event-loop-processing-model:document-6"><a href="dom.html#document">Document</a></code> objects which meet both of the following conditions:</p>

      <ul class="brief"><li>The user agent believes that updating the rendering of the <code id="event-loop-processing-model:document-7"><a href="dom.html#document">Document</a></code>'s <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc-4">browsing context</a> would have no visible effect, and<li>The <code id="event-loop-processing-model:document-8"><a href="dom.html#document">Document</a></code>'s <a id="event-loop-processing-model:list-of-animation-frame-callbacks" href="imagebitmap-and-animations.html#list-of-animation-frame-callbacks">map of animation frame callbacks</a> is empty.</ul>
     <li><p>Remove from <var>docs</var> all <code id="event-loop-processing-model:document-9"><a href="dom.html#document">Document</a></code> objects for which the user agent believes that it's preferrable to skip updating the rendering for other reasons.</p>

      <div class="note"><p>The step labeled <i>Rendering opportunities</i> prevents the user agent from updating the rendering when it is unable to present new content to the user (there's no <a href="#rendering-opportunity" id="event-loop-processing-model:rendering-opportunity-3">rendering opportunity</a>).</p>

       <p>The step labeled <i>Unnecessary rendering</i> prevents the user agent from updating the rendering when there's no new content to draw.</p>

       <p>This step enables the user agent to prevent the steps below from running for other reasons, for example, to ensure certain <a href="#concept-task" id="event-loop-processing-model:concept-task-5">tasks</a> are executed immediately after each other, with only <a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-2">microtask checkpoints</a> interleaved (and without, e.g., <a href="imagebitmap-and-animations.html#run-the-animation-frame-callbacks" id="event-loop-processing-model:run-the-animation-frame-callbacks">animation frame callbacks</a> interleaved). Concretely, a user agent might wish to coalesce timer callbacks together, with no intermediate rendering updates.</p>
      </div>
     <li><p>For each <a id="event-loop-processing-model:fully-active" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-10"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:flush-autofocus-candidates" href="interaction.html#flush-autofocus-candidates">flush autofocus candidates</a> for that <code id="event-loop-processing-model:document-11"><a href="dom.html#document">Document</a></code> if its <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc-5">browsing context</a> is a <a id="event-loop-processing-model:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a>.<li><p>For each <a id="event-loop-processing-model:fully-active-2" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-12"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:run-the-resize-steps" href="https://triple-underscore.github.io/cssom-view-ja.html#run-the-resize-steps" data-x-internal="run-the-resize-steps">run the resize steps</a> for that <code id="event-loop-processing-model:document-13"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a><li><p>For each <a id="event-loop-processing-model:fully-active-3" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-14"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:run-the-scroll-steps" href="https://triple-underscore.github.io/cssom-view-ja.html#run-the-scroll-steps" data-x-internal="run-the-scroll-steps">run the scroll steps</a> for that <code id="event-loop-processing-model:document-15"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a><li><p>For each <a id="event-loop-processing-model:fully-active-4" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-16"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:evaluate-media-queries-and-report-changes" href="https://triple-underscore.github.io/cssom-view-ja.html#evaluate-media-queries-and-report-changes" data-x-internal="evaluate-media-queries-and-report-changes">evaluate media queries and report changes</a> for that <code id="event-loop-processing-model:document-17"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsCSSOMVIEW">[CSSOMVIEW]</a><li><p>For each <a id="event-loop-processing-model:fully-active-5" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-18"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:update-animations-and-send-events" href="https://triple-underscore.github.io/web-animations-ja.html/#update-animations-and-send-events" data-x-internal="update-animations-and-send-events">update animations and send events</a> for that <code id="event-loop-processing-model:document-19"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsWEBANIMATIONS">[WEBANIMATIONS]</a><li><p>For each <a id="event-loop-processing-model:fully-active-6" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-20"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:run-the-fullscreen-steps" href="https://triple-underscore.github.io/fullscreen-ja.html#run-the-fullscreen-steps" data-x-internal="run-the-fullscreen-steps">run the fullscreen steps</a> for that <code id="event-loop-processing-model:document-21"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsFULLSCREEN">[FULLSCREEN]</a><li><p>For each <a id="event-loop-processing-model:fully-active-7" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-22"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:run-the-animation-frame-callbacks-2" href="imagebitmap-and-animations.html#run-the-animation-frame-callbacks">run the animation frame callbacks</a> for that <code id="event-loop-processing-model:document-23"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp.<li><p>For each <a id="event-loop-processing-model:fully-active-8" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-24"><a href="dom.html#document">Document</a></code> in <var>docs</var>, <a id="event-loop-processing-model:run-the-update-intersection-observations-steps" href="https://triple-underscore.github.io/IntersectionObserver-ja.html#run-the-update-intersection-observations-steps" data-x-internal="run-the-update-intersection-observations-steps">run the update intersection observations steps</a> for that <code id="event-loop-processing-model:document-25"><a href="dom.html#document">Document</a></code>, passing in <var>now</var> as the timestamp. <a href="references.html#refsINTERSECTIONOBSERVER">[INTERSECTIONOBSERVER]</a><li><p>Invoke the <a id="event-loop-processing-model:mark-paint-timing" href="https://triple-underscore.github.io/paint-timing-ja.html#mark-paint-timing" data-x-internal="mark-paint-timing">mark paint timing</a> algorithm for each <code id="event-loop-processing-model:document-26"><a href="dom.html#document">Document</a></code> object in <var>docs</var>.<li><p>For each <a id="event-loop-processing-model:fully-active-9" href="browsers.html#fully-active">fully active</a> <code id="event-loop-processing-model:document-27"><a href="dom.html#document">Document</a></code> in <var>docs</var>, update the rendering or user interface of that <code id="event-loop-processing-model:document-28"><a href="dom.html#document">Document</a></code> and its <a href="browsers.html#concept-document-bc" id="event-loop-processing-model:concept-document-bc-6">browsing context</a> to reflect the current state.</ol>
   <li><p>If all of the following are true<ul class="brief"><li>this is a <a href="#window-event-loop" id="event-loop-processing-model:window-event-loop-2">window event loop</a><li>there is no <a href="#concept-task" id="event-loop-processing-model:concept-task-6">task</a> in this <a href="#event-loop" id="event-loop-processing-model:event-loop-5">event loop</a>'s <a href="#task-queue" id="event-loop-processing-model:task-queue-4">task queues</a> whose <a href="#concept-task-document" id="event-loop-processing-model:concept-task-document">document</a> is <a id="event-loop-processing-model:fully-active-10" href="browsers.html#fully-active">fully active</a><li>this <a href="#event-loop" id="event-loop-processing-model:event-loop-6">event loop</a>'s <a href="#microtask-queue" id="event-loop-processing-model:microtask-queue-2">microtask queue</a> is <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="event-loop-processing-model:list-is-empty" data-x-internal="list-is-empty">empty</a><li><var>hasARenderingOpportunity</var> is false</ul>

    <p>then for each <code id="event-loop-processing-model:window"><a href="window-object.html#window">Window</a></code> object whose whose <a href="#relevant-agent" id="event-loop-processing-model:relevant-agent-2">relevant agent</a>'s <a href="#concept-agent-event-loop" id="event-loop-processing-model:concept-agent-event-loop-2">event loop</a> is this event loop, run the <a id="event-loop-processing-model:start-an-idle-period-algorithm" href="https://w3c.github.io/requestidlecallback/#start-an-idle-period-algorithm" data-x-internal="start-an-idle-period-algorithm">start an idle period algorithm</a>, passing the <code id="event-loop-processing-model:window-2"><a href="window-object.html#window">Window</a></code>. <a href="references.html#refsREQUESTIDLECALLBACK">[REQUESTIDLECALLBACK]</a></p>
   <li><p>If this is a <a href="#worker-event-loop-2" id="event-loop-processing-model:worker-event-loop-2">worker event loop</a>, then:</p>

    <ol><li><p>If this <a href="#event-loop" id="event-loop-processing-model:event-loop-7">event loop</a>'s <a id="event-loop-processing-model:agent" href="https://tc39.es/ecma262/#sec-agents" data-x-internal="agent">agent</a>'s single <a href="https://tc39.es/ecma262/#sec-code-realms" id="event-loop-processing-model:javascript-realm" data-x-internal="javascript-realm">realm</a>'s <a href="#concept-realm-global" id="event-loop-processing-model:concept-realm-global">global object</a> is a <a href="imagebitmap-and-animations.html#concept-animationframeprovider-supported" id="event-loop-processing-model:concept-animationframeprovider-supported">supported</a> <code id="event-loop-processing-model:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> and the user agent believes that it would benefit from having its rendering updated at this time, then:</p>
      

      <ol><li><p>Let <var>now</var> be the <a id="event-loop-processing-model:current-high-resolution-time-3" href="https://w3c.github.io/hr-time/#dfn-current-high-resolution-time" data-x-internal="current-high-resolution-time">current high resolution time</a>. <a href="references.html#refsHRT">[HRT]</a><li><p><a id="event-loop-processing-model:run-the-animation-frame-callbacks-3" href="imagebitmap-and-animations.html#run-the-animation-frame-callbacks">Run the animation frame callbacks</a> for that <code id="event-loop-processing-model:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>, passing in <var>now</var> as the timestamp.<li><p>Update the rendering of that dedicated worker to reflect the current state.</ol>

      <p class="note">Similar to the notes for <a href="#update-the-rendering" id="event-loop-processing-model:update-the-rendering">updating the rendering</a> in a <a href="#window-event-loop" id="event-loop-processing-model:window-event-loop-3">window event loop</a>, a user agent can determine the rate of rendering in the dedicated worker.</p>
     <li><p>If there are no <a href="#concept-task" id="event-loop-processing-model:concept-task-7">tasks</a> in the <a href="#event-loop" id="event-loop-processing-model:event-loop-8">event loop</a>'s <a href="#task-queue" id="event-loop-processing-model:task-queue-5">task queues</a> and the <code id="event-loop-processing-model:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> object's <a href="workers.html#dom-workerglobalscope-closing" id="event-loop-processing-model:dom-workerglobalscope-closing">closing</a> flag is true, then destroy the <a href="#event-loop" id="event-loop-processing-model:event-loop-9">event loop</a>, aborting these steps, resuming the <a id="event-loop-processing-model:run-a-worker" href="workers.html#run-a-worker">run a worker</a> steps described in the <a href="workers.html#workers">Web workers</a> section below.</ol>
   </ol>

  <hr>

  <p>When a user agent is to <dfn id="perform-a-microtask-checkpoint" data-export="">perform a microtask checkpoint</dfn>:</p>

  <ol><li><p>If the <a href="#event-loop" id="event-loop-processing-model:event-loop-10">event loop</a>'s <a href="#performing-a-microtask-checkpoint" id="event-loop-processing-model:performing-a-microtask-checkpoint">performing a microtask checkpoint</a> is true, then return.<li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-11">event loop</a>'s <a href="#performing-a-microtask-checkpoint" id="event-loop-processing-model:performing-a-microtask-checkpoint-2">performing a microtask checkpoint</a> to true.<li><p>While the <a href="#event-loop" id="event-loop-processing-model:event-loop-12">event loop</a>'s <a href="#microtask-queue" id="event-loop-processing-model:microtask-queue-3">microtask queue</a> is not <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="event-loop-processing-model:list-is-empty-2" data-x-internal="list-is-empty">empty</a>:</p>

    <ol><li><p>Let <var>oldestMicrotask</var> be the result of <a href="https://triple-underscore.github.io/infra-ja.html#queue-dequeue" id="event-loop-processing-model:dequeue" data-x-internal="dequeue">dequeuing</a> from the <a href="#event-loop" id="event-loop-processing-model:event-loop-13">event loop</a>'s <a href="#microtask-queue" id="event-loop-processing-model:microtask-queue-4">microtask queue</a>.<li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-14">event loop</a>'s <a href="#currently-running-task" id="event-loop-processing-model:currently-running-task-3">currently running task</a> to <var>oldestMicrotask</var>.<li><p>Run <var>oldestMicrotask</var>.</p>

      <p class="note">This might involve invoking scripted callbacks, which eventually calls the <a href="#clean-up-after-running-script" id="event-loop-processing-model:clean-up-after-running-script">clean up after running script</a> steps, which call this <a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-3">perform a microtask checkpoint</a> algorithm again, which is why we use the <a href="#performing-a-microtask-checkpoint" id="event-loop-processing-model:performing-a-microtask-checkpoint-3">performing a microtask checkpoint</a> flag to avoid reentrancy.</p>
     <li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-15">event loop</a>'s <a href="#currently-running-task" id="event-loop-processing-model:currently-running-task-4">currently running task</a> back to null.</ol>
   <li><p>For each <a href="#environment-settings-object" id="event-loop-processing-model:environment-settings-object-2">environment settings object</a> whose <a href="#responsible-event-loop" id="event-loop-processing-model:responsible-event-loop">responsible event loop</a> is this <a href="#event-loop" id="event-loop-processing-model:event-loop-16">event loop</a>, <a href="#notify-about-rejected-promises" id="event-loop-processing-model:notify-about-rejected-promises">notify about rejected promises</a> on that <a href="#environment-settings-object" id="event-loop-processing-model:environment-settings-object-3">environment settings object</a>.<li><p><a id="event-loop-processing-model:cleanup-indexed-database-transactions" href="https://w3c.github.io/IndexedDB/#cleanup-indexed-database-transactions" data-x-internal="cleanup-indexed-database-transactions">Cleanup Indexed Database transactions</a>.<li><p>Set the <a href="#event-loop" id="event-loop-processing-model:event-loop-17">event loop</a>'s <a href="#performing-a-microtask-checkpoint" id="event-loop-processing-model:performing-a-microtask-checkpoint-4">performing a microtask checkpoint</a> to false.</ol>

  <hr>

  <p>When an algorithm running <a id="event-loop-processing-model:in-parallel" href="infrastructure.html#in-parallel">in parallel</a> is to <dfn id="await-a-stable-state">await a stable state</dfn>, the user agent must <a href="#queue-a-microtask" id="event-loop-processing-model:queue-a-microtask">queue a microtask</a> that runs the following steps, and must then stop executing (execution of the algorithm resumes when the microtask is run, as described in the following steps):</p>

  <ol><li><p>Run the algorithm's <dfn id="synchronous-section">synchronous section</dfn>.<li><p>Resumes execution of the algorithm <a id="event-loop-processing-model:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a>, if appropriate, as described in the algorithm's steps.</ol>

  <p class="note">Steps in <a href="#synchronous-section" id="event-loop-processing-model:synchronous-section">synchronous sections</a> are marked with ⌛.</p>

  <hr>

  <p>Algorithm steps that say to <dfn id="spin-the-event-loop">spin the event loop</dfn> until a condition <var>goal</var> is met are equivalent to substituting in the following algorithm steps:</p>

  <ol><li><p>Let <var>task</var> be the <a href="#event-loop" id="event-loop-processing-model:event-loop-18">event loop</a>'s <a href="#currently-running-task" id="event-loop-processing-model:currently-running-task-5">currently running task</a>.</p>

    <p class="note"><var>task</var> could be a <a href="#microtask" id="event-loop-processing-model:microtask-2">microtask</a>.</p>
   <li><p>Let <var>task source</var> be <var>task</var>'s <a href="#concept-task-source" id="event-loop-processing-model:concept-task-source">source</a>.<li><p>Let <var>old stack</var> be a copy of the <a id="event-loop-processing-model:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>Empty the <a id="event-loop-processing-model:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p><a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-4">Perform a microtask checkpoint</a>.</p>

    <p class="note">If <var>task</var> is a <a href="#microtask" id="event-loop-processing-model:microtask-3">microtask</a> this step will be a no-op due to <a href="#performing-a-microtask-checkpoint" id="event-loop-processing-model:performing-a-microtask-checkpoint-5">performing a microtask checkpoint</a> being true.</p>
   <li><p><a id="event-loop-processing-model:in-parallel-3" href="infrastructure.html#in-parallel">In parallel</a>:</p>

    <ol><li><p>Wait until the condition <var>goal</var> is met.<li><p><a href="#queue-a-task" id="event-loop-processing-model:queue-a-task">Queue a task</a> on <var>task source</var> to:</p>

      <ol><li><p>Replace the <a id="event-loop-processing-model:javascript-execution-context-stack-3" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> with <var>old stack</var>.<li><p>Perform any steps that appear after this <a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-2">spin the event loop</a> instance in the original algorithm.</p>

        <p class="note">This resumes <var>task</var>.</p>
       </ol>
     </ol>
   <li><p>Stop <var>task</var>, allowing whatever algorithm that invoked it to resume.</p>

    <p class="note">This causes the <a href="#event-loop" id="event-loop-processing-model:event-loop-19">event loop</a>'s main set of steps or the <a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-5">perform a microtask checkpoint</a> algorithm to continue.</p>
   </ol>

  <p class="note">Unlike other algorithms in this and other specifications, which behave similar to programming-language function calls, <a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-3">spin the event loop</a> is more like a macro, which saves typing and indentation at the usage site by expanding into a series of steps and operations.</p>

  <div class="example"><p>An algorithm whose steps are:</p>

   <ol><li><p>Do something.<li><p><a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-4">Spin the event loop</a> until awesomeness happens.<li><p>Do something else.</ol>

   <p>is a shorthand which, after "macro expansion", becomes</p>

   <ol><li><p>Do something.<li><p>Let <var>old stack</var> be a copy of the <a id="event-loop-processing-model:javascript-execution-context-stack-4" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>Empty the <a id="event-loop-processing-model:javascript-execution-context-stack-5" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p><a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-6">Perform a microtask checkpoint</a>.<li><p><a id="event-loop-processing-model:in-parallel-4" href="infrastructure.html#in-parallel">In parallel</a>:</p>

     <ol><li><p>Wait until awesomeness happens.<li><p><a href="#queue-a-task" id="event-loop-processing-model:queue-a-task-2">Queue a task</a> on the task source in which "do something" was done to:</p>

       <ol><li><p>Replace the <a id="event-loop-processing-model:javascript-execution-context-stack-6" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> with <var>old stack</var>.<li><p>Do something else.</ol>
      </ol>
    </ol>
  </div>

  <div class="example"><p>Here is a more full example of the substitution, where the event loop is spun from inside a task that is queued from work in parallel. The version using <a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-5">spin the event loop</a>:</p>

   <ol><li><p><a id="event-loop-processing-model:in-parallel-5" href="infrastructure.html#in-parallel">In parallel</a>:</p>

     <ol><li><p>Do parallel thing 1.<li><p><a href="#queue-a-task" id="event-loop-processing-model:queue-a-task-3">Queue a task</a> on the <a href="#dom-manipulation-task-source" id="event-loop-processing-model:dom-manipulation-task-source" class="no-backref">DOM manipulation task source</a> to:</p>

       <ol><li><p>Do task thing 1.<li><p><a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-6">Spin the event loop</a> until awesomeness happens.<li><p>Do task thing 2.</ol>
      <li><p>Do parallel thing 2.</ol>
    </ol>

   <p>The fully expanded version:</p>

   <ol><li><p><a id="event-loop-processing-model:in-parallel-6" href="infrastructure.html#in-parallel">In parallel</a>:</p>

     <ol><li><p>Do parallel thing 1.<li><p>Let <var>old stack</var> be null.<li><p><a href="#queue-a-task" id="event-loop-processing-model:queue-a-task-4">Queue a task</a> on the <a href="#dom-manipulation-task-source" id="event-loop-processing-model:dom-manipulation-task-source-2" class="no-backref">DOM manipulation task source</a> to:</p>

       <ol><li><p>Do task thing 1.<li><p>Set <var>old stack</var> to a copy of the <a id="event-loop-processing-model:javascript-execution-context-stack-7" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>Empty the <a id="event-loop-processing-model:javascript-execution-context-stack-8" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p><a href="#perform-a-microtask-checkpoint" id="event-loop-processing-model:perform-a-microtask-checkpoint-7">Perform a microtask checkpoint</a>.</ol>
      <li><p>Wait until awesomeness happens.<li><p><a href="#queue-a-task" id="event-loop-processing-model:queue-a-task-5">Queue a task</a> on the <a href="#dom-manipulation-task-source" id="event-loop-processing-model:dom-manipulation-task-source-3" class="no-backref">DOM manipulation task source</a> to:</p>

       <ol><li><p>Replace the <a id="event-loop-processing-model:javascript-execution-context-stack-9" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a> with <var>old stack</var>.<li><p>Do task thing 2.</ol>
      <li><p>Do parallel thing 2.</ol>
    </ol>
  </div>

  <hr>

  <p>Some of the algorithms in this specification, for historical reasons, require the user agent to <dfn id="pause">pause</dfn> while running a <a href="#concept-task" id="event-loop-processing-model:concept-task-8">task</a> until a condition <var>goal</var> is met. This means running the following steps:</p>

  <ol><li><p>If necessary, update the rendering or user interface of any <code id="event-loop-processing-model:document-29"><a href="dom.html#document">Document</a></code> or <a id="event-loop-processing-model:browsing-context-7" href="browsers.html#browsing-context">browsing context</a> to reflect the current state.<li><p>Wait until the condition <var>goal</var> is met. While a user agent has a paused <a href="#concept-task" id="event-loop-processing-model:concept-task-9">task</a>, the corresponding <a href="#event-loop" id="event-loop-processing-model:event-loop-20">event loop</a> must not run further <a href="#concept-task" id="event-loop-processing-model:concept-task-10">tasks</a>, and any script in the currently running <a href="#concept-task" id="event-loop-processing-model:concept-task-11">task</a> must block. User agents should remain responsive to user input while paused, however, albeit in a reduced capacity since the <a href="#event-loop" id="event-loop-processing-model:event-loop-21">event loop</a> will not be doing anything.</ol>

  <div class="warning"><p><a href="#pause" id="event-loop-processing-model:pause">Pausing</a> is highly detrimental to the user experience, especially in scenarios where a single <a href="#event-loop" id="event-loop-processing-model:event-loop-22">event loop</a> is shared among multiple documents. User agents are encouraged to experiment with alternatives to <a href="#pause" id="event-loop-processing-model:pause-2">pausing</a>, such as <a href="#spin-the-event-loop" id="event-loop-processing-model:spin-the-event-loop-7">spinning the event loop</a> or even simply proceeding without any kind of suspended execution at all, insofar as it is possible to do so while preserving compatibility with existing content. This specification will happily change if a less-drastic alternative is discovered to be web-compatible.</p>

   <p>In the interim, implementers should be aware that the variety of alternatives that user agents might experiment with can change subtle aspects of <a href="#event-loop" id="event-loop-processing-model:event-loop-23">event loop</a> behavior, including <a href="#concept-task" id="event-loop-processing-model:concept-task-12">task</a> and <a href="#microtask" id="event-loop-processing-model:microtask-4">microtask</a> timing. Implementations should continue experimenting even if doing so causes them to violate the exact semantics implied by the <a href="#pause" id="event-loop-processing-model:pause-3">pause</a> operation.</p>
  </div>

  <h5 id="generic-task-sources"><span class="secno">8.1.6.4</span> Generic task sources<a href="#generic-task-sources" class="self-link"></a></h5>

  <p>The following <a href="#task-source" id="generic-task-sources:task-source">task sources</a> are used by a number of mostly unrelated features in this and other specifications.</p>

  <dl><dt>The <dfn id="dom-manipulation-task-source" data-dfn-type="dfn" data-export="">DOM manipulation task source</dfn><dd><p>This <a href="#task-source" id="generic-task-sources:task-source-2">task source</a> is used for features that react to DOM manipulations, such as things that happen in a non-blocking fashion when an element is <a href="infrastructure.html#insert-an-element-into-a-document" id="generic-task-sources:insert-an-element-into-a-document">inserted into the document</a>.</p>
   <dt>The <dfn id="user-interaction-task-source" data-export="">user interaction task source</dfn><dd><p>This <a href="#task-source" id="generic-task-sources:task-source-3">task source</a> is used for features that react to user interaction, for example keyboard or mouse input.</p>

    <p>Events sent in response to user input (e.g. <code id="generic-task-sources:event-click"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code> events) must be fired using <a href="#concept-task" id="generic-task-sources:concept-task">tasks</a> <a href="#queue-a-task" id="generic-task-sources:queue-a-task">queued</a> with the <a href="#user-interaction-task-source" id="generic-task-sources:user-interaction-task-source">user interaction task source</a>. <a href="references.html#refsUIEVENTS">[UIEVENTS]</a></p> 
   <dt>The <dfn id="networking-task-source" data-export="">networking task source</dfn><dd><p>This <a href="#task-source" id="generic-task-sources:task-source-4">task source</a> is used for features that trigger in response to network activity.</p>
   <dt>The <dfn id="history-traversal-task-source" data-export="">history traversal task source</dfn><dd><p>This <a href="#task-source" id="generic-task-sources:task-source-5">task source</a> is used to queue calls to <code id="generic-task-sources:dom-history-back"><a href="history.html#dom-history-back">history.back()</a></code> and similar APIs.</p>
   </dl>

  <h5 id="event-loop-for-spec-authors"><span class="secno">8.1.6.5</span> Dealing with the event loop from other specifications<a href="#event-loop-for-spec-authors" class="self-link"></a></h5>

  <p>Writing specifications that correctly interact with the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop">event loop</a> can be tricky. This is compounded by how this specification uses concurrency-model-independent terminology, so we say things like "<a href="#event-loop" id="event-loop-for-spec-authors:event-loop-2">event loop</a>" and "<a id="event-loop-for-spec-authors:in-parallel" href="infrastructure.html#in-parallel">in parallel</a>" instead of using more familiar model-specific terms like "main thread" or "on a background thread".</p>

  <p>By default, specification text generally runs on the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-3">event loop</a>. This falls out from the formal <a href="#event-loop-processing-model">event loop processing model</a>, in that you can eventually trace most algorithms back to a <a href="#concept-task" id="event-loop-for-spec-authors:concept-task">task</a> <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task">queued</a> there.</p>

  <p class="example">The algorithm steps for any JavaScript method will be invoked by author code calling that method. And author code can only be run via queued tasks, usually originating somewhere in the <a href="scripting.html#script-processing-model"><code>script</code> processing model</a>.</p>

  <p>From this starting point, the overriding guideline is that any work a specification needs to perform that would otherwise block the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-4">event loop</a> must instead be performed <a id="event-loop-for-spec-authors:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a> with it. This includes (but is not limited to):</p>

  <ul><li><p>performing heavy computation;<li><p>displaying a user-facing prompt;<li><p>performing operations which could require involving outside systems (i.e. "going out of process").</ul>

  <p>The next complication is that, in algorithm sections that are <a id="event-loop-for-spec-authors:in-parallel-3" href="infrastructure.html#in-parallel">in parallel</a>, you must not create or manipulate objects associated to a specific <a id="event-loop-for-spec-authors:javascript-realm" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript realm</a>, <a href="#global-object" id="event-loop-for-spec-authors:global-object">global</a>, or <a href="#environment-settings-object" id="event-loop-for-spec-authors:environment-settings-object">environment settings object</a>. (Stated in more familiar terms, you must not directly access main-thread artifacts from a background thread.) Doing so would create data races observable to JavaScript code, since after all, your algorithm steps are running <em><a id="event-loop-for-spec-authors:in-parallel-4" href="infrastructure.html#in-parallel">in parallel</a></em> to the JavaScript code.</p>

  <p>You can, however, manipulate specification-level data structures and values from <cite>Infra</cite>, as those are realm-agnostic. They are never directly exposed to JavaScript without a specific conversion taking place (often <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="event-loop-for-spec-authors:concept-idl-convert" data-x-internal="concept-idl-convert">via Web IDL</a>). <a href="references.html#refsINFRA">[INFRA]</a> <a href="references.html#refsWEBIDL">[WEBIDL]</a></p>

  <p>To affect the world of observable JavaScript objects, then, you must <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-2">queue a task</a> to perform any such manipulations. This ensures your steps are properly interleaved with respect to other things happening on the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-5">event loop</a>. Furthermore, you must choose a <a href="#task-source" id="event-loop-for-spec-authors:task-source">task source</a> when <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-3">queuing a task</a>; this governs the relative order of your steps versus others. If you are unsure which <a href="#task-source" id="event-loop-for-spec-authors:task-source-2">task source</a> to use, pick one of the <a href="#generic-task-sources">generic task sources</a> that sounds most applicable.</p>

  <p>Most invocations of <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-4">queue a task</a> use the <a href="#implied-event-loop" id="event-loop-for-spec-authors:implied-event-loop">implied event loop</a>, i.e., the one that is obvious from context. That is because it is very rare for algorithms to be invoked in contexts involving multiple event loops. (Unlike contexts involving multiple global objects, which happen all the time!) So unless you are writing a specification which, e.g., deals with manipulating <a href="workers.html#workers">workers</a>, you can omit this argument when <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-5">queuing a task</a>.</p>

  <p>Putting this all together, we can provide a template for a typical algorithm that needs to do work asynchronously:</p>

  <ol><li><p>Do any synchronous setup work, while still on the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-6">event loop</a>. This may include converting <a href="https://tc39.es/ecma262/#sec-code-realms" id="event-loop-for-spec-authors:javascript-realm-2" data-x-internal="javascript-realm">realm</a>-specific JavaScript values into realm-agnostic specification-level values.<li><p>Perform a set of potentially-expensive steps <a id="event-loop-for-spec-authors:in-parallel-5" href="infrastructure.html#in-parallel">in parallel</a>, operating entirely on realm-agnostic values, and producing a realm-agnostic result.<li><p><a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-6">Queue a task</a>, on a specified <a href="#task-source" id="event-loop-for-spec-authors:task-source-3">task source</a>, to convert the realm-agnostic result back into observable effects on the observable world of JavaScript objects on the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-7">event loop</a>.</ol>

  <div id="example-event-loop-using-algorithm" class="example"><p>The following is an algorithm that "encrypts" a passed-in <a id="event-loop-for-spec-authors:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <a href="https://triple-underscore.github.io/infra-ja.html#scalar-value-string" id="event-loop-for-spec-authors:scalar-value-string" data-x-internal="scalar-value-string">scalar value strings</a> <var>input</var>, after parsing them as URLs:</p>

   <ol><li><p>Let <var>urls</var> be an empty <a id="event-loop-for-spec-authors:list-2" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="event-loop-for-spec-authors:list-iterate" data-x-internal="list-iterate">For each</a> <var>string</var> of <var>input</var>:</p>

     <ol><li><p>Let <var>parsed</var> be the result of <a href="urls-and-fetching.html#parse-a-url" id="event-loop-for-spec-authors:parse-a-url">parsing</a> <var>string</var> relative to the <a href="#current-settings-object" id="event-loop-for-spec-authors:current-settings-object">current settings object</a>.<li><p>If <var>parsed</var> is failure, return a promise rejected with a <a id="event-loop-for-spec-authors:syntaxerror" href="https://triple-underscore.github.io/WebIDL-ja.html#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="event-loop-for-spec-authors:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>serialized</var> be the result of applying the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="event-loop-for-spec-authors:concept-url-serializer" data-x-internal="concept-url-serializer">URL serializer</a> to <var>parsed</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="event-loop-for-spec-authors:list-append" data-x-internal="list-append">Append</a> <var>serialized</var> to <var>urls</var>.</ol>
    <li><p>Let <var>realm</var> be the <a id="event-loop-for-spec-authors:current-realm-record" href="https://tc39.es/ecma262/#current-realm" data-x-internal="current-realm-record">current Realm Record</a>.<li><p>Let <var>p</var> be a new promise.<li><p>Run the following steps <a id="event-loop-for-spec-authors:in-parallel-6" href="infrastructure.html#in-parallel">in parallel</a>:</p>

     <ol><li><p>Let <var>encryptedURLs</var> be an empty <a id="event-loop-for-spec-authors:list-3" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="event-loop-for-spec-authors:list-iterate-2" data-x-internal="list-iterate">For each</a> <var>url</var> of <var>urls</var>:</p>

       <ol><li><p>Wait 100 milliseconds, so that people think we're doing heavy-duty encryption.<li><p>Let <var>encrypted</var> be a new <a id="event-loop-for-spec-authors:string" href="https://triple-underscore.github.io/infra-ja.html#string" data-x-internal="string">string</a> derived from <var>url</var>, whose <var>n</var>th <a id="event-loop-for-spec-authors:code-unit" href="https://triple-underscore.github.io/infra-ja.html#code-unit" data-x-internal="code-unit">code unit</a> is equal to <var>url</var>'s <var>n</var>th <a id="event-loop-for-spec-authors:code-unit-2" href="https://triple-underscore.github.io/infra-ja.html#code-unit" data-x-internal="code-unit">code unit</a> plus 13.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="event-loop-for-spec-authors:list-append-2" data-x-internal="list-append">Append</a> <var>encrypted</var> to <var>encryptedURLs</var>.</p>
       </ol>
      <li><p><a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-7">Queue a task</a>, on the <a href="#networking-task-source" id="event-loop-for-spec-authors:networking-task-source">networking task source</a>, to perform the following steps:</p>

       <ol><li><p>Let <var>array</var> be the result of <a href="https://triple-underscore.github.io/WebIDL-ja.html#es-type-mapping" id="event-loop-for-spec-authors:concept-idl-convert-2" data-x-internal="concept-idl-convert">converting</a> <var>encryptedURLs</var> to a JavaScript array, in <var>realm</var>.<li><p>Resolve <var>p</var> with <var>array</var>.</ol>
      </ol>
    <li><p>Return <var>p</var>.</ol>

   <p>Here are several things to notice about this algorithm:</p>

   <ul><li><p>It does its URL parsing up front, on the <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-8">event loop</a>, before going to the <a id="event-loop-for-spec-authors:in-parallel-7" href="infrastructure.html#in-parallel">in parallel</a> steps. This is necessary, since parsing depends on the <a href="#current-settings-object" id="event-loop-for-spec-authors:current-settings-object-2">current settings object</a>, which would no longer be current after going <a id="event-loop-for-spec-authors:in-parallel-8" href="infrastructure.html#in-parallel">in parallel</a>.<li><p>Alternately, it could have saved a reference to the <a href="#current-settings-object" id="event-loop-for-spec-authors:current-settings-object-3">current settings object</a>'s <a href="#api-base-url" id="event-loop-for-spec-authors:api-base-url">API base URL</a> and used it during the <a id="event-loop-for-spec-authors:in-parallel-9" href="infrastructure.html#in-parallel">in parallel</a> steps; that would have been equivalent. However, we recommend instead doing as much work as possible up front, as this example does. Attempting to save the correct values can be error prone; for example, if we'd saved just the <a href="#current-settings-object" id="event-loop-for-spec-authors:current-settings-object-4">current settings object</a>, instead of its <a href="#api-base-url" id="event-loop-for-spec-authors:api-base-url-2">API base URL</a>, there would have been a potential race.<li><p>It implicitly passes a <a id="event-loop-for-spec-authors:list-4" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <a href="https://triple-underscore.github.io/infra-ja.html#string" id="event-loop-for-spec-authors:string-2" data-x-internal="string">strings</a> from the initial steps to the <a id="event-loop-for-spec-authors:in-parallel-10" href="infrastructure.html#in-parallel">in parallel</a> steps. This is OK, as both <a href="https://triple-underscore.github.io/infra-ja.html#list" id="event-loop-for-spec-authors:list-5" data-x-internal="list">lists</a> and <a href="https://triple-underscore.github.io/infra-ja.html#string" id="event-loop-for-spec-authors:string-3" data-x-internal="string">strings</a> are <a href="https://tc39.es/ecma262/#sec-code-realms" id="event-loop-for-spec-authors:javascript-realm-3" data-x-internal="javascript-realm">realm</a>-agnostic.<li><p>It performs "expensive computation" (waiting for 100 milliseconds per input URL) during the <a id="event-loop-for-spec-authors:in-parallel-11" href="infrastructure.html#in-parallel">in parallel</a> steps, thus not blocking the main <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-9">event loop</a>.<li><p>Promises, as observable JavaScript objects, are never created and manipulated during the <a id="event-loop-for-spec-authors:in-parallel-12" href="infrastructure.html#in-parallel">in parallel</a> steps. <var>p</var> is created before entering those steps, and then is manipulated during a <a href="#concept-task" id="event-loop-for-spec-authors:concept-task-2">task</a> that is <a href="#queue-a-task" id="event-loop-for-spec-authors:queue-a-task-8">queued</a> specifically for that purpose.<li><p>The creation of a JavaScript array object also happens during the queued task, and is careful to specify which realm it creates the array in since that is no longer obvious from context.</ul>

   <p>(On these last two points, see also <a href="https://github.com/w3ctag/promises-guide/issues/52">w3ctag/promises-guide issue #52</a>, <a href="https://github.com/heycam/webidl/issues/135">heycam/webidl issue #135</a>, and <a href="https://github.com/heycam/webidl/issues/371">heycam/webidl issue #371</a>, where we are still mulling over the subtleties of the above promise-resolution pattern.)</p>

   <p>Another thing to note is that, in the event this algorithm was called from a Web IDL-specified operation taking a <code>sequence</code>&lt;<code id="event-loop-for-spec-authors:idl-usvstring"><a data-x-internal="idl-usvstring" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString">USVString</a></code>>, there was an automatic conversion from <a href="https://tc39.es/ecma262/#sec-code-realms" id="event-loop-for-spec-authors:javascript-realm-4" data-x-internal="javascript-realm">realm</a>-specific JavaScript objects provided by the author as input, into the realm-agnostic <code>sequence</code>&lt;<code id="event-loop-for-spec-authors:idl-usvstring-2"><a data-x-internal="idl-usvstring" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-USVString">USVString</a></code>> Web IDL type, which we then treat as a <a id="event-loop-for-spec-authors:list-6" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <a href="https://triple-underscore.github.io/infra-ja.html#scalar-value-string" id="event-loop-for-spec-authors:scalar-value-string-2" data-x-internal="scalar-value-string">scalar value strings</a>. So depending on how your specification is structured, there may be other implicit steps happening on the main <a href="#event-loop" id="event-loop-for-spec-authors:event-loop-10">event loop</a> that play a part in this whole process of getting you ready to go <a id="event-loop-for-spec-authors:in-parallel-13" href="infrastructure.html#in-parallel">in parallel</a>.</p>

  </div>


  

  <h4 id="events"><span class="secno">8.1.7</span> イベント<a href="#events" class="self-link"></a></h4>

  <h5 id="event-handler-attributes"><span class="secno">8.1.7.1</span> イベントハンドラー<a href="#event-handler-attributes" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Events/Event_handlers" title="The Web platform provides several ways to be notified of DOM events. Two common approaches are addEventListener() and the specific onevent handlers.">Events/Event_handlers</a></div></div>

  <p>多くのオブジェクトは、指定した<dfn id="event-handlers" data-lt="event handler" data-export="">イベントハンドラー</dfn>を持つことができる。これは、指定されたオブジェクトの非キャプチャ<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener" id="event-handler-attributes:event-listener" data-x-internal="event-listener">イベントリスナー</a>として機能する。<a href="references.html#refsDOM">[DOM]</a></p>

  

  <p><a href="#event-handlers" id="event-handler-attributes:event-handlers">イベントハンドラー</a>は、2つの<a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="event-handler-attributes:struct-item" data-x-internal="struct-item">項目</a>を持つ<a id="event-handler-attributes:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">構造体</a>である：</p>

  <ul><li><p><dfn id="event-handler-value">値</dfn>。これはnull、コールバックオブジェクト、または<a href="#internal-raw-uncompiled-handler" id="event-handler-attributes:internal-raw-uncompiled-handler">未処理の内部生ハンドラー</a>のいずれかである。<code id="event-handler-attributes:eventhandler"><a href="#eventhandler">EventHandler</a></code>コールバック関数型は、これがスクリプトに公開される方法を説明する。最初は、<a href="#event-handlers" id="event-handler-attributes:event-handlers-2">イベントハンドラー</a>の<a href="#event-handler-value" id="event-handler-attributes:event-handler-value">値</a>をnullに設定しなければならない。<li><p><dfn id="event-handler-listener">リスナー</dfn>。これは、nullまたは<a href="#the-event-handler-processing-algorithm" id="event-handler-attributes:the-event-handler-processing-algorithm">イベントハンドラー処理アルゴリズム</a>の実行を担当する<a id="event-handler-attributes:event-listener-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener" data-x-internal="event-listener">イベントリスナー</a>のいずれかである。最初は、<a href="#event-handlers" id="event-handler-attributes:event-handlers-3">イベントハンドラー</a>の<a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener">リスナー</a>をnullに設定しなければならない。</ul>

  

  <p>イベントハンドラーは2つの方法で公開される。</p>

  <p>1つ目の方法は、すべてのイベントハンドラーに共通する、<a href="#event-handler-idl-attributes" id="event-handler-attributes:event-handler-idl-attributes">イベントハンドラーIDL属性</a>としてである。</p>

  <p>2つ目の方法は、<a href="#event-handler-content-attributes" id="event-handler-attributes:event-handler-content-attributes">イベントハンドラーコンテンツ属性</a>としてである。<a id="event-handler-attributes:html-elements" href="infrastructure.html#html-elements">HTML要素</a>のイベントハンドラーおよび<code id="event-handler-attributes:window"><a href="window-object.html#window">Window</a></code>オブジェクトのイベントハンドラーの一部は、この方法で公開される。</p>

  <p>これら2つの方法の両方で、<a href="#event-handlers" id="event-handler-attributes:event-handlers-4">イベントハンドラー</a>は<dfn id="event-handler-name">名前</dfn>を通して公開される。名前は、常に"<code>on</code>"で始まり、その後にハンドラーの対象となるイベントの名前が続く文字列である。</p>

  <hr>

  <p>ほとんどの場合、<a href="#event-handlers" id="event-handler-attributes:event-handlers-5">イベントハンドラー</a>を公開するオブジェクトは、対応する<a id="event-handler-attributes:event-listener-3" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener" data-x-internal="event-listener">イベントリスナー</a>が追加されるオブジェクトと同じである。しかし、<code id="event-handler-attributes:the-body-element"><a href="sections.html#the-body-element">body</a></code>要素および<code id="event-handler-attributes:frameset"><a href="obsolete.html#frameset">frameset</a></code>要素は、要素の<code id="event-handler-attributes:window-2"><a href="window-object.html#window">Window</a></code>オブジェクト（存在する場合）に作用するいくつかの<a href="#event-handlers" id="event-handler-attributes:event-handlers-6">イベントハンドラー</a>を公開する。いずれの場合も、<a href="#event-handlers" id="event-handler-attributes:event-handlers-7">イベントハンドラー</a>がその<a href="#event-handlers" id="event-handler-attributes:event-handlers-8">イベントハンドラー</a>の<dfn id="event-handler-target">ターゲット</dfn>に作用するオブジェクトを呼び出す。</p>

  

  <p>To <dfn id="determining-the-target-of-an-event-handler">determine the target of an event handler</dfn>, given an <code id="event-handler-attributes:eventtarget"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var> on which the <a href="#event-handlers" id="event-handler-attributes:event-handlers-9">event handler</a> is exposed, and an <a href="#event-handler-name" id="event-handler-attributes:event-handler-name">event handler name</a> <var>name</var>, the following steps are taken:</p>

  <ol><li><p>If <var>eventTarget</var> is not a <code id="event-handler-attributes:the-body-element-2"><a href="sections.html#the-body-element">body</a></code> element or a <code id="event-handler-attributes:frameset-2"><a href="obsolete.html#frameset">frameset</a></code> element, then return <var>eventTarget</var>.<li><p>If <var>name</var> is not the name of an attribute member of the <code id="event-handler-attributes:windoweventhandlers"><a href="#windoweventhandlers">WindowEventHandlers</a></code> interface mixin and the <a href="#window-reflecting-body-element-event-handler-set" id="event-handler-attributes:window-reflecting-body-element-event-handler-set"><code>Window</code>-reflecting body element event handler set</a> does not <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="event-handler-attributes:list-contains" data-x-internal="list-contains">contain</a> <var>name</var>, then return <var>eventTarget</var>.<li><p>If <var>eventTarget</var>'s <a id="event-handler-attributes:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a> is not an <a id="event-handler-attributes:active-document" href="browsers.html#active-document">active document</a>, then return null.</p>

    <p class="note">This could happen if this object is a <code id="event-handler-attributes:the-body-element-3"><a href="sections.html#the-body-element">body</a></code> element without a corresponding <code id="event-handler-attributes:window-3"><a href="window-object.html#window">Window</a></code> object, for example.</p>

    <p class="note">This check does not necessarily prevent <code id="event-handler-attributes:the-body-element-4"><a href="sections.html#the-body-element">body</a></code> and <code id="event-handler-attributes:frameset-3"><a href="obsolete.html#frameset">frameset</a></code> elements that are not <a id="event-handler-attributes:the-body-element-2-2" href="dom.html#the-body-element-2">the body element</a> of their <a id="event-handler-attributes:node-document-2" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a> from reaching the next step. In particular, a <code id="event-handler-attributes:the-body-element-5"><a href="sections.html#the-body-element">body</a></code> element created in an <a id="event-handler-attributes:active-document-2" href="browsers.html#active-document">active document</a> (perhaps with <code id="event-handler-attributes:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">document.createElement()</a></code>) but not <a id="event-handler-attributes:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">connected</a> will also have its corresponding <code id="event-handler-attributes:window-4"><a href="window-object.html#window">Window</a></code> object as the <a href="#event-handler-target" id="event-handler-attributes:event-handler-target">target</a> of several <a href="#event-handlers" id="event-handler-attributes:event-handlers-10">event handlers</a> exposed through it.</p>
   <li><p>Return <var>eventTarget</var>'s <a id="event-handler-attributes:node-document-3" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s <a href="#concept-relevant-global" id="event-handler-attributes:concept-relevant-global">relevant global object</a>.</ol>

  <hr>

  <p>Each <code id="event-handler-attributes:eventtarget-2"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object that has one or more <a href="#event-handlers" id="event-handler-attributes:event-handlers-11">event handlers</a> specified has an associated <dfn id="event-handler-map">event handler map</dfn>, which is a <a href="https://triple-underscore.github.io/infra-ja.html#ordered-map" id="event-handler-attributes:ordered-map" data-x-internal="ordered-map">map</a> of strings representing <a href="#event-handler-name" id="event-handler-attributes:event-handler-name-2">names</a> of <a href="#event-handlers" id="event-handler-attributes:event-handlers-12">event handlers</a> to <a href="#event-handlers" id="event-handler-attributes:event-handlers-13">event handlers</a>.</p>

  <p>When an <code id="event-handler-attributes:eventtarget-3"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object that has one or more <a href="#event-handlers" id="event-handler-attributes:event-handlers-14">event handlers</a> specified is created, its <a href="#event-handler-map" id="event-handler-attributes:event-handler-map">event handler map</a> must be initialized such that it contains an <a href="https://triple-underscore.github.io/infra-ja.html#map-entry" id="event-handler-attributes:map-entry" data-x-internal="map-entry">entry</a> for each <a href="#event-handlers" id="event-handler-attributes:event-handlers-15">event handler</a> that has that object as <a href="#event-handler-target" id="event-handler-attributes:event-handler-target-2">target</a>, with <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="event-handler-attributes:struct-item-2" data-x-internal="struct-item">items</a> in those <a href="#event-handlers" id="event-handler-attributes:event-handlers-16">event handlers</a> set to their initial values.</p>

  <p class="note">The order of the <a href="https://triple-underscore.github.io/infra-ja.html#map-entry" id="event-handler-attributes:map-entry-2" data-x-internal="map-entry">entries</a> of <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-2">event handler map</a> could be arbitrary. It is not observable through any algorithms that operate on the map.</p>

  <p class="note"><a href="https://triple-underscore.github.io/infra-ja.html#map-entry" id="event-handler-attributes:map-entry-3" data-x-internal="map-entry">Entries</a> are not created in the <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-3">event handler map</a> of an object for <a href="#event-handlers" id="event-handler-attributes:event-handlers-17">event handlers</a> that are merely exposed on that object, but have some other object as their <a href="#event-handler-target" id="event-handler-attributes:event-handler-target-3">targets</a>.</p>

  

  <hr>

  <p><dfn id="event-handler-idl-attributes" data-export="">イベントハンドラーIDL属性</dfn>は、特定の<a href="#event-handlers" id="event-handler-attributes:event-handlers-18">イベントハンドラー</a>に対するIDL属性である。IDL属性の名前は、<a href="#event-handlers" id="event-handler-attributes:event-handlers-19">イベントハンドラー</a>の<a href="#event-handler-name" id="event-handler-attributes:event-handler-name-3">名前</a>と同じである。</p>

  

  <p>The getter of an <a href="#event-handler-idl-attributes" id="event-handler-attributes:event-handler-idl-attributes-2">event handler IDL attribute</a> with name <var>name</var>, when called, must run these steps:</p>

  <ol><li><p>Let <var>eventTarget</var> be the result of <a href="#determining-the-target-of-an-event-handler" id="event-handler-attributes:determining-the-target-of-an-event-handler">determining the target of an event handler</a> given this object and <var>name</var>.<li><p>If <var>eventTarget</var> is null, then return null.<li><p>Return the result of <a href="#getting-the-current-value-of-the-event-handler" id="event-handler-attributes:getting-the-current-value-of-the-event-handler">getting the current value of the event handler</a> given <var>eventTarget</var> and <var>name</var>.</p>
  </ol>

  <p>The setter of an <a href="#event-handler-idl-attributes" id="event-handler-attributes:event-handler-idl-attributes-3">event handler IDL attribute</a> with name <var>name</var>, when called, must run these steps:</p>

  <ol><li><p>Let <var>eventTarget</var> be the result of <a href="#determining-the-target-of-an-event-handler" id="event-handler-attributes:determining-the-target-of-an-event-handler-2">determining the target of an event handler</a> given this object and <var>name</var>.<li><p>If <var>eventTarget</var> is null, then return.<li><p>If the given value is null, then <a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler">deactivate an event handler</a> given <var>eventTarget</var> and <var>name</var>.<li><p>Otherwise:</p>

    <ol><li><p>Let <var>handlerMap</var> be <var>eventTarget</var>'s <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-4">event handler map</a>.<li><p>Let <var>eventHandler</var> be <var>handlerMap</var>[<var>name</var>].<li><p>Set <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-2">value</a> to the given value.<li><p><a href="#activate-an-event-handler" id="event-handler-attributes:activate-an-event-handler">Activate an event handler</a> given <var>eventTarget</var> and <var>name</var>.</ol>
   </ol>

  <p class="note">Certain <a href="#event-handler-idl-attributes" id="event-handler-attributes:event-handler-idl-attributes-4">event handler IDL attributes</a> have additional requirements, in particular the <code id="event-handler-attributes:handler-messageport-onmessage"><a href="web-messaging.html#handler-messageport-onmessage">onmessage</a></code> attribute of <code id="event-handler-attributes:messageport"><a href="web-messaging.html#messageport">MessagePort</a></code> objects.</p>

  

  <hr>

  <p><dfn id="event-handler-content-attributes" data-export="">イベントハンドラーコンテンツ属性</dfn>は、特定の<a href="#event-handlers" id="event-handler-attributes:event-handlers-20">イベントハンドラー</a>に対するコンテンツ属性である。コンテンツ属性の名前は、<a href="#event-handlers" id="event-handler-attributes:event-handlers-21">イベントハンドラー</a>の<a href="#event-handler-name" id="event-handler-attributes:event-handler-name-4">名前</a>と同じである。</p>

  <p><a href="#event-handler-content-attributes" id="event-handler-attributes:event-handler-content-attributes-2">イベントハンドラーコンテンツ属性</a>が指定される場合、解析されるときに、<a id="event-handler-attributes:automatic-semicolon-insertion" href="https://tc39.es/ecma262/#sec-automatic-semicolon-insertion" data-x-internal="automatic-semicolon-insertion">自動セミコロン挿入</a>後の<i id="event-handler-attributes:js-prod-functionbody"><a data-x-internal="js-prod-functionbody" href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></i>生成物と一致する、妥当なJavaScriptコードを含まなければならない。</p>

  

  <p>The following <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-change-ext" id="event-handler-attributes:concept-element-attributes-change-ext" data-x-internal="concept-element-attributes-change-ext">attribute change steps</a> are used to synchronize between <a href="#event-handler-content-attributes" id="event-handler-attributes:event-handler-content-attributes-3">event handler content attributes</a> and <a href="#event-handlers" id="event-handler-attributes:event-handlers-22">event handlers</a>: <a href="references.html#refsDOM">[DOM]</a></p>

  <ol><li><p>If <var>namespace</var> is not null, or <var>localName</var> is not the name of an <a href="#event-handler-content-attributes" id="event-handler-attributes:event-handler-content-attributes-4">event handler content attribute</a> on <var>element</var>, then return.<li><p>Let <var>eventTarget</var> be the result of <a href="#determining-the-target-of-an-event-handler" id="event-handler-attributes:determining-the-target-of-an-event-handler-3">determining the target of an event handler</a> given <var>element</var> and <var>localName</var>.<li><p>If <var>eventTarget</var> is null, then return.<li><p>If <var>value</var> is null, then <a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler-2">deactivate an event handler</a> given <var>eventTarget</var> and <var>localName</var>.<li><p>Otherwise:</p>

    <ol><li><p>If the <a id="event-handler-attributes:should-element's-inline-behavior-be-blocked-by-content-security-policy" href="https://triple-underscore.github.io/CSP3-ja.html#should-block-inline" data-x-internal="should-element's-inline-behavior-be-blocked-by-content-security-policy">Should element's inline behavior be blocked by Content Security Policy?</a> algorithm returns "<code>Blocked</code>" when executed upon <var>element</var>, "<code>script attribute</code>", and <var>value</var>, then return. <a href="references.html#refsCSP">[CSP]</a><li><p>Let <var>handlerMap</var> be <var>eventTarget</var>'s <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-5">event handler map</a>.<li><p>Let <var>eventHandler</var> be <var>handlerMap</var>[<var>localName</var>].<li><p>Let <var>location</var> be the script location that triggered the execution of these steps.<li><p>Set <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-3">value</a> to the <a href="#internal-raw-uncompiled-handler" id="event-handler-attributes:internal-raw-uncompiled-handler-2">internal raw uncompiled handler</a> <var>value</var>/<var>location</var>.<li><p><a href="#activate-an-event-handler" id="event-handler-attributes:activate-an-event-handler-2">Activate an event handler</a> given <var>eventTarget</var> and <var>localName</var>.</ol>
   </ol>

  <p class="note">Per the DOM Standard, these steps are run even if <var>oldValue</var> and <var>value</var> are identical (setting an attribute to its current value), but <em>not</em> if <var>oldValue</var> and <var>value</var> are both null (removing an attribute that doesn't currently exist). <a href="references.html#refsDOM">[DOM]</a></p>

  <hr>

  <p>To <dfn id="deactivate-an-event-handler">deactivate an event handler</dfn> given an <code id="event-handler-attributes:eventtarget-4"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var> and a string <var>name</var> that is the <a href="#event-handler-name" id="event-handler-attributes:event-handler-name-5">name</a> of an <a href="#event-handlers" id="event-handler-attributes:event-handlers-23">event handler</a>, run these steps:</p>

  <ol><li><p>Let <var>handlerMap</var> be <var>eventTarget</var>'s <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-6">event handler map</a>.<li><p>Let <var>eventHandler</var> be <var>handlerMap</var>[<var>name</var>].<li><p>Set <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-4">value</a> to null.<li><p>Let <var>listener</var> be <var>eventHandler</var>'s <a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener-2">listener</a>.<li><p>If <var>listener</var> is not null, then <a id="event-handler-attributes:remove-an-event-listener" href="https://triple-underscore.github.io/DOM4-ja.html#remove-an-event-listener" data-x-internal="remove-an-event-listener">remove an event listener</a> with <var>eventTarget</var> and <var>listener</var>.<li><p>Set <var>eventHandler</var>'s <a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener-3">listener</a> to null.</ol>

  <p>To <dfn id="erase-all-event-listeners-and-handlers">erase all event listeners and handlers</dfn> given an <code id="event-handler-attributes:eventtarget-5"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var>, run these steps:</p>

  <ol><li><p>If <var>eventTarget</var> has an associated <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-7">event handler map</a>, then for each <var>name</var> → <var>eventHandler</var> of <var>eventTarget</var>'s associated <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-8">event handler map</a>, <a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler-3">deactivate an event handler</a> given <var>eventTarget</var> and <var>name</var>.<li><p><a id="event-handler-attributes:remove-all-event-listeners" href="https://triple-underscore.github.io/DOM4-ja.html#remove-all-event-listeners" data-x-internal="remove-all-event-listeners">Remove all event listeners</a> given <var>eventTarget</var>.</ol>

  <p class="note">This algorithm is used to define <code id="event-handler-attributes:dom-document-open"><a href="dynamic-markup-insertion.html#dom-document-open">document.open()</a></code>.</p>

  <p>To <dfn id="activate-an-event-handler">activate an event handler</dfn> given an <code id="event-handler-attributes:eventtarget-6"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var> and a string <var>name</var> that is the <a href="#event-handler-name" id="event-handler-attributes:event-handler-name-6">name</a> of an <a href="#event-handlers" id="event-handler-attributes:event-handlers-24">event handler</a>, run these steps:</p>

  <ol><li><p>Let <var>handlerMap</var> be <var>eventTarget</var>'s <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-9">event handler map</a>.<li><p>Let <var>eventHandler</var> be <var>handlerMap</var>[<var>name</var>].<li><p>If <var>eventHandler</var>'s <a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener-4">listener</a> is not null, then return.<li><p>Let <var>callback</var> be the result of creating a Web IDL <code id="event-handler-attributes:dom-eventlistener"><a data-x-internal="dom-eventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#callbackdef-eventlistener">EventListener</a></code> instance representing a reference to a function of one argument that executes the steps of <a href="#the-event-handler-processing-algorithm" id="event-handler-attributes:the-event-handler-processing-algorithm-2">the event handler processing algorithm</a>, given <var>eventTarget</var>, <var>name</var>, and its argument.</p>

    <p>The <code id="event-handler-attributes:dom-eventlistener-2"><a data-x-internal="dom-eventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#callbackdef-eventlistener">EventListener</a></code>'s <a id="event-handler-attributes:callback-context" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a> can be arbitrary; it does not impact the steps of <a href="#the-event-handler-processing-algorithm" id="event-handler-attributes:the-event-handler-processing-algorithm-3">the event handler processing algorithm</a>. <a href="references.html#refsDOM">[DOM]</a></p>

    <p class="note">The callback is emphatically <em>not</em> the <a href="#event-handlers" id="event-handler-attributes:event-handlers-25">event handler</a> itself. Every event handler ends up registering the same callback, the algorithm defined below, which takes care of invoking the right code, and processing the code's return value.</p>
   <li><p>Let <var>listener</var> be a new <a id="event-handler-attributes:event-listener-4" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener" data-x-internal="event-listener">event listener</a> whose <a href="https://triple-underscore.github.io/DOM4-ja.html#event-listener-type" id="event-handler-attributes:event-listener-type" data-x-internal="event-listener-type">type</a> is the <dfn id="event-handler-event-type" data-export="">event handler event type</dfn> corresponding to <var>eventHandler</var> and <a href="https://triple-underscore.github.io/DOM4-ja.html#event-listener-callback" id="event-handler-attributes:event-listener-callback" data-x-internal="event-listener-callback">callback</a> is <var>callback</var>.</p>

    <p class="note">To be clear, an <a id="event-handler-attributes:event-listener-5" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-listener" data-x-internal="event-listener">event listener</a> is different from an <code id="event-handler-attributes:dom-eventlistener-3"><a data-x-internal="dom-eventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#callbackdef-eventlistener">EventListener</a></code>.</p>
   <li><p><a id="event-handler-attributes:add-an-event-listener" href="https://triple-underscore.github.io/DOM4-ja.html#add-an-event-listener" data-x-internal="add-an-event-listener">Add an event listener</a> with <var>eventTarget</var> and <var>listener</var>.<li><p>Set <var>eventHandler</var>'s <a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener-5">listener</a> to <var>listener</var>.</ol>

  <div class="note"><p>The event listener registration happens only if the <a href="#event-handlers" id="event-handler-attributes:event-handlers-26">event handler</a>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-5">value</a> is being set to non-null, and the <a href="#event-handlers" id="event-handler-attributes:event-handlers-27">event handler</a> is not already activated. Since listeners are called in the order they were registered, assuming no <a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler-4">deactivation</a> occurred, the order of event listeners for a particular event type will always be:</p>

   <ol><li><p>the event listeners registered with <code id="event-handler-attributes:dom-eventtarget-addeventlistener"><a data-x-internal="dom-eventtarget-addeventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener">addEventListener()</a></code> before the first time the <a href="#event-handlers" id="event-handler-attributes:event-handlers-28">event handler</a>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-6">value</a> was set to non-null<li><p>then the callback to which it is currently set, if any<li><p>and finally the event listeners registered with <code id="event-handler-attributes:dom-eventtarget-addeventlistener-2"><a data-x-internal="dom-eventtarget-addeventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener">addEventListener()</a></code> <em>after</em> the first time the <a href="#event-handlers" id="event-handler-attributes:event-handlers-29">event handler</a>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-7">value</a> was set to non-null.</ol>
  </div>

  

  <div class="example"><p>この例は、イベントリスナーが呼び出される順序を示す。この例でボタンがユーザーによってクリックされる場合、ページはそれぞれテキスト"ONE"、"TWO"、"THREE"、"FOUR"をもつ4つの警告を表示する。</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>id</c-><c- o>=</c-><c- s>"test"</c-><c- p>></c->Start Demo<c- p>&lt;/</c-><c- f>button</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- a>var</c-> button <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'test'</c-><c- p>);</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'ONE'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
 button<c- p>.</c->setAttribute<c- p>(</c-><c- t>'onclick'</c-><c- p>,</c-> <c- u>"alert('NOT CALLED')"</c-><c- p>);</c-> <c- c1>// event handler listener is registered here</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'THREE'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
 button<c- p>.</c->onclick <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'TWO'</c-><c- p>);</c-> <c- p>};</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'FOUR'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>しかし、次の例では、イベントハンドラーは、最初のアクティブ化の後（およびイベントリスナーが削除された後）、後で再アクティブ化される前に<a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler-5">非アクティブ化</a>される。このページには、"ONE"、"TWO"、"THREE"、"FOUR"、"FIVE"の順に5つのアラートが表示される。</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>id</c-><c- o>=</c-><c- s>"test"</c-><c- p>></c->Start Demo<c- p>&lt;/</c-><c- f>button</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- a>var</c-> button <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- t>'test'</c-><c- p>);</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'ONE'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
 button<c- p>.</c->setAttribute<c- p>(</c-><c- t>'onclick'</c-><c- p>,</c-> <c- u>"alert('NOT CALLED')"</c-><c- p>);</c-> <c- c1>// event handler is activated here</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'TWO'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
 button<c- p>.</c->onclick <c- o>=</c-> <c- kc>null</c-><c- p>;</c->                                 <c- c1>// but deactivated here</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'THREE'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
 button<c- p>.</c->onclick <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'FOUR'</c-><c- p>);</c-> <c- p>};</c->       <c- c1>// and re-activated here</c->
 button<c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c-> alert<c- p>(</c-><c- t>'FIVE'</c-><c- p>)</c-> <c- p>},</c-> <c- kc>false</c-><c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  </div>

  

  <p class="note">The interfaces implemented by the event object do not influence whether an <a href="#event-handlers" id="event-handler-attributes:event-handlers-30">event handler</a> is triggered or not.</p>

  <p><dfn id="the-event-handler-processing-algorithm">The event handler processing algorithm</dfn> for an <code id="event-handler-attributes:eventtarget-7"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var>, a string <var>name</var> representing the <a href="#event-handler-name" id="event-handler-attributes:event-handler-name-7">name</a> of an <a href="#event-handlers" id="event-handler-attributes:event-handlers-31">event handler</a>, and an <code id="event-handler-attributes:event"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code> object <var>event</var> is as follows:</p>

  <ol><li><p>Let <var>callback</var> be the result of <a href="#getting-the-current-value-of-the-event-handler" id="event-handler-attributes:getting-the-current-value-of-the-event-handler-2">getting the current value of the event handler</a> given <var>eventTarget</var> and <var>name</var>.<li><p>If <var>callback</var> is null, then return.<li><p>Let <var>special error event handling</var> be true if <var>event</var> is an <code id="event-handler-attributes:errorevent"><a href="#errorevent">ErrorEvent</a></code> object, <var>event</var>'s <code id="event-handler-attributes:dom-event-type"><a data-x-internal="dom-event-type" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-type">type</a></code> is <code id="event-handler-attributes:event-error"><a href="indices.html#event-error">error</a></code>, and <var>event</var>'s <code id="event-handler-attributes:dom-event-currenttarget"><a data-x-internal="dom-event-currenttarget" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget">currentTarget</a></code> implements the <code id="event-handler-attributes:windoworworkerglobalscope"><a href="#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code> mixin. Otherwise, let <var>special error event handling</var> be false.<li><p>Process the <code id="event-handler-attributes:event-2"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code> object <var>event</var> as follows:</p>

    <dl class="switch"><dt>If <var>special error event handling</var> is true<dd><p><a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="event-handler-attributes:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>callback</var> with five arguments, the first one having the value of <var>event</var>'s <code id="event-handler-attributes:dom-errorevent-message"><a href="#dom-errorevent-message">message</a></code> attribute, the second having the value of <var>event</var>'s <code id="event-handler-attributes:dom-errorevent-filename"><a href="#dom-errorevent-filename">filename</a></code> attribute, the third having the value of <var>event</var>'s <code id="event-handler-attributes:dom-errorevent-lineno"><a href="#dom-errorevent-lineno">lineno</a></code> attribute, the fourth having the value of <var>event</var>'s <code id="event-handler-attributes:dom-errorevent-colno"><a href="#dom-errorevent-colno">colno</a></code> attribute, the fifth having the value of <var>event</var>'s <code id="event-handler-attributes:dom-errorevent-error"><a href="#dom-errorevent-error">error</a></code> attribute, and with the <i id="event-handler-attributes:dfn-callback-this-value"><a data-x-internal="dfn-callback-this-value" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value">callback this value</a></i> set to <var>event</var>'s <code id="event-handler-attributes:dom-event-currenttarget-2"><a data-x-internal="dom-event-currenttarget" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget">currentTarget</a></code>. Let <var>return value</var> be the callback's return value. <a href="references.html#refsWEBIDL">[WEBIDL]</a></p>
     <dt>そうでなければ<dd><p><a href="https://triple-underscore.github.io/WebIDL-ja.html#invoke-a-callback-function" id="event-handler-attributes:es-invoking-callback-functions-2" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>callback</var> with one argument, the value of which is the <code id="event-handler-attributes:event-3"><a data-x-internal="event" href="https://triple-underscore.github.io/DOM4-ja.html#interface-event">Event</a></code> object <var>event</var>, with the <i id="event-handler-attributes:dfn-callback-this-value-2"><a data-x-internal="dfn-callback-this-value" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-this-value">callback this value</a></i> set to <var>event</var>'s <code id="event-handler-attributes:dom-event-currenttarget-3"><a data-x-internal="dom-event-currenttarget" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-currenttarget">currentTarget</a></code>. Let <var>return value</var> be the callback's return value. <a href="references.html#refsWEBIDL">[WEBIDL]</a></p>
     </dl>

    <p>If an exception gets thrown by the callback, end these steps and allow the exception to propagate. (It will propagate to the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-dispatch" id="event-handler-attributes:concept-event-dispatch" data-x-internal="concept-event-dispatch">DOM event dispatch logic</a>, which will then <a href="#report-the-exception" id="event-handler-attributes:report-the-exception">report the exception</a>.)</p>
   <li><p>Process <var>return value</var> as follows:</p>

    <dl class="switch"><dt>If <var>event</var> is a <code id="event-handler-attributes:beforeunloadevent"><a href="browsing-the-web.html#beforeunloadevent">BeforeUnloadEvent</a></code> object and <var>event</var>'s <code id="event-handler-attributes:dom-event-type-2"><a data-x-internal="dom-event-type" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-type">type</a></code> is <code id="event-handler-attributes:event-beforeunload"><a href="indices.html#event-beforeunload">beforeunload</a></code><dd><p class="note">In this case, the <a href="#event-handler-idl-attributes" id="event-handler-attributes:event-handler-idl-attributes-5">event handler IDL attribute</a>'s type will be <code id="event-handler-attributes:onbeforeunloadeventhandler"><a href="#onbeforeunloadeventhandler">OnBeforeUnloadEventHandler</a></code>, so <var>return value</var> will have been coerced into either null or a <code id="event-handler-attributes:idl-domstring"><a data-x-internal="idl-domstring" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-DOMString">DOMString</a></code>.</p>

      <p>If <var>return value</var> is not null, then:</p>

      <ol><li><p>Set <var>event</var>'s <a id="event-handler-attributes:canceled-flag" href="https://triple-underscore.github.io/DOM4-ja.html#canceled-flag" data-x-internal="canceled-flag">canceled flag</a>.<li><p>If <var>event</var>'s <code id="event-handler-attributes:dom-beforeunloadevent-returnvalue"><a href="browsing-the-web.html#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute's value is the empty string, then set <var>event</var>'s <code id="event-handler-attributes:dom-beforeunloadevent-returnvalue-2"><a href="browsing-the-web.html#dom-beforeunloadevent-returnvalue">returnValue</a></code> attribute's value to <var>return value</var>.</ol>
     <dt>If <var>special error event handling</var> is true<dd><p>If <var>return value</var> is true, then set <var>event</var>'s <a id="event-handler-attributes:canceled-flag-2" href="https://triple-underscore.github.io/DOM4-ja.html#canceled-flag" data-x-internal="canceled-flag">canceled flag</a>.<dt>そうでなければ<dd><p>If <var>return value</var> is false, then set <var>event</var>'s <a id="event-handler-attributes:canceled-flag-3" href="https://triple-underscore.github.io/DOM4-ja.html#canceled-flag" data-x-internal="canceled-flag">canceled flag</a>.</p>

      <p class="note">If we've gotten to this "Otherwise" clause because <var>event</var>'s <code id="event-handler-attributes:dom-event-type-3"><a data-x-internal="dom-event-type" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-type">type</a></code> is <code id="event-handler-attributes:event-beforeunload-2"><a href="indices.html#event-beforeunload">beforeunload</a></code> but <var>event</var> is <em>not</em> a <code id="event-handler-attributes:beforeunloadevent-2"><a href="browsing-the-web.html#beforeunloadevent">BeforeUnloadEvent</a></code> object, then <var>return value</var> will never be false, since in such cases <var>return value</var> will have been coerced into either null or a <code id="event-handler-attributes:idl-domstring-2"><a data-x-internal="idl-domstring" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-DOMString">DOMString</a></code>.</p>
     </dl>
   </ol>

  

  <hr>

  <p><code id="event-handler-attributes:eventhandler-2"><a href="#eventhandler">EventHandler</a></code>コールバック関数型は、イベントハンドラーに対して使用されるコールバックを表す。これは以下のようにWeb IDLで表される：</p>

  <pre><code class='idl'>[<a id='event-handler-attributes:legacytreatnonobjectasnull' href='https://triple-underscore.github.io/WebIDL-ja.html#LegacyTreatNonObjectAsNull' data-x-internal='legacytreatnonobjectasnull'><c- g>LegacyTreatNonObjectAsNull</c-></a>]
<c- b>callback</c-> <dfn id='eventhandlernonnull'><c- g>EventHandlerNonNull</c-></dfn> = <c- b>any</c-> (<a id='event-handler-attributes:event-4' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> <c- g>event</c->);
<c- b>typedef</c-> <a href='#eventhandlernonnull' id='event-handler-attributes:eventhandlernonnull'><c- n>EventHandlerNonNull</c-></a>? <dfn id='eventhandler'><c- g>EventHandler</c-></dfn>;</code></pre>

  <p class="note">JavaScriptにおいて、すべての<code id="event-handler-attributes:idl-function"><a data-x-internal="idl-function" href="https://triple-underscore.github.io/WebIDL-ja.html#common-Function">Function</a></code>オブジェクトがこのインターフェイスを実装する。</p>

  <div class="example"><p>たとえば、次の文書断片で：</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>body</c-> <c- e>onload</c-><c- o>=</c-><c- s>"alert(this)"</c-> <c- e>onclick</c-><c- o>=</c-><c- s>"alert(this)"</c-><c- p>></c-></code></pre>

   <p>文書がロードされるときに"<code>[object Window]</code>"という警告を、ページでユーザーが何かをクリックするときはいつでも"<code>[object HTMLBodyElement]</code>"という警告を流す。</p>

  </div>

  <div class="note"><p>関数の戻り値は、イベントがキャンセルされるかどうかに影響する。上記のように、戻り値がfalseの場合、イベントはキャンセルされる。</p>

   <p>プラットフォームには、歴史的な理由から2つの例外がある：</p>

   <ul><li><p>グローバルオブジェクトの<code id="event-handler-attributes:handler-onerror"><a href="#handler-onerror">onerror</a></code>ハンドラー。<em>true</em>を返すとイベントがキャンセルされる<li><p>null以外および未定義の値を返す<code id="event-handler-attributes:handler-window-onbeforeunload"><a href="#handler-window-onbeforeunload">onbeforeunload</a></code>ハンドラーは、イベントをキャンセルする。</ul>
  </div>

  <p>歴史的な理由により、<code id="event-handler-attributes:handler-onerror-2"><a href="#handler-onerror">onerror</a></code>ハンドラーは、異なる引数を持つ。</p>

  <pre><code class='idl'>[<a id='event-handler-attributes:legacytreatnonobjectasnull-2' href='https://triple-underscore.github.io/WebIDL-ja.html#LegacyTreatNonObjectAsNull' data-x-internal='legacytreatnonobjectasnull'><c- g>LegacyTreatNonObjectAsNull</c-></a>]
<c- b>callback</c-> <dfn id='onerroreventhandlernonnull'><c- g>OnErrorEventHandlerNonNull</c-></dfn> = <c- b>any</c-> ((<a id='event-handler-attributes:event-5' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> <c- b>or</c-> <c- b>DOMString</c->) <c- g>event</c->, <c- b>optional</c-> <c- b>DOMString</c-> <c- g>source</c->, <c- b>optional</c-> <c- b>unsigned</c-> <c- b>long</c-> <c- g>lineno</c->, <c- b>optional</c-> <c- b>unsigned</c-> <c- b>long</c-> <c- g>colno</c->, <c- b>optional</c-> <c- b>any</c-> <c- g>error</c->);
<c- b>typedef</c-> <a href='#onerroreventhandlernonnull' id='event-handler-attributes:onerroreventhandlernonnull'><c- n>OnErrorEventHandlerNonNull</c-></a>? <dfn id='onerroreventhandler'><c- g>OnErrorEventHandler</c-></dfn>;</code></pre>

  <div class="example"><pre><code class='js'>window<c- p>.</c->onerror <c- o>=</c-> <c- p>(</c->message<c- p>,</c-> source<c- p>,</c-> lineno<c- p>,</c-> colno<c- p>,</c-> error<c- p>)</c-> <c- p>=></c-> <c- p>{</c-> … <c- p>};</c-></code></pre>
  </div>

  <p>同様に、<code id="event-handler-attributes:handler-window-onbeforeunload-2"><a href="#handler-window-onbeforeunload">onbeforeunload</a></code>ハンドラーは異なる戻り値を持つ：</p>

  <pre><code class='idl'>[<a id='event-handler-attributes:legacytreatnonobjectasnull-3' href='https://triple-underscore.github.io/WebIDL-ja.html#LegacyTreatNonObjectAsNull' data-x-internal='legacytreatnonobjectasnull'><c- g>LegacyTreatNonObjectAsNull</c-></a>]
<c- b>callback</c-> <dfn id='onbeforeunloadeventhandlernonnull'><c- g>OnBeforeUnloadEventHandlerNonNull</c-></dfn> = <c- b>DOMString</c->? (<a id='event-handler-attributes:event-6' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> <c- g>event</c->);
<c- b>typedef</c-> <a href='#onbeforeunloadeventhandlernonnull' id='event-handler-attributes:onbeforeunloadeventhandlernonnull'><c- n>OnBeforeUnloadEventHandlerNonNull</c-></a>? <dfn id='onbeforeunloadeventhandler'><c- g>OnBeforeUnloadEventHandler</c-></dfn>;</code></pre>

  

  

  <hr>

  <p>An <dfn id="internal-raw-uncompiled-handler">internal raw uncompiled handler</dfn> is a tuple with the following information:</p>

  <ul class="brief"><li>An uncompiled script body<li>A location where the script body originated, in case an error needs to be reported</ul>

  <p>When the user agent is to <dfn id="getting-the-current-value-of-the-event-handler">get the current value of the event handler</dfn> given an <code id="event-handler-attributes:eventtarget-8"><a data-x-internal="eventtarget" href="https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget">EventTarget</a></code> object <var>eventTarget</var> and a string <var>name</var> that is the <a href="#event-handler-name" id="event-handler-attributes:event-handler-name-8">name</a> of an <a href="#event-handlers" id="event-handler-attributes:event-handlers-32">event handler</a>, it must run these steps:</p>

  <ol><li><p>Let <var>handlerMap</var> be <var>eventTarget</var>'s <a href="#event-handler-map" id="event-handler-attributes:event-handler-map-10">event handler map</a>.<li><p>Let <var>eventHandler</var> be <var>handlerMap</var>[<var>name</var>].<li><p>If <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-8">value</a> is an <a href="#internal-raw-uncompiled-handler" id="event-handler-attributes:internal-raw-uncompiled-handler-3">internal raw uncompiled handler</a>, then:</p>

    <ol><li><p>If <var>eventTarget</var> is an element, then let <var>element</var> be <var>eventTarget</var>, and <var>document</var> be <var>element</var>'s <a id="event-handler-attributes:node-document-4" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>. Otherwise, <var>eventTarget</var> is a <code id="event-handler-attributes:window-5"><a href="window-object.html#window">Window</a></code> object, let <var>element</var> be null, and <var>document</var> be <var>eventTarget</var>'s <a href="window-object.html#concept-document-window" id="event-handler-attributes:concept-document-window">associated <code>Document</code></a>.<li><p>If <a href="#concept-n-noscript" id="event-handler-attributes:concept-n-noscript">scripting is disabled</a> for <var>document</var>, then return null.<li><p>Let <var>body</var> be the uncompiled script body in <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-9">value</a>.<li><p>Let <var>location</var> be the location where the script body originated, as given by <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-10">value</a>.<li><p>If <var>element</var> is not null and <var>element</var> has a <a id="event-handler-attributes:form-owner" href="form-control-infrastructure.html#form-owner">form owner</a>, let <var>form owner</var> be that <a id="event-handler-attributes:form-owner-2" href="form-control-infrastructure.html#form-owner">form owner</a>. Otherwise, let <var>form owner</var> be null.<li><p>Let <var>settings object</var> be the <a href="#relevant-settings-object" id="event-handler-attributes:relevant-settings-object">relevant settings object</a> of <var>document</var>.<li><p>If <var>body</var> is not parsable as <i id="event-handler-attributes:js-prod-functionbody-2"><a data-x-internal="js-prod-functionbody" href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></i> or if parsing detects an <a id="event-handler-attributes:early-error" href="https://tc39.es/ecma262/#early-error-rule" data-x-internal="early-error">early error</a>, then follow these substeps:</p>

      <ol><li><p>Set <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-11">value</a> to null.</p>

        <p class="note">This does not <a href="#deactivate-an-event-handler" id="event-handler-attributes:deactivate-an-event-handler-6">deactivate</a> the event handler, which additionally <a href="https://triple-underscore.github.io/DOM4-ja.html#remove-an-event-listener" id="event-handler-attributes:remove-an-event-listener-2" data-x-internal="remove-an-event-listener">removes</a> the event handler's <a href="#event-handler-listener" id="event-handler-attributes:event-handler-listener-6">listener</a> (if present).</p>
       <li><p><a href="#report-the-error" id="event-handler-attributes:report-the-error">Report the error</a> for the appropriate <a href="#concept-script" id="event-handler-attributes:concept-script">script</a> and with the appropriate position (line number and column number) given by <var>location</var>, using <var>settings object</var>'s <a href="#concept-settings-object-global" id="event-handler-attributes:concept-settings-object-global">global object</a>. If the error is still <i id="event-handler-attributes:concept-error-nothandled"><a href="#concept-error-nothandled">not handled</a></i> after this, then the error may be reported to a developer console.<li><p>Return null.</ol>
     <li><p>Push <var>settings object</var>'s <a href="#realm-execution-context" id="event-handler-attributes:realm-execution-context">realm execution context</a> onto the <a id="event-handler-attributes:javascript-execution-context-stack" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>; it is now the <a id="event-handler-attributes:running-javascript-execution-context" href="https://tc39.es/ecma262/#running-execution-context" data-x-internal="running-javascript-execution-context">running JavaScript execution context</a>.</p>

      <p class="note">This is necessary so the subsequent invocation of <a href="https://tc39.es/ecma262/#sec-ordinaryfunctioncreate" id="event-handler-attributes:js-ordinaryfunctioncreate" data-x-internal="js-ordinaryfunctioncreate">OrdinaryFunctionCreate</a> takes place in the correct <a id="event-handler-attributes:javascript-realm" href="https://tc39.es/ecma262/#sec-code-realms" data-x-internal="javascript-realm">JavaScript Realm</a>.</p>
     <li><p>Let <var>function</var> be the result of calling <a href="https://tc39.es/ecma262/#sec-ordinaryfunctioncreate" id="event-handler-attributes:js-ordinaryfunctioncreate-2" data-x-internal="js-ordinaryfunctioncreate">OrdinaryFunctionCreate</a>, with arguments:</p>

      <dl><dt><var>functionPrototype</var><dd><a id="event-handler-attributes:function.prototype" href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object" data-x-internal="function.prototype">%Function.prototype%</a><dt><var>sourceText</var><dd><dl class="switch"><dt>If <var>name</var> is <code id="event-handler-attributes:handler-onerror-3"><a href="#handler-onerror">onerror</a></code> and <var>eventTarget</var> is a <code id="event-handler-attributes:window-6"><a href="window-object.html#window">Window</a></code> object<dd>The string formed by concatenating "<code>function </code>", <var>name</var>, "<code>(event, source, lineno, colno, error) {</code>", U+000A LF, <var>body</var>, U+000A LF, and "<code>}</code>".<dt>そうでなければ<dd>The string formed by concatenating "<code>function </code>", <var>name</var>, "<code>(event) {</code>", U+000A LF, <var>body</var>, U+000A LF, and "<code>}</code>".</dl>
       <dt><var>ParameterList</var><dd><dl class="switch"><dt>If <var>name</var> is <code id="event-handler-attributes:handler-onerror-4"><a href="#handler-onerror">onerror</a></code> and <var>eventTarget</var> is a <code id="event-handler-attributes:window-7"><a href="window-object.html#window">Window</a></code> object<dd>Let the function have five arguments, named <code>event</code>, <code>source</code>, <code>lineno</code>, <code>colno</code>, and <code>error</code>.<dt>そうでなければ<dd>Let the function have a single argument called <code>event</code>.</dl>
       <dt><var>Body</var><dd>The result of parsing <var>body</var> above.<dt><var>thisMode</var><dd>non-lexical-this<dt><var>Scope</var><dd><ol><li><p>Let <var>realm</var> be <var>settings object</var>'s <a href="#environment-settings-object's-realm" id="event-handler-attributes:environment-settings-object's-realm">Realm</a>.<li><p>Let <var>scope</var> be <var>realm</var>.[[GlobalEnv]].<li><p>If <var>eventHandler</var> is an element's <a href="#event-handlers" id="event-handler-attributes:event-handlers-33">event handler</a>, then set <var>scope</var> to <a href="https://tc39.es/ecma262/#sec-newobjectenvironment" id="event-handler-attributes:js-newobjectenvironment" data-x-internal="js-newobjectenvironment">NewObjectEnvironment</a>(<var>document</var>, <var>scope</var>).</p>

          <p>(Otherwise, <var>eventHandler</var> is a <code id="event-handler-attributes:window-8"><a href="window-object.html#window">Window</a></code> object's <a href="#event-handlers" id="event-handler-attributes:event-handlers-34">event handler</a>.)</p>
         <li><p>If <var>form owner</var> is not null, then set <var>scope</var> to <a href="https://tc39.es/ecma262/#sec-newobjectenvironment" id="event-handler-attributes:js-newobjectenvironment-2" data-x-internal="js-newobjectenvironment">NewObjectEnvironment</a>(<var>form owner</var>, <var>scope</var>).<li><p>If <var>element</var> is not null, then set <var>scope</var> to <a href="https://tc39.es/ecma262/#sec-newobjectenvironment" id="event-handler-attributes:js-newobjectenvironment-3" data-x-internal="js-newobjectenvironment">NewObjectEnvironment</a>(<var>element</var>, <var>scope</var>).<li><p>Return <var>scope</var>.</ol>
       </dl>
     <li><p>Remove <var>settings object</var>'s <a href="#realm-execution-context" id="event-handler-attributes:realm-execution-context-2">realm execution context</a> from the <a id="event-handler-attributes:javascript-execution-context-stack-2" href="https://tc39.es/ecma262/#execution-context-stack" data-x-internal="javascript-execution-context-stack">JavaScript execution context stack</a>.<li><p>Set <var>function</var>.[[ScriptOrModule]] to null.</p>

      <div class="note"><p>This is done because the default behavior, of associating the created function with the nearest <a href="#concept-script" id="event-handler-attributes:concept-script-2">script</a> on the stack, can lead to path-dependent results. For example, an event handler which is first invoked by user interaction would end up with null [[ScriptOrModule]] (since then this algorithm would be first invoked when the <a href="#active-script" id="event-handler-attributes:active-script">active script</a> is null), whereas one that is first invoked by dispatching an event from script would have its [[ScriptOrModule]] set to that script.</p>

       <p>Instead, we just always set [[ScriptOrModule]] to null. This is more intuitive anyway; the idea that the first script which dispatches an event is somehow responsible for the event handler code is dubious.</p>

       <p>In practice, this only affects the resolution of relative URLs via <code id="event-handler-attributes:import()"><a data-x-internal="import()" href="https://tc39.es/ecma262/#sec-import-calls">import()</a></code>, which consult the <a href="#concept-script-base-url" id="event-handler-attributes:concept-script-base-url">base URL</a> of the associated script. Nulling out [[ScriptOrModule]] means that <a href="#hostresolveimportedmodule(referencingscriptormodule,-specifier)" id="event-handler-attributes:hostresolveimportedmodule(referencingscriptormodule,-specifier)">HostResolveImportedModule</a> and <a href="#hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)" id="event-handler-attributes:hostimportmoduledynamically(referencingscriptormodule,-specifier,-promisecapability)">HostImportModuleDynamically</a> will fall back to the <a href="#current-settings-object" id="event-handler-attributes:current-settings-object">current settings object</a>'s <a href="#api-base-url" id="event-handler-attributes:api-base-url">API base URL</a>.</p>
      </div>
     <li><p>Set <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-12">value</a> to the result of creating a Web IDL <code id="event-handler-attributes:eventhandler-3"><a href="#eventhandler">EventHandler</a></code> callback function object whose object reference is <var>function</var> and whose <a id="event-handler-attributes:callback-context-2" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-callback-context" data-x-internal="callback-context">callback context</a> is <var>settings object</var>.</ol>
   <li><p>Return <var>eventHandler</var>'s <a href="#event-handler-value" id="event-handler-attributes:event-handler-value-13">value</a>.</ol>

  



  <h5 id="event-handlers-on-elements,-document-objects,-and-window-objects"><span class="secno">8.1.7.2</span> 要素のイベントハンドラー、<code id="event-handlers-on-elements,-document-objects,-and-window-objects:document"><a href="dom.html#document">Document</a></code>オブジェクト、および<code id="event-handlers-on-elements,-document-objects,-and-window-objects:window"><a href="window-object.html#window">Window</a></code>オブジェクト<a href="#event-handlers-on-elements,-document-objects,-and-window-objects" class="self-link"></a></h5>

  <p>The following are the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers">event handlers</a> (and their corresponding <a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type">event handler event types</a>) that must be supported by all <a id="event-handlers-on-elements,-document-objects,-and-window-objects:html-elements" href="infrastructure.html#html-elements">HTML elements</a>, as both <a href="#event-handler-content-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes">event handler content attributes</a> and <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes">event handler IDL attributes</a>; and that must be supported by all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:document-2"><a href="dom.html#document">Document</a></code> and <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-2"><a href="window-object.html#window">Window</a></code> objects, as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-2">event handler IDL attributes</a>:</p>

  <table><thead><tr><th><a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-2">イベントハンドラー</a><th><a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-2">イベントハンドラーイベント型</a><tbody><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onabort" data-dfn-type="attribute" data-export=""><code>onabort</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in one engine only." class="less-than-two-engines-flag">⚠</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onabort" title="The onabort property of the GlobalEventHandlers mixin is the EventHandler for processing abort events sent to the window.">GlobalEventHandlers/onabort</a><p class="less-than-two-engines-text">Support in one engine only.<div class="support"><span class="firefox unknown"><span>Firefox</span><span>?</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-abort"><a href="indices.html#event-abort">abort</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onauxclick" data-dfn-type="attribute" data-export=""><code>onauxclick</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-auxclick"><a data-x-internal="event-auxclick" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-auxclick">auxclick</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oncancel" data-dfn-type="attribute" data-export=""><code>oncancel</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in one engine only." class="less-than-two-engines-flag">⚠</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oncancel" title="The oncancel property of the GlobalEventHandlers mixin is an EventHandler for processing cancel events sent to a &lt;dialog> element.">GlobalEventHandlers/oncancel</a><p class="less-than-two-engines-text">Support in one engine only.<div class="support"><span class="firefox no"><span>Firefox</span><span>No</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-cancel"><a href="indices.html#event-cancel">cancel</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oncanplay" data-dfn-type="attribute" data-export=""><code>oncanplay</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oncanplay" title="The oncanplay property of the GlobalEventHandlers mixin is the EventHandler for processing canplay events.">GlobalEventHandlers/oncanplay</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-canplay"><a href="media.html#event-media-canplay">canplay</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oncanplaythrough" data-dfn-type="attribute" data-export=""><code>oncanplaythrough</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oncanplaythrough" title="The oncanplaythrough property of the GlobalEventHandlers mixin is the EventHandler for processing canplaythrough events.">GlobalEventHandlers/oncanplaythrough</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-canplaythrough"><a href="media.html#event-media-canplaythrough">canplaythrough</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onchange" data-dfn-type="attribute" data-export=""><code>onchange</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onchange" title="The onchange property of the GlobalEventHandlers mixin is an EventHandler for processing change events.">GlobalEventHandlers/onchange</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>9+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>9+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-change"><a href="indices.html#event-change">change</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onclick" data-dfn-type="attribute" data-export=""><code>onclick</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclick" title="The onclick property of the GlobalEventHandlers mixin is the EventHandler for processing click events on a given element.">GlobalEventHandlers/onclick</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>9+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>9+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-click"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onclose" data-dfn-type="attribute" data-export=""><code>onclose</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onclose" title="The onclose property of the GlobalEventHandlers mixin is an EventHandler for processing close events sent to a &lt;dialog> element.">GlobalEventHandlers/onclose</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-close"><a href="indices.html#event-close">close</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oncontextmenu" data-dfn-type="attribute" data-export=""><code>oncontextmenu</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oncontextmenu" title="The oncontextmenu property of the GlobalEventHandlers mixin is an EventHandler that processes contextmenu events.">GlobalEventHandlers/oncontextmenu</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-contextmenu"><a href="indices.html#event-contextmenu">contextmenu</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oncuechange" data-dfn-type="attribute" data-export=""><code>oncuechange</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oncuechange" title="The oncuechange property of the GlobalEventHandlers mixin is the EventHandler for processing cuechange events.">GlobalEventHandlers/oncuechange</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>68+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>68+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-cuechange"><a href="media.html#event-media-cuechange">cuechange</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondblclick" data-dfn-type="attribute" data-export=""><code>ondblclick</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/ondblclick" title="The ondblclick property of the GlobalEventHandlers mixin is an EventHandler that processes dblclick events on the given element.">GlobalEventHandlers/ondblclick</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dblclick"><a data-x-internal="event-dblclick" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-dblclick">dblclick</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondrag" data-dfn-type="attribute" data-export=""><code>ondrag</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-drag"><a href="dnd.html#event-dnd-drag">drag</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondragend" data-dfn-type="attribute" data-export=""><code>ondragend</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragend"><a href="dnd.html#event-dnd-dragend">dragend</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondragenter" data-dfn-type="attribute" data-export=""><code>ondragenter</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragenter"><a href="dnd.html#event-dnd-dragenter">dragenter</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondragleave" data-dfn-type="attribute" data-export=""><code>ondragleave</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragleave"><a href="dnd.html#event-dnd-dragleave">dragleave</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondragover" data-dfn-type="attribute" data-export=""><code>ondragover</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragover"><a href="dnd.html#event-dnd-dragover">dragover</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondragstart" data-dfn-type="attribute" data-export=""><code>ondragstart</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-dragstart"><a href="dnd.html#event-dnd-dragstart">dragstart</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondrop" data-dfn-type="attribute" data-export=""><code>ondrop</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-dnd-drop"><a href="dnd.html#event-dnd-drop">drop</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ondurationchange" data-dfn-type="attribute" data-export=""><code>ondurationchange</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/ondurationchange" title="The ondurationchange property of the GlobalEventHandlers mixin is the EventHandler for processing durationchange events.">GlobalEventHandlers/ondurationchange</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-durationchange"><a href="media.html#event-media-durationchange">durationchange</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onemptied" data-dfn-type="attribute" data-export=""><code>onemptied</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onemptied" title="The onemptied property sets and returns the event handler for the emptied event.">GlobalEventHandlers/onemptied</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-emptied"><a href="media.html#event-media-emptied">emptied</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onended" data-dfn-type="attribute" data-export=""><code>onended</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onended" title="The onended property of the GlobalEventHandlers mixin is the EventHandler for processing ended events.">GlobalEventHandlers/onended</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-ended"><a href="media.html#event-media-ended">ended</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onformdata" data-dfn-type="attribute" data-export=""><code>onformdata</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onformdata" title="The onformdata property of the GlobalEventHandlers mixin is the EventHandler for processing formdata events, fired after the entry list representing the form's data is constructed. This happens when the form is submitted, but can also be triggered by the invocation of a FormData() constructor. onformdata is available on HTMLFormElement.">GlobalEventHandlers/onformdata</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>72+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>77+</span></span><hr><span class="opera yes"><span>Opera</span><span>64+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>77+</span></span><span class="webview_android yes"><span>WebView Android</span><span>77+</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android yes"><span>Opera Android</span><span>55+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-formdata"><a href="indices.html#event-formdata">formdata</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oninput" data-dfn-type="attribute" data-export=""><code>oninput</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-input"><a href="indices.html#event-input">input</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-oninvalid" data-dfn-type="attribute" data-export=""><code>oninvalid</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/oninvalid" title="The oninvalid property of the GlobalEventHandlers mixin is an EventHandler that processes invalid events.">GlobalEventHandlers/oninvalid</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-invalid"><a href="indices.html#event-invalid">invalid</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onkeydown" data-dfn-type="attribute" data-export=""><code>onkeydown</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onkeydown" title="The onkeydown property of the GlobalEventHandlers mixin is an EventHandler that processes keydown events.">GlobalEventHandlers/onkeydown</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-keydown"><a data-x-internal="event-keydown" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-keydown">keydown</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onkeypress" data-dfn-type="attribute" data-export=""><code>onkeypress</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onkeypress" title="The onkeypress property of the GlobalEventHandlers mixin is an EventHandler that processes keypress events.">GlobalEventHandlers/onkeypress</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-keypress"><a data-x-internal="event-keypress" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-keypress">keypress</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onkeyup" data-dfn-type="attribute" data-export=""><code>onkeyup</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onkeyup" title="The onkeyup property of the GlobalEventHandlers mixin is an EventHandler that processes keyup events.">GlobalEventHandlers/onkeyup</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-keyup"><a data-x-internal="event-keyup" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-keyup">keyup</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onloadeddata" data-dfn-type="attribute" data-export=""><code>onloadeddata</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onloadeddata" title="The onloadeddata property of the GlobalEventHandlers mixin is the EventHandler for processing loadeddata events.">GlobalEventHandlers/onloadeddata</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadeddata"><a href="media.html#event-media-loadeddata">loadeddata</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onloadedmetadata" data-dfn-type="attribute" data-export=""><code>onloadedmetadata</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onloadedmetadata" title="The onloadedmetadata property of the GlobalEventHandlers mixin is the EventHandler for processing loadedmetadata events.">GlobalEventHandlers/onloadedmetadata</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadedmetadata"><a href="media.html#event-media-loadedmetadata">loadedmetadata</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onloadstart" data-dfn-type="attribute" data-export=""><code>onloadstart</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onloadstart" title="The onloadstart property of the GlobalEventHandlers mixin is an EventHandler representing the code to be called when the loadstart event is raised (when progress has begun on the loading of a resource.)">GlobalEventHandlers/onloadstart</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>52+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>52+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-loadstart"><a href="media.html#event-media-loadstart">loadstart</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmousedown" data-dfn-type="attribute" data-export=""><code>onmousedown</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmousedown" title="The onmousedown property of the GlobalEventHandlers mixin is an EventHandler that processes mousedown events.">GlobalEventHandlers/onmousedown</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mousedown"><a data-x-internal="event-mousedown" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mousedown">mousedown</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmouseenter" data-dfn-type="attribute" data-export=""><code>onmouseenter</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmouseenter" title="The onmouseenter property of the GlobalEventHandlers mixin is the EventHandler for processing mouseenter events.">GlobalEventHandlers/onmouseenter</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>10+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>30+</span></span><hr><span class="opera yes"><span>Opera</span><span>17+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>5.5+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>10+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>18+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseenter"><a data-x-internal="event-mouseenter" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mouseenter">mouseenter</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmouseleave" data-dfn-type="attribute" data-export=""><code>onmouseleave</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmouseleave" title="The onmouseleave property of the GlobalEventHandlers mixin is the EventHandler for processing mouseleave events.">GlobalEventHandlers/onmouseleave</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>10+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>30+</span></span><hr><span class="opera yes"><span>Opera</span><span>17+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>5.5+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>10+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>18+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseleave"><a data-x-internal="event-mouseleave" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mouseleave">mouseleave</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmousemove" data-dfn-type="attribute" data-export=""><code>onmousemove</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmousemove" title="The onmousemove property of the GlobalEventHandlers mixin is an EventHandler that processes mousemove events.">GlobalEventHandlers/onmousemove</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mousemove"><a data-x-internal="event-mousemove" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mousemove">mousemove</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmouseout" data-dfn-type="attribute" data-export=""><code>onmouseout</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmouseout" title="The onmouseout property of the GlobalEventHandlers mixin is an EventHandler that processes mouseout events.">GlobalEventHandlers/onmouseout</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseout"><a data-x-internal="event-mouseout" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mouseout">mouseout</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmouseover" data-dfn-type="attribute" data-export=""><code>onmouseover</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmouseover" title="The onmouseover property of the GlobalEventHandlers mixin is an EventHandler that processes mouseover events.">GlobalEventHandlers/onmouseover</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseover"><a data-x-internal="event-mouseover" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mouseover">mouseover</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onmouseup" data-dfn-type="attribute" data-export=""><code>onmouseup</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onmouseup" title="The onmouseup property of the GlobalEventHandlers mixin is an EventHandler that processes mouseup events.">GlobalEventHandlers/onmouseup</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-mouseup"><a data-x-internal="event-mouseup" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-mouseup">mouseup</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onpause" data-dfn-type="attribute" data-export=""><code>onpause</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onpause" title="The onpause property of the GlobalEventHandlers mixin is the EventHandler for processing pause events.">GlobalEventHandlers/onpause</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-pause"><a href="media.html#event-media-pause">pause</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onplay" data-dfn-type="attribute" data-export=""><code>onplay</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onplay" title="The onplay property of the GlobalEventHandlers mixin is the EventHandler for processing play events.">GlobalEventHandlers/onplay</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-play"><a href="media.html#event-media-play">play</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onplaying" data-dfn-type="attribute" data-export=""><code>onplaying</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-playing"><a href="media.html#event-media-playing">playing</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onprogress" data-dfn-type="attribute" data-export=""><code>onprogress</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-progress"><a href="media.html#event-media-progress">progress</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onratechange" data-dfn-type="attribute" data-export=""><code>onratechange</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-ratechange"><a href="media.html#event-media-ratechange">ratechange</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onreset" data-dfn-type="attribute" data-export=""><code>onreset</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onreset" title="The onreset property of the GlobalEventHandlers mixin is an EventHandler that processes reset events.">GlobalEventHandlers/onreset</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-reset"><a href="indices.html#event-reset">reset</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onsecuritypolicyviolation" data-dfn-type="attribute" data-export=""><code>onsecuritypolicyviolation</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-securitypolicyviolation"><a href="indices.html#event-securitypolicyviolation">securitypolicyviolation</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onseeked" data-dfn-type="attribute" data-export=""><code>onseeked</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-seeked"><a href="media.html#event-media-seeked">seeked</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onseeking" data-dfn-type="attribute" data-export=""><code>onseeking</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-seeking"><a href="media.html#event-media-seeking">seeking</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onselect" data-dfn-type="attribute" data-export=""><code>onselect</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onselect" title="The onselect property of the GlobalEventHandlers mixin is an EventHandler that processes select events.">GlobalEventHandlers/onselect</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-select"><a href="indices.html#event-select">select</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onslotchange" data-dfn-type="attribute" data-export=""><code>onslotchange</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-slotchange"><a href="indices.html#event-slotchange">slotchange</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onstalled" data-dfn-type="attribute" data-export=""><code>onstalled</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-stalled"><a href="media.html#event-media-stalled">stalled</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onsubmit" data-dfn-type="attribute" data-export=""><code>onsubmit</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onsubmit" title="The onsubmit property of the GlobalEventHandlers mixin is an EventHandler that processes submit events.">GlobalEventHandlers/onsubmit</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-submit"><a href="indices.html#event-submit">submit</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onsuspend" data-dfn-type="attribute" data-export=""><code>onsuspend</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-suspend"><a href="media.html#event-media-suspend">suspend</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ontimeupdate" data-dfn-type="attribute" data-export=""><code>ontimeupdate</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-timeupdate"><a href="media.html#event-media-timeupdate">timeupdate</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-ontoggle" data-dfn-type="attribute" data-export=""><code>ontoggle</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-toggle"><a href="indices.html#event-toggle">toggle</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onvolumechange" data-dfn-type="attribute" data-export=""><code>onvolumechange</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-volumechange"><a href="media.html#event-media-volumechange">volumechange</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwaiting" data-dfn-type="attribute" data-export=""><code>onwaiting</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-media-waiting"><a href="media.html#event-media-waiting">waiting</a></code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwebkitanimationend" data-dfn-type="attribute" data-export=""><code>onwebkitanimationend</code></dfn><td><code>webkitAnimationEnd</code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwebkitanimationiteration" data-dfn-type="attribute" data-export=""><code>onwebkitanimationiteration</code></dfn><td><code>webkitAnimationIteration</code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwebkitanimationstart" data-dfn-type="attribute" data-export=""><code>onwebkitanimationstart</code></dfn><td><code>webkitAnimationStart</code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwebkittransitionend" data-dfn-type="attribute" data-export=""><code>onwebkittransitionend</code></dfn><td><code>webkitTransitionEnd</code><tr><td><dfn data-dfn-for="HTMLElement,Document,Window,GlobalEventHandlers" id="handler-onwheel" data-dfn-type="attribute" data-export=""><code>onwheel</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onwheel" title="The onwheel property of the GlobalEventHandlers mixin is an EventHandler that processes wheel events.">GlobalEventHandlers/onwheel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>61+</span></span><hr><span class="opera yes"><span>Opera</span><span>48+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>61+</span></span><span class="webview_android yes"><span>WebView Android</span><span>61+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>45+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-wheel"><a data-x-internal="event-wheel" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-wheel">wheel</a></code></table>

  <hr>

  <p>The following are the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-3">event handlers</a> (and their corresponding <a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-3">event handler event types</a>) that must be supported by all <a id="event-handlers-on-elements,-document-objects,-and-window-objects:html-elements-2" href="infrastructure.html#html-elements">HTML elements</a> other than <code id="event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element"><a href="sections.html#the-body-element">body</a></code> and <code id="event-handlers-on-elements,-document-objects,-and-window-objects:frameset"><a href="obsolete.html#frameset">frameset</a></code> elements, as both <a href="#event-handler-content-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-2">event handler content attributes</a> and <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-3">event handler IDL attributes</a>; that must be supported by all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:document-3"><a href="dom.html#document">Document</a></code> objects, as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-4">event handler IDL attributes</a>; and that must be supported by all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-3"><a href="window-object.html#window">Window</a></code> objects, as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-5">event handler IDL attributes</a> on the <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-4"><a href="window-object.html#window">Window</a></code> objects themselves, and with corresponding <a href="#event-handler-content-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-3">event handler content attributes</a> and <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-6">event handler IDL attributes</a> exposed on all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element-2"><a href="sections.html#the-body-element">body</a></code> and <code id="event-handlers-on-elements,-document-objects,-and-window-objects:frameset-2"><a href="obsolete.html#frameset">frameset</a></code> elements that are owned by that <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-5"><a href="window-object.html#window">Window</a></code> object's <a href="window-object.html#concept-document-window" id="event-handlers-on-elements,-document-objects,-and-window-objects:concept-document-window">associated <code>Document</code></a>:</p>

  <table><thead><tr><th><a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-4">イベントハンドラー</a><th><a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-4">イベントハンドラーイベント型</a><tbody><tr><td><dfn id="handler-onblur"><code>onblur</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onblur" title="The onblur property of the GlobalEventHandlers mixin is the EventHandler for processing blur events. It's available on Element, Document, and Window.">GlobalEventHandlers/onblur</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-blur"><a href="indices.html#event-blur">blur</a></code><tr><td><dfn id="handler-onerror"><code>onerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror" title="The onerror property of the GlobalEventHandlers mixin is an EventHandler that processes error events.">GlobalEventHandlers/onerror</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>10+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>9+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/onerror" title="The onerror property of the HTMLMediaElement interface is the EventHandler for processing error events.">HTMLMediaElement/onerror</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>9+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-error"><a href="indices.html#event-error">error</a></code><tr><td><dfn id="handler-onfocus"><code>onfocus</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onfocus" title="The onfocus property of the GlobalEventHandlers mixin is an EventHandler that processes focus events on the given element.">GlobalEventHandlers/onfocus</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-focus"><a href="indices.html#event-focus">focus</a></code><tr><td><dfn id="handler-onload"><code>onload</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onload" title="The onload property of the GlobalEventHandlers mixin is an EventHandler that processes load events on a Window, XMLHttpRequest, &lt;img> element, etc.">GlobalEventHandlers/onload</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>9+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>9+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-load"><a href="indices.html#event-load">load</a></code><tr><td><dfn id="handler-onresize"><code>onresize</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onresize" title="The onresize property of the GlobalEventHandlers interface is an EventHandler that processes resize events.">GlobalEventHandlers/onresize</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>45+</span></span><hr><span class="opera yes"><span>Opera</span><span>32+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>45+</span></span><span class="webview_android yes"><span>WebView Android</span><span>45+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>32+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-resize"><a data-x-internal="event-resize" href="https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize">resize</a></code><tr><td><dfn id="handler-onscroll"><code>onscroll</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onscroll" title="The onscroll property of the GlobalEventHandlers mixin is an EventHandler that processes scroll events.">GlobalEventHandlers/onscroll</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-scroll"><a data-x-internal="event-scroll" href="https://triple-underscore.github.io/cssom-view-ja.html#eventdef-document-scroll">scroll</a></code></table>

  <p>We call the <a id="event-handlers-on-elements,-document-objects,-and-window-objects:set" href="https://triple-underscore.github.io/infra-ja.html#ordered-set" data-x-internal="set">set</a> of the <a href="#event-handler-name" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-name">names</a> of the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-5">event handlers</a> listed in the first column of this table the <dfn id="window-reflecting-body-element-event-handler-set"><code>Window</code>-reflecting body element event handler set</dfn>.</p>

  <hr>

  <p>The following are the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-6">event handlers</a> (and their corresponding <a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-5">event handler event types</a>) that must be supported by <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-6"><a href="window-object.html#window">Window</a></code> objects, as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-7">event handler IDL attributes</a> on the <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-7"><a href="window-object.html#window">Window</a></code> objects themselves, and with corresponding <a href="#event-handler-content-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-4">event handler content attributes</a> and <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-8">event handler IDL attributes</a> exposed on all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:the-body-element-3"><a href="sections.html#the-body-element">body</a></code> and <code id="event-handlers-on-elements,-document-objects,-and-window-objects:frameset-3"><a href="obsolete.html#frameset">frameset</a></code> elements that are owned by that <code id="event-handlers-on-elements,-document-objects,-and-window-objects:window-8"><a href="window-object.html#window">Window</a></code> object's <a href="window-object.html#concept-document-window" id="event-handlers-on-elements,-document-objects,-and-window-objects:concept-document-window-2">associated <code>Document</code></a>:</p>

  <table><thead><tr><th><a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-7">イベントハンドラー</a><th><a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-6">イベントハンドラーイベント型</a><tbody><tr><td><dfn id="handler-window-onafterprint"><code>onafterprint</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onafterprint" title="The onafterprint property of the WindowEventHandlers mixin is the EventHandler for processing afterprint events for the current window. These events are raised after the user prints, or if they abort the print dialog.">WindowEventHandlers/onafterprint</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>13+</span></span><span class="chrome yes"><span>Chrome</span><span>63+</span></span><hr><span class="opera yes"><span>Opera</span><span>50+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>13+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>63+</span></span><span class="webview_android yes"><span>WebView Android</span><span>63+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>46+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-afterprint"><a href="indices.html#event-afterprint">afterprint</a></code><tr><td><dfn id="handler-window-onbeforeprint"><code>onbeforeprint</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeprint" title="The onbeforeprint property of the WindowEventHandlers mixin is the EventHandler for processing beforeprint events for the current window. These events are raised before the print dialog window is opened.">WindowEventHandlers/onbeforeprint</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>6+</span></span><span class="safari yes"><span>Safari</span><span>13+</span></span><span class="chrome yes"><span>Chrome</span><span>63+</span></span><hr><span class="opera yes"><span>Opera</span><span>50+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>13+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>63+</span></span><span class="webview_android yes"><span>WebView Android</span><span>63+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>46+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-beforeprint"><a href="indices.html#event-beforeprint">beforeprint</a></code><tr><td><dfn id="handler-window-onbeforeunload"><code>onbeforeunload</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onbeforeunload" title="The onbeforeunload property of the WindowEventHandlers mixin is the EventHandler for processing beforeunload events. These events fire when a window is about to unload its resources. At this point, the document is still visible and the event is still cancelable.">WindowEventHandlers/onbeforeunload</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>12+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>4+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-beforeunload"><a href="indices.html#event-beforeunload">beforeunload</a></code><tr><td><dfn id="handler-window-onhashchange"><code>onhashchange</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onhashchange" title="The WindowEventHandlers.onhashchange property of the WindowEventHandlers mixin is the EventHandler for processing hashchange events.">WindowEventHandlers/onhashchange</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.6+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>5+</span></span><hr><span class="opera yes"><span>Opera</span><span>10+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>8+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-hashchange"><a href="indices.html#event-hashchange">hashchange</a></code><tr><td><dfn id="handler-window-onlanguagechange"><code>onlanguagechange</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onlanguagechange" title="The onlanguagechange property of the WindowEventHandlers mixin is the EventHandler for processing languagechange events.">WindowEventHandlers/onlanguagechange</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>32+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>37+</span></span><hr><span class="opera yes"><span>Opera</span><span>24+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>37+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>4.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>24+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-languagechange"><a href="indices.html#event-languagechange">languagechange</a></code><tr><td><dfn id="handler-window-onmessage"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in one engine only." class="less-than-two-engines-flag">⚠</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onmessage" title="The onmessage property of the WindowEventHandlers mixin is the EventHandler called whenever an object receives a message event.">WindowEventHandlers/onmessage</a><p class="less-than-two-engines-text">Support in one engine only.<div class="support"><span class="firefox unknown"><span>Firefox</span><span>?</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera yes"><span>Opera</span><span>47+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>60+</span></span><span class="webview_android yes"><span>WebView Android</span><span>60+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>44+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-message"><a href="indices.html#event-message">message</a></code><tr><td><dfn id="handler-window-onmessageerror"><code>onmessageerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onmessageerror" title="The onmessageerror event handler of the WindowEventHandlers interface is an EventListener, called whenever an MessageEvent of type messageerror is fired on a window—that is, when it receives a message that cannot be deserialized.">WindowEventHandlers/onmessageerror</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera yes"><span>Opera</span><span>47+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>57+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>60+</span></span><span class="webview_android yes"><span>WebView Android</span><span>60+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>8.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>44+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code><tr><td><dfn id="handler-window-onoffline"><code>onoffline</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-offline"><a href="indices.html#event-offline">offline</a></code><tr><td><dfn id="handler-window-ononline"><code>ononline</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-online"><a href="indices.html#event-online">online</a></code><tr><td><dfn id="handler-window-onpagehide"><code>onpagehide</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-pagehide"><a href="indices.html#event-pagehide">pagehide</a></code><tr><td><dfn id="handler-window-onpageshow"><code>onpageshow</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-pageshow"><a href="indices.html#event-pageshow">pageshow</a></code><tr><td><dfn id="handler-window-onpopstate"><code>onpopstate</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onpopstate" title="The onpopstate property of the WindowEventHandlers mixin is the EventHandler for processing popstate events on the window.">WindowEventHandlers/onpopstate</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>4+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>5+</span></span><hr><span class="opera yes"><span>Opera</span><span>11.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5.1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-popstate"><a href="indices.html#event-popstate">popstate</a></code><tr><td><dfn id="handler-window-onrejectionhandled"><code>onrejectionhandled</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onrejectionhandled" title="The onrejectionhandled property of the WindowEventHandlers mixin is the EventHandler for processing rejectionhandled events. These events are raised when Promises are rejected.">WindowEventHandlers/onrejectionhandled</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-rejectionhandled"><a href="indices.html#event-rejectionhandled">rejectionhandled</a></code><tr><td><dfn id="handler-window-onstorage"><code>onstorage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onstorage" title="The onstorage property of the WindowEventHandlers mixin is an EventHandler for processing storage events.">WindowEventHandlers/onstorage</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>45+</span></span><span class="safari unknown"><span>Safari</span><span>?</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie unknown"><span>Internet Explorer</span><span>?</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>45+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-storage"><a href="indices.html#event-storage">storage</a></code><tr><td><dfn id="handler-window-onunhandledrejection"><code>onunhandledrejection</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunhandledrejection" title="The onunhandledrejection property of the WindowEventHandlers mixin is the EventHandler for processing unhandledrejection events. These events are raised for unhandled Promise rejections.">WindowEventHandlers/onunhandledrejection</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>69+</span></span><span class="safari yes"><span>Safari</span><span>11+</span></span><span class="chrome yes"><span>Chrome</span><span>49+</span></span><hr><span class="opera yes"><span>Opera</span><span>36+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span title="Requires setting a user preference or runtime flag.">🔰 68+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>11.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>49+</span></span><span class="webview_android yes"><span>WebView Android</span><span>49+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>5.0+</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-unhandledrejection"><a href="indices.html#event-unhandledrejection">unhandledrejection</a></code><tr><td><dfn id="handler-window-onunload"><code>onunload</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onunload" title="The onunload property of the WindowEventHandlers mixin is the EventHandler for processing unload events. These events fire when the window is unloading its content and resources. The resource removal is processed after the unload event occurs.">WindowEventHandlers/onunload</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-unload"><a href="indices.html#event-unload">unload</a></code></table>

  <p>This list of <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-8">event handlers</a> is reified as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-9">event handler IDL attributes</a> through the <code id="event-handlers-on-elements,-document-objects,-and-window-objects:windoweventhandlers"><a href="#windoweventhandlers">WindowEventHandlers</a></code> interface mixin.</p>

  <hr>

  <p>The following are the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-9">event handlers</a> (and their corresponding <a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-7">event handler event types</a>) that must be supported by all <a id="event-handlers-on-elements,-document-objects,-and-window-objects:html-elements-3" href="infrastructure.html#html-elements">HTML elements</a>, as both <a href="#event-handler-content-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-content-attributes-5">event handler content attributes</a> and <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-10">event handler IDL attributes</a>; and that must be supported by all <code id="event-handlers-on-elements,-document-objects,-and-window-objects:document-4"><a href="dom.html#document">Document</a></code> objects, as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-11">event handler IDL attributes</a>:</p>

  <table><thead><tr><th><a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-10">イベントハンドラー</a><th><a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-8">イベントハンドラーイベント型</a><tbody><tr><td><dfn id="handler-oncut"><code>oncut</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-cut"><a href="indices.html#event-cut">cut</a></code><tr><td><dfn id="handler-oncopy"><code>oncopy</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-copy"><a href="indices.html#event-copy">copy</a></code><tr><td><dfn id="handler-onpaste"><code>onpaste</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-paste"><a href="indices.html#event-paste">paste</a></code></table>

  <p>This list of <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-11">event handlers</a> is reified as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-12">event handler IDL attributes</a> through the <code id="event-handlers-on-elements,-document-objects,-and-window-objects:documentandelementeventhandlers"><a href="#documentandelementeventhandlers">DocumentAndElementEventHandlers</a></code> interface mixin.</p>

  <hr>

  <p>The following are the <a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-12">event handlers</a> (and their corresponding <a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-9">event handler event types</a>) that must be supported on <code id="event-handlers-on-elements,-document-objects,-and-window-objects:document-5"><a href="dom.html#document">Document</a></code> objects as <a href="#event-handler-idl-attributes" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-idl-attributes-13">event handler IDL attributes</a>:</p>

  

  <table><thead><tr><th><a href="#event-handlers" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handlers-13">イベントハンドラー</a><th><a href=">" id="event-handlers-on-elements,-document-objects,-and-window-objects:event-handler-event-type-10">イベントハンドラーイベント型</a><tbody><tr><td><dfn data-dfn-for="Document" id="handler-onreadystatechange" data-dfn-type="attribute" data-export=""><code>onreadystatechange</code></dfn><td><code id="event-handlers-on-elements,-document-objects,-and-window-objects:event-readystatechange"><a href="indices.html#event-readystatechange">readystatechange</a></code></table>


  

  <h6 id="idl-definitions"><span class="secno">8.1.7.2.1</span> IDL definitions<a href="#idl-definitions" class="self-link"></a></h6>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers" title="The GlobalEventHandlers mixin describes the event handlers common to several interfaces like HTMLElement, Document, or Window.">GlobalEventHandlers</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers" title="The WindowEventHandlers mixin describes the event handlers common to several interfaces like Window, or HTMLBodyElement and HTMLFrameSetElement. Each of these interfaces can implement additional specific event handlers.">WindowEventHandlers</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>Yes</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>Yes</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>Yes</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>Yes</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>Yes</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>Yes</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div><pre><code class='idl'><c- b>interface</c-> <c- b>mixin</c-> <dfn id='globaleventhandlers'><c- g>GlobalEventHandlers</c-></dfn> {
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-onabort' id='idl-definitions:handler-onabort'><c- g>onabort</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-2'><c- n>EventHandler</c-></a> <a href='#handler-onauxclick' id='idl-definitions:handler-onauxclick'><c- g>onauxclick</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-3'><c- n>EventHandler</c-></a> <a href='#handler-onblur' id='idl-definitions:handler-onblur'><c- g>onblur</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-4'><c- n>EventHandler</c-></a> <a href='#handler-oncancel' id='idl-definitions:handler-oncancel'><c- g>oncancel</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-5'><c- n>EventHandler</c-></a> <a href='#handler-oncanplay' id='idl-definitions:handler-oncanplay'><c- g>oncanplay</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-6'><c- n>EventHandler</c-></a> <a href='#handler-oncanplaythrough' id='idl-definitions:handler-oncanplaythrough'><c- g>oncanplaythrough</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-7'><c- n>EventHandler</c-></a> <a href='#handler-onchange' id='idl-definitions:handler-onchange'><c- g>onchange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-8'><c- n>EventHandler</c-></a> <a href='#handler-onclick' id='idl-definitions:handler-onclick'><c- g>onclick</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-9'><c- n>EventHandler</c-></a> <a href='#handler-onclose' id='idl-definitions:handler-onclose'><c- g>onclose</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-10'><c- n>EventHandler</c-></a> <a href='#handler-oncontextmenu' id='idl-definitions:handler-oncontextmenu'><c- g>oncontextmenu</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-11'><c- n>EventHandler</c-></a> <a href='#handler-oncuechange' id='idl-definitions:handler-oncuechange'><c- g>oncuechange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-12'><c- n>EventHandler</c-></a> <a href='#handler-ondblclick' id='idl-definitions:handler-ondblclick'><c- g>ondblclick</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-13'><c- n>EventHandler</c-></a> <a href='#handler-ondrag' id='idl-definitions:handler-ondrag'><c- g>ondrag</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-14'><c- n>EventHandler</c-></a> <a href='#handler-ondragend' id='idl-definitions:handler-ondragend'><c- g>ondragend</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-15'><c- n>EventHandler</c-></a> <a href='#handler-ondragenter' id='idl-definitions:handler-ondragenter'><c- g>ondragenter</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-16'><c- n>EventHandler</c-></a> <a href='#handler-ondragleave' id='idl-definitions:handler-ondragleave'><c- g>ondragleave</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-17'><c- n>EventHandler</c-></a> <a href='#handler-ondragover' id='idl-definitions:handler-ondragover'><c- g>ondragover</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-18'><c- n>EventHandler</c-></a> <a href='#handler-ondragstart' id='idl-definitions:handler-ondragstart'><c- g>ondragstart</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-19'><c- n>EventHandler</c-></a> <a href='#handler-ondrop' id='idl-definitions:handler-ondrop'><c- g>ondrop</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-20'><c- n>EventHandler</c-></a> <a href='#handler-ondurationchange' id='idl-definitions:handler-ondurationchange'><c- g>ondurationchange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-21'><c- n>EventHandler</c-></a> <a href='#handler-onemptied' id='idl-definitions:handler-onemptied'><c- g>onemptied</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-22'><c- n>EventHandler</c-></a> <a href='#handler-onended' id='idl-definitions:handler-onended'><c- g>onended</c-></a>;
  <c- b>attribute</c-> <a href='#onerroreventhandler' id='idl-definitions:onerroreventhandler'><c- n>OnErrorEventHandler</c-></a> <a href='#handler-onerror' id='idl-definitions:handler-onerror'><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-23'><c- n>EventHandler</c-></a> <a href='#handler-onfocus' id='idl-definitions:handler-onfocus'><c- g>onfocus</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-24'><c- n>EventHandler</c-></a> <a href='#handler-onformdata' id='idl-definitions:handler-onformdata'><c- g>onformdata</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-25'><c- n>EventHandler</c-></a> <a href='#handler-oninput' id='idl-definitions:handler-oninput'><c- g>oninput</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-26'><c- n>EventHandler</c-></a> <a href='#handler-oninvalid' id='idl-definitions:handler-oninvalid'><c- g>oninvalid</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-27'><c- n>EventHandler</c-></a> <a href='#handler-onkeydown' id='idl-definitions:handler-onkeydown'><c- g>onkeydown</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-28'><c- n>EventHandler</c-></a> <a href='#handler-onkeypress' id='idl-definitions:handler-onkeypress'><c- g>onkeypress</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-29'><c- n>EventHandler</c-></a> <a href='#handler-onkeyup' id='idl-definitions:handler-onkeyup'><c- g>onkeyup</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-30'><c- n>EventHandler</c-></a> <a href='#handler-onload' id='idl-definitions:handler-onload'><c- g>onload</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-31'><c- n>EventHandler</c-></a> <a href='#handler-onloadeddata' id='idl-definitions:handler-onloadeddata'><c- g>onloadeddata</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-32'><c- n>EventHandler</c-></a> <a href='#handler-onloadedmetadata' id='idl-definitions:handler-onloadedmetadata'><c- g>onloadedmetadata</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-33'><c- n>EventHandler</c-></a> <a href='#handler-onloadstart' id='idl-definitions:handler-onloadstart'><c- g>onloadstart</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-34'><c- n>EventHandler</c-></a> <a href='#handler-onmousedown' id='idl-definitions:handler-onmousedown'><c- g>onmousedown</c-></a>;
  [<a id='idl-definitions:legacylenientthis' href='https://triple-underscore.github.io/WebIDL-ja.html#LegacyLenientThis' data-x-internal='legacylenientthis'><c- g>LegacyLenientThis</c-></a>] <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-35'><c- n>EventHandler</c-></a> <a href='#handler-onmouseenter' id='idl-definitions:handler-onmouseenter'><c- g>onmouseenter</c-></a>;
  [<a id='idl-definitions:legacylenientthis-2' href='https://triple-underscore.github.io/WebIDL-ja.html#LegacyLenientThis' data-x-internal='legacylenientthis'><c- g>LegacyLenientThis</c-></a>] <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-36'><c- n>EventHandler</c-></a> <a href='#handler-onmouseleave' id='idl-definitions:handler-onmouseleave'><c- g>onmouseleave</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-37'><c- n>EventHandler</c-></a> <a href='#handler-onmousemove' id='idl-definitions:handler-onmousemove'><c- g>onmousemove</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-38'><c- n>EventHandler</c-></a> <a href='#handler-onmouseout' id='idl-definitions:handler-onmouseout'><c- g>onmouseout</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-39'><c- n>EventHandler</c-></a> <a href='#handler-onmouseover' id='idl-definitions:handler-onmouseover'><c- g>onmouseover</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-40'><c- n>EventHandler</c-></a> <a href='#handler-onmouseup' id='idl-definitions:handler-onmouseup'><c- g>onmouseup</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-41'><c- n>EventHandler</c-></a> <a href='#handler-onpause' id='idl-definitions:handler-onpause'><c- g>onpause</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-42'><c- n>EventHandler</c-></a> <a href='#handler-onplay' id='idl-definitions:handler-onplay'><c- g>onplay</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-43'><c- n>EventHandler</c-></a> <a href='#handler-onplaying' id='idl-definitions:handler-onplaying'><c- g>onplaying</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-44'><c- n>EventHandler</c-></a> <a href='#handler-onprogress' id='idl-definitions:handler-onprogress'><c- g>onprogress</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-45'><c- n>EventHandler</c-></a> <a href='#handler-onratechange' id='idl-definitions:handler-onratechange'><c- g>onratechange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-46'><c- n>EventHandler</c-></a> <a href='#handler-onreset' id='idl-definitions:handler-onreset'><c- g>onreset</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-47'><c- n>EventHandler</c-></a> <a href='#handler-onresize' id='idl-definitions:handler-onresize'><c- g>onresize</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-48'><c- n>EventHandler</c-></a> <a href='#handler-onscroll' id='idl-definitions:handler-onscroll'><c- g>onscroll</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-49'><c- n>EventHandler</c-></a> <a href='#handler-onsecuritypolicyviolation' id='idl-definitions:handler-onsecuritypolicyviolation'><c- g>onsecuritypolicyviolation</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-50'><c- n>EventHandler</c-></a> <a href='#handler-onseeked' id='idl-definitions:handler-onseeked'><c- g>onseeked</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-51'><c- n>EventHandler</c-></a> <a href='#handler-onseeking' id='idl-definitions:handler-onseeking'><c- g>onseeking</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-52'><c- n>EventHandler</c-></a> <a href='#handler-onselect' id='idl-definitions:handler-onselect'><c- g>onselect</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-53'><c- n>EventHandler</c-></a> <a href='#handler-onslotchange' id='idl-definitions:handler-onslotchange'><c- g>onslotchange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-54'><c- n>EventHandler</c-></a> <a href='#handler-onstalled' id='idl-definitions:handler-onstalled'><c- g>onstalled</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-55'><c- n>EventHandler</c-></a> <a href='#handler-onsubmit' id='idl-definitions:handler-onsubmit'><c- g>onsubmit</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-56'><c- n>EventHandler</c-></a> <a href='#handler-onsuspend' id='idl-definitions:handler-onsuspend'><c- g>onsuspend</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-57'><c- n>EventHandler</c-></a> <a href='#handler-ontimeupdate' id='idl-definitions:handler-ontimeupdate'><c- g>ontimeupdate</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-58'><c- n>EventHandler</c-></a> <a href='#handler-ontoggle' id='idl-definitions:handler-ontoggle'><c- g>ontoggle</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-59'><c- n>EventHandler</c-></a> <a href='#handler-onvolumechange' id='idl-definitions:handler-onvolumechange'><c- g>onvolumechange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-60'><c- n>EventHandler</c-></a> <a href='#handler-onwaiting' id='idl-definitions:handler-onwaiting'><c- g>onwaiting</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-61'><c- n>EventHandler</c-></a> <a href='#handler-onwebkitanimationend' id='idl-definitions:handler-onwebkitanimationend'><c- g>onwebkitanimationend</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-62'><c- n>EventHandler</c-></a> <a href='#handler-onwebkitanimationiteration' id='idl-definitions:handler-onwebkitanimationiteration'><c- g>onwebkitanimationiteration</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-63'><c- n>EventHandler</c-></a> <a href='#handler-onwebkitanimationstart' id='idl-definitions:handler-onwebkitanimationstart'><c- g>onwebkitanimationstart</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-64'><c- n>EventHandler</c-></a> <a href='#handler-onwebkittransitionend' id='idl-definitions:handler-onwebkittransitionend'><c- g>onwebkittransitionend</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-65'><c- n>EventHandler</c-></a> <a href='#handler-onwheel' id='idl-definitions:handler-onwheel'><c- g>onwheel</c-></a>;
};

<c- b>interface</c-> <c- b>mixin</c-> <dfn id='windoweventhandlers'><c- g>WindowEventHandlers</c-></dfn> {
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-66'><c- n>EventHandler</c-></a> <a href='#handler-window-onafterprint' id='idl-definitions:handler-window-onafterprint'><c- g>onafterprint</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-67'><c- n>EventHandler</c-></a> <a href='#handler-window-onbeforeprint' id='idl-definitions:handler-window-onbeforeprint'><c- g>onbeforeprint</c-></a>;
  <c- b>attribute</c-> <a href='#onbeforeunloadeventhandler' id='idl-definitions:onbeforeunloadeventhandler'><c- n>OnBeforeUnloadEventHandler</c-></a> <a href='#handler-window-onbeforeunload' id='idl-definitions:handler-window-onbeforeunload'><c- g>onbeforeunload</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-68'><c- n>EventHandler</c-></a> <a href='#handler-window-onhashchange' id='idl-definitions:handler-window-onhashchange'><c- g>onhashchange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-69'><c- n>EventHandler</c-></a> <a href='#handler-window-onlanguagechange' id='idl-definitions:handler-window-onlanguagechange'><c- g>onlanguagechange</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-70'><c- n>EventHandler</c-></a> <a href='#handler-window-onmessage' id='idl-definitions:handler-window-onmessage'><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-71'><c- n>EventHandler</c-></a> <a href='#handler-window-onmessageerror' id='idl-definitions:handler-window-onmessageerror'><c- g>onmessageerror</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-72'><c- n>EventHandler</c-></a> <a href='#handler-window-onoffline' id='idl-definitions:handler-window-onoffline'><c- g>onoffline</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-73'><c- n>EventHandler</c-></a> <a href='#handler-window-ononline' id='idl-definitions:handler-window-ononline'><c- g>ononline</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-74'><c- n>EventHandler</c-></a> <a href='#handler-window-onpagehide' id='idl-definitions:handler-window-onpagehide'><c- g>onpagehide</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-75'><c- n>EventHandler</c-></a> <a href='#handler-window-onpageshow' id='idl-definitions:handler-window-onpageshow'><c- g>onpageshow</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-76'><c- n>EventHandler</c-></a> <a href='#handler-window-onpopstate' id='idl-definitions:handler-window-onpopstate'><c- g>onpopstate</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-77'><c- n>EventHandler</c-></a> <a href='#handler-window-onrejectionhandled' id='idl-definitions:handler-window-onrejectionhandled'><c- g>onrejectionhandled</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-78'><c- n>EventHandler</c-></a> <a href='#handler-window-onstorage' id='idl-definitions:handler-window-onstorage'><c- g>onstorage</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-79'><c- n>EventHandler</c-></a> <a href='#handler-window-onunhandledrejection' id='idl-definitions:handler-window-onunhandledrejection'><c- g>onunhandledrejection</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-80'><c- n>EventHandler</c-></a> <a href='#handler-window-onunload' id='idl-definitions:handler-window-onunload'><c- g>onunload</c-></a>;
};

<c- b>interface</c-> <c- b>mixin</c-> <dfn id='documentandelementeventhandlers'><c- g>DocumentAndElementEventHandlers</c-></dfn> {
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-81'><c- n>EventHandler</c-></a> <a href='#handler-oncopy' id='idl-definitions:handler-oncopy'><c- g>oncopy</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-82'><c- n>EventHandler</c-></a> <a href='#handler-oncut' id='idl-definitions:handler-oncut'><c- g>oncut</c-></a>;
  <c- b>attribute</c-> <a href='#eventhandler' id='idl-definitions:eventhandler-83'><c- n>EventHandler</c-></a> <a href='#handler-onpaste' id='idl-definitions:handler-onpaste'><c- g>onpaste</c-></a>;
};</code></pre>

  <h5 id="event-firing"><span class="secno">8.1.7.3</span> Event firing<a href="#event-firing" class="self-link"></a></h5>

  <p>Certain operations and methods are defined as firing events on elements. For example, the <code id="event-firing:dom-click"><a href="interaction.html#dom-click">click()</a></code> method on the <code id="event-firing:htmlelement"><a href="dom.html#htmlelement">HTMLElement</a></code> interface is defined as firing a <code id="event-firing:event-click"><a data-x-internal="event-click" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#event-type-click">click</a></code> event on the element. <a href="references.html#refsUIEVENTS">[UIEVENTS]</a></p>

  <p><dfn id="fire-a-synthetic-mouse-event">Firing a synthetic mouse event named <var>e</var></dfn> at <var>target</var>, with an optional <var>not trusted flag</var>, means running these steps:</p>

  <ol><li><p>Let <var>event</var> be the result of <a id="event-firing:creating-an-event" href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-create" data-x-internal="creating-an-event">creating an event</a> using <code id="event-firing:mouseevent"><a data-x-internal="mouseevent" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#mouseevent">MouseEvent</a></code>.<li><p>Initialize <var>event</var>'s <code id="event-firing:dom-event-type"><a data-x-internal="dom-event-type" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-type">type</a></code> attribute to <var>e</var>.<li><p>Initialize <var>event</var>'s <code id="event-firing:dom-event-bubbles"><a data-x-internal="dom-event-bubbles" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-bubbles">bubbles</a></code> and <code id="event-firing:dom-event-cancelable"><a data-x-internal="dom-event-cancelable" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-cancelable">cancelable</a></code> attributes to true.<li><p>Set <var>event</var>'s <a id="event-firing:composed-flag" href="https://triple-underscore.github.io/DOM4-ja.html#composed-flag" data-x-internal="composed-flag">composed flag</a>.<li><p>If the <var>not trusted flag</var> is set, initialize <var>event</var>'s <code id="event-firing:dom-event-istrusted"><a data-x-internal="dom-event-istrusted" href="https://triple-underscore.github.io/DOM4-ja.html#dom-event-istrusted">isTrusted</a></code> attribute to false.<li><p>Initialize <var>event</var>'s <code>ctrlKey</code>, <code>shiftKey</code>, <code>altKey</code>, and <code>metaKey</code> attributes according to the current state of the key input device, if any (false for any keys that are not available).<li><p>Initialize <var>event</var>'s <code id="event-firing:dom-uievent-view"><a data-x-internal="dom-uievent-view" href="https://triple-underscore.github.io/uievents-ja.htmluievents-ja.html#dom-uievent-view">view</a></code> attribute to <var>target</var>'s <a id="event-firing:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">node document</a>'s <code id="event-firing:window"><a href="window-object.html#window">Window</a></code> object, if any, and null otherwise.<li><p><var>event</var>'s <code>getModifierState()</code> method is to return values appropriately describing the current state of the key input device.<li><p>Return the result of <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-dispatch" id="event-firing:concept-event-dispatch" data-x-internal="concept-event-dispatch">dispatching</a> <var>event</var> at <var>target</var>.</ol>

  <p><dfn id="fire-a-click-event">Firing a <code>click</code> event</dfn> at <var>target</var> means <a href="#fire-a-synthetic-mouse-event" id="event-firing:fire-a-synthetic-mouse-event">firing a synthetic mouse event named <code>click</code></a> at <var>target</var>.</p>

  


  <h3 id="windoworworkerglobalscope-mixin"><span class="secno">8.2</span> <code id="windoworworkerglobalscope-mixin:windoworworkerglobalscope"><a href="#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code>ミックスイン<a href="#windoworworkerglobalscope-mixin" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope" title="The WindowOrWorkerGlobalScope mixin describes several features common to the Window and WorkerGlobalScope interfaces.">WindowOrWorkerGlobalScope</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>Yes</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>Yes</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>Yes</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>Yes</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>Yes</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>Yes</span></span></div></div></div>

  <p>The <code id="windoworworkerglobalscope-mixin:windoworworkerglobalscope-2"><a href="#windoworworkerglobalscope">WindowOrWorkerGlobalScope</a></code> mixin is for use of APIs that are to be exposed on <code id="windoworworkerglobalscope-mixin:window"><a href="window-object.html#window">Window</a></code> and <code id="windoworworkerglobalscope-mixin:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> objects.</p>

  <p class="note">Other standards are encouraged to further extend it using <code>partial interface mixin <a href="#windoworworkerglobalscope" id="windoworworkerglobalscope-mixin:windoworworkerglobalscope-3">WindowOrWorkerGlobalScope</a> { … };</code> along with an appropriate reference.</p>

  <pre><code class='idl'><c- b>typedef</c-> (<c- b>DOMString</c-> <c- b>or</c-> <a href='https://triple-underscore.github.io/WebIDL-ja.html#common-Function' id='windoworworkerglobalscope-mixin:idl-function' data-x-internal='idl-function'><c- n>Function</c-></a>) <dfn id='timerhandler'><c- g>TimerHandler</c-></dfn>;

<c- b>interface</c-> <c- b>mixin</c-> <dfn id='windoworworkerglobalscope'><c- g>WindowOrWorkerGlobalScope</c-></dfn> {
  [<c- g>Replaceable</c->] <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-origin' id='windoworworkerglobalscope-mixin:dom-origin'><c- g>origin</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-issecurecontext' id='windoworworkerglobalscope-mixin:dom-issecurecontext'><c- g>isSecureContext</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-crossoriginisolated' id='windoworworkerglobalscope-mixin:dom-crossoriginisolated'><c- g>crossOriginIsolated</c-></a>;

  // base64 utility methods
  <c- b>DOMString</c-> <a href='#dom-btoa' id='windoworworkerglobalscope-mixin:dom-btoa'><c- g>btoa</c-></a>(<c- b>DOMString</c-> <c- g>data</c->);
  <c- b>ByteString</c-> <a href='#dom-atob' id='windoworworkerglobalscope-mixin:dom-atob'><c- g>atob</c-></a>(<c- b>DOMString</c-> <c- g>data</c->);

  // timers
  <c- b>long</c-> <a href='timers-and-user-prompts.html#dom-settimeout' id='windoworworkerglobalscope-mixin:dom-settimeout'><c- g>setTimeout</c-></a>(<a href='#timerhandler' id='windoworworkerglobalscope-mixin:timerhandler'><c- n>TimerHandler</c-></a> <c- g>handler</c->, <c- b>optional</c-> <c- b>long</c-> <c- g>timeout</c-> = 0, <c- b>any</c->... <c- g>arguments</c->);
  <c- n>undefined</c-> <a href='timers-and-user-prompts.html#dom-cleartimeout' id='windoworworkerglobalscope-mixin:dom-cleartimeout'><c- g>clearTimeout</c-></a>(<c- b>optional</c-> <c- b>long</c-> <c- g>handle</c-> = 0);
  <c- b>long</c-> <a href='timers-and-user-prompts.html#dom-setinterval' id='windoworworkerglobalscope-mixin:dom-setinterval'><c- g>setInterval</c-></a>(<a href='#timerhandler' id='windoworworkerglobalscope-mixin:timerhandler-2'><c- n>TimerHandler</c-></a> <c- g>handler</c->, <c- b>optional</c-> <c- b>long</c-> <c- g>timeout</c-> = 0, <c- b>any</c->... <c- g>arguments</c->);
  <c- n>undefined</c-> <a href='timers-and-user-prompts.html#dom-clearinterval' id='windoworworkerglobalscope-mixin:dom-clearinterval'><c- g>clearInterval</c-></a>(<c- b>optional</c-> <c- b>long</c-> <c- g>handle</c-> = 0);

  // microtask queuing
  <c- n>undefined</c-> <a href='timers-and-user-prompts.html#dom-queuemicrotask' id='windoworworkerglobalscope-mixin:dom-queuemicrotask'><c- g>queueMicrotask</c-></a>(<a href='https://triple-underscore.github.io/WebIDL-ja.html#VoidFunction' id='windoworworkerglobalscope-mixin:idl-voidfunction' data-x-internal='idl-voidfunction'><c- n>VoidFunction</c-></a> <var><c- g>callback</c-></var>);

  // ImageBitmap
  <c- b>Promise</c->&lt;<a id='windoworworkerglobalscope-mixin:imagebitmap' href='imagebitmap-and-animations.html#imagebitmap'><c- n>ImageBitmap</c-></a>> <a href='imagebitmap-and-animations.html#dom-createimagebitmap' id='windoworworkerglobalscope-mixin:dom-createimagebitmap'><c- g>createImageBitmap</c-></a>(<a id='windoworworkerglobalscope-mixin:imagebitmapsource' href='imagebitmap-and-animations.html#imagebitmapsource'><c- n>ImageBitmapSource</c-></a> <c- g>image</c->, <c- b>optional</c-> <a id='windoworworkerglobalscope-mixin:imagebitmapoptions' href='imagebitmap-and-animations.html#imagebitmapoptions'><c- n>ImageBitmapOptions</c-></a> <c- g>options</c-> = {});
  <c- b>Promise</c->&lt;<a id='windoworworkerglobalscope-mixin:imagebitmap-2' href='imagebitmap-and-animations.html#imagebitmap'><c- n>ImageBitmap</c-></a>> <a href='imagebitmap-and-animations.html#dom-createimagebitmap' id='windoworworkerglobalscope-mixin:dom-createimagebitmap-2'><c- g>createImageBitmap</c-></a>(<a id='windoworworkerglobalscope-mixin:imagebitmapsource-2' href='imagebitmap-and-animations.html#imagebitmapsource'><c- n>ImageBitmapSource</c-></a> <c- g>image</c->, <c- b>long</c-> <c- g>sx</c->, <c- b>long</c-> <c- g>sy</c->, <c- b>long</c-> <c- g>sw</c->, <c- b>long</c-> <c- g>sh</c->, <c- b>optional</c-> <a id='windoworworkerglobalscope-mixin:imagebitmapoptions-2' href='imagebitmap-and-animations.html#imagebitmapoptions'><c- n>ImageBitmapOptions</c-></a> <c- g>options</c-> = {});
};
<a id='windoworworkerglobalscope-mixin:window-2' href='window-object.html#window'><c- n>Window</c-></a> <c- b>includes</c-> <a href='#windoworworkerglobalscope' id='windoworworkerglobalscope-mixin:windoworworkerglobalscope-4'><c- n>WindowOrWorkerGlobalScope</c-></a>;
<a id='windoworworkerglobalscope-mixin:workerglobalscope-2' href='workers.html#workerglobalscope'><c- n>WorkerGlobalScope</c-></a> <c- b>includes</c-> <a href='#windoworworkerglobalscope' id='windoworworkerglobalscope-mixin:windoworworkerglobalscope-5'><c- n>WindowOrWorkerGlobalScope</c-></a>;</code></pre>

  <dl class="domintro"><dt>self . <code id="dom-issecurecontext-dev"><a href="#dom-issecurecontext">isSecureContext</a></code><dd><p>Returns whether or not this global object represents a <a href="#secure-context" id="windoworworkerglobalscope-mixin:secure-context">secure context</a>. <a href="references.html#refsSECURE-CONTEXTS">[SECURE-CONTEXTS]</a><dt>self . <code id="dom-origin-dev"><a href="#dom-origin">origin</a></code><dd><p>Returns the global object's <a id="windoworworkerglobalscope-mixin:concept-origin" href="origin.html#concept-origin">origin</a>, serialized as string.<dt>self . <code id="dom-crossoriginisolated-dev"><a href="#dom-crossoriginisolated">crossOriginIsolated</a></code><dd><p>Returns whether scripts running in this global are allowed to use APIs that require cross-origin isolation. This depends on the `<code>Cross-Origin-Opener-Policy</code>` and `<code>Cross-Origin-Embedder-Policy</code>` HTTP response headers and the "<code id="windoworworkerglobalscope-mixin:cross-origin-isolated-feature"><a href="infrastructure.html#cross-origin-isolated-feature">cross-origin-isolated</a></code>" feature.</dl>

  <div class="example"><p>Developers are strongly encouraged to use <code>self.origin</code> over <code>location.origin</code>. The former returns the <a id="windoworworkerglobalscope-mixin:concept-origin-2" href="origin.html#concept-origin">origin</a> of the environment, the latter of the URL of the environment. Imagine the following script executing in a document on <code>https://stargate.example/</code>:</p>

   <pre><code class='js'><c- a>var</c-> frame <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"iframe"</c-><c- p>)</c->
frame<c- p>.</c->onload <c- o>=</c-> <c- a>function</c-><c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> frameWin <c- o>=</c-> frame<c- p>.</c->contentWindow
  console<c- p>.</c->log<c- p>(</c->frameWin<c- p>.</c->location<c- p>.</c->origin<c- p>)</c-> <c- c1>// "null"</c->
  console<c- p>.</c->log<c- p>(</c->frameWin<c- p>.</c->origin<c- p>)</c-> <c- c1>// "https://stargate.example"</c->
<c- p>}</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->frame<c- p>)</c-></code></pre>

   <p><code>self.origin</code> is a more reliable security indicator.</p>
  </div>

  

  <p>The <dfn id="dom-issecurecontext"><code>isSecureContext</code></dfn> getter steps are to return true if <a id="windoworworkerglobalscope-mixin:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#relevant-settings-object" id="windoworworkerglobalscope-mixin:relevant-settings-object">relevant settings object</a> is a <a href="#secure-context" id="windoworworkerglobalscope-mixin:secure-context-2">secure context</a>, or false otherwise.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/origin" title="The origin read-only property of the WindowOrWorkerGlobalScope interface returns the origin of the global scope, serialized as a string.">WindowOrWorkerGlobalScope/origin</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>54+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>59+</span></span><hr><span class="opera no"><span>Opera</span><span>No</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>54+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>59+</span></span><span class="webview_android yes"><span>WebView Android</span><span>59+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>7.0+</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div><p>The <dfn id="dom-origin"><code>origin</code></dfn> getter steps are to return <a id="windoworworkerglobalscope-mixin:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#relevant-settings-object" id="windoworworkerglobalscope-mixin:relevant-settings-object-2">relevant settings object</a>'s <a href="#concept-settings-object-origin" id="windoworworkerglobalscope-mixin:concept-settings-object-origin">origin</a>, <a href="origin.html#ascii-serialisation-of-an-origin" id="windoworworkerglobalscope-mixin:ascii-serialisation-of-an-origin">serialized</a>.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in one engine only." class="less-than-two-engines-flag">⚠</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/crossOriginIsolated" title="The crossOriginIsolated read-only property of the WindowOrWorkerGlobalScope interface returns a boolean value that indicates whether a SharedArrayBuffer can be sent via a Window.postMessage() call.">WindowOrWorkerGlobalScope/crossOriginIsolated</a><p class="less-than-two-engines-text">Support in one engine only.<div class="support"><span class="firefox yes"><span>Firefox</span><span>72+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome no"><span>Chrome</span><span>No</span></span><hr><span class="opera no"><span>Opera</span><span>No</span></span><span class="edge_blink no"><span>Edge</span><span>No</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android no"><span>Firefox Android</span><span>No</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android no"><span>Chrome Android</span><span>No</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div><p>The <dfn id="dom-crossoriginisolated"><code>crossOriginIsolated</code></dfn> getter steps are to return <a id="windoworworkerglobalscope-mixin:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#relevant-settings-object" id="windoworworkerglobalscope-mixin:relevant-settings-object-3">relevant settings object</a>'s <a href="#concept-settings-object-cross-origin-isolated-capability" id="windoworworkerglobalscope-mixin:concept-settings-object-cross-origin-isolated-capability">cross-origin isolated capability</a>.</p>

  


  <h3 id="atob"><span class="secno">8.3</span> Base64ユーティリティーメソッド<a href="#atob" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/atob" title="The WindowOrWorkerGlobalScope.atob() function decodes a string of data which has been encoded using base-64 encoding. You can use the btoa() method to encode and transmit data which may otherwise cause communication problems, then transmit it and use the atob() method to decode the data again. For example, you can encode, transmit, and decode control characters such as ASCII values 0 through 31.">WindowOrWorkerGlobalScope/atob</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span><hr><span class="caniuse"><span><a href="https://caniuse.com/#feat=atob-btoa" title="Base64 encoding and decoding">caniuse.com table</a></span></span></div></div></div>

  <p>The <code id="atob:dom-atob"><a href="#dom-atob">atob()</a></code> and <code id="atob:dom-btoa"><a href="#dom-btoa">btoa()</a></code> methods allow developers to transform content to and from the base64 encoding.</p>

  <p class="note">これらAPIにおいて、簡略のために、"b"は"binary"、"a"は"ASCII"を表すと考えることができる。ただし実際には、主に歴史的な理由で、これらの関数の入力と出力の両方にはUnicode文字列である。</p>

  <dl class="domintro"><dt><var>result</var> = self . <code id="dom-btoa-dev"><a href="#dom-btoa">btoa</a></code>( <var>data</var> )<dd><p>入力データを取得し、U+0000からU+00FFまでの範囲で文字のみを含むUnicode文字列の形式で、それぞれ値0x00から0xFFまでを持つバイナリーバイトを表し、そのbase64表現に変換したものを返す。</p>

    <p>Throws an <a id="atob:invalidcharactererror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror" data-x-internal="invalidcharactererror">"<code>InvalidCharacterError</code>"</a> <code id="atob:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> exception if the input string contains any out-of-range characters.</p>
   <dt><var>result</var> = self . <code id="dom-atob-dev"><a href="#dom-atob">atob</a></code>( <var>data</var> )<dd><p>入力データを取得し、base64でエンコードされたバイナリーデータを含むUnicode文字列の形式で、これをデコードし、それぞれ0x00から0xFFまでの値を持つバイナリーバイトを表す、そのバイナリーデータに対応した、範囲U+0000からU+00FFまでの文字から成る文字列を返す。</p>

    <p>Throws an <a id="atob:invalidcharactererror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror" data-x-internal="invalidcharactererror">"<code>InvalidCharacterError</code>"</a> <code id="atob:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if the input string is not valid base64 data.</p>
   </dl>

  

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa" title="The WindowOrWorkerGlobalScope.btoa() method creates a Base64-encoded ASCII string from a binary string (i.e., a String object in which each character in the string is treated as a byte of binary data).">WindowOrWorkerGlobalScope/btoa</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><p>The <dfn id="dom-btoa"><code id="dom-windowbase64-btoa">btoa(<var>data</var>)</code></dfn> method must throw an <a id="atob:invalidcharactererror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror" data-x-internal="invalidcharactererror">"<code>InvalidCharacterError</code>"</a> <code id="atob:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if <var>data</var> contains any character whose code point is greater than U+00FF. Otherwise, the user agent must convert <var>data</var> to a byte sequence whose <var>n</var>th byte is the eight-bit representation of the <var>n</var>th code point of <var>data</var>, and then must apply <a id="atob:forgiving-base64-encode" href="https://triple-underscore.github.io/infra-ja.html#forgiving-base64-encode" data-x-internal="forgiving-base64-encode">forgiving-base64 encode</a> to that byte sequence and return the result.</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/atob" title="The WindowOrWorkerGlobalScope.atob() function decodes a string of data which has been encoded using base-64 encoding. You can use the btoa() method to encode and transmit data which may otherwise cause communication problems, then transmit it and use the atob() method to decode the data again. For example, you can encode, transmit, and decode control characters such as ASCII values 0 through 31.">WindowOrWorkerGlobalScope/atob</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>3+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div><p>The <dfn id="dom-atob"><code id="dom-windowbase64-atob">atob(<var>data</var>)</code></dfn> method, when invoked, must run the following steps:</p>

  <ol><li><p>Let <var>decodedData</var> be the result of running <a id="atob:forgiving-base64-decode" href="https://triple-underscore.github.io/infra-ja.html#forgiving-base64-decode" data-x-internal="forgiving-base64-decode">forgiving-base64 decode</a> on <var>data</var>.<li><p>If <var>decodedData</var> is failure, then throw an <a id="atob:invalidcharactererror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidcharactererror" data-x-internal="invalidcharactererror">"<code>InvalidCharacterError</code>"</a> <code id="atob:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Return <var>decodedData</var>.</ol>

  


  <nav><a href="offline.html">← 7.11 オフラインウェブアプリケーション</a> — <a href="./">目次</a> — <a href="dynamic-markup-insertion.html">8.4 動的マークアップの挿入 →</a></nav>

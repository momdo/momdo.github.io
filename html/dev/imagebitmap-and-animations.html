<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Edition for Web Developers日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <script async="" src="./search.js"></script>
  
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><h2 id="dev-edition-h2" class="no-num no-toc">Edition for Web Developers — Last Updated <span class="pubdate">3 May 2022</span></h2></hgroup>
   

   <div id="search"><input placeholder="Search. Press '/'" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="system-state.html">← 8.9 システム状態および性能</a> — <a href="./">目次</a> — <a href="comms.html">9 コミュニケーション →</a></nav><ol class="toc"><li><ol><li><a href="imagebitmap-and-animations.html#images-2"><span class="secno">8.10</span> 画像</a><li><a href="imagebitmap-and-animations.html#animation-frames"><span class="secno">8.11</span> アニメーションフレーム</a></ol></ol><h3 id="images-2"><span class="secno">8.10</span> 画像<a href="#images-2" class="self-link"></a></h3>

  

  <p><code>ImageBitmap</code>オブジェクトは過度の待ち時間なしのキャンバスに塗装できるビットマップ画像を表す。</p>

  <p class="note">この過度の待ち時間は何かの正確な判断は実装者に委ねるが、一般にビットマップを活用することは、ネットワークI/O、あるいはローカルディスクI/Oを必要とする場合、その後待ち時間はおそらく過度である。一方それが唯一のGPUやシステムRAMからのブロッキングの読み出しを必要とする場合、待ち時間はおそらく許容できる。</p>

  <dl class="domintro"><dt><code><var>promise</var> = self.<span id="dom-createimagebitmap">createImageBitmap</span>(<var>image</var> [, <var>options</var> ])</code><dt><code><var>promise</var> = self.<a href="#dom-createimagebitmap" id="images-2:dom-createimagebitmap">createImageBitmap</a>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var> [, <var>options</var> ])</code><dd><p><code id="images-2:the-img-element"><a href="embedded-content.html#the-img-element">img</a></code>要素、<a id="images-2:svg-image" href="https://triple-underscore.github.io/svg-embedded-ja.html#ImageElement" data-x-internal="svg-image">SVG <code>image</code></a>要素、<code id="images-2:the-video-element"><a href="media.html#the-video-element">video</a></code>要素、<code id="images-2:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code>要素、<code id="images-2:blob"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>オブジェクト、<code>ImageData</code>オブジェクト、または別の<code>ImageBitmap</code>オブジェクトである<var>画像</var>を取得し、新しい<code>ImageBitmap</code>が作成されたときに解決されるpromiseを返す。</p>

    <p><code>ImageBitmap</code>オブジェクトを構築することが全くできない場合、たとえば、与えられた<var>image</var> データが実際の画像ではないので、代わりにpromiseが却下される。</p>

    <p><var>sx</var>、<var>sy</var>、<var>sw</var>、および<var>sh</var>引数が指定される場合、ソース画像は与えられたピクセルに切り取られ、元のピクセルに欠けているピクセルは<a id="images-2:transparent-black" href="https://triple-underscore.github.io/css-color-ja.html#transparent-black" data-x-internal="transparent-black">透明な黒</a>に置き換えられる。これらの座標は、<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'" data-x-internal="'px'">CSSピクセル</a>では<em>なく</em>、ソース画像のピクセル座標空間にある。</p>

    <p><var>options</var>が指定される場合、<code>ImageBitmap</code>オブジェクトのビットマップデータは<var>options</var>に従って変更される。For example, if the <code>premultiplyAlpha</code> option is set to "<code>premultiply</code>", the <span>bitmap data</span>'s color channels are <a href="canvas.html#concept-premultiplied-alpha" id="images-2:concept-premultiplied-alpha">premultiplied by its alpha channel</a>.</p>

    <p>ソース画像が有効な状態にない場合、<a id="images-2:invalidstateerror" href="https://webidl.spec.whatwg.org/#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>を拒否する（たとえば、正常に読み込まれなかった<code id="images-2:the-img-element-2"><a href="embedded-content.html#the-img-element">img</a></code>要素、<span>[[Detached]]</span>内部スロット値がtrueの<code>ImageBitmap</code>オブジェクト、<code id="images-2:dom-imagedata-data"><a href="canvas.html#dom-imagedata-data">data</a></code>属性値の[[ViewedArrayBuffer]]内部スロットが切り離されている<code>ImageData</code>オブジェクト、データがビットマップイメージとして解釈できない<code id="images-2:blob-2"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>など）。</p>

    <p>スクリプトがソース画像の画像データへのアクセスを許可されていない場合、<a id="images-2:securityerror" href="https://webidl.spec.whatwg.org/#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="images-2:domexception-2"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>でpromiseを拒否する（たとえば、<span>生成元をまたぐCORS</span>である<code id="images-2:the-video-element-2"><a href="media.html#the-video-element">video</a></code>、別の<a id="images-2:concept-origin" href="origin.html#concept-origin">生成元</a>からのワーカーのスクリプトで描画された<code id="images-2:the-canvas-element-2"><a href="canvas.html#the-canvas-element">canvas</a></code>など）。</p>
   <dt><code><var>imageBitmap</var>.<span id="dom-imagebitmap-close">close</span>()</code><dd><p><var>imageBitmap</var>の基礎となる<span>ビットマップデータ</span>を解放する。<dt><code><var>imageBitmap</var>.<span id="dom-imagebitmap-width">width</span></code><dd><p>画像の<a id="images-2:intrinsic-width" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-width" data-x-internal="intrinsic-width">内在幅</a>を<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-2" data-x-internal="'px'">CSSピクセル</a>で返す。</p>
   <dt><code><var>imageBitmap</var>.<span id="dom-imagebitmap-height">height</span></code><dd><p>画像の<a id="images-2:intrinsic-height" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-height" data-x-internal="intrinsic-height">内在高さ</a>を<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-3" data-x-internal="'px'">CSSピクセル</a>で返す。</p>
   </dl>

  

  <div class="example"><p>このAPIを使用すると、スプライトシートは、プレカットと調製することができる：</p>

   <pre><code class='js'><c- a>var</c-> sprites <c- o>=</c-> <c- p>{};</c->
<c- a>function</c-> loadMySprites<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> image <c- o>=</c-> <c- k>new</c-> Image<c- p>();</c->
  image<c- p>.</c->src <c- o>=</c-> <c- t>'mysprites.png'</c-><c- p>;</c->
  <c- a>var</c-> resolver<c- p>;</c->
  <c- a>var</c-> promise <c- o>=</c-> <c- k>new</c-> Promise<c- p>(</c-><c- a>function</c-> <c- p>(</c->arg<c- p>)</c-> <c- p>{</c-> resolver <c- o>=</c-> arg <c- p>});</c->
  image<c- p>.</c->onload <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
    resolver<c- p>(</c->Promise<c- p>.</c->all<c- p>([</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mf>0</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->person <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>40</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->grass  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>80</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->tree   <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->hut    <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->apple  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>80</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->snake  <c- o>=</c-> image <c- p>})</c->
    <c- p>]));</c->
  <c- p>};</c->
  <c- k>return</c-> promise<c- p>;</c->
<c- p>}</c->

<c- a>function</c-> runDemo<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> canvas <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'canvas#demo'</c-><c- p>);</c->
  <c- a>var</c-> context <c- o>=</c-> canvas<c- p>.</c->getContext<c- p>(</c-><c- t>'2d'</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->tree<c- p>,</c-> <c- mf>30</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->snake<c- p>,</c-> <c- mf>70</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
<c- p>}</c->

loadMySprites<c- p>().</c->then<c- p>(</c->runDemo<c- p>);</c-></code></pre>

  </div>



  <h3 id="animation-frames"><span class="secno">8.11</span> アニメーションフレーム<a href="#animation-frames" class="self-link"></a></h3>

  <p>一部のオブジェクトには<code>AnimationFrameProvider</code>インターフェイスミックスインが含まれる。</p>

  

  <p>各<code>AnimationFrameProvider</code>オブジェクトはまた、プロバイダーの内部状態を格納する<dfn id="concept-animationframeprovider-target-object">ターゲットオブジェクト</dfn>を持つ。これは次のように定義される：</p>

  <dl><dt><code>AnimationFrameProvider</code>が<code>Window</code>である場合<dd><code>Window</code>の<span>関連付けられた<code>Document</code></span><dt><code>AnimationFrameProvider</code>が <code id="animation-frames:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>である場合<dd><code id="animation-frames:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code></dl>

  <p>各<a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object">ターゲットオブジェクト</a>は、<dfn id="list-of-animation-frame-callbacks">アニメーションフレームコールバックのマップ</dfn>、これは初期は空でなければならない<a id="animation-frames:ordered-map" href="https://triple-underscore.github.io/infra-ja.html#ordered-map" data-x-internal="ordered-map">順序付きマップ</a>である、および<dfn id="animation-frame-callback-identifier">アニメーションフレームコールバック識別子</dfn>、これは初期は0でなければならない数、を持つ。</p>

  <p>次のいずれかが当てはまる場合、<code>AnimationFrameProvider</code><var>プロバイダー</var>は<dfn id="concept-animationframeprovider-supported">サポートされる</dfn>とみなされる：</p>

  <ul class="brief"><li><var>provider</var>が<code>Window</code>である。<li><var>provider</var>の<span>所有者集合</span>が<code>Document</code>オブジェクトを<a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="animation-frames:list-contains" data-x-internal="list-contains">含む</a>。<li><var>provider</var>の<span>所有者集合</span>におけるすべての<code id="animation-frames:dedicatedworkerglobalscope-3"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>オブジェクトが<a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported">サポートされる</a>。</ul>

  <hr>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame" title="The window.requestAnimationFrame() method tells the browser that you wish to perform an animation and requests that the browser calls a specified function to update an animation before the next repaint. The method takes a callback as an argument to be invoked before the repaint.">Window/requestAnimationFrame</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>25+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.5+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span></div></div></div><p>The <dfn data-dfn-for="AnimationFrameProvider" id="dom-animationframeprovider-requestanimationframe" data-dfn-type="method"><code>requestAnimationFrame(<var>callback</var>)</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="animation-frames:this" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-2">supported</a>, then throw a <a id="animation-frames:notsupportederror" href="https://webidl.spec.whatwg.org/#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>target</var> be <a id="animation-frames:this-2" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-2">target object</a>.<li><p>Increment <var>target</var>'s <a href="#animation-frame-callback-identifier" id="animation-frames:animation-frame-callback-identifier">animation frame callback identifier</a> by one, and let <var>handle</var> be the result.<li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks">map of animation frame callbacks</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="animation-frames:map-set" data-x-internal="map-set">Set</a> <var>callbacks</var>[<var>handle</var>] to <var>callback</var>.<li><p>Return <var>handle</var>.</ol>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame" title="The window.cancelAnimationFrame() method cancels an animation frame request previously scheduled through a call to window.requestAnimationFrame().">Window/cancelAnimationFrame</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera yes"><span>Opera</span><span>15+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>7+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>25+</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.5+</span></span><span class="opera_android yes"><span>Opera Android</span><span>14+</span></span></div></div></div><p>The <dfn data-dfn-for="AnimationFrameProvider" id="animationframeprovider-cancelanimationframe" data-dfn-type="method"><code>cancelAnimationFrame(<var>handle</var>)</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="animation-frames:this-3" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-3">supported</a>, then throw a <a id="animation-frames:notsupportederror-2" href="https://webidl.spec.whatwg.org/#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception-2"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>callbacks</var> be <a id="animation-frames:this-4" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-3">target object</a>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-2">map of animation frame callbacks</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-remove" id="animation-frames:map-remove" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].</ol>

  <p>To <dfn id="run-the-animation-frame-callbacks">run the animation frame callbacks</dfn> for a <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-4">target object</a> <var>target</var> with a timestamp <var>now</var>:</p>

  <ol><li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-3">map of animation frame callbacks</a>.<li><p>Let <var>callbackHandles</var> be the result of <a href="https://triple-underscore.github.io/infra-ja.html#map-getting-the-keys" id="animation-frames:map-get-the-keys" data-x-internal="map-get-the-keys">getting the keys</a> of <var>callbacks</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="animation-frames:list-iterate" data-x-internal="list-iterate">For each</a> <var>handle</var> in <var>callbackHandles</var>, if <var>handle</var> <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="animation-frames:map-exists" data-x-internal="map-exists">exists</a> in <var>callbacks</var>:</p>

    <ol><li><p>Let <var>callback</var> be <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-remove" id="animation-frames:map-remove-2" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://webidl.spec.whatwg.org/#invoke-a-callback-function" id="animation-frames:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>callback</var>, passing <var>now</var> as the only argument, and if an exception is thrown, <span>report the exception</span>.</ol>
   </ol>

  <div class="example"><p>ワーカー内部では、<code id="animation-frames:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code>要素から転送された<code>OffscreenCanvas</code>と一緒に<code id="animation-frames:dom-animationframeprovider-requestanimationframe"><a href="#dom-animationframeprovider-requestanimationframe">requestAnimationFrame()</a></code>を使用することができる。まず、文書内で、ワーカーに制御を転送する：</p>

   <pre><code class='js'><c- a>const</c-> offscreenCanvas <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- u>"c"</c-><c- p>).</c->transferControlToOffscreen<c- p>();</c->
worker<c- p>.</c->postMessage<c- p>(</c->offscreenCanvas<c- p>,</c-> <c- p>[</c->offscreenCanvas<c- p>]);</c-></code></pre>

   <p>次に、ワーカーにおいて、以下のコードで左から右に移動する矩形を描画する：</p>

   <pre><code class='js'><c- a>let</c-> ctx<c- p>,</c-> pos <c- o>=</c-> <c- mf>0</c-><c- p>;</c->
<c- a>function</c-> draw<c- p>(</c->dt<c- p>)</c-> <c- p>{</c->
  ctx<c- p>.</c->clearRect<c- p>(</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>100</c-><c- p>,</c-> <c- mf>100</c-><c- p>);</c->
  ctx<c- p>.</c->fillRect<c- p>(</c->pos<c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>10</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
  pos <c- o>+=</c-> <c- mf>10</c-> <c- o>*</c-> dt<c- p>;</c->
  requestAnimationFrame<c- p>(</c->draw<c- p>);</c->
<c- p>}</c->

self<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-><c- p>(</c->ev<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> transferredCanvas <c- o>=</c-> ev<c- p>.</c->data<c- p>;</c->
  ctx <c- o>=</c-> transferredCanvas<c- p>.</c->getContext<c- p>(</c-><c- u>"2d"</c-><c- p>);</c->
  draw<c- p>();</c->
<c- p>};</c-></code></pre>
  </div>

  <nav><a href="system-state.html">← 8.9 システム状態および性能</a> — <a href="./">目次</a> — <a href="comms.html">9 コミュニケーション →</a></nav>

<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Developer's Edition 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <script async="" src="./search.js"></script>
  
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><h2 id="dev-edition-h2" class="no-num no-toc">Developer's Edition — Last Updated <span class="pubdate">23 March 2021</span></h2></hgroup>
   

   <div id="search"><input placeholder="Search. Press '/'" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="window-object.html">← 7.2 Windowオブジェクト</a> — <a href="./">目次</a> — <a href="history.html">7.7 セッション履歴およびナビゲーション →</a></nav><ol class="toc"><li><ol><li><a href="origin.html#origin"><span class="secno">7.3</span> 生成元</a><ol><li><a href="origin.html#relaxing-the-same-origin-restriction"><span class="secno">7.3.1</span> 同一生成元制限を緩和する</a><li><a href="origin.html#origin-keyed-agent-clusters"><span class="secno">7.3.2</span> Origin-keyed agent clusters</a></ol><li><a href="origin.html#sandboxing"><span class="secno">7.4</span> サンドボックス</a><li><a href="origin.html#cross-origin-opener-policies"><span class="secno">7.5</span> 生成元をまたいだオープナーポリシー</a><ol><li><a href="origin.html#the-headers"><span class="secno">7.5.1</span> ヘッダー</a><li><a href="origin.html#browsing-context-group-switches-due-to-cross-origin-opener-policy"><span class="secno">7.5.2</span> 生成元をまたいだオープナーポリシーによるブラウジングコンテキストグループスイッチ</a><li><a href="origin.html#reporting"><span class="secno">7.5.3</span> レポーティング</a></ol><li><a href="origin.html#coep"><span class="secno">7.6</span> 生成元をまたいだ埋め込みポリシー</a><ol><li><a href="origin.html#the-headers-2"><span class="secno">7.6.1</span> ヘッダー</a><li><a href="origin.html#embedder-policy-checks"><span class="secno">7.6.2</span> 埋め込みポリシーチェック</a></ol></ol></ol><h3 id="origin"><span class="secno">7.3</span> 生成元<a href="#origin" class="self-link"></a></h3>
  

  <p>生成元は、ウェブのセキュリティモデルの基本的な通貨である。生成元を共有するウェブプラットフォーム内の2つの当事者が互いに信頼し、同一の権限を有すると仮定される。異なる生成元をもつ当事者は、互いに潜在的に悪意があると見なされ、互いから程度を変化させるよう隔離される。</p>

  <p class="example">たとえば、<code>bank.example.com</code>でホストされるExample Bankのウェブサイトは、<code>charity.example.org</code>でホストExample CharityのウェブサイトのDOMを検査しようとすると、<a id="origin:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="origin:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> が発生する。</p>

  <hr>

  <p id="origin-2"><dfn id="concept-origin" data-export="">生成元</dfn>は次のいずれかである：</p>

  <dl><dt><dfn id="concept-origin-opaque" data-export="">不透明な生成元</dfn><dd><p>内部値であり、シリアライズされていないために再作成することができない（<span>生成元のシリアライズ</span>ごとに"<code>null</code>"としてシリアライズされる）。意味のある操作は、透過性のテストのみである。<dt><dfn id="concept-origin-tuple" data-export="">タプルの生成元</dfn><dd><p><a href="#concept-origin-tuple" id="origin:concept-origin-tuple">タプル</a>は以下で構成される：<ul class="brief"><li><dfn data-dfn-for="origin" id="concept-origin-scheme" data-export="">スキーム</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="origin:concept-url-scheme" data-x-internal="concept-url-scheme">スキーム</a>）。<li><dfn data-dfn-for="origin" id="concept-origin-host" data-export="">ホスト</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-host" id="origin:concept-host" data-x-internal="concept-host">ホスト</a>）。<li><dfn data-dfn-for="origin" id="concept-origin-port" data-export="">ポート</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-port" id="origin:concept-url-port" data-x-internal="concept-url-port">ポート</a>）。<li><dfn data-dfn-for="origin" id="concept-origin-domain" data-export="">ドメイン</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-domain" id="origin:concept-domain" data-x-internal="concept-domain">ドメイン</a>）。特に明記されていない限り、null。</ul>
   </dl>

  <p class="note"><a href="#concept-origin" id="origin:concept-origin">生成元</a>は、たとえば複数の<code>Document</code>オブジェクト間で共有できる。さらに、<a href="#concept-origin" id="origin:concept-origin-2">生成元</a>は一般に不変である。<a href="#concept-origin-tuple" id="origin:concept-origin-tuple-2">タプルの生成元</a>の<a href="#concept-origin-domain" id="origin:concept-origin-domain">ドメイン</a>のみ、および<code id="origin:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code> APIを介してのみ変更できる。</p>

  <p><a href="#concept-origin" id="origin:concept-origin-3">生成元</a><var>origin</var>の<dfn id="concept-origin-effective-domain" data-export="">有効ドメイン</dfn>は、次のように計算される：</p>

  <ol><li><p><var>origin</var>が<a href="#concept-origin-opaque" id="origin:concept-origin-opaque">不透明な生成元</a>である場合、nullを返す。<li><p><var>origin</var>の<a href="#concept-origin-domain" id="origin:concept-origin-domain-2">ドメイン</a>がnullでない場合、<var>origin</var>の<a href="#concept-origin-domain" id="origin:concept-origin-domain-3">ドメイン</a>を返す。<li><p><var>origin</var>の<a href="#concept-origin-host" id="origin:concept-origin-host">ホスト</a>を返す。</ol>

  


  <h4 id="relaxing-the-same-origin-restriction"><span class="secno">7.3.1</span> 同一生成元制限を緩和する<a href="#relaxing-the-same-origin-restriction" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/domain" title="The domain property of the Document interface gets/sets the domain portion of the origin of the current document, as used by the same-origin policy.">Document/domain</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>1+</span></span><span class="safari yes"><span>Safari</span><span>1+</span></span><span class="chrome yes"><span>Chrome</span><span>1+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>4+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>4+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>1+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>1+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div>

  <dl class="domintro"><dt><var>document</var> . <code id="dom-document-domain">domain</code> [ = <var>domain</var> ]<dd><p>セキュリティチェックのために使用される現在のドメインを返す。</p>

    <p>サブドメインを削除する値に設定し、<a href="#concept-origin" id="relaxing-the-same-origin-restriction:concept-origin">生成元</a>の<a href="#concept-origin-domain" id="relaxing-the-same-origin-restriction:concept-origin-domain">ドメイン</a>を変更し、同じドメインの他のサブドメイン（同じことを行う場合）のページが互いにアクセスできるようにすることができる。これにより、ドメインの異なるホスト上のページが、互いのDOMに同期的にアクセスできるようになる。</p>

    <p>サンドボックス化された<code id="relaxing-the-same-origin-restriction:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>、<a href="#concept-origin-opaque" id="relaxing-the-same-origin-restriction:concept-origin-opaque">不透明な生成元</a>をもつ<code>Document</code>、<a href="browsers.html#concept-document-bc" id="relaxing-the-same-origin-restriction:concept-document-bc">ブラウジングコンテキスト</a>のない<code>Document</code>、および"<code id="relaxing-the-same-origin-restriction:document-domain-feature"><a href="infrastructure.html#document-domain-feature">document-domain</a></code>"機能が無効になっている場合、セッターは<a id="relaxing-the-same-origin-restriction:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a>例外を投げる。In cases where <code id="relaxing-the-same-origin-restriction:dom-crossoriginisolated"><a href="webappapis.html#dom-crossoriginisolated">crossOriginIsolated</a></code> or <code id="relaxing-the-same-origin-restriction:dom-originagentcluster"><a href="#dom-originagentcluster">originAgentCluster</a></code> return true, the setter will do nothing.</p>
   </dl>

  <div class="critical"><p><code id="relaxing-the-same-origin-restriction:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>セッターの使用を避ける。これは、同一生成元ポリシーが提供するセキュリティ保護を損なうものである。これは共有ホスティングを使用している場合に特に顕著である。たとえば、信頼できないサードパーティが同じIPアドレスだが異なるポートで HTTP サーバーをホストできる場合、<code id="relaxing-the-same-origin-restriction:dom-document-domain-2"><a href="#dom-document-domain">document.domain</a></code>セッターを使用した後に生成元を比較するときにポートが無視されるため、通常は同じホスト上の2つの異なるサイトを保護する同一生成元の保護が失敗する。</p>

   <p>これらのセキュリティ上の落とし穴があるため、この機能はウェブプラットフォームから削除されるプロセスにある。（これは何年もかかる長いプロセスである。）</p>

   <p>代わりに、安全な方法で生成元間で通信するために、<code>postMessage()</code> または<code>MessageChannel</code>オブジェクトを使用する。</p>
  </div>

  



  <h4 id="origin-keyed-agent-clusters"><span class="secno">7.3.2</span> <span id="origin-isolation"></span>Origin-keyed agent clusters<a href="#origin-keyed-agent-clusters" class="self-link"></a></h4>

  <dl class="domintro"><dt>window . <code id="dom-originagentcluster">originAgentCluster</code><dd><p>Returns true if this <code>Window</code> belongs to an <a id="origin-keyed-agent-clusters:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a> which is <a href="#concept-origin" id="origin-keyed-agent-clusters:concept-origin">origin</a>-<span>keyed</span>, in the manner described in this section.</p>
   </dl>

  <p>A <code>Document</code> delivered over a <span>secure context</span> can request that it be placed in an <a href="#concept-origin" id="origin-keyed-agent-clusters:concept-origin-2">origin</a>-<span>keyed</span> <a id="origin-keyed-agent-clusters:agent-cluster-2" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>, by using the `<code>Origin-Agent-Cluster</code>` HTTP response header. This header is a <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html" id="origin-keyed-agent-clusters:http-structured-header" data-x-internal="http-structured-header">structured header</a> whose value must be a <a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#boolean" id="origin-keyed-agent-clusters:http-structured-header-boolean" data-x-internal="http-structured-header-boolean">boolean</a>. <a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a></p>

  <p><a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#boolean" id="origin-keyed-agent-clusters:http-structured-header-boolean-2" data-x-internal="http-structured-header-boolean">構造化されたヘッダー</a>の真偽値ではない値（すなわち、`<code>?1</code>`）は無視される。</p>

  <p>このヘッダーを使用した結果は、<code id="origin-keyed-agent-clusters:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>を使用して<a href="#relaxing-the-same-origin-restriction">同一生成元の制限を緩和</a>しようとしても何も実行されない代わりに、<code id="origin-keyed-agent-clusters:webassembly.module"><a data-x-internal="webassembly.module" href="https://webassembly.github.io/spec/js-api/#module">WebAssembly.Module</a></code>オブジェクトを生成元をまたいだ<code>Document</code>に送信することができなくなることである（たとえ<span>同じサイト</span>であっても）。水面下で、この分離により、ユーザーエージェントは、プロセスやスレッドなどの<a href="https://tc39.es/ecma262/#sec-agent-clusters" id="origin-keyed-agent-clusters:agent-cluster-3" data-x-internal="agent-cluster">エージェントクラスター</a>に対応する実装固有のリソースをより効率的に割り当てることが可能になる。</p>

  <p>Note that within a <span>browsing context group</span>, the `<code>Origin-Agent-Cluster</code>` header can never cause same-origin <code>Document</code> objects to end up in different <a href="https://tc39.es/ecma262/#sec-agent-clusters" id="origin-keyed-agent-clusters:agent-cluster-4" data-x-internal="agent-cluster">agent clusters</a>, even if one sends the header and the other doesn't.</p>

  <p class="note">This means that the <code id="origin-keyed-agent-clusters:dom-originagentcluster"><a href="#dom-originagentcluster">originAgentCluster</a></code> getter can return false, even if the header is set, if the header was omitted on a previously-loaded same-origin page in the same <span>browsing context group</span>. 同様に、ヘッダーが設定されていなくてもtrueを返すことができる。</p>

  

  <p class="note"><code>Document</code>s with an <a href="#concept-origin-opaque" id="origin-keyed-agent-clusters:concept-origin-opaque">opaque origin</a> can be considered unconditionally origin-keyed; for them the header has no effect, and the <code id="origin-keyed-agent-clusters:dom-originagentcluster-2"><a href="#dom-originagentcluster">originAgentCluster</a></code> getter will always return true.</p>

  <p class="note">Similarly, <code>Document</code>s whose <a id="origin-keyed-agent-clusters:agent-cluster-5" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>'s <span>cross-origin isolation mode</span> is not "<code>none</code>" are automatically origin-keyed. The `<code>Origin-Agent-Cluster</code>` header might be useful as an additional hint to implementations about resource allocation, since the `<code>Cross-Origin-Opener-Policy</code>` and `<code>Cross-Origin-Embedder-Policy</code>` headers used to achieve cross-origin isolation are more about ensuring that everything in the same address space opts in to being there. しかし、それを追加しても、著者のコードに追加の目に見える影響はない。</p>



  <h3 id="sandboxing"><span class="secno">7.4</span> サンドボックス<a href="#sandboxing" class="self-link"></a></h3>

  <p><dfn id="sandboxing-flag-set" data-export="">サンドボックスフラグセット</dfn>は以下のフラグの0個以上の集合であり、これは潜在的に信頼されないリソースが持つ能力を制限するために使用される：</p>

  <dl><dt><dfn id="sandboxed-navigation-browsing-context-flag" data-export="">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、コンテンツが、<a href="#sandboxLinks">サンドボックス化されたブラウジングコンテキスト自体</a>（またはその中にさらにネストされたブラウジングコンテキスト）、<a href="browsers.html#auxiliary-browsing-context" id="sandboxing:auxiliary-browsing-context">補助ブラウジングコンテキスト</a>（次に定義される<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護されている）、および<a id="sandboxing:top-level-browsing-context" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>（<a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag">サンドボックス化されたユーザー起動ブラウジングコンテキストフラグなしのトップレベルナビゲーション</a>、および以下に定義される<a href="#sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-with-user-activation-browsing-context-flag">サンドボックス化されたユーザー起動ブラウジングコンテキストフラグありトップレベルナビゲーション</a>によって保護されている）以外のブラウジングコンテキストをナビゲートすることを防止するものである。</p>

    <p><a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-2">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>が設定されない場合、それにもかかわらず一定の場合における制限はポップアップ（新しい<a href="browsers.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-2">トップレベルブラウジングコンテキスト</a>）を開くことができる。これらの<a href="browsers.html#browsing-context" id="sandboxing:browsing-context">ブラウジングコンテキスト</a>は常に、<dfn id="one-permitted-sandboxed-navigator">1つの許可されたサンドボックス化されたナビゲーター</dfn>を持ち、実際に移動するために作成した<a id="sandboxing:browsing-context-2" href="browsers.html#browsing-context">ブラウジングコンテキスト</a>を許可する、ブラウジングコンテキストが作成されるときに設定を持つ。（そうでなければ、<a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>は、それらが開かれた場合であってもナビゲートされていくのを防ぐだろう。）</p>
   <dt><dfn id="sandboxed-auxiliary-navigation-browsing-context-flag" data-export="">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxWindowOpen">コンテンツが新しい補助ブラウジングコンテキストを作成するのを防ぐ</a>。 たとえば、<code id="sandboxing:attr-hyperlink-target"><a href="links.html#attr-hyperlink-target">target</a></code>属性や<code id="sandboxing:dom-open"><a href="window-object.html#dom-open">window.open()</a></code>メソッドを使用する。</p>
   <dt><dfn id="sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" data-export="">ユーザーによるアクティブ化なしでサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxLinks">それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href="#sandboxClose">それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。サンドボックス化されたブラウジングコンテキストの<a id="sandboxing:active-window" href="browsers.html#active-window">アクティブウィンドウ</a>が<span>一時的なアクティブ化</span>を持たない場合にのみ考慮される。</p>

    <p><a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-2">ユーザーによるアクティブ化なしでサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>が設定されて<em>いない</em>場合、コンテンツはその<a id="sandboxing:top-level-browsing-context-3" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>をナビゲートすることができるが、他の<a href="browsers.html#browsing-context" id="sandboxing:browsing-context-3">ブラウジングコンテキスト</a>は、<a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-2">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>、および<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-3">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護されたままである。</p>
   <dt><dfn id="sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" data-export="">ユーザーによるアクティブ化でサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxLinks">それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href="#sandboxClose">それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。サンドボックス化されたブラウジングコンテキストの<a id="sandboxing:active-window-2" href="browsers.html#active-window">アクティブウィンドウ</a>が<span>一時的なアクティブ化</span>を持つ場合にのみ考慮される。</p>

    <p><a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-3">ユーザーによるアクティブ化なしでサンドボックス化されたブラウジングコンテキストフラグ</a>と同様に、このフラグは<a id="sandboxing:top-level-browsing-context-4" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>にのみ影響する。 設定されていない場合、他の<a href="browsers.html#browsing-context" id="sandboxing:browsing-context-4">ブラウジングコンテキスト</a>が他のフラグによって保護されている可能性がある。</p>
   <dt><dfn id="sandboxed-plugins-browsing-context-flag" data-export="">サンドボックス化されたプラグインブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxPluginEmbed"><code>embed</code>要素</a>、<a href="#sandboxPluginObject"><code>object</code>要素</a>を使用するか、または<a id="sandboxing:nested-browsing-context" href="browsers.html#nested-browsing-context">ネストされたブラウジングコンテキスト</a>の<a href="#sandboxPluginNavigate">ナビゲーション</a>を介するかに関係なく、それらの<a href="infrastructure.html#plugin" id="sandboxing:plugin-2">プラグイン</a>が<a href="infrastructure.html#concept-plugin-secure" id="sandboxing:concept-plugin-secure">保護</a>されない限り、コンテンツが<a href="infrastructure.html#plugin" id="sandboxing:plugin">プラグイン</a>をインスタンス化できないようにする。<dt><dfn id="sandboxed-origin-browsing-context-flag" data-export="">サンドボックス化された生成元ブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxOrigin">一意な生成元にコンテンツを強制する</a>。したがって、同一<a href="#concept-origin" id="sandboxing:concept-origin">生成元</a>から他のコンテンツにアクセスすることを防止する。</p>

    <p>このフラグはまた、<a href="#sandboxCookies"><code>document.cookie</code> IDL属性からの読み取りまたは書き込みをするスクリプトを防止し</a>、<code id="sandboxing:dom-localstorage"><a href="webstorage.html#dom-localstorage">localStorage</a></code>へのアクセスをブロックする。</p>
   <dt><dfn id="sandboxed-forms-browsing-context-flag" data-export="">サンドボックス化されたフォームブラウジングコンテキストフラグ</dfn><dd><p>このフラグは<a href="#sandboxSubmitBlocked">フォーム送信をブロックする</a>。</p>
   <dt><dfn id="sandboxed-pointer-lock-browsing-context-flag" data-export="">サンドボックス化されたポインターロックブラウジングコンテキストフラグ</dfn><dd><p>このフラグはPointer Lock APIを無効にする。<a href="references.html#refsPOINTERLOCK">[POINTERLOCK]</a></p>
   <dt><dfn id="sandboxed-scripts-browsing-context-flag" data-export="">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="#sandboxScriptBlocked">スクリプトの実行をブロックする</a>。</p>
   <dt><dfn id="sandboxed-automatic-features-browsing-context-flag" data-export="">サンドボックス化された自動機能ブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="media.html#attr-media-autoplay" id="sandboxing:attr-media-autoplay">自動ビデオ再生</a>や<a href="interaction.html#attr-fe-autofocus" id="sandboxing:attr-fe-autofocus">自動フォームコントロールフォーカス</a>などの、自動的に切り替える機能をブロックする。</p>
   <dt><dfn id="sandboxed-document.domain-browsing-context-flag" data-export="">サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、コンテンツが<code id="sandboxing:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>セッターを使用することから防ぐ。</p>
   <dt><dfn id="sandbox-propagates-to-auxiliary-browsing-contexts-flag" data-export="">サンドボックスが補助ブラウジングコンテキストに伝播するフラグ</dfn><dd><p>このフラグは、コンテンツが作成する<a id="sandboxing:auxiliary-browsing-context-2" href="browsers.html#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>がコンテンツの<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set">アクティブなサンドボックスフラグセット</a>を継承するのを保証することで、そのコンテンツがサンドボックスをエスケープするのを防ぐ。</p>
   <dt><dfn id="sandboxed-modals-flag" data-export="">サンドボックス化されたモーダルフラグ</dfn><dd><p>このフラグは、コンテンツが以下の機能のいずれかを使用してモーダルダイアログを生成するのを防ぐ：</p>

    <ul><li><code id="sandboxing:dom-alert"><a href="timers-and-user-prompts.html#dom-alert">window.alert()</a></code><li><code id="sandboxing:dom-confirm"><a href="timers-and-user-prompts.html#dom-confirm">window.confirm()</a></code><li><code id="sandboxing:dom-print"><a href="timers-and-user-prompts.html#dom-print">window.print()</a></code><li><code id="sandboxing:dom-prompt"><a href="timers-and-user-prompts.html#dom-prompt">window.prompt()</a></code><li><code id="sandboxing:event-beforeunload"><a href="indices.html#event-beforeunload">beforeunload</a></code>イベント</ul>
   <dt><dfn id="sandboxed-orientation-lock-browsing-context-flag" data-export="">サンドボックス化された方向ロックブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、画面の向きをロックする機能を無効にする。<a href="references.html#refsSCREENORIENTATION">[SCREENORIENTATION]</a></p>
   <dt><dfn id="sandboxed-presentation-browsing-context-flag" data-export="">サンドボックス化されたプレゼンテーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグはPresentation APIを無効にする。 <a href="references.html#refsPRESENTATION">[PRESENTATION]</a></p>
   <dt><dfn id="sandboxed-downloads-browsing-context-flag" data-export="">サンドボックス化されたダウンロードブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<span>ハイパーリンクのダウンロード</span>または<span>ダウンロードとして</span>処理される<span>ナビゲーション</span>のいずれを介して、コンテンツがダウンロードを開始またはインスタンス化するのを防ぐ。</p>
   </dl>

  <p>When the user agent is to <dfn id="parse-a-sandboxing-directive" data-export="">parse a sandboxing directive</dfn>, given a string <var>input</var>, a <a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set">sandboxing flag set</a> <var>output</var>, it must run the following steps:</p>

  <ol><li><p><a href="https://triple-underscore.github.io/infra-ja.html#split-on-ascii-whitespace" id="sandboxing:split-a-string-on-spaces" data-x-internal="split-a-string-on-spaces">Split <var>input</var> on ASCII whitespace</a>, to obtain <var>tokens</var>.<li><p><var>output</var>を空にする。<li><p><var>output</var>に次のフラグを追加する：</p>

    <ul><li><p><a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-3">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn id="attr-iframe-sandbox-allow-popups"><code>allow-popups</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-4">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a><li><p>The <a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-4">sandboxed top-level navigation without user activation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-top-navigation"><code>allow-top-navigation</code></dfn> keyword.<li><p>The <a href="#sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-with-user-activation-browsing-context-flag-2">sandboxed top-level navigation with user activation browsing context flag</a>, unless <var>tokens</var> contains either the <dfn id="attr-iframe-sandbox-allow-top-navigation-by-user-activation"><code>allow-top-navigation-by-user-activation</code></dfn> keyword or the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation"><a href="#attr-iframe-sandbox-allow-top-navigation">allow-top-navigation</a></code> keyword.</p>

      <p class="note">This means that if the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation-2"><a href="#attr-iframe-sandbox-allow-top-navigation">allow-top-navigation</a></code> is present, the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation-by-user-activation"><a href="#attr-iframe-sandbox-allow-top-navigation-by-user-activation">allow-top-navigation-by-user-activation</a></code> keyword will have no effect. For this reason, specifying both is a document conformance error.</p>
     <li><p><a href="#sandboxed-plugins-browsing-context-flag" id="sandboxing:sandboxed-plugins-browsing-context-flag">サンドボックス化されたプラグインブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn id="attr-iframe-sandbox-allow-same-origin"><code>allow-same-origin</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-origin-browsing-context-flag" id="sandboxing:sandboxed-origin-browsing-context-flag">サンドボックス化された生成元ブラウジングコンテキストフラグ</a></p>

      <div class="note"><p><code id="sandboxing:attr-iframe-sandbox-allow-same-origin"><a href="#attr-iframe-sandbox-allow-same-origin">allow-same-origin</a></code>キーワードは2つの例を対象とする。</p>

       <p>1つ目は、依然としてサンドボックス化されたコンテンツのDOMへのアクセスを可能する一方で、スクリプトを無効にするためにサンドボックス化されるべき同じサイトからコンテンツを許可するために使用できる。</p>

       <p>2つ目は、サードパーティサイトからコンテンツを埋め込むために使用でき、データなどを格納するためにデータベースAPIを使用して、その元のサイトに戻る通信から埋め込まれたページを妨げることなく、ポップアップなどを開いてから、そのサイトを防ぐためにサンドボックス化する。</p>
      </div>
     <li><p><var>tokens</var>が<dfn id="attr-iframe-sandbox-allow-forms"><code>allow-forms</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-forms-browsing-context-flag" id="sandboxing:sandboxed-forms-browsing-context-flag">サンドボックス化されたフォームブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn id="attr-iframe-sandbox-allow-pointer-lock"><code>allow-pointer-lock</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-pointer-lock-browsing-context-flag" id="sandboxing:sandboxed-pointer-lock-browsing-context-flag">サンドボックス化されたポインターロックブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn id="attr-iframe-sandbox-allow-scripts"><code>allow-scripts</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-scripts-browsing-context-flag" id="sandboxing:sandboxed-scripts-browsing-context-flag">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が（上記で定義された）<code id="sandboxing:attr-iframe-sandbox-allow-scripts"><a href="#attr-iframe-sandbox-allow-scripts">allow-scripts</a></code>キーワードを含む場合を除いて、<a href="#sandboxed-automatic-features-browsing-context-flag" id="sandboxing:sandboxed-automatic-features-browsing-context-flag">サンドボックス化された自動機能ブラウジングコンテキストフラグ</a></p>

      <p class="note">このフラグは、スクリプトと同じキーワードで緩和される。なぜなら、スクリプトが有効である場合にこれらの機能はいずれにせよ些細なことで実行でき、宣言的な機能を使用できるようにするよりむしろサンドボックス化された場合に、著者がそれら機能を実行するためのスクリプトを使用するよう強制することが不幸であるためである。</p>
     <li><p><a href="#sandboxed-document.domain-browsing-context-flag" id="sandboxing:sandboxed-document.domain-browsing-context-flag">サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</a>。<li><p>The <a href="#sandbox-propagates-to-auxiliary-browsing-contexts-flag" id="sandboxing:sandbox-propagates-to-auxiliary-browsing-contexts-flag">sandbox propagates to auxiliary browsing contexts flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-popups-to-escape-sandbox"><code>allow-popups-to-escape-sandbox</code></dfn> keyword.<li><p>The <a href="#sandboxed-modals-flag" id="sandboxing:sandboxed-modals-flag">sandboxed modals flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-modals"><code>allow-modals</code></dfn> keyword.<li><p>The <a href="#sandboxed-orientation-lock-browsing-context-flag" id="sandboxing:sandboxed-orientation-lock-browsing-context-flag">sandboxed orientation lock browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-orientation-lock"><code>allow-orientation-lock</code></dfn> keyword.<li><p>The <a href="#sandboxed-presentation-browsing-context-flag" id="sandboxing:sandboxed-presentation-browsing-context-flag">sandboxed presentation browsing context flag</a>, unless <var>tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-presentation"><code>allow-presentation</code></dfn> keyword.<li><p>The <a href="#sandboxed-downloads-browsing-context-flag" id="sandboxing:sandboxed-downloads-browsing-context-flag">sandboxed downloads browsing context flag</a>, unless <var> tokens</var> contains the <dfn id="attr-iframe-sandbox-allow-downloads"><code>allow-downloads</code></dfn> keyword.</ul>
   </ol>

  <hr>

  <p>すべての<a id="sandboxing:top-level-browsing-context-5" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>は、<dfn id="popup-sandboxing-flag-set">ポップアップサンドボックス化 フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-2">サンドボックス化フラグセット</a>である。<a id="sandboxing:browsing-context-5" href="browsers.html#browsing-context">ブラウジングコンテキスト</a>が作成される場合、その<a href="#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set">ポップアップサンド化フラグセット</a>は空でなければならない。これは、<span>ブラウジングコンテキストを選択するための規則</span>と、<a href="#obtain-browsing-context-navigation" id="sandboxing:obtain-browsing-context-navigation">ナビゲーション応答に使用するブラウジングコンテキストを取得する</a>ためのアルゴリズムで構成されている。</p>

  <p>すべての<code id="sandboxing:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素は、<dfn id="iframe-sandboxing-flag-set"><code>iframe</code>サンドボックス化フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-3">サンドボックス化フラグセット</a>である。<a href="#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set"><code>iframe</code>サンドボックス化フラグセット</a>のどのフラグが特定の時間にセットされるかは、<code id="sandboxing:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素の<code id="sandboxing:attr-iframe-sandbox"><a href="iframe-embed-object.html#attr-iframe-sandbox">sandbox</a></code> 属性によって決定される。</p>

  <p>すべての<code>Document</code>は、<dfn data-dfn-for="Document" id="active-sandboxing-flag-set" data-export="">アクティブなサンドボックス化フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-4">サンドボックス化フラグセット</a>である。<code>Document</code>が作成される場合、その<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-2">アクティブなサンドボックス化フラグセット</a>は空でなければならない。それは、<span>ナビゲーションアルゴリズム</span>によって追加される。</p>

  <p><span>ナビゲーションアルゴリズム</span>によって得られるすべてのリソースは、<dfn id="forced-sandboxing-flag-set" data-export="">強制サンドボックス化フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-5">サンドボックス化フラグセット</a>である。デフォルトでリソースは、その<a href="#forced-sandboxing-flag-set" id="sandboxing:forced-sandboxing-flag-set">強制サンドボックス化フラグセット</a>で設定されるフラグを持たないが、他の仕様は、特定のフラグがセットされていることを定義できる。</p>

  <p class="note">具体的には、<a href="#forced-sandboxing-flag-set" id="sandboxing:forced-sandboxing-flag-set-2">強制サンドボックス化フラグセット</a>が<cite>Content Security Policy</cite>によって使用される。<a href="references.html#refsCSP">[CSP]</a></p>

  <hr>

  <p>To <dfn id="determining-the-creation-sandboxing-flags">determine the creation sandboxing flags</dfn> for a <a href="browsers.html#concept-document-bc" id="sandboxing:concept-document-bc">browsing context</a> <var>browsing context</var>, given null or an element <var>embedder</var>, return the <a href="https://triple-underscore.github.io/infra-ja.html#set-union" id="sandboxing:set-union" data-x-internal="set-union">union</a> of the flags that are present in the following <a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-6">sandboxing flag sets</a>:</p>

  <ul><li><p><var>embedder</var>がnullである場合：<var>browsing context</var>の<a href="#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set-2">ポップアップサンドボックス化フラグセット</a>のフラグセット。<li><p><var>embedder</var>が要素である場合：<var>embedder</var>の<a href="#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set-2"><code>iframe</code>サンドボックス化フラグセット</a>のフラグセット。<li><p><var>embedder</var>が要素である場合：<var>embedder</var>の<a id="sandboxing:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">ノード文書</a>の<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-3">アクティブなサンドボックス化フラグセット</a>のフラグセット。</ul>

  <p>作成後、<a href="browsers.html#concept-document-bc" id="sandboxing:concept-document-bc-2">ブラウジングコンテキスト</a><var>browsing context</var>の<dfn id="concept-bc-sandboxing-flags">サンドボックス化フラグ</dfn>は、<var>browsing context</var>および<var>browsing context</var>の<a href="browsers.html#bc-container" id="sandboxing:bc-container">コンテナー</a>に与えられた<a href="#determining-the-creation-sandboxing-flags" id="sandboxing:determining-the-creation-sandboxing-flags">作成サンドボックス化フラグを決定した</a>結果となる。<h3 id="cross-origin-opener-policies"><span class="secno">7.5</span> 生成元をまたいだオープナーポリシー<a href="#cross-origin-opener-policies" class="self-link"></a></h3>

  <p>A <dfn id="cross-origin-opener-policy-value">cross-origin opener policy value</dfn> allows a document which is navigated to in a <a id="cross-origin-opener-policies:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a> to force the creation of a new <a id="cross-origin-opener-policies:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a>, and a corresponding <a href="browsers.html#tlbc-group" id="cross-origin-opener-policies:tlbc-group">group</a>. 可能な値は次のとおり：</p>

  <dl><dt>"<dfn id="coop-unsafe-none"><code>unsafe-none</code></dfn>"<dd><p>これは（現在の）デフォルトであり、文書が別の<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy">生成元をまたいだオープナーポリシー</a>を指定しない限り、文書がその前の文書と同じ<a id="cross-origin-opener-policies:top-level-browsing-context-3" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を占有することを意味する。<dt>"<dfn id="coop-same-origin-allow-popups"><code>same-origin-allow-popups</code></dfn>"<dd><p>これは、前の文書が同じ<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy-2">生成元をまたいだオープナーポリシー</a>を指定しており、それらが<span>同一生成元</span>でない限り、文書の新しい<a id="cross-origin-opener-policies:top-level-browsing-context-4" href="browsers.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を強制的に作成する。<dt>"<dfn id="coop-same-origin"><code>same-origin</code></dfn>"<dd><p>これは、"<code id="cross-origin-opener-policies:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>"と同じように動作するが、作成される<a id="cross-origin-opener-policies:auxiliary-browsing-context" href="browsers.html#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>は、同じ<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy-3">生成元をまたいだオープナーポリシー</a>を持つ<span>同一生成元</span>の文書を含める必要があることが追加される。さもなければ、オープナーに非公開で表示される。<dt>"<dfn id="coop-same-origin-plus-coep"><code>same-origin-plus-COEP</code></dfn>"<dd><p>This behaves the same as "<code id="cross-origin-opener-policies:coop-same-origin"><a href="#coop-same-origin">same-origin</a></code>", with the addition that it sets the (new) <a id="cross-origin-opener-policies:top-level-browsing-context-5" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#tlbc-group" id="cross-origin-opener-policies:tlbc-group-2">group</a>'s <span>cross-origin isolation mode</span> to one of "<code>logical</code>" or "<code>concrete</code>".</p>

    <p class="note">"<code id="cross-origin-opener-policies:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>" は、`<code>Cross-Origin-Opener-Policy</code>`ヘッダーで直接設定することはできないが、`<code><span>Cross-Origin-Opener-Policy</span>: <a href="#coop-same-origin" id="cross-origin-opener-policies:coop-same-origin-2">same-origin</a></code>` と`<code><span>Cross-Origin-Embedder-Policy</span>: require-corp</code>`の両方を一緒に設定した組み合わせから生じる。</p>
   </dl>

  <p>A <dfn id="cross-origin-opener-policy">cross-origin opener policy</dfn> consists of:</p>

  <ul><li><p>A <dfn id="coop-struct-value">value</dfn>, which is a <a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value">cross-origin opener policy value</a>, initially "<code id="cross-origin-opener-policies:coop-unsafe-none"><a href="#coop-unsafe-none">unsafe-none</a></code>".<li><p>A <dfn id="coop-struct-report-endpoint">reporting endpoint</dfn>, which is string or null, initially null.<li><p>A <dfn id="coop-struct-report-only-value">report-only value</dfn>, which is a <a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-2">cross-origin opener policy value</a>, initially "<code id="cross-origin-opener-policies:coop-unsafe-none-2"><a href="#coop-unsafe-none">unsafe-none</a></code>".<li><p>A <dfn id="coop-struct-report-only-endpoint">report-only reporting endpoint</dfn>, which is a string or null, initially null.</ul>

  <p>To <dfn id="matching-coop">match cross-origin opener policy values</dfn>, given a <a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-3">cross-origin opener policy value</a> <var>A</var>, an <a href="#concept-origin" id="cross-origin-opener-policies:concept-origin">origin</a> <var>originA</var>, a <a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-4">cross-origin opener policy value</a> <var>B</var>, and an <a href="#concept-origin" id="cross-origin-opener-policies:concept-origin-2">origin</a> <var>originB</var>:</p>

  <ol><li><p><var>A</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-3"><a href="#coop-unsafe-none">unsafe-none</a></code>"かつ<var>B</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-4"><a href="#coop-unsafe-none">unsafe-none</a></code>"である場合、trueを返す。<li><p><var>A</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-5"><a href="#coop-unsafe-none">unsafe-none</a></code>"または<var>B</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-6"><a href="#coop-unsafe-none">unsafe-none</a></code>"である場合、falseを返す。<li><p><var>A</var>が<var>B</var>であり、かつ<var>originA</var>が"<var>originB</var>をもつ<span>同一生成元</span>である場合、trueを返す。<li><p>falseを返す。</ol>

  <h4 id="the-headers"><span class="secno">7.5.1</span> ヘッダー<a href="#the-headers" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy" title="The HTTP Cross-Origin-Opener-Policy (COOP) response header allows you to ensure a top-level document does not share a browsing context group with cross-origin documents.">Headers/Cross-Origin-Opener-Policy</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>79+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>83+</span></span><hr><span class="opera no"><span>Opera</span><span>No</span></span><span class="edge_blink yes"><span>Edge</span><span>83+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>79+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>83+</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div>

  <p><code>Document</code>の<a href="dom.html#concept-document-coop" id="the-headers:concept-document-coop">生成元をまたいだオープナーポリシー</a>は `<code>Cross-Origin-Opener-Policy</code>`および`<code>Cross-Origin-Opener-Policy-Report-Only</code>` HTTPレスポンスヘッダーから派生する。このヘッダーは<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html" id="the-headers:http-structured-header" data-x-internal="http-structured-header">構造化されたヘッダー</a>であり、その値は<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#token" id="the-headers:http-structured-header-token" data-x-internal="http-structured-header-token">トークン</a>でなければならない。<a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a></p>

  <p>妥当な<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#token" id="the-headers:http-structured-header-token-2" data-x-internal="http-structured-header-token">トークン</a>の値は、<a href="#cross-origin-opener-policy-value" id="the-headers:cross-origin-opener-policy-value">オープナーポリシー値</a>である。トークンはまた、付属の<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#param" id="the-headers:http-structured-header-parameters" data-x-internal="http-structured-header-parameters">パラメーター</a>を持ってもよい。これらのうち、"<dfn id="coop-report-to"><code>report-to</code></dfn>"パラメーターは、適切な報告エンドポイントを識別する<a id="the-headers:valid-url-string" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">妥当なURL文字列</a>を持つことができる。<a href="references.html#refsREPORTING">[REPORTING]</a></p>

  <p class="note">以下に説明する処理モデルに従って、ユーザーエージェントは、このヘッダーに不正値が含まれている場合、そのヘッダーを無視する。同様に、値が<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#token" id="the-headers:http-structured-header-token-3" data-x-internal="http-structured-header-token">トークン</a>として解析できない場合、ユーザーエージェントはこのヘッダーを無視する。</p>

  <hr>

  <p>To <dfn id="obtain-coop">obtain a cross-origin opener policy</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-headers:concept-response" data-x-internal="concept-response">response</a> <var>response</var> and an <span>environment</span> <var>reservedEnvironment</var>:</p>

  <ol><li><p>Let <var>policy</var> be a new <a href="#cross-origin-opener-policy" id="the-headers:cross-origin-opener-policy">cross-origin opener policy</a>.<li><p>If <var>reservedEnvironment</var> is a <span>non-secure context</span>, then return <var>policy</var>.<li><p>Let <var>value</var> be the result of <a id="the-headers:getting-a-structured-field-value" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> given `<code>Cross-Origin-Opener-Policy</code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-headers:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is not null, then:</p>

    <ol><li><p>If <var>parsedItem</var>[0] is "<code id="the-headers:coop-same-origin"><a href="#coop-same-origin">same-origin</a></code>", then:</p>

      <ol><li><p>Let <var>coep</var> be the result of <a href="#obtain-an-embedder-policy" id="the-headers:obtain-an-embedder-policy">obtaining a cross-origin embedder policy</a> from <var>response</var> and <var>reservedEnvironment</var>.<li><p>If <var>coep</var>'s <a href="#embedder-policy-value-2" id="the-headers:embedder-policy-value-2">value</a> is "<code id="the-headers:coep-require-corp"><a href="#coep-require-corp">require-corp</a></code>", then set <var>policy</var>'s <a href="#coop-struct-value" id="the-headers:coop-struct-value">value</a> to "<code id="the-headers:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>".<li><p>Otherwise, set <var>policy</var>'s <a href="#coop-struct-value" id="the-headers:coop-struct-value-2">value</a> to "<code id="the-headers:coop-same-origin-2"><a href="#coop-same-origin">same-origin</a></code>".</ol>
     <li><p>If <var>parsedItem</var>[0] is "<code id="the-headers:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>", then set <var>policy</var>'s <a href="#coop-struct-value" id="the-headers:coop-struct-value-3">value</a> to "<code id="the-headers:coop-same-origin-allow-popups-2"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-headers:coop-report-to"><a href="#coop-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-headers:map-exists" data-x-internal="map-exists">exists</a> and it is a string, then set <var>policy</var>'s <a href="#coop-struct-report-endpoint" id="the-headers:coop-struct-report-endpoint">reporting endpoint</a> to <var>parsedItem</var>[1]["<code id="the-headers:coop-report-to-2"><a href="#coop-report-to">report-to</a></code>"].</ol>
   <li><p>Set <var>parsedItem</var> to the result of <a id="the-headers:getting-a-structured-field-value-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> given `<code>Cross-Origin-Opener-Policy-Report-Only</code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-headers:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is not null, then:</p>

    <ol><li><p>If <var>parsedItem</var>[0] is "<code id="the-headers:coop-same-origin-3"><a href="#coop-same-origin">same-origin</a></code>", then:</p>

      <ol><li><p>Let <var>coep</var> be the result of <a href="#obtain-an-embedder-policy" id="the-headers:obtain-an-embedder-policy-2">obtaining a cross-origin embedder policy</a> from <var>response</var> and <var>reservedEnvironment</var>.<li><p>If <var>coep</var>'s <a href="#embedder-policy-value-2" id="the-headers:embedder-policy-value-2-2">value</a> is "<code id="the-headers:coep-require-corp-2"><a href="#coep-require-corp">require-corp</a></code>" or <var>coep</var>'s <a href="#embedder-policy-report-only-value" id="the-headers:embedder-policy-report-only-value">report-only value</a> is "<code id="the-headers:coep-require-corp-3"><a href="#coep-require-corp">require-corp</a></code>", then set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-headers:coop-struct-report-only-value">report-only value</a> to "<code id="the-headers:coop-same-origin-plus-coep-2"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>".</p>

        <p class="note">Report only COOP also considers report-only COEP to assign the special "<code id="the-headers:coop-same-origin-plus-coep-3"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>" value. This allows developers more freedom in the order of deployment of COOP and COEP.</p>
       <li><p>Otherwise, set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-headers:coop-struct-report-only-value-2">report-only value</a> to "<code id="the-headers:coop-same-origin-4"><a href="#coop-same-origin">same-origin</a></code>".</ol>
     <li><p>If <var>parsedItem</var>[0] is "<code id="the-headers:coop-same-origin-allow-popups-3"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>", then set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-headers:coop-struct-report-only-value-3">report-only value</a> to "<code id="the-headers:coop-same-origin-allow-popups-4"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-headers:coop-report-to-3"><a href="#coop-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-headers:map-exists-2" data-x-internal="map-exists">exists</a> and it is a string, then set <var>policy</var>'s <a href="#coop-struct-report-only-endpoint" id="the-headers:coop-struct-report-only-endpoint">report-only reporting endpoint</a> to <var>parsedItem</var>[1]["<code id="the-headers:coop-report-to-4"><a href="#coop-report-to">report-to</a></code>"].</ol>
   <li><p>Return <var>policy</var>.</ol>


  <h4 id="browsing-context-group-switches-due-to-cross-origin-opener-policy"><span class="secno">7.5.2</span> Browsing context group switches due to cross-origin opener policy<a href="#browsing-context-group-switches-due-to-cross-origin-opener-policy" class="self-link"></a></h4>

  <p>To <dfn id="check-browsing-context-group-switch-coop-value">check if COOP values require a browsing context group switch</dfn>, given a boolean <var>isInitialAboutBlank</var>, two <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin">origins</a> <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and two <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value">cross-origin opener policy values</a> <var>responseCOOPValue</var> and <var>activeDocumentCOOPValue</var>:</p>

  <ol><li><p>If the result of <a href="#matching-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:matching-coop">matching</a> <var>activeDocumentCOOPValue</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOPValue</var>, and <var>responseOrigin</var> is true, return false.<li><p>If all of the following are true:</p>

    <ul class="brief"><li><p><var>isInitialAboutBlank</var>,<li><p><var>activeDocumentCOOPValue</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-2">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>".<li><p><var>responseCOOPValue</var> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-unsafe-none"><a href="#coop-unsafe-none">unsafe-none</a></code>",</ul>

    <p>then return false.</p>
   <li><p>Return true.</p>
  </ol>

  <p>To <dfn id="check-bcg-switch-navigation-report-only">check if enforcing report-only COOP would require a browsing context group switch</dfn>, given a boolean <var>isInitialAboutBlank</var>, two <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-2">origins</a> <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and two <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy">cross-origin opener policies</a> <var>responseCOOP</var> and <var>activeDocumentCOOP</var>:</p>

  <ol><li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value">report-only value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-2">report-only value</a> is false, then return false.</p>

    <p class="note">Matching report-only policies allows a website to specify the same report-only cross-origin opener policy on all its pages and not receive violation reports for navigations between these pages.</p>
   <li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-2">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-3">value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-3">report-only value</a> is true, then return true.<li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-3">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-4">report-only value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-4">value</a> is true, then return true.<li><p>falseを返す。</ol>

  <p>A <dfn id="coop-enforcement-result">cross-origin opener policy enforcement result</dfn> is a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a> with the following <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:struct-item" data-x-internal="struct-item">items</a>:</p>

  <ul><li><p>A boolean <dfn id="coop-enforcement-bcg-switch">needs a browsing context group switch</dfn>, initially false.<li><p>A boolean <dfn id="coop-enforcement-bcg-switch-report-only">would need a browsing context group switch due to report-only</dfn>, initially false.<li><p>A <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <dfn id="coop-enforcement-url">url</dfn>.<li><p>An <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-3">origin</a> <dfn id="coop-enforcement-origin">current origin</dfn>.<li><p>A <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-2">cross-origin opener policy</a> <dfn id="coop-enforcement-coop">cross-origin opener policy</dfn>.<li><p>A boolean <dfn id="coop-enforcement-source">current context is navigation source</dfn>.</ul>

  <p>To <dfn id="coop-enforce">enforce a response's cross-origin opener policy</dfn>, given a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context" href="browsers.html#browsing-context">browsing context</a> <var>browsingContext</var>, a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>responseURL</var>, an <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-4">origin</a> <var>responseOrigin</var>, a <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-3">cross-origin opener policy</a> <var>responseCOOP</var>, a <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result">cross-origin opener policy enforcement result</a> <var>currentCOOPEnforcementResult</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>Let <var>newCOOPEnforcementResult</var> be a new <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result-2">cross-origin opener policy enforcement result</a> whose <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch">needs a browsing context group switch</a> is <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-2">needs a browsing context group switch</a>, <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only">would need a browsing context group switch due to report-only</a> is <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-2">would need a browsing context group switch due to report-only</a>, <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url">url</a> is <var>responseURL</var>, <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin">origin</a> is <var>responseOrigin</var>, <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop">coop</a> is <var>responseCOOP</var>, and <a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source">current context is navigation source</a> is true.<li><p>Let <var>isInitialAboutBlank</var> be false.<li><p>If <var>browsingContext</var>'s only entry in its <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:session-history" href="history.html#session-history">session history</a> is the <code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:about:blank"><a href="infrastructure.html#about:blank">about:blank</a></code> <code>Document</code> that was added when <var>browsingContext</var> was <span>created</span>, then set <var>isInitialAboutBlank</var> to true.<li><p>If <var>isInitialAboutBlank</var> is true and <var>browsingContext</var>'s <a href="browsers.html#browsing-context-initial-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-initial-url">initial URL</a> is null, set <var>browsingContext</var>'s <a href="browsers.html#browsing-context-initial-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-initial-url-2">initial URL</a> to <var>responseURL</var>.<li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-4">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-2">cross-origin opener policy</a>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-5">value</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-2">origin</a>, <var>responseCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-6">value</a>, and <var>responseOrigin</var> is true, then:</p>

    <ol><li><p>Set <var>newCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-3">needs a browsing context group switch</a> to true.<li><p>If <var>browsingContext</var>'s <a href="browsers.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group">group</a>'s <span>browsing context set</span>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-size" data-x-internal="list-size">size</a> is greater than 1, then:</p>

      <ol><li><p><a href="#coop-violation-navigation-to" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-to">Queue a violation report for browsing context group switch when navigating to a COOP response</a> with <var>responseCOOP</var>, "<code>enforce</code>", <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-2">url</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-3">origin</a>, <var>responseOrigin</var>, and <var>referrer</var>.<li><p><a href="#coop-violation-navigation-from" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-from">Queue a violation report for browsing context group switch when navigating away from a COOP response</a> with <var>activeDocumentCOOP</var>, "<code>enforce</code>", <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-3">url</a>, <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-4">origin</a>, <var>responseOrigin</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source-2">current context is navigation source</a>.</ol>
     </ol>
   <li><p>If the result of <a href="#check-bcg-switch-navigation-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-bcg-switch-navigation-report-only">checking if enforcing report-only COOP would require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-5">origin</a>, <var>responseCOOP</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-3">cross-origin opener policy</a>, is true, then:</p>

    <ol><li><p>Set <var>result</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-3">would need a browsing context group switch due to report-only</a> to true.<li><p>If <var>browsingContext</var>'s <a href="browsers.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group-2">group</a>'s <span>browsing context set</span>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-size-2" data-x-internal="list-size">size</a> is greater than 1, then:</p>

      <ol><li><p><a href="#coop-violation-navigation-to" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-to-2">Queue a violation report for browsing context group switch when navigating to a COOP response</a> with <var>responseCOOP</var>, "<code>reporting</code>", <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-4">url</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-6">origin</a>, <var>responseOrigin</var>, and <var>referrer</var>.<li><p><a href="#coop-violation-navigation-from" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-from-2">Queue a violation report for browsing context group switch when navigating away from a COOP response</a> with <var>activeDocumentCOOP</var>, "<code>reporting</code>", <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-5">url</a>, <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-7">origin</a>, <var>responseOrigin</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source-3">current context is navigation source</a>.</ol>
     </ol>
   <li><p>Return <var>newCOOPEnforcementResult</var>.</ol>

  <p>To <dfn id="obtain-browsing-context-navigation">obtain a browsing context to use for a navigation response</dfn>, given a <a href="browsers.html#browsing-context" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-2">browsing contexts</a> <var>browsingContext</var>, a <a href="#sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:sandboxing-flag-set">sandboxing flag set</a> <var>sandboxFlags</var>, a <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-4">cross-origin opener policy</a> <var>navigationCOOP</var>, and a <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result-3">cross-origin opener policy enforcement result</a> <var>coopEnforcementResult</var>:</p>

  <ol><li><p>Assert: <var>browsingContext</var> is a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a>.<li><p>If <var>coopEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-4">needs a browsing context group switch</a> is false, then:</p>

    <ol><li><p>If <var>coopEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-4">would need a browsing context group switch due to report-only</a> is true, set <var>browsing context</var>'s <a href="browsers.html#virtual-browsing-context-group-id" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:virtual-browsing-context-group-id">virtual browsing context group ID</a> to a new unique identifier.<li><p>Return <var>browsingContext</var>.</ol>
   <li><p>Let <var>newBrowsingContext</var> be the result of <span>creating a new top-level browsing context</span>.<li><p>If <var>navigationCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-7">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>", then set <var>newBrowsingContext</var>'s <a href="browsers.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group-3">group</a>'s <span>cross-origin isolation mode</span> to either "<code>logical</code>" or "<code>concrete</code>". The choice of which is <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a>.</p>

    <p class="note">It is difficult on some platforms to provide the security properties required by the <span>cross-origin isolated capability</span>. "<code>concrete</code>" grants access to it and "<code>logical</code>" does not.</p>
   <li><p>If <var>sandboxFlags</var> is not empty, then:</p>
    <ol><li><p>Assert <var>navigationCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-8">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-unsafe-none-2"><a href="#coop-unsafe-none">unsafe-none</a></code>".<li><p>Assert: <var>newBrowsingContext</var>'s <a href="#popup-sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:popup-sandboxing-flag-set">popup sandboxing flag set</a> <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-is-empty" data-x-internal="list-is-empty">is empty</a>.<li><p>Set <var>newBrowsingContext</var>'s <a href="#popup-sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:popup-sandboxing-flag-set-2">popup sandboxing flag set</a> to a <a href="https://triple-underscore.github.io/infra-ja.html#list-clone" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-clone" data-x-internal="list-clone">clone</a> of <var>sandboxFlags</var>.</ol>
   <li><p><span>Discard</span> <var>browsingContext</var>.</p>

    <p class="note">This has no effect on <var>browsingContext</var>'s <a href="browsers.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group-4">group</a>, unless <var>browsingContext</var> was its sole <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a>. In that case, the user agent might delete the <span>browsing context group</span> which no longer contains any <a href="browsers.html#browsing-context" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-3">browsing contexts</a>.</p>
   <li><p>Return <var>newBrowsingContext</var>.</ol>

  <p class="XXX">The impact of swapping browsing context groups following a navigation is not fully defined. It is currently under discussion in <a href="https://github.com/whatwg/html/issues/5350">issue #5350</a>.</p>

  <h4 id="reporting"><span class="secno">7.5.3</span> レポーティング<a href="#reporting" class="self-link"></a></h4>

  <p>An <dfn id="accessor-accessed-relationship">accessor-accessed relationship</dfn> is an enum that describes the relationship between two <a href="browsers.html#browsing-context" id="reporting:browsing-context">browsing contexts</a> between which an access happened. It can take the following values:</p>

  <dl><dt><dfn id="accessor-accessed-opener">accessor is opener</dfn><dd><p>The accessor <a id="reporting:browsing-context-2" href="browsers.html#browsing-context">browsing context</a> or one of its <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context">ancestors</a> is the <a id="reporting:opener-browsing-context" href="browsers.html#opener-browsing-context">opener browsing context</a> of the accessed <a id="reporting:browsing-context-3" href="browsers.html#browsing-context">browsing context</a>'s <a id="reporting:top-level-browsing-context" href="browsers.html#top-level-browsing-context">top-level browsing context</a>.<dt><dfn id="accessor-accessed-openee">accessor is openee</dfn><dd><p>The accessed <a id="reporting:browsing-context-4" href="browsers.html#browsing-context">browsing context</a> or one of its <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-2">ancestors</a> is the <a id="reporting:opener-browsing-context-2" href="browsers.html#opener-browsing-context">opener browsing context</a> of the accessor <a id="reporting:browsing-context-5" href="browsers.html#browsing-context">browsing context</a>'s <a id="reporting:top-level-browsing-context-2" href="browsers.html#top-level-browsing-context">top-level browsing context</a>.<dt><dfn id="accessor-accessed-none">none</dfn><dd><p>There is no opener relationship between the accessor <a id="reporting:browsing-context-6" href="browsers.html#browsing-context">browsing context</a>, the accessor <a id="reporting:browsing-context-7" href="browsers.html#browsing-context">browsing context</a>, or any of their <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-3">ancestors</a>.</dl>

  <p>To <dfn id="coop-check-access-report">check if an access between two browsing contexts should be reported</dfn>, given two <a href="browsers.html#browsing-context" id="reporting:browsing-context-8">browsing contexts</a> <var>accessor</var> and <var>accessed</var>, a JavaScript property name <var>P</var>, and an <span>environment settings object</span> <var>environment</var>:</p>

  <ol><li><p>If <var>P</var> is not a <span>cross-origin accessible window property name</span>, then return.<li><p>If <var>accessor</var>'s <a id="reporting:active-document" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin" data-x-internal="concept-document-origin">origin</a> or any of its <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-4">ancestors</a>' <a id="reporting:active-document-2" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-2" data-x-internal="concept-document-origin">origins</a> are not <span>same origin</span> with <var>accessor</var>'s <a id="reporting:top-level-browsing-context-3" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-3" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-3" data-x-internal="concept-document-origin">origin</a>, or if <var>accessed</var>'s <a id="reporting:active-document-4" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-4" data-x-internal="concept-document-origin">origin</a> or any of its <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-5">ancestors</a>' <a id="reporting:active-document-5" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-5" data-x-internal="concept-document-origin">origins</a> are not <span>same origin</span> with <var>accessed</var>'s <a id="reporting:top-level-browsing-context-4" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-6" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-6" data-x-internal="concept-document-origin">origin</a>, then return.</p>

    <p class="note">This avoids leaking information about cross-origin iframes to a top level frame with cross-origin opener policy reporting</p>
   <li><p>If <var>accessor</var>'s <a id="reporting:top-level-browsing-context-5" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#virtual-browsing-context-group-id" id="reporting:virtual-browsing-context-group-id">virtual browsing context group ID</a> is <var>accessed</var>'s <a id="reporting:top-level-browsing-context-6" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#virtual-browsing-context-group-id" id="reporting:virtual-browsing-context-group-id-2">virtual browsing context group ID</a>, then return.<li><p>Let <var>accessorAccessedRelationship</var> be a new <a href="#accessor-accessed-relationship" id="reporting:accessor-accessed-relationship">accessor-accessed relationship</a> with value <a href="#accessor-accessed-none" id="reporting:accessor-accessed-none">none</a>.<li><p>If <var>accessed</var>'s <a id="reporting:top-level-browsing-context-7" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:opener-browsing-context-3" href="browsers.html#opener-browsing-context">opener browsing context</a> is <var>accessor</var> or an <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-6">ancestor</a> of <var>accessor</var>, then set <var>accessorAccessedRelationship</var> to <a href="#accessor-accessed-opener" id="reporting:accessor-accessed-opener">accessor is opener</a>.<li><p>If <var>accessor</var>'s <a id="reporting:top-level-browsing-context-8" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:opener-browsing-context-4" href="browsers.html#opener-browsing-context">opener browsing context</a> is <var>accessed</var> or an <a href="browsers.html#ancestor-browsing-context" id="reporting:ancestor-browsing-context-7">ancestor</a> of <var>accessed</var>, then set <var>accessorAccessedRelationship</var> to <a href="#accessor-accessed-openee" id="reporting:accessor-accessed-openee">accessor is openee</a>.<li><p><a href="#coop-violation-access" id="reporting:coop-violation-access">Queue violation reports for accesses</a>, given <var>accessorAccessedRelationship</var>, <var>accessor</var>'s <a id="reporting:top-level-browsing-context-9" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-7" href="browsers.html#active-document">active document</a>'s <a href="dom.html#concept-document-coop" id="reporting:concept-document-coop">cross-origin opener policy</a>, <var>accessed</var>'s <a id="reporting:top-level-browsing-context-10" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-8" href="browsers.html#active-document">active document</a>'s <a href="dom.html#concept-document-coop" id="reporting:concept-document-coop-2">cross-origin opener policy</a>, <var>accessor</var>'s <a id="reporting:active-document-9" href="browsers.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="reporting:the-document's-address" data-x-internal="the-document's-address">URL</a>, <var>accessed</var>'s <a id="reporting:active-document-10" href="browsers.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="reporting:the-document's-address-2" data-x-internal="the-document's-address">URL</a>, <var>accessor</var>'s <a id="reporting:top-level-browsing-context-11" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#browsing-context-initial-url" id="reporting:browsing-context-initial-url">initial URL</a>, <var>accessed</var>'s <a id="reporting:top-level-browsing-context-12" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#browsing-context-initial-url" id="reporting:browsing-context-initial-url-2">initial URL</a>, <var>accessor</var>'s <a id="reporting:active-document-11" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-7" data-x-internal="concept-document-origin">origin</a>, <var>accessed</var>'s <a id="reporting:active-document-12" href="browsers.html#active-document">active document</a>'s <a href="https://dom.spec.whatwg.org/#concept-document-origin" id="reporting:concept-document-origin-8" data-x-internal="concept-document-origin">origin</a>, <var>accessor</var>'s <a id="reporting:top-level-browsing-context-13" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#opener-origin-at-creation" id="reporting:opener-origin-at-creation">opener origin at creation</a>, <var>accessed</var>'s <a id="reporting:top-level-browsing-context-14" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a href="browsers.html#opener-origin-at-creation" id="reporting:opener-origin-at-creation-2">opener origin at creation</a>, <var>accessor</var>'s <a id="reporting:top-level-browsing-context-15" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-13" href="browsers.html#active-document">active document</a>'s <a href="dom.html#dom-document-referrer" id="reporting:dom-document-referrer">referrer</a>, <var>accessed</var>'s <a id="reporting:top-level-browsing-context-16" href="browsers.html#top-level-browsing-context">top-level browsing context</a>'s <a id="reporting:active-document-14" href="browsers.html#active-document">active document</a>'s <a href="dom.html#dom-document-referrer" id="reporting:dom-document-referrer-2">referrer</a>, <var>P</var>, and <var>environment</var>.</ol>

  <p>To <dfn id="sanitize-url-report">sanitize a URL to send in a report</dfn> given a <a id="reporting:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>url</var>:</p>

  <ol><li><p>Let <var>sanitizedURL</var> be a copy of <var>url</var>.<li><p><a href="https://triple-underscore.github.io/URL-ja.html#set-the-username" id="reporting:set-the-username" data-x-internal="set-the-username">Set the username</a> given <var>sanitizedURL</var> and the empty string.<li><p><a href="https://triple-underscore.github.io/URL-ja.html#set-the-password" id="reporting:set-the-password" data-x-internal="set-the-password">Set the password</a> given <var>sanitizedURL</var> and the empty string.<li><p>Return the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="reporting:concept-url-serializer" data-x-internal="concept-url-serializer">serialization</a> of <var>sanitizedURL</var> with <a href="https://url.spec.whatwg.org/#url-serializer-exclude-fragment" id="reporting:url-serializer-exclude-fragment" data-x-internal="url-serializer-exclude-fragment"><i>exclude fragment</i></a> set to true.</ol>

  <p>To <dfn id="coop-violation-navigation-to">queue a violation report for browsing context group switch when navigating to a COOP response</dfn> given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy">cross-origin opener policy</a> <var>coop</var>, a string <var>disposition</var>, a <a id="reporting:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>coopURL</var>, a <a id="reporting:url-3" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>previousResponseURL</var>, two <a href="#concept-origin" id="reporting:concept-origin">origins</a> <var>coopOrigin</var> and <var>previousResponseOrigin</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="reporting:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="reporting:coop-struct-value">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value">report-only value</a>.<li><p>Let <var>serializedReferrer</var> be an empty string<li><p>If <var>referrer</var> is a <a id="reporting:url-4" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="reporting:concept-url-serializer-2" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td><var>disposition</var><tr><td>effectivePolicy<td><var>coopValue</var><tr><td>previousResponseURL<td>If <var>coopOrigin</var> and <var>previousResponseOrigin</var> are <span>same origin</span> this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report">sanitization</a> of <var>previousResponseURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>type<td>"<code>navigation-to-response</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-2">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-navigation-from">queue a violation report for browsing context group switch when navigating away from a COOP response</dfn> given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-2">cross-origin opener policy</a> <var>coop</var>, a string <var>disposition</var>, a <a id="reporting:url-5" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>coopURL</var>, a <a id="reporting:url-6" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>nextResponseURL</var>, two <a href="#concept-origin" id="reporting:concept-origin-2">origins</a> <var>coopOrigin</var> and <var>nextResponseOrigin</var>, and a boolean <var>isCOOPResponseNavigationSource</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-3">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="reporting:coop-struct-value-2">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-2">report-only value</a>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td><var>disposition</var><tr><td>effectivePolicy<td><var>coopValue</var><tr><td>nextResponseURL<td>If <var>coopOrigin</var> and <var>nextResponseOrigin</var> are <span>same origin</span> or <var>isCOOPResponseNavigationSource</var> is true, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-2">sanitization</a> of <var>previousResponseURL</var>, null otherwise.<tr><td>type<td>"<code>navigation-to-response</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-2" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-4">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-access">queue violation reports for accesses</dfn>, given an <a href="#accessor-accessed-relationship" id="reporting:accessor-accessed-relationship-2">accessor-accessed relationship</a> <var>accessorAccessedRelationship</var>, two <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-3">cross-origin opener policies</a> <var>accessorCOOP</var> and <var>accessedCOOP</var>, four <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-7" data-x-internal="url">URLs</a> <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorInitialURL</var>, <var>accessedInitialURL</var>, four <a href="#concept-origin" id="reporting:concept-origin-3">origins</a> <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>accessorCreatorOrigin</var> and <var>accessedCreatorOrigin</var>, two <a href="dom.html#dom-document-referrer" id="reporting:dom-document-referrer-3">referrers</a> <var>accessorReferrer</var> and <var>accessedReferrer</var>, a string <var>propertyName</var>, and an <span>environment settings object</span> <var>environment</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-5">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="reporting:coop-struct-value-3">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-3">report-only value</a>.<li><p>If <var>accessorAccessedRelationship</var> is <a href="#accessor-accessed-opener" id="reporting:accessor-accessed-opener-2">accessor is opener</a>:</p>

    <ol><li><p><a href="#coop-violation-access-to-opened" id="reporting:coop-violation-access-to-opened">Queue a violation report for access to an opened window</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessedInitialURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>accessedCreatorOrigin</var>, <var>propertyName</var>, and <var>environment</var>.<li><p><a href="#coop-violation-access-from-opener" id="reporting:coop-violation-access-from-opener">Queue a violation report for access from the opener</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, <var>propertyName</var>, and <var>accessedReferrer</var>.</ol>
   <li><p>Otherwise, if <var>accessorAccessedRelationship</var> is <a href="#accessor-accessed-openee" id="reporting:accessor-accessed-openee-2">accessor is openee</a>:</p>

    <ol><li><p><a href="#coop-violation-access-to-opener" id="reporting:coop-violation-access-to-opener">Queue a violation report for access to the opener</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>propertyName</var>, <var>accessorReferrer</var>, and <var>environment</var>.<li><p><a href="#coop-violation-access-from-opened" id="reporting:coop-violation-access-from-opened">Queue a violation report for access from an opened window</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessorInitialURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, <var>accessorCreatorOrigin</var>, and <var>propertyName</var>.</ol>
   <li><p>Otherwise:</p>

    <ol><li><p><a href="#coop-violation-access-to-opened" id="reporting:coop-violation-access-to-opened-2">Queue a violation report for access to another window</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>propertyName</var>, and <var>environment</var><li><p><a href="#coop-violation-access-from-other" id="reporting:coop-violation-access-from-other">Queue a violation report for access from another window</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, and <var>propertyName</var>.</ol>
   </ol>

  <p>To <dfn id="coop-violation-access-to-opener">queue a violation report for access to the opener</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-4">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-8" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>openerURL</var>, two <a href="#concept-origin" id="reporting:concept-origin-4">origins</a> <var>coopOrigin</var> and <var>openerOrigin</var>, a string <var>propertyName</var>, a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="reporting:concept-request-referrer-2" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>, and an <span>environment settings object</span> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>serializedReferrer</var> be an empty string<li><p>If <var>referrer</var> is a <a id="reporting:url-9" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="reporting:concept-url-serializer-3" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-4">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openerURL<td>If <var>coopOrigin</var> and <var>openerOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-3">sanitization</a> of <var>openerURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-3" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-6">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>

  <p>To <dfn id="coop-violation-access-to-opened">queue a violation report for access to an opened window</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-5">cross-origin opener policy</a> <var>coop</var>, three <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-10" data-x-internal="url">URLs</a> <var>coopURL</var>, <var>openedWindowURL</var> and <var>initialWindowURL</var>, three <a href="#concept-origin" id="reporting:concept-origin-5">origins</a> <var>coopOrigin</var>, <var>openedWindowOrigin</var>, and <var>openerInitialOrigin</var>, a string <var>propertyName</var>, and an <span>environment settings object</span> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-5">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openedWindowURL<td>If <var>coopOrigin</var> and <var>openedWindowOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-4">sanitization</a> of <var>openedWindowURL</var>, null otherwise.<tr><td>openedWindowInitialURL<td>If <var>coopOrigin</var> and <var>openerInitialOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-5">sanitization</a> of <var>initialWindowURL</var>, null otherwise.<tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-4" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-7">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>


  <p>To <dfn id="coop-violation-access-to-other">queue a violation report for access to another window</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-6">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-11" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>otherURL</var>, two <a href="#concept-origin" id="reporting:concept-origin-6">origins</a> <var>coopOrigin</var> and <var>otherOrigin</var>, a string <var>propertyName</var>, and an <span>environment settings object</span> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-6">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>otherURL<td>If <var>coopOrigin</var> and <var>otherOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-6">sanitization</a> of <var>otherURL</var>, null otherwise.<tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-5" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-8">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>

  <p>To <dfn id="coop-violation-access-from-opener">queue a violation report for access from the opener</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-7">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-12" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>openerURL</var>, two <a href="#concept-origin" id="reporting:concept-origin-7">origins</a> <var>coopOrigin</var> and <var>openerOrigin</var>, a string <var>propertyName</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="reporting:concept-request-referrer-3" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-9">reporting endpoint</a> is null, return.<li><p>Let <var>serializedReferrer</var> be an empty string<li><p>If <var>referrer</var> is a <a id="reporting:url-13" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="reporting:concept-url-serializer-4" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-7">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openerURL<td>If <var>coopOrigin</var> and <var>openerOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-7">sanitization</a> of <var>openerURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-6" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-10">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-access-from-opened">queue a violation report for access from an opened window</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-8">cross-origin opener policy</a> <var>coop</var>, three <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-14" data-x-internal="url">URLs</a> <var>coopURL</var>, <var>openedWindowURL</var> and <var>initialWindowURL</var>, three <a href="#concept-origin" id="reporting:concept-origin-8">origins</a> <var>coopOrigin</var>, <var>openedWindowOrigin</var>, and <var>openerInitialOrigin</var>, and a string <var>propertyName</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-11">reporting endpoint</a> is null, return.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coopValue</var><tr><td>property<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-8">report-only value</a><tr><td>openedWindowURL<td>If <var>coopOrigin</var> and <var>openedWindowOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-8">sanitization</a> of <var>openedWindowURL</var>, null otherwise.<tr><td>openedWindowInitialURL<td>If <var>coopOrigin</var> and <var>openerInitialOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-9">sanitization</a> of <var>initialWindowURL</var>, null otherwise.<tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-7" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-12">reporting endpoint</a> with <var>coopURL</var>.</ol>


  <p>To <dfn id="coop-violation-access-from-other">queue a violation report for access from another window</dfn>, given a <a href="#cross-origin-opener-policy" id="reporting:cross-origin-opener-policy-9">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="reporting:url-15" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>otherURL</var>, two <a href="#concept-origin" id="reporting:concept-origin-9">origins</a> <var>coopOrigin</var> and <var>otherOrigin</var>, and a string <var>propertyName</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-13">reporting endpoint</a> is null, return.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="reporting:coop-struct-report-only-value-9">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>otherURL<td>If <var>coopOrigin</var> and <var>otherOrigin</var> are <span>same origin</span>, this is the <a href="#sanitize-url-report" id="reporting:sanitize-url-report-10">sanitization</a> of <var>otherURL</var>, null otherwise.<tr><td>type<td><code>access-to-opener</code></table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="reporting:queue-a-report-8" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="reporting:coop-struct-report-endpoint-14">reporting endpoint</a> with <var>coopURL</var>.</ol>


  <h3 id="coep"><span class="secno">7.6</span> 生成元をまたいだ埋め込みポリシー<a href="#coep" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Embedder-Policy" title="The HTTP Cross-Origin-Embedder-Policy (COEP) response header prevents a document from loading any cross-origin resources that don't explicitly grant the document permission (using CORP or CORS).">Headers/Cross-Origin-Embedder-Policy</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>79+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>83+</span></span><hr><span class="opera no"><span>Opera</span><span>No</span></span><span class="edge_blink yes"><span>Edge</span><span>83+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>79+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>83+</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android no"><span>Samsung Internet</span><span>No</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div>

  <p><dfn id="embedder-policy-value" data-export="">埋め込みポリシー値</dfn>は、リソース所有者から明示的に許可されていない生成元をまたいだリソースの取得を制御する。そのような値は2つある：</p>

  <dl><dt>"<dfn data-dfn-for="embedder policy value" id="coep-unsafe-none" data-export=""><code>unsafe-none</code></dfn>"<dd><p>これはデフォルトの値である。この値を使用するとき、<a id="coep:cors-protocol" href="https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol" data-x-internal="cors-protocol">CORSプロトコル</a>または`<code id="coep:cross-origin-resource-policy"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーを通して明示的な許可を与えることなしに生成元をまたいだリソースをフェッチすることができる。<dt>"<dfn data-dfn-for="embedder policy value" id="coep-require-corp" data-export=""><code>require-corp</code></dfn>"<dd><p>この値を使用するとき、生成元をまたいだリソースをフェッチするには、<a id="coep:cors-protocol-2" href="https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol" data-x-internal="cors-protocol">CORSプロトコル</a>または`<code id="coep:cross-origin-resource-policy-2"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーを通してサーバーの明示的な許可が必要となる。</dl>

  <p><dfn id="embedder-policy" data-export="">埋め込みポリシー</dfn>は次で構成される：</p>

  <ul><li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-value-2" data-export="">値</dfn>。これは<a href="#embedder-policy-value" id="coep:embedder-policy-value">埋め込みポリシー値</a>であり、初期は"<code id="coep:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>"。<li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-reporting-endpoint" data-export="">報告エンドポイント</dfn>文字列。初期は空文字列。<li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-report-only-value" data-export="">報告のみの値</dfn>。これは<a href="#embedder-policy-value" id="coep:embedder-policy-value-2">埋め込みポリシー値</a>であり、初期は"<code id="coep:coep-unsafe-none-2"><a href="#coep-unsafe-none">unsafe-none</a></code>"。<li><p><dfn data-dfn-for="embedder
   policy" id="embedder-policy-report-only-reporting-endpoint" data-export="">報告のみの報告エンドポイント</dfn>文字列。初期は空文字列。</ul>

  <p><dfn id="coep-report-type" data-export="">"<code>coep</code>"報告タイプ</dfn>は、値が"<code>coep</code>"となる<a id="coep:report-type" href="https://triple-underscore.github.io/reporting1-ja.html#report-type" data-x-internal="report-type">報告タイプ</a>である。これは<a id="coep:visible-to-reportingobservers" href="https://triple-underscore.github.io/reporting1-ja.html#visible-to-reportingobservers" data-x-internal="visible-to-reportingobservers"><code>ReportingObserver</code>から可視</a>である。</p>

  <h4 id="the-headers-2"><span class="secno">7.6.1</span> ヘッダー<a href="#the-headers-2" class="self-link"></a></h4>

  <p>`<code>Cross-Origin-Embedder-Policy</code>`および`<code>Cross-Origin-Embedder-Policy-Report-Only</code>` HTTP レスポンスヘッダーフィールドは、サーバーが<span>環境設定オブジェクト</span>の<a href="#embedder-policy" id="the-headers-2:embedder-policy">埋め込みポリシー</a>を宣言することを可能にする。このヘッダーは<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html" id="the-headers-2:http-structured-header" data-x-internal="http-structured-header">構造化されたヘッダー</a>であり、その値は<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#token" id="the-headers-2:http-structured-header-token" data-x-internal="http-structured-header-token">トークン</a>でなければならない。<a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a><p>妥当な<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#token" id="the-headers-2:http-structured-header-token-2" data-x-internal="http-structured-header-token">トークン</a>の値は、<a href="#embedder-policy-value" id="the-headers-2:embedder-policy-value">埋め込みポリシー値</a>である。トークンはまた、付属の<a href="https://httpwg.org/http-extensions/draft-ietf-httpbis-header-structure.html#param" id="the-headers-2:http-structured-header-parameters" data-x-internal="http-structured-header-parameters">パラメーター</a>を持ってもよい。これらのうち、"<dfn id="coep-report-to"><code>report-to</code></dfn>"パラメーターは、適切な報告エンドポイントを識別する<a id="the-headers-2:valid-url-string" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">妥当なURL文字列</a>を持つことができる。<a href="references.html#refsREPORTING">[REPORTING]</a></p>

  <div class="note"><p><a href="#obtain-an-embedder-policy" id="the-headers-2:obtain-an-embedder-policy">処理モデル</a>は、トークンとして解析できないヘッダーの存在下ではオープンに失敗する（デフォルトで"<code id="the-headers-2:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>"）。これには、与えられた応答に存在する`<code>Cross-Origin-Embedder-Policy</code>`ヘッダーの複数のインスタンスを組み合わせて作成された不注意なリストが含まれる。</p>

   <table class="data"><thead><tr><th>`<code>Cross-Origin-Embedder-Policy</code>`<th>最終<a href="#embedder-policy-value" id="the-headers-2:embedder-policy-value-2">埋め込みポリシー値</a><tbody><tr><td><em>No header delivered</em><td>"<code id="the-headers-2:coep-unsafe-none-2"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp</code>`<td>"<code id="the-headers-2:coep-require-corp"><a href="#coep-require-corp">require-corp</a></code>"<tr><td>`<code>unknown-value</code>`<td>"<code id="the-headers-2:coep-unsafe-none-3"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp, unknown-value</code>`<td>"<code id="the-headers-2:coep-unsafe-none-4"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>unknown-value, unknown-value</code>`<td>"<code id="the-headers-2:coep-unsafe-none-5"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>unknown-value, require-corp</code>`<td>"<code id="the-headers-2:coep-unsafe-none-6"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp, require-corp</code>`<td>"<code id="the-headers-2:coep-unsafe-none-7"><a href="#coep-unsafe-none">unsafe-none</a></code>"</table>

   <p>（同じことが`<code>Cross-Origin-Embedder-Policy-Report-Only</code>`にも適用される。）</p>
  </div>

  <hr>

  <p>To <dfn id="obtain-an-embedder-policy" data-export="">obtain an embedder policy</dfn> from a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-headers-2:concept-response" data-x-internal="concept-response">response</a> <var>response</var> and an <span>environment</span> <var>environment</var>:</p>

  <ol><li><p>Let <var>policy</var> be a new <a href="#embedder-policy" id="the-headers-2:embedder-policy-2">embedder policy</a>.<li><p>If <var>environment</var> is a <span>non-secure context</span>, then return <var>policy</var>.<li><p>Let <var>parsedItem</var> be the result of <a id="the-headers-2:getting-a-structured-field-value" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> with `<code>Cross-Origin-Embedder-Policy</code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-headers-2:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is non-null and <var>parsedItem</var>[0] is "<code>require-corp</code>":</p>

    <ol><li><p>Set <var>policy</var>'s <a href="#embedder-policy-value-2" id="the-headers-2:embedder-policy-value-2-2">value</a> to "<code id="the-headers-2:coep-require-corp-2"><a href="#coep-require-corp">require-corp</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-headers-2:coep-report-to"><a href="#coep-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-headers-2:map-exists" data-x-internal="map-exists">exists</a>, then set <var>policy</var>'s <a href="#embedder-policy-reporting-endpoint" id="the-headers-2:embedder-policy-reporting-endpoint">endpoint</a> to <var>parsedItem</var>[1]["<code id="the-headers-2:coep-report-to-2"><a href="#coep-report-to">report-to</a></code>"].</ol>
   <li><p>Set <var>parsedItem</var> to the result of <a id="the-headers-2:getting-a-structured-field-value-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> with `<code>Cross-Origin-Embedder-Policy-Report-Only</code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-headers-2:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is non-null and <var>parsedItem</var>[0] is "<code>require-corp</code>":</p>

    <ol><li><p>Set <var>policy</var>'s <a href="#embedder-policy-report-only-value" id="the-headers-2:embedder-policy-report-only-value">report-only value</a> to "<code id="the-headers-2:coep-require-corp-3"><a href="#coep-require-corp">require-corp</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-headers-2:coep-report-to-3"><a href="#coep-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-headers-2:map-exists-2" data-x-internal="map-exists">exists</a>, then set <var>policy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="the-headers-2:embedder-policy-report-only-reporting-endpoint">report-only reporting endpoint</a> to <var>parsedItem</var>[1]["<code id="the-headers-2:coep-report-to-4"><a href="#coep-report-to">report-to</a></code>"].</ol>
   <li><p>Return <var>policy</var>.</ol>

  <h4 id="embedder-policy-checks"><span class="secno">7.6.2</span> Embedder policy checks<a href="#embedder-policy-checks" class="self-link"></a></h4>

  <p>To <dfn id="check-a-navigation-response's-adherence-to-its-embedder-policy">check a navigation response's adherence to its embedder policy</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response" data-x-internal="concept-response">response</a> <var>response</var>, a <a id="embedder-policy-checks:browsing-context" href="browsers.html#browsing-context">browsing context</a> <var>target</var>, and an <span>environment</span> <var>environment</var>:</p>

  <ol><li><p>If <var>target</var> is not a <a id="embedder-policy-checks:child-browsing-context" href="browsers.html#child-browsing-context">child browsing context</a>, then return true.<li><p>Let <var>responsePolicy</var> be the result of <a href="#obtain-an-embedder-policy" id="embedder-policy-checks:obtain-an-embedder-policy">obtaining an embedder policy</a> from <var>response</var> and <var>environment</var>.<li><p>Let <var>parentPolicy</var> be <var>target</var>'s <a href="browsers.html#bc-container-document" id="embedder-policy-checks:bc-container-document">container document</a>'s <a href="dom.html#concept-document-embedder-policy" id="embedder-policy-checks:concept-document-embedder-policy">embedder policy</a>.<li><p>If <var>parentPolicy</var>'s <a href="#embedder-policy-report-only-value" id="embedder-policy-checks:embedder-policy-report-only-value">report-only value</a> is "<code id="embedder-policy-checks:coep-require-corp"><a href="#coep-require-corp">require-corp</a></code>" and <var>responsePolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2">value</a> is "<code id="embedder-policy-checks:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>", then <a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation">queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>navigation</code>", <var>parentPolicy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="embedder-policy-checks:embedder-policy-report-only-reporting-endpoint">report only reporting endpoint</a>, "<code>reporting</code>", and <var>target</var>'s <a href="browsers.html#bc-container-document" id="embedder-policy-checks:bc-container-document-2">container document</a>'s <span>relevant settings object</span>.<li><p>If <var>parentPolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-2">value</a> is "<code id="embedder-policy-checks:coep-unsafe-none-2"><a href="#coep-unsafe-none">unsafe-none</a></code>" or <var>responsePolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-3">value</a> is "<code id="embedder-policy-checks:coep-require-corp-2"><a href="#coep-require-corp">require-corp</a></code>", then return true.<li><p><a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-2">Queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>navigation</code>", <var>parentPolicy</var>'s <a href="#embedder-policy-reporting-endpoint" id="embedder-policy-checks:embedder-policy-reporting-endpoint">reporting endpoint</a>, "<code>enforce</code>", and <var>target</var>'s <a href="browsers.html#bc-container-document" id="embedder-policy-checks:bc-container-document-3">container document</a>'s <span>relevant settings object</span>.<li><p>falseを返す。</ol>

  <p>To <dfn id="check-a-global-object's-embedder-policy">check a global object's embedder policy</dfn> given a <code id="embedder-policy-checks:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> <var>workerGlobalScope</var>, an <span>environment settings object</span> <var>owner</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response-2" data-x-internal="concept-response">response</a> <var>response</var>:</p>

  <ol><li><p>If <var>workerGlobalScope</var> is not a <code id="embedder-policy-checks:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> object, then return true.<li><p>Let <var>policy</var> be <var>workerGlobalScope</var>'s <span>embedder policy</span>.<li><p>Let <var>ownerPolicy</var> be <var>owner</var>'s <span>embedder policy</span>.<li><p>If <var>ownerPolicy</var>'s <a href="#embedder-policy-report-only-value" id="embedder-policy-checks:embedder-policy-report-only-value-2">report-only value</a> is "<code id="embedder-policy-checks:coep-require-corp-3"><a href="#coep-require-corp">require-corp</a></code>" and <var>policy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-4">value</a> is "<code id="embedder-policy-checks:coep-unsafe-none-3"><a href="#coep-unsafe-none">unsafe-none</a></code>", then <a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-3">queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>worker initialization</code>", <var>owner's policy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="embedder-policy-checks:embedder-policy-report-only-reporting-endpoint-2">report only reporting endpoint</a>, "<code>reporting</code>", and <var>owner</var>.<li><p>If <var>ownerPolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-5">value</a> is "<code id="embedder-policy-checks:coep-unsafe-none-4"><a href="#coep-unsafe-none">unsafe-none</a></code>" or <var>policy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-6">value</a> is "<code id="embedder-policy-checks:coep-require-corp-4"><a href="#coep-require-corp">require-corp</a></code>", then return true.<li><p><a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-4">Queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>worker initialization</code>", <var>owner's policy</var>'s <a href="#embedder-policy-reporting-endpoint" id="embedder-policy-checks:embedder-policy-reporting-endpoint-2">reporting endpoint</a>, "<code>enforce</code>", and <var>owner</var>.<li><p>falseを返す。</ol>

  <p>To <dfn id="queue-a-cross-origin-embedder-policy-inheritance-violation">queue a cross-origin embedder policy inheritance violation</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response-3" data-x-internal="concept-response">response</a> <var>response</var>, a string <var>type</var>, a string <var>endpoint</var>, a string <var>disposition</var>, and an <span>environment settings object</span> <var>settings</var>:</p>

  <ol><li><p>Let <var>serialized</var> be the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#serialize-a-response-url-for-reporting" id="embedder-policy-checks:serialize-a-response-url-for-reporting" data-x-internal="serialize-a-response-url-for-reporting">serializing a response URL for reporting</a> with <var>response</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>type<td><var>type</var><tr><td>blockedURL<td><var>serialized</var><tr><td>disposition<td><var>disposition</var></table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="embedder-policy-checks:queue-a-report" data-x-internal="queue-a-report">Queue</a> <var>body</var> as the <a href="#coep-report-type" id="embedder-policy-checks:coep-report-type">"<code>coep</code>" report type</a> for <var>endpoint</var> on <var>settings</var>.</ol>



  <nav><a href="window-object.html">← 7.2 Windowオブジェクト</a> — <a href="./">目次</a> — <a href="history.html">7.7 セッション履歴およびナビゲーション →</a></nav>

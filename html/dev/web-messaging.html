<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Edition for Web Developers日本語訳</title><meta content="#3c790a" name="theme-color"><meta content="light dark" name="color-scheme"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <script async="" src="./search.js"></script>
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" class="darkmode-aware" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><p id="dev-edition-h2">Edition for Web Developers — Last Updated <span class="pubdate">5 May 2025</span></hgroup>
   

   <div id="search"><input placeholder="Search. Press &apos;/&apos;" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav><ol class="toc"><li><ol><li><a href="web-messaging.html#web-messaging"><span class="secno">9.3</span> 異なる文書間のメッセージング</a><ol><li><a href="web-messaging.html#introduction-11"><span class="secno">9.3.1</span> 導入</a><li><a href="web-messaging.html#security-postmsg"><span class="secno">9.3.2</span> セキュリティ</a><li><a href="web-messaging.html#posting-messages"><span class="secno">9.3.3</span> メッセージのポスト</a></ol><li><a href="web-messaging.html#channel-messaging"><span class="secno">9.4</span> チャンネルメッセージング</a><ol><li><a href="web-messaging.html#introduction-12"><span class="secno">9.4.1</span> 導入</a><ol><li><a href="web-messaging.html#examples-5"><span class="secno">9.4.1.1</span> Examples</a><li><a href="web-messaging.html#ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> Ports as the basis of an object-capability model on the web</a><li><a href="web-messaging.html#ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> Ports as the basis of abstracting out service implementations</a></ol><li><a href="web-messaging.html#message-channels"><span class="secno">9.4.2</span> メッセージチャンネル</a><li><a href="web-messaging.html#properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope"><span class="secno">9.4.3</span> Properties present on <code>MessagePort</code>, <code>Worker</code>, and <code>DedicatedWorkerGlobalScope</code></a><li><a href="web-messaging.html#message-ports"><span class="secno">9.4.4</span> Message ports</a><li><a href="web-messaging.html#ports-and-garbage-collection"><span class="secno">9.4.5</span> Ports and garbage collection</a></ol><li><a href="web-messaging.html#broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> Broadcasting to other browsing contexts</a></ol></ol><h3 id="web-messaging"><span class="secno">9.3</span> <dfn id="crossDocumentMessages">異なる文書間のメッセージング</dfn><a href="#web-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" title="The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.">Window/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>9.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>≤37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div>

  <p>ウェブブラウザーは、セキュリティおよびプライバシー上の理由から、異なるドメインの文書が相互に影響を与えないようにしている。つまり、クロスサイトスクリプティングは許可されてない。</p>

  <p>これは重要なセキュリティ機能であるが、たとえ敵対的でないページであっても、異なるドメインにあるそれらのページの通信を妨げる。このセクションでは、クロスサイトスクリプティング攻撃を可能にしないように設計された、ソースドメインに関係なく文書が相互に通信を可能にするメッセージングシステムを紹介する。</p>

  <p id="fingerprint-postMessage" class="note"><code>postMessage()</code> APIは、<a id="web-messaging:tracking-vector" href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" data-x-internal="tracking-vector">トラッキングベクター</a>として使用できる。</p>


  <h4 id="introduction-11"><span class="secno">9.3.1</span> 導入<a href="#introduction-11" class="self-link"></a></h4>

  

  <div class="example"><p>たとえば、文書Aに文書Bを含む<code id="introduction-11:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素が含まれ、文書Aのスクリプトが文書Bの <code>Window</code>オブジェクトで<code>postMessage()</code>を呼び出す場合、文書Aの<code>Window</code>から発信されたものとしてマークされたメッセージイベントがそのオブジェクトで発生する。文書Aのスクリプトは次のようになる；</p>

   <pre><code class='js'><c- a>var</c-> o <c- o>=</c-> document<c- p>.</c->getElementsByTagName<c- p>(</c-><c- t>'iframe'</c-><c- p>)[</c-><c- mf>0</c-><c- p>];</c->
o<c- p>.</c->contentWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello world'</c-><c- p>,</c-> <c- t>'https://b.example.org/'</c-><c- p>);</c-></code></pre>

   <p>着信イベントのイベントハンドラーを登録するために、スクリプトは<code>addEventListener</code>（または類似のメカニズム）を使用する。たとえば、文書Bのスクリプトは次のようになる：</p>

   <pre><code class='js'>window<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> receiver<c- p>,</c-> <c- kc>false</c-><c- p>);</c->
<c- a>function</c-> receiver<c- p>(</c->e<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->e<c- p>.</c->origin <c- o>==</c-> <c- t>'https://example.com'</c-><c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->e<c- p>.</c->data <c- o>==</c-> <c- t>'Hello world'</c-><c- p>)</c-> <c- p>{</c->
      e<c- p>.</c->source<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello'</c-><c- p>,</c-> e<c- p>.</c->origin<c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      alert<c- p>(</c->e<c- p>.</c->data<c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

   <p>このスクリプトは、ドメインが予想されるドメインであることを最初に確認し、次にメッセージを調べる。メッセージは、ユーザーに表示されるまたは、最初にメッセージを送信した文書にメッセージを送り返すことによって応答される。</p>

  </div>


  <h4 id="security-postmsg"><span class="secno">9.3.2</span> セキュリティ<a href="#security-postmsg" class="self-link"></a></h4>

  

  <p id="security-4" class="warning">このAPIを使用するには、サイトを悪用する悪意のある組織からユーザーを保護するために、特別な注意が必要である。</p>

  <p>著者は、<code id="security-postmsg:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックし、メッセージを受信すると予想されるドメインからのみメッセージが受け入れられるようにすべきである。さもなければ、著者のメッセージ処理コードのバグが悪意のあるサイトによって悪用される可能性がある。</p>

  <p>さらに、<code id="security-postmsg:dom-messageevent-origin-2"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックした後でも、著者は問題のデータが期待されたフォーマットであることもチェックすべきである。さもなければ、イベントのソースがクロスサイトスクリプティングの欠陥を使用して攻撃された場合、 <code>postMessage()</code>メソッドを使用して送信された情報の処理がさらにチェックされないことで、攻撃が受信側に伝播する可能性がある。</p>

  <p>著者は、機密情報を含むメッセージの<var>targetOrigin</var> 引数にワイルドカードキーワード(*)を使用すべきではない。さもなければ、メッセージが意図した受信者にのみ配信されることを保証できなくなる。</p>

  <hr>

  <p>あらゆる生成元からのメッセージを受け入れる著者は、サービス拒否攻撃のリスクを考慮することが奨励される。攻撃者は大量のメッセージを送信する可能性がある。受信ページがコストのかかる計算を実行したり、そのようなメッセージごとにネットワークトラフィックが送信されたりすると、攻撃者のメッセージはサービス拒否攻撃に増幅される可能性がある。著者は、そのような攻撃を非現実的にするために、レート制限（1分あたり特定の数のメッセージのみを受け入れる）を採用することが奨励される。</p>


  



  <h4 id="posting-messages"><span class="secno">9.3.3</span> メッセージのポスト<a href="#posting-messages" class="self-link"></a></h4>

  <dl class="domintro"><dt><code><var>window</var>.<span id="dom-window-postmessage-options">postMessage</span>(<var>message</var> [, <var>options</var> ])</code><dd><p>指定されたウィンドウにメッセージをポストする。メッセージは、ネストされたオブジェクト、配列などの構造化されたオブジェクトにすることができ、JavaScriptの値（文字列、数値、<code id="posting-messages:date"><a data-x-internal="date" href="https://tc39.es/ecma262/#sec-date-objects">Date</a></code>オブジェクトなど）を含めることができ、 <code id="posting-messages:file"><a data-x-internal="file" href="https://triple-underscore.github.io/File_API-ja.html#dfn-file">File</a></code> <code id="posting-messages:blob"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>、<code id="posting-messages:filelist"><a data-x-internal="filelist" href="https://triple-underscore.github.io/File_API-ja.html#filelist-section">FileList</a></code>、<code id="posting-messages:idl-arraybuffer"><a data-x-internal="idl-arraybuffer" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-ArrayBuffer">ArrayBuffer</a></code>オブジェクトなどの特定のデータオブジェクトを含めることができる。</p>

    <p><var>options</var>の<code>transfer</code>メンバーにリストされているオブジェクトは、複製されるだけでなく、転送される。つまり、送信側では使用できなくなる。</p>

    <p>ターゲットの生成元は、<var>options</var>の<code>targetOrigin</code>メンバーを使用して指定できる。指定しない場合、デフォルトの"<code>/</code>"になる。このデフォルトでは、メッセージは生成元が同じターゲットだけに制限される。</p>

    <p>ターゲットウィンドウの生成元が指定されたターゲットの生成元とマッチしない場合、情報の漏洩を避けるためにメッセージは破棄される。生成元に関係なく宛先にメッセージを送信するには、ターゲットの生成元を"<code>*</code>"に設定する。</p>

    <p><var>transfer</var>配列に重複するオブジェクトが含まれている場合、または<var>message</var>をクローンできなかった場合、<a id="posting-messages:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="posting-messages:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を投げる。</p>
   <dt><code><var>window</var>.<span>postMessage</span>(<var>message</var>, <var>targetOrigin</var> [, <var>transfer</var> ])</code><dd><p>これは<code id="posting-messages:dom-window-postmessage-options"><a href="#dom-window-postmessage-options">postMessage()</a></code>の代替バージョンで、ターゲットの生成元がパラメータとして指定される。<code>window.postMessage(message, target, transfer)</code>の呼び出しは、<code>window.postMessage(message, {targetOrigin, transfer})</code>と同じである。</dl>

  <p class="note">新しい<code>Document</code>にナビゲートされたばかりの<a id="posting-messages:browsing-context" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>の<code>Window</code>にメッセージを投稿するとき、メッセージが意図した受信者を受信しない可能性がある。ターゲット<a id="posting-messages:browsing-context-2" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>のスクリプトには、メッセージのリスナーを設定する時間が必要である。したがって、たとえば、メッセージが新しく作成された子<code id="posting-messages:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>の<code>Window</code>に送信される状況では、著者は、子<code>Document</code>にメッセージを受信する準備ができていることを知らせるメッセージを親に投稿させ、親がこのメッセージを待ってからメッセージの投稿を開始するようにアドバイスされる。</p>

  




  <h3 id="channel-messaging"><span class="secno">9.4</span> <dfn>チャンネルメッセージング</dfn><a href="#channel-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two IFrames, or the main document and an IFrame, two documents via a SharedWorker, or two workers) to communicate directly, passing messages between one another through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API/Using_channel_messaging" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two &lt;iframe> elements, the main document and a single &lt;iframe>, or two documents via a SharedWorker) to communicate directly, passing messages between each other through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API/Using_channel_messaging</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <h4 id="introduction-12"><span class="secno">9.4.1</span> 導入<a href="#introduction-12" class="self-link"></a></h4>

  

  <p>独立したコード部分（たとえば、異なる<a href="document-sequences.html#browsing-context" id="introduction-12:browsing-context">ブラウジングコンテキスト</a>で実行される )が直接通信できるようにするために、著者は<a href="#channel-messaging" id="introduction-12:channel-messaging">チャンネルメッセージング</a>を使用することができる。</p>

  <p>このメカニズムの通信チャンネルは、両端にポートを持つ双方向パイプとして実装される。一方のポートで送信されたメッセージはもう一方のポートに配信され、その逆も同様である。メッセージはDOMイベントとして配信され、実行<span>タスク</span>を中断したりブロックしたりすることはない。</p>

  <p>接続（2つの"もつれた"ポート）を作成するには、<code>MessageChannel()</code>コンストラクターを呼び出す：</p>

  <pre><code class='js'><c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c-></code></pre>

  <p>ポートの1つはローカルポートとして保持され、もう1つのポートはリモートコードに送信される。たとえば、<code>postMessage()</code>を使用する：</p>

  <pre><code class='js'>otherWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'https://example.com'</c-><c- p>,</c-> <c- p>[</c->channel<c- p>.</c->port2<c- p>]);</c-></code></pre>

  <p>メッセージを送信するには、ポートの<code id="introduction-12:dom-messageport-postmessage"><a href="#dom-messageport-postmessage">postMessage()</a></code>メソッドを使用する：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>);</c-></code></pre>

  <p>メッセージを受信するには、<code id="introduction-12:event-message"><a href="indices.html#event-message">message</a></code>イベントをリッスンする：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->onmessage <c- o>=</c-> handleMessage<c- p>;</c->
<c- a>function</c-> handleMessage<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- c1>// message is in event.data</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  <p>ポートで送信されるデータは構造化データである可能性がある。たとえば、ここでは文字列の配列が<code>MessagePort</code>で渡される：</p>

  <pre><code class='js'>port1<c- p>.</c->postMessage<c- p>([</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'world'</c-><c- p>]);</c-></code></pre>


  <h5 id="examples-5"><span class="secno">9.4.1.1</span> Examples<a href="#examples-5" class="self-link"></a></h5>

  

  <div class="example"><p>In this example, two JavaScript libraries are connected to each other using <code>MessagePort</code>s. This allows the libraries to later be hosted in different frames, or in <code id="examples-5:worker"><a href="workers.html#worker">Worker</a></code> objects, without any change to the APIs.</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"contacts.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a contacts object --></c->
<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"compose-mail.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a composer object --></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c->
 composer<c- p>.</c->addContactsProvider<c- p>(</c->channel<c- p>.</c->port1<c- p>);</c->
 contacts<c- p>.</c->registerConsumer<c- p>(</c->channel<c- p>.</c->port2<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>Here's what the "addContactsProvider()" function's implementation could look like:</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>switch</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType<c- p>)</c-> <c- p>{</c->
      <c- k>case</c-> <c- t>'search-result'</c-><c- o>:</c-> handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-done'</c-><c- o>:</c-> handleSearchDone<c- p>();</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-error'</c-><c- o>:</c-> handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- c1>// ...</c->
    <c- p>}</c->
  <c- p>};</c->
<c- p>};</c-></code></pre>

   <p>Alternatively, it could be implemented as follows:</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-result'</c-><c- p>)</c->
      handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-done'</c-><c- p>)</c->
      handleSearchDone<c- p>();</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-error'</c-><c- p>)</c->
      handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c->
  <c- p>});</c->
  <c- c1>// ...</c->
  port<c- p>.</c->start<c- p>();</c->
<c- p>};</c-></code></pre>

   <p>The key difference is that when using <code id="examples-5:dom-eventtarget-addeventlistener"><a data-x-internal="dom-eventtarget-addeventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener">addEventListener()</a></code>, the <code id="examples-5:dom-messageport-start"><a href="#dom-messageport-start">start()</a></code> method must also be invoked. When using <code id="examples-5:handler-messageeventtarget-onmessage"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>, the call to <code id="examples-5:dom-messageport-start-2"><a href="#dom-messageport-start">start()</a></code> is implied.</p>

   <p>The <code id="examples-5:dom-messageport-start-3"><a href="#dom-messageport-start">start()</a></code> method, whether called explicitly or implicitly (by setting <code id="examples-5:handler-messageeventtarget-onmessage-2"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>), starts the flow of messages: messages posted on message ports are initially paused, so that they don't get dropped on the floor before the script has had a chance to set up its handlers.</p>

  </div>


  <h5 id="ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> Ports as the basis of an object-capability model on the web<a href="#ports-as-the-basis-of-an-object-capability-model-on-the-web" class="self-link"></a></h5>

  

  <p>Ports can be viewed as a way to expose limited capabilities (in the object-capability model sense) to other actors in the system. This can either be a weak capability system, where the ports are merely used as a convenient model within a particular origin, or as a strong capability model, where they are provided by one origin <var>provider</var> as the only mechanism by which another origin <var>consumer</var> can effect change in or obtain information from <var>provider</var>.</p>

  <p>For example, consider a situation in which a social web site embeds in one <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> the user's email contacts provider (an address book site, from a second origin), and in a second <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> a game (from a third origin). The outer social site and the game in the second <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-3"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> cannot access anything inside the first <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-4"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>; together they can only:</p>

  <ul><li><p><a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:navigate" href="browsing-the-web.html#navigate">Navigate</a> the <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-5"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> to a new <a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, such as the same <a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> but with a different <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="ports-as-the-basis-of-an-object-capability-model-on-the-web:concept-url-fragment" data-x-internal="concept-url-fragment">fragment</a>, causing the <code>Window</code> in the <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-6"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> to receive a <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-hashchange"><a href="indices.html#event-hashchange">hashchange</a></code> event.<li><p>Resize the <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-7"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>, causing the <code>Window</code> in the <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-8"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> to receive a <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-resize"><a data-x-internal="event-resize" href="https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize">resize</a></code> event.<li><p>Send a <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-message"><a href="indices.html#event-message">message</a></code> event to the <code>Window</code> in the <code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-9"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> using the <code>window.postMessage()</code> API.</ul>

  <p>The contacts provider can use these methods, most particularly the third one, to provide an API that can be accessed by other origins to manipulate the user's address book. For example, it could respond to a message "<code>add-contact Guillaume Tell &lt;tell@pomme.example.net></code>" by adding the given person and email address to the user's address book.</p>

  <p>To avoid any site on the web being able to manipulate the user's contacts, the contacts provider might only allow certain trusted sites, such as the social site, to do this.</p>

  <p>Now suppose the game wanted to add a contact to the user's address book, and that the social site was willing to allow it to do so on its behalf, essentially "sharing" the trust that the contacts provider had with the social site. There are several ways it could do this; most simply, it could just proxy messages between the game site and the contacts site. However, this solution has a number of difficulties: it requires the social site to either completely trust the game site not to abuse the privilege, or it requires that the social site verify each request to make sure it's not a request that it doesn't want to allow (such as adding multiple contacts, reading the contacts, or deleting them); it also requires some additional complexity if there's ever the possibility of multiple games simultaneously trying to interact with the contacts provider.</p>

  <p>Using message channels and <code>MessagePort</code> objects, however, all of these problems can go away. When the game tells the social site that it wants to add a contact, the social site can ask the contacts provider not for it to add a contact, but for the <em>capability</em> to add a single contact. The contacts provider then creates a pair of <code>MessagePort</code> objects, and sends one of them back to the social site, who forwards it on to the game. The game and the contacts provider then have a direct connection, and the contacts provider knows to only honor a single "add contact" request, nothing else. In other words, the game has been granted the capability to add a single contact.</p>


  <h5 id="ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> Ports as the basis of abstracting out service implementations<a href="#ports-as-the-basis-of-abstracting-out-service-implementations" class="self-link"></a></h5>

  

  <p>Continuing the example from the previous section, consider the contacts provider in particular. While an initial implementation might have simply used <code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code> objects in the service's <code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>, an evolution of the service might instead want to use a <a href="workers.html#sharedworker" id="ports-as-the-basis-of-abstracting-out-service-implementations:sharedworker">shared worker</a> with a single <code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code> connection.</p>

  <p>If the initial design used <code>MessagePort</code> objects to grant capabilities, or even just to allow multiple simultaneous independent sessions, the service implementation can switch from the <code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest-2"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>s-in-each-<code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code> model to the shared-<code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code> model without changing the API at all: the ports on the service provider side can all be forwarded to the shared worker without it affecting the users of the API in the slightest.</p>



  <h4 id="message-channels"><span class="secno">9.4.2</span> メッセージチャンネル<a href="#message-channels" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel" title="The MessageChannel interface of the Channel Messaging API allows us to create a new message channel and send data through it via its two MessagePort properties.">MessageChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  

  <dl class="domintro"><dt><code><var>channel</var> = new <span id="dom-messagechannel">MessageChannel</span>()</code><dd><p>2つの新しい<code>MessagePort</code>オブジェクトをもつ新しい<code>MessageChannel</code>オブジェクトを返す。</p>
   <dt><code><var>channel</var>.<span id="dom-messagechannel-port1">port1</span></code><dd><p>1つ目の<code>MessagePort</code>オブジェクトを返す。<dt><code><var>channel</var>.<span id="dom-messagechannel-port2">port2</span></code><dd><p>2つ目の<code>MessagePort</code>オブジェクトを返す。</dl>

  

  
  <h4 id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope"><span class="secno">9.4.3</span> Properties present on <code>MessagePort</code>, <code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:worker"><a href="workers.html#worker">Worker</a></code>, and <code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code><a href="#properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope" class="self-link"></a></h4>

  

   <p>The following are the <a id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handlers" href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <span>event handler event types</span>) supported, as <a id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by <span><code>MessagePort</code>, <code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:worker-2"><a href="workers.html#worker">Worker</a></code>, and <code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> objects</span>:</p>

   <table><thead><tr><th><a href="webappapis.html#event-handlers" id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handlers-2">イベントハンドラー</a><th><span>イベントハンドラーイベント型</span><tbody><tr><td><span id="handler-messageport-onmessage"></span><span id="handler-worker-onmessage"></span><span id="handler-dedicatedworkerglobalscope-onmessage"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessage" data-dfn-type="attribute"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/message_event" title="The message event is fired on a MessagePort object when a message arrives on that channel.">MessagePort/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/message_event" title="The message event is fired on a DedicatedWorkerGlobalScope object when the worker receives a message from its parent (i.e. when the parent sends a message using Worker.postMessage()).">DedicatedWorkerGlobalScope/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div></div><td><code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-message"><a href="indices.html#event-message">message</a></code><tr><td><span id="handler-messageport-onmessageerror"></span><span id="handler-worker-onmessageerror"></span><span id="handler-dedicatedworkerglobalscope-onmessageerror"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessageerror" data-dfn-type="attribute"><code>onmessageerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/messageerror_event" title="The messageerror event is fired on a MessagePort object when it receives a message that can&apos;t be deserialized.">MessagePort/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/messageerror_event" title="The messageerror event is fired on a DedicatedWorkerGlobalScope object when it receives a message that can&apos;t be deserialized.">DedicatedWorkerGlobalScope/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><td><code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code></table>

  <h4 id="message-ports"><span class="secno">9.4.4</span> Message ports<a href="#message-ports" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" title="The MessagePort interface of the Channel Messaging API represents one of the two ports of a MessageChannel, allowing messages to be sent from one port and listening out for them arriving at the other.">MessagePort</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <p>Each channel has two message ports. Data sent through one port is received by the other port, and vice versa.</p>

  

  <dl class="domintro"><dt><code><var>port</var>.<span id="dom-messageport-postmessage">postMessage</span>(<var>message</var> [, <var>transfer</var>])</code><dt><code><var>port</var>.<span id="dom-messageport-postmessage-options">postMessage</span>(<var>message</var> [, { <span>transfer</span> }])</code><dd><p>Posts a message through the channel. Objects listed in <var>transfer</var> are transferred, not just cloned, meaning that they are no longer usable on the sending side.</p>

    <p>Throws a <a id="message-ports:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="message-ports:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> if <var>transfer</var> contains duplicate objects or <var>port</var>, or if <var>message</var> could not be cloned.</p>
   <dt><code><var>port</var>.<span id="dom-messageport-start">start</span>()</code><dd><p>Begins dispatching messages received on the port.<dt><code><var>port</var>.<span id="dom-messageport-close">close</span>()</code><dd><p>Disconnects the port, so that it is no longer active.</dl>

  


  <h4 id="ports-and-garbage-collection"><span class="secno">9.4.5</span> Ports and garbage collection<a href="#ports-and-garbage-collection" class="self-link"></a></h4>

  

  <p class="note">Authors are strongly encouraged to explicitly close <code>MessagePort</code> objects to disentangle them, so that their resources can be recollected. Creating many <code>MessagePort</code> objects and discarding them without closing them can lead to high transient memory usage since garbage collection is not necessarily performed promptly, especially for <code>MessagePort</code>s where garbage collection can involve cross-process coordination.</p>



  <h3 id="broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> <dfn>Broadcasting to other browsing contexts</dfn><a href="#broadcasting-to-other-browsing-contexts" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" title="The BroadcastChannel interface represents a named channel that any browsing context of a given origin can subscribe to. It allows communication between different documents (in different windows, tabs, frames or iframes) of the same origin. Messages are broadcasted via a message event fired at all BroadcastChannel objects listening to the channel, except the object that sent the message.">BroadcastChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" title="The Broadcast Channel API allows basic communication between browsing contexts (that is, windows, tabs, frames, or iframes) and workers on the same origin.">Broadcast_Channel_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  <p>Pages on a single <a id="broadcasting-to-other-browsing-contexts:concept-origin" href="browsers.html#concept-origin">origin</a> opened by the same user in the same user agent but in different unrelated <a href="document-sequences.html#browsing-context" id="broadcasting-to-other-browsing-contexts:browsing-context">browsing contexts</a> sometimes need to send notifications to each other, for example "hey, the user logged in over here, check your credentials again".</p>

  <p>For elaborate cases, e.g. to manage locking of shared state, to manage synchronization of resources between a server and multiple local clients, to share a <code id="broadcasting-to-other-browsing-contexts:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code> connection with a remote host, and so forth, <a href="workers.html#sharedworker" id="broadcasting-to-other-browsing-contexts:sharedworker">shared workers</a> are the most appropriate solution.</p>

  <p>For simple cases, though, where a shared worker would be an unreasonable overhead, authors can use the simple channel-based broadcast mechanism described in this section.</p>

  

  <dl class="domintro"><dt><code><var>broadcastChannel</var> = new <span id="dom-broadcastchannel">BroadcastChannel</span>(<var>name</var>)</code><dd><p>Returns a new <code>BroadcastChannel</code> object via which messages for the given channel name can be sent and received.</p>
   <dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-name">name</span></code><dd><p>Returns the channel name (as passed to the constructor).<dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-postmessage">postMessage</span>(<var>message</var>)</code><dd><p>Sends the given message to other <code>BroadcastChannel</code> objects set up for this channel. Messages can be structured objects, e.g. nested objects and arrays.</p>
   <dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-close">close</span>()</code><dd><p>Closes the <code>BroadcastChannel</code> object, opening it up to garbage collection.</dl>

  

  <p class="note">Authors are strongly encouraged to explicitly close <code>BroadcastChannel</code> objects when they are no longer needed, so that they can be garbage collected. Creating many <code>BroadcastChannel</code> objects and discarding them while leaving them with an event listener and without closing them can lead to an apparent memory leak, since the objects will continue to live for as long as they have an event listener (or until their page or worker is closed).</p>

  

  <div class="example"><p>Suppose a page wants to know when the user logs out, even when the user does so from another tab at the same site:</p>

   <pre><code class='js'><c- a>var</c-> authChannel <c- o>=</c-> <c- k>new</c-> BroadcastChannel<c- p>(</c-><c- t>'auth'</c-><c- p>);</c->
authChannel<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'logout'</c-><c- p>)</c->
    showLogout<c- p>();</c->
<c- p>}</c->

<c- a>function</c-> logoutRequested<c- p>()</c-> <c- p>{</c->
  <c- c1>// called when the user asks us to log them out</c->
  doLogout<c- p>();</c->
  showLogout<c- p>();</c->
  authChannel<c- p>.</c->postMessage<c- p>(</c-><c- t>'logout'</c-><c- p>);</c->
<c- p>}</c->

<c- a>function</c-> doLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// actually log the user out (e.g. clearing cookies)</c->
  <c- c1>// ...</c->
<c- p>}</c->

<c- a>function</c-> showLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// update the UI to indicate we're logged out</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  </div>



  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav>

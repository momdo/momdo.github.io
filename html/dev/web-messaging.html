<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Edition for Web Developers日本語訳</title><meta content="#3c790a" name="theme-color"><meta content="light dark" name="color-scheme"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <script async="" src="./search.js"></script>
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" class="darkmode-aware" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="./dev" />HTML: The Living Standard</a></h1><p id="dev-edition-h2">Edition for Web Developers — Last Updated <span class="pubdate">29 May 2025</span></hgroup>
   

   <div id="search"><input placeholder="Search. Press &apos;/&apos;" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav><ol class="toc"><li><ol><li><a href="web-messaging.html#web-messaging"><span class="secno">9.3</span> 異なる文書間のメッセージング</a><ol><li><a href="web-messaging.html#introduction-11"><span class="secno">9.3.1</span> 導入</a><li><a href="web-messaging.html#security-postmsg"><span class="secno">9.3.2</span> セキュリティ</a><li><a href="web-messaging.html#posting-messages"><span class="secno">9.3.3</span> メッセージのポスト</a></ol><li><a href="web-messaging.html#channel-messaging"><span class="secno">9.4</span> チャンネルメッセージング</a><ol><li><a href="web-messaging.html#introduction-12"><span class="secno">9.4.1</span> 導入</a><ol><li><a href="web-messaging.html#examples-5"><span class="secno">9.4.1.1</span> 例</a><li><a href="web-messaging.html#ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> ウェブ上のオブジェクト機能モデルの基礎としてのポート</a><li><a href="web-messaging.html#ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> サービス実装を抽象化する基礎としてのポート</a></ol><li><a href="web-messaging.html#message-channels"><span class="secno">9.4.2</span> メッセージチャンネル</a><li><a href="web-messaging.html#properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope"><span class="secno">9.4.3</span> <code>MessagePort</code>、<code>Worker</code>、および<code>DedicatedWorkerGlobalScope</code>に存在するプロパティ</a><li><a href="web-messaging.html#message-ports"><span class="secno">9.4.4</span> メッセージポート</a><li><a href="web-messaging.html#ports-and-garbage-collection"><span class="secno">9.4.5</span> ポートおよびガベージコレクション</a></ol><li><a href="web-messaging.html#broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> Broadcasting to other browsing contexts</a></ol></ol><h3 id="web-messaging"><span class="secno">9.3</span> <dfn id="crossDocumentMessages">異なる文書間のメッセージング</dfn><a href="#web-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" title="The window.postMessage() method safely enables cross-origin communication between Window objects; e.g., between a page and a pop-up that it spawned, or between a page and an iframe embedded within it.">Window/postMessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>9.5+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>≤37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>10.1+</span></span></div></div></div>

  <p>ウェブブラウザーは、セキュリティおよびプライバシー上の理由から、異なるドメインの文書が相互に影響を与えないようにしている。つまり、クロスサイトスクリプティングは許可されてない。</p>

  <p>これは重要なセキュリティ機能であるが、たとえ敵対的でないページであっても、異なるドメインにあるそれらのページの通信を妨げる。このセクションでは、クロスサイトスクリプティング攻撃を可能にしないように設計された、ソースドメインに関係なく文書が相互に通信を可能にするメッセージングシステムを紹介する。</p>

  <p id="fingerprint-postMessage" class="note"><code>postMessage()</code> APIは、<a id="web-messaging:tracking-vector" href="https://triple-underscore.github.io/infra-ja.html#tracking-vector" data-x-internal="tracking-vector">トラッキングベクター</a>として使用できる。</p>


  <h4 id="introduction-11"><span class="secno">9.3.1</span> 導入<a href="#introduction-11" class="self-link"></a></h4>

  

  <div class="example"><p>たとえば、文書Aに文書Bを含む<code id="introduction-11:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素が含まれ、文書Aのスクリプトが文書Bの <code>Window</code>オブジェクトで<code>postMessage()</code>を呼び出す場合、文書Aの<code>Window</code>から発信されたものとしてマークされたメッセージイベントがそのオブジェクトで発生する。文書Aのスクリプトは次のようになる；</p>

   <pre><code class='js'><c- a>var</c-> o <c- o>=</c-> document<c- p>.</c->getElementsByTagName<c- p>(</c-><c- t>'iframe'</c-><c- p>)[</c-><c- mf>0</c-><c- p>];</c->
o<c- p>.</c->contentWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello world'</c-><c- p>,</c-> <c- t>'https://b.example.org/'</c-><c- p>);</c-></code></pre>

   <p>着信イベントのイベントハンドラーを登録するために、スクリプトは<code>addEventListener</code>（または類似のメカニズム）を使用する。たとえば、文書Bのスクリプトは次のようになる：</p>

   <pre><code class='js'>window<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> receiver<c- p>,</c-> <c- kc>false</c-><c- p>);</c->
<c- a>function</c-> receiver<c- p>(</c->e<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->e<c- p>.</c->origin <c- o>==</c-> <c- t>'https://example.com'</c-><c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->e<c- p>.</c->data <c- o>==</c-> <c- t>'Hello world'</c-><c- p>)</c-> <c- p>{</c->
      e<c- p>.</c->source<c- p>.</c->postMessage<c- p>(</c-><c- t>'Hello'</c-><c- p>,</c-> e<c- p>.</c->origin<c- p>);</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      alert<c- p>(</c->e<c- p>.</c->data<c- p>);</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

   <p>このスクリプトは、ドメインが予想されるドメインであることを最初に確認し、次にメッセージを調べる。メッセージは、ユーザーに表示されるまたは、最初にメッセージを送信した文書にメッセージを送り返すことによって応答される。</p>

  </div>


  <h4 id="security-postmsg"><span class="secno">9.3.2</span> セキュリティ<a href="#security-postmsg" class="self-link"></a></h4>

  

  <p id="security-4" class="warning">このAPIを使用するには、サイトを悪用する悪意のある組織からユーザーを保護するために、特別な注意が必要である。</p>

  <p>著者は、<code id="security-postmsg:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックし、メッセージを受信すると予想されるドメインからのみメッセージが受け入れられるようにすべきである。さもなければ、著者のメッセージ処理コードのバグが悪意のあるサイトによって悪用される可能性がある。</p>

  <p>さらに、<code id="security-postmsg:dom-messageevent-origin-2"><a href="comms.html#dom-messageevent-origin">origin</a></code>属性をチェックした後でも、著者は問題のデータが期待されたフォーマットであることもチェックすべきである。さもなければ、イベントのソースがクロスサイトスクリプティングの欠陥を使用して攻撃された場合、 <code>postMessage()</code>メソッドを使用して送信された情報の処理がさらにチェックされないことで、攻撃が受信側に伝播する可能性がある。</p>

  <p>著者は、機密情報を含むメッセージの<var>targetOrigin</var> 引数にワイルドカードキーワード(*)を使用すべきではない。さもなければ、メッセージが意図した受信者にのみ配信されることを保証できなくなる。</p>

  <hr>

  <p>あらゆる生成元からのメッセージを受け入れる著者は、サービス拒否攻撃のリスクを考慮することが奨励される。攻撃者は大量のメッセージを送信する可能性がある。受信ページがコストのかかる計算を実行したり、そのようなメッセージごとにネットワークトラフィックが送信されたりすると、攻撃者のメッセージはサービス拒否攻撃に増幅される可能性がある。著者は、そのような攻撃を非現実的にするために、レート制限（1分あたり特定の数のメッセージのみを受け入れる）を採用することが奨励される。</p>


  



  <h4 id="posting-messages"><span class="secno">9.3.3</span> メッセージのポスト<a href="#posting-messages" class="self-link"></a></h4>

  <dl class="domintro"><dt><code><var>window</var>.<span id="dom-window-postmessage-options">postMessage</span>(<var>message</var> [, <var>options</var> ])</code><dd><p>指定されたウィンドウにメッセージをポストする。メッセージは、ネストされたオブジェクト、配列などの構造化されたオブジェクトにすることができ、JavaScriptの値（文字列、数値、<code id="posting-messages:date"><a data-x-internal="date" href="https://tc39.es/ecma262/#sec-date-objects">Date</a></code>オブジェクトなど）を含めることができ、 <code id="posting-messages:file"><a data-x-internal="file" href="https://triple-underscore.github.io/File_API-ja.html#dfn-file">File</a></code> <code id="posting-messages:blob"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>、<code id="posting-messages:filelist"><a data-x-internal="filelist" href="https://triple-underscore.github.io/File_API-ja.html#filelist-section">FileList</a></code>、<code id="posting-messages:idl-arraybuffer"><a data-x-internal="idl-arraybuffer" href="https://triple-underscore.github.io/WebIDL-ja.html#idl-ArrayBuffer">ArrayBuffer</a></code>オブジェクトなどの特定のデータオブジェクトを含めることができる。</p>

    <p><var>options</var>の<code>transfer</code>メンバーにリストされているオブジェクトは、複製されるだけでなく、転送される。つまり、送信側では使用できなくなる。</p>

    <p>ターゲットの生成元は、<var>options</var>の<code>targetOrigin</code>メンバーを使用して指定できる。指定しない場合、デフォルトの"<code>/</code>"になる。このデフォルトでは、メッセージは生成元が同じターゲットだけに制限される。</p>

    <p>ターゲットウィンドウの生成元が指定されたターゲットの生成元とマッチしない場合、情報の漏洩を避けるためにメッセージは破棄される。生成元に関係なく宛先にメッセージを送信するには、ターゲットの生成元を"<code>*</code>"に設定する。</p>

    <p><var>transfer</var>配列に重複するオブジェクトが含まれている場合、または<var>message</var>をクローンできなかった場合、<a id="posting-messages:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="posting-messages:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を投げる。</p>
   <dt><code><var>window</var>.<span>postMessage</span>(<var>message</var>, <var>targetOrigin</var> [, <var>transfer</var> ])</code><dd><p>これは<code id="posting-messages:dom-window-postmessage-options"><a href="#dom-window-postmessage-options">postMessage()</a></code>の代替バージョンで、ターゲットの生成元がパラメータとして指定される。<code>window.postMessage(message, target, transfer)</code>の呼び出しは、<code>window.postMessage(message, {targetOrigin, transfer})</code>と同じである。</dl>

  <p class="note">新しい<code>Document</code>にナビゲートされたばかりの<a id="posting-messages:browsing-context" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>の<code>Window</code>にメッセージを投稿するとき、メッセージが意図した受信者を受信しない可能性がある。ターゲット<a id="posting-messages:browsing-context-2" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>のスクリプトには、メッセージのリスナーを設定する時間が必要である。したがって、たとえば、メッセージが新しく作成された子<code id="posting-messages:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>の<code>Window</code>に送信される状況では、著者は、子<code>Document</code>にメッセージを受信する準備ができていることを知らせるメッセージを親に投稿させ、親がこのメッセージを待ってからメッセージの投稿を開始するようにアドバイスされる。</p>

  




  <h3 id="channel-messaging"><span class="secno">9.4</span> <dfn>チャンネルメッセージング</dfn><a href="#channel-messaging" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two IFrames, or the main document and an IFrame, two documents via a SharedWorker, or two workers) to communicate directly, passing messages between one another through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API/Using_channel_messaging" title="The Channel Messaging API allows two separate scripts running in different browsing contexts attached to the same document (e.g., two &lt;iframe> elements, the main document and a single &lt;iframe>, or two documents via a SharedWorker) to communicate directly, passing messages between each other through two-way channels (or pipes) with a port at each end.">Channel_Messaging_API/Using_channel_messaging</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <h4 id="introduction-12"><span class="secno">9.4.1</span> 導入<a href="#introduction-12" class="self-link"></a></h4>

  

  <p>独立したコード部分（たとえば、異なる<a href="document-sequences.html#browsing-context" id="introduction-12:browsing-context">ブラウジングコンテキスト</a>で実行される )が直接通信できるようにするために、著者は<a href="#channel-messaging" id="introduction-12:channel-messaging">チャンネルメッセージング</a>を使用することができる。</p>

  <p>このメカニズムの通信チャンネルは、両端にポートを持つ双方向パイプとして実装される。一方のポートで送信されたメッセージはもう一方のポートに配信され、その逆も同様である。メッセージはDOMイベントとして配信され、実行<span>タスク</span>を中断したりブロックしたりすることはない。</p>

  <p>接続（2つの"もつれた"ポート）を作成するには、<code>MessageChannel()</code>コンストラクターを呼び出す：</p>

  <pre><code class='js'><c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c-></code></pre>

  <p>ポートの1つはローカルポートとして保持され、もう1つのポートはリモートコードに送信される。たとえば、<code>postMessage()</code>を使用する：</p>

  <pre><code class='js'>otherWindow<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'https://example.com'</c-><c- p>,</c-> <c- p>[</c->channel<c- p>.</c->port2<c- p>]);</c-></code></pre>

  <p>メッセージを送信するには、ポートの<code id="introduction-12:dom-messageport-postmessage"><a href="#dom-messageport-postmessage">postMessage()</a></code>メソッドを使用する：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->postMessage<c- p>(</c-><c- t>'hello'</c-><c- p>);</c-></code></pre>

  <p>メッセージを受信するには、<code id="introduction-12:event-message"><a href="indices.html#event-message">message</a></code>イベントをリッスンする：</p>

  <pre><code class='js'>channel<c- p>.</c->port1<c- p>.</c->onmessage <c- o>=</c-> handleMessage<c- p>;</c->
<c- a>function</c-> handleMessage<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- c1>// message is in event.data</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  <p>ポートで送信されるデータは構造化データである可能性がある。たとえば、ここでは文字列の配列が<code>MessagePort</code>で渡される：</p>

  <pre><code class='js'>port1<c- p>.</c->postMessage<c- p>([</c-><c- t>'hello'</c-><c- p>,</c-> <c- t>'world'</c-><c- p>]);</c-></code></pre>


  <h5 id="examples-5"><span class="secno">9.4.1.1</span> 例<a href="#examples-5" class="self-link"></a></h5>

  

  <div class="example"><p>この例では、2つのJavaScriptライブラリが<code>MessagePort</code>を使用して相互に接続されている。これにより、APIを変更することなく、ライブラリを後で別のフレームまたは<code id="examples-5:worker"><a href="workers.html#worker">Worker</a></code>オブジェクトにホストできるようになる。</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"contacts.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a contacts object --></c->
<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"compose-mail.js"</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-> <c- c>&lt;!-- exposes a composer object --></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
 <c- a>var</c-> channel <c- o>=</c-> <c- k>new</c-> MessageChannel<c- p>();</c->
 composer<c- p>.</c->addContactsProvider<c- p>(</c->channel<c- p>.</c->port1<c- p>);</c->
 contacts<c- p>.</c->registerConsumer<c- p>(</c->channel<c- p>.</c->port2<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

   <p>"addContactsProvider()"関数の実装は次のようになる：</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>switch</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType<c- p>)</c-> <c- p>{</c->
      <c- k>case</c-> <c- t>'search-result'</c-><c- o>:</c-> handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-done'</c-><c- o>:</c-> handleSearchDone<c- p>();</c-> <c- k>break</c-><c- p>;</c->
      <c- k>case</c-> <c- t>'search-error'</c-><c- o>:</c-> handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c-> <c- k>break</c-><c- p>;</c->
      <c- c1>// ...</c->
    <c- p>}</c->
  <c- p>};</c->
<c- p>};</c-></code></pre>

   <p>あるいは、次のように実装することもできる：</p>

   <pre><code class='js'><c- a>function</c-> addContactsProvider<c- p>(</c->port<c- p>)</c-> <c- p>{</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-result'</c-><c- p>)</c->
      handleSearchResult<c- p>(</c->event<c- p>.</c->data<c- p>.</c->results<c- p>);</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-done'</c-><c- p>)</c->
      handleSearchDone<c- p>();</c->
  <c- p>});</c->
  port<c- p>.</c->addEventListener<c- p>(</c-><c- t>'message'</c-><c- p>,</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data<c- p>.</c->messageType <c- o>==</c-> <c- t>'search-error'</c-><c- p>)</c->
      handleSearchError<c- p>(</c->event<c- p>.</c->data<c- p>.</c->message<c- p>);</c->
  <c- p>});</c->
  <c- c1>// ...</c->
  port<c- p>.</c->start<c- p>();</c->
<c- p>};</c-></code></pre>

   <p>重要な違いは、<code id="examples-5:dom-eventtarget-addeventlistener"><a data-x-internal="dom-eventtarget-addeventlistener" href="https://triple-underscore.github.io/DOM4-ja.html#dom-eventtarget-addeventlistener">addEventListener()</a></code>を使用する場合、<code id="examples-5:dom-messageport-start"><a href="#dom-messageport-start">start()</a></code>メソッドも呼び出さなければならないことである。<code id="examples-5:handler-messageeventtarget-onmessage"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>を使用する場合、<code id="examples-5:dom-messageport-start-2"><a href="#dom-messageport-start">start()</a></code>メソッドが暗黙的に呼び出される。</p>

   <p><code id="examples-5:dom-messageport-start-3"><a href="#dom-messageport-start">start()</a></code>メソッドは、明示的に呼び出された場合でも、（<code id="examples-5:handler-messageeventtarget-onmessage-2"><a href="#handler-messageeventtarget-onmessage">onmessage</a></code>を設定することで）暗黙的に呼び出された場合でも、メッセージのフローを開始する。メッセージポートにポストされたメッセージは、スクリプトがハンドラーをセットアップする前に破棄されないように、最初は一時停止される。</p>

  </div>


  <h5 id="ports-as-the-basis-of-an-object-capability-model-on-the-web"><span class="secno">9.4.1.2</span> ウェブ上のオブジェクト機能モデルの基礎としてのポート<a href="#ports-as-the-basis-of-an-object-capability-model-on-the-web" class="self-link"></a></h5>

  

  <p>ポートは、システム内の他の行為者に対して、限定された機能（オブジェクト機能モデルの意味で）を公開する手段と捉えることができる。これは、ポートが特定の生成元内での便利なモデルとしてのみ使用される弱い機能システムと、別の生成元の<var>消費者</var>が<var>プロバイダー</var>に変更を加えたり情報を取得したりするための唯一の手段として、ある生成元の<var>プロバイダー</var>によって提供される強い機能モデルのいずれかである。</p>

  <p>たとえば、ソーシャルウェブサイトが、ある<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>にユーザーのメール連絡先プロバイダー（別の生成元のアドレス帳サイト）を埋め込み、別の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>にゲーム（別の生成元のゲーム）を埋め込んでいる状況を考えてみる。外側のソーシャルサイトと2番目の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-3"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内のゲームは、1つ目の<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-4"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内のいかなる機能にもアクセスできない。つまり、これら2つのサイトでできることは次のとおりである：</p>

  <ul><li><p><code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-5"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>を新しい<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>（同じ<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>であるが<a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="ports-as-the-basis-of-an-object-capability-model-on-the-web:concept-url-fragment" data-x-internal="concept-url-fragment">フラグメント</a>が異なるフラグメントなど）に<a id="ports-as-the-basis-of-an-object-capability-model-on-the-web:navigate" href="browsing-the-web.html#navigate">ナビゲート</a>し、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-6"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code>Window</code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-hashchange"><a href="indices.html#event-hashchange">hashchange</a></code>イベントを受信する。<li><p><code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-7"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>のサイズを変更し、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-8"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code>Window</code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-resize"><a data-x-internal="event-resize" href="https://triple-underscore.github.io/cssom-view-ja.html#eventdef-window-resize">resize</a></code>イベントを受信する。<li><p><code>window.postMessage()</code>  APIを使用して、<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:the-iframe-element-9"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>内の<code>Window</code>に<code id="ports-as-the-basis-of-an-object-capability-model-on-the-web:event-message"><a href="indices.html#event-message">message</a></code>イベントを送信する。</ul>

  <p>連絡先プロバイダーはこれらのメソッド、特に3番目のメソッドを使用することで、他の生成元がユーザーのアドレス帳を操作できるAPIを提供できる。たとえば、"<code>add-contact Guillaume Tell &lt;tell@pomme.example.net></code>"というメッセージに応答し、指定された人物およびメールアドレスをユーザーのアドレス帳に追加することができる。</p>

  <p>ウェブ上のどのサイトもユーザーの連絡先を操作できないようにするために、連絡先プロバイダーは、ソーシャルサイトなどの特定の信頼できるサイトのみにこの操作を許可する場合がある。</p>

  <p>さて、ゲームがユーザーのアドレス帳に連絡先を追加したいと考えており、ソーシャルサイトがゲームに代わってその操作を許可し、連絡先プロバイダーがソーシャルサイトと築いていた信頼を「共有」することを望んだとする。これにはいくつかの方法があるが、最も単純な方法は、ゲームサイトと連絡先サイトとの間のメッセージをプロキシすることである。しかし、この解決策にはいくつかの難点がある。ソーシャルサイトは、ゲームサイトが権限を乱用しないことを完全に信頼するか、ソーシャルサイトが各リクエストを検証して、許可したくないリクエスト（複数の連絡先の追加、連絡先の閲覧、削除など）ではないことを確認する必要がある。また、複数のゲームが同時に連絡先プロバイダーとやり取りする可能性がある場合、複雑さが増す。</p>

  <p>しかし、メッセージチャンネルおよび<code>MessagePort</code>オブジェクトを使用すれば、これらの問題はすべて解消する。ゲームがソーシャルサイトに連絡先を追加したいと伝えると、ソーシャルサイトは連絡先プロバイダーに、連絡先を1つ追加するのではなく、1つの連絡先を追加する<em>機能</em>を要求できる。連絡先プロバイダーは<code>MessagePort</code>オブジェクトのペアを作成し、そのうちの1つをソーシャルサイトに送り返し、ソーシャルサイトはそれをゲームに転送する。こうしてゲームと連絡先プロバイダーは直接接続され、連絡先プロバイダーは"連絡先の追加"リクエスト1件のみを承認すればよく、それ以外のリクエストは受け付けない。つまり、ゲームには1つの連絡先を追加する機能が付与されたことになる。</p>


  <h5 id="ports-as-the-basis-of-abstracting-out-service-implementations"><span class="secno">9.4.1.3</span> サービス実装を抽象化する基礎としてのポート<a href="#ports-as-the-basis-of-abstracting-out-service-implementations" class="self-link"></a></h5>

  

  <p>前のセクションからの例に続いて、特に連絡先プロバイダーについて考えてみる。初期の実装では、サービスの<code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>で単に<code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>オブジェクトを使用していたかもしれないが、サービスの進化により、代わりに単一の<code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code>接続で<a href="workers.html#sharedworker" id="ports-as-the-basis-of-abstracting-out-service-implementations:sharedworker">共有ワーカー</a>を使用したい場合がある。</p>

  <p>最初の設計で<code>MessagePort</code>オブジェクトを使用して機能を付与した場合、または単に複数の同時独立セッションを許可した場合でも、サービス実装は、APIをまったく変更することなく、  <code id="ports-as-the-basis-of-abstracting-out-service-implementations:xmlhttprequest-2"><a data-x-internal="xmlhttprequest" href="https://triple-underscore.github.io/XHR-ja.html#xmlhttprequest">XMLHttpRequest</a></code>の各<code id="ports-as-the-basis-of-abstracting-out-service-implementations:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>モデルから共有<code id="ports-as-the-basis-of-abstracting-out-service-implementations:websocket-2-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code>モデルに切り替えることができる。サービスプロバイダー側のポートはすべて、APIのユーザーに少しも影響を与えることなく、共有ワーカーに転送できる。</p>



  <h4 id="message-channels"><span class="secno">9.4.2</span> メッセージチャンネル<a href="#message-channels" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel" title="The MessageChannel interface of the Channel Messaging API allows us to create a new message channel and send data through it via its two MessagePort properties.">MessageChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  

  <dl class="domintro"><dt><code><var>channel</var> = new <span id="dom-messagechannel">MessageChannel</span>()</code><dd><p>2つの新しい<code>MessagePort</code>オブジェクトをもつ新しい<code>MessageChannel</code>オブジェクトを返す。</p>
   <dt><code><var>channel</var>.<span id="dom-messagechannel-port1">port1</span></code><dd><p>1つ目の<code>MessagePort</code>オブジェクトを返す。<dt><code><var>channel</var>.<span id="dom-messagechannel-port2">port2</span></code><dd><p>2つ目の<code>MessagePort</code>オブジェクトを返す。</dl>

  

  
  <h4 id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope"><span class="secno">9.4.3</span> <code>MessagePort</code>、<code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:worker"><a href="workers.html#worker">Worker</a></code>、および<code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>に存在するプロパティ<a href="#properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope" class="self-link"></a></h4>

  

   <p>下記は、<span><code>MessagePort</code>、<code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:worker-2"><a href="workers.html#worker">Worker</a></code>および<code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>オブジェクト</span>によって<a id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">イベントハンドラーIDL属性</a>としてサポートされる<a id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handlers" href="webappapis.html#event-handlers">イベントハンドラー</a>（および対応する<span>イベントハンドラーイベントタイプ</span>）である：</p>

   <table><thead><tr><th><a href="webappapis.html#event-handlers" id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-handlers-2">イベントハンドラー</a><th><span>イベントハンドラーイベント型</span><tbody><tr><td><span id="handler-messageport-onmessage"></span><span id="handler-worker-onmessage"></span><span id="handler-dedicatedworkerglobalscope-onmessage"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessage" data-dfn-type="attribute"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/message_event" title="The message event is fired on a MessagePort object when a message arrives on that channel.">MessagePort/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/message_event" title="The message event is fired on a DedicatedWorkerGlobalScope object when the worker receives a message from its parent (i.e. when the parent sends a message using Worker.postMessage()).">DedicatedWorkerGlobalScope/message_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>3.5+</span></span><span class="safari yes"><span>Safari</span><span>4+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>5+</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11.5+</span></span></div></div></div><td><code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-message"><a href="indices.html#event-message">message</a></code><tr><td><span id="handler-messageport-onmessageerror"></span><span id="handler-worker-onmessageerror"></span><span id="handler-dedicatedworkerglobalscope-onmessageerror"></span><dfn data-dfn-for="MessageEventTarget" id="handler-messageeventtarget-onmessageerror" data-dfn-type="attribute"><code>onmessageerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort/messageerror_event" title="The messageerror event is fired on a MessagePort object when it receives a message that can&apos;t be deserialized.">MessagePort/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/DedicatedWorkerGlobalScope/messageerror_event" title="The messageerror event is fired on a DedicatedWorkerGlobalScope object when it receives a message that can&apos;t be deserialized.">DedicatedWorkerGlobalScope/messageerror_event</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>57+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>60+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>18</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><td><code id="properties-present-on-messageport,-worker,-and-dedicatedworkerglobalscope:event-messageerror"><a href="indices.html#event-messageerror">messageerror</a></code></table>

  <h4 id="message-ports"><span class="secno">9.4.4</span> メッセージポート<a href="#message-ports" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MessagePort" title="The MessagePort interface of the Channel Messaging API represents one of the two ports of a MessageChannel, allowing messages to be sent from one port and listening out for them arriving at the other.">MessagePort</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>41+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>2+</span></span><hr><span class="opera yes"><span>Opera</span><span>10.6+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>11+</span></span></div></div></div>

  <p>各チャネルには2つのメッセージポートがある。一方のポートから送信されたデータはもう一方のポートで受信され、その逆も同様である。</p>

  

  <dl class="domintro"><dt><code><var>port</var>.<span id="dom-messageport-postmessage">postMessage</span>(<var>message</var> [, <var>transfer</var>])</code><dt><code><var>port</var>.<span id="dom-messageport-postmessage-options">postMessage</span>(<var>message</var> [, { <span>transfer</span> }])</code><dd><p>チャンネルを通じてメッセージをポストする。Objects listed in <var>transfer</var>にリストされたオブジェクトは、単に複製されるのではなく転送される。つまり、送信側では使用できなくなる。</p>

    <p><var>transfer</var>が重複するオブジェクトもしくは<var>port</var>を含む場合、または<var>message</var>を複製できなかった場合、<a id="message-ports:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="message-ports:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を投げる。</p>
   <dt><code><var>port</var>.<span id="dom-messageport-start">start</span>()</code><dd><p>ポートで受信したメッセージの発送を開始する。<dt><code><var>port</var>.<span id="dom-messageport-close">close</span>()</code><dd><p>ポートを切断し、アクティブでなくなる。</dl>

  


  <h4 id="ports-and-garbage-collection"><span class="secno">9.4.5</span> ポートおよびガベージコレクション<a href="#ports-and-garbage-collection" class="self-link"></a></h4>

  

  <p class="note">著者は、リソースを再収集できるように、<code>MessagePort</code>オブジェクトを明示的に閉じて、それらを分離することを強く勧める。多くの<code>MessagePort</code>オブジェクトを作成し、それらを閉じずに破棄すると、ガベージコレクションが必ずしも迅速に実行されるとは限らないため、一時的にメモリーの使用率が高くなる可能性がある。特に、ガベージコレクションにプロセス間の調整が含まれる<code>MessagePort</code>の場合はそうなる。</p>



  <h3 id="broadcasting-to-other-browsing-contexts"><span class="secno">9.5</span> <dfn>Broadcasting to other browsing contexts</dfn><a href="#broadcasting-to-other-browsing-contexts" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/BroadcastChannel" title="The BroadcastChannel interface represents a named channel that any browsing context of a given origin can subscribe to. It allows communication between different documents (in different windows, tabs, frames or iframes) of the same origin. Messages are broadcasted via a message event fired at all BroadcastChannel objects listening to the channel, except the object that sent the message.">BroadcastChannel</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" title="The Broadcast Channel API allows basic communication between browsing contexts (that is, windows, tabs, frames, or iframes) and workers on the same origin.">Broadcast_Channel_API</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>38+</span></span><span class="safari yes"><span>Safari</span><span>15.4+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  <p>Pages on a single <a id="broadcasting-to-other-browsing-contexts:concept-origin" href="browsers.html#concept-origin">origin</a> opened by the same user in the same user agent but in different unrelated <a href="document-sequences.html#browsing-context" id="broadcasting-to-other-browsing-contexts:browsing-context">browsing contexts</a> sometimes need to send notifications to each other, for example "hey, the user logged in over here, check your credentials again".</p>

  <p>For elaborate cases, e.g. to manage locking of shared state, to manage synchronization of resources between a server and multiple local clients, to share a <code id="broadcasting-to-other-browsing-contexts:websocket-2"><a data-x-internal="websocket-2" href="https://triple-underscore.github.io/WebSocket-ja.html#websocket">WebSocket</a></code> connection with a remote host, and so forth, <a href="workers.html#sharedworker" id="broadcasting-to-other-browsing-contexts:sharedworker">shared workers</a> are the most appropriate solution.</p>

  <p>For simple cases, though, where a shared worker would be an unreasonable overhead, authors can use the simple channel-based broadcast mechanism described in this section.</p>

  

  <dl class="domintro"><dt><code><var>broadcastChannel</var> = new <span id="dom-broadcastchannel">BroadcastChannel</span>(<var>name</var>)</code><dd><p>Returns a new <code>BroadcastChannel</code> object via which messages for the given channel name can be sent and received.</p>
   <dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-name">name</span></code><dd><p>Returns the channel name (as passed to the constructor).<dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-postmessage">postMessage</span>(<var>message</var>)</code><dd><p>Sends the given message to other <code>BroadcastChannel</code> objects set up for this channel. Messages can be structured objects, e.g. nested objects and arrays.</p>
   <dt><code><var>broadcastChannel</var>.<span id="dom-broadcastchannel-close">close</span>()</code><dd><p>Closes the <code>BroadcastChannel</code> object, opening it up to garbage collection.</dl>

  

  <p class="note">Authors are strongly encouraged to explicitly close <code>BroadcastChannel</code> objects when they are no longer needed, so that they can be garbage collected. Creating many <code>BroadcastChannel</code> objects and discarding them while leaving them with an event listener and without closing them can lead to an apparent memory leak, since the objects will continue to live for as long as they have an event listener (or until their page or worker is closed).</p>

  

  <div class="example"><p>Suppose a page wants to know when the user logs out, even when the user does so from another tab at the same site:</p>

   <pre><code class='js'><c- a>var</c-> authChannel <c- o>=</c-> <c- k>new</c-> BroadcastChannel<c- p>(</c-><c- t>'auth'</c-><c- p>);</c->
authChannel<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'logout'</c-><c- p>)</c->
    showLogout<c- p>();</c->
<c- p>}</c->

<c- a>function</c-> logoutRequested<c- p>()</c-> <c- p>{</c->
  <c- c1>// called when the user asks us to log them out</c->
  doLogout<c- p>();</c->
  showLogout<c- p>();</c->
  authChannel<c- p>.</c->postMessage<c- p>(</c-><c- t>'logout'</c-><c- p>);</c->
<c- p>}</c->

<c- a>function</c-> doLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// actually log the user out (e.g. clearing cookies)</c->
  <c- c1>// ...</c->
<c- p>}</c->

<c- a>function</c-> showLogout<c- p>()</c-> <c- p>{</c->
  <c- c1>// update the UI to indicate we're logged out</c->
  <c- c1>// ...</c->
<c- p>}</c-></code></pre>

  </div>



  <nav><a href="server-sent-events.html">← 9.2 サーバー送信イベント</a> — <a href="./">目次</a> — <a href="workers.html">10 ウェブワーカー →</a></nav>

<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard, Edition for Web Developers</title><meta content="#3c790a" name="theme-color"><meta content="light dark" name="color-scheme"><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/dev/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  <script async="" src="./search.js"></script>
  
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" class="darkmode-aware" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1><a rel="home" href="/dev" />HTML: The Living Standard</a></h1><p id="dev-edition-h2">Edition for Web Developers — Last Updated <span class="pubdate">17 December 2024</span></hgroup>
   

   <div id="search"><input placeholder="Search. Press &apos;/&apos;" autocomplete="off" name="query" id="query" type="search"><ol id="results"></ol>
   </div>
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="canvas.html">← 4.12.5 canvas要素</a> – <a href="./">目次</a> – <a href="semantics-other.html">4.14 専用要素なしの一般的語彙 →</a></nav><ol class="toc"><li><ol><li><a href="custom-elements.html#custom-elements"><span class="secno">4.13</span> Custom elements</a><ol><li><a href="custom-elements.html#custom-elements-intro"><span class="secno">4.13.1</span> Introduction</a><ol><li><a href="custom-elements.html#custom-elements-autonomous-example"><span class="secno">4.13.1.1</span> Creating an autonomous custom element</a><li><a href="custom-elements.html#custom-elements-face-example"><span class="secno">4.13.1.2</span> Creating a form-associated custom element</a><li><a href="custom-elements.html#custom-elements-accessibility-example"><span class="secno">4.13.1.3</span> Creating a custom element with default accessible roles, states, and properties</a><li><a href="custom-elements.html#custom-elements-customized-builtin-example"><span class="secno">4.13.1.4</span> Creating a customized built-in element</a><li><a href="custom-elements.html#custom-elements-autonomous-drawbacks"><span class="secno">4.13.1.5</span> Drawbacks of autonomous custom elements</a><li><a href="custom-elements.html#custom-elements-upgrades-examples"><span class="secno">4.13.1.6</span> Upgrading elements after their creation</a><li><a href="custom-elements.html#exposing-custom-element-states"><span class="secno">4.13.1.7</span> Exposing custom element states</a></ol><li><a href="custom-elements.html#custom-element-conformance"><span class="secno">4.13.2</span> Requirements for custom element constructors and reactions</a><li><a href="custom-elements.html#custom-elements-core-concepts"><span class="secno">4.13.3</span> Core concepts</a><li><a href="custom-elements.html#custom-elements-api"><span class="secno">4.13.4</span> The <code>CustomElementRegistry</code> interface</a><li><a href="custom-elements.html#custom-element-reactions"><span class="secno">4.13.5</span> Custom element reactions</a><li><a href="custom-elements.html#element-internals"><span class="secno">4.13.6</span> Element internals</a><ol><li><a href="custom-elements.html#shadow-root-access"><span class="secno">4.13.6.1</span> Shadow root access</a><li><a href="custom-elements.html#form-associated-custom-elements"><span class="secno">4.13.6.2</span> Form-associated custom elements</a><li><a href="custom-elements.html#accessibility-semantics"><span class="secno">4.13.6.3</span> Accessibility semantics</a><li><a href="custom-elements.html#custom-state-pseudo-class"><span class="secno">4.13.6.4</span> Custom state pseudo-class</a></ol></ol></ol></ol><h3 id="custom-elements"><span class="secno">4.13</span> Custom elements<a href="#custom-elements" class="self-link"></a></h3><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements" title="One of the key features of the Web Components standard is the ability to create custom elements that encapsulate your functionality on an HTML page, rather than having to make do with a long, nested batch of elements that together provide a custom page feature. This article introduces the use of the Custom Elements API.">Using_custom_elements</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  <h4 id="custom-elements-intro"><span class="secno">4.13.1</span> Introduction<a href="#custom-elements-intro" class="self-link"></a></h4>

  

  <p><a href="#custom-element" id="custom-elements-intro:custom-element">カスタム要素</a>は、著者に完全に機能するDOM要素を独自に構築する方法を提供する。スクリプティングなどで事後に追加されたアプリケーション固有の動作とともに、著者は文書内で非標準要素を常に使用することができたが、そのような要素は歴史的に不適合であり、あまり機能しなかった。カスタム要素を<a href="#element-definition" id="custom-elements-intro:element-definition">定義する</a>ことで、著者はパーサーに要素を正しく構成する方法と、そのクラスの要素が変更にどのように反応するかを通知できる。</p>

  <p>カスタム要素は、（カスタム要素の定義のような）低レベルの著者公開拡張ポイントに関して、（HTMLの要素のような）既存のプラットフォーム機能を説明することによって、"プラットフォームを合理化する"ための大きな努力の一部である。今日、HTMLの既存要素の振る舞いを完全に説明することを妨げるカスタム要素（機能的および意味的な要素）の機能には多くの制限があるが、我々は時間の経過とともにこのギャップを縮小したいと思う。</p>

  <h5 id="custom-elements-autonomous-example"><span class="secno">4.13.1.1</span> Creating an autonomous custom element<a href="#custom-elements-autonomous-example" class="self-link"></a></h5>

  

  <p><a href="#autonomous-custom-element" id="custom-elements-autonomous-example:autonomous-custom-element">自律カスタム要素</a>を作成する方法を説明するために、国旗の小さなアイコンのレンダリングをカプセル化するカスタム要素を定義してみよう。私たちの目標は、次のように使用できるようにすることである：</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>flag-icon</c-> <c- e>country</c-><c- o>=</c-><c- s>"nl"</c-><c- p>>&lt;/</c-><c- f>flag-icon</c-><c- p>></c-></code></pre>

  <p>これを行うには、まずカスタム要素のクラスを宣言し、<code>HTMLElement</code>を拡張する：</p>

  <pre><code class='js'><c- a>class</c-> FlagIcon <c- k>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> <c- kc>null</c-><c- p>;</c->
  <c- p>}</c->

  <c- k>static</c-> observedAttributes <c- o>=</c-> <c- p>[</c-><c- u>"country"</c-><c- p>];</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "country" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_countryCode <c- o>=</c-> newValue<c- p>;</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_updateRendering<c- p>();</c->
  <c- p>}</c->

  get country<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->_countryCode<c- p>;</c->
  <c- p>}</c->
  set country<c- p>(</c->v<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"country"</c-><c- p>,</c-> v<c- p>);</c->
  <c- p>}</c->

  _updateRendering<c- p>()</c-> <c- p>{</c->
    <c- c1>// Left as an exercise for the reader. But, you'll probably want to</c->
    <c- c1>// check this.ownerDocument.defaultView to see if we've been</c->
    <c- c1>// inserted into a document with a browsing context, and avoid</c->
    <c- c1>// doing any work if not.</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>次に、要素を定義するために次のクラスを使用して必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"flag-icon"</c-><c- p>,</c-> FlagIcon<c- p>);</c-></code></pre>

  <p>この時点で、上記のコードは動作する。<code>flag-icon</code>タグを見るたびに、パーサーは<code>FlagIcon</code>クラスの新しいインスタンスを作成し、要素の内部状態を設定し、レンダリングを更新するために使用する（適切な場合）、新しい<code>country</code>属性についてコードに伝える。</p>

  <p>DOM APIを使用して<code>flag-icon</code>要素を作成することもできる：</p>

  <pre><code class='js'><c- a>const</c-> flagIcon <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"flag-icon"</c-><c- p>)</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <p>最後に、<a href="#custom-element-constructor" id="custom-elements-autonomous-example:custom-element-constructor">カスタム要素コンストラクタ</a>自体を使用することもできる。つまり、上記のコードは次のコードと同じである：</p>

  <pre><code class='js'><c- a>const</c-> flagIcon <c- o>=</c-> <c- k>new</c-> FlagIcon<c- p>()</c->
flagIcon<c- p>.</c->country <c- o>=</c-> <c- u>"jp"</c->
document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->flagIcon<c- p>)</c-></code></pre>

  <h5 id="custom-elements-face-example"><span class="secno">4.13.1.2</span> Creating a form-associated custom element<a href="#custom-elements-face-example" class="self-link"></a></h5>

  

  <p>Adding a static <code>formAssociated</code> property, with a true value, makes an <a href="#autonomous-custom-element" id="custom-elements-face-example:autonomous-custom-element">autonomous custom element</a> a <a href="#form-associated-custom-element" id="custom-elements-face-example:form-associated-custom-element">form-associated custom element</a>. The <code>ElementInternals</code> interface helps you to implement functions and properties common to form control elements.</p>

  <pre><code class='js'><c- a>class</c-> MyCheckbox <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> formAssociated <c- o>=</c-> <c- kc>true</c-><c- p>;</c->
  <c- k>static</c-> observedAttributes <c- o>=</c-> <c- p>[</c-><c- t>'checked'</c-><c- p>];</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->_onClick<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>));</c->
  <c- p>}</c->

  get form<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->form<c- p>;</c-> <c- p>}</c->
  get name<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'name'</c-><c- p>);</c-> <c- p>}</c->
  get type<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->localName<c- p>;</c-> <c- p>}</c->

  get checked<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->hasAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>);</c-> <c- p>}</c->
  set checked<c- p>(</c->flag<c- p>)</c-> <c- p>{</c-> <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "checked" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->setFormValue<c- p>(</c-><c- k>this</c-><c- p>.</c->checked <c- o>?</c-> <c- t>'on'</c-> <c- o>:</c-> <c- kc>null</c-><c- p>);</c->
  <c- p>}</c->

  _onClick<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->checked <c- o>=</c-> <c- o>!</c-><c- k>this</c-><c- p>.</c->checked<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- t>'my-checkbox'</c-><c- p>,</c-> MyCheckbox<c- p>);</c-></code></pre>

  <p>You can use the custom element <code>my-checkbox</code> like a built-in form-associated element. For example, putting it in <code id="custom-elements-face-example:the-form-element"><a href="forms.html#the-form-element">form</a></code> or <code id="custom-elements-face-example:the-label-element"><a href="forms.html#the-label-element">label</a></code> associates the <code>my-checkbox</code> element with them, and submitting the <code id="custom-elements-face-example:the-form-element-2"><a href="forms.html#the-form-element">form</a></code> will send data provided by <code>my-checkbox</code> implementation.</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>form</c-> <c- e>action</c-><c- o>=</c-><c- s>"..."</c-> <c- e>method</c-><c- o>=</c-><c- s>"..."</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>label</c-><c- p>>&lt;</c-><c- f>my-checkbox</c-> <c- e>name</c-><c- o>=</c-><c- s>"agreed"</c-><c- p>>&lt;/</c-><c- f>my-checkbox</c-><c- p>></c-> I read the agreement.<c- p>&lt;/</c-><c- f>label</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>input</c-> <c- e>type</c-><c- o>=</c-><c- s>"submit"</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>form</c-><c- p>></c->
</code></pre>

  <h5 id="custom-elements-accessibility-example"><span class="secno">4.13.1.3</span> Creating a custom element with default accessible roles, states, and properties<a href="#custom-elements-accessibility-example" class="self-link"></a></h5>

  

  <p>By using the appropriate properties of <code>ElementInternals</code>, your custom element can have default accessibility semantics. The following code expands our form-associated checkbox from the previous section to properly set its default role and checkedness, as viewed by accessibility technology:</p>

  <pre><code class='js'><c- a>class</c-> MyCheckbox <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> formAssociated <c- o>=</c-> <c- kc>true</c-><c- p>;</c->
  <c- k>static</c-> observedAttributes <c- o>=</c-> <c- p>[</c-><c- t>'checked'</c-><c- p>];</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->_onClick<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>));</c->

<mark>    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->role <c- o>=</c-> <c- t>'checkbox'</c-><c- p>;</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaChecked <c- o>=</c-> <c- t>'false'</c-><c- p>;</c-></mark>
  <c- p>}</c->

  get form<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->form<c- p>;</c-> <c- p>}</c->
  get name<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->getAttribute<c- p>(</c-><c- t>'name'</c-><c- p>);</c-> <c- p>}</c->
  get type<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->localName<c- p>;</c-> <c- p>}</c->

  get checked<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->hasAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>);</c-> <c- p>}</c->
  set checked<c- p>(</c->flag<c- p>)</c-> <c- p>{</c-> <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- t>'checked'</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c-> <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "checked" due to observedAttributes</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->setFormValue<c- p>(</c-><c- k>this</c-><c- p>.</c->checked <c- o>?</c-> <c- t>'on'</c-> <c- o>:</c-> <c- kc>null</c-><c- p>);</c->
<mark>    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaChecked <c- o>=</c-> <c- k>this</c-><c- p>.</c->checked<c- p>;</c-></mark>
  <c- p>}</c->

  _onClick<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->checked <c- o>=</c-> <c- o>!</c-><c- k>this</c-><c- p>.</c->checked<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- t>'my-checkbox'</c-><c- p>,</c-> MyCheckbox<c- p>);</c-></code></pre>

  <p>Note that, like for built-in elements, these are only defaults, and can be overridden by the page author using the <code id="custom-elements-accessibility-example:attr-aria-role"><a href="infrastructure.html#attr-aria-role">role</a></code> and <code id="custom-elements-accessibility-example:attr-aria-*"><a href="infrastructure.html#attr-aria-*">aria-*</a></code> attributes:</p>

  <pre class="bad"><code class='html'><c- c>&lt;!-- This markup is non-conforming --></c->
<c- p>&lt;</c-><c- f>input</c-> <c- e>type</c-><c- o>=</c-><c- s>"checkbox"</c-> <c- e>checked</c-> <c- e>role</c-><c- o>=</c-><c- s>"button"</c-> <c- e>aria-checked</c-><c- o>=</c-><c- s>"false"</c-><c- p>></c-></code></pre>

<pre class="bad"><code class='html'><c- c>&lt;!-- This markup is probably not what the custom element author intended --></c->
<c- p>&lt;</c-><c- f>my-checkbox</c-> <c- e>role</c-><c- o>=</c-><c- s>"button"</c-> <c- e>checked</c-> <c- e>aria-checked</c-><c- o>=</c-><c- s>"false"</c-><c- p>></c-></code></pre>

  <p>Custom element authors are encouraged to state what aspects of their accessibility semantics are strong native semantics, i.e., should not be overridden by users of the custom element. In our example, the author of the <code>my-checkbox</code> element would state that its <a id="custom-elements-accessibility-example:role" href="https://w3c.github.io/aria/#dfn-role" data-x-internal="role">role</a> and <code id="custom-elements-accessibility-example:attr-aria-checked"><a data-x-internal="attr-aria-checked" href="https://w3c.github.io/aria/#aria-checked">aria-checked</a></code> values are strong native semantics, thus discouraging code such as the above.</p>

  <h5 id="custom-elements-customized-builtin-example"><span class="secno">4.13.1.4</span> Creating a customized built-in element<a href="#custom-elements-customized-builtin-example" class="self-link"></a></h5>

  

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element">カスタマイズされた組み込み要素</a>は、<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element">自律カスタム要素</a>とはわずかに異なる定義があり、そして大きく異なる使われ方をする、独自の種類の<a href="#custom-element" id="custom-elements-customized-builtin-example:custom-element">カスタム要素</a>である。この要素は、新しいカスタム機能でHTMLの既存要素を拡張することで、HTMLの既存要素由来の動作の再利用を可能にするために存在する。残念なことに、HTML要素の既存の動作の多くが<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-2">自律カスタム要素</a>を純粋に使用して複製できないため、これは重要である。代わりに、<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-2">カスタマイズされた組み込み要素</a>は、既存の要素にカスタム構築動作、ライフサイクルフック、およびプロトタイプチェーンをインストールを可能にし、既存の要素の上にこれらの機能を本質的に"混在"させる。</p>

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-3">カスタマイズされた組み込み要素</a>は、ユーザーエージェントや他のソフトウェアが要素のセマンティクスおよび動作を識別するために要素のローカル名として扱うので、<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-3">自律カスタム要素</a>とは異なる構文を必要とする。つまり、既存の動作の上に構築する<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-4">カスタマイズされた組み込み要素</a>の概念は、元のローカル名を保持する拡張要素に決定的に依存する。</p>

  <p>この例において、<code>plastic-button</code>という<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-5">カスタマイズされた組み込み要素</a>を作成する。これは通常のボタンのように動作するが、クリックするたびにファンシーなアニメーション効果が追加される。今回は<code>HTMLElement</code>の代わりに<code>HTMLButtonElement</code>を拡張するが、前と同じようにクラスを定義することから始める：</p>

  <pre><code class='js'><c- a>class</c-> PlasticButton <c- k>extends</c-> HTMLButtonElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>()</c-> <c- p>=></c-> <c- p>{</c->
      <c- c1>// Draw some fancy animation effects!</c->
    <c- p>});</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>カスタム要素を定義する場合、<code>extends</code>オプションも指定する必要がある：</p>

  <pre><code class='js'>customElements<c- p>.</c->define<c- p>(</c-><c- u>"plastic-button"</c-><c- p>,</c-> PlasticButton<c- p>,</c-> <c- p>{</c-> <c- k>extends</c-><c- o>:</c-> <c- u>"button"</c-> <c- p>});</c-></code></pre>

  <p>一般に、拡張されている要素の名前は、同じインターフェイスを共有する要素（<code>HTMLQuoteElement</code>を共有する<code id="custom-elements-customized-builtin-example:the-q-element"><a href="text-level-semantics.html#the-q-element">q</a></code>と<code id="custom-elements-customized-builtin-example:the-blockquote-element"><a href="grouping-content.html#the-blockquote-element">blockquote</a></code>の両者など）を共有するため、拡張する要素インターフェイスを単に調べるだけでは判断することができない。</p>

  <p>To construct our <a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-6">customized built-in element</a> from parsed HTML source text, we use the <code id="custom-elements-customized-builtin-example:attr-is"><a href="#attr-is">is</a></code> attribute on a <code id="custom-elements-customized-builtin-example:the-button-element"><a href="form-elements.html#the-button-element">button</a></code> element:</p>

  <pre><code class='html'><c- p>&lt;</c-><c- f>button</c-> <c- e>is</c-><c- o>=</c-><c- s>"plastic-button"</c-><c- p>></c->Click Me!<c- p>&lt;/</c-><c- f>button</c-><c- p>></c-></code></pre>

  <p><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-7">カスタマイズされた組み込み要素</a>を<a href="#autonomous-custom-element" id="custom-elements-customized-builtin-example:autonomous-custom-element-4">自律カスタム要素</a>として使用しようとするとうまく<em>いかない</em>。つまり、<code>&lt;plastic-button>Click me?&lt;/plastic-button></code>は特別な動作をしない<code>HTMLElement</code>を作成するだけである。</p>

  <p>プログラムでカスタマイズしたビルトイン要素を作成する必要がある場合、次の<code id="custom-elements-customized-builtin-example:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement()</a></code>の形式を使用することができる：</p>

  <pre><code class='js'><c- a>const</c-> plasticButton <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"button"</c-><c- p>,</c-> <c- p>{</c-> is<c- o>:</c-> <c- u>"plastic-button"</c-> <c- p>});</c->
plasticButton<c- p>.</c->textContent <c- o>=</c-> <c- u>"Click me!"</c-><c- p>;</c-></code></pre>

  <p>前と同じように、コンストラクタも動作する：</p>

  <pre><code class='js'><c- a>const</c-> plasticButton2 <c- o>=</c-> <c- k>new</c-> PlasticButton<c- p>();</c->
console<c- p>.</c->log<c- p>(</c->plasticButton2<c- p>.</c->localName<c- p>);</c->  <c- c1>// will output "button"</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> PlasticButton<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->plasticButton2 <c- k>instanceof</c-> HTMLButtonElement<c- p>);</c-></code></pre>

  <p>プログラムでカスタマイズした組み込み要素を作成する場合、明示的に設定されていないので<code id="custom-elements-customized-builtin-example:attr-is-2"><a href="#attr-is">is</a></code>属性はDOMに存在しない。ただし、<a href="#attr-is-during-serialization">シリアライズ時に出力に追加される</a>。</p>

  <pre><code class='js'>console<c- p>.</c->assert<c- p>(</c-><c- o>!</c->plasticButton<c- p>.</c->hasAttribute<c- p>(</c-><c- u>"is"</c-><c- p>));</c->
console<c- p>.</c->log<c- p>(</c->plasticButton<c- p>.</c->outerHTML<c- p>);</c-> <c- c1>// will output '&lt;button is="plastic-button">&lt;/button>'</c-></code></pre>

  <p>Regardless of how it is created, all of the ways in which <code id="custom-elements-customized-builtin-example:the-button-element-2"><a href="form-elements.html#the-button-element">button</a></code> is special apply to such "plastic buttons" as well: their focus behavior, ability to participate in <span>form submission</span>, the <code id="custom-elements-customized-builtin-example:attr-fe-disabled"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code> attribute, and so on.</p>

  <p id="customized-built-in-element-restrictions"><a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-8">カスタマイズされた組み込み要素</a>は、有用なユーザーエージェントが提供する動作またはAPIを持つ既存のHTML要素を拡張を可能にするように設計されている。そのため、この仕様で定義される既存のHTML要素のみを拡張することができ、<a id="custom-elements-customized-builtin-example:element-interface" href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-interface" data-x-internal="element-interface">要素インターフェイス</a>として<code>HTMLUnknownElement</code>を使用するように定義された<code id="custom-elements-customized-builtin-example:bgsound"><a href="obsolete.html#bgsound">bgsound</a></code>、<code id="custom-elements-customized-builtin-example:blink"><a href="obsolete.html#blink">blink</a></code>、<code id="custom-elements-customized-builtin-example:isindex"><a href="obsolete.html#isindex">isindex</a></code>、<code id="custom-elements-customized-builtin-example:keygen"><a href="obsolete.html#keygen">keygen</a></code>、<code id="custom-elements-customized-builtin-example:multicol"><a href="obsolete.html#multicol">multicol</a></code>、<code id="custom-elements-customized-builtin-example:nextid"><a href="obsolete.html#nextid">nextid</a></code>、または<code id="custom-elements-customized-builtin-example:spacer"><a href="obsolete.html#spacer">spacer</a></code>などのレガシー要素は拡張できない。</p>

  <p>この要件の1つの理由は将来の互換性である。もし<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-9">カスタマイズされた組み込み要素</a>が、たとえば<code>combobox</code>のような、現在不明の要素を拡張したものが定義されたなら、派生した<a href="#customized-built-in-element" id="custom-elements-customized-builtin-example:customized-built-in-element-10">カスタマイズされた組み込み要素</a>のコンシューマーが、ユーザーエージェント提供の動作に興味を持たない基本要素に依存するようになるため、これはこの仕様が将来<code>combobox</code>要素を定義することを妨げるかもしれない。</p>

  <h5 id="custom-elements-autonomous-drawbacks"><span class="secno">4.13.1.5</span> Drawbacks of autonomous custom elements<a href="#custom-elements-autonomous-drawbacks" class="self-link"></a></h5>

  

  <p>以下で規定されているように、そして上記で触れたように、単に<code>taco-button</code>という要素を定義して使用しても、そのような要素がボタンを<a href="dom.html#represents" id="custom-elements-autonomous-drawbacks:represents">表す</a>ことを意味しない。That is, tools such as web browsers, search engines, or accessibility technology will not automatically treat the resulting element as a button just based on its defined name.</p>

  <p><a href="#autonomous-custom-element" id="custom-elements-autonomous-drawbacks:autonomous-custom-element">自律カスタム要素</a>を依然として使用する一方で、様々なユーザーに所望のボタンセマンティクスを伝えるためためには、複数の技術を用いる必要がある：</p>

  <ul><li><p>The addition of the <code id="custom-elements-autonomous-drawbacks:attr-tabindex"><a href="interaction.html#attr-tabindex">tabindex</a></code> attribute would make the <code>taco-button</code> <span>focusable</span>. Note that if the <code>taco-button</code> were to become logically disabled, the <code id="custom-elements-autonomous-drawbacks:attr-tabindex-2"><a href="interaction.html#attr-tabindex">tabindex</a></code> attribute would need to be removed.<li><p>The addition of an ARIA role and various ARIA states and properties helps convey semantics to accessibility technology. For example, setting the <a id="custom-elements-autonomous-drawbacks:role" href="https://w3c.github.io/aria/#dfn-role" data-x-internal="role">role</a> to "<code id="custom-elements-autonomous-drawbacks:attr-aria-role-button"><a data-x-internal="attr-aria-role-button" href="https://w3c.github.io/aria/#button">button</a></code>" will convey the semantics that this is a button, enabling users to successfully interact with the control using usual button-like interactions in their accessibility technology. Setting the <code id="custom-elements-autonomous-drawbacks:attr-aria-label"><a data-x-internal="attr-aria-label" href="https://w3c.github.io/aria/#aria-label">aria-label</a></code> property is necessary to give the button an <a href="https://w3c.github.io/aria/#dfn-accessible-name" id="custom-elements-autonomous-drawbacks:concept-accessible-name" data-x-internal="concept-accessible-name">accessible name</a>, instead of having accessibility technology traverse its child text nodes and announce them. And setting the <code id="custom-elements-autonomous-drawbacks:attr-aria-disabled"><a data-x-internal="attr-aria-disabled" href="https://w3c.github.io/aria/#aria-disabled">aria-disabled</a></code> state to "<code>true</code>" when the button is logically disabled conveys to accessibility technology the button's disabled state.<li><p>The addition of event handlers to handle commonly-expected button behaviors helps convey the semantics of the button to web browser users. この場合、最も関連性の高いイベントハンドラーは、適切な<code id="custom-elements-autonomous-drawbacks:event-keydown"><a data-x-internal="event-keydown" href="https://w3c.github.io/uievents/#event-type-keydown">keydown</a></code>イベントを<code id="custom-elements-autonomous-drawbacks:event-click"><a data-x-internal="event-click" href="https://w3c.github.io/uievents/#event-type-click">click</a></code>イベントとしてプロキシするものであるので、キーボードとクリックの両方でボタンをアクティブにすることができる。<li><p><code>taco-button</code>要素に提供される任意のデフォルトの視覚スタイリングに加えて、視覚スタイリングはまた、例えば無効になるなど、論理状態の変化を反映するように更新される必要がある。つまり、<code>taco-button</code>の規則を持つスタイルシートはすべて、<code>taco-button[disabled]</code>の規則も必要となる。</ul>

  <p>これらの点を念頭に置いて、（無効にする機能を含む）ボタンのセマンティクスを伝える責任を負ったフル機能の<code>taco-button</code>は、次のようになる：</p>

  <pre><code class='js'><c- a>class</c-> TacoButton <c- k>extends</c-> HTMLElement <c- p>{</c->
  <c- k>static</c-> observedAttributes <c- o>=</c-> <c- p>[</c-><c- u>"disabled"</c-><c- p>];</c->

  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->role <c- o>=</c-> <c- u>"button"</c-><c- p>;</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"keydown"</c-><c- p>,</c-> e <c- p>=></c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c->e<c- p>.</c->code <c- o>===</c-> <c- u>"Enter"</c-> <c- o>||</c-> e<c- p>.</c->code <c- o>===</c-> <c- u>"Space"</c-><c- p>)</c-> <c- p>{</c->
        <c- k>this</c-><c- p>.</c->dispatchEvent<c- p>(</c-><c- k>new</c-> PointerEvent<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> <c- p>{</c->
          bubbles<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
          cancelable<c- o>:</c-> <c- kc>true</c->
        <c- p>}));</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> e <c- p>=></c-> <c- p>{</c->
      <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
        e<c- p>.</c->preventDefault<c- p>();</c->
        e<c- p>.</c->stopImmediatePropagation<c- p>();</c->
      <c- p>}</c->
    <c- p>});</c->

    <c- k>this</c-><c- p>.</c->_observer <c- o>=</c-> <c- k>new</c-> MutationObserver<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaLabel <c- o>=</c-> <c- k>this</c-><c- p>.</c->textContent<c- p>;</c->
    <c- p>});</c->
  <c- p>}</c->

  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->

    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->observe<c- p>(</c-><c- k>this</c-><c- p>,</c-> <c- p>{</c->
      childList<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      characterData<c- o>:</c-> <c- kc>true</c-><c- p>,</c->
      subtree<c- o>:</c-> <c- kc>true</c->
    <c- p>});</c->
  <c- p>}</c->

  disconnectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->_observer<c- p>.</c->disconnect<c- p>();</c->
  <c- p>}</c->

  get disabled<c- p>()</c-> <c- p>{</c->
    <c- k>return</c-> <c- k>this</c-><c- p>.</c->hasAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>);</c->
  <c- p>}</c->
  set disabled<c- p>(</c->flag<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->toggleAttribute<c- p>(</c-><c- u>"disabled"</c-><c- p>,</c-> Boolean<c- p>(</c->flag<c- p>));</c->
  <c- p>}</c->

  attributeChangedCallback<c- p>(</c->name<c- p>,</c-> oldValue<c- p>,</c-> newValue<c- p>)</c-> <c- p>{</c->
    <c- c1>// name will always be "disabled" due to observedAttributes</c->
    <c- k>if</c-> <c- p>(</c-><c- k>this</c-><c- p>.</c->disabled<c- p>)</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->removeAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaDisabled <c- o>=</c-> <c- u>"true"</c-><c- p>;</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- k>this</c-><c- p>.</c->setAttribute<c- p>(</c-><c- u>"tabindex"</c-><c- p>,</c-> <c- u>"0"</c-><c- p>);</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->ariaDisabled <c- o>=</c-> <c- u>"false"</c-><c- p>;</c->
    <c- p>}</c->
  <c- p>}</c->
<c- p>}</c-></code></pre>

  <p>Even with this rather-complicated element definition, the element is not a pleasure to use for consumers: it will be continually "sprouting" <code id="custom-elements-autonomous-drawbacks:attr-tabindex-3"><a href="interaction.html#attr-tabindex">tabindex</a></code> attributes of its own volition, and its choice of <code>tabindex="0"</code> focusability behavior may not match the <code id="custom-elements-autonomous-drawbacks:the-button-element"><a href="form-elements.html#the-button-element">button</a></code> behavior on the current platform. This is because as of now there is no way to specify default focus behavior for custom elements, forcing the use of the <code id="custom-elements-autonomous-drawbacks:attr-tabindex-4"><a href="interaction.html#attr-tabindex">tabindex</a></code> attribute to do so (even though it is usually reserved for allowing the consumer to override default behavior).</p>

  <p>対照的に、前節で示したように、単一の<a href="#customized-built-in-element" id="custom-elements-autonomous-drawbacks:customized-built-in-element">カスタマイズされた組み込み要素</a>は、<code id="custom-elements-autonomous-drawbacks:the-button-element-2"><a href="form-elements.html#the-button-element">button</a></code>要素のセマンティクスと動作を自動的に継承する。これらの動作を手動で実装する必要はない。一般に、HTMLの既存要素の上に構築される重要な動作やセマンティクスを持つ要素については、<a href="#customized-built-in-element" id="custom-elements-autonomous-drawbacks:customized-built-in-element-2">カスタマイズされた組み込み要素</a>の開発、保守、および消費が容易になる。</p>

  <h5 id="custom-elements-upgrades-examples"><span class="secno">4.13.1.6</span> Upgrading elements after their creation<a href="#custom-elements-upgrades-examples" class="self-link"></a></h5>

  

  <p>Because <a href="#element-definition" id="custom-elements-upgrades-examples:element-definition">element definition</a> can occur at any time, a non-custom element could be <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-elements-upgrades-examples:create-an-element" data-x-internal="create-an-element">created</a>, and then later become a <a href="#custom-element" id="custom-elements-upgrades-examples:custom-element">custom element</a> after an appropriate <span>definition</span> is registered. We call this process "upgrading" the element, from a normal element into a custom element.</p>

  <p><span>Upgrades</span> enable scenarios where it may be preferable for <span>custom element definitions</span> to be registered after relevant elements have been initially created, such as by the parser. They allow progressive enhancement of the content in the custom element. For example, in the following HTML document the element definition for <code>img-viewer</code> is loaded asynchronously:</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Image viewer example<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>img-viewer</c-> <c- e>filter</c-><c- o>=</c-><c- s>"Kelvin"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>img</c-> <c- e>src</c-><c- o>=</c-><c- s>"images/tree.jpg"</c-> <c- e>alt</c-><c- o>=</c-><c- s>"A beautiful tree towering over an empty savannah"</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>img-viewer</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-> <c- e>src</c-><c- o>=</c-><c- s>"js/elements/img-viewer.js"</c-> <c- e>async</c-><c- p>>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  <p>The definition for the <code>img-viewer</code> element here is loaded using a <code id="custom-elements-upgrades-examples:the-script-element"><a href="scripting.html#the-script-element">script</a></code> element marked with the <code id="custom-elements-upgrades-examples:attr-script-async"><a href="scripting.html#attr-script-async">async</a></code> attribute, placed after the <code>&lt;img-viewer></code> tag in the markup. While the script is loading, the <code>img-viewer</code> element will be treated as an undefined element, similar to a <code id="custom-elements-upgrades-examples:the-span-element"><a href="text-level-semantics.html#the-span-element">span</a></code>. Once the script loads, it will define the <code>img-viewer</code> element, and the existing <code>img-viewer</code> element on the page will be upgraded, applying the custom element's definition (which presumably includes applying an image filter identified by the string "Kelvin", enhancing the image's visual appearance).</p>

  <hr>

  <p>Note that <span>upgrades</span> only apply to elements in the document tree. (Formally, elements that are <a id="custom-elements-upgrades-examples:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">connected</a>.) An element that is not inserted into a document will stay un-upgraded. An example illustrates this point:</p>

  <pre><code class='html'><c- cp>&lt;!DOCTYPE html></c->
<c- p>&lt;</c-><c- f>html</c-> <c- e>lang</c-><c- o>=</c-><c- s>"en"</c-><c- p>></c->
<c- p>&lt;</c-><c- f>title</c-><c- p>></c->Upgrade edge-cases example<c- p>&lt;/</c-><c- f>title</c-><c- p>></c->

<c- p>&lt;</c-><c- f>example-element</c-><c- p>>&lt;/</c-><c- f>example-element</c-><c- p>></c->

<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
  <c- u>"use strict"</c-><c- p>;</c->

  <c- a>const</c-> inDocument <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->
  <c- a>const</c-> outOfDocument <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"example-element"</c-><c- p>);</c->

  <c- c1>// Before the element definition, both are HTMLElement:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> HTMLElement<c- p>);</c->

  <c- a>class</c-> ExampleElement <c- k>extends</c-> HTMLElement <c- p>{}</c->
  customElements<c- p>.</c->define<c- p>(</c-><c- u>"example-element"</c-><c- p>,</c-> ExampleElement<c- p>);</c->

  <c- c1>// After element definition, the in-document element was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->inDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
  console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>));</c->

  document<c- p>.</c->body<c- p>.</c->appendChild<c- p>(</c->outOfDocument<c- p>);</c->

  <c- c1>// Now that we've moved the element into the document, it too was upgraded:</c->
  console<c- p>.</c->assert<c- p>(</c->outOfDocument <c- k>instanceof</c-> ExampleElement<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c-></code></pre>

  <h5 id="exposing-custom-element-states"><span class="secno">4.13.1.7</span> Exposing custom element states<a href="#exposing-custom-element-states" class="self-link"></a></h5>

  <p>Built-in elements provided by user agents have certain states that can change over time depending on user interaction and other factors, and are exposed to web authors through <a href="https://triple-underscore.github.io/selectors4-ja.html#pseudo-class" id="exposing-custom-element-states:pseudo-class" data-x-internal="pseudo-class">pseudo-classes</a>. For example, some form controls have the "invalid" state, which is exposed through the <code>:invalid</code> <a id="exposing-custom-element-states:pseudo-class-2" href="https://triple-underscore.github.io/selectors4-ja.html#pseudo-class" data-x-internal="pseudo-class">pseudo-class</a>.</p>

  <p>Like built-in elements, <a href="#custom-element" id="exposing-custom-element-states:custom-element">custom elements</a> can have various states to be in too, and <a href="#custom-element" id="exposing-custom-element-states:custom-element-2">custom element</a> authors want to expose these states in a similar fashion as the built-in elements.</p>

  <p>This is done via the <code>:state()</code> pseudo-class. A custom element author can use the <code>states</code> property of <code>ElementInternals</code> to add and remove such custom states, which are then exposed as arguments to the <code>:state()</code> pseudo-class.<div class="example"><p>The following shows how <code>:state()</code> can be used to style a custom checkbox element. Assume that <code>LabeledCheckbox</code> doesn't expose its "checked" state via a content attribute.</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- a>class</c-> LabeledCheckbox <c- k>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- k>this</c-><c- p>.</c->_internals <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachInternals<c- p>();</c->
    <c- k>this</c-><c- p>.</c->addEventListener<c- p>(</c-><c- t>'click'</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->_onClick<c- p>.</c->bind<c- p>(</c-><c- k>this</c-><c- p>));</c->

    <c- a>const</c-> shadowRoot <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachShadow<c- p>({</c->mode<c- o>:</c-> <c- t>'closed'</c-><c- p>});</c->
    shadowRoot<c- p>.</c->innerHTML <c- o>=</c->
      <c- sb>`&lt;style></c->
<c- sb>       :host::before {</c->
<c- sb>         content: '[ ]';</c->
<c- sb>         white-space: pre;</c->
<c- sb>         font-family: monospace;</c->
<c- sb>       }</c->
<c- sb>       :host(:state(checked))::before { content: '[x]' }</c->
<c- sb>       &lt;/style></c->
<c- sb>       &lt;slot>Label&lt;/slot>`</c-><c- p>;</c->
  <c- p>}</c->

  get checked<c- p>()</c-> <c- p>{</c-> <c- k>return</c-> <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c->has<c- p>(</c-><c- t>'checked'</c-><c- p>);</c-> <c- p>}</c->

  set checked<c- p>(</c->flag<c- p>)</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->flag<c- p>)</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c->add<c- p>(</c-><c- t>'checked'</c-><c- p>);</c->
    <c- k>else</c->
      <c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c-><c- k>delete</c-><c- p>(</c-><c- t>'checked'</c-><c- p>);</c->
  <c- p>}</c->

  _onClick<c- p>(</c->event<c- p>)</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->checked <c- o>=</c-> <c- o>!</c-><c- k>this</c-><c- p>.</c->checked<c- p>;</c->
  <c- p>}</c->
<c- p>}</c->

customElements<c- p>.</c->define<c- p>(</c-><c- t>'labeled-checkbox'</c-><c- p>,</c-> LabeledCheckbox<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->

<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- f>labeled-checkbox</c-> <c- p>{</c-> <c- k>border</c-><c- p>:</c-> <c- kc>dashed</c-> <c- kc>red</c-><c- p>;</c-> <c- p>}</c->
<c- f>labeled-checkbox</c-><c- p>:</c-><c- nd>state</c-><c- o>(</c-><c- f>checked</c-><c- o>)</c-> <c- p>{</c-> <c- k>border</c-><c- p>:</c-> <c- kc>solid</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>labeled-checkbox</c-><c- p>></c->You need to check this<c- p>&lt;/</c-><c- f>labeled-checkbox</c-><c- p>></c-></code></pre>
  </div>

  <div class="example"><p>Custom pseudo-classes can even target shadow parts. An extension of the above example shows this:</p>

   <pre><code class='html'><c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- a>class</c-> QuestionBox <c- k>extends</c-> HTMLElement <c- p>{</c->
  constructor<c- p>()</c-> <c- p>{</c->
    <c- k>super</c-><c- p>();</c->
    <c- a>const</c-> shadowRoot <c- o>=</c-> <c- k>this</c-><c- p>.</c->attachShadow<c- p>({</c->mode<c- o>:</c-> <c- t>'closed'</c-><c- p>});</c->
    shadowRoot<c- p>.</c->innerHTML <c- o>=</c->
      <c- sb>`&lt;div>&lt;slot>Question&lt;/slot>&lt;/div></c->
<c- sb>       &lt;labeled-checkbox part='checkbox'>Yes&lt;/labeled-checkbox>`</c-><c- p>;</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- t>'question-box'</c-><c- p>,</c-> QuestionBox<c- p>);</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->

<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- f>question-box</c-><c- p>::</c-><c- nd>part</c-><c- o>(</c-><c- f>checkbox</c-><c- o>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> <c- kc>red</c-><c- p>;</c-> <c- p>}</c->
<c- f>question-box</c-><c- p>::</c-><c- nd>part</c-><c- o>(</c-><c- f>checkbox</c-><c- o>)</c-><c- p>:</c-><c- nd>state</c-><c- o>(</c-><c- f>checked</c-><c- o>)</c-> <c- p>{</c-> <c- k>color</c-><c- p>:</c-> <c- kc>green</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->

<c- p>&lt;</c-><c- f>question-box</c-><c- p>></c->Continue?<c- p>&lt;/</c-><c- f>question-box</c-><c- p>></c-></code></pre>
  </div>

  <h4 id="custom-element-conformance"><span class="secno">4.13.2</span> Requirements for custom element constructors and reactions<a href="#custom-element-conformance" class="self-link"></a></h4>

  <p>When authoring <a href="#custom-element-constructor" id="custom-element-conformance:custom-element-constructor">custom element constructors</a>, authors are bound by the following conformance requirements:</p>

  <ul><li><p>A parameter-less call to <code>super()</code> must be the first statement in the constructor body, to establish the correct prototype chain and <b>this</b> value before any further code is run.<li><p>A <code>return</code> statement must not appear anywhere inside the constructor body, unless it is a simple early-return (<code>return</code> or <code>return this</code>).<li><p>The constructor must not use the <code id="custom-element-conformance:dom-document-write"><a href="dynamic-markup-insertion.html#dom-document-write">document.write()</a></code> or <code id="custom-element-conformance:dom-document-open"><a href="dynamic-markup-insertion.html#dom-document-open">document.open()</a></code> methods.<li><p>The element's attributes and children must not be inspected, as in the non-<span>upgrade</span> case none will be present, and relying on upgrades makes the element less usable.<li><p>The element must not gain any attributes or children, as this violates the expectations of consumers who use the <code id="custom-element-conformance:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement</a></code> or <code id="custom-element-conformance:dom-document-createelementns"><a data-x-internal="dom-document-createelementns" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns">createElementNS</a></code> methods.<li><p>In general, work should be deferred to <code>connectedCallback</code> as much as possible—especially work involving fetching resources or rendering. However, note that <code>connectedCallback</code> can be called more than once, so any initialization work that is truly one-time will need a guard to prevent it from running twice.<li><p>In general, the constructor should be used to set up initial state and default values, and to set up event listeners and possibly a <a id="custom-element-conformance:shadow-root" href="https://triple-underscore.github.io/DOM4-ja.html#concept-shadow-root" data-x-internal="shadow-root">shadow root</a>.</ul>

  <p>Several of these requirements are checked during <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-element-conformance:create-an-element" data-x-internal="create-an-element">element creation</a>, either directly or indirectly, and failing to follow them will result in a custom element that cannot be instantiated by the parser or DOM APIs. This is true even if the work is done inside a constructor-initiated <span>microtask</span>, as a <span>microtask checkpoint</span> can occur immediately after construction.</p>

  <p>When authoring <a href="#concept-custom-element-reaction" id="custom-element-conformance:concept-custom-element-reaction">custom element reactions</a>, authors should avoid manipulating the node tree as this can lead to unexpected results.</p>

  <div class="example"><p>An element's <code>connectedCallback</code> can be queued before the element is disconnected, but as the callback queue is still processed, it results in a <code>connectedCallback</code> for an element that is no longer connected:</p>

   <pre><code class='js'><c- a>class</c-> CParent <c- k>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    <c- k>this</c-><c- p>.</c->firstChild<c- p>.</c->remove<c- p>();</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-parent"</c-><c- p>,</c-> CParent<c- p>);</c->

<c- a>class</c-> CChild <c- k>extends</c-> HTMLElement <c- p>{</c->
  connectedCallback<c- p>()</c-> <c- p>{</c->
    console<c- p>.</c->log<c- p>(</c-><c- u>"CChild connectedCallback: isConnected ="</c-><c- p>,</c-> <c- k>this</c-><c- p>.</c->isConnected<c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"c-child"</c-><c- p>,</c-> CChild<c- p>);</c->

<c- a>const</c-> parent <c- o>=</c-> <c- k>new</c-> CParent<c- p>(),</c->
      child <c- o>=</c-> <c- k>new</c-> CChild<c- p>();</c->
parent<c- p>.</c->append<c- p>(</c->child<c- p>);</c->
document<c- p>.</c->body<c- p>.</c->append<c- p>(</c->parent<c- p>);</c->

<c- c1>// Logs:</c->
<c- c1>// CChild connectedCallback: isConnected = false</c-></code></pre>
  </div>

  <h4 id="custom-elements-core-concepts"><span class="secno">4.13.3</span> Core concepts<a href="#custom-elements-core-concepts" class="self-link"></a></h4>

  <p>A <dfn id="custom-element" data-export="">custom element</dfn> is an element that is <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-custom" id="custom-elements-core-concepts:concept-element-custom" data-x-internal="concept-element-custom">custom</a>. Informally, this means that its constructor and prototype are defined by the author, instead of by the user agent. This author-supplied constructor function is called the <dfn id="custom-element-constructor" data-export="">custom element constructor</dfn>.</p>

  <p>Two distinct types of <a href="#custom-element" id="custom-elements-core-concepts:custom-element">custom elements</a> can be defined:</p>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/is" title="The is global attribute allows you to specify that a standard HTML element should behave like a defined custom built-in element (see Using custom elements for more details).">Global_attributes/is</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><ol><li><p>An <dfn id="autonomous-custom-element" data-export="">autonomous custom element</dfn>, which is defined with no <code>extends</code> option. These types of custom elements have a local name equal to their <span>defined name</span>.<li><p>A <dfn id="customized-built-in-element" data-export="">customized built-in element</dfn>, which is defined with an <code>extends</code> option. These types of custom elements have a local name equal to the value passed in their <code>extends</code> option, and their <span>defined name</span> is used as the value of the <dfn data-dfn-for="html-global" id="attr-is" data-dfn-type="element-attr"><code>is</code></dfn> attribute, which therefore must be a <a href="#valid-custom-element-name" id="custom-elements-core-concepts:valid-custom-element-name">valid custom element name</a>.</ol>

  <p>After a <a href="#custom-element" id="custom-elements-core-concepts:custom-element-2">custom element</a> is <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-create-element" id="custom-elements-core-concepts:create-an-element" data-x-internal="create-an-element">created</a>, changing the value of the <code id="custom-elements-core-concepts:attr-is"><a href="#attr-is">is</a></code> attribute does not change the element's behavior.</p>

  <p><a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element">Autonomous custom elements</a> have the following element definition:</p>

  <dl class="element"><dt><a href="dom.html#concept-element-categories" id="custom-elements-core-concepts:concept-element-categories">カテゴリー</a>：<dd><a id="custom-elements-core-concepts:flow-content-2" href="dom.html#flow-content-2">フローコンテンツ</a>。<dd><a id="custom-elements-core-concepts:phrasing-content-2" href="dom.html#phrasing-content-2">フレージングコンテンツ</a>。<dd><a id="custom-elements-core-concepts:palpable-content-2" href="dom.html#palpable-content-2">パルパブルコンテンツ</a>。<dd>For <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element">form-associated custom elements</a>: <a href="forms.html#category-listed" id="custom-elements-core-concepts:category-listed">Listed</a>, <a href="forms.html#category-label" id="custom-elements-core-concepts:category-label">labelable</a>, <a href="forms.html#category-submit" id="custom-elements-core-concepts:category-submit">submittable</a>, and <a href="forms.html#category-reset" id="custom-elements-core-concepts:category-reset">resettable</a> <a id="custom-elements-core-concepts:form-associated-element" href="forms.html#form-associated-element">form-associated element</a>.<dt><a href="dom.html#concept-element-contexts" id="custom-elements-core-concepts:concept-element-contexts">この要素を使用できるコンテキスト</a>：<dd><a id="custom-elements-core-concepts:phrasing-content-2-2" href="dom.html#phrasing-content-2">フレージングコンテンツ</a>が期待される場所。<dt><a href="dom.html#concept-element-content-model" id="custom-elements-core-concepts:concept-element-content-model">コンテンツモデル</a>：<dd><a id="custom-elements-core-concepts:transparent" href="dom.html#transparent">透過的</a>。<dt><a href="dom.html#concept-element-attributes" id="custom-elements-core-concepts:concept-element-attributes">コンテンツ属性</a>：<dd><a id="custom-elements-core-concepts:global-attributes" href="dom.html#global-attributes">Global attributes</a>, except the <code id="custom-elements-core-concepts:attr-is-2"><a href="#attr-is">is</a></code> attribute<dd><code id="custom-elements-core-concepts:attr-fae-form"><a href="form-control-infrastructure.html#attr-fae-form">form</a></code>, for <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-2">form-associated custom elements</a> — Associates the element with a <code id="custom-elements-core-concepts:the-form-element"><a href="forms.html#the-form-element">form</a></code> element<dd><code id="custom-elements-core-concepts:attr-fe-disabled"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code>, for <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-3">form-associated custom elements</a> — Whether the form control is disabled<dd><code id="custom-elements-core-concepts:attr-face-readonly"><a href="#attr-face-readonly">readonly</a></code>, for <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-4">form-associated custom elements</a> — Affects <code>willValidate</code>, plus any behavior added by the custom element author<dd><code id="custom-elements-core-concepts:attr-fe-name"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code>, for <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-5">form-associated custom elements</a> — Name of the element to use for <a id="custom-elements-core-concepts:form-submission-2" href="form-control-infrastructure.html#form-submission-2">form submission</a> and in the <code id="custom-elements-core-concepts:dom-form-elements"><a href="forms.html#dom-form-elements">form.elements</a></code> API<dd>名前空間を持たないその他の属性（文参照）。<dt><a href="dom.html#concept-element-accessibility-considerations" id="custom-elements-core-concepts:concept-element-accessibility-considerations">アクセシビリティの考慮事項</a>:<dd><a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-6">フォームに関連付けられたカスタム要素</a>の場合：<a href="https://momdo.github.io/html-aria/#el-form-associated-custom-element">著者向け</a>、<a href="https://w3c.github.io/html-aam/#el-form-associated-custom-element">実装者向け</a>。<dd>そうでなければ：<a href="https://momdo.github.io/html-aria/#el-autonomous-custom-element">著者向け</a>、<a href="https://w3c.github.io/html-aam/#el-autonomous-custom-element">実装者向け</a>。<dt><a href="dom.html#concept-element-dom" id="custom-elements-core-concepts:concept-element-dom">DOMインターフェイス</a>：<dd>Supplied by the element's author (inherits from <code>HTMLElement</code>)</dl>


  <p>An <a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-2">autonomous custom element</a> does not have any special meaning: it <a id="custom-elements-core-concepts:represents" href="dom.html#represents">represents</a> its children. A <a href="#customized-built-in-element" id="custom-elements-core-concepts:customized-built-in-element">customized built-in element</a> inherits the semantics of the element that it extends.</p>

  <p>Any namespace-less attribute that is relevant to the element's functioning, as determined by the element's author, may be specified on an <a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-3">autonomous custom element</a>, so long as the attribute name is <a id="custom-elements-core-concepts:xml-compatible" href="infrastructure.html#xml-compatible">XML-compatible</a> and contains no <a href="https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha" id="custom-elements-core-concepts:uppercase-ascii-letters" data-x-internal="uppercase-ascii-letters">ASCII upper alphas</a>. The exception is the <code id="custom-elements-core-concepts:attr-is-3"><a href="#attr-is">is</a></code> attribute, which must not be specified on an <a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-4">autonomous custom element</a> (and which will have no effect if it is).</p>

  <p><a href="#customized-built-in-element" id="custom-elements-core-concepts:customized-built-in-element-2">Customized built-in elements</a> follow the normal requirements for attributes, based on the elements they extend. To add custom attribute-based behavior, use <code id="custom-elements-core-concepts:attr-data-*"><a href="dom.html#attr-data-*">data-*</a></code> attributes.</p>

  <hr>

  <p>An <a href="#autonomous-custom-element" id="custom-elements-core-concepts:autonomous-custom-element-5">autonomous custom element</a> is called a <dfn id="form-associated-custom-element" data-export="">form-associated custom element</dfn> if the element is associated with a <span>custom element definition</span> whose <span>form-associated</span> field is set to true.</p>

  <p>The <code id="custom-elements-core-concepts:attr-fe-name-2"><a href="form-control-infrastructure.html#attr-fe-name">name</a></code> attribute represents the <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-7">form-associated custom element</a>'s name. The <code id="custom-elements-core-concepts:attr-fe-disabled-2"><a href="form-control-infrastructure.html#attr-fe-disabled">disabled</a></code> attribute is used to make the <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-8">form-associated custom element</a> non-interactive and to prevent its <a href="#face-submission-value" id="custom-elements-core-concepts:face-submission-value">submission value</a> from being submitted. The <code id="custom-elements-core-concepts:attr-fae-form-2"><a href="form-control-infrastructure.html#attr-fae-form">form</a></code> attribute is used to explicitly associate the <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-9">form-associated custom element</a> with its <a id="custom-elements-core-concepts:form-owner" href="form-control-infrastructure.html#form-owner">form owner</a>.</p>

  <p>The <dfn data-dfn-for="form-associated custom elements" id="attr-face-readonly" data-dfn-type="element-attr"><code>readonly</code></dfn> attribute of <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-10">form-associated custom elements</a> specifies that the element is <span>barred from constraint validation</span>. User agents don't provide any other behavior for the attribute, but custom element authors should, where possible, use its presence to make their control non-editable in some appropriate fashion, similar to the behavior for the <a href="input.html#attr-input-readonly" id="custom-elements-core-concepts:attr-input-readonly">readonly</a> attribute on built-in form controls.</p>

  <p><strong>Constraint validation</strong>: If the <code id="custom-elements-core-concepts:attr-face-readonly-2"><a href="#attr-face-readonly">readonly</a></code> attribute is specified on a <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-11">form-associated custom element</a>, the element is <span>barred from constraint validation</span>.</p>

  <p>The <span>reset algorithm</span> for <a href="#form-associated-custom-element" id="custom-elements-core-concepts:form-associated-custom-element-12">form-associated custom elements</a> is to <span>enqueue a custom element callback reaction</span> with the element, callback name "<code>formResetCallback</code>", and « ».</p>

  <hr>

  <p>A <dfn id="valid-custom-element-name" data-export="">valid custom element name</dfn> is a sequence of characters <var>name</var> that meets all of the following requirements:</p>

  <ul><li><p><var>name</var> must match the <code id="custom-elements-core-concepts:prod-potentialcustomelementname"><a href="#prod-potentialcustomelementname">PotentialCustomElementName</a></code> production:</p>

    <dl><dt><code><dfn id="prod-potentialcustomelementname">PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] (<a href="#prod-pcenchar" id="custom-elements-core-concepts:prod-pcenchar">PCENChar</a>)* '-' (<a href="#prod-pcenchar" id="custom-elements-core-concepts:prod-pcenchar-2">PCENChar</a>)*</code><dt><code><dfn id="prod-pcenchar">PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]</code></dl>

    <p>This uses the <a href="https://www.w3.org/TR/xml/#sec-notation">EBNF notation</a> from the <cite>XML</cite> specification. <a href="references.html#refsXML">[XML]</a></p>
   <li><p><var>name</var> must not be any of the following:</p>

    <ul class="brief"><li><code>annotation-xml</code><li><code>color-profile</code><li><code>font-face</code><li><code>font-face-src</code><li><code>font-face-uri</code><li><code>font-face-format</code><li><code>font-face-name</code><li><code>missing-glyph</code></ul>

    <p class="note">The list of names above is the summary of all hyphen-containing element names from the <a href="infrastructure.html#other-applicable-specifications" id="custom-elements-core-concepts:other-applicable-specifications">applicable specifications</a>, namely <cite>SVG 2</cite> and <cite>MathML</cite>. <a href="references.html#refsSVG">[SVG]</a> <a href="references.html#refsMATHML">[MATHML]</a></p>
   </ul>

  <div class="note"><p>These requirements ensure a number of goals for <a href="#valid-custom-element-name" id="custom-elements-core-concepts:valid-custom-element-name-2">valid custom element names</a>:</p>

   <ul><li><p>They start with an <a id="custom-elements-core-concepts:lowercase-ascii-letters" href="https://triple-underscore.github.io/infra-ja.html#ascii-lower-alpha" data-x-internal="lowercase-ascii-letters">ASCII lower alpha</a>, ensuring that the HTML parser will treat them as tags instead of as text.<li><p>They do not contain any <a href="https://triple-underscore.github.io/infra-ja.html#ascii-upper-alpha" id="custom-elements-core-concepts:uppercase-ascii-letters-2" data-x-internal="uppercase-ascii-letters">ASCII upper alphas</a>, ensuring that the user agent can always treat HTML elements ASCII-case-insensitively.<li><p>They contain a hyphen, used for namespacing and to ensure forward compatibility (since no elements will be added to HTML, SVG, or MathML with hyphen-containing local names in the future).<li><p>They can always be created with <code id="custom-elements-core-concepts:dom-document-createelement"><a data-x-internal="dom-document-createelement" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelement">createElement()</a></code> and <code id="custom-elements-core-concepts:dom-document-createelementns"><a data-x-internal="dom-document-createelementns" href="https://triple-underscore.github.io/DOM4-ja.html#dom-document-createelementns">createElementNS()</a></code>, which have restrictions that go beyond the parser's.</ul>

   <p>Apart from these restrictions, a large variety of names is allowed, to give maximum flexibility for use cases like <code>&lt;math-α></code> or <code>&lt;emotion-😍></code>.</p>
  </div>

  

  <h4 id="custom-elements-api"><span class="secno">4.13.4</span> The <code>CustomElementRegistry</code> interface<a href="#custom-elements-api" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry" title="The CustomElementRegistry interface provides methods for registering custom elements and querying registered elements. To get an instance of it, use the window.customElements property.">CustomElementRegistry</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  

  <p class="note">Custom element registries are associated with <code>Window</code> objects, instead of <code>Document</code> objects, since each <a href="#custom-element-constructor" id="custom-elements-api:custom-element-constructor">custom element constructor</a> inherits from the <code>HTMLElement</code> interface, and there is exactly one <code>HTMLElement</code> interface per <code>Window</code> object.</p>

  

  <dl class="domintro"><dt><code><var>window</var>.<span>customElements</span>.<span id="dom-customelementregistry-define">define</span>(<var>name</var>, <var>constructor</var>)</code><dd>Defines a new <a href="#custom-element" id="custom-elements-api:custom-element">custom element</a>, mapping the given name to the given constructor as an <a href="#autonomous-custom-element" id="custom-elements-api:autonomous-custom-element">autonomous custom element</a>.<dt><code><var>window</var>.<span>customElements</span>.<a href="#dom-customelementregistry-define" id="custom-elements-api:dom-customelementregistry-define">define</a>(<var>name</var>, <var>constructor</var>, { extends: <var>baseLocalName</var> })</code><dd>Defines a new <a href="#custom-element" id="custom-elements-api:custom-element-2">custom element</a>, mapping the given name to the given constructor as a <a href="#customized-built-in-element" id="custom-elements-api:customized-built-in-element">customized built-in element</a> for the <a id="custom-elements-api:element-type" href="infrastructure.html#element-type">element type</a> identified by the supplied <var>baseLocalName</var>. A <a id="custom-elements-api:notsupportederror" href="https://webidl.spec.whatwg.org/#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="custom-elements-api:domexception"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code> will be thrown upon trying to extend a <a href="#custom-element" id="custom-elements-api:custom-element-3">custom element</a> or an unknown element.<dt><code><var>window</var>.<span>customElements</span>.<span id="dom-customelementregistry-get">get</span>(<var>name</var>)</code><dd>Retrieves the <a href="#custom-element-constructor" id="custom-elements-api:custom-element-constructor-2">custom element constructor</a> defined for the given <span>name</span>. Returns undefined if there is no <span>custom element definition</span> with the given <span>name</span>.<dt><code><var>window</var>.<span>customElements</span>.<span id="dom-customelementregistry-getname">getName</span>(<var>constructor</var>)</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/getName" title="The getName() method of the CustomElementRegistry interface returns the name for a previously-defined custom element.">CustomElementRegistry/getName</a><div class="support"><span class="firefox yes"><span>Firefox</span><span>116+</span></span><span class="safari yes"><span>Safari</span><span title="Partial implementation.">🔰 preview+</span></span><span class="chrome yes"><span>Chrome</span><span>117+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>117+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd>Retrieves the given name for a <a href="#custom-element" id="custom-elements-api:custom-element-4">custom element</a> defined for the given <span>constructor</span>. Returns null if there is no <span>custom element definition</span> with the given <span>constructor</span>.<dt><code><var>window</var>.<span>customElements</span>.<span id="dom-customelementregistry-whendefined">whenDefined</span>(<var>name</var>)</code><dd>Returns a promise that will be fulfilled with the <a href="#custom-element" id="custom-elements-api:custom-element-5">custom element</a>'s constructor when a <a href="#custom-element" id="custom-elements-api:custom-element-6">custom element</a> becomes defined with the given name. (If such a <a href="#custom-element" id="custom-elements-api:custom-element-7">custom element</a> is already defined, the returned promise will be immediately fulfilled.) Returns a promise rejected with a <a id="custom-elements-api:syntaxerror" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="custom-elements-api:domexception-2"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code> if not given a <a href="#valid-custom-element-name" id="custom-elements-api:valid-custom-element-name">valid custom element name</a>.<dt><code><var>window</var>.<span>customElements</span>.<span id="dom-customelementregistry-upgrade">upgrade</span>(<var>root</var>)</code><dd><span>Tries to upgrade</span> all <a id="custom-elements-api:shadow-including-inclusive-descendant" href="https://dom.spec.whatwg.org/#concept-shadow-including-inclusive-descendant" data-x-internal="shadow-including-inclusive-descendant">shadow-including inclusive descendant</a> elements of <var>root</var>, even if they are not <a id="custom-elements-api:connected" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">connected</a>.</dl>

  <p><dfn id="element-definition">Element definition</dfn> is a process of adding a <span>custom element definition</span> to the <code>CustomElementRegistry</code>. This is accomplished by the <code id="custom-elements-api:dom-customelementregistry-define-2"><a href="#dom-customelementregistry-define">define()</a></code> method.</p>

  

  <div class="example"><p>The <code id="custom-elements-api:dom-customelementregistry-whendefined"><a href="#dom-customelementregistry-whendefined">whenDefined()</a></code> method can be used to avoid performing an action until all appropriate <a href="#custom-element" id="custom-elements-api:custom-element-8">custom elements</a> are <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-defined" id="custom-elements-api:concept-element-defined" data-x-internal="concept-element-defined">defined</a>. In this example, we combine it with the <code>:defined</code> pseudo-class to hide a dynamically-loaded article's contents until we're sure that all of the <a href="#autonomous-custom-element" id="custom-elements-api:autonomous-custom-element-2">autonomous custom elements</a> it uses are defined.</p>

   <pre><code class='js'>articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>true</c-><c- p>;</c->

fetch<c- p>(</c->articleURL<c- p>)</c->
  <c- p>.</c->then<c- p>(</c->response <c- p>=></c-> response<c- p>.</c->text<c- p>())</c->
  <c- p>.</c->then<c- p>(</c->text <c- p>=></c-> <c- p>{</c->
    articleContainer<c- p>.</c->innerHTML <c- o>=</c-> text<c- p>;</c->

    <c- k>return</c-> Promise<c- p>.</c->all<c- p>(</c->
      <c- p>[...</c->articleContainer<c- p>.</c->querySelectorAll<c- p>(</c-><c- u>":not(:defined)"</c-><c- p>)]</c->
        <c- p>.</c->map<c- p>(</c->el <c- p>=></c-> customElements<c- p>.</c->whenDefined<c- p>(</c->el<c- p>.</c->localName<c- p>))</c->
    <c- p>);</c->
  <c- p>})</c->
  <c- p>.</c->then<c- p>(()</c-> <c- p>=></c-> <c- p>{</c->
    articleContainer<c- p>.</c->hidden <c- o>=</c-> <c- kc>false</c-><c- p>;</c->
  <c- p>});</c-></code></pre>
  </div>

  

  <div class="example"><p>The <code id="custom-elements-api:dom-customelementregistry-upgrade"><a href="#dom-customelementregistry-upgrade">upgrade()</a></code> method allows upgrading of elements at will. Normally elements are automatically upgraded when they become <a id="custom-elements-api:connected-2" href="https://triple-underscore.github.io/DOM4-ja.html#connected" data-x-internal="connected">connected</a>, but this method can be used if you need to upgrade before you're ready to connect the element.</p>

   <pre><code class='js'><c- a>const</c-> el <c- o>=</c-> document<c- p>.</c->createElement<c- p>(</c-><c- u>"spider-man"</c-><c- p>);</c->

<c- a>class</c-> SpiderMan <c- k>extends</c-> HTMLElement <c- p>{}</c->
customElements<c- p>.</c->define<c- p>(</c-><c- u>"spider-man"</c-><c- p>,</c-> SpiderMan<c- p>);</c->

console<c- p>.</c->assert<c- p>(</c-><c- o>!</c-><c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>));</c-> <c- c1>// not yet upgraded</c->

customElements<c- p>.</c->upgrade<c- p>(</c->el<c- p>);</c->
console<c- p>.</c->assert<c- p>(</c->el <c- k>instanceof</c-> SpiderMan<c- p>);</c->    <c- c1>// upgraded!</c-></code></pre>
  </div>

  

  <h4 id="custom-element-reactions"><span class="secno">4.13.5</span> Custom element reactions<a href="#custom-element-reactions" class="self-link"></a></h4>

  <p>A <a href="#custom-element" id="custom-element-reactions:custom-element">custom element</a> possesses the ability to respond to certain occurrences by running author code:</p>

  <ul><li><p>When <span>upgraded</span>, its <a href="#custom-element-constructor" id="custom-element-reactions:custom-element-constructor">constructor</a> is run, with no arguments.<li><p>When it <a id="custom-element-reactions:becomes-connected" href="infrastructure.html#becomes-connected">becomes connected</a>, its <code>connectedCallback</code> is called, with no arguments.<li><p>When it <a id="custom-element-reactions:becomes-disconnected" href="infrastructure.html#becomes-disconnected">becomes disconnected</a>, its <code>disconnectedCallback</code> is called, with no arguments.<li><p>When it is <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-adopt" id="custom-element-reactions:concept-node-adopt" data-x-internal="concept-node-adopt">adopted</a> into a new document, its <code>adoptedCallback</code> is called, given the old document and new document as arguments.<li><p>When any of its attributes are <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-change" id="custom-element-reactions:concept-element-attributes-change" data-x-internal="concept-element-attributes-change">changed</a>, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-append" id="custom-element-reactions:concept-element-attributes-append" data-x-internal="concept-element-attributes-append">appended</a>, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-remove" id="custom-element-reactions:concept-element-attributes-remove" data-x-internal="concept-element-attributes-remove">removed</a>, or <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-element-attributes-replace" id="custom-element-reactions:concept-element-attributes-replace" data-x-internal="concept-element-attributes-replace">replaced</a>, its <code>attributeChangedCallback</code> is called, given the attribute's local name, old value, new value, and namespace as arguments. (An attribute's old or new value is considered to be null when the attribute is added or removed, respectively.)<li><p>When the user agent <span>resets the form owner</span> of a <a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element">form-associated custom element</a> and doing so changes the form owner, its <code>formAssociatedCallback</code> is called, given the new form owner (or null if no owner) as an argument.<li><p>When the form owner of a <a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-2">form-associated custom element</a> is <span>reset</span>, its <code>formResetCallback</code> is called.<li><p>When the <a href="form-control-infrastructure.html#concept-fe-disabled" id="custom-element-reactions:concept-fe-disabled">disabled</a> state of a <a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-3">form-associated custom element</a> is changed, its <code>formDisabledCallback</code> is called, given the new state as an argument.<li><p>When user agent updates a <a href="#form-associated-custom-element" id="custom-element-reactions:form-associated-custom-element-4">form-associated custom element</a>'s value on behalf of a user or <a href="browsing-the-web.html#restore-persisted-state" id="custom-element-reactions:restore-persisted-state">as part of navigation</a>, its <code>formStateRestoreCallback</code> is called, given the new state and a string indicating a reason, "<code>autocomplete</code>" or "<code>restore</code>", as arguments.</ul>

  <p>We call these reactions collectively <dfn id="concept-custom-element-reaction">custom element reactions</dfn>.</p>

  <p>The way in which <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction">custom element reactions</a> are invoked is done with special care, to avoid running author code during the middle of delicate operations. Effectively, they are delayed until "just before returning to user script". This means that for most purposes they appear to execute synchronously, but in the case of complicated composite operations (like <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-clone" id="custom-element-reactions:concept-node-clone" data-x-internal="concept-node-clone">cloning</a>, or <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-range" id="custom-element-reactions:concept-range" data-x-internal="concept-range">range</a> manipulation), they will instead be delayed until after all the relevant user agent processing steps have completed, and then run together as a batch.</p>

  <p><span>It is guaranteed</span> that <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-2">custom element reactions</a> always are invoked in the same order as their triggering actions, at least within the local context of a single <a href="#custom-element" id="custom-element-reactions:custom-element-2">custom element</a>. (Because <a href="#concept-custom-element-reaction" id="custom-element-reactions:concept-custom-element-reaction-3">custom element reaction</a> code can perform its own mutations, it is not possible to give a global ordering guarantee across multiple elements.)</p>

  

  <h4 id="element-internals"><span class="secno">4.13.6</span> Element internals<a href="#element-internals" class="self-link"></a></h4>

  <p>Certain capabilities are meant to be available to a custom element author, but not to a custom element consumer. These are provided by the <code id="element-internals:dom-attachinternals"><a href="#dom-attachinternals">element.attachInternals()</a></code> method, which returns an instance of <code>ElementInternals</code>. The properties and methods of <code>ElementInternals</code> allow control over internal features which the user agent provides to all elements.</p>

  <dl class="domintro"><dt><code><var>element</var>.<span id="dom-attachinternals">attachInternals()</span></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/attachInternals" title="The HTMLElement.attachInternals() method returns an ElementInternals object. This method allows a custom element to participate in HTML forms. The ElementInternals interface provides utilities for working with these elements in the same way you would work with any standard HTML form element, and also exposes the Accessibility Object Model to the element.">HTMLElement/attachInternals</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>93+</span></span><span class="safari yes"><span>Safari</span><span>16.4+</span></span><span class="chrome yes"><span>Chrome</span><span>77+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>Returns an <code>ElementInternals</code> object targeting the <a href="#custom-element" id="element-internals:custom-element">custom element</a> <var>element</var>. Throws an exception if <var>element</var> is not a <a href="#custom-element" id="element-internals:custom-element-2">custom element</a>, if the "<code>internals</code>" feature was disabled as part of the element definition, or if it is called twice on the same element.</dl>

  

  <h5 id="shadow-root-access"><span class="secno">4.13.6.1</span> Shadow root access<a href="#shadow-root-access" class="self-link"></a></h5>

  <dl class="domintro"><dt><code><var>internals</var>.<span>shadowRoot</span></code><dd><p>Returns the <code id="shadow-root-access:shadowroot"><a data-x-internal="shadowroot" href="https://triple-underscore.github.io/DOM4-ja.html#interface-shadowroot">ShadowRoot</a></code> for <var>internals</var>'s <span>target element</span>, if the <span>target element</span> is a <a id="shadow-root-access:shadow-host" href="https://dom.spec.whatwg.org/#element-shadow-host" data-x-internal="shadow-host">shadow host</a>, or null otherwise.</dl>

  

  <h5 id="form-associated-custom-elements"><span class="secno">4.13.6.2</span> Form-associated custom elements<a href="#form-associated-custom-elements" class="self-link"></a></h5>

  <dl class="domintro"><dt><code><var>internals</var>.<span>setFormValue</span>(<var>value</var>)</code><dd><p>Sets both the <a href="#face-state" id="form-associated-custom-elements:face-state">state</a> and <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value">submission value</a> of <var>internals</var>'s <span>target element</span> to <var>value</var>.</p>

    <p>If <var>value</var> is null, the element won't participate in form submission.</p>
   <dt><code><var>internals</var>.<span>setFormValue</span>(<var>value</var>, <var>state</var>)</code><dd><p>Sets the <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-2">submission value</a> of <var>internals</var>'s <span>target element</span> to <var>value</var>, and its <a href="#face-state" id="form-associated-custom-elements:face-state-2">state</a> to <var>state</var>.</p>

    <p>If <var>value</var> is null, the element won't participate in form submission.</p>
   <dt><code><var>internals</var>.<span>form</span></code><dd><p>Returns the <a id="form-associated-custom-elements:form-owner" href="form-control-infrastructure.html#form-owner">form owner</a> of <var>internals</var>'s <span>target element</span>.<dt><code><var>internals</var>.<span>setValidity</span>(<var>flags</var>, <var>message</var> [, <var>anchor</var> ])</code><dd><p>Marks <var>internals</var>'s <span>target element</span> as suffering from the constraints indicated by the <var>flags</var> argument, and sets the element's validation message to <var>message</var>. If <var>anchor</var> is specified, the user agent might use it to indicate problems with the constraints of <var>internals</var>'s <span>target element</span> when the <a id="form-associated-custom-elements:form-owner-2" href="form-control-infrastructure.html#form-owner">form owner</a> is validated interactively or <code>reportValidity()</code> is called.<dt><code><var>internals</var>.<span>setValidity</span>({})</code><dd><p>Marks <var>internals</var>'s <span>target element</span> as <span>satisfying its constraints</span>.<dt><code><var>internals</var>.<span>willValidate</span></code><dd><p>Returns true if <var>internals</var>'s <span>target element</span> will be validated when the form is submitted; false otherwise.<dt><code><var>internals</var>.<span>validity</span></code><dd><p>Returns the <code>ValidityState</code> object for <var>internals</var>'s <span>target element</span>.<dt><code><var>internals</var>.<span>validationMessage</span></code><dd><p>Returns the error message that would be shown to the user if <var>internals</var>'s <span>target element</span> was to be checked for validity.<dt><code><var>valid</var> = <var>internals</var>.<span>checkValidity()</span></code><dd><p>Returns true if <var>internals</var>'s <span>target element</span> has no validity problems; false otherwise. Fires an <code id="form-associated-custom-elements:event-invalid"><a href="indices.html#event-invalid">invalid</a></code> event at the element in the latter case.<dt><code><var>valid</var> = <var>internals</var>.<span>reportValidity()</span></code><dd><p>Returns true if <var>internals</var>'s <span>target element</span> has no validity problems; otherwise, returns false, fires an <code id="form-associated-custom-elements:event-invalid-2"><a href="indices.html#event-invalid">invalid</a></code> event at the element, and (if the event isn't canceled) reports the problem to the user.<dt><code><var>internals</var>.<span>labels</span></code><dd><p>Returns a <code id="form-associated-custom-elements:nodelist"><a data-x-internal="nodelist" href="https://triple-underscore.github.io/DOM4-ja.html#interface-nodelist">NodeList</a></code> of all the <code id="form-associated-custom-elements:the-label-element"><a href="forms.html#the-label-element">label</a></code> elements that <var>internals</var>'s <span>target element</span> is associated with.</dl>

  <p>Each <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element">form-associated custom element</a> has <dfn id="face-submission-value">submission value</dfn>. It is used to provide one or more <span>entries</span> on form submission. The initial value of <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-3">submission value</a> is null, and <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-4">submission value</a> can be null, a string, a <code id="form-associated-custom-elements:file"><a data-x-internal="file" href="https://w3c.github.io/FileAPI/#dfn-file">File</a></code>, or a <a id="form-associated-custom-elements:list" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <span>entries</span>.</p>

  <p>Each <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-2">form-associated custom element</a> has <dfn id="face-state">state</dfn>. It is information with which the user agent can restore a user's input for the element. The initial value of <a href="#face-state" id="form-associated-custom-elements:face-state-3">state</a> is null, and <a href="#face-state" id="form-associated-custom-elements:face-state-4">state</a> can be null, a string, a <code id="form-associated-custom-elements:file-2"><a data-x-internal="file" href="https://w3c.github.io/FileAPI/#dfn-file">File</a></code>, or a <a id="form-associated-custom-elements:list-2" href="https://triple-underscore.github.io/infra-ja.html#list" data-x-internal="list">list</a> of <span>entries</span>.</p>

  <p>The <code>setFormValue()</code> method is used by the custom element author to set the element's <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-5">submission value</a> and <a href="#face-state" id="form-associated-custom-elements:face-state-5">state</a>, thus communicating these to the user agent.</p>

  <p>When the user agent believes it is a good idea to restore a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-3">form-associated custom element</a>'s <a href="#face-state" id="form-associated-custom-elements:face-state-6">state</a>, for example <a href="browsing-the-web.html#restore-persisted-state" id="form-associated-custom-elements:restore-persisted-state">after navigation</a> or restarting the user agent, they may <span>enqueue a custom element callback reaction</span> with that element, callback name "<code>formStateRestoreCallback</code>", and « the state to be restored, "<code>restore</code>" ».</p>

  <p>If the user agent has a form-filling assist feature, then when the feature is invoked, it may <span>enqueue a custom element callback reaction</span> with a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-4">form-associated custom element</a>, callback name "<code>formStateRestoreCallback</code>", and « the state value determined by history of state value and some heuristics, "<code>autocomplete</code>" ».</p>

  <p>In general, the <a href="#face-state" id="form-associated-custom-elements:face-state-7">state</a> is information specified by a user, and the <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-6">submission value</a> is a value after canonicalization or sanitization, suitable for submission to the server. The following examples makes this concrete:</p>

  <p class="example">Suppose that we have a <a href="#form-associated-custom-element" id="form-associated-custom-elements:form-associated-custom-element-5">form-associated custom element</a> which asks a user to specify a date. The user specifies <kbd>"3/15/2019"</kbd>, but the control wishes to submit <code>"2019-03-15"</code> to the server. <kbd>"3/15/2019"</kbd> would be a <a href="#face-state" id="form-associated-custom-elements:face-state-8">state</a> of the element, and <code>"2019-03-15"</code> would be a <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-7">submission value</a>.</p>

  <p class="example">Suppose you develop a custom element emulating a the behavior of the existing <a href="input.html#checkbox-state-(type=checkbox)" id="form-associated-custom-elements:checkbox-state-(type=checkbox)">checkbox</a> <code id="form-associated-custom-elements:the-input-element"><a href="input.html#the-input-element">input</a></code> type. Its <a href="#face-submission-value" id="form-associated-custom-elements:face-submission-value-8">submission value</a> would be the value of its <code>value</code> content attribute, or the string <code>"on"</code>. Its <a href="#face-state" id="form-associated-custom-elements:face-state-9">state</a> would be one of <code>"checked"</code>, <code>"unchecked"</code>, <code>"checked/indeterminate"</code>, or <code>"unchecked/indeterminate"</code>.</p>

  

  <h5 id="accessibility-semantics"><span class="secno">4.13.6.3</span> Accessibility semantics<a href="#accessibility-semantics" class="self-link"></a></h5>

  <dl class="domintro"><dt><code><var>internals</var>.<span><a href="#dom-ElementInternals-accessibility-idl-get">role</a></span> [ = <var>value</var> ]</code><dd><p>Sets or retrieves the default ARIA role for <var>internals</var>'s <span>target element</span>, which will be used unless the page author overrides it using the <code id="accessibility-semantics:attr-aria-role"><a href="infrastructure.html#attr-aria-role">role</a></code> attribute.<dt><code><var>internals</var>.<span><a href="#dom-ElementInternals-accessibility-idl-get">aria*</a></span> [ = <var>value</var> ]</code><dd><p>Sets or retrieves various default ARIA states or property values for <var>internals</var>'s <span>target element</span>, which will be used unless the page author overrides them using the <code id="accessibility-semantics:attr-aria-*"><a href="infrastructure.html#attr-aria-*">aria-*</a></code> attributes.</dl>

  <p>By using the <code>role</code> and <code>aria*</code> properties of <code>ElementInternals</code>, custom element authors can set default accessibile roles, states, and property values for their custom element, similar to how native elements behave. See <a href="#custom-elements-accessibility-example">the example above</a> for more details.</p>

  

  <h5 id="custom-state-pseudo-class"><span class="secno">4.13.6.4</span> Custom state pseudo-class<a href="#custom-state-pseudo-class" class="self-link"></a></h5>

  <dl class="domintro"><dt><code><var>internals</var>.<span>states</span>.add(<var>value</var>)</code><dd><p>Adds the string <var>value</var> to the element's <span>states set</span> to be exposed as a pseudo-class.</p>
   <dt><code><var>internals</var>.<span>states</span>.has(<var>value</var>)</code><dd><p>Returns true if <var>value</var> is in the element's <span>states set</span>, otherwise false.</p>
   <dt><code><var>internals</var>.<span>states</span>.delete(<var>value</var>)</code><dd><p>If the element's <span>states set</span> has <var>value</var>, then it will be removed and true will be returned. Otherwise, false will be returned.</p>
   <dt><code><var>internals</var>.<span>states</span>.clear()</code><dd><p>Removes all values from the element's <span>states set</span>.</p>
   <dt><code>for (const <var>stateName</var> of <var>internals</var>.<span>states</span>)</code><dt><code>for (const <var>stateName</var> of <var>internals</var>.<span>states</span>.entries())</code><dt><code>for (const <var>stateName</var> of <var>internals</var>.<span>states</span>.keys())</code><dt><code>for (const <var>stateName</var> of <var>internals</var>.<span>states</span>.values())</code><dd><p>Iterates over all values in the element's <span>states set</span>.</p>
   <dt><code><var>internals</var>.<span>states</span>.forEach(<var>callback</var>)</code><dd><p>Iterates over all values in the element's <span>states set</span> by calling <var>callback</var> once for each value.</p>
   <dt><code><var>internals</var>.<span>states</span>.size</code><dd><p>Returns the number of values in the element's <span>states set</span>.</p>
   </dl>

  

  <div class="example"><p>The <span>states set</span> can expose boolean states represented by existence/non-existence of string values. If an author wants to expose a state which can have three values, it can be converted to three exclusive boolean states. For example, a state called <code>readyState</code> with <code>"loading"</code>, <code>"interactive"</code>, and <code>"complete"</code> values can be mapped to three exclusive boolean states, <code>"loading"</code>, <code>"interactive"</code>, and <code>"complete"</code>:</p>

   <pre><code class='js'><c- c1>// Change the readyState from anything to "complete".</c->
<c- k>this</c-><c- p>.</c->_readyState <c- o>=</c-> <c- u>"complete"</c-><c- p>;</c->
<c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c-><c- k>delete</c-><c- p>(</c-><c- u>"loading"</c-><c- p>);</c->
<c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c-><c- k>delete</c-><c- p>(</c-><c- u>"interactive"</c-><c- p>);</c->
<c- k>this</c-><c- p>.</c->_internals<c- p>.</c->states<c- p>.</c->add<c- p>(</c-><c- u>"complete"</c-><c- p>);</c-></code></pre>
  </div>

  <nav><a href="canvas.html">← 4.12.5 canvas要素</a> – <a href="./">目次</a> – <a href="semantics-other.html">4.14 専用要素なしの一般的語彙 →</a></nav>

<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script async="" crossorigin="" src="./html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">18 October 2021</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="server-sent-events.html">← 9.2 Server-sent events</a> — <a href="./">目次</a> — <a href="web-messaging.html">9.4 Cross-document messaging →</a></nav><ol class="toc"><li id="toc-comms"><ol><li><a href="web-sockets.html#network"><span class="secno">9.3</span> Web sockets</a><ol><li><a href="web-sockets.html#network-intro"><span class="secno">9.3.1</span> Introduction</a><li><a href="web-sockets.html#the-websocket-interface"><span class="secno">9.3.2</span> The <code>WebSocket</code> interface</a><li><a href="web-sockets.html#feedback-from-the-protocol"><span class="secno">9.3.3</span> Feedback from the protocol</a><li><a href="web-sockets.html#ping-and-pong-frames"><span class="secno">9.3.4</span> Ping and Pong frames</a><li><a href="web-sockets.html#the-closeevent-interface"><span class="secno">9.3.5</span> The <code>CloseEvent</code> interface</a><li><a href="web-sockets.html#garbage-collection-2"><span class="secno">9.3.6</span> Garbage collection</a></ol></ol></ol><h3 id="network"><span class="secno">9.3</span> <dfn>Web sockets</dfn><a href="#network" class="self-link"></a></h3>

  <h4 id="network-intro"><span class="secno">9.3.1</span> Introduction<a href="#network-intro" class="self-link"></a></h4>

  <p><i>この節は非規範的である。</i></p>

  <p>To enable web applications to maintain bidirectional communications with server-side processes, this specification introduces the <code id="network-intro:websocket"><a href="#websocket">WebSocket</a></code> interface.</p>

  <p class="note">This interface does not allow for raw access to the underlying network. For example, this interface could not be used to implement an IRC client without proxying messages through a custom server.</p>


  <h4 id="the-websocket-interface"><span class="secno">9.3.2</span> The <code id="the-websocket-interface:websocket"><a href="#websocket">WebSocket</a></code> interface<a href="#the-websocket-interface" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket" title="The WebSocket object provides the API for creating and managing a WebSocket connection to a server, as well as for sending and receiving data on the connection.">WebSocket</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>11+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>14+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div>

  <pre><code class='idl'><c- b>enum</c-> <dfn id='binarytype' data-dfn-type='enum'><c- g>BinaryType</c-></dfn> { <c- s>"</c-><a href='#dom-binarytype-blob' id='the-websocket-interface:dom-binarytype-blob'><c- s>blob</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-binarytype-arraybuffer' id='the-websocket-interface:dom-binarytype-arraybuffer'><c- s>arraybuffer</c-></a><c- s>"</c-> };
[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='websocket' data-dfn-type='interface'><c- g>WebSocket</c-></dfn> : <a id='the-websocket-interface:eventtarget' href='https://triple-underscore.github.io/DOM4-ja.html#interface-eventtarget' data-x-internal='eventtarget'><c- n>EventTarget</c-></a> {
  <a href='#dom-websocket' id='the-websocket-interface:dom-websocket'><c- g>constructor</c-></a>(<c- b>USVString</c-> <c- g>url</c->, <c- b>optional</c-> (<c- b>DOMString</c-> <c- b>or</c-> <c- b>sequence</c->&lt;<c- b>DOMString</c->>) <c- g>protocols</c-> = []);

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-websocket-url' id='the-websocket-interface:dom-websocket-url'><c- g>url</c-></a>;

  // ready state
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-websocket-connecting' id='the-websocket-interface:dom-websocket-connecting'><c- g>CONNECTING</c-></a> = 0;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-websocket-open' id='the-websocket-interface:dom-websocket-open'><c- g>OPEN</c-></a> = 1;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-websocket-closing' id='the-websocket-interface:dom-websocket-closing'><c- g>CLOSING</c-></a> = 2;
  <c- b>const</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-websocket-closed' id='the-websocket-interface:dom-websocket-closed'><c- g>CLOSED</c-></a> = 3;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-websocket-readystate' id='the-websocket-interface:dom-websocket-readystate'><c- g>readyState</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>long</c-> <c- b>long</c-> <a href='#dom-websocket-bufferedamount' id='the-websocket-interface:dom-websocket-bufferedamount'><c- g>bufferedAmount</c-></a>;

  // networking
  <c- b>attribute</c-> <a id='the-websocket-interface:eventhandler' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-websocket-onopen' id='the-websocket-interface:handler-websocket-onopen'><c- g>onopen</c-></a>;
  <c- b>attribute</c-> <a id='the-websocket-interface:eventhandler-2' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-websocket-onerror' id='the-websocket-interface:handler-websocket-onerror'><c- g>onerror</c-></a>;
  <c- b>attribute</c-> <a id='the-websocket-interface:eventhandler-3' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-websocket-onclose' id='the-websocket-interface:handler-websocket-onclose'><c- g>onclose</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-websocket-extensions' id='the-websocket-interface:dom-websocket-extensions'><c- g>extensions</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>DOMString</c-> <a href='#dom-websocket-protocol' id='the-websocket-interface:dom-websocket-protocol'><c- g>protocol</c-></a>;
  <c- b>undefined</c-> <a href='#dom-websocket-close' id='the-websocket-interface:dom-websocket-close'><c- g>close</c-></a>(<c- b>optional</c-> [<c- g>Clamp</c->] <c- b>unsigned</c-> <c- b>short</c-> <c- g>code</c->, <c- b>optional</c-> <a href='https://webidl.spec.whatwg.org/#idl-USVString' id='the-websocket-interface:idl-usvstring' data-x-internal='idl-usvstring'><c- b>USVString</c-></a> <c- g>reason</c->);

  // messaging
  <c- b>attribute</c-> <a id='the-websocket-interface:eventhandler-4' href='webappapis.html#eventhandler'><c- n>EventHandler</c-></a> <a href='#handler-websocket-onmessage' id='the-websocket-interface:handler-websocket-onmessage'><c- g>onmessage</c-></a>;
  <c- b>attribute</c-> <a href='#binarytype' id='the-websocket-interface:binarytype'><c- n>BinaryType</c-></a> <a href='#dom-websocket-binarytype' id='the-websocket-interface:dom-websocket-binarytype'><c- g>binaryType</c-></a>;
  <c- b>undefined</c-> <a href='#dom-websocket-send' id='the-websocket-interface:dom-websocket-send'><c- g>send</c-></a>(<a href='https://webidl.spec.whatwg.org/#idl-USVString' id='the-websocket-interface:idl-usvstring-2' data-x-internal='idl-usvstring'><c- b>USVString</c-></a> <c- g>data</c->);
  <c- b>undefined</c-> <a href='#dom-websocket-send' id='the-websocket-interface:dom-websocket-send-2'><c- g>send</c-></a>(<a id='the-websocket-interface:blob' href='https://triple-underscore.github.io/File_API-ja.html#dfn-Blob' data-x-internal='blob'><c- n>Blob</c-></a> <c- g>data</c->);
  <c- b>undefined</c-> <a href='#dom-websocket-send' id='the-websocket-interface:dom-websocket-send-3'><c- g>send</c-></a>(<a href='https://webidl.spec.whatwg.org/#idl-ArrayBuffer' id='the-websocket-interface:idl-arraybuffer' data-x-internal='idl-arraybuffer'><c- b>ArrayBuffer</c-></a> <c- g>data</c->);
  <c- b>undefined</c-> <a href='#dom-websocket-send' id='the-websocket-interface:dom-websocket-send-4'><c- g>send</c-></a>(<a href='https://webidl.spec.whatwg.org/#common-ArrayBufferView' id='the-websocket-interface:idl-arraybufferview' data-x-internal='idl-arraybufferview'><c- n>ArrayBufferView</c-></a> <c- g>data</c->);
};</code></pre>

  <p>Each <code id="the-websocket-interface:websocket-2"><a href="#websocket">WebSocket</a></code> object has an associated <dfn id="concept-websocket-url">url</dfn> (a <a id="the-websocket-interface:url-record" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url-record">URL record</a>).<dl class="domintro"><dt><code><var>socket</var> = new <a href="#dom-websocket" id="dom-websocket-dev">WebSocket</a>(<var>url</var> [, <var>protocols</var> ])</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/WebSocket" title="The WebSocket() constructor returns a new WebSocket object.">WebSocket/WebSocket</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>11+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>14+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Creates a new <code id="the-websocket-interface:websocket-3"><a href="#websocket">WebSocket</a></code> object, immediately establishing the associated WebSocket connection.</p>

    <p><var>url</var> is a string giving the <a id="the-websocket-interface:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> over which the connection is established. Only "<code>ws</code>" or "<code>wss</code>" schemes are allowed; others will cause a <a id="the-websocket-interface:syntaxerror" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>. URLs with <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="the-websocket-interface:concept-url-fragment" data-x-internal="concept-url-fragment">fragments</a> will also cause such an exception.</p>

    <p><var>protocols</var> is either a string or an array of strings. If it is a string, it is equivalent to an array consisting of just that string; if it is omitted, it is equivalent to the empty array. Each string in the array is a subprotocol name. The connection will only be established if the server reports that it has selected one of these subprotocols. The subprotocol names have to match the requirements for elements that comprise the value of <code id="the-websocket-interface:http-sec-websocket-protocol"><a href="infrastructure.html#http-sec-websocket-protocol">Sec-WebSocket-Protocol</a></code> fields as defined by <cite>The WebSocket protocol</cite>. <a href="references.html#refsWSP">[WSP]</a></p>
   <dt><code><var>socket</var>.<a href="#dom-websocket-send" id="dom-websocket-send-dev">send</a>(<var>data</var>)</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send" title="The WebSocket.send() method enqueues the specified data to be transmitted to the server over the WebSocket connection, increasing the value of bufferedAmount by the number of bytes needed to contain the data. If the data can't be sent (for example, because it needs to be buffered but the buffer is full), the socket is closed automatically.">WebSocket/send</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>18+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>18+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Transmits <var>data</var> using the WebSocket connection. <var>data</var> can be a string, a <code id="the-websocket-interface:blob-2"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>, an <code id="the-websocket-interface:idl-arraybuffer-2"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code>, or an <code id="the-websocket-interface:idl-arraybufferview-2"><a data-x-internal="idl-arraybufferview" href="https://webidl.spec.whatwg.org/#common-ArrayBufferView">ArrayBufferView</a></code>.</p>
  <dt><code><var>socket</var>.<a href="#dom-websocket-close" id="dom-websocket-close-dev">close</a>([ <var>code</var> ] [, <var>reason</var> ])</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/close" title="The WebSocket.close() method closes the WebSocket connection or connection attempt, if any. If the connection is already CLOSED, this method does nothing.">WebSocket/close</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Closes the WebSocket connection, optionally using <var>code</var> as <a href="infrastructure.html#concept-websocket-close-code" id="the-websocket-interface:concept-websocket-close-code">the WebSocket connection close code</a> and <var>reason</var> as the <a href="infrastructure.html#concept-websocket-close-reason" id="the-websocket-interface:concept-websocket-close-reason">the WebSocket connection close reason</a>.</p>
   <dt><code><var>socket</var>.<a href="#dom-websocket-url" id="dom-websocket-url-dev">url</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/url" title="The WebSocket.url read-only property returns the absolute URL of the WebSocket as resolved by the constructor.">WebSocket/url</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>18+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns the <a href="#concept-websocket-url" id="the-websocket-interface:concept-websocket-url">URL that was used</a> to establish the WebSocket connection.</p>
   <dt><code><var>socket</var>.<a href="#dom-websocket-readystate" id="dom-websocket-readystate-dev">readyState</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/readyState" title="The WebSocket.readyState read-only property returns the current state of the WebSocket connection.">WebSocket/readyState</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns the state of the <code id="the-websocket-interface:websocket-4"><a href="#websocket">WebSocket</a></code> object's connection. It can have the values described below.</p>
   <dt><code><var>socket</var>.<a href="#dom-websocket-bufferedamount" id="dom-websocket-bufferedamount-dev">bufferedAmount</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/bufferedAmount" title="The WebSocket.bufferedAmount read-only property returns the number of bytes of data that have been queued using calls to send() but not yet transmitted to the network. This value resets to zero once all queued data has been sent. This value does not reset to zero when the connection is closed; if you keep calling send(), this will continue to climb.">WebSocket/bufferedAmount</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns the number of bytes of application data (UTF-8 text and binary data) that have been queued using <code id="the-websocket-interface:dom-websocket-send-5"><a href="#dom-websocket-send">send()</a></code> but not yet been transmitted to the network.</p>

    <p>If the WebSocket connection is closed, this attribute's value will only increase with each call to the <code id="the-websocket-interface:dom-websocket-send-6"><a href="#dom-websocket-send">send()</a></code> method. (The number does not reset to zero once the connection closes.)</p>
   <dt><code><var>socket</var>.<a href="#dom-websocket-extensions" id="dom-websocket-extensions-dev">extensions</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/extensions" title="The WebSocket.extensions read-only property returns the extensions selected by the server. This is currently only the empty string or a list of extensions as negotiated by the connection.">WebSocket/extensions</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>8+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>16+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>8+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns the extensions selected by the server, if any.<dt><code><var>socket</var>.<a href="#dom-websocket-protocol" id="dom-websocket-protocol-dev">protocol</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/protocol" title="The WebSocket.protocol read-only property returns the name of the sub-protocol the server selected; this will be one of the strings specified in the protocols parameter when creating the WebSocket object, or the empty string if no connection is established.">WebSocket/protocol</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>15+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns the subprotocol selected by the server, if any. It can be used in conjunction with the array form of the constructor's second argument to perform subprotocol negotiation.<dt><code><var>socket</var>.<a href="#dom-websocket-binarytype" id="dom-websocket-binarytype-dev">binaryType</a> [ = <var>value</var> ]</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/binaryType" title="The WebSocket.binaryType property controls the type of binary data being received over the WebSocket connection.">WebSocket/binaryType</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>11+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>15+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>14+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><dd><p>Returns a string that indicates how binary data from the <code id="the-websocket-interface:websocket-5"><a href="#websocket">WebSocket</a></code> object is exposed to scripts:</p>

    <dl><dt>"<code id="the-websocket-interface:dom-binarytype-blob-2"><a href="#dom-binarytype-blob">blob</a></code>"<dd><p>Binary data is returned in <code id="the-websocket-interface:blob-3"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> form.<dt>"<code id="the-websocket-interface:dom-binarytype-arraybuffer-2"><a href="#dom-binarytype-arraybuffer">arraybuffer</a></code>"<dd><p>Binary data is returned in <code id="the-websocket-interface:idl-arraybuffer-3"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> form.</dl>

    <p>Can be set, to change how binary data is returned. The default is "<code id="the-websocket-interface:dom-binarytype-blob-3"><a href="#dom-binarytype-blob">blob</a></code>".</p>
   </dl>

  

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket" data-dfn-type="constructor" data-lt="WebSocket(url, protocols)"><code>new WebSocket(<var>url</var>, <var>protocols</var>)</code></dfn> constructor steps are:</p>

  <ol><li><p>Let <var>urlRecord</var> be the result of applying the <a id="the-websocket-interface:url-parser" href="https://triple-underscore.github.io/URL-ja.html#concept-url-parser" data-x-internal="url-parser">URL parser</a> to <var>url</var>.<li><p>If <var>urlRecord</var> is failure, then throw a <a id="the-websocket-interface:syntaxerror-2" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception-2"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>If <var>urlRecord</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="the-websocket-interface:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> is not "<code>ws</code>" or "<code>wss</code>", then throw a <a id="the-websocket-interface:syntaxerror-3" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception-3"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>If <var>urlRecord</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-fragment" id="the-websocket-interface:concept-url-fragment-2" data-x-internal="concept-url-fragment">fragment</a> is non-null, then throw a <a id="the-websocket-interface:syntaxerror-4" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception-4"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>If <var>protocols</var> is a string, set <var>protocols</var> to a sequence consisting of just that string.<li><p>If any of the values in <var>protocols</var> occur more than once or otherwise fail to match the requirements for elements that comprise the value of <code id="the-websocket-interface:http-sec-websocket-protocol-2"><a href="infrastructure.html#http-sec-websocket-protocol">Sec-WebSocket-Protocol</a></code> fields as defined by <cite>The WebSocket protocol</cite>, then throw a <a id="the-websocket-interface:syntaxerror-5" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception-5"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>. <a href="references.html#refsWSP">[WSP]</a><li><p>Set <a id="the-websocket-interface:this" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a>'s <a href="#concept-websocket-url" id="the-websocket-interface:concept-websocket-url-2">url</a> to <var>urlRecord</var>.<li><p>Let <var>client</var> be <a id="the-websocket-interface:this-2" href="https://webidl.spec.whatwg.org/#this" data-x-internal="this">this</a>'s <a id="the-websocket-interface:relevant-settings-object" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>Run this step <a id="the-websocket-interface:in-parallel" href="infrastructure.html#in-parallel">in parallel</a>:</p>

    <ol><li><p><a href="https://triple-underscore.github.io/Fetch-ja.html#concept-websocket-establish" id="the-websocket-interface:concept-websocket-establish" data-x-internal="concept-websocket-establish">Establish a WebSocket connection</a> given <var>urlRecord</var>, <var>protocols</var>, and <var>client</var>. <a href="references.html#refsFETCH">[FETCH]</a></p>

      <p class="note">If the <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-websocket-establish" id="the-websocket-interface:concept-websocket-establish-2" data-x-internal="concept-websocket-establish">establish a WebSocket connection</a> algorithm fails, it triggers the <i id="the-websocket-interface:concept-websocket-fail"><a href="infrastructure.html#concept-websocket-fail">fail the WebSocket connection</a></i> algorithm, which then invokes the <i id="the-websocket-interface:concept-websocket-close"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i> algorithm, which then establishes that <i id="the-websocket-interface:concept-websocket-closed"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection is closed</a></i>, which fires the <code id="the-websocket-interface:event-close"><a href="indices.html#event-close">close</a></code> event <a href="#closeWebSocket">as described below</a>.</p>
     </ol>
   </ol>

  <hr>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-url" data-dfn-type="attribute"><code>url</code></dfn> attribute's getter must return this <code id="the-websocket-interface:websocket-6"><a href="#websocket">WebSocket</a></code> object's <a href="#concept-websocket-url" id="the-websocket-interface:concept-websocket-url-3">url</a>, <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="the-websocket-interface:concept-url-serializer" data-x-internal="concept-url-serializer">serialized</a>.</p>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-readystate" data-dfn-type="attribute"><code>readyState</code></dfn> attribute represents the state of the connection. It can have the following values:</p>

  

  

  <dl><dt><dfn data-dfn-for="WebSocket" id="dom-websocket-connecting" data-dfn-type="const"><code>CONNECTING</code></dfn> (numeric value 0)<dd>The connection has not yet been established.<dt><dfn data-dfn-for="WebSocket" id="dom-websocket-open" data-dfn-type="const"><code>OPEN</code></dfn> (numeric value 1)<dd><i id="the-websocket-interface:concept-websocket-established"><a href="infrastructure.html#concept-websocket-established">The WebSocket connection is established</a></i> and communication is possible.<dt><dfn data-dfn-for="WebSocket" id="dom-websocket-closing" data-dfn-type="const"><code>CLOSING</code></dfn> (numeric value 2)<dd>The connection is going through the closing handshake, or the <code id="the-websocket-interface:dom-websocket-close-2"><a href="#dom-websocket-close">close()</a></code> method has been invoked.<dt><dfn data-dfn-for="WebSocket" id="dom-websocket-closed" data-dfn-type="const"><code>CLOSED</code></dfn> (numeric value 3)<dd>The connection has been closed or could not be opened.</dl>

  

  <p>When the object is created its <code id="the-websocket-interface:dom-websocket-readystate-2"><a href="#dom-websocket-readystate">readyState</a></code> must be set to <code id="the-websocket-interface:dom-websocket-connecting-2"><a href="#dom-websocket-connecting">CONNECTING</a></code> (0).</p>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-extensions" data-dfn-type="attribute"><code>extensions</code></dfn> attribute must initially return the empty string. After <i id="the-websocket-interface:concept-websocket-established-2"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, its value might change, as defined below.</p>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-protocol" data-dfn-type="attribute"><code>protocol</code></dfn> attribute must initially return the empty string. After <i id="the-websocket-interface:concept-websocket-established-3"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, its value might change, as defined below.</p>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-close" data-dfn-type="method"><code>close(<var>code</var>, <var>reason</var>)</code></dfn> method, when invoked, must run these steps:</p>

  <ol><li><p>If <var>code</var> is present, but is neither an integer equal to 1000 nor an integer in the range 3000 to 4999, inclusive, throw an <a id="the-websocket-interface:invalidaccesserror" href="https://webidl.spec.whatwg.org/#invalidaccesserror" data-x-internal="invalidaccesserror">"<code>InvalidAccessError</code>"</a> <code id="the-websocket-interface:domexception-6"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.<li><p>If <var>reason</var> is present, then run these substeps:</p>

    <ol><li><p>Let <var>reasonBytes</var> be the result of <a href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-encode" id="the-websocket-interface:utf-8-encode" data-x-internal="utf-8-encode">encoding</a> <var>reason</var>.<li><p>If <var>reasonBytes</var> is longer than 123 bytes, then throw a <a id="the-websocket-interface:syntaxerror-6" href="https://webidl.spec.whatwg.org/#syntaxerror" data-x-internal="syntaxerror">"<code>SyntaxError</code>"</a> <code id="the-websocket-interface:domexception-7"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>.</ol>
   <li><p>Run the first matching steps from the following list:</p>

    <dl class="switch"><dt>If the <code id="the-websocket-interface:dom-websocket-readystate-3"><a href="#dom-websocket-readystate">readyState</a></code> attribute is in the <code id="the-websocket-interface:dom-websocket-closing-2"><a href="#dom-websocket-closing">CLOSING</a></code> (2) or <code id="the-websocket-interface:dom-websocket-closed-2"><a href="#dom-websocket-closed">CLOSED</a></code> (3) state<dd><p>Do nothing.</p>

      <p class="note">The connection is already closing or is already closed. If it has not already, a <code id="the-websocket-interface:event-close-2"><a href="indices.html#event-close">close</a></code> event will eventually fire <a href="#closeWebSocket">as described below</a>.</p>
     <dt>If the WebSocket connection is not yet <i id="the-websocket-interface:concept-websocket-established-4"><a href="infrastructure.html#concept-websocket-established">established</a></i> <a href="references.html#refsWSP">[WSP]</a><dd><p><i id="the-websocket-interface:concept-websocket-fail-2"><a href="infrastructure.html#concept-websocket-fail">Fail the WebSocket connection</a></i> and set the <code id="the-websocket-interface:dom-websocket-readystate-4"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="the-websocket-interface:dom-websocket-closing-3"><a href="#dom-websocket-closing">CLOSING</a></code> (2). <a href="references.html#refsWSP">[WSP]</a></p>

      <p class="note">The <i id="the-websocket-interface:concept-websocket-fail-3"><a href="infrastructure.html#concept-websocket-fail">fail the WebSocket connection</a></i> algorithm invokes the <i id="the-websocket-interface:concept-websocket-close-2"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i> algorithm, which then establishes that <i id="the-websocket-interface:concept-websocket-closed-2"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection is closed</a></i>, which fires the <code id="the-websocket-interface:event-close-3"><a href="indices.html#event-close">close</a></code> event <a href="#closeWebSocket">as described below</a>.</p>
     <dt>If the WebSocket closing handshake has not yet been <i id="the-websocket-interface:concept-websocket-closing-handshake"><a href="infrastructure.html#concept-websocket-closing-handshake">started</a></i> <a href="references.html#refsWSP">[WSP]</a><dd><p><i id="the-websocket-interface:concept-websocket-start-closing-handshake"><a href="infrastructure.html#concept-websocket-start-closing-handshake">Start the WebSocket closing handshake</a></i> and set the <code id="the-websocket-interface:dom-websocket-readystate-5"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="the-websocket-interface:dom-websocket-closing-4"><a href="#dom-websocket-closing">CLOSING</a></code> (2). <a href="references.html#refsWSP">[WSP]</a></p>

      <p>If neither <var>code</var> nor <var>reason</var> is present, the WebSocket Close message must not have a body.</p>

      <p class="note"><cite>WebSocket Protocol</cite> erroneously states that the status code is required for the <i id="the-websocket-interface:concept-websocket-start-closing-handshake-2"><a href="infrastructure.html#concept-websocket-start-closing-handshake">start the WebSocket closing handshake</a></i> algorithm.</p>

      <p>If <var>code</var> is present, then the status code to use in the WebSocket Close message must be the integer given by <var>close</var>. <a href="references.html#refsWSP">[WSP]</a></p>

      <p>If <var>reason</var> is also present, then <var>reasonBytes</var> must be provided in the Close message after the status code. <a href="references.html#refsWSP">[WSP]</a></p>

      <p class="note">The <i id="the-websocket-interface:concept-websocket-start-closing-handshake-3"><a href="infrastructure.html#concept-websocket-start-closing-handshake">start the WebSocket closing handshake</a></i> algorithm eventually invokes the <i id="the-websocket-interface:concept-websocket-close-3"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i> algorithm, which then establishes that <i id="the-websocket-interface:concept-websocket-closed-3"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection is closed</a></i>, which fires the <code id="the-websocket-interface:event-close-4"><a href="indices.html#event-close">close</a></code> event <a href="#closeWebSocket">as described below</a>.</p>
     <dt>そうでなければ<dd><p>Set the <code id="the-websocket-interface:dom-websocket-readystate-6"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="the-websocket-interface:dom-websocket-closing-5"><a href="#dom-websocket-closing">CLOSING</a></code> (2).</p>

      <p class="note"><i id="the-websocket-interface:concept-websocket-closing-handshake-2"><a href="infrastructure.html#concept-websocket-closing-handshake">The WebSocket closing handshake is started</a></i>, and will eventually invoke the <i id="the-websocket-interface:concept-websocket-close-4"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i> algorithm, which will establish that <i id="the-websocket-interface:concept-websocket-closed-4"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection is closed</a></i>, and thus the <code id="the-websocket-interface:event-close-5"><a href="indices.html#event-close">close</a></code> event will fire, <a href="#closeWebSocket">as described below</a>.</p>
     </dl>
   </ol>

  

  <p class="note">The <code id="the-websocket-interface:dom-websocket-close-3"><a href="#dom-websocket-close">close()</a></code> method does not discard previously sent messages before starting the WebSocket closing handshake — even if, in practice, the user agent is still busy sending those messages, the handshake will only start after the messages are sent.</p> 

  <hr>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-bufferedamount" data-dfn-type="attribute"><code>bufferedAmount</code></dfn> attribute must return the number of bytes of application data (UTF-8 text and binary data) that have been queued using <code id="the-websocket-interface:dom-websocket-send-7"><a href="#dom-websocket-send">send()</a></code> but that, as of the last time the <a id="the-websocket-interface:event-loop" href="webappapis.html#event-loop">event loop</a> reached <a href="webappapis.html#step1">step 1</a>, had not yet been transmitted to the network. (This thus includes any text sent during the execution of the current task, regardless of whether the user agent is able to transmit text in the background <a id="the-websocket-interface:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a> with script execution.) This does not include framing overhead incurred by the protocol, or buffering done by the operating system or network hardware.</p>

  <div class="example"><p>In this simple example, the <code id="the-websocket-interface:dom-websocket-bufferedamount-2"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute is used to ensure that updates are sent either at the rate of one update every 50ms, if the network can handle that rate, or at whatever rate the network <em>can</em> handle, if that is too fast.</p>

   <pre><code class='js'><c- a>var</c-> socket <c- o>=</c-> <c- k>new</c-> WebSocket<c- p>(</c-><c- t>'ws://game.example.com:12010/updates'</c-><c- p>);</c->
socket<c- p>.</c->onopen <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
  setInterval<c- p>(</c-><c- a>function</c-><c- p>()</c-> <c- p>{</c->
    <c- k>if</c-> <c- p>(</c->socket<c- p>.</c->bufferedAmount <c- o>==</c-> <c- mf>0</c-><c- p>)</c->
      socket<c- p>.</c->send<c- p>(</c->getUpdateData<c- p>());</c->
  <c- p>},</c-> <c- mf>50</c-><c- p>);</c->
<c- p>};</c-></code></pre>

   <p>The <code id="the-websocket-interface:dom-websocket-bufferedamount-3"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute can also be used to saturate the network without sending the data at a higher rate than the network can handle, though this requires more careful monitoring of the value of the attribute over time.</p>

  </div>

  <hr>

  

  <p>When a <code id="the-websocket-interface:websocket-7"><a href="#websocket">WebSocket</a></code> object is created, its <dfn data-dfn-for="WebSocket" id="dom-websocket-binarytype" data-dfn-type="attribute"><code>binaryType</code></dfn> IDL attribute must be set to the string "<code id="the-websocket-interface:dom-binarytype-blob-4"><a href="#dom-binarytype-blob">blob</a></code>". On getting, it must return the last value it was set to. On setting, the user agent must set the IDL attribute to the new value.</p>

  <p class="note">User agents can use the <code id="the-websocket-interface:dom-websocket-binarytype-2"><a href="#dom-websocket-binarytype">binaryType</a></code> attribute as a hint for how to handle incoming binary data: if the attribute is set to "<code id="the-websocket-interface:dom-binarytype-blob-5"><a href="#dom-binarytype-blob">blob</a></code>", it is safe to spool it to disk, and if it is set to "<code id="the-websocket-interface:dom-binarytype-arraybuffer-3"><a href="#dom-binarytype-arraybuffer">arraybuffer</a></code>", it is likely more efficient to keep the data in memory. Naturally, user agents are encouraged to use more subtle heuristics to decide whether to keep incoming data in memory or not, e.g. based on how big the data is or how common it is for a script to change the attribute at the last minute. This latter aspect is important in particular because it is quite possible for the attribute to be changed after the user agent has received the data but before the user agent has fired the event for it.</p>

  <p>The <dfn data-dfn-for="WebSocket" id="dom-websocket-send" data-dfn-type="method"><code>send(<var>data</var>)</code></dfn> method transmits data using the connection. If the <code id="the-websocket-interface:dom-websocket-readystate-7"><a href="#dom-websocket-readystate">readyState</a></code> attribute is <code id="the-websocket-interface:dom-websocket-connecting-3"><a href="#dom-websocket-connecting">CONNECTING</a></code>, it must throw an <a id="the-websocket-interface:invalidstateerror" href="https://webidl.spec.whatwg.org/#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="the-websocket-interface:domexception-8"><a data-x-internal="domexception" href="https://webidl.spec.whatwg.org/#dfn-DOMException">DOMException</a></code>. Otherwise, the user agent must run the appropriate set of steps from the following list:</p>

  <dl><dt>If the argument is a string<dd><p>If <i id="the-websocket-interface:concept-websocket-established-5"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i> and <i id="the-websocket-interface:concept-websocket-closing-handshake-3"><a href="infrastructure.html#concept-websocket-closing-handshake">the WebSocket closing handshake has not yet started</a></i>, then the user agent must <i id="the-websocket-interface:concept-websocket-send"><a href="infrastructure.html#concept-websocket-send">send a WebSocket Message</a></i> comprised of the <var>data</var> argument using a text frame opcode; if the data cannot be sent, e.g. because it would need to be buffered but the buffer is full, the user agent must <a href="#concept-websocket-close-fail" id="the-websocket-interface:concept-websocket-close-fail">flag the WebSocket as full</a> and then <i id="the-websocket-interface:concept-websocket-close-5"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i>. Any invocation of this method with a string argument that does not throw an exception must increase the <code id="the-websocket-interface:dom-websocket-bufferedamount-4"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute by the number of bytes needed to express the argument as UTF-8. <a href="references.html#refsUNICODE">[UNICODE]</a> <a href="references.html#refsENCODING">[ENCODING]</a> <a href="references.html#refsWSP">[WSP]</a></p>
   <dt>If the argument is a <code id="the-websocket-interface:blob-4"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> object<dd><p>If <i id="the-websocket-interface:concept-websocket-established-6"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, and <i id="the-websocket-interface:concept-websocket-closing-handshake-4"><a href="infrastructure.html#concept-websocket-closing-handshake">the WebSocket closing handshake has not yet started</a></i>, then the user agent must <i id="the-websocket-interface:concept-websocket-send-2"><a href="infrastructure.html#concept-websocket-send">send a WebSocket Message</a></i> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent, e.g. because it would need to be buffered but the buffer is full, the user agent must <a href="#concept-websocket-close-fail" id="the-websocket-interface:concept-websocket-close-fail-2">flag the WebSocket as full</a> and then <i id="the-websocket-interface:concept-websocket-close-6"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i>. The data to be sent is the raw data represented by the <code id="the-websocket-interface:blob-5"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> object. Any invocation of this method with a <code id="the-websocket-interface:blob-6"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> argument that does not throw an exception must increase the <code id="the-websocket-interface:dom-websocket-bufferedamount-5"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute by the size of the <code id="the-websocket-interface:blob-7"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> object's raw data, in bytes. <a href="references.html#refsWSP">[WSP]</a> <a href="references.html#refsFILEAPI">[FILEAPI]</a></p>
   <dt>If the argument is an <code id="the-websocket-interface:idl-arraybuffer-4"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> object<dd><p>If <i id="the-websocket-interface:concept-websocket-established-7"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, and <i id="the-websocket-interface:concept-websocket-closing-handshake-5"><a href="infrastructure.html#concept-websocket-closing-handshake">the WebSocket closing handshake has not yet started</a></i>, then the user agent must <i id="the-websocket-interface:concept-websocket-send-3"><a href="infrastructure.html#concept-websocket-send">send a WebSocket Message</a></i> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent, e.g. because it would need to be buffered but the buffer is full, the user agent must <a href="#concept-websocket-close-fail" id="the-websocket-interface:concept-websocket-close-fail-3">flag the WebSocket as full</a> and then <i id="the-websocket-interface:concept-websocket-close-7"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i>. The data to be sent is the data stored in the buffer described by the <code id="the-websocket-interface:idl-arraybuffer-5"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> object. Any invocation of this method with an <code id="the-websocket-interface:idl-arraybuffer-6"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> argument that does not throw an exception must increase the <code id="the-websocket-interface:dom-websocket-bufferedamount-6"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute by the length of the <code id="the-websocket-interface:idl-arraybuffer-7"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> in bytes. <a href="references.html#refsWSP">[WSP]</a></p>
   <dt>If the argument is an object that matches the <code id="the-websocket-interface:idl-arraybufferview-3"><a data-x-internal="idl-arraybufferview" href="https://webidl.spec.whatwg.org/#common-ArrayBufferView">ArrayBufferView</a></code> type definition<dd><p>If <i id="the-websocket-interface:concept-websocket-established-8"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, and <i id="the-websocket-interface:concept-websocket-closing-handshake-6"><a href="infrastructure.html#concept-websocket-closing-handshake">the WebSocket closing handshake has not yet started</a></i>, then the user agent must <i id="the-websocket-interface:concept-websocket-send-4"><a href="infrastructure.html#concept-websocket-send">send a WebSocket Message</a></i> comprised of <var>data</var> using a binary frame opcode; if the data cannot be sent, e.g. because it would need to be buffered but the buffer is full, the user agent must <a href="#concept-websocket-close-fail" id="the-websocket-interface:concept-websocket-close-fail-4">flag the WebSocket as full</a> and then <i id="the-websocket-interface:concept-websocket-close-8"><a href="infrastructure.html#concept-websocket-close">close the WebSocket connection</a></i>. The data to be sent is the data stored in the section of the buffer described by the <code id="the-websocket-interface:idl-arraybuffer-8"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> object that <var>data</var> references. Any invocation of this method with this kind of argument that does not throw an exception must increase the <code id="the-websocket-interface:dom-websocket-bufferedamount-7"><a href="#dom-websocket-bufferedamount">bufferedAmount</a></code> attribute by the length of <var>data</var>'s buffer in bytes. <a href="references.html#refsWSP">[WSP]</a></p>
   </dl>

  

  <hr>

  <p>The following are the <a id="the-websocket-interface:event-handlers" href="webappapis.html#event-handlers">event handlers</a> (and their corresponding <a href="webappapis.html#event-handler-event-type" id="the-websocket-interface:event-handler-event-type">event handler event types</a>) that must be supported, as <a id="the-websocket-interface:event-handler-idl-attributes" href="webappapis.html#event-handler-idl-attributes">event handler IDL attributes</a>, by all objects implementing the <code id="the-websocket-interface:websocket-8"><a href="#websocket">WebSocket</a></code> interface:</p>

  <table><thead><tr><th><a href="webappapis.html#event-handlers" id="the-websocket-interface:event-handlers-2">イベントハンドラー</a><th><a id="the-websocket-interface:event-handler-event-type-2" href="webappapis.html#event-handler-event-type">イベントハンドラーイベント型</a><tbody><tr><td><dfn data-dfn-for="WebSocket" id="handler-websocket-onopen" data-dfn-type="attribute"><code>onopen</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/onopen" title="The WebSocket.onopen property is an event handler that is called when the WebSocket connection's readyState changes to 1; this indicates that the connection is ready to send and receive data. It is called with an Event.">WebSocket/onopen</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><td><code id="the-websocket-interface:event-open"><a href="indices.html#event-open">open</a></code><tr><td><dfn data-dfn-for="WebSocket" id="handler-websocket-onmessage" data-dfn-type="attribute"><code>onmessage</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/onmessage" title="The WebSocket.onmessage property is an event handler that is called when a message is received from the server. It is called with a MessageEvent.">WebSocket/onmessage</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><td><code id="the-websocket-interface:event-message"><a href="indices.html#event-message">message</a></code><tr><td><dfn data-dfn-for="WebSocket" id="handler-websocket-onerror" data-dfn-type="attribute"><code>onerror</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/onerror" title="The WebSocket interface's onerror event handler property is a function which gets called when an error occurs on the WebSocket.">WebSocket/onerror</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>5+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><td><code id="the-websocket-interface:event-error"><a href="indices.html#event-error">error</a></code><tr><td><dfn data-dfn-for="WebSocket" id="handler-websocket-onclose" data-dfn-type="attribute"><code>onclose</code></dfn><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/onclose" title="The WebSocket.onclose property is an event handler that is called when the WebSocket connection's readyState changes to CLOSED. It is called with a CloseEvent.">WebSocket/onclose</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>7+</span></span><span class="safari yes"><span>Safari</span><span>5+</span></span><span class="chrome yes"><span>Chrome</span><span>4+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>7+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>4.2+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div><td><code id="the-websocket-interface:event-close-6"><a href="indices.html#event-close">close</a></code></table>


  

  <h4 id="feedback-from-the-protocol"><span class="secno">9.3.3</span> Feedback from the protocol<a href="#feedback-from-the-protocol" class="self-link"></a></h4>

  <p>When <i id="feedback-from-the-protocol:concept-websocket-established"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection is established</a></i>, the user agent must <a id="feedback-from-the-protocol:queue-a-task" href="webappapis.html#queue-a-task">queue a task</a> to run these steps:</p>

  <ol><li><p>Change the <code id="feedback-from-the-protocol:dom-websocket-readystate"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="feedback-from-the-protocol:dom-websocket-open"><a href="#dom-websocket-open">OPEN</a></code> (1).<li><p>Change the <code id="feedback-from-the-protocol:dom-websocket-extensions"><a href="#dom-websocket-extensions">extensions</a></code> attribute's value to the <i id="feedback-from-the-protocol:concept-websockets-active-extensions"><a href="infrastructure.html#concept-websockets-active-extensions">extensions in use</a></i>, if it is not the null value. <a href="references.html#refsWSP">[WSP]</a><li><p>Change the <code id="feedback-from-the-protocol:dom-websocket-protocol"><a href="#dom-websocket-protocol">protocol</a></code> attribute's value to the <i id="feedback-from-the-protocol:concept-websocket-subprotocol"><a href="infrastructure.html#concept-websocket-subprotocol">subprotocol in use</a></i>, if it is not the null value. <a href="references.html#refsWSP">[WSP]</a><li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="feedback-from-the-protocol:concept-event-fire" data-x-internal="concept-event-fire">Fire an event</a> named <code id="feedback-from-the-protocol:event-open"><a href="indices.html#event-open">open</a></code> at the <code id="feedback-from-the-protocol:websocket"><a href="#websocket">WebSocket</a></code> object.</p>
  </ol>

  <p class="note">Since the algorithm above is <a href="webappapis.html#queue-a-task" id="feedback-from-the-protocol:queue-a-task-2">queued as a task</a>, there is no race condition between <i id="feedback-from-the-protocol:concept-websocket-established-2"><a href="infrastructure.html#concept-websocket-established">the WebSocket connection being established</a></i> and the script setting up an event listener for the <code id="feedback-from-the-protocol:event-open-2"><a href="indices.html#event-open">open</a></code> event.</p>

  <hr>

  <p>When <i id="feedback-from-the-protocol:concept-websocket-message-received"><a href="infrastructure.html#concept-websocket-message-received">a WebSocket message has been received</a></i> with type <var>type</var> and data <var>data</var>, the user agent must <a id="feedback-from-the-protocol:queue-a-task-3" href="webappapis.html#queue-a-task">queue a task</a> to follow these steps: <a href="references.html#refsWSP">[WSP]</a></p>

  <ol><li><p>If the <code id="feedback-from-the-protocol:dom-websocket-readystate-2"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value is not <code id="feedback-from-the-protocol:dom-websocket-open-2"><a href="#dom-websocket-open">OPEN</a></code> (1), then return.</p>
   <li><p>Let <var>dataForEvent</var> be determined by switching on <var>type</var> and <code id="feedback-from-the-protocol:dom-websocket-binarytype"><a href="#dom-websocket-binarytype">binaryType</a></code>:</p>

    <dl class="switch"><dt><var>type</var> indicates that the data is Text<dd>a new <code id="feedback-from-the-protocol:idl-domstring"><a data-x-internal="idl-domstring" href="https://webidl.spec.whatwg.org/#idl-DOMString">DOMString</a></code> containing <var>data</var><dt><var>type</var> indicates that the data is Binary and <code id="feedback-from-the-protocol:dom-websocket-binarytype-2"><a href="#dom-websocket-binarytype">binaryType</a></code> is "<dfn data-dfn-for="BinaryType" id="dom-binarytype-blob" data-dfn-type="enum-value"><code>blob</code></dfn>"<dd>a new <code id="feedback-from-the-protocol:blob"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> object, created in the <a href="webappapis.html#concept-relevant-realm" id="feedback-from-the-protocol:concept-relevant-realm">relevant Realm</a> of the <code id="feedback-from-the-protocol:websocket-2"><a href="#websocket">WebSocket</a></code> object, that represents <var>data</var> as its raw data <a href="references.html#refsFILEAPI">[FILEAPI]</a><dt><var>type</var> indicates that the data is Binary and <code id="feedback-from-the-protocol:dom-websocket-binarytype-3"><a href="#dom-websocket-binarytype">binaryType</a></code> is "<dfn data-dfn-for="BinaryType" id="dom-binarytype-arraybuffer" data-dfn-type="enum-value"><code>arraybuffer</code></dfn>"<dd>a new <code id="feedback-from-the-protocol:idl-arraybuffer"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> object, created in the <a href="webappapis.html#concept-relevant-realm" id="feedback-from-the-protocol:concept-relevant-realm-2">relevant Realm</a> of the <code id="feedback-from-the-protocol:websocket-3"><a href="#websocket">WebSocket</a></code> object, whose contents are <var>data</var></dl>
   <li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="feedback-from-the-protocol:concept-event-fire-2" data-x-internal="concept-event-fire">Fire an event</a> named <code id="feedback-from-the-protocol:event-message"><a href="indices.html#event-message">message</a></code> at the <code id="feedback-from-the-protocol:websocket-4"><a href="#websocket">WebSocket</a></code> object, using <code id="feedback-from-the-protocol:messageevent"><a href="comms.html#messageevent">MessageEvent</a></code>, with the <code id="feedback-from-the-protocol:dom-messageevent-origin"><a href="comms.html#dom-messageevent-origin">origin</a></code> attribute initialized to the <a href="origin.html#ascii-serialisation-of-an-origin" id="feedback-from-the-protocol:ascii-serialisation-of-an-origin">serialization</a> of the <code id="feedback-from-the-protocol:websocket-5"><a href="#websocket">WebSocket</a></code> object's <a href="#concept-websocket-url" id="feedback-from-the-protocol:concept-websocket-url">url</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-origin" id="feedback-from-the-protocol:concept-url-origin" data-x-internal="concept-url-origin">origin</a>, and the <code id="feedback-from-the-protocol:dom-messageevent-data"><a href="comms.html#dom-messageevent-data">data</a></code> attribute initialized to <var>dataForEvent</var>.</ol>

  <p class="note">User agents are encouraged to check if they can perform the above steps efficiently before they run the task, picking tasks from other <a href="webappapis.html#task-queue" id="feedback-from-the-protocol:task-queue">task queues</a> while they prepare the buffers if not. For example, if the <code id="feedback-from-the-protocol:dom-websocket-binarytype-4"><a href="#dom-websocket-binarytype">binaryType</a></code> attribute was set to "<code id="feedback-from-the-protocol:dom-binarytype-blob"><a href="#dom-binarytype-blob">blob</a></code>" when the data arrived, and the user agent spooled all the data to disk, but just before running the above <a href="webappapis.html#concept-task" id="feedback-from-the-protocol:concept-task">task</a> for this particular message the script switched <code id="feedback-from-the-protocol:dom-websocket-binarytype-5"><a href="#dom-websocket-binarytype">binaryType</a></code> to "<code id="feedback-from-the-protocol:dom-binarytype-arraybuffer"><a href="#dom-binarytype-arraybuffer">arraybuffer</a></code>", the user agent would want to page the data back to RAM before running this <a href="webappapis.html#concept-task" id="feedback-from-the-protocol:concept-task-2">task</a> so as to avoid stalling the main thread while it created the <code id="feedback-from-the-protocol:idl-arraybuffer-2"><a data-x-internal="idl-arraybuffer" href="https://webidl.spec.whatwg.org/#idl-ArrayBuffer">ArrayBuffer</a></code> object.</p>

  

  <div class="example"><p>Here is an example of how to define a handler for the <code id="feedback-from-the-protocol:event-message-2"><a href="indices.html#event-message">message</a></code> event in the case of text frames:</p>

   <pre><code class='js'>mysocket<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-> <c- p>(</c->event<c- p>)</c-> <c- p>{</c->
  <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'on'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOn<c- p>();</c->
  <c- p>}</c-> <c- k>else</c-> <c- k>if</c-> <c- p>(</c->event<c- p>.</c->data <c- o>==</c-> <c- t>'off'</c-><c- p>)</c-> <c- p>{</c->
    turnLampOff<c- p>();</c->
  <c- p>}</c->
<c- p>};</c-></code></pre>

   <p>The protocol here is a trivial one, with the server just sending "on" or "off" messages.</p>

  </div>

  <hr>

  

  <p>When <i id="feedback-from-the-protocol:concept-websocket-closing-handshake"><a href="infrastructure.html#concept-websocket-closing-handshake">the WebSocket closing handshake is started</a></i>, the user agent must <a id="feedback-from-the-protocol:queue-a-task-4" href="webappapis.html#queue-a-task">queue a task</a> to change the <code id="feedback-from-the-protocol:dom-websocket-readystate-3"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="feedback-from-the-protocol:dom-websocket-closing"><a href="#dom-websocket-closing">CLOSING</a></code> (2). (If the <code id="feedback-from-the-protocol:dom-websocket-close"><a href="#dom-websocket-close">close()</a></code> method was called, the <code id="feedback-from-the-protocol:dom-websocket-readystate-4"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value will already be set to <code id="feedback-from-the-protocol:dom-websocket-closing-2"><a href="#dom-websocket-closing">CLOSING</a></code> (2) when this task runs.) <a href="references.html#refsWSP">[WSP]</a></p>

  <hr>

  <p id="closeWebSocket">When <i id="feedback-from-the-protocol:concept-websocket-closed"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection is closed</a></i>, possibly <i>cleanly</i>, the user agent must <a id="feedback-from-the-protocol:queue-a-task-5" href="webappapis.html#queue-a-task">queue a task</a> to run the following substeps:</p>

  <ol><li><p>Change the <code id="feedback-from-the-protocol:dom-websocket-readystate-5"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value to <code id="feedback-from-the-protocol:dom-websocket-closed"><a href="#dom-websocket-closed">CLOSED</a></code> (3).<li><p>If the user agent was required to <i id="feedback-from-the-protocol:concept-websocket-fail"><a href="infrastructure.html#concept-websocket-fail">fail the WebSocket connection</a></i>, or if <i id="feedback-from-the-protocol:concept-websocket-closed-2"><a href="infrastructure.html#concept-websocket-closed">the WebSocket connection was closed</a></i> after being <dfn id="concept-websocket-close-fail">flagged as full</dfn>, <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="feedback-from-the-protocol:concept-event-fire-3" data-x-internal="concept-event-fire">fire an event</a> named <code>error</code> at the <code id="feedback-from-the-protocol:websocket-6"><a href="#websocket">WebSocket</a></code> object. <a href="references.html#refsWSP">[WSP]</a><li><p><a href="https://triple-underscore.github.io/DOM4-ja.html#concept-event-fire" id="feedback-from-the-protocol:concept-event-fire-4" data-x-internal="concept-event-fire">Fire an event</a> named <code id="feedback-from-the-protocol:event-close"><a href="indices.html#event-close">close</a></code> at the <code id="feedback-from-the-protocol:websocket-7"><a href="#websocket">WebSocket</a></code> object, using <code id="feedback-from-the-protocol:closeevent"><a href="#closeevent">CloseEvent</a></code>, with the <code id="feedback-from-the-protocol:dom-closeevent-wasclean"><a href="#dom-closeevent-wasclean">wasClean</a></code> attribute initialized to true if the connection closed <i>cleanly</i> and false otherwise, the <code id="feedback-from-the-protocol:dom-closeevent-code"><a href="#dom-closeevent-code">code</a></code> attribute initialized to <i id="feedback-from-the-protocol:concept-websocket-close-code"><a href="infrastructure.html#concept-websocket-close-code">the WebSocket connection close code</a></i>, and the <code id="feedback-from-the-protocol:dom-closeevent-reason"><a href="#dom-closeevent-reason">reason</a></code> attribute initialized to the result of applying <a id="feedback-from-the-protocol:utf-8-decode-without-bom" href="https://triple-underscore.github.io/Encoding-ja.html#utf-8-decode-without-bom" data-x-internal="utf-8-decode-without-bom">UTF-8 decode without BOM</a> to <i id="feedback-from-the-protocol:concept-websocket-close-reason"><a href="infrastructure.html#concept-websocket-close-reason">the WebSocket connection close reason</a></i>. <a href="references.html#refsWSP">[WSP]</a></ol>

  <div class="warning"><p>User agents must not convey any failure information to scripts in a way that would allow a script to distinguish the following situations:</p>

   <ul><li>A server whose host name could not be resolved.<li>A server to which packets could not successfully be routed.<li>A server that refused the connection on the specified port.<li>A server that failed to correctly perform a TLS handshake (e.g., the server certificate can't be verified).<li>A server that did not complete the opening handshake (e.g. because it was not a WebSocket server).<li>A WebSocket server that sent a correct opening handshake, but that specified options that caused the client to drop the connection (e.g. the server specified a subprotocol that the client did not offer).<li>A WebSocket server that abruptly closed the connection after successfully completing the opening handshake.</ul>

   <p>In all of these cases, <i id="feedback-from-the-protocol:concept-websocket-close-code-2"><a href="infrastructure.html#concept-websocket-close-code">the WebSocket connection close code</a></i> would be 1006, as required by <cite>WebSocket Protocol</cite>. <a href="references.html#refsWSP">[WSP]</a></p>

   <p>Allowing a script to distinguish these cases would allow a script to probe the user's local network in preparation for an attack.</p>

   <p class="note">In particular, this means the code 1015 is not used by the user agent (unless the server erroneously uses it in its close frame, of course).</p>

  </div>

  <hr>

  <p>The <a id="feedback-from-the-protocol:task-source" href="webappapis.html#task-source">task source</a> for all <a href="webappapis.html#concept-task" id="feedback-from-the-protocol:concept-task-3">tasks</a> <a href="webappapis.html#queue-a-task" id="feedback-from-the-protocol:queue-a-task-6">queued</a> in this section is the <dfn id="websocket-task-source">WebSocket task source</dfn>.</p>

  


  <h4 id="ping-and-pong-frames"><span class="secno">9.3.4</span> Ping and Pong frames<a href="#ping-and-pong-frames" class="self-link"></a></h4>

  <p><cite>The WebSocket protocol</cite> defines Ping and Pong frames that can be used for keep-alive, heart-beats, network status probing, latency instrumentation, and so forth. These are not currently exposed in the API.</p>

  <p>User agents may send ping and unsolicited pong frames as desired, for example in an attempt to maintain local network NAT mappings, to detect failed connections, or to display latency metrics to the user. User agents must not use pings or unsolicited pongs to aid the server; it is assumed that servers will solicit pongs whenever appropriate for the server's needs.</p>

  


  <h4 id="the-closeevent-interface"><span class="secno">9.3.5</span> The <code id="the-closeevent-interface:closeevent"><a href="#closeevent">CloseEvent</a></code> interface<a href="#the-closeevent-interface" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent" title="A CloseEvent is sent to clients using WebSockets when the connection is closed. This is delivered to the listener indicated by the WebSocket object's onclose attribute.">CloseEvent</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>8+</span></span><span class="safari yes"><span>Safari</span><span>6+</span></span><span class="chrome yes"><span>Chrome</span><span>13+</span></span><hr><span class="opera yes"><span>Opera</span><span>12.1+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>8+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>6+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>18+</span></span><span class="webview_android yes"><span>WebView Android</span><span>37+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>1.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>12.1+</span></span></div></div></div>

  <p><code id="the-closeevent-interface:websocket"><a href="#websocket">WebSocket</a></code> objects use the <code id="the-closeevent-interface:closeevent-2"><a href="#closeevent">CloseEvent</a></code> interface for their <code id="the-closeevent-interface:event-close"><a href="indices.html#event-close">close</a></code> events:</p>

  <pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->)]
<c- b>interface</c-> <dfn id='closeevent' data-dfn-type='interface'><c- g>CloseEvent</c-></dfn> : <a id='the-closeevent-interface:event' href='https://triple-underscore.github.io/DOM4-ja.html#interface-event' data-x-internal='event'><c- n>Event</c-></a> {
  <a href='https://triple-underscore.github.io/DOM4-ja.html#concept-event-constructor' id='the-closeevent-interface:dom-event-constructor' data-x-internal='dom-event-constructor'><c- g>constructor</c-></a>(<c- b>DOMString</c-> <c- g>type</c->, <c- b>optional</c-> <a href='#closeeventinit' id='the-closeevent-interface:closeeventinit'><c- n>CloseEventInit</c-></a> <c- g>eventInitDict</c-> = {});

  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>boolean</c-> <a href='#dom-closeevent-wasclean' id='the-closeevent-interface:dom-closeevent-wasclean'><c- g>wasClean</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>short</c-> <a href='#dom-closeevent-code' id='the-closeevent-interface:dom-closeevent-code'><c- g>code</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>USVString</c-> <a href='#dom-closeevent-reason' id='the-closeevent-interface:dom-closeevent-reason'><c- g>reason</c-></a>;
};

<c- b>dictionary</c-> <dfn id='closeeventinit' data-dfn-type='dictionary'><c- g>CloseEventInit</c-></dfn> : <a id='the-closeevent-interface:eventinit' href='https://triple-underscore.github.io/DOM4-ja.html#dictdef-eventinit' data-x-internal='eventinit'><c- n>EventInit</c-></a> {
  <c- b>boolean</c-> <c- g>wasClean</c-> = <c- b>false</c->;
  <c- b>unsigned</c-> <c- b>short</c-> <c- g>code</c-> = 0;
  <c- b>USVString</c-> <c- g>reason</c-> = "";
};</code></pre>

  <dl class="domintro"><dt><code><var>event</var>.<a href="#dom-closeevent-wasclean" id="dom-closeevent-wasclean-dev">wasClean</a></code><dd><p>Returns true if the connection closed cleanly; false otherwise.<dt><code><var>event</var>.<a href="#dom-closeevent-code" id="dom-closeevent-code-dev">code</a></code><dd><p>Returns the WebSocket connection close code provided by the server.<dt><code><var>event</var>.<a href="#dom-closeevent-reason" id="dom-closeevent-reason-dev">reason</a></code><dd><p>Returns the WebSocket connection close reason provided by the server.</dl>

  

  <p>The <dfn data-dfn-for="CloseEvent" id="dom-closeevent-wasclean" data-dfn-type="attribute"><code>wasClean</code></dfn> attribute must return the value it was initialized to. It represents whether the connection closed cleanly or not.</p>

  <p>The <dfn data-dfn-for="CloseEvent" id="dom-closeevent-code" data-dfn-type="attribute"><code>code</code></dfn> attribute must return the value it was initialized to. It represents the WebSocket connection close code provided by the server.</p>

  <p>The <dfn data-dfn-for="CloseEvent" id="dom-closeevent-reason" data-dfn-type="attribute"><code>reason</code></dfn> attribute must return the value it was initialized to. It represents the WebSocket connection close reason provided by the server.</p>



  <h4 id="garbage-collection-2"><span class="secno">9.3.6</span> Garbage collection<a href="#garbage-collection-2" class="self-link"></a></h4>

  <p>A <code id="garbage-collection-2:websocket"><a href="#websocket">WebSocket</a></code> object whose <code id="garbage-collection-2:dom-websocket-readystate"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value was set to <code id="garbage-collection-2:dom-websocket-connecting"><a href="#dom-websocket-connecting">CONNECTING</a></code> (0) as of the last time the <a id="garbage-collection-2:event-loop" href="webappapis.html#event-loop">event loop</a> reached <a href="webappapis.html#step1">step 1</a> must not be garbage collected if there are any event listeners registered for <code id="garbage-collection-2:event-open"><a href="indices.html#event-open">open</a></code> events, <code id="garbage-collection-2:event-message"><a href="indices.html#event-message">message</a></code> events, <code id="garbage-collection-2:event-error"><a href="indices.html#event-error">error</a></code> events, or <code id="garbage-collection-2:event-close"><a href="indices.html#event-close">close</a></code> events.</p>

  <p>A <code id="garbage-collection-2:websocket-2"><a href="#websocket">WebSocket</a></code> object whose <code id="garbage-collection-2:dom-websocket-readystate-2"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value was set to <code id="garbage-collection-2:dom-websocket-open"><a href="#dom-websocket-open">OPEN</a></code> (1) as of the last time the <a id="garbage-collection-2:event-loop-2" href="webappapis.html#event-loop">event loop</a> reached <a href="webappapis.html#step1">step 1</a> must not be garbage collected if there are any event listeners registered for <code id="garbage-collection-2:event-message-2"><a href="indices.html#event-message">message</a></code> events, <code id="garbage-collection-2:event-error-2"><a href="indices.html#event-error">error</a></code>, or <code id="garbage-collection-2:event-close-2"><a href="indices.html#event-close">close</a></code> events.</p>

  <p>A <code id="garbage-collection-2:websocket-3"><a href="#websocket">WebSocket</a></code> object whose <code id="garbage-collection-2:dom-websocket-readystate-3"><a href="#dom-websocket-readystate">readyState</a></code> attribute's value was set to <code id="garbage-collection-2:dom-websocket-closing"><a href="#dom-websocket-closing">CLOSING</a></code> (2) as of the last time the <a id="garbage-collection-2:event-loop-3" href="webappapis.html#event-loop">event loop</a> reached <a href="webappapis.html#step1">step 1</a> must not be garbage collected if there are any event listeners registered for <code id="garbage-collection-2:event-error-3"><a href="indices.html#event-error">error</a></code> or <code id="garbage-collection-2:event-close-3"><a href="indices.html#event-close">close</a></code> events.</p>

  <p>A <code id="garbage-collection-2:websocket-4"><a href="#websocket">WebSocket</a></code> object with <i id="garbage-collection-2:concept-websocket-established"><a href="infrastructure.html#concept-websocket-established">an established connection</a></i> that has data queued to be transmitted to the network must not be garbage collected. <a href="references.html#refsWSP">[WSP]</a></p>

  <p>If a <code id="garbage-collection-2:websocket-5"><a href="#websocket">WebSocket</a></code> object is garbage collected while its connection is still open, the user agent must <i id="garbage-collection-2:concept-websocket-start-closing-handshake"><a href="infrastructure.html#concept-websocket-start-closing-handshake">start the WebSocket closing handshake</a></i>, with no status code for the Close message. <a href="references.html#refsWSP">[WSP]</a></p>

  <hr>

  <p>If a user agent is to <dfn id="make-disappear">make disappear</dfn> a <code id="garbage-collection-2:websocket-6"><a href="#websocket">WebSocket</a></code> object (this happens when a <code id="garbage-collection-2:document"><a href="dom.html#document">Document</a></code> object goes away), the user agent must follow the first appropriate set of steps from the following list:</p>

  <dl class="switch"><dt>If the WebSocket connection is not yet <i id="garbage-collection-2:concept-websocket-established-2"><a href="infrastructure.html#concept-websocket-established">established</a></i> <a href="references.html#refsWSP">[WSP]</a><dd><p><i id="garbage-collection-2:concept-websocket-fail"><a href="infrastructure.html#concept-websocket-fail">Fail the WebSocket connection</a></i>. <a href="references.html#refsWSP">[WSP]</a></p>
   <dt>If the WebSocket closing handshake has not yet been <i id="garbage-collection-2:concept-websocket-closing-handshake"><a href="infrastructure.html#concept-websocket-closing-handshake">started</a></i> <a href="references.html#refsWSP">[WSP]</a><dd><p><i id="garbage-collection-2:concept-websocket-start-closing-handshake-2"><a href="infrastructure.html#concept-websocket-start-closing-handshake">Start the WebSocket closing handshake</a></i>, with the status code to use in the WebSocket Close message being 1001. <a href="references.html#refsWSP">[WSP]</a></p>
   <dt>そうでなければ<dd><p>Do nothing.</p>
   </dl>

  


  <nav><a href="server-sent-events.html">← 9.2 Server-sent events</a> — <a href="./">目次</a> — <a href="web-messaging.html">9.4 Cross-document messaging →</a></nav>

<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script async="" crossorigin="" src="./html-dfn.js"></script>
  <script data-file-issue-url="https://github.com/momdo/momdo.github.io/issues/new" async="" crossorigin="" src="https://resources.whatwg.org/file-issue.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><h2 id="living-standard" class="no-num no-toc">Living Standard — Last Updated <span class="pubdate">22 September 2022</span></h2></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="system-state.html">← 8.9 システム状態および性能</a> — <a href="./">目次</a> — <a href="comms.html">9 コミュニケーション →</a></nav><ol class="toc"><li id="toc-webappapis"><ol><li><a href="imagebitmap-and-animations.html#images-2"><span class="secno">8.10</span> 画像</a><li><a href="imagebitmap-and-animations.html#animation-frames"><span class="secno">8.11</span> アニメーションフレーム</a></ol></ol><h3 id="images-2"><span class="secno">8.10</span> 画像<a href="#images-2" class="self-link"></a></h3>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap" title="The ImageBitmap interface represents a bitmap image which can be drawn to a &lt;canvas> without undue latency. It can be created from a variety of source objects using the createImageBitmap() factory method. ImageBitmap provides an asynchronous and resource efficient pathway to prepare textures for rendering in WebGL.">ImageBitmap</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>50+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><pre><code class='idl'>[<c- g>Exposed</c->=(<c- n>Window</c->,<c- n>Worker</c->), <a id='images-2:serializable' href='structured-data.html#serializable'><c- g>Serializable</c-></a>, <a id='images-2:transferable' href='structured-data.html#transferable'><c- g>Transferable</c-></a>]
<c- b>interface</c-> <dfn id='imagebitmap' data-dfn-type='interface'><c- g>ImageBitmap</c-></dfn> {
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-imagebitmap-width' id='images-2:dom-imagebitmap-width'><c- g>width</c-></a>;
  <c- b>readonly</c-> <c- b>attribute</c-> <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-imagebitmap-height' id='images-2:dom-imagebitmap-height'><c- g>height</c-></a>;
  <c- b>undefined</c-> <a href='#dom-imagebitmap-close' id='images-2:dom-imagebitmap-close'><c- g>close</c-></a>();
};

<c- b>typedef</c-> (<a id='images-2:canvasimagesource' href='canvas.html#canvasimagesource'><c- n>CanvasImageSource</c-></a> <c- b>or</c->
         <a id='images-2:blob' href='https://triple-underscore.github.io/File_API-ja.html#dfn-Blob' data-x-internal='blob'><c- n>Blob</c-></a> <c- b>or</c->
         <a id='images-2:imagedata' href='canvas.html#imagedata'><c- n>ImageData</c-></a>) <dfn id='imagebitmapsource' data-dfn-type='typedef'><c- g>ImageBitmapSource</c-></dfn>;

<c- b>enum</c-> <dfn id='imageorientation' data-dfn-type='enum'><c- g>ImageOrientation</c-></dfn> { <c- s>"</c-><a href='#dom-imageorientation-none' id='images-2:dom-imageorientation-none'><c- s>none</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-imageorientation-flipy' id='images-2:dom-imageorientation-flipy'><c- s>flipY</c-></a><c- s>"</c-> };
<c- b>enum</c-> <dfn id='premultiplyalpha' data-dfn-type='enum'><c- g>PremultiplyAlpha</c-></dfn> { <c- s>"</c-><a href='#dom-premultiplyalpha-none' id='images-2:dom-premultiplyalpha-none'><c- s>none</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-premultiplyalpha-premultiply' id='images-2:dom-premultiplyalpha-premultiply'><c- s>premultiply</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-premultiplyalpha-default' id='images-2:dom-premultiplyalpha-default'><c- s>default</c-></a><c- s>"</c-> };
<c- b>enum</c-> <dfn id='colorspaceconversion' data-dfn-type='enum'><c- g>ColorSpaceConversion</c-></dfn> { <c- s>"</c-><a href='#dom-colorspaceconversion-none' id='images-2:dom-colorspaceconversion-none'><c- s>none</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-colorspaceconversion-default' id='images-2:dom-colorspaceconversion-default'><c- s>default</c-></a><c- s>"</c-> };
<c- b>enum</c-> <dfn id='resizequality' data-dfn-type='enum'><c- g>ResizeQuality</c-></dfn> { <c- s>"</c-><a href='#dom-resizequality-pixelated' id='images-2:dom-resizequality-pixelated'><c- s>pixelated</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-resizequality-low' id='images-2:dom-resizequality-low'><c- s>low</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-resizequality-medium' id='images-2:dom-resizequality-medium'><c- s>medium</c-></a><c- s>"</c->, <c- s>"</c-><a href='#dom-resizequality-high' id='images-2:dom-resizequality-high'><c- s>high</c-></a><c- s>"</c-> };

<c- b>dictionary</c-> <dfn id='imagebitmapoptions' data-dfn-type='dictionary'><c- g>ImageBitmapOptions</c-></dfn> {
  <a href='#imageorientation' id='images-2:imageorientation'><c- n>ImageOrientation</c-></a> <a href='#dom-imagebitmapoptions-imageorientation' id='images-2:dom-imagebitmapoptions-imageorientation'><c- g>imageOrientation</c-></a> = "<a href='#dom-imageorientation-none' id='images-2:dom-imageorientation-none-2'>none</a>";
  <a href='#premultiplyalpha' id='images-2:premultiplyalpha'><c- n>PremultiplyAlpha</c-></a> <a href='#dom-imagebitmapoptions-premultiplyalpha' id='images-2:dom-imagebitmapoptions-premultiplyalpha'><c- g>premultiplyAlpha</c-></a> = "<a href='#dom-premultiplyalpha-default' id='images-2:dom-premultiplyalpha-default-2'>default</a>";
  <a href='#colorspaceconversion' id='images-2:colorspaceconversion'><c- n>ColorSpaceConversion</c-></a> <a href='#dom-imagebitmapoptions-colorspaceconversion' id='images-2:dom-imagebitmapoptions-colorspaceconversion'><c- g>colorSpaceConversion</c-></a> = "<a href='#dom-colorspaceconversion-default' id='images-2:dom-colorspaceconversion-default-2'>default</a>";
  [<c- g>EnforceRange</c->] <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-imagebitmapoptions-resizewidth' id='images-2:dom-imagebitmapoptions-resizewidth'><c- g>resizeWidth</c-></a>;
  [<c- g>EnforceRange</c->] <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-imagebitmapoptions-resizeheight' id='images-2:dom-imagebitmapoptions-resizeheight'><c- g>resizeHeight</c-></a>;
  <a href='#resizequality' id='images-2:resizequality'><c- n>ResizeQuality</c-></a> <a href='#dom-imagebitmapoptions-resizequality' id='images-2:dom-imagebitmapoptions-resizequality'><c- g>resizeQuality</c-></a> = "<a href='#dom-resizequality-low' id='images-2:dom-resizequality-low-2'>low</a>";
};</code></pre>

  <p><code id="images-2:imagebitmap"><a href="#imagebitmap">ImageBitmap</a></code>オブジェクトは過度の待ち時間なしのキャンバスに塗装できるビットマップ画像を表す。</p>

  <p class="note">この過度の待ち時間は何かの正確な判断は実装者に委ねるが、一般にビットマップを活用することは、ネットワークI/O、あるいはローカルディスクI/Oを必要とする場合、その後待ち時間はおそらく過度である。一方それが唯一のGPUやシステムRAMからのブロッキングの読み出しを必要とする場合、待ち時間はおそらく許容できる。</p>

  <dl class="domintro"><dt><code><var>promise</var> = self.<a href="#dom-createimagebitmap" id="dom-createimagebitmap-dev">createImageBitmap</a>(<var>image</var> [, <var>options</var> ])</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/createImageBitmap" title="The createImageBitmap() method creates a bitmap from a given source, optionally cropped to contain only a portion of that source. The method exists on the global scope in both windows and workers. It accepts a variety of different image sources, and returns a Promise which resolves to an ImageBitmap.">createImageBitmap</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>50+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dt><code><var>promise</var> = self.<a href="#dom-createimagebitmap" id="images-2:dom-createimagebitmap">createImageBitmap</a>(<var>image</var>, <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var> [, <var>options</var> ])</code><dd><p><var>画像</var>、これは<code id="images-2:the-img-element"><a href="embedded-content.html#the-img-element">img</a></code>要素、<a id="images-2:svg-image" href="https://triple-underscore.github.io/svg-embedded-ja.html#ImageElement" data-x-internal="svg-image">SVG <code>image</code></a>要素、<code id="images-2:the-video-element"><a href="media.html#the-video-element">video</a></code>要素、<code id="images-2:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code>要素、<code id="images-2:blob-2"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>オブジェクト、<code id="images-2:imagedata-2"><a href="canvas.html#imagedata">ImageData</a></code>オブジェクト、または別の<code id="images-2:imagebitmap-2"><a href="#imagebitmap">ImageBitmap</a></code>オブジェクトである、を取得し、新しい<code id="images-2:imagebitmap-3"><a href="#imagebitmap">ImageBitmap</a></code>が作成されたときに解決されるpromiseを返す。</p>

    <p><code id="images-2:imagebitmap-4"><a href="#imagebitmap">ImageBitmap</a></code>オブジェクトを構築することが全くできない場合、たとえば、与えられた<var>image</var> データが実際の画像ではないので、代わりにpromiseが却下される。</p>

    <p><var>sx</var>、<var>sy</var>、<var>sw</var>、および<var>sh</var>引数が指定される場合、ソース画像は与えられたピクセルに切り取られ、元のピクセルに欠けているピクセルは<a id="images-2:transparent-black" href="https://triple-underscore.github.io/css-color-ja.html#transparent-black" data-x-internal="transparent-black">透明な黒</a>に置き換えられる。これらの座標は、<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'" data-x-internal="'px'">CSSピクセル</a>では<em>なく</em>、ソース画像のピクセル座標空間にある。</p>

    <p><var>options</var>が指定される場合、<code id="images-2:imagebitmap-5"><a href="#imagebitmap">ImageBitmap</a></code>オブジェクトのビットマップデータは<var>options</var>に従って変更される。For example, if the <code id="images-2:dom-imagebitmapoptions-premultiplyalpha-2"><a href="#dom-imagebitmapoptions-premultiplyalpha">premultiplyAlpha</a></code> option is set to "<code id="images-2:dom-premultiplyalpha-premultiply-2"><a href="#dom-premultiplyalpha-premultiply">premultiply</a></code>", the <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data">bitmap data</a>'s color channels are <a href="canvas.html#concept-premultiplied-alpha" id="images-2:concept-premultiplied-alpha">premultiplied by its alpha channel</a>.</p>

    <p>ソース画像が有効な状態にない場合、<a id="images-2:invalidstateerror" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>を拒否する（たとえば、正常に読み込まれなかった<code id="images-2:the-img-element-2"><a href="embedded-content.html#the-img-element">img</a></code>要素、<a id="images-2:detached" href="structured-data.html#detached">[[Detached]]</a>内部スロット値がtrueの<code id="images-2:imagebitmap-6"><a href="#imagebitmap">ImageBitmap</a></code>オブジェクト、<code id="images-2:dom-imagedata-data"><a href="canvas.html#dom-imagedata-data">data</a></code>属性値の[[ViewedArrayBuffer]]内部スロットが切り離されている<code id="images-2:imagedata-3"><a href="canvas.html#imagedata">ImageData</a></code>オブジェクト、データがビットマップイメージとして解釈できない<code id="images-2:blob-3"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code>など）。</p>

    <p>スクリプトがソース画像の画像データへのアクセスを許可されていない場合、<a id="images-2:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="images-2:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>でpromiseを拒否する（たとえば、<a id="images-2:cors-cross-origin" href="urls-and-fetching.html#cors-cross-origin">生成元をまたぐCORS</a>である<code id="images-2:the-video-element-2"><a href="media.html#the-video-element">video</a></code>、別の<a id="images-2:concept-origin" href="origin.html#concept-origin">生成元</a>からのワーカーのスクリプトで描画された<code id="images-2:the-canvas-element-2"><a href="canvas.html#the-canvas-element">canvas</a></code>など）。</p>
   <dt><code><var>imageBitmap</var>.<a href="#dom-imagebitmap-close" id="dom-imagebitmap-close-dev">close</a>()</code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/close" title="The ImageBitmap.close() method disposes of all graphical resources associated with an ImageBitmap.">ImageBitmap/close</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>46+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>52+</span></span><hr><span class="opera yes"><span>Opera</span><span>37+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android yes"><span>Opera Android</span><span>37+</span></span></div></div></div><dd><p><var>imageBitmap</var>の基礎となる<a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-2">ビットマップデータ</a>を解放する。<dt><code><var>imageBitmap</var>.<a href="#dom-imagebitmap-width" id="dom-imagebitmap-width-dev">width</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/width" title="The read-only ImageBitmap.width property returns the ImageBitmap object's width in CSS pixels.">ImageBitmap/width</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>50+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>画像の<a id="images-2:intrinsic-width" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-width" data-x-internal="intrinsic-width">内在幅</a>を<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-2" data-x-internal="'px'">CSSピクセル</a>で返す。</p>
   <dt><code><var>imageBitmap</var>.<a href="#dom-imagebitmap-height" id="dom-imagebitmap-height-dev">height</a></code><div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/ImageBitmap/height" title="The read-only ImageBitmap.height property returns the ImageBitmap object's height in CSS pixels.">ImageBitmap/height</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>42+</span></span><span class="safari yes"><span>Safari</span><span>15+</span></span><span class="chrome yes"><span>Chrome</span><span>50+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><dd><p>画像の<a id="images-2:intrinsic-height" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-height" data-x-internal="intrinsic-height">内在高さ</a>を<a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-3" data-x-internal="'px'">CSSピクセル</a>で返す。</p>
   </dl>

  

  <p>An <code id="images-2:imagebitmap-7"><a href="#imagebitmap">ImageBitmap</a></code> object whose <a id="images-2:detached-2" href="structured-data.html#detached">[[Detached]]</a> internal slot value is false always has associated <dfn id="concept-imagebitmap-bitmap-data">bitmap data</dfn>, with a width and a height. However, it is possible for this data to be corrupted. If an <code id="images-2:imagebitmap-8"><a href="#imagebitmap">ImageBitmap</a></code> object's media data can be decoded without errors, it is said to be <dfn id="concept-imagebitmap-good">fully decodable</dfn>.</p>

  <p>An <code id="images-2:imagebitmap-9"><a href="#imagebitmap">ImageBitmap</a></code> object's bitmap has an <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean">origin-clean</a> flag, which indicates whether the bitmap is tainted by content from a different <a id="images-2:concept-origin-2" href="origin.html#concept-origin">origin</a>. The flag is initially set to true and may be changed to false by the steps of <code id="images-2:dom-createimagebitmap-2"><a href="#dom-createimagebitmap">createImageBitmap()</a></code>.</p>

  <hr>

  <p><code id="images-2:imagebitmap-10"><a href="#imagebitmap">ImageBitmap</a></code> objects are <a id="images-2:serializable-objects" href="structured-data.html#serializable-objects">serializable objects</a> and <a id="images-2:transferable-objects" href="structured-data.html#transferable-objects">transferable objects</a>.</p>

  <p>Their <a id="images-2:serialization-steps" href="structured-data.html#serialization-steps">serialization steps</a>, given <var>value</var> and <var>serialized</var>, are:</p>

  <ol><li><p>If <var>value</var>'s <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-2">origin-clean</a> flag is not set, then throw a <a id="images-2:datacloneerror" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="images-2:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>serialized</var>.[[BitmapData]] to a copy of <var>value</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-3">bitmap data</a>.</ol>

  <p>Their <a id="images-2:deserialization-steps" href="structured-data.html#deserialization-steps">deserialization steps</a>, given <var>serialized</var> and <var>value</var>, are:</p>

  <ol><li><p>Set <var>value</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-4">bitmap data</a> to <var>serialized</var>.[[BitmapData]].</ol>

  <p>Their <a id="images-2:transfer-steps" href="structured-data.html#transfer-steps">transfer steps</a>, given <var>value</var> and <var>dataHolder</var>, are:</p>

  <ol><li><p>If <var>value</var>'s <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-3">origin-clean</a> flag is not set, then throw a <a id="images-2:datacloneerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#datacloneerror" data-x-internal="datacloneerror">"<code>DataCloneError</code>"</a> <code id="images-2:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>dataHolder</var>.[[BitmapData]] to <var>value</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-5">bitmap data</a>.<li><p>Unset <var>value</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-6">bitmap data</a>.</ol>

  <p>Their <a id="images-2:transfer-receiving-steps" href="structured-data.html#transfer-receiving-steps">transfer-receiving steps</a>, given <var>dataHolder</var> and <var>value</var>, are:</p>

  <ol><li><p>Set <var>value</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-7">bitmap data</a> to <var>dataHolder</var>.[[BitmapData]].</ol>

  <hr>

  <p>The <dfn data-dfn-for="WindowOrWorkerGlobalScope" id="dom-createimagebitmap" data-dfn-type="method"><code>createImageBitmap(<var>image</var>, <var>options</var>)</code></dfn> and <code>createImageBitmap(<var>image</var> <var>sx</var>, <var>sy</var>, <var>sw</var>, <var>sh</var>, <var>options</var>)</code> methods, when invoked, must run these steps:</p>

  <ol><li><p>Let <var>p</var> be a new promise.<li><p>If either <var>sw</var> or <var>sh</var> is given and is 0, then return <var>p</var> rejected with a <code id="images-2:js-rangeerror"><a data-x-internal="js-rangeerror" href="https://tc39.es/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror">RangeError</a></code>.<li><p>If either <var>options</var>'s <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-resizewidth" data-dfn-type="dict-member"><code>resizeWidth</code></dfn> or <var>options</var>'s <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-resizeheight" data-dfn-type="dict-member"><code>resizeHeight</code></dfn> is present and is 0, then return <var>p</var> rejected with an <a id="images-2:invalidstateerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-5"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p><a id="images-2:check-the-usability-of-the-image-argument" href="canvas.html#check-the-usability-of-the-image-argument">Check the usability of the <var>image</var> argument</a>. If this throws an exception or returns <i>bad</i>, then return <var>p</var> rejected with an <a id="images-2:invalidstateerror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-6"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>imageBitmap</var> be a new <code id="images-2:imagebitmap-11"><a href="#imagebitmap">ImageBitmap</a></code> object.<li><p>Switch on <var>image</var>:</p>

    <dl class="switch"><dt><code id="images-2:the-img-element-3"><a href="embedded-content.html#the-img-element">img</a></code><dt><a id="images-2:svg-image-2" href="https://triple-underscore.github.io/svg-embedded-ja.html#ImageElement" data-x-internal="svg-image">SVG <code>image</code></a><dd><ol><li><p>If <var>image</var>'s media data has no <a id="images-2:intrinsic-dimensions" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-dimensions" data-x-internal="intrinsic-dimensions">intrinsic dimensions</a> (e.g., it's a vector graphic with no specified content size) and either <var>options</var>'s <code id="images-2:dom-imagebitmapoptions-resizewidth-2"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> or <var>options</var>'s <code id="images-2:dom-imagebitmapoptions-resizeheight-2"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> is not present, then return <var>p</var> rejected with an <a id="images-2:invalidstateerror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-7"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <var>image</var>'s media data has no <a id="images-2:intrinsic-dimensions-2" href="https://triple-underscore.github.io/css-images-ja.html#intrinsic-dimensions" data-x-internal="intrinsic-dimensions">intrinsic dimensions</a> (e.g., it's a vector graphics with no specified content size), it should be rendered to a bitmap of the size specified by the <code id="images-2:dom-imagebitmapoptions-resizewidth-3"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> and the <code id="images-2:dom-imagebitmapoptions-resizeheight-3"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> options.<li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-8">bitmap data</a> to a copy of <var>image</var>'s media data, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting">cropped to the source rectangle with formatting</a>. If this is an animated image, <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-9">bitmap data</a> must only be taken from the default image of the animation (the one that the format defines is to be used when animation is not supported or is disabled), or, if there is no such image, the first frame of the animation.<li><p>If <var>image</var> <a id="images-2:the-image-argument-is-not-origin-clean" href="canvas.html#the-image-argument-is-not-origin-clean">is not origin-clean</a>, then set the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-4">origin-clean</a> flag of <var>imageBitmap</var>'s bitmap to false.<li><p>Run this step <a id="images-2:in-parallel" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     <dt><code id="images-2:the-video-element-3"><a href="media.html#the-video-element">video</a></code><dd><ol><li><p>If <var>image</var>'s <code id="images-2:dom-media-networkstate"><a href="media.html#dom-media-networkstate">networkState</a></code> attribute is <code id="images-2:dom-media-network_empty"><a href="media.html#dom-media-network_empty">NETWORK_EMPTY</a></code>, then return <var>p</var> rejected with an <a id="images-2:invalidstateerror-5" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-8"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-10">bitmap data</a> to a copy of the frame at the <a id="images-2:current-playback-position" href="media.html#current-playback-position">current playback position</a>, at the <a id="images-2:media-resource" href="media.html#media-resource">media resource</a>'s <a href="media.html#concept-video-intrinsic-width" id="images-2:concept-video-intrinsic-width">intrinsic width</a> and <a href="media.html#concept-video-intrinsic-height" id="images-2:concept-video-intrinsic-height">intrinsic height</a> (i.e., after any aspect-ratio correction has been applied), <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-2">cropped to the source rectangle with formatting</a>.</p>

       <li><p>If <var>image</var> <a id="images-2:the-image-argument-is-not-origin-clean-2" href="canvas.html#the-image-argument-is-not-origin-clean">is not origin-clean</a>, then set the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-5">origin-clean</a> flag of <var>imageBitmap</var>'s bitmap to false.<li><p>Run this step <a id="images-2:in-parallel-2" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     <dt><code id="images-2:the-canvas-element-3"><a href="canvas.html#the-canvas-element">canvas</a></code><dd><ol><li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-11">bitmap data</a> to a copy of <var>image</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-12">bitmap data</a>, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-3">cropped to the source rectangle with formatting</a>.<li><p>Set the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-6">origin-clean</a> flag of the <var>imageBitmap</var>'s bitmap to the same value as the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-7">origin-clean</a> flag of <var>image</var>'s bitmap.<li><p>Run this step <a id="images-2:in-parallel-3" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     <dt><code id="images-2:blob-4"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code><dd><p>Run these step <a id="images-2:in-parallel-4" href="infrastructure.html#in-parallel">in parallel</a>:</p>

      <ol><li><p>Let <var>imageData</var> be the result of reading <var>image</var>'s data. If an <a href="infrastructure.html#file-error-read" id="images-2:file-error-read">error occurs during reading of the object</a>, then reject <var>p</var> with an <a id="images-2:invalidstateerror-6" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-9"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> and abort these steps.<li><p>Apply the <a href="https://triple-underscore.github.io/mimesniff-ja.html#rules-for-sniffing-images-specifically" id="images-2:content-type-sniffing:-image" data-x-internal="content-type-sniffing:-image">image sniffing rules</a> to determine the file format of <var>imageData</var>, with MIME type of <var>image</var> (as given by <var>image</var>'s <code id="images-2:dom-blob-type"><a data-x-internal="dom-blob-type" href="https://triple-underscore.github.io/File_API-ja.html#dfn-type">type</a></code> attribute) giving the official type.<li><p>If <var>imageData</var> is not in a supported image file format (e.g., it's not an image at all), or if <var>imageData</var> is corrupted in some fatal way such that the image dimensions cannot be obtained (e.g., a vector graphic with no intrinsic size), then reject <var>p</var> with an <a id="images-2:invalidstateerror-7" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-10"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> and abort these steps.<li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-13">bitmap data</a> to <var>imageData</var>, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-4">cropped to the source rectangle with formatting</a>. If this is an animated image, <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-14">bitmap data</a> must only be taken from the default image of the animation (the one that the format defines is to be used when animation is not supported or is disabled), or, if there is no such image, the first frame of the animation.<li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
     <dt><code id="images-2:imagedata-4"><a href="canvas.html#imagedata">ImageData</a></code><dd><ol><li><p>Let <var>buffer</var> be <var>image</var>'s <code id="images-2:dom-imagedata-data-2"><a href="canvas.html#dom-imagedata-data">data</a></code> attribute value's [[ViewedArrayBuffer]] internal slot.<li><p>If <a id="images-2:isdetachedbuffer" href="https://tc39.es/ecma262/#sec-isdetachedbuffer" data-x-internal="isdetachedbuffer">IsDetachedBuffer</a>(<var>buffer</var>) is true, then return <var>p</var> rejected with an <a id="images-2:invalidstateerror-8" href="https://triple-underscore.github.io/WebIDL-ja.html#invalidstateerror" data-x-internal="invalidstateerror">"<code>InvalidStateError</code>"</a> <code id="images-2:domexception-11"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-15">bitmap data</a> to <var>image</var>'s image data, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-5">cropped to the source rectangle with formatting</a>.<li><p>Run this step <a id="images-2:in-parallel-5" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     <dt><code id="images-2:imagebitmap-12"><a href="#imagebitmap">ImageBitmap</a></code><dd><ol><li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-16">bitmap data</a> to a copy of <var>image</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-17">bitmap data</a>, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-6">cropped to the source rectangle with formatting</a>.<li><p>Set the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-8">origin-clean</a> flag of <var>imageBitmap</var>'s bitmap to the same value as the <a href="canvas.html#concept-canvas-origin-clean" id="images-2:concept-canvas-origin-clean-9">origin-clean</a> flag of <var>image</var>'s bitmap.<li><p>Run this step <a id="images-2:in-parallel-6" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     <dt><code id="images-2:videoframe"><a data-x-internal="videoframe" href="https://w3c.github.io/webcodecs/#videoframe-interface">VideoFrame</a></code><dd><ol><li><p>Set <var>imageBitmap</var>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-18">bitmap data</a> to a copy of <var>image</var>'s visible pixel data, <a href="#cropped-to-the-source-rectangle-with-formatting" id="images-2:cropped-to-the-source-rectangle-with-formatting-7">cropped to the source rectangle with formatting</a>.<li><p>Run this step <a id="images-2:in-parallel-7" href="infrastructure.html#in-parallel">in parallel</a>:</p>

        <ol><li><p>Resolve <var>p</var> with <var>imageBitmap</var>.</ol>
       </ol>
     </dl>
   <li><p>Return <var>p</var>.</ol>

  <p>When the steps above require that the user agent <dfn id="cropped-to-the-source-rectangle-with-formatting">crop bitmap data to the source rectangle with formatting</dfn>, the user agent must run the following steps:</p>

  <ol><li><p>Let <var>input</var> be the <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-19">bitmap data</a> being transformed.<li><p>If <var>sx</var>, <var>sy</var>, <var>sw</var> and <var>sh</var> are specified, let <var>sourceRectangle</var> be a rectangle whose corners are the four points (<var>sx</var>, <var>sy</var>), (<var>sx</var>+<var>sw</var>, <var>sy</var>),(<var>sx</var>+<var>sw</var>, <var>sy</var>+<var>sh</var>), (<var>sx</var>,<var>sy</var>+<var>sh</var>). Otherwise let <var>sourceRectangle</var> be a rectangle whose corners are the four points (0,0), (width of <var>input</var>, 0), (width of <var>input</var>, height of <var>input</var>), (0, height of <var>input</var>).</p>

    <p class="note">If either <var>sw</var> or <var>sh</var> are negative, then the top-left corner of this rectangle will be to the left or above the (<var>sx</var>, <var>sy</var>) point.</p>
   <li><p>Let <var>outputWidth</var> be determined as follows:</p>

    <dl class="switch"><dt>If the <code id="images-2:dom-imagebitmapoptions-resizewidth-4"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> member of <var>options</var> is specified<dd>the value of the <code id="images-2:dom-imagebitmapoptions-resizewidth-5"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> member of <var>options</var><dt>If the <code id="images-2:dom-imagebitmapoptions-resizewidth-6"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> member of <var>options</var> is not specified, but the <code id="images-2:dom-imagebitmapoptions-resizeheight-4"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> member is specified<dd>the width of <var>sourceRectangle</var>, times the value of the <code id="images-2:dom-imagebitmapoptions-resizeheight-5"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> member of <var>options</var>, divided by the height of <var>sourceRectangle</var>, rounded up to the nearest integer<dt>If neither <code id="images-2:dom-imagebitmapoptions-resizewidth-7"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> nor <code id="images-2:dom-imagebitmapoptions-resizeheight-6"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> are specified<dd>the width of <var>sourceRectangle</var></dl>
   <li><p>Let <var>outputHeight</var> be determined as follows:</p>

    <dl class="switch"><dt>If the <code id="images-2:dom-imagebitmapoptions-resizeheight-7"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> member of <var>options</var> is specified<dd>the value of the <code id="images-2:dom-imagebitmapoptions-resizeheight-8"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> member of <var>options</var><dt>If the <code id="images-2:dom-imagebitmapoptions-resizeheight-9"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> member of <var>options</var> is not specified, but the <code id="images-2:dom-imagebitmapoptions-resizewidth-8"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> member is specified<dd>the height of <var>sourceRectangle</var>, times the value of the <code id="images-2:dom-imagebitmapoptions-resizewidth-9"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> member of <var>options</var>, divided by the width of <var>sourceRectangle</var>, rounded up to the nearest integer<dt>If neither <code id="images-2:dom-imagebitmapoptions-resizewidth-10"><a href="#dom-imagebitmapoptions-resizewidth">resizeWidth</a></code> nor <code id="images-2:dom-imagebitmapoptions-resizeheight-10"><a href="#dom-imagebitmapoptions-resizeheight">resizeHeight</a></code> are specified<dd>the height of <var>sourceRectangle</var></dl>
   <li><p>Place <var>input</var> on an infinite <a id="images-2:transparent-black-2" href="https://triple-underscore.github.io/css-color-ja.html#transparent-black" data-x-internal="transparent-black">transparent black</a> grid plane, positioned so that its top left corner is at the origin of the plane, with the <var>x</var>-coordinate increasing to the right, and the <var>y</var>-coordinate increasing down, and with each pixel in the <var>input</var> image data occupying a cell on the plane's grid.<li><p>Let <var>output</var> be the rectangle on the plane denoted by <var>sourceRectangle</var>.<li><p>Scale <var>output</var> to the size specified by <var>outputWidth</var> and <var>outputHeight</var>. The user agent should use the value of the <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-resizequality" data-dfn-type="dict-member"><code>resizeQuality</code></dfn> option to guide the choice of scaling algorithm.<li><p>If the value of the <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-imageorientation" data-dfn-type="dict-member"><code>imageOrientation</code></dfn> member of <var>options</var> is "<dfn data-dfn-for="ImageOrientation" id="dom-imageorientation-flipy" data-dfn-type="enum-value"><code>flipY</code></dfn>", <var>output</var> must be flipped vertically, disregarding any image orientation metadata of the source (such as EXIF metadata), if any. <a href="references.html#refsEXIF">[EXIF]</a></p>

    <p class="note">If the value is "<dfn data-dfn-for="ImageOrientation" id="dom-imageorientation-none" data-dfn-type="enum-value"><code>none</code></dfn>", no extra step is required.</p>
   <li><p>If <var>image</var> is an <code id="images-2:the-img-element-4"><a href="embedded-content.html#the-img-element">img</a></code> element or a <code id="images-2:blob-5"><a data-x-internal="blob" href="https://triple-underscore.github.io/File_API-ja.html#dfn-Blob">Blob</a></code> object, let <var>val</var> be the value of the <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-colorspaceconversion" data-dfn-type="dict-member"><code>colorSpaceConversion</code></dfn> member of <var>options</var>, and then run these substeps:</p>

    <ol><li><p>If <var>val</var> is "<dfn data-dfn-for="ColorSpaceConversion" id="dom-colorspaceconversion-default" data-dfn-type="enum-value"><code>default</code></dfn>", the color space conversion behavior is implementation-specific, and should be chosen according to the default color space that the implementation uses for drawing images onto the canvas.</p>
     <li><p>If <var>val</var> is "<dfn data-dfn-for="ColorSpaceConversion" id="dom-colorspaceconversion-none" data-dfn-type="enum-value"><code>none</code></dfn>", <var>output</var> must be decoded without performing any color space conversions. This means that the image decoding algorithm must ignore color profile metadata embedded in the source data as well as the display device color profile.</ol>
   <li><p>Let <var>val</var> be the value of <dfn data-dfn-for="ImageBitmapOptions" id="dom-imagebitmapoptions-premultiplyalpha" data-dfn-type="dict-member"><code>premultiplyAlpha</code></dfn> member of <var>options</var>, and then run these substeps:</p>

    <ol><li><p>If <var>val</var> is "<dfn data-dfn-for="PremultiplyAlpha" id="dom-premultiplyalpha-default" data-dfn-type="enum-value"><code>default</code></dfn>", the alpha premultiplication behavior is implementation-specific, and should be chosen according to implementation deems optimal for drawing images onto the canvas.<li><p>If <var>val</var> is "<dfn data-dfn-for="PremultiplyAlpha" id="dom-premultiplyalpha-premultiply" data-dfn-type="enum-value"><code>premultiply</code></dfn>", the <var>output</var> that is not premultiplied by alpha must have its color components <a href="canvas.html#convert-to-premultiplied" id="images-2:convert-to-premultiplied">multiplied by alpha</a> and that is premultiplied by alpha must be left untouched.<li><p>If <var>val</var> is "<dfn data-dfn-for="PremultiplyAlpha" id="dom-premultiplyalpha-none" data-dfn-type="enum-value"><code>none</code></dfn>", the <var>output</var> that is not premultiplied by alpha must be left untouched and that is premultiplied by alpha must have its color components <a href="canvas.html#convert-from-premultiplied" id="images-2:convert-from-premultiplied">divided by alpha</a>.</ol>
   <li><p>Return <var>output</var>.</ol>

  <p>The <dfn data-dfn-for="ImageBitmap" id="dom-imagebitmap-close" data-dfn-type="method"><code>close()</code></dfn> method steps are:</p>

  <ol><li><p>Set <a id="images-2:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="images-2:detached-3" href="structured-data.html#detached">[[Detached]]</a> internal slot value to true.<li><p>Unset <a id="images-2:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-imagebitmap-bitmap-data" id="images-2:concept-imagebitmap-bitmap-data-20">bitmap data</a>.</ol>

  <p>The <dfn data-dfn-for="ImageBitmap" id="dom-imagebitmap-width" data-dfn-type="attribute"><code>width</code></dfn> getter steps are:</p>

  <ol><li><p>If <a id="images-2:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="images-2:detached-4" href="structured-data.html#detached">[[Detached]]</a> internal slot's value is true, then return 0.<li><p>Return <a id="images-2:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s width, in <a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-4" data-x-internal="'px'">CSS pixels</a>.</ol>

  <p>The <dfn data-dfn-for="ImageBitmap" id="dom-imagebitmap-height" data-dfn-type="attribute"><code>height</code></dfn> getter steps are:</p>

  <ol><li><p>If <a id="images-2:this-5" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a id="images-2:detached-5" href="structured-data.html#detached">[[Detached]]</a> internal slot's value is true, then return 0.<li><p>Return <a id="images-2:this-6" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s height, in <a href="https://triple-underscore.github.io/css-values-ja.html#px" id="images-2:'px'-5" data-x-internal="'px'">CSS pixels</a>.</ol>

  <p>The <code id="images-2:resizequality-2"><a href="#resizequality">ResizeQuality</a></code> enumeration is used to express a preference for the interpolation quality to use when scaling images.</p>

  <p>The "<dfn data-dfn-for="ResizeQuality" id="dom-resizequality-pixelated" data-dfn-type="enum-value"><code>pixelated</code></dfn>" value indicates a preference to scale the image that maximizes the appearance. Scaling algorithms that "smooth" colors are acceptable, such as bilinear interpolation.</p>

  <p>The "<dfn data-dfn-for="ResizeQuality" id="dom-resizequality-low" data-dfn-type="enum-value"><code>low</code></dfn>" value indicates a preference for a low level of image interpolation quality. Low-quality image interpolation may be more computationally efficient than higher settings.</p>

  <p>The "<dfn data-dfn-for="ResizeQuality" id="dom-resizequality-medium" data-dfn-type="enum-value"><code>medium</code></dfn>" value indicates a preference for a medium level of image interpolation quality.</p>

  <p>The "<dfn data-dfn-for="ResizeQuality" id="dom-resizequality-high" data-dfn-type="enum-value"><code>high</code></dfn>" value indicates a preference for a high level of image interpolation quality. High-quality image interpolation may be more computationally expensive than lower settings.</p>

  <p class="note">Bilinear scaling is an example of a relatively fast, lower-quality image-smoothing algorithm. Bicubic or Lanczos scaling are examples of image-scaling algorithms that produce higher-quality output. This specification does not mandate that specific interpolation algorithms be used unless the value is "<a href="#dom-resizequality-pixelated" id="images-2:dom-resizequality-pixelated-2">pixelated</a>".</p>

  

  <div class="example"><p>このAPIを使用すると、スプライトシートは、プレカットと調製することができる：</p>

   <pre><code class='js'><c- a>var</c-> sprites <c- o>=</c-> <c- p>{};</c->
<c- a>function</c-> loadMySprites<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> image <c- o>=</c-> <c- k>new</c-> Image<c- p>();</c->
  image<c- p>.</c->src <c- o>=</c-> <c- t>'mysprites.png'</c-><c- p>;</c->
  <c- a>var</c-> resolver<c- p>;</c->
  <c- a>var</c-> promise <c- o>=</c-> <c- k>new</c-> Promise<c- p>(</c-><c- a>function</c-> <c- p>(</c->arg<c- p>)</c-> <c- p>{</c-> resolver <c- o>=</c-> arg <c- p>});</c->
  image<c- p>.</c->onload <c- o>=</c-> <c- a>function</c-> <c- p>()</c-> <c- p>{</c->
    resolver<c- p>(</c->Promise<c- p>.</c->all<c- p>([</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mf>0</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->person <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>40</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->grass  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>80</c-><c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->tree   <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c->  <c- mf>0</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->hut    <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->apple  <c- o>=</c-> image <c- p>}),</c->
      createImageBitmap<c- p>(</c->image<c- p>,</c-> <c- mf>80</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>,</c-> <c- mf>40</c-><c- p>).</c->then<c- p>(</c-><c- a>function</c-> <c- p>(</c->image<c- p>)</c-> <c- p>{</c-> sprites<c- p>.</c->snake  <c- o>=</c-> image <c- p>})</c->
    <c- p>]));</c->
  <c- p>};</c->
  <c- k>return</c-> promise<c- p>;</c->
<c- p>}</c->

<c- a>function</c-> runDemo<c- p>()</c-> <c- p>{</c->
  <c- a>var</c-> canvas <c- o>=</c-> document<c- p>.</c->querySelector<c- p>(</c-><c- t>'canvas#demo'</c-><c- p>);</c->
  <c- a>var</c-> context <c- o>=</c-> canvas<c- p>.</c->getContext<c- p>(</c-><c- t>'2d'</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->tree<c- p>,</c-> <c- mf>30</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
  context<c- p>.</c->drawImage<c- p>(</c->sprites<c- p>.</c->snake<c- p>,</c-> <c- mf>70</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
<c- p>}</c->

loadMySprites<c- p>().</c->then<c- p>(</c->runDemo<c- p>);</c-></code></pre>

  </div>



  <h3 id="animation-frames"><span class="secno">8.11</span> アニメーションフレーム<a href="#animation-frames" class="self-link"></a></h3>

  <p>一部のオブジェクトには<code id="animation-frames:animationframeprovider"><a href="#animationframeprovider">AnimationFrameProvider</a></code>インターフェイスミックスインが含まれる。</p>

  <pre><code class='idl'><c- b>callback</c-> <dfn id='framerequestcallback' data-dfn-type='callback'><c- g>FrameRequestCallback</c-></dfn> = <c- b>undefined</c-> (<a id='animation-frames:domhighrestimestamp' href='https://triple-underscore.github.io/hr-time-ja.html#dom-domhighrestimestamp' data-x-internal='domhighrestimestamp'><c- n>DOMHighResTimeStamp</c-></a> <c- g>time</c->);

<c- b>interface</c-> <c- b>mixin</c-> <dfn id='animationframeprovider' data-dfn-type='interface'><c- g>AnimationFrameProvider</c-></dfn> {
  <c- b>unsigned</c-> <c- b>long</c-> <a href='#dom-animationframeprovider-requestanimationframe' id='animation-frames:dom-animationframeprovider-requestanimationframe'><c- g>requestAnimationFrame</c-></a>(<a href='#framerequestcallback' id='animation-frames:framerequestcallback'><c- n>FrameRequestCallback</c-></a> <c- g>callback</c->);
  <c- b>undefined</c-> <a href='#animationframeprovider-cancelanimationframe' id='animation-frames:animationframeprovider-cancelanimationframe'><c- g>cancelAnimationFrame</c-></a>(<c- b>unsigned</c-> <c- b>long</c-> <c- g>handle</c->);
};
<a id='animation-frames:window' href='window-object.html#window'><c- n>Window</c-></a> <c- b>includes</c-> <a href='#animationframeprovider' id='animation-frames:animationframeprovider-2'><c- n>AnimationFrameProvider</c-></a>;
<a id='animation-frames:dedicatedworkerglobalscope' href='workers.html#dedicatedworkerglobalscope'><c- n>DedicatedWorkerGlobalScope</c-></a> <c- b>includes</c-> <a href='#animationframeprovider' id='animation-frames:animationframeprovider-3'><c- n>AnimationFrameProvider</c-></a>;</code></pre>

  <p>各<code id="animation-frames:animationframeprovider-4"><a href="#animationframeprovider">AnimationFrameProvider</a></code>オブジェクトはまた、プロバイダーの内部状態を格納する<dfn id="concept-animationframeprovider-target-object">ターゲットオブジェクト</dfn>を持つ。これは次のように定義される：</p>

  <dl><dt><code id="animation-frames:animationframeprovider-5"><a href="#animationframeprovider">AnimationFrameProvider</a></code>が<code id="animation-frames:window-2"><a href="window-object.html#window">Window</a></code>である場合<dd><code id="animation-frames:window-3"><a href="window-object.html#window">Window</a></code>の<a href="window-object.html#concept-document-window" id="animation-frames:concept-document-window">関連付けられた<code>Document</code></a><dt><code id="animation-frames:animationframeprovider-6"><a href="#animationframeprovider">AnimationFrameProvider</a></code>が <code id="animation-frames:dedicatedworkerglobalscope-2"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>である場合<dd><code id="animation-frames:dedicatedworkerglobalscope-3"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code></dl>

  <p>各<a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object">ターゲットオブジェクト</a>は、<dfn id="list-of-animation-frame-callbacks">アニメーションフレームコールバックのマップ</dfn>、これは初期は空でなければならない<a id="animation-frames:ordered-map" href="https://triple-underscore.github.io/infra-ja.html#ordered-map" data-x-internal="ordered-map">順序付きマップ</a>である、および<dfn id="animation-frame-callback-identifier">アニメーションフレームコールバック識別子</dfn>、これは初期は0でなければならない数、を持つ。</p>

  <p>次のいずれかが当てはまる場合、<code id="animation-frames:animationframeprovider-7"><a href="#animationframeprovider">AnimationFrameProvider</a></code><var>プロバイダー</var>は<dfn id="concept-animationframeprovider-supported">サポートされる</dfn>とみなされる：</p>

  <ul class="brief"><li><var>provider</var>が<code id="animation-frames:window-4"><a href="window-object.html#window">Window</a></code>である。<li><var>provider</var>の<a id="animation-frames:concept-WorkerGlobalScope-owner-set" href="workers.html#concept-WorkerGlobalScope-owner-set">所有者集合</a>が<code id="animation-frames:document"><a href="dom.html#document">Document</a></code>オブジェクトを<a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="animation-frames:list-contains" data-x-internal="list-contains">含む</a>。<li><var>provider</var>の<a id="animation-frames:concept-WorkerGlobalScope-owner-set-2" href="workers.html#concept-WorkerGlobalScope-owner-set">所有者集合</a>におけるすべての<code id="animation-frames:dedicatedworkerglobalscope-4"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code>オブジェクトが<a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported">サポートされる</a>。</ul>

  <hr>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/requestAnimationFrame" title="The window.requestAnimationFrame() method tells the browser that you wish to perform an animation and requests that the browser calls a specified function to update an animation before the next repaint. The method takes a callback as an argument to be invoked before the repaint.">Window/requestAnimationFrame</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>23+</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>4.4+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><p>The <dfn data-dfn-for="AnimationFrameProvider" id="dom-animationframeprovider-requestanimationframe" data-dfn-type="method"><code>requestAnimationFrame(<var>callback</var>)</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="animation-frames:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-2">supported</a>, then throw a <a id="animation-frames:notsupportederror" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>target</var> be <a id="animation-frames:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-2">target object</a>.<li><p>Increment <var>target</var>'s <a href="#animation-frame-callback-identifier" id="animation-frames:animation-frame-callback-identifier">animation frame callback identifier</a> by one, and let <var>handle</var> be the result.<li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks">map of animation frame callbacks</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-set" id="animation-frames:map-set" data-x-internal="map-set">Set</a> <var>callbacks</var>[<var>handle</var>] to <var>callback</var>.<li><p>Return <var>handle</var>.</ol>

  <div class="mdn-anno wrapped before"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame" title="The window.cancelAnimationFrame() method cancels an animation frame request previously scheduled through a call to window.requestAnimationFrame().">Window/cancelAnimationFrame</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>23+</span></span><span class="safari yes"><span>Safari</span><span>7+</span></span><span class="chrome yes"><span>Chrome</span><span>24+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge yes"><span>Edge (Legacy)</span><span>12+</span></span><span class="ie yes"><span>Internet Explorer</span><span>10+</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android unknown"><span>WebView Android</span><span>?</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div><p>The <dfn data-dfn-for="AnimationFrameProvider" id="animationframeprovider-cancelanimationframe" data-dfn-type="method"><code>cancelAnimationFrame(<var>handle</var>)</code></dfn> method steps are:</p>

  <ol><li><p>If <a id="animation-frames:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a> is not <a href="#concept-animationframeprovider-supported" id="animation-frames:concept-animationframeprovider-supported-3">supported</a>, then throw a <a id="animation-frames:notsupportederror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#notsupportederror" data-x-internal="notsupportederror">"<code>NotSupportedError</code>"</a> <code id="animation-frames:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>callbacks</var> be <a id="animation-frames:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-3">target object</a>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-2">map of animation frame callbacks</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-remove" id="animation-frames:map-remove" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].</ol>

  <p>To <dfn id="run-the-animation-frame-callbacks">run the animation frame callbacks</dfn> for a <a href="#concept-animationframeprovider-target-object" id="animation-frames:concept-animationframeprovider-target-object-4">target object</a> <var>target</var> with a timestamp <var>now</var>:</p>

  <ol><li><p>Let <var>callbacks</var> be <var>target</var>'s <a href="#list-of-animation-frame-callbacks" id="animation-frames:list-of-animation-frame-callbacks-3">map of animation frame callbacks</a>.<li><p>Let <var>callbackHandles</var> be the result of <a href="https://triple-underscore.github.io/infra-ja.html#map-getting-the-keys" id="animation-frames:map-get-the-keys" data-x-internal="map-get-the-keys">getting the keys</a> of <var>callbacks</var>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="animation-frames:list-iterate" data-x-internal="list-iterate">For each</a> <var>handle</var> in <var>callbackHandles</var>, if <var>handle</var> <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="animation-frames:map-exists" data-x-internal="map-exists">exists</a> in <var>callbacks</var>:</p>

    <ol><li><p>Let <var>callback</var> be <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://triple-underscore.github.io/infra-ja.html#map-remove" id="animation-frames:map-remove-2" data-x-internal="map-remove">Remove</a> <var>callbacks</var>[<var>handle</var>].<li><p><a href="https://triple-underscore.github.io/WebIDL-JS-ja.html#invoke-a-callback-function" id="animation-frames:es-invoking-callback-functions" data-x-internal="es-invoking-callback-functions">Invoke</a> <var>callback</var>, passing <var>now</var> as the only argument, and if an exception is thrown, <a id="animation-frames:report-the-exception" href="webappapis.html#report-the-exception">report the exception</a>.</ol>
   </ol>

  <div class="example"><p>ワーカー内部では、<code id="animation-frames:the-canvas-element"><a href="canvas.html#the-canvas-element">canvas</a></code>要素から転送された<code id="animation-frames:offscreencanvas"><a href="canvas.html#offscreencanvas">OffscreenCanvas</a></code>と一緒に<code id="animation-frames:dom-animationframeprovider-requestanimationframe-2"><a href="#dom-animationframeprovider-requestanimationframe">requestAnimationFrame()</a></code>を使用することができる。まず、文書内で、ワーカーに制御を転送する：</p>

   <pre><code class='js'><c- a>const</c-> offscreenCanvas <c- o>=</c-> document<c- p>.</c->getElementById<c- p>(</c-><c- u>"c"</c-><c- p>).</c->transferControlToOffscreen<c- p>();</c->
worker<c- p>.</c->postMessage<c- p>(</c->offscreenCanvas<c- p>,</c-> <c- p>[</c->offscreenCanvas<c- p>]);</c-></code></pre>

   <p>次に、ワーカーにおいて、以下のコードで左から右に移動する矩形を描画する：</p>

   <pre><code class='js'><c- a>let</c-> ctx<c- p>,</c-> pos <c- o>=</c-> <c- mf>0</c-><c- p>;</c->
<c- a>function</c-> draw<c- p>(</c->dt<c- p>)</c-> <c- p>{</c->
  ctx<c- p>.</c->clearRect<c- p>(</c-><c- mf>0</c-><c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>100</c-><c- p>,</c-> <c- mf>100</c-><c- p>);</c->
  ctx<c- p>.</c->fillRect<c- p>(</c->pos<c- p>,</c-> <c- mf>0</c-><c- p>,</c-> <c- mf>10</c-><c- p>,</c-> <c- mf>10</c-><c- p>);</c->
  pos <c- o>+=</c-> <c- mf>10</c-> <c- o>*</c-> dt<c- p>;</c->
  requestAnimationFrame<c- p>(</c->draw<c- p>);</c->
<c- p>}</c->

self<c- p>.</c->onmessage <c- o>=</c-> <c- a>function</c-><c- p>(</c->ev<c- p>)</c-> <c- p>{</c->
  <c- a>const</c-> transferredCanvas <c- o>=</c-> ev<c- p>.</c->data<c- p>;</c->
  ctx <c- o>=</c-> transferredCanvas<c- p>.</c->getContext<c- p>(</c-><c- u>"2d"</c-><c- p>);</c->
  draw<c- p>();</c->
<c- p>};</c-></code></pre>
  </div>

  <nav><a href="system-state.html">← 8.9 システム状態および性能</a> — <a href="./">目次</a> — <a href="comms.html">9 コミュニケーション →</a></nav>

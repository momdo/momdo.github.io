<!DOCTYPE html><html class="split" lang="ja"><script src="https://html.spec.whatwg.org/link-fixup.js" defer=""></script><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"><title>HTML Standard 日本語訳</title><meta content="#3c790a" name="theme-color"><link rel="stylesheet" href="https://resources.whatwg.org/spec.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard.css" crossorigin=""><link rel="stylesheet" href="https://resources.whatwg.org/standard-shared-with-dev.css" crossorigin=""><link rel="icon" href="https://resources.whatwg.org/logo.svg" crossorigin=""><link rel="stylesheet" href="https://html.spec.whatwg.org/styles.css" crossorigin=""><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
   function setLinkFragment(link) {
     link.hash = location.hash;
   }
  </script><body>
  
  <script defer="" crossorigin="" src="./html-dfn.js"></script>
  
  <header id="head" class="head with-buttons"><a href="https://whatwg.org/" class="logo"><img width="100" alt="WHATWG" crossorigin="" src="https://resources.whatwg.org/logo.svg" height="100"></a><hgroup><h1 class="allcaps">HTML</h1><p id="living-standard">Living Standard — Last Updated <span class="pubdate">15 December 2023</span></hgroup>
   
   

   
  </header>

  

  

  

  
  

  
  

  

  <nav><a href="popover.html">← 6.12 The popover attribute</a> — <a href="./">Table of Contents</a> — <a href="nav-history-apis.html">7.2 APIs related to navigation and session history →</a></nav><ol class="toc"><li id="toc-browsers"><a href="browsers.html#browsers"><span class="secno">7</span> ウェブページの読み込み</a><ol><li><a href="browsers.html#loading-web-pages-supporting-concepts"><span class="secno">7.1</span> サポートコンセプト</a><ol><li><a href="browsers.html#origin"><span class="secno">7.1.1</span> 生成元</a><ol><li><a href="browsers.html#sites"><span class="secno">7.1.1.1</span> サイト</a><li><a href="browsers.html#relaxing-the-same-origin-restriction"><span class="secno">7.1.1.2</span> 同一生成元制限を緩和する</a></ol><li><a href="browsers.html#origin-keyed-agent-clusters"><span class="secno">7.1.2</span> オリジンキーエージェントクラスター</a><li><a href="browsers.html#cross-origin-opener-policies"><span class="secno">7.1.3</span> 生成元をまたいだオープナーポリシー</a><ol><li><a href="browsers.html#the-coop-headers"><span class="secno">7.1.3.1</span> ヘッダー</a><li><a href="browsers.html#browsing-context-group-switches-due-to-cross-origin-opener-policy"><span class="secno">7.1.3.2</span> Browsing context group switches due to cross-origin opener policy</a><li><a href="browsers.html#coop-reporting"><span class="secno">7.1.3.3</span> Reporting</a></ol><li><a href="browsers.html#coep"><span class="secno">7.1.4</span> 生成元をまたいだ埋め込みポリシー</a><ol><li><a href="browsers.html#the-coep-headers"><span class="secno">7.1.4.1</span> ヘッダー</a><li><a href="browsers.html#embedder-policy-checks"><span class="secno">7.1.4.2</span> Embedder policy checks</a></ol><li><a href="browsers.html#sandboxing"><span class="secno">7.1.5</span> サンドボックス</a><li><a href="browsers.html#policy-containers"><span class="secno">7.1.6</span> Policy containers</a></ol></ol></ol><h2 id="browsers"><span class="secno">7</span> ウェブページの読み込み<a href="#browsers" class="self-link"></a></h2>

  

  <p>このセクションは、ウェブブラウザーに最も直接的に適用される機能について説明する。それでもやはり、特に指定しない限り、このセクションで定義されている要件は、ウェブブラウザーであるかどうかに関わらず、すべてのユーザーエージェントに適用<em>される</em>。</p>

  

  <h3 id="loading-web-pages-supporting-concepts"><span class="secno">7.1</span> サポートコンセプト<a href="#loading-web-pages-supporting-concepts" class="self-link"></a></h3>

  <h4 id="origin"><span class="secno">7.1.1</span> 生成元<a href="#origin" class="self-link"></a></h4>
  

  <p>生成元は、ウェブのセキュリティモデルの基本的な通貨である。生成元を共有するウェブプラットフォーム内の2つの当事者が互いに信頼し、同一の権限を有すると仮定される。異なる生成元をもつ当事者は、互いに潜在的に悪意があると見なされ、互いから程度を変化させるよう隔離される。</p>

  <p class="example">たとえば、<code>bank.example.com</code>でホストされるExample Bankのウェブサイトは、<code>charity.example.org</code>でホストExample CharityのウェブサイトのDOMを検査しようとすると、<a id="origin:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="origin:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code> が発生する。</p>

  <hr>

  <p id="origin-2"><dfn id="concept-origin" data-export="">生成元</dfn>は次のいずれかである：</p>

  <dl><dt><dfn id="concept-origin-opaque" data-export="">不透明な生成元</dfn><dd><p>内部値であり、シリアライズされていないために再作成することができない（<a href="#ascii-serialisation-of-an-origin" id="origin:ascii-serialisation-of-an-origin">生成元のシリアライズ</a>ごとに"<code>null</code>"としてシリアライズされる）。意味のある操作は、透過性のテストのみである。<dt><dfn id="concept-origin-tuple" data-export="">タプルの生成元</dfn><dd><p><a href="#concept-origin-tuple" id="origin:concept-origin-tuple">タプル</a>は以下で構成される：<ul class="brief"><li><dfn data-dfn-for="origin" id="concept-origin-scheme" data-export="">スキーム</dfn>（<a id="origin:ascii-string" href="https://triple-underscore.github.io/infra-ja.html#ascii-string" data-x-internal="ascii-string">ASCII文字列</a>）。<li><dfn data-dfn-for="origin" id="concept-origin-host" data-export="">ホスト</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-host" id="origin:concept-host" data-x-internal="concept-host">ホスト</a>）。<li><dfn data-dfn-for="origin" id="concept-origin-port" data-export="">ポート</dfn>（nullまたは16-bit符号なし整数）。<li><dfn data-dfn-for="origin" id="concept-origin-domain" data-export="">ドメイン</dfn>（nullまたは<a href="https://triple-underscore.github.io/URL-ja.html#concept-domain" id="origin:concept-domain" data-x-internal="concept-domain">ドメイン</a>）。特に明記されていない限り、null。</ul>
   </dl>

  <p class="note"><a href="#concept-origin" id="origin:concept-origin">生成元</a>は、たとえば複数の<code id="origin:document"><a href="dom.html#document">Document</a></code>オブジェクト間で共有できる。さらに、<a href="#concept-origin" id="origin:concept-origin-2">生成元</a>は一般に不変である。<a href="#concept-origin-tuple" id="origin:concept-origin-tuple-2">タプルの生成元</a>の<a href="#concept-origin-domain" id="origin:concept-origin-domain">ドメイン</a>のみ、および<code id="origin:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code> APIを介してのみ変更できる。</p>

  

  <p><a href="#concept-origin" id="origin:concept-origin-3">生成元</a><var>origin</var>の<dfn id="concept-origin-effective-domain" data-export="">有効ドメイン</dfn>は、次のように計算される：</p>

  <ol><li><p><var>origin</var>が<a href="#concept-origin-opaque" id="origin:concept-origin-opaque">不透明な生成元</a>である場合、nullを返す。<li><p><var>origin</var>の<a href="#concept-origin-domain" id="origin:concept-origin-domain-2">ドメイン</a>がnullでない場合、<var>origin</var>の<a href="#concept-origin-domain" id="origin:concept-origin-domain-3">ドメイン</a>を返す。<li><p><var>origin</var>の<a href="#concept-origin-host" id="origin:concept-origin-host">ホスト</a>を返す。</ol>

  <p>The <dfn id="ascii-serialisation-of-an-origin" data-lt="serialization of an
  origin|ASCII serialization of an origin" data-export="">serialization of an origin</dfn> is the string obtained by applying the following algorithm to the given <a href="#concept-origin" id="origin:concept-origin-4">origin</a> <var>origin</var>:</p>

  <ol><li><p>If <var>origin</var> is an <a href="#concept-origin-opaque" id="origin:concept-origin-opaque-2">opaque origin</a>, then return "<code>null</code>".<li><p>Otherwise, let <var>result</var> be <var>origin</var>'s <a href="#concept-origin-scheme" id="origin:concept-origin-scheme">scheme</a>.<li><p>Append "<code>://</code>" to <var>result</var>.<li><p>Append <var>origin</var>'s <a href="#concept-origin-host" id="origin:concept-origin-host-2">host</a>, <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-serializer" id="origin:host-serializer" data-x-internal="host-serializer">serialized</a>, to <var>result</var>.<li><p>If <var>origin</var>'s <a href="#concept-origin-port" id="origin:concept-origin-port">port</a> is non-null, append a U+003A COLON character (:), and <var>origin</var>'s <a href="#concept-origin-port" id="origin:concept-origin-port-2">port</a>, <a href="https://triple-underscore.github.io/URL-ja.html#serialize-an-integer" id="origin:serialize-an-integer" data-x-internal="serialize-an-integer">serialized</a>, to <var>result</var>.<li><p>Return <var>result</var>.</ol>

  

  <p class="example">("<code>https</code>", "<code>xn--maraa-rta.example</code>", null, null)の <a href="#ascii-serialisation-of-an-origin" id="origin:ascii-serialisation-of-an-origin-2">シリアライゼーション</a>は"<code>https://xn--maraa-rta.example</code>"となる。</p>

  

  <p id="unicode-serialisation-of-an-origin" class="note">There used to also be a <i>Unicode serialization of an origin</i>. However, it was never widely adopted.</p>

  <hr>

  <p>Two <a href="#concept-origin" id="origin:concept-origin-5">origins</a>, <var>A</var> and <var>B</var>, are said to be <dfn id="same-origin" data-export="">same origin</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href="#concept-origin-opaque" id="origin:concept-origin-opaque-3">opaque origin</a>, then return true.<li><p>If <var>A</var> and <var>B</var> are both <a href="#concept-origin-tuple" id="origin:concept-origin-tuple-3">tuple origins</a> and their <a href="#concept-origin-scheme" id="origin:concept-origin-scheme-2">schemes</a>, <a href="#concept-origin-host" id="origin:concept-origin-host-3">hosts</a>, and <a href="#concept-origin-port" id="origin:concept-origin-port-3">port</a> are identical, then return true.<li><p>falseを返す。</ol>

  <p>Two <a href="#concept-origin" id="origin:concept-origin-6">origins</a>, <var>A</var> and <var>B</var>, are said to be <dfn id="same-origin-domain" data-export="">same origin-domain</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href="#concept-origin-opaque" id="origin:concept-origin-opaque-4">opaque origin</a>, then return true.<li><p>If <var>A</var> and <var>B</var> are both <a href="#concept-origin-tuple" id="origin:concept-origin-tuple-4">tuple origins</a>, run these substeps:</p>

    <ol><li><p>If <var>A</var> and <var>B</var>'s <a href="#concept-origin-scheme" id="origin:concept-origin-scheme-3">schemes</a> are identical, and their <a href="#concept-origin-domain" id="origin:concept-origin-domain-4">domains</a> are identical and non-null, then return true.<li><p>Otherwise, if <var>A</var> and <var>B</var> are <a href="#same-origin" id="origin:same-origin">same origin</a> and their <a href="#concept-origin-domain" id="origin:concept-origin-domain-5">domains</a> are identical and null, then return true.</ol>

   <li><p>falseを返す。</ol>

  

  <div class="example"><table><tr><th><var>A</var><th><var>B</var><th><a href="#same-origin" id="origin:same-origin-2">same origin</a><th><a href="#same-origin-domain" id="origin:same-origin-domain">same origin-domain</a><tr><td>("<code>https</code>", "<code>example.org</code>", null, null)<td>("<code>https</code>", "<code>example.org</code>", null, null)<td>✅<td>✅<tr><td>("<code>https</code>", "<code>example.org</code>", 314, null)<td>("<code>https</code>", "<code>example.org</code>", 420, null)<td>❌<td>❌<tr><td>("<code>https</code>", "<code>example.org</code>", 314, "<code>example.org</code>")<td>("<code>https</code>", "<code>example.org</code>", 420, "<code>example.org</code>")<td>❌<td>✅<tr><td>("<code>https</code>", "<code>example.org</code>", null, null)<td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")<td>✅<td>❌<tr><td>("<code>https</code>", "<code>example.org</code>", null, "<code>example.org</code>")<td>("<code>http</code>", "<code>example.org</code>", null, "<code>example.org</code>")<td>❌<td>❌</table>
  </div>


  <h5 id="sites"><span class="secno">7.1.1.1</span> サイト<a href="#sites" class="self-link"></a></h5>

  <p><dfn id="scheme-and-host">スキームとホスト</dfn>は、<dfn id="concept-scheme-and-host-scheme">スキーム</dfn>（<a id="sites:ascii-string" href="https://triple-underscore.github.io/infra-ja.html#ascii-string" data-x-internal="ascii-string">ASCII文字列</a>）および<dfn id="concept-scheme-and-host-host">ホスト</dfn>（<a href="https://triple-underscore.github.io/URL-ja.html#concept-host" id="sites:concept-host" data-x-internal="concept-host">ホスト</a>）の<a id="sites:tuple" href="https://triple-underscore.github.io/infra-ja.html#tuple" data-x-internal="tuple">タプル</a>である。</p>

  <p><dfn id="site" data-export="">サイト</dfn>は<a href="#concept-origin-opaque" id="sites:concept-origin-opaque">不透明な生成元</a>または<a href="#scheme-and-host" id="sites:scheme-and-host">scheme-and-host</a>である。</p>

  

  <p>To <dfn id="obtain-a-site" data-export="">obtain a site</dfn>, given an origin <var>origin</var>, run these steps:</p>

  <ol><li><p>If <var>origin</var> is an <a href="#concept-origin-opaque" id="sites:concept-origin-opaque-2">opaque origin</a>, then return <var>origin</var>.<li><p>If <var>origin</var>'s <a href="#concept-origin-host" id="sites:concept-origin-host">host</a>'s <a id="sites:registrable-domain" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a> is null, then return (<var>origin</var>'s <a href="#concept-origin-scheme" id="sites:concept-origin-scheme">scheme</a>, <var>origin</var>'s <a href="#concept-origin-host" id="sites:concept-origin-host-2">host</a>).<li><p>Return (<var>origin</var>'s <a href="#concept-origin-scheme" id="sites:concept-origin-scheme-2">scheme</a>, <var>origin</var>'s <a href="#concept-origin-host" id="sites:concept-origin-host-3">host</a>'s <a id="sites:registrable-domain-2" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a>).</ol>

  <p>Two <a href="#site" id="sites:site">sites</a>, <var>A</var> and <var>B</var>, are said to be <dfn data-dfn-for="site" id="concept-site-same-site" data-export="">same site</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href="#concept-origin-opaque" id="sites:concept-origin-opaque-3">opaque origin</a>, the return true.<li><p>If <var>A</var> or <var>B</var> is an <a href="#concept-origin-opaque" id="sites:concept-origin-opaque-4">opaque origin</a>, then return false.<li><p>If <var>A</var>'s and <var>B</var>'s <a href="#concept-scheme-and-host-scheme" id="sites:concept-scheme-and-host-scheme">scheme</a> values are different, then return false.<li><p>If <var>A</var>'s and <var>B</var>'s <a href="#concept-scheme-and-host-host" id="sites:concept-scheme-and-host-host">host</a> values are not <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-equals" id="sites:host-equals" data-x-internal="host-equals">equal</a>, then return false.<li><p>Return true.</ol>

  <p>The <dfn id="serialization-of-a-site" data-export="">serialization of a site</dfn> is the string obtained by applying the following algorithm to the given <a href="#site" id="sites:site-2">site</a> <var>site</var>:</p>

  <ol><li><p>If <var>site</var> is an <a href="#concept-origin-opaque" id="sites:concept-origin-opaque-5">opaque origin</a>, then return "<code>null</code>".<li><p>Let <var>result</var> be <var>site</var>[0].<li><p>Append "<code>://</code>" to <var>result</var>.<li><p>Append <var>site</var>[1], <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-serializer" id="sites:host-serializer" data-x-internal="host-serializer">serialized</a>, to <var>result</var>.<li><p>Return <var>result</var>.</ol>

  <p class="warning">It needs to be clear from context that the serialized value is a site, not an origin, as there is not necessarily a syntactic difference between the two. For example, the origin ("<code>https</code>", "<code>shop.example</code>", null, null) and the site ("<code>https</code>", "<code>shop.example</code>") have the same serialization: "<code>https://shop.example</code>".</p>

  <p>Two <a href="#concept-origin" id="sites:concept-origin">origins</a>, <var>A</var> and <var>B</var>, are said to be <dfn id="schemelessly-same-site" data-export="">schemelessly same site</dfn> if the following algorithm returns true:</p>

  <ol><li><p>If <var>A</var> and <var>B</var> are the same <a href="#concept-origin-opaque" id="sites:concept-origin-opaque-6">opaque origin</a>, then return true.<li><p>If <var>A</var> and <var>B</var> are both <a href="#concept-origin-tuple" id="sites:concept-origin-tuple">tuple origins</a>, then:</p>

    <ol><li><p>Let <var>hostA</var> be <var>A</var>'s <a href="#concept-origin-host" id="sites:concept-origin-host-4">host</a>, and let <var>hostB</var> be <var>B</var>'s <a href="#concept-origin-host" id="sites:concept-origin-host-5">host</a>.<li><p>If <var>hostA</var> <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-equals" id="sites:host-equals-2" data-x-internal="host-equals">equals</a> <var>hostB</var> and <var>hostA</var>'s <a id="sites:registrable-domain-3" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a> is null, then return true.<li><p>If <var>hostA</var>'s <a id="sites:registrable-domain-4" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a> <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-equals" id="sites:host-equals-3" data-x-internal="host-equals">equals</a> <var>hostB</var>'s <a id="sites:registrable-domain-5" href="https://triple-underscore.github.io/URL-ja.html#host-registrable-domain" data-x-internal="registrable-domain">registrable domain</a> and is non-null, then return true.</ol>
   <li><p>falseを返す。</ol>

  <p>Two <a href="#concept-origin" id="sites:concept-origin-2">origins</a>, <var>A</var> and <var>B</var>, are said to be <dfn id="same-site" data-export="">same site</dfn> if the following algorithm returns true:</p>

  <ol><li><p>Let <var>siteA</var> be the result of <a href="#obtain-a-site" id="sites:obtain-a-site">obtaining a site</a> given <var>A</var>.<li><p>Let <var>siteB</var> be the result of <a href="#obtain-a-site" id="sites:obtain-a-site-2">obtaining a site</a> given <var>B</var>.<li><p>If <var>siteA</var> is <a href="#concept-site-same-site" id="sites:concept-site-same-site">same site</a> with <var>siteB</var>, then return true.<li><p>falseを返す。</ol>

  

  <p class="note"><a href="#same-origin" id="sites:same-origin">同一生成元</a>および<a href="#same-origin-domain" id="sites:same-origin-domain">同一origin-domain</a>の概念とは異なり、<a href="#schemelessly-same-site" id="sites:schemelessly-same-site">スキームレスで同じサイト</a>および<a href="#same-site" id="sites:same-site">同じサイト</a>の場合、<a href="#concept-origin-port" id="sites:concept-origin-port">ポート</a>および<a href="#concept-origin-domain" id="sites:concept-origin-domain">ドメイン</a>コンポーネントは無視される。</p>

  <p class="warning"><a href="https://triple-underscore.github.io/URL-ja.html#warning-avoid-psl"><cite>URL</cite>で説明される</a>理由により、<a href="#same-origin" id="sites:same-origin-2">同一生成元</a>チェックを優先して、可能な場合は<a href="#same-site" id="sites:same-site-2">同じサイト</a>および<a href="#schemelessly-same-site" id="sites:schemelessly-same-site-2">スキームレスで同じサイト</a>の概念を回避すべきである。</p>

  <div id="example-same-site" class="example"><p><code>wildlife.museum</code>、<code>museum</code>、および<code>com</code>は<a href="https://triple-underscore.github.io/URL-ja.html#host-public-suffix" id="sites:public-suffix" data-x-internal="public-suffix">公開サフィックス</a>であり、<code>example.com</code>はそうではない：</p>

   <table><tr><th><var>A</var><th><var>B</var><th><a href="#schemelessly-same-site" id="sites:schemelessly-same-site-3">schemelessly same site</a><th><a href="#same-site" id="sites:same-site-3">same site</a><tr><td>("<code>https</code>", "<code>example.com</code>")<td>("<code>https</code>", "<code>sub.example.com</code>")<td>✅<td>✅<tr><td>("<code>https</code>", "<code>example.com</code>")<td>("<code>https</code>", "<code>sub.other.example.com</code>")<td>✅<td>✅<tr><td>("<code>https</code>", "<code>example.com</code>")<td>("<code>http</code>", "<code>non-secure.example.com</code>")<td>✅<td>❌<tr><td>("<code>https</code>", "<code>r.wildlife.museum</code>")<td>("<code>https</code>", "<code>sub.r.wildlife.museum</code>")<td>✅<td>✅<tr><td>("<code>https</code>", "<code>r.wildlife.museum</code>")<td>("<code>https</code>", "<code>sub.other.r.wildlife.museum</code>")<td>✅<td>✅<tr><td>("<code>https</code>", "<code>r.wildlife.museum</code>")<td>("<code>https</code>", "<code>other.wildlife.museum</code>")<td>❌<td>❌<tr><td>("<code>https</code>", "<code>r.wildlife.museum</code>")<td>("<code>https</code>", "<code>wildlife.museum</code>")<td>❌<td>❌<tr><td>("<code>https</code>", "<code>wildlife.museum</code>")<td>("<code>https</code>", "<code>wildlife.museum</code>")<td>✅<td>✅<tr><td>("<code>https</code>", "<code>example.com</code>")<td>("<code>https</code>", "<code>example.com.</code>")<td>❌<td>❌</table>

   <p>（ここでは<a href="#concept-origin-port" id="sites:concept-origin-port-2">ポート</a>および<a href="#concept-origin-domain" id="sites:concept-origin-domain-2">ドメイン</a>のコンポーネントは考慮されていないため、省略している。）</p>
  </div>


  <h5 id="relaxing-the-same-origin-restriction"><span class="secno">7.1.1.2</span> 同一生成元制限を緩和する<a href="#relaxing-the-same-origin-restriction" class="self-link"></a></h5>

  <dl class="domintro"><dt><code><var>document</var>.<a href="#dom-document-domain" id="dom-document-domain-dev">domain</a> [ = <var>domain</var> ]</code><dd><p>セキュリティチェックのために使用される現在のドメインを返す。</p>

    <p>サブドメインを削除する値に設定し、<a href="#concept-origin" id="relaxing-the-same-origin-restriction:concept-origin">生成元</a>の<a href="#concept-origin-domain" id="relaxing-the-same-origin-restriction:concept-origin-domain">ドメイン</a>を変更し、同じドメインの他のサブドメイン（同じことを行う場合）のページが互いにアクセスできるようにすることができる。これにより、ドメインの異なるホスト上のページが、互いのDOMに同期的にアクセスできるようになる。</p>

    <p>サンドボックス化された<code id="relaxing-the-same-origin-restriction:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>、<a href="#concept-origin-opaque" id="relaxing-the-same-origin-restriction:concept-origin-opaque">不透明な生成元</a>をもつ<code id="relaxing-the-same-origin-restriction:document"><a href="dom.html#document">Document</a></code>、および<a href="document-sequences.html#concept-document-bc" id="relaxing-the-same-origin-restriction:concept-document-bc">ブラウジングコンテキスト</a>のない<code id="relaxing-the-same-origin-restriction:document-2"><a href="dom.html#document">Document</a></code>において、セッターは<a id="relaxing-the-same-origin-restriction:securityerror" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a>例外を投げる。<code id="relaxing-the-same-origin-restriction:dom-crossoriginisolated"><a href="webappapis.html#dom-crossoriginisolated">crossOriginIsolated</a></code>または<code id="relaxing-the-same-origin-restriction:dom-originagentcluster"><a href="#dom-originagentcluster">originAgentCluster</a></code>がtrueを返す場合、セッターは何もしない。</p>
   </dl>

  <div class="critical"><p><code id="relaxing-the-same-origin-restriction:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>セッターの使用を避ける。これは、同一生成元ポリシーが提供するセキュリティ保護を損なうものである。これは共有ホスティングを使用している場合に特に顕著である。たとえば、信頼できないサードパーティが同じIPアドレスだが異なるポートで HTTP サーバーをホストできる場合、<code id="relaxing-the-same-origin-restriction:dom-document-domain-2"><a href="#dom-document-domain">document.domain</a></code>セッターを使用した後に生成元を比較するときにポートが無視されるため、通常は同じホスト上の2つの異なるサイトを保護する同一生成元の保護が失敗する。</p>

   <p>これらのセキュリティ上の落とし穴があるため、この機能はウェブプラットフォームから削除されるプロセスにある。（これは何年もかかる長いプロセスである。）</p>

   <p>代わりに、安全な方法で生成元間で通信するために、<code id="relaxing-the-same-origin-restriction:dom-window-postmessage"><a href="web-messaging.html#dom-window-postmessage">postMessage()</a></code>または<code id="relaxing-the-same-origin-restriction:messagechannel"><a href="web-messaging.html#messagechannel">MessageChannel</a></code>オブジェクトを使用する。</p>
  </div>

  

  <p>The <dfn data-dfn-for="Document" id="dom-document-domain" data-dfn-type="attribute"><code>domain</code></dfn> getter steps are:</p>

  <ol><li><p>Let <var>effectiveDomain</var> be <a id="relaxing-the-same-origin-restriction:this" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="relaxing-the-same-origin-restriction:concept-document-origin" data-x-internal="concept-document-origin">origin</a>'s <a href="#concept-origin-effective-domain" id="relaxing-the-same-origin-restriction:concept-origin-effective-domain">effective domain</a>.<li><p>If <var>effectiveDomain</var> is null, then return the empty string.<li><p>Return <var>effectiveDomain</var>, <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-serializer" id="relaxing-the-same-origin-restriction:host-serializer" data-x-internal="host-serializer">serialized</a>.</ol>

  <p>The <code id="relaxing-the-same-origin-restriction:dom-document-domain-3"><a href="#dom-document-domain">domain</a></code> setter steps are:</p>

  <ol><li><p>If <a id="relaxing-the-same-origin-restriction:this-2" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="document-sequences.html#concept-document-bc" id="relaxing-the-same-origin-restriction:concept-document-bc-2">browsing context</a> is null, then throw a <a id="relaxing-the-same-origin-restriction:securityerror-2" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="relaxing-the-same-origin-restriction:domexception"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If <a id="relaxing-the-same-origin-restriction:this-3" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="#active-sandboxing-flag-set" id="relaxing-the-same-origin-restriction:active-sandboxing-flag-set">active sandboxing flag set</a> has its <a href="#sandboxed-document.domain-browsing-context-flag" id="relaxing-the-same-origin-restriction:sandboxed-document.domain-browsing-context-flag">sandboxed <code>document.domain</code> browsing context flag</a> set, then throw a <a id="relaxing-the-same-origin-restriction:securityerror-3" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="relaxing-the-same-origin-restriction:domexception-2"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>Let <var>effectiveDomain</var> be <a id="relaxing-the-same-origin-restriction:this-4" href="https://triple-underscore.github.io/WebIDL-ja.html#this" data-x-internal="this">this</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="relaxing-the-same-origin-restriction:concept-document-origin-2" data-x-internal="concept-document-origin">origin</a>'s <a href="#concept-origin-effective-domain" id="relaxing-the-same-origin-restriction:concept-origin-effective-domain-2">effective domain</a>.<li><p>If <var>effectiveDomain</var> is null, then throw a <a id="relaxing-the-same-origin-restriction:securityerror-4" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="relaxing-the-same-origin-restriction:domexception-3"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If the given value <a href="#is-a-registrable-domain-suffix-of-or-is-equal-to" id="relaxing-the-same-origin-restriction:is-a-registrable-domain-suffix-of-or-is-equal-to">is not a registrable domain suffix of and is not equal to</a> <var>effectiveDomain</var>, then throw a <a id="relaxing-the-same-origin-restriction:securityerror-5" href="https://triple-underscore.github.io/WebIDL-ja.html#securityerror" data-x-internal="securityerror">"<code>SecurityError</code>"</a> <code id="relaxing-the-same-origin-restriction:domexception-4"><a data-x-internal="domexception" href="https://triple-underscore.github.io/WebIDL-ja.html#dfn-DOMException">DOMException</a></code>.<li><p>If the <a id="relaxing-the-same-origin-restriction:surrounding-agent" href="https://tc39.es/ecma262/#surrounding-agent" data-x-internal="surrounding-agent">surrounding agent</a>'s <a id="relaxing-the-same-origin-restriction:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>'s <a id="relaxing-the-same-origin-restriction:is-origin-keyed" href="webappapis.html#is-origin-keyed">is origin-keyed</a> is true, then return.<li><p>Set <var>this</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="relaxing-the-same-origin-restriction:concept-document-origin-3" data-x-internal="concept-document-origin">origin</a>'s <a href="#concept-origin-domain" id="relaxing-the-same-origin-restriction:concept-origin-domain-2">domain</a> to the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-parser" id="relaxing-the-same-origin-restriction:host-parser" data-x-internal="host-parser">parsing</a> the given value.</ol>

  <p>To determine if a <a id="relaxing-the-same-origin-restriction:scalar-value-string" href="https://triple-underscore.github.io/infra-ja.html#scalar-value-string" data-x-internal="scalar-value-string">scalar value string</a> <var>hostSuffixString</var> <dfn id="is-a-registrable-domain-suffix-of-or-is-equal-to" data-lt="is a registrable domain suffix of or is equal to|is not a registrable domain suffix of
  and is not equal to" data-export="">is a registrable domain suffix of or is equal to</dfn> a <a href="https://triple-underscore.github.io/URL-ja.html#concept-host" id="relaxing-the-same-origin-restriction:concept-host" data-x-internal="concept-host">host</a> <var>originalHost</var>:</p>
  

  <ol><li><p>If <var>hostSuffixString</var> is the empty string, then return false.<li><p>Let <var>hostSuffix</var> be the result of <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-parser" id="relaxing-the-same-origin-restriction:host-parser-2" data-x-internal="host-parser">parsing</a> <var>hostSuffixString</var>.<li><p>If <var>hostSuffix</var> is failure, then return false.<li><p>If <var>hostSuffix</var> does not <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-equals" id="relaxing-the-same-origin-restriction:host-equals" data-x-internal="host-equals">equal</a> <var>originalHost</var>, then:</p>

    <ol><li><p>If <var>hostSuffix</var> or <var>originalHost</var> is not a <a href="https://triple-underscore.github.io/URL-ja.html#concept-domain" id="relaxing-the-same-origin-restriction:concept-domain" data-x-internal="concept-domain">domain</a>, then return false.</p>

      <p class="note">This excludes <a href="https://triple-underscore.github.io/URL-ja.html#concept-host" id="relaxing-the-same-origin-restriction:concept-host-2" data-x-internal="concept-host">hosts</a> that are <a href="https://triple-underscore.github.io/URL-ja.html#ip-address" id="relaxing-the-same-origin-restriction:ip-address" data-x-internal="ip-address">IP addresses</a>.</p>
     <li><p>If <var>hostSuffix</var>, prefixed by U+002E (.), does not match the end of <var>originalHost</var>, then return false.<li><p>If any of the following are true:</p>

      <ul class="brief"><li><p><var>hostSuffix</var> <a href="https://triple-underscore.github.io/URL-ja.html#concept-host-equals" id="relaxing-the-same-origin-restriction:host-equals-2" data-x-internal="host-equals">equals</a> <var>hostSuffix</var>'s <a id="relaxing-the-same-origin-restriction:public-suffix" href="https://triple-underscore.github.io/URL-ja.html#host-public-suffix" data-x-internal="public-suffix">public suffix</a>; or<li><p><var>hostSuffix</var>, prefixed by U+002E (.), matches the end <var>originalHost</var>'s <a id="relaxing-the-same-origin-restriction:public-suffix-2" href="https://triple-underscore.github.io/URL-ja.html#host-public-suffix" data-x-internal="public-suffix">public suffix</a>,</ul>

      <p>then return false. <a href="references.html#refsURL">[URL]</a></p>
     <li><p><a id="relaxing-the-same-origin-restriction:assert" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>originalHost</var>'s <a id="relaxing-the-same-origin-restriction:public-suffix-3" href="https://triple-underscore.github.io/URL-ja.html#host-public-suffix" data-x-internal="public-suffix">public suffix</a>, prefixed by U+002E (.), matches the end of <var>hostSuffix</var>.</ol>
   <li><p>Return true.</ol>

  <div id="example-registrable-domain-suffix" class="example"><table><tr><th><var>hostSuffixString</var><th><var>originalHost</var><th>Outcome of <a href="#is-a-registrable-domain-suffix-of-or-is-equal-to" id="relaxing-the-same-origin-restriction:is-a-registrable-domain-suffix-of-or-is-equal-to-2">is a registrable domain suffix of or is equal to</a><th>注<tr><td>"<code>0.0.0.0</code>"<td><code>0.0.0.0</code><td>✅<td><tr><td>"<code>0x10203</code>"<td><code>0.1.2.3</code><td>✅<td><tr><td>"<code>[0::1]</code>"<td><code>::1</code><td>✅<td><tr><td>"<code>example.com</code>"<td><code>example.com</code><td>✅<td><tr><td>"<code>example.com</code>"<td><code>example.com.</code><td>❌<td rowspan="2">Trailing dot is significant.<tr><td>"<code>example.com.</code>"<td><code>example.com</code><td>❌<tr><td>"<code>example.com</code>"<td><code>www.example.com</code><td>✅<td><tr><td>"<code>com</code>"<td><code>example.com</code><td>❌<td>At the time of writing, <code>com</code> is a public suffix.<tr><td>"<code>example</code>"<td><code>example</code><td>✅<td><tr><td>"<code>compute.amazonaws.com</code>"<td><code>example.compute.amazonaws.com</code><td>❌<td rowspan="3">At the time of writing, <code><var>*</var>.compute.amazonaws.com</code> is a public suffix.<tr><td>"<code>example.compute.amazonaws.com</code>"<td><code>www.example.compute.amazonaws.com</code><td>❌<tr><td>"<code>amazonaws.com</code>"<td><code>www.example.compute.amazonaws.com</code><td>❌<tr><td>"<code>amazonaws.com</code>"<td><code>test.amazonaws.com</code><td>✅<td>At the time of writing, <code>amazonaws.com</code> is a registrable domain.</table>
  </div>

  


  <h4 id="origin-keyed-agent-clusters"><span class="secno">7.1.2</span> <span id="origin-isolation"></span>オリジンキーエージェントクラスター<a href="#origin-keyed-agent-clusters" class="self-link"></a></h4>

  <dl class="domintro"><dt><code>window.<a href="#dom-originagentcluster" id="dom-originagentcluster-dev">originAgentCluster</a></code><dd><p>このセクションで説明されている方法で、この<code id="origin-keyed-agent-clusters:window"><a href="nav-history-apis.html#window">Window</a></code>が<a href="#concept-origin" id="origin-keyed-agent-clusters:concept-origin">オリジン</a><a href="webappapis.html#agent-cluster-key" id="origin-keyed-agent-clusters:agent-cluster-key">キー</a>の<a id="origin-keyed-agent-clusters:agent-cluster" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">エージェントクラスター</a>に属す場合はtrueを返す。</p>
   </dl>

  <p><a id="origin-keyed-agent-clusters:secure-context" href="webappapis.html#secure-context">セキュアなコンテキスト</a>で配信された<code id="origin-keyed-agent-clusters:document"><a href="dom.html#document">Document</a></code>は、`<dfn id="origin-agent-cluster" data-dfn-type="http-header"><code>Origin-Agent-Cluster</code></dfn>` HTTPレスポンスヘッダーを使用して、<a href="#concept-origin" id="origin-keyed-agent-clusters:concept-origin-2">オリジン</a><a href="webappapis.html#agent-cluster-key" id="origin-keyed-agent-clusters:agent-cluster-key-2">キー</a>の<a id="origin-keyed-agent-clusters:agent-cluster-2" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">エージェントクラスター</a>に配置するように要求することができる。このヘッダーは<a href="https://httpwg.org/specs/rfc8941.html" id="origin-keyed-agent-clusters:http-structured-header" data-x-internal="http-structured-header">構造化されたヘッダー</a>であり、その値は<a href="https://httpwg.org/specs/rfc8941.html#boolean" id="origin-keyed-agent-clusters:http-structured-header-boolean" data-x-internal="http-structured-header-boolean">真偽値</a>でなければらない。<a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a></p>

  <p><a href="document-lifecycle.html#initialise-the-document-object" id="origin-keyed-agent-clusters:initialise-the-document-object">新しい<code>Document</code>オブジェクトの作成と初期化</a>の処理モデルによって、<a href="https://httpwg.org/specs/rfc8941.html#boolean" id="origin-keyed-agent-clusters:http-structured-header-boolean-2" data-x-internal="http-structured-header-boolean">構造化されたヘッダー</a>の真偽値ではない値（すなわち、`<code>?1</code>`）は無視される。</p>

  <p>このヘッダーを使用すると、結果として得られる<code id="origin-keyed-agent-clusters:document-2"><a href="dom.html#document">Document</a></code>の<a id="origin-keyed-agent-clusters:agent-cluster-key-3" href="webappapis.html#agent-cluster-key">エージェントクラスタキー</a>は、<a href="#obtain-a-site" id="origin-keyed-agent-clusters:obtain-a-site">対応するサイト</a>ではなく、その<a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="origin-keyed-agent-clusters:concept-document-origin" data-x-internal="concept-document-origin">生成元</a>となる。目に見える効果として、これは<code id="origin-keyed-agent-clusters:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>を使用して<a href="#relaxing-the-same-origin-restriction">同一生成元の制限を緩和</a>しようとしても何も実行されない代わりに、<code id="origin-keyed-agent-clusters:webassembly.module"><a data-x-internal="webassembly.module" href="https://webassembly.github.io/spec/js-api/#module">WebAssembly.Module</a></code>オブジェクトを生成元をまたいだ<code id="origin-keyed-agent-clusters:document-3"><a href="dom.html#document">Document</a></code>に送信することができなくなることである（たとえ<a href="#same-site" id="origin-keyed-agent-clusters:same-site">同じサイト</a>であっても）。水面下で、この分離により、ユーザーエージェントは、プロセスやスレッドなどの<a href="https://tc39.es/ecma262/#sec-agent-clusters" id="origin-keyed-agent-clusters:agent-cluster-3" data-x-internal="agent-cluster">エージェントクラスター</a>に対応する実装固有のリソースをより効率的に割り当てることが可能になる。</p>

  <p><a id="origin-keyed-agent-clusters:browsing-context-group" href="document-sequences.html#browsing-context-group">ブラウジングコンテキストグループ</a>内では、`<code id="origin-keyed-agent-clusters:origin-agent-cluster"><a href="#origin-agent-cluster">Origin-Agent-Cluster</a></code>`ヘッダーは、たとえ一方がヘッダーを送信し、他方が送信しない場合でも、同一生成元の<code id="origin-keyed-agent-clusters:document-4"><a href="dom.html#document">Document</a></code>オブジェクトが異なる<a href="https://tc39.es/ecma262/#sec-agent-clusters" id="origin-keyed-agent-clusters:agent-cluster-4" data-x-internal="agent-cluster">エージェントクラスター</a>で終わる原因にはならないことに注意する。これは、<a id="origin-keyed-agent-clusters:historical-agent-cluster-key-map" href="document-sequences.html#historical-agent-cluster-key-map">履歴エージェントクラスタキーマップ</a>によって防止される。</p>

  <p class="note">つまり、<code id="origin-keyed-agent-clusters:dom-originagentcluster"><a href="#dom-originagentcluster">originAgentCluster</a></code>ゲッターは、同じ<a id="origin-keyed-agent-clusters:browsing-context-group-2" href="document-sequences.html#browsing-context-group">ブラウジングコンテキストグループ</a>内の以前にロードされた同一生成元のページでヘッダーが省略されていた場合、たとえヘッダーが設定されていても、falseを返すことができるということである。同様に、ヘッダーが設定されていなくてもtrueを返すことができる。</p>

  <p>The <dfn data-dfn-for="Window" id="dom-originagentcluster" data-dfn-type="attribute"><code>originAgentCluster</code></dfn> getter steps are to return the <a id="origin-keyed-agent-clusters:surrounding-agent" href="https://tc39.es/ecma262/#surrounding-agent" data-x-internal="surrounding-agent">surrounding agent</a>'s <a id="origin-keyed-agent-clusters:agent-cluster-5" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">agent cluster</a>'s <a id="origin-keyed-agent-clusters:is-origin-keyed" href="webappapis.html#is-origin-keyed">is origin-keyed</a>.</p>

  <p class="note"><a href="#concept-origin-opaque" id="origin-keyed-agent-clusters:concept-origin-opaque">不透明な生成元</a>をもつ<code id="origin-keyed-agent-clusters:document-5"><a href="dom.html#document">Document</a></code>は、無条件に生成元が分離されているとみなすことができる。その場合、ヘッダーは効果がなく、かつ<code id="origin-keyed-agent-clusters:dom-originagentcluster-2"><a href="#dom-originagentcluster">originAgentCluster</a></code>ゲッターは常にtrueを返すだろう。</p>

  <p class="note">同様に、<a id="origin-keyed-agent-clusters:agent-cluster-6" href="https://tc39.es/ecma262/#sec-agent-clusters" data-x-internal="agent-cluster">エージェントクラスター</a>の<a href="webappapis.html#agent-cluster-cross-origin-isolation" id="origin-keyed-agent-clusters:agent-cluster-cross-origin-isolation">クロスオリジン分離モード</a>が"<code id="origin-keyed-agent-clusters:cross-origin-isolation-none"><a href="document-sequences.html#cross-origin-isolation-none">none</a></code>"ではない<code id="origin-keyed-agent-clusters:document-6"><a href="dom.html#document">Document</a></code>は、自動的にオリジンキーが設定される。生成元をまたいだ分離を達成するために使用される`<code id="origin-keyed-agent-clusters:cross-origin-opener-policy-2"><a href="#cross-origin-opener-policy-2">Cross-Origin-Opener-Policy</a></code>`および `<code id="origin-keyed-agent-clusters:cross-origin-embedder-policy"><a href="#cross-origin-embedder-policy">Cross-Origin-Embedder-Policy</a></code>`ヘッダーは、同じアドレス空間内のすべてのものがそこに存在することを保証することを目的としているため、`<code id="origin-keyed-agent-clusters:origin-agent-cluster-2"><a href="#origin-agent-cluster">Origin-Agent-Cluster</a></code>`ヘッダーは、リソースの割り当てに関する実装への追加のヒントとして有用であるかもしれない。しかし、それを追加しても、著者のコードに追加の目に見える影響はない。</p>


  <h4 id="cross-origin-opener-policies"><span class="secno">7.1.3</span> 生成元をまたいだオープナーポリシー<a href="#cross-origin-opener-policies" class="self-link"></a></h4>

  <p><dfn id="cross-origin-opener-policy-value">生成元をまたいだオープナーポリシー値</dfn>は、<a id="cross-origin-opener-policies:top-level-browsing-context" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>にナビゲートされたドキュメントに対し、新しい<a id="cross-origin-opener-policies:top-level-browsing-context-2" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>および、それに対応する<a href="document-sequences.html#tlbc-group" id="cross-origin-opener-policies:tlbc-group">グループ</a>の作成を強制できる。可能な値は次のとおり：</p>

  <dl><dt>"<dfn id="coop-unsafe-none"><code>unsafe-none</code></dfn>"<dd><p>これは（現在の）デフォルトであり、文書が別の<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy">生成元をまたいだオープナーポリシー</a>を指定しない限り、文書がその前の文書と同じ<a id="cross-origin-opener-policies:top-level-browsing-context-3" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を占有することを意味する。<dt>"<dfn id="coop-same-origin-allow-popups"><code>same-origin-allow-popups</code></dfn>"<dd><p>これは、前の文書が同じ<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy-2">生成元をまたいだオープナーポリシー</a>を指定しており、それらが<a href="#same-origin" id="cross-origin-opener-policies:same-origin">同一生成元</a>でない限り、文書の新しい<a id="cross-origin-opener-policies:top-level-browsing-context-4" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>を強制的に作成する。<dt>"<dfn id="coop-same-origin"><code>same-origin</code></dfn>"<dd><p>これは、"<code id="cross-origin-opener-policies:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>"と同じように動作するが、作成される<a id="cross-origin-opener-policies:auxiliary-browsing-context" href="document-sequences.html#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>は、同じ<a href="#cross-origin-opener-policy" id="cross-origin-opener-policies:cross-origin-opener-policy-3">生成元をまたいだオープナーポリシー</a>を持つ<a href="#same-origin" id="cross-origin-opener-policies:same-origin-2">同一生成元</a>の文書を含める必要があることが追加される。さもなければ、オープナーに非公開で表示される。<dt>"<dfn id="coop-same-origin-plus-coep"><code>same-origin-plus-COEP</code></dfn>"<dd><p>これは"<code id="cross-origin-opener-policies:coop-same-origin"><a href="#coop-same-origin">same-origin</a></code>"と同じように動作するが、（新しい）<a id="cross-origin-opener-policies:top-level-browsing-context-5" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>の<a href="document-sequences.html#tlbc-group" id="cross-origin-opener-policies:tlbc-group-2">グループ</a>の<a href="document-sequences.html#bcg-cross-origin-isolation" id="cross-origin-opener-policies:bcg-cross-origin-isolation">生成元をまたいだ分離</a>を"<code id="cross-origin-opener-policies:cross-origin-isolation-logical"><a href="document-sequences.html#cross-origin-isolation-logical">logical</a></code>"または"<code id="cross-origin-opener-policies:cross-origin-isolation-concrete"><a href="document-sequences.html#cross-origin-isolation-concrete">concrete</a></code>"のいずれかに設定することが追加される。</p>

    <p class="note">"<code id="cross-origin-opener-policies:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>"は`<code id="cross-origin-opener-policies:cross-origin-opener-policy-2-2"><a href="#cross-origin-opener-policy-2">Cross-Origin-Opener-Policy</a></code>`ヘッダーで直接設定することはできないが、`<code><a href="#cross-origin-opener-policy-2" id="cross-origin-opener-policies:cross-origin-opener-policy-2-3">Cross-Origin-Opener-Policy</a>: <a href="#coop-same-origin" id="cross-origin-opener-policies:coop-same-origin-2">same-origin</a></code>`と`<code id="cross-origin-opener-policies:cross-origin-embedder-policy"><a href="#cross-origin-embedder-policy">Cross-Origin-Embedder-Policy</a></code>` ヘッダー（値は<a href="#compatible-with-cross-origin-isolation" id="cross-origin-opener-policies:compatible-with-cross-origin-isolation">クロスオリジン分離と互換</a>）を一緒に設定した結果である。<p></dl>

  

  <p><dfn id="cross-origin-opener-policy">生成元をまたいだオープナーポリシー</dfn>は、次のもので構成される：</p>

  <ul><li><p><dfn id="coop-struct-value">値</dfn>。これは<a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value">生成元をまたいだオープナーポリシー値</a>であり、初期は"<code id="cross-origin-opener-policies:coop-unsafe-none"><a href="#coop-unsafe-none">unsafe-none</a></code>"である。<li><p><dfn id="coop-struct-report-endpoint">レポーティングエンドポイント</dfn>。これは文字列またはnullであり、最初はnullである。<li><p><dfn id="coop-struct-report-only-value">レポートのみの値</dfn>。これは<a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-2">クロスオリジンオープナーポリシー値</a>であり、初期は"<code id="cross-origin-opener-policies:coop-unsafe-none-2"><a href="#coop-unsafe-none">unsafe-none</a></code>"である。<li><p><dfn id="coop-struct-report-only-endpoint">レポートのみのレポーティングエンドポイント</dfn>。これは文字列またはnullであり、最初はnullである。</ul>

  <p><dfn id="matching-coop">生成元をまたいだオープナーポリシー値と一致する</dfn>には、<a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-3">生成元をまたいだオープナーポリシー</a><var>A</var>、<a href="#concept-origin" id="cross-origin-opener-policies:concept-origin">生成元</a><var>originA</var>、<a href="#cross-origin-opener-policy-value" id="cross-origin-opener-policies:cross-origin-opener-policy-value-4">生成元をまたいだオープナーポリシー</a><var>B</var>、<a href="#concept-origin" id="cross-origin-opener-policies:concept-origin-2">生成元</a><var>originB</var>を指定した場合に：</p>

  <ol><li><p><var>A</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-3"><a href="#coop-unsafe-none">unsafe-none</a></code>"かつ<var>B</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-4"><a href="#coop-unsafe-none">unsafe-none</a></code>"である場合、trueを返す。<li><p><var>A</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-5"><a href="#coop-unsafe-none">unsafe-none</a></code>"または<var>B</var>が"<code id="cross-origin-opener-policies:coop-unsafe-none-6"><a href="#coop-unsafe-none">unsafe-none</a></code>"である場合、falseを返す。<li><p><var>A</var>が<var>B</var>であり、かつ<var>originA</var>が"<var>originB</var>をもつ<a href="#same-origin" id="cross-origin-opener-policies:same-origin-3">同一生成元</a>である場合、trueを返す。<li><p>falseを返す。</ol>

  


  <h5 id="the-coop-headers"><span class="secno">7.1.3.1</span> ヘッダー<a href="#the-coop-headers" class="self-link"></a></h5><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy" title="The HTTP Cross-Origin-Opener-Policy (COOP) response header allows you to ensure a top-level document does not share a browsing context group with cross-origin documents.">Headers/Cross-Origin-Opener-Policy</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>79+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>83+</span></span><hr><span class="opera no"><span>Opera</span><span>No</span></span><span class="edge_blink yes"><span>Edge</span><span>83+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android no"><span>WebView Android</span><span>No</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android no"><span>Opera Android</span><span>No</span></span></div></div></div>

  <p><code id="the-coop-headers:document"><a href="dom.html#document">Document</a></code>の<a href="dom.html#concept-document-coop" id="the-coop-headers:concept-document-coop">生成元をまたいだオープナーポリシー</a>は `<dfn id="cross-origin-opener-policy-2" data-dfn-type="http-header"><code>Cross-Origin-Opener-Policy</code></dfn>`および`<dfn id="cross-origin-opener-policy-report-only" data-dfn-type="http-header"><code>Cross-Origin-Opener-Policy-Report-Only</code></dfn>` HTTPレスポンスヘッダーから派生する。このヘッダーは<a href="https://httpwg.org/specs/rfc8941.html" id="the-coop-headers:http-structured-header" data-x-internal="http-structured-header">構造化されたヘッダー</a>であり、その値は<a href="https://httpwg.org/specs/rfc8941.html#token" id="the-coop-headers:http-structured-header-token" data-x-internal="http-structured-header-token">トークン</a>でなければならない。<a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a></p>

  <p>妥当な<a href="https://httpwg.org/specs/rfc8941.html#token" id="the-coop-headers:http-structured-header-token-2" data-x-internal="http-structured-header-token">トークン</a>の値は、<a href="#cross-origin-opener-policy-value" id="the-coop-headers:cross-origin-opener-policy-value">オープナーポリシー値</a>である。トークンはまた、付属の<a href="https://httpwg.org/specs/rfc8941.html#param" id="the-coop-headers:http-structured-header-parameters" data-x-internal="http-structured-header-parameters">パラメーター</a>を持ってもよい。これらのうち、"<dfn id="coop-report-to"><code>report-to</code></dfn>"パラメーターは、適切な報告エンドポイントを識別する<a id="the-coop-headers:valid-url-string" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">妥当なURL文字列</a>を持つことができる。<a href="references.html#refsREPORTING">[REPORTING]</a></p>

  <p class="note">以下に説明する処理モデルに従って、ユーザーエージェントは、このヘッダーに不正値が含まれている場合、そのヘッダーを無視する。同様に、値が<a href="https://httpwg.org/specs/rfc8941.html#token" id="the-coop-headers:http-structured-header-token-3" data-x-internal="http-structured-header-token">トークン</a>として解析できない場合、ユーザーエージェントはこのヘッダーを無視する。</p>

  

  <hr>

  <p>To <dfn id="obtain-coop">obtain a cross-origin opener policy</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-coop-headers:concept-response" data-x-internal="concept-response">response</a> <var>response</var> and an <a id="the-coop-headers:environment" href="webappapis.html#environment">environment</a> <var>reservedEnvironment</var>:</p>

  <ol><li><p>Let <var>policy</var> be a new <a href="#cross-origin-opener-policy" id="the-coop-headers:cross-origin-opener-policy">cross-origin opener policy</a>.<li><p>If <var>reservedEnvironment</var> is a <a id="the-coop-headers:non-secure-context" href="webappapis.html#non-secure-context">non-secure context</a>, then return <var>policy</var>.<li><p>Let <var>parsedItem</var> be the result of <a id="the-coop-headers:getting-a-structured-field-value" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> given `<code id="the-coop-headers:cross-origin-opener-policy-2"><a href="#cross-origin-opener-policy-2">Cross-Origin-Opener-Policy</a></code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-coop-headers:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is not null, then:</p>

    <ol><li><p>If <var>parsedItem</var>[0] is "<code id="the-coop-headers:coop-same-origin"><a href="#coop-same-origin">same-origin</a></code>", then:</p>

      <ol><li><p>Let <var>coep</var> be the result of <a href="#obtain-an-embedder-policy" id="the-coop-headers:obtain-an-embedder-policy">obtaining a cross-origin embedder policy</a> from <var>response</var> and <var>reservedEnvironment</var>.<li><p>If <var>coep</var>'s <a href="#embedder-policy-value-2" id="the-coop-headers:embedder-policy-value-2">value</a> is <a href="#compatible-with-cross-origin-isolation" id="the-coop-headers:compatible-with-cross-origin-isolation">compatible with cross-origin isolation</a>, then set <var>policy</var>'s <a href="#coop-struct-value" id="the-coop-headers:coop-struct-value">value</a> to "<code id="the-coop-headers:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>".<li><p>Otherwise, set <var>policy</var>'s <a href="#coop-struct-value" id="the-coop-headers:coop-struct-value-2">value</a> to "<code id="the-coop-headers:coop-same-origin-2"><a href="#coop-same-origin">same-origin</a></code>".</ol>
     <li><p>If <var>parsedItem</var>[0] is "<code id="the-coop-headers:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>", then set <var>policy</var>'s <a href="#coop-struct-value" id="the-coop-headers:coop-struct-value-3">value</a> to "<code id="the-coop-headers:coop-same-origin-allow-popups-2"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-coop-headers:coop-report-to"><a href="#coop-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-coop-headers:map-exists" data-x-internal="map-exists">exists</a> and it is a string, then set <var>policy</var>'s <a href="#coop-struct-report-endpoint" id="the-coop-headers:coop-struct-report-endpoint">reporting endpoint</a> to <var>parsedItem</var>[1]["<code id="the-coop-headers:coop-report-to-2"><a href="#coop-report-to">report-to</a></code>"].</ol>
   <li><p>Set <var>parsedItem</var> to the result of <a id="the-coop-headers:getting-a-structured-field-value-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> given `<code id="the-coop-headers:cross-origin-opener-policy-report-only"><a href="#cross-origin-opener-policy-report-only">Cross-Origin-Opener-Policy-Report-Only</a></code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-coop-headers:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is not null, then:</p>

    <ol><li><p>If <var>parsedItem</var>[0] is "<code id="the-coop-headers:coop-same-origin-3"><a href="#coop-same-origin">same-origin</a></code>", then:</p>

      <ol><li><p>Let <var>coep</var> be the result of <a href="#obtain-an-embedder-policy" id="the-coop-headers:obtain-an-embedder-policy-2">obtaining a cross-origin embedder policy</a> from <var>response</var> and <var>reservedEnvironment</var>.<li><p>If <var>coep</var>'s <a href="#embedder-policy-value-2" id="the-coop-headers:embedder-policy-value-2-2">value</a> is <a href="#compatible-with-cross-origin-isolation" id="the-coop-headers:compatible-with-cross-origin-isolation-2">compatible with cross-origin isolation</a> or <var>coep</var>'s <a href="#embedder-policy-report-only-value" id="the-coop-headers:embedder-policy-report-only-value">report-only value</a> is <a href="#compatible-with-cross-origin-isolation" id="the-coop-headers:compatible-with-cross-origin-isolation-3">compatible with cross-origin isolation</a>, then set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-coop-headers:coop-struct-report-only-value">report-only value</a> to "<code id="the-coop-headers:coop-same-origin-plus-coep-2"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>".</p>

        <p class="note">Report only COOP also considers report-only COEP to assign the special "<code id="the-coop-headers:coop-same-origin-plus-coep-3"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>" value. This allows developers more freedom in the order of deployment of COOP and COEP.</p>
       <li><p>Otherwise, set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-coop-headers:coop-struct-report-only-value-2">report-only value</a> to "<code id="the-coop-headers:coop-same-origin-4"><a href="#coop-same-origin">same-origin</a></code>".</ol>
     <li><p>If <var>parsedItem</var>[0] is "<code id="the-coop-headers:coop-same-origin-allow-popups-3"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>", then set <var>policy</var>'s <a href="#coop-struct-report-only-value" id="the-coop-headers:coop-struct-report-only-value-3">report-only value</a> to "<code id="the-coop-headers:coop-same-origin-allow-popups-4"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>".<li><p>If <var>parsedItem</var>[1]["<code id="the-coop-headers:coop-report-to-3"><a href="#coop-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-coop-headers:map-exists-2" data-x-internal="map-exists">exists</a> and it is a string, then set <var>policy</var>'s <a href="#coop-struct-report-only-endpoint" id="the-coop-headers:coop-struct-report-only-endpoint">report-only reporting endpoint</a> to <var>parsedItem</var>[1]["<code id="the-coop-headers:coop-report-to-4"><a href="#coop-report-to">report-to</a></code>"].</ol>
   <li><p>Return <var>policy</var>.</ol>


  <h5 id="browsing-context-group-switches-due-to-cross-origin-opener-policy"><span class="secno">7.1.3.2</span> Browsing context group switches due to cross-origin opener policy<a href="#browsing-context-group-switches-due-to-cross-origin-opener-policy" class="self-link"></a></h5>

  <p>To <dfn id="check-browsing-context-group-switch-coop-value">check if COOP values require a browsing context group switch</dfn>, given a boolean <var>isInitialAboutBlank</var>, two <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin">origins</a> <var>responseOrigin</var> and <var>activeDocumentNavigationOrigin</var>, and two <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value">cross-origin opener policy values</a> <var>responseCOOPValue</var> and <var>activeDocumentCOOPValue</var>:</p>

  <ol><li><p>If the result of <a href="#matching-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:matching-coop">matching</a> <var>activeDocumentCOOPValue</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOPValue</var>, and <var>responseOrigin</var> is true, return false.<li><p>If all of the following are true:</p>

    <ul class="brief"><li><p><var>isInitialAboutBlank</var>;<li><p><var>activeDocumentCOOPValue</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-2">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-same-origin-allow-popups"><a href="#coop-same-origin-allow-popups">same-origin-allow-popups</a></code>"; and<li><p><var>responseCOOPValue</var> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-unsafe-none"><a href="#coop-unsafe-none">unsafe-none</a></code>",</ul>

    <p>then return false.</p>
   <li><p>Return true.</p>
  </ol>

  <p>To <dfn id="check-bcg-switch-navigation-report-only">check if enforcing report-only COOP would require a browsing context group switch</dfn>, given a boolean <var>isInitialAboutBlank</var>, two <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-2">origins</a> <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, and two <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy">cross-origin opener policies</a> <var>responseCOOP</var> and <var>activeDocumentCOOP</var>:</p>

  <ol><li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value">report-only value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-2">report-only value</a> is false, then return false.</p>

    <p class="note">Matching report-only policies allows a website to specify the same report-only cross-origin opener policy on all its pages and not receive violation reports for navigations between these pages.</p>
   <li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-2">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-3">value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-3">report-only value</a> is true, then return true.<li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-3">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>activeDocumentNavigationOrigin</var>, <var>responseCOOP</var>'s <a href="#coop-struct-report-only-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-report-only-value-4">report-only value</a> and <var>activeDocumentCOOPReportOnly</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-4">value</a> is true, then return true.<li><p>falseを返す。</ol>

  <p>A <dfn id="coop-enforcement-result">cross-origin opener policy enforcement result</dfn> is a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a> with the following <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:struct-item" data-x-internal="struct-item">items</a>:</p>

  <ul><li><p>A boolean <dfn id="coop-enforcement-bcg-switch">needs a browsing context group switch</dfn>, initially false.<li><p>A boolean <dfn id="coop-enforcement-bcg-switch-report-only">would need a browsing context group switch due to report-only</dfn>, initially false.<li><p>A <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <dfn id="coop-enforcement-url">url</dfn>.<li><p>An <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-3">origin</a> <dfn id="coop-enforcement-origin">origin</dfn>.<li><p>A <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-2">cross-origin opener policy</a> <dfn id="coop-enforcement-coop">cross-origin opener policy</dfn>.<li><p>A boolean <dfn id="coop-enforcement-source">current context is navigation source</dfn>, initially false.</ul>

  <p>To <dfn id="coop-enforce">enforce a response's cross-origin opener policy</dfn>, given a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context" href="document-sequences.html#browsing-context">browsing context</a> <var>browsingContext</var>, a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>responseURL</var>, an <a href="#concept-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-origin-4">origin</a> <var>responseOrigin</var>, a <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-3">cross-origin opener policy</a> <var>responseCOOP</var>, a <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result">cross-origin opener policy enforcement result</a> <var>currentCOOPEnforcementResult</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>Let <var>newCOOPEnforcementResult</var> be a new <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result-2">cross-origin opener policy enforcement result</a> with</p>

    <dl class="props"><dt><a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch">needs a browsing context group switch</a><dd><var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-2">needs a browsing context group switch</a><dt><a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only">would need a browsing context group switch due to report-only</a><dd><var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-2">would need a browsing context group switch due to report-only</a><dt><a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url">url</a><dd><var>responseURL</var><dt><a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin">origin</a><dd><var>responseOrigin</var><dt><a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop">cross-origin opener policy</a><dd><var>responseCOOP</var><dt><a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source">current context is navigation source</a><dd>true</dl>
   <li><p>Let <var>isInitialAboutBlank</var> be <var>browsingContext</var>'s <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:active-document" href="document-sequences.html#active-document">active document</a>'s <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:is-initial-about:blank" href="dom.html#is-initial-about:blank">is initial <code>about:blank</code></a>.<li><p>If <var>isInitialAboutBlank</var> is true and <var>browsingContext</var>'s <a href="document-sequences.html#browsing-context-initial-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-initial-url">initial URL</a> is null, set <var>browsingContext</var>'s <a href="document-sequences.html#browsing-context-initial-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-initial-url-2">initial URL</a> to <var>responseURL</var>.<li><p>If the result of <a href="#check-browsing-context-group-switch-coop-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-browsing-context-group-switch-coop-value-4">checking if COOP values require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-2">cross-origin opener policy</a>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-5">value</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-2">origin</a>, <var>responseCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-6">value</a>, and <var>responseOrigin</var> is true, then:</p>

    <ol><li><p>Set <var>newCOOPEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-3">needs a browsing context group switch</a> to true.<li><p>If <var>browsingContext</var>'s <a href="document-sequences.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group">group</a>'s <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-set" href="document-sequences.html#browsing-context-set">browsing context set</a>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-size" data-x-internal="list-size">size</a> is greater than 1, then:</p>

      <ol><li><p><a href="#coop-violation-navigation-to" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-to">Queue a violation report for browsing context group switch when navigating to a COOP response</a> with <var>responseCOOP</var>, "<code>enforce</code>", <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-2">url</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-3">origin</a>, <var>responseOrigin</var>, and <var>referrer</var>.<li><p><a href="#coop-violation-navigation-from" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-from">Queue a violation report for browsing context group switch when navigating away from a COOP response</a> with <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-3">cross-origin opener policy</a>, "<code>enforce</code>", <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-3">url</a>, <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-4">origin</a>, <var>responseOrigin</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source-2">current context is navigation source</a>.</ol>
     </ol>
   <li><p>If the result of <a href="#check-bcg-switch-navigation-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:check-bcg-switch-navigation-report-only">checking if enforcing report-only COOP would require a browsing context group switch</a> given <var>isInitialAboutBlank</var>, <var>responseOrigin</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-5">origin</a>, <var>responseCOOP</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-4">cross-origin opener policy</a>, is true, then:</p>

    <ol><li><p>Set <var>result</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-3">would need a browsing context group switch due to report-only</a> to true.<li><p>If <var>browsingContext</var>'s <a href="document-sequences.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group-2">group</a>'s <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-set-2" href="document-sequences.html#browsing-context-set">browsing context set</a>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-size-2" data-x-internal="list-size">size</a> is greater than 1, then:</p>

      <ol><li><p><a href="#coop-violation-navigation-to" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-to-2">Queue a violation report for browsing context group switch when navigating to a COOP response</a> with <var>responseCOOP</var>, "<code>reporting</code>", <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-4">url</a>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-6">origin</a>, <var>responseOrigin</var>, and <var>referrer</var>.<li><p><a href="#coop-violation-navigation-from" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-violation-navigation-from-2">Queue a violation report for browsing context group switch when navigating away from a COOP response</a> with <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-coop" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-coop-5">cross-origin opener policy</a>, "<code>reporting</code>", <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-url" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-url-5">url</a>, <var>responseURL</var>, <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-origin" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-origin-7">origin</a>, <var>responseOrigin</var>, and <var>currentCOOPEnforcementResult</var>'s <a href="#coop-enforcement-source" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-source-3">current context is navigation source</a>.</ol>
     </ol>
   <li><p>Return <var>newCOOPEnforcementResult</var>.</ol>

  <p>To <dfn id="obtain-browsing-context-navigation">obtain a browsing context to use for a navigation response</dfn>, given a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:browsing-context-2" href="document-sequences.html#browsing-context">browsing context</a> <var>browsingContext</var>, a <a href="#sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:sandboxing-flag-set">sandboxing flag set</a> <var>sandboxFlags</var>, a <a href="#cross-origin-opener-policy" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-opener-policy-4">cross-origin opener policy</a> <var>navigationCOOP</var>, and a <a href="#coop-enforcement-result" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-result-3">cross-origin opener policy enforcement result</a> <var>coopEnforcementResult</var>:</p>

  <ol><li><p>If <var>browsingContext</var> is not a <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:top-level-browsing-context" href="document-sequences.html#top-level-browsing-context">top-level browsing context</a>, then return <var>browsingContext</var>.<li><p>If <var>coopEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-4">needs a browsing context group switch</a> is false, then:</p>

    <ol><li><p>If <var>coopEnforcementResult</var>'s <a href="#coop-enforcement-bcg-switch-report-only" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-enforcement-bcg-switch-report-only-4">would need a browsing context group switch due to report-only</a> is true, set <var>browsing context</var>'s <a href="document-sequences.html#virtual-browsing-context-group-id" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:virtual-browsing-context-group-id">virtual browsing context group ID</a> to a new unique identifier.<li><p>Return <var>browsingContext</var>.</ol>
   <li><p>Let <var>newBrowsingContext</var> be the first return value of <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:creating-a-new-top-level-browsing-context" href="document-sequences.html#creating-a-new-top-level-browsing-context">creating a new top-level browsing context and document</a>.</p>

    <p class="note">In this case we are going to perform a browsing context group swap. <var>browsingContext</var> will not be used by the new <code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:document"><a href="dom.html#document">Document</a></code> that we are about to <a href="document-lifecycle.html#initialise-the-document-object" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:initialise-the-document-object">create</a>. If it is not used by other <code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:document-2"><a href="dom.html#document">Document</a></code>s either (such as ones in the back/forward cache), then the user agent might <a href="document-sequences.html#a-browsing-context-is-discarded">destroy it</a> at this point.</p>
   <li><p>If <var>navigationCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-7">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-same-origin-plus-coep"><a href="#coop-same-origin-plus-coep">same-origin-plus-COEP</a></code>", then set <var>newBrowsingContext</var>'s <a href="document-sequences.html#tlbc-group" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:tlbc-group-3">group</a>'s <a href="document-sequences.html#bcg-cross-origin-isolation" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:bcg-cross-origin-isolation">cross-origin isolation mode</a> to either "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-isolation-logical"><a href="document-sequences.html#cross-origin-isolation-logical">logical</a></code>" or "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-isolation-concrete"><a href="document-sequences.html#cross-origin-isolation-concrete">concrete</a></code>". The choice of which is <a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:implementation-defined" href="https://triple-underscore.github.io/infra-ja.html#implementation-defined" data-x-internal="implementation-defined">implementation-defined</a>.</p>

    <p class="note">It is difficult on some platforms to provide the security properties required by the <a href="webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:concept-settings-object-cross-origin-isolated-capability">cross-origin isolated capability</a>. "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-isolation-concrete-2"><a href="document-sequences.html#cross-origin-isolation-concrete">concrete</a></code>" grants access to it and "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:cross-origin-isolation-logical-2"><a href="document-sequences.html#cross-origin-isolation-logical">logical</a></code>" does not.</p>
   <li><p>If <var>sandboxFlags</var> is not empty, then:</p>
    <ol><li><p>Assert <var>navigationCOOP</var>'s <a href="#coop-struct-value" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-struct-value-8">value</a> is "<code id="browsing-context-group-switches-due-to-cross-origin-opener-policy:coop-unsafe-none-2"><a href="#coop-unsafe-none">unsafe-none</a></code>".<li><p><a id="browsing-context-group-switches-due-to-cross-origin-opener-policy:assert" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>newBrowsingContext</var>'s <a href="#popup-sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:popup-sandboxing-flag-set">popup sandboxing flag set</a> <a href="https://triple-underscore.github.io/infra-ja.html#list-empty" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-is-empty" data-x-internal="list-is-empty">is empty</a>.<li><p>Set <var>newBrowsingContext</var>'s <a href="#popup-sandboxing-flag-set" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:popup-sandboxing-flag-set-2">popup sandboxing flag set</a> to a <a href="https://triple-underscore.github.io/infra-ja.html#list-clone" id="browsing-context-group-switches-due-to-cross-origin-opener-policy:list-clone" data-x-internal="list-clone">clone</a> of <var>sandboxFlags</var>.</ol>
   <li><p>Return <var>newBrowsingContext</var>.</ol>


  <h5 id="coop-reporting"><span class="secno">7.1.3.3</span> <span id="reporting"></span>Reporting<a href="#coop-reporting" class="self-link"></a></h5>

  <p>An <dfn id="accessor-accessed-relationship">accessor-accessed relationship</dfn> is an enum that describes the relationship between two <a href="document-sequences.html#browsing-context" id="coop-reporting:browsing-context">browsing contexts</a> between which an access happened. It can take the following values:</p>

  <dl><dt><dfn id="accessor-accessed-opener">accessor is opener</dfn><dd><p>The accessor <a id="coop-reporting:browsing-context-2" href="document-sequences.html#browsing-context">browsing context</a> or one of its <a href="document-sequences.html#ancestor-browsing-context" id="coop-reporting:ancestor-browsing-context">ancestors</a> is the <a id="coop-reporting:opener-browsing-context" href="document-sequences.html#opener-browsing-context">opener browsing context</a> of the accessed <a id="coop-reporting:browsing-context-3" href="document-sequences.html#browsing-context">browsing context</a>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc">top-level browsing context</a>.<dt><dfn id="accessor-accessed-openee">accessor is openee</dfn><dd><p>The accessed <a id="coop-reporting:browsing-context-4" href="document-sequences.html#browsing-context">browsing context</a> or one of its <a href="document-sequences.html#ancestor-browsing-context" id="coop-reporting:ancestor-browsing-context-2">ancestors</a> is the <a id="coop-reporting:opener-browsing-context-2" href="document-sequences.html#opener-browsing-context">opener browsing context</a> of the accessor <a id="coop-reporting:browsing-context-5" href="document-sequences.html#browsing-context">browsing context</a>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-2">top-level browsing context</a>.<dt><dfn id="accessor-accessed-none">none</dfn><dd><p>There is no opener relationship between the accessor <a id="coop-reporting:browsing-context-6" href="document-sequences.html#browsing-context">browsing context</a>, the accessor <a id="coop-reporting:browsing-context-7" href="document-sequences.html#browsing-context">browsing context</a>, or any of their <a href="document-sequences.html#ancestor-browsing-context" id="coop-reporting:ancestor-browsing-context-3">ancestors</a>.</dl>

  <p>To <dfn id="coop-check-access-report">check if an access between two browsing contexts should be reported</dfn>, given two <a href="document-sequences.html#browsing-context" id="coop-reporting:browsing-context-8">browsing contexts</a> <var>accessor</var> and <var>accessed</var>, a JavaScript property name <var>P</var>, and an <a id="coop-reporting:environment-settings-object" href="webappapis.html#environment-settings-object">environment settings object</a> <var>environment</var>:</p>

  <ol><li><p>If <var>P</var> is not a <a id="coop-reporting:cross-origin-accessible-window-property-name" href="nav-history-apis.html#cross-origin-accessible-window-property-name">cross-origin accessible window property name</a>, then return.<li><p><a id="coop-reporting:assert" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>accessor</var>'s <a id="coop-reporting:active-document" href="document-sequences.html#active-document">active document</a> and <var>accessed</var>'s <a id="coop-reporting:active-document-2" href="document-sequences.html#active-document">active document</a> are both <a id="coop-reporting:fully-active" href="document-sequences.html#fully-active">fully active</a>.<li><p>Let <var>accessorTopDocument</var> be <var>accessor</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-3">top-level browsing context</a>'s <a id="coop-reporting:active-document-3" href="document-sequences.html#active-document">active document</a>.<li><p>Let <var>accessorInclusiveAncestorOrigins</var> be the list obtained by taking the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin" data-x-internal="concept-document-origin">origin</a> of the <a href="document-sequences.html#nav-document" id="coop-reporting:nav-document">active document</a> of each of <var>accessor</var>'s <a id="coop-reporting:active-document-4" href="document-sequences.html#active-document">active document</a>'s <a id="coop-reporting:inclusive-ancestor-navigables" href="document-sequences.html#inclusive-ancestor-navigables">inclusive ancestor navigables</a>.<li><p>Let <var>accessedTopDocument</var> be <var>accessed</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-4">top-level browsing context</a>'s <a id="coop-reporting:active-document-5" href="document-sequences.html#active-document">active document</a>.<li><p>Let <var>accessedInclusiveAncestorOrigins</var> be the list obtained by taking the <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin-2" data-x-internal="concept-document-origin">origin</a> of the <a href="document-sequences.html#nav-document" id="coop-reporting:nav-document-2">active document</a> of each of <var>accessed</var>'s <a id="coop-reporting:active-document-6" href="document-sequences.html#active-document">active document</a>'s <a id="coop-reporting:inclusive-ancestor-navigables-2" href="document-sequences.html#inclusive-ancestor-navigables">inclusive ancestor navigables</a>.<li><p>If any of <var>accessorInclusiveAncestorOrigins</var> are not <a href="#same-origin" id="coop-reporting:same-origin">same origin</a> with <var>accessorTopDocument</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin-3" data-x-internal="concept-document-origin">origin</a>, or if any of <var>accessedInclusiveAncestorOrigins</var> are not <a href="#same-origin" id="coop-reporting:same-origin-2">same origin</a> with <var>accessedTopDocument</var>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin-4" data-x-internal="concept-document-origin">origin</a>, then return.</p>

    <p class="note">This avoids leaking information about cross-origin iframes to a top level frame with cross-origin opener policy reporting.</p>
   <li><p>If <var>accessor</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-5">top-level browsing context</a>'s <a href="document-sequences.html#virtual-browsing-context-group-id" id="coop-reporting:virtual-browsing-context-group-id">virtual browsing context group ID</a> is <var>accessed</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-6">top-level browsing context</a>'s <a href="document-sequences.html#virtual-browsing-context-group-id" id="coop-reporting:virtual-browsing-context-group-id-2">virtual browsing context group ID</a>, then return.<li><p>Let <var>accessorAccessedRelationship</var> be a new <a href="#accessor-accessed-relationship" id="coop-reporting:accessor-accessed-relationship">accessor-accessed relationship</a> with value <a href="#accessor-accessed-none" id="coop-reporting:accessor-accessed-none">none</a>.<li><p>If <var>accessed</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-7">top-level browsing context</a>'s <a id="coop-reporting:opener-browsing-context-3" href="document-sequences.html#opener-browsing-context">opener browsing context</a> is <var>accessor</var> or is an <a href="document-sequences.html#ancestor-browsing-context" id="coop-reporting:ancestor-browsing-context-4">ancestor</a> of <var>accessor</var>, then set <var>accessorAccessedRelationship</var> to <a href="#accessor-accessed-opener" id="coop-reporting:accessor-accessed-opener">accessor is opener</a>.<li><p>If <var>accessor</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-8">top-level browsing context</a>'s <a id="coop-reporting:opener-browsing-context-4" href="document-sequences.html#opener-browsing-context">opener browsing context</a> is <var>accessed</var> or is an <a href="document-sequences.html#ancestor-browsing-context" id="coop-reporting:ancestor-browsing-context-5">ancestor</a> of <var>accessed</var>, then set <var>accessorAccessedRelationship</var> to <a href="#accessor-accessed-openee" id="coop-reporting:accessor-accessed-openee">accessor is openee</a>.<li><p><a href="#coop-violation-access" id="coop-reporting:coop-violation-access">Queue violation reports for accesses</a>, given <var>accessorAccessedRelationship</var>, <var>accessorTopDocument</var>'s <a href="dom.html#concept-document-coop" id="coop-reporting:concept-document-coop">cross-origin opener policy</a>, <var>accessedTopDocument</var>'s <a href="dom.html#concept-document-coop" id="coop-reporting:concept-document-coop-2">cross-origin opener policy</a>, <var>accessor</var>'s <a id="coop-reporting:active-document-7" href="document-sequences.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="coop-reporting:the-document's-address" data-x-internal="the-document's-address">URL</a>, <var>accessed</var>'s <a id="coop-reporting:active-document-8" href="document-sequences.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-url" id="coop-reporting:the-document's-address-2" data-x-internal="the-document's-address">URL</a>, <var>accessor</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-9">top-level browsing context</a>'s <a href="document-sequences.html#browsing-context-initial-url" id="coop-reporting:browsing-context-initial-url">initial URL</a>, <var>accessed</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-10">top-level browsing context</a>'s <a href="document-sequences.html#browsing-context-initial-url" id="coop-reporting:browsing-context-initial-url-2">initial URL</a>, <var>accessor</var>'s <a id="coop-reporting:active-document-9" href="document-sequences.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin-5" data-x-internal="concept-document-origin">origin</a>, <var>accessed</var>'s <a id="coop-reporting:active-document-10" href="document-sequences.html#active-document">active document</a>'s <a href="https://triple-underscore.github.io/DOM4-ja.html#concept-document-origin" id="coop-reporting:concept-document-origin-6" data-x-internal="concept-document-origin">origin</a>, <var>accessor</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-11">top-level browsing context</a>'s <a href="document-sequences.html#opener-origin-at-creation" id="coop-reporting:opener-origin-at-creation">opener origin at creation</a>, <var>accessed</var>'s <a href="document-sequences.html#bc-tlbc" id="coop-reporting:bc-tlbc-12">top-level browsing context</a>'s <a href="document-sequences.html#opener-origin-at-creation" id="coop-reporting:opener-origin-at-creation-2">opener origin at creation</a>, <var>accessorTopDocument</var>'s <a href="dom.html#dom-document-referrer" id="coop-reporting:dom-document-referrer">referrer</a>, <var>accessedTopDocument</var>'s <a href="dom.html#dom-document-referrer" id="coop-reporting:dom-document-referrer-2">referrer</a>, <var>P</var>, and <var>environment</var>.</ol>

  <p>To <dfn id="sanitize-url-report">sanitize a URL to send in a report</dfn> given a <a id="coop-reporting:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>url</var>:</p>

  <ol><li><p>Let <var>sanitizedURL</var> be a copy of <var>url</var>.<li><p><a href="https://triple-underscore.github.io/URL-ja.html#set-the-username" id="coop-reporting:set-the-username" data-x-internal="set-the-username">Set the username</a> given <var>sanitizedURL</var> and the empty string.<li><p><a href="https://triple-underscore.github.io/URL-ja.html#set-the-password" id="coop-reporting:set-the-password" data-x-internal="set-the-password">Set the password</a> given <var>sanitizedURL</var> and the empty string.<li><p>Return the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="coop-reporting:concept-url-serializer" data-x-internal="concept-url-serializer">serialization</a> of <var>sanitizedURL</var> with <a href="https://triple-underscore.github.io/URL-ja.html#url-serializer-exclude-fragment" id="coop-reporting:url-serializer-exclude-fragment" data-x-internal="url-serializer-exclude-fragment"><i>exclude fragment</i></a> set to true.</ol>

  <p>To <dfn id="coop-violation-navigation-to">queue a violation report for browsing context group switch when navigating to a COOP response</dfn> given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy">cross-origin opener policy</a> <var>coop</var>, a string <var>disposition</var>, a <a id="coop-reporting:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>coopURL</var>, a <a id="coop-reporting:url-3" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>previousResponseURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin">origins</a> <var>coopOrigin</var> and <var>previousResponseOrigin</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="coop-reporting:concept-request-referrer" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="coop-reporting:coop-struct-value">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value">report-only value</a>.<li><p>Let <var>serializedReferrer</var> be an empty string.<li><p>If <var>referrer</var> is a <a id="coop-reporting:url-4" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="coop-reporting:concept-url-serializer-2" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td><var>disposition</var><tr><td>effectivePolicy<td><var>coopValue</var><tr><td>previousResponseURL<td>If <var>coopOrigin</var> and <var>previousResponseOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-3">same origin</a> this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report">sanitization</a> of <var>previousResponseURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>type<td>"<code>navigation-to-response</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-2">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-navigation-from">queue a violation report for browsing context group switch when navigating away from a COOP response</dfn> given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-2">cross-origin opener policy</a> <var>coop</var>, a string <var>disposition</var>, a <a id="coop-reporting:url-5" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>coopURL</var>, a <a id="coop-reporting:url-6" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>nextResponseURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin-2">origins</a> <var>coopOrigin</var> and <var>nextResponseOrigin</var>, and a boolean <var>isCOOPResponseNavigationSource</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-3">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="coop-reporting:coop-struct-value-2">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-2">report-only value</a>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td><var>disposition</var><tr><td>effectivePolicy<td><var>coopValue</var><tr><td>nextResponseURL<td>If <var>coopOrigin</var> and <var>nextResponseOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-4">same origin</a> or <var>isCOOPResponseNavigationSource</var> is true, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-2">sanitization</a> of <var>previousResponseURL</var>, null otherwise.<tr><td>type<td>"<code>navigation-from-response</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-2" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-4">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-access">queue violation reports for accesses</dfn>, given an <a href="#accessor-accessed-relationship" id="coop-reporting:accessor-accessed-relationship-2">accessor-accessed relationship</a> <var>accessorAccessedRelationship</var>, two <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-3">cross-origin opener policies</a> <var>accessorCOOP</var> and <var>accessedCOOP</var>, four <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-7" data-x-internal="url">URLs</a> <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorInitialURL</var>, <var>accessedInitialURL</var>, four <a href="#concept-origin" id="coop-reporting:concept-origin-3">origins</a> <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>accessorCreatorOrigin</var> and <var>accessedCreatorOrigin</var>, two <a href="dom.html#dom-document-referrer" id="coop-reporting:dom-document-referrer-3">referrers</a> <var>accessorReferrer</var> and <var>accessedReferrer</var>, a string <var>propertyName</var>, and an <a id="coop-reporting:environment-settings-object-2" href="webappapis.html#environment-settings-object">environment settings object</a> <var>environment</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-5">reporting endpoint</a> is null, return.<li><p>Let <var>coopValue</var> be <var>coop</var>'s <a href="#coop-struct-value" id="coop-reporting:coop-struct-value-3">value</a>.<li><p>If <var>disposition</var> is "<code>reporting</code>", then set <var>coopValue</var> to <var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-3">report-only value</a>.<li><p>If <var>accessorAccessedRelationship</var> is <a href="#accessor-accessed-opener" id="coop-reporting:accessor-accessed-opener-2">accessor is opener</a>:</p>

    <ol><li><p><a href="#coop-violation-access-to-opened" id="coop-reporting:coop-violation-access-to-opened">Queue a violation report for access to an opened window</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessedInitialURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>accessedCreatorOrigin</var>, <var>propertyName</var>, and <var>environment</var>.<li><p><a href="#coop-violation-access-from-opener" id="coop-reporting:coop-violation-access-from-opener">Queue a violation report for access from the opener</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, <var>propertyName</var>, and <var>accessedReferrer</var>.</ol>
   <li><p>Otherwise, if <var>accessorAccessedRelationship</var> is <a href="#accessor-accessed-openee" id="coop-reporting:accessor-accessed-openee-2">accessor is openee</a>:</p>

    <ol><li><p><a href="#coop-violation-access-to-opener" id="coop-reporting:coop-violation-access-to-opener">Queue a violation report for access to the opener</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>propertyName</var>, <var>accessorReferrer</var>, and <var>environment</var>.<li><p><a href="#coop-violation-access-from-opened" id="coop-reporting:coop-violation-access-from-opened">Queue a violation report for access from an opened window</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessorInitialURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, <var>accessorCreatorOrigin</var>, and <var>propertyName</var>.</ol>
   <li><p>Otherwise:</p>

    <ol><li><p><a href="#coop-violation-access-to-opened" id="coop-reporting:coop-violation-access-to-opened-2">Queue a violation report for access to another window</a>, given <var>accessorCOOP</var>, <var>accessorURL</var>, <var>accessedURL</var>, <var>accessorOrigin</var>, <var>accessedOrigin</var>, <var>propertyName</var>, and <var>environment</var><li><p><a href="#coop-violation-access-from-other" id="coop-reporting:coop-violation-access-from-other">Queue a violation report for access from another window</a>, given <var>accessedCOOP</var>, <var>accessedURL</var>, <var>accessorURL</var>, <var>accessedOrigin</var>, <var>accessorOrigin</var>, and <var>propertyName</var>.</ol>
   </ol>

  <p>To <dfn id="coop-violation-access-to-opener">queue a violation report for access to the opener</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-4">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-8" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>openerURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin-4">origins</a> <var>coopOrigin</var> and <var>openerOrigin</var>, a string <var>propertyName</var>, a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="coop-reporting:concept-request-referrer-2" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>, and an <a id="coop-reporting:environment-settings-object-3" href="webappapis.html#environment-settings-object">environment settings object</a> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>serializedReferrer</var> be an empty string.<li><p>If <var>referrer</var> is a <a id="coop-reporting:url-9" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="coop-reporting:concept-url-serializer-3" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-4">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openerURL<td>If <var>coopOrigin</var> and <var>openerOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-5">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-3">sanitization</a> of <var>openerURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-3" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-6">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>

  <p>To <dfn id="coop-violation-access-to-opened">queue a violation report for access to an opened window</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-5">cross-origin opener policy</a> <var>coop</var>, three <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-10" data-x-internal="url">URLs</a> <var>coopURL</var>, <var>openedWindowURL</var> and <var>initialWindowURL</var>, three <a href="#concept-origin" id="coop-reporting:concept-origin-5">origins</a> <var>coopOrigin</var>, <var>openedWindowOrigin</var>, and <var>openerInitialOrigin</var>, a string <var>propertyName</var>, and an <a id="coop-reporting:environment-settings-object-4" href="webappapis.html#environment-settings-object">environment settings object</a> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-5">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openedWindowURL<td>If <var>coopOrigin</var> and <var>openedWindowOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-6">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-4">sanitization</a> of <var>openedWindowURL</var>, null otherwise.<tr><td>openedWindowInitialURL<td>If <var>coopOrigin</var> and <var>openerInitialOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-7">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-5">sanitization</a> of <var>initialWindowURL</var>, null otherwise.<tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-4" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-7">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>


  <p>To <dfn id="coop-violation-access-to-other">queue a violation report for access to another window</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-6">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-11" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>otherURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin-6">origins</a> <var>coopOrigin</var> and <var>otherOrigin</var>, a string <var>propertyName</var>, and an <a id="coop-reporting:environment-settings-object-5" href="webappapis.html#environment-settings-object">environment settings object</a> <var>environment</var>:</p>

  <ol><li><p>Let <var>sourceFile</var>, <var>lineNumber</var> and <var>columnNumber</var> be the relevant script URL and problematic position which triggered this report.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-6">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>otherURL<td>If <var>coopOrigin</var> and <var>otherOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-8">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-6">sanitization</a> of <var>otherURL</var>, null otherwise.<tr><td>sourceFile<td><var>sourceFile</var><tr><td>lineNumber<td><var>lineNumber</var><tr><td>columnNumber<td><var>columnNumber</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-5" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-8">reporting endpoint</a> with <var>coopURL</var> and <var>environment</var>.</ol>

  <p>To <dfn id="coop-violation-access-from-opener">queue a violation report for access from the opener</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-7">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-12" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>openerURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin-7">origins</a> <var>coopOrigin</var> and <var>openerOrigin</var>, a string <var>propertyName</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-request-referrer" id="coop-reporting:concept-request-referrer-3" data-x-internal="concept-request-referrer">referrer</a> <var>referrer</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-9">reporting endpoint</a> is null, return.<li><p>Let <var>serializedReferrer</var> be an empty string.<li><p>If <var>referrer</var> is a <a id="coop-reporting:url-13" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a>, set <var>serializedReferrer</var> to the <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-serializer" id="coop-reporting:concept-url-serializer-4" data-x-internal="concept-url-serializer">serialization</a> of <var>referrer</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-7">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>openerURL<td>If <var>coopOrigin</var> and <var>openerOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-9">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-7">sanitization</a> of <var>openerURL</var>, null otherwise.<tr><td>referrer<td><var>serializedReferrer</var><tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-6" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-10">reporting endpoint</a> with <var>coopURL</var>.</ol>

  <p>To <dfn id="coop-violation-access-from-opened">queue a violation report for access from an opened window</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-8">cross-origin opener policy</a> <var>coop</var>, three <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-14" data-x-internal="url">URLs</a> <var>coopURL</var>, <var>openedWindowURL</var> and <var>initialWindowURL</var>, three <a href="#concept-origin" id="coop-reporting:concept-origin-8">origins</a> <var>coopOrigin</var>, <var>openedWindowOrigin</var>, and <var>openerInitialOrigin</var>, and a string <var>propertyName</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-11">reporting endpoint</a> is null, return.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coopValue</var><tr><td>property<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-8">report-only value</a><tr><td>openedWindowURL<td>If <var>coopOrigin</var> and <var>openedWindowOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-10">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-8">sanitization</a> of <var>openedWindowURL</var>, null otherwise.<tr><td>openedWindowInitialURL<td>If <var>coopOrigin</var> and <var>openerInitialOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-11">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-9">sanitization</a> of <var>initialWindowURL</var>, null otherwise.<tr><td>type<td>"<code>access-to-opener</code>"</table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-7" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-12">reporting endpoint</a> with <var>coopURL</var>.</ol>


  <p>To <dfn id="coop-violation-access-from-other">queue a violation report for access from another window</dfn>, given a <a href="#cross-origin-opener-policy" id="coop-reporting:cross-origin-opener-policy-9">cross-origin opener policy</a> <var>coop</var>, two <a href="https://triple-underscore.github.io/URL-ja.html#concept-url" id="coop-reporting:url-15" data-x-internal="url">URLs</a> <var>coopURL</var> and <var>otherURL</var>, two <a href="#concept-origin" id="coop-reporting:concept-origin-9">origins</a> <var>coopOrigin</var> and <var>otherOrigin</var>, and a string <var>propertyName</var>:</p>

  <ol><li><p>If <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-13">reporting endpoint</a> is null, return.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>disposition<td>"<code>reporting</code>"<tr><td>effectivePolicy<td><var>coop</var>'s <a href="#coop-struct-report-only-value" id="coop-reporting:coop-struct-report-only-value-9">report-only value</a><tr><td>property<td><var>propertyName</var><tr><td>otherURL<td>If <var>coopOrigin</var> and <var>otherOrigin</var> are <a href="#same-origin" id="coop-reporting:same-origin-12">same origin</a>, this is the <a href="#sanitize-url-report" id="coop-reporting:sanitize-url-report-10">sanitization</a> of <var>otherURL</var>, null otherwise.<tr><td>type<td><code>access-to-opener</code></table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="coop-reporting:queue-a-report-8" data-x-internal="queue-a-report">Queue</a> <var>body</var> as "<code>coop</code>" for <var>coop</var>'s <a href="#coop-struct-report-endpoint" id="coop-reporting:coop-struct-report-endpoint-14">reporting endpoint</a> with <var>coopURL</var>.</ol>

  


  <h4 id="coep"><span class="secno">7.1.4</span> 生成元をまたいだ埋め込みポリシー<a href="#coep" class="self-link"></a></h4><div class="mdn-anno wrapped"><button onclick="toggleStatus(this)" class="mdn-anno-btn"><b title="Support in all current engines." class="all-engines-flag">✔</b><span>MDN</span></button><div class="feature"><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Embedder-Policy" title="The HTTP Cross-Origin-Embedder-Policy (COEP) response header configures embedding cross-origin resources into the document.">Headers/Cross-Origin-Embedder-Policy</a><p class="all-engines-text">Support in all current engines.<div class="support"><span class="firefox yes"><span>Firefox</span><span>79+</span></span><span class="safari yes"><span>Safari</span><span>15.2+</span></span><span class="chrome yes"><span>Chrome</span><span>83+</span></span><hr><span class="opera unknown"><span>Opera</span><span>?</span></span><span class="edge_blink yes"><span>Edge</span><span>83+</span></span><hr><span class="edge unknown"><span>Edge (Legacy)</span><span>?</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android unknown"><span>Firefox Android</span><span>?</span></span><span class="safari_ios unknown"><span>Safari iOS</span><span>?</span></span><span class="chrome_android unknown"><span>Chrome Android</span><span>?</span></span><span class="webview_android yes"><span>WebView Android</span><span>86+</span></span><span class="samsunginternet_android unknown"><span>Samsung Internet</span><span>?</span></span><span class="opera_android unknown"><span>Opera Android</span><span>?</span></span></div></div></div>

  <p><dfn id="embedder-policy-value" data-export="">埋め込みポリシー値</dfn>は、リソース所有者からの明示的な許可なしに、生成元をまたいだリソースのフェッチを制御する3つの文字列の1つである。</p>

  <dl><dt>"<dfn data-dfn-for="embedder policy value" id="coep-unsafe-none" data-export=""><code>unsafe-none</code></dfn>"<dd><p>これはデフォルトの値である。この値を使用するとき、<a id="coep:cors-protocol" href="https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol" data-x-internal="cors-protocol">CORSプロトコル</a>または`<code id="coep:cross-origin-resource-policy"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーを通して明示的な許可を与えることなしに生成元をまたいだリソースをフェッチすることができる。<dt>"<dfn data-dfn-for="embedder policy value" id="coep-require-corp" data-export=""><code>require-corp</code></dfn>"<dd><p>この値を使用するとき、生成元をまたいだリソースをフェッチするには、<a id="coep:cors-protocol-2" href="https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol" data-x-internal="cors-protocol">CORSプロトコル</a>または`<code id="coep:cross-origin-resource-policy-2"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーを通してサーバーの明示的な許可が必要となる。<dt>"<dfn data-dfn-for="embedder policy value" id="coep-credentialless" data-export=""><code>credentialless</code></dfn>"<dd><p>この値を使用する場合、生成元をまたいだno-CORSリソースをフェッチすると、クレデンシャルが省略される。代わりに、明示的な`<code id="coep:cross-origin-resource-policy-3"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーは必要ない。クレデンシャルを使用して送信されるその他のリクエストには、<a id="coep:cors-protocol-3" href="https://triple-underscore.github.io/Fetch-ja.html#http-cors-protocol" data-x-internal="cors-protocol">CORSプロトコル</a>または `<code id="coep:cross-origin-resource-policy-4"><a data-x-internal="cross-origin-resource-policy" href="https://triple-underscore.github.io/Fetch-ja.html#http-cross-origin-resource-policy">Cross-Origin-Resource-Policy</a></code>`ヘッダーを介したサーバーの明示的な権限が必要である。</dl>

  <div class="warning"><p>"<code id="coep:coep-credentialless"><a href="#coep-credentialless">credentialless</a></code>"をサポートする前に、実装者は次の両方をサポートすることを強く勧める：<ul class="brief"><li><a href="https://wicg.github.io/private-network-access" />プライベートネットワークアクセス</a><li><a href="https://github.com/annevk/orb">不透明なレスポンスのブロックキング</a></ul>

   <p>そうでなければ、攻撃者は、<a href="webappapis.html#concept-settings-object-cross-origin-isolated-capability" id="coep:concept-settings-object-cross-origin-isolated-capability">生成元をまたいだ分離機能</a>を使用して、クライアントのネットワーク位置を利用して非公開リソースを読み取ることを可能にする。</p>
  </div>

  <p><a href="#embedder-policy-value" id="coep:embedder-policy-value">エンベッダーポリシー値</a>は、"<code id="coep:coep-credentialless-2"><a href="#coep-credentialless">credentialless</a></code>"または"<code id="coep:coep-require-corp"><a href="#coep-require-corp">require-corp</a></code>"である場合、<dfn id="compatible-with-cross-origin-isolation">生成元をまたいだ分離</dfn>と互換性がある。</p>

  

  <p><dfn id="embedder-policy" data-export="">埋め込みポリシー</dfn>は次で構成される：</p>

  <ul><li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-value-2" data-export="">値</dfn>。これは<a href="#embedder-policy-value" id="coep:embedder-policy-value-2">埋め込みポリシー値</a>であり、初期は"<code id="coep:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>"。<li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-reporting-endpoint" data-export="">報告エンドポイント</dfn>文字列。初期は空文字列。<li><p><dfn data-dfn-for="embedder policy" id="embedder-policy-report-only-value" data-export="">報告のみの値</dfn>。これは<a href="#embedder-policy-value" id="coep:embedder-policy-value-3">埋め込みポリシー値</a>であり、初期は"<code id="coep:coep-unsafe-none-2"><a href="#coep-unsafe-none">unsafe-none</a></code>"。<li><p><dfn data-dfn-for="embedder
   policy" id="embedder-policy-report-only-reporting-endpoint" data-export="">報告のみの報告エンドポイント</dfn>文字列。初期は空文字列。</ul>

  <p><dfn id="coep-report-type" data-export="">"<code>coep</code>"報告タイプ</dfn>は、値が"<code>coep</code>"となる<a id="coep:report-type" href="https://triple-underscore.github.io/reporting1-ja.html#report-type" data-x-internal="report-type">報告タイプ</a>である。これは<a id="coep:visible-to-reportingobservers" href="https://triple-underscore.github.io/reporting1-ja.html#visible-to-reportingobservers" data-x-internal="visible-to-reportingobservers"><code>ReportingObserver</code>から可視</a>である。</p>

  


  <h5 id="the-coep-headers"><span class="secno">7.1.4.1</span> ヘッダー<a href="#the-coep-headers" class="self-link"></a></h5>

  <p>`<dfn id="cross-origin-embedder-policy" data-dfn-type="http-header"><code>Cross-Origin-Embedder-Policy</code></dfn>`および`<dfn id="cross-origin-embedder-policy-report-only" data-dfn-type="http-header"><code>Cross-Origin-Embedder-Policy-Report-Only</code></dfn>` HTTPレスポンスヘッダーフィールドは、サーバーが<a id="the-coep-headers:environment-settings-object" href="webappapis.html#environment-settings-object">環境設定オブジェクト</a>の<a href="#embedder-policy" id="the-coep-headers:embedder-policy">埋め込みポリシー</a>を宣言することを可能にする。このヘッダーは<a href="https://httpwg.org/specs/rfc8941.html" id="the-coep-headers:http-structured-header" data-x-internal="http-structured-header">構造化されたヘッダー</a>であり、その値は<a href="https://httpwg.org/specs/rfc8941.html#token" id="the-coep-headers:http-structured-header-token" data-x-internal="http-structured-header-token">トークン</a>でなければならない。<a href="references.html#refsSTRUCTURED-FIELDS">[STRUCTURED-FIELDS]</a><p>妥当な<a href="https://httpwg.org/specs/rfc8941.html#token" id="the-coep-headers:http-structured-header-token-2" data-x-internal="http-structured-header-token">トークン</a>の値は、<a href="#embedder-policy-value" id="the-coep-headers:embedder-policy-value">埋め込みポリシー値</a>である。トークンはまた、付属の<a href="https://httpwg.org/specs/rfc8941.html#param" id="the-coep-headers:http-structured-header-parameters" data-x-internal="http-structured-header-parameters">パラメーター</a>を持ってもよい。これらのうち、"<dfn id="coep-report-to"><code>report-to</code></dfn>"パラメーターは、適切な報告エンドポイントを識別する<a id="the-coep-headers:valid-url-string" href="https://triple-underscore.github.io/URL-ja.html#valid-url-string" data-x-internal="valid-url-string">妥当なURL文字列</a>を持つことができる。<a href="references.html#refsREPORTING">[REPORTING]</a></p>

  <div class="note"><p><a href="#obtain-an-embedder-policy" id="the-coep-headers:obtain-an-embedder-policy">処理モデル</a>は、トークンとして解析できないヘッダーの存在下ではオープンに失敗する（デフォルトで"<code id="the-coep-headers:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>"）。これには、与えられた応答に存在する`<code id="the-coep-headers:cross-origin-embedder-policy"><a href="#cross-origin-embedder-policy">Cross-Origin-Embedder-Policy</a></code>`ヘッダーの複数のインスタンスを組み合わせて作成された不注意なリストが含まれる。</p>

   <table class="data"><thead><tr><th>`<code id="the-coep-headers:cross-origin-embedder-policy-2"><a href="#cross-origin-embedder-policy">Cross-Origin-Embedder-Policy</a></code>`<th>最終<a href="#embedder-policy-value" id="the-coep-headers:embedder-policy-value-2">埋め込みポリシー値</a><tbody><tr><td><em>No header delivered</em><td>"<code id="the-coep-headers:coep-unsafe-none-2"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp</code>`<td>"<code id="the-coep-headers:coep-require-corp"><a href="#coep-require-corp">require-corp</a></code>"<tr><td>`<code>unknown-value</code>`<td>"<code id="the-coep-headers:coep-unsafe-none-3"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp, unknown-value</code>`<td>"<code id="the-coep-headers:coep-unsafe-none-4"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>unknown-value, unknown-value</code>`<td>"<code id="the-coep-headers:coep-unsafe-none-5"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>unknown-value, require-corp</code>`<td>"<code id="the-coep-headers:coep-unsafe-none-6"><a href="#coep-unsafe-none">unsafe-none</a></code>"<tr><td>`<code>require-corp, require-corp</code>`<td>"<code id="the-coep-headers:coep-unsafe-none-7"><a href="#coep-unsafe-none">unsafe-none</a></code>"</table>

   <p>（同じことが`<code id="the-coep-headers:cross-origin-embedder-policy-report-only"><a href="#cross-origin-embedder-policy-report-only">Cross-Origin-Embedder-Policy-Report-Only</a></code>`にも適用される。）</p>
  </div>

  

  <hr>

  <p>To <dfn id="obtain-an-embedder-policy" data-export="">obtain an embedder policy</dfn> from a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="the-coep-headers:concept-response" data-x-internal="concept-response">response</a> <var>response</var> and an <a id="the-coep-headers:environment" href="webappapis.html#environment">environment</a> <var>environment</var>:</p>

  <ol><li><p>Let <var>policy</var> be a new <a href="#embedder-policy" id="the-coep-headers:embedder-policy-2">embedder policy</a>.<li><p>If <var>environment</var> is a <a id="the-coep-headers:non-secure-context" href="webappapis.html#non-secure-context">non-secure context</a>, then return <var>policy</var>.<li><p>Let <var>parsedItem</var> be the result of <a id="the-coep-headers:getting-a-structured-field-value" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> with `<code id="the-coep-headers:cross-origin-embedder-policy-3"><a href="#cross-origin-embedder-policy">Cross-Origin-Embedder-Policy</a></code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-coep-headers:concept-response-header-list" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is non-null and <var>parsedItem</var>[0] is <a href="#compatible-with-cross-origin-isolation" id="the-coep-headers:compatible-with-cross-origin-isolation">compatible with cross-origin isolation</a>:</p>

    <ol><li><p>Set <var>policy</var>'s <a href="#embedder-policy-value-2" id="the-coep-headers:embedder-policy-value-2-2">value</a> to <var>parsedItem</var>[0].<li><p>If <var>parsedItem</var>[1]["<code id="the-coep-headers:coep-report-to"><a href="#coep-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-coep-headers:map-exists" data-x-internal="map-exists">exists</a>, then set <var>policy</var>'s <a href="#embedder-policy-reporting-endpoint" id="the-coep-headers:embedder-policy-reporting-endpoint">endpoint</a> to <var>parsedItem</var>[1]["<code id="the-coep-headers:coep-report-to-2"><a href="#coep-report-to">report-to</a></code>"].</ol>
   <li><p>Set <var>parsedItem</var> to the result of <a id="the-coep-headers:getting-a-structured-field-value-2" href="https://triple-underscore.github.io/Fetch-ja.html#concept-header-list-get-structured-header" data-x-internal="getting-a-structured-field-value">getting a structured field value</a> with `<code id="the-coep-headers:cross-origin-embedder-policy-report-only-2"><a href="#cross-origin-embedder-policy-report-only">Cross-Origin-Embedder-Policy-Report-Only</a></code>` and "<code>item</code>" from <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-header-list" id="the-coep-headers:concept-response-header-list-2" data-x-internal="concept-response-header-list">header list</a>.<li><p>If <var>parsedItem</var> is non-null and <var>parsedItem</var>[0] is <a href="#compatible-with-cross-origin-isolation" id="the-coep-headers:compatible-with-cross-origin-isolation-2">compatible with cross-origin isolation</a>:</p>

    <ol><li><p>Set <var>policy</var>'s <a href="#embedder-policy-report-only-value" id="the-coep-headers:embedder-policy-report-only-value">report only value</a> to <var>parsedItem</var>[0].<li><p>If <var>parsedItem</var>[1]["<code id="the-coep-headers:coep-report-to-3"><a href="#coep-report-to">report-to</a></code>"] <a href="https://triple-underscore.github.io/infra-ja.html#map-exists" id="the-coep-headers:map-exists-2" data-x-internal="map-exists">exists</a>, then set <var>policy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="the-coep-headers:embedder-policy-report-only-reporting-endpoint">endpoint</a> to <var>parsedItem</var>[1]["<code id="the-coep-headers:coep-report-to-4"><a href="#coep-report-to">report-to</a></code>"].</ol>
   <li><p>Return <var>policy</var>.</ol>


  <h5 id="embedder-policy-checks"><span class="secno">7.1.4.2</span> Embedder policy checks<a href="#embedder-policy-checks" class="self-link"></a></h5>

  <p>To <dfn id="check-a-navigation-response's-adherence-to-its-embedder-policy">check a navigation response's adherence to its embedder policy</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response" data-x-internal="concept-response">response</a> <var>response</var>, a <a id="embedder-policy-checks:navigable" href="document-sequences.html#navigable">navigable</a> <var>navigable</var>, and an <a href="#embedder-policy" id="embedder-policy-checks:embedder-policy">embedder policy</a> <var>responsePolicy</var>:</p>

  <ol><li><p>If <var>navigable</var> is not a <a id="embedder-policy-checks:child-navigable" href="document-sequences.html#child-navigable">child navigable</a>, then return true.<li><p>Let <var>parentPolicy</var> be <var>navigable</var>'s <a href="document-sequences.html#nav-container-document" id="embedder-policy-checks:nav-container-document">container document</a>'s <a href="dom.html#concept-document-policy-container" id="embedder-policy-checks:concept-document-policy-container">policy container</a>'s <a href="#policy-container-embedder-policy" id="embedder-policy-checks:policy-container-embedder-policy">embedder policy</a>.<li><p>If <var>parentPolicy</var>'s <a href="#embedder-policy-report-only-value" id="embedder-policy-checks:embedder-policy-report-only-value">report-only value</a> is <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation">compatible with cross-origin isolation</a> and <var>responsePolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2">value</a> is not, then <a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation">queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>navigation</code>", <var>parentPolicy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="embedder-policy-checks:embedder-policy-report-only-reporting-endpoint">report only reporting endpoint</a>, "<code>reporting</code>", and <var>navigable</var>'s <a href="document-sequences.html#nav-container-document" id="embedder-policy-checks:nav-container-document-2">container document</a>'s <a id="embedder-policy-checks:relevant-settings-object" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>If <var>parentPolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-2">value</a> is not <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation-2">compatible with cross-origin isolation</a> or <var>responsePolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-3">value</a> is <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation-3">compatible with cross-origin isolation</a>, then return true.<li><p><a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-2">Queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>navigation</code>", <var>parentPolicy</var>'s <a href="#embedder-policy-reporting-endpoint" id="embedder-policy-checks:embedder-policy-reporting-endpoint">reporting endpoint</a>, "<code>enforce</code>", and <var>navigable</var>'s <a href="document-sequences.html#nav-container-document" id="embedder-policy-checks:nav-container-document-3">container document</a>'s <a id="embedder-policy-checks:relevant-settings-object-2" href="webappapis.html#relevant-settings-object">relevant settings object</a>.<li><p>falseを返す。</ol>

  <p>To <dfn id="check-a-global-object's-embedder-policy">check a global object's embedder policy</dfn> given a <code id="embedder-policy-checks:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> <var>workerGlobalScope</var>, an <a id="embedder-policy-checks:environment-settings-object" href="webappapis.html#environment-settings-object">environment settings object</a> <var>owner</var>, and a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response-2" data-x-internal="concept-response">response</a> <var>response</var>:</p>

  <ol><li><p>If <var>workerGlobalScope</var> is not a <code id="embedder-policy-checks:dedicatedworkerglobalscope"><a href="workers.html#dedicatedworkerglobalscope">DedicatedWorkerGlobalScope</a></code> object, then return true.<li><p>Let <var>policy</var> be <var>workerGlobalScope</var>'s <a href="workers.html#concept-workerglobalscope-embedder-policy" id="embedder-policy-checks:concept-workerglobalscope-embedder-policy">embedder policy</a>.<li><p>Let <var>ownerPolicy</var> be <var>owner</var>'s <a href="webappapis.html#concept-settings-object-policy-container" id="embedder-policy-checks:concept-settings-object-policy-container">policy container</a>'s <a href="#policy-container-embedder-policy" id="embedder-policy-checks:policy-container-embedder-policy-2">embedder policy</a>.<li><p>If <var>ownerPolicy</var>'s <a href="#embedder-policy-report-only-value" id="embedder-policy-checks:embedder-policy-report-only-value-2">report-only value</a> is <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation-4">compatible with cross-origin isolation</a> and <var>policy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-4">value</a> is not, then <a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-3">queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>worker initialization</code>", <var>owner's policy</var>'s <a href="#embedder-policy-report-only-reporting-endpoint" id="embedder-policy-checks:embedder-policy-report-only-reporting-endpoint-2">report only reporting endpoint</a>, "<code>reporting</code>", and <var>owner</var>.<li><p>If <var>ownerPolicy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-5">value</a> is not <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation-5">compatible with cross-origin isolation</a> or <var>policy</var>'s <a href="#embedder-policy-value-2" id="embedder-policy-checks:embedder-policy-value-2-6">value</a> is <a href="#compatible-with-cross-origin-isolation" id="embedder-policy-checks:compatible-with-cross-origin-isolation-6">compatible with cross-origin isolation</a>, then return true.<li><p><a href="#queue-a-cross-origin-embedder-policy-inheritance-violation" id="embedder-policy-checks:queue-a-cross-origin-embedder-policy-inheritance-violation-4">Queue a cross-origin embedder policy inheritance violation</a> with <var>response</var>, "<code>worker initialization</code>", <var>owner's policy</var>'s <a href="#embedder-policy-reporting-endpoint" id="embedder-policy-checks:embedder-policy-reporting-endpoint-2">reporting endpoint</a>, "<code>enforce</code>", and <var>owner</var>.<li><p>falseを返す。</ol>

  <p>To <dfn id="queue-a-cross-origin-embedder-policy-inheritance-violation">queue a cross-origin embedder policy inheritance violation</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="embedder-policy-checks:concept-response-3" data-x-internal="concept-response">response</a> <var>response</var>, a string <var>type</var>, a string <var>endpoint</var>, a string <var>disposition</var>, and an <a id="embedder-policy-checks:environment-settings-object-2" href="webappapis.html#environment-settings-object">environment settings object</a> <var>settings</var>:</p>

  <ol><li><p>Let <var>serialized</var> be the result of <a href="https://triple-underscore.github.io/Fetch-ja.html#serialize-a-response-url-for-reporting" id="embedder-policy-checks:serialize-a-response-url-for-reporting" data-x-internal="serialize-a-response-url-for-reporting">serializing a response URL for reporting</a> with <var>response</var>.<li><p>Let <var>body</var> be a new object containing the following properties:</p>

    <table class="data"><thead><tr><th>key<th>value<tbody><tr><td>type<td><var>type</var><tr><td>blockedURL<td><var>serialized</var><tr><td>disposition<td><var>disposition</var></table>
   <li><p><a href="https://triple-underscore.github.io/reporting1-ja.html#queue-report" id="embedder-policy-checks:queue-a-report" data-x-internal="queue-a-report">Queue</a> <var>body</var> as the <a href="#coep-report-type" id="embedder-policy-checks:coep-report-type">"<code>coep</code>" report type</a> for <var>endpoint</var> on <var>settings</var>.</ol>

  


  <h4 id="sandboxing"><span class="secno">7.1.5</span> サンドボックス<a href="#sandboxing" class="self-link"></a></h4>

  <p><dfn id="sandboxing-flag-set" data-export="">サンドボックスフラグセット</dfn>は以下のフラグの0個以上の集合であり、これは潜在的に信頼されないリソースが持つ能力を制限するために使用される：</p>

  <dl><dt><dfn id="sandboxed-navigation-browsing-context-flag" data-export="">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、コンテンツが、<a href="browsing-the-web.html#sandboxLinks">サンドボックス化されたブラウジングコンテキスト自体</a>（またはその中にさらにネストされたブラウジングコンテキスト）、<a href="document-sequences.html#auxiliary-browsing-context" id="sandboxing:auxiliary-browsing-context">補助ブラウジングコンテキスト</a>（次に定義される<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護されている）、および<a id="sandboxing:top-level-browsing-context" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>（<a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag">サンドボックス化されたユーザー起動ブラウジングコンテキストフラグなしのトップレベルナビゲーション</a>、および以下に定義される<a href="#sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-with-user-activation-browsing-context-flag">サンドボックス化されたユーザー起動ブラウジングコンテキストフラグありトップレベルナビゲーション</a>によって保護されている）以外のブラウジングコンテキストをナビゲートすることを防止するものである。</p>

    <p><a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-2">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>が設定されない場合、それにもかかわらず一定の場合における制限はポップアップ（新しい<a href="document-sequences.html#top-level-browsing-context" id="sandboxing:top-level-browsing-context-2">トップレベルブラウジングコンテキスト</a>）を開くことができる。これらの<a href="document-sequences.html#browsing-context" id="sandboxing:browsing-context">ブラウジングコンテキスト</a>は常に、<dfn id="one-permitted-sandboxed-navigator">1つの許可されたサンドボックス化されたナビゲーター</dfn>を持ち、実際に移動するために作成した<a id="sandboxing:browsing-context-2" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>を許可する、ブラウジングコンテキストが作成されるときに設定を持つ。（そうでなければ、<a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>は、それらが開かれた場合であってもナビゲートされていくのを防ぐだろう。）</p>
   <dt><dfn id="sandboxed-auxiliary-navigation-browsing-context-flag" data-export="">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="document-sequences.html#sandboxWindowOpen">コンテンツが新しい補助ブラウジングコンテキストを作成するのを防ぐ</a>。 たとえば、<code id="sandboxing:attr-hyperlink-target"><a href="links.html#attr-hyperlink-target">target</a></code>属性や<code id="sandboxing:dom-open"><a href="nav-history-apis.html#dom-open">window.open()</a></code>メソッドを使用する。</p>
   <dt><dfn id="sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" data-export="">ユーザーによるアクティブ化なしでサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="browsing-the-web.html#sandboxLinks">それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href="nav-history-apis.html#sandboxClose">それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。サンドボックス化されたブラウジングコンテキストの<a id="sandboxing:active-window" href="document-sequences.html#active-window">アクティブウィンドウ</a>が<a id="sandboxing:transient-activation" href="interaction.html#transient-activation">一時的なアクティブ化</a>を持たない場合にのみ考慮される。</p>

    <p><a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-2">ユーザーによるアクティブ化なしでサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</a>が設定されて<em>いない</em>場合、コンテンツはその<a id="sandboxing:top-level-browsing-context-3" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>をナビゲートすることができるが、他の<a href="document-sequences.html#browsing-context" id="sandboxing:browsing-context-3">ブラウジングコンテキスト</a>は、<a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-2">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a>、および<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-3">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a>によって保護されたままである。</p>
   <dt><dfn id="sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" data-export="">ユーザーによるアクティブ化でサンドボックス化されたトップレベルナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="browsing-the-web.html#sandboxLinks">それらの<span>トップレベルブラウジングコンテキスト</span>のナビゲートからコンテンツを防ぎ</a>、かつ<a href="nav-history-apis.html#sandboxClose">それらの<span>トップレベルブラウジングコンテキスト</span>の遮断からコンテンツを防ぐ</a>。サンドボックス化されたブラウジングコンテキストの<a id="sandboxing:active-window-2" href="document-sequences.html#active-window">アクティブウィンドウ</a>が<a id="sandboxing:transient-activation-2" href="interaction.html#transient-activation">一時的なアクティブ化</a>を持つ場合にのみ考慮される。</p>

    <p><a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-3">ユーザーによるアクティブ化なしでサンドボックス化されたブラウジングコンテキストフラグ</a>と同様に、このフラグは<a id="sandboxing:top-level-browsing-context-4" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>にのみ影響する。 設定されていない場合、他の<a href="document-sequences.html#browsing-context" id="sandboxing:browsing-context-4">ブラウジングコンテキスト</a>が他のフラグによって保護されている可能性がある。</p>
   <dt><dfn id="sandboxed-origin-browsing-context-flag" data-export="">サンドボックス化された生成元ブラウジングコンテキストフラグ</dfn><dd><p>This flag <a href="document-sequences.html#sandboxOrigin">forces content into an opaque origin</a>, thus preventing it from accessing other content from the same <a href="#concept-origin" id="sandboxing:concept-origin">origin</a>.</p>

    <p>このフラグはまた、<a href="dom.html#sandboxCookies"><code>document.cookie</code> IDL属性からの読み取りまたは書き込みをするスクリプトを防止し</a>、<code id="sandboxing:dom-localstorage"><a href="webstorage.html#dom-localstorage">localStorage</a></code>へのアクセスをブロックする。</p>
   <dt><dfn id="sandboxed-forms-browsing-context-flag" data-export="">サンドボックス化されたフォームブラウジングコンテキストフラグ</dfn><dd><p>このフラグは<a href="form-control-infrastructure.html#sandboxSubmitBlocked">フォーム送信をブロックする</a>。</p>
   <dt><dfn id="sandboxed-pointer-lock-browsing-context-flag" data-export="">サンドボックス化されたポインターロックブラウジングコンテキストフラグ</dfn><dd><p>このフラグはPointer Lock APIを無効にする。<a href="references.html#refsPOINTERLOCK">[POINTERLOCK]</a></p>
   <dt><dfn id="sandboxed-scripts-browsing-context-flag" data-export="">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="webappapis.html#sandboxScriptBlocked">スクリプトの実行をブロックする</a>。</p>
   <dt><dfn id="sandboxed-automatic-features-browsing-context-flag" data-export="">サンドボックス化された自動機能ブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="media.html#attr-media-autoplay" id="sandboxing:attr-media-autoplay">自動ビデオ再生</a>や<a href="interaction.html#attr-fe-autofocus" id="sandboxing:attr-fe-autofocus">自動フォームコントロールフォーカス</a>などの、自動的に切り替える機能をブロックする。</p>
   <dt><dfn id="sandboxed-document.domain-browsing-context-flag" data-export="">サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、コンテンツが<code id="sandboxing:dom-document-domain"><a href="#dom-document-domain">document.domain</a></code>セッターを使用することから防ぐ。</p>
   <dt><dfn id="sandbox-propagates-to-auxiliary-browsing-contexts-flag" data-export="">サンドボックスが補助ブラウジングコンテキストに伝播するフラグ</dfn><dd><p>このフラグは、コンテンツが作成する<a id="sandboxing:auxiliary-browsing-context-2" href="document-sequences.html#auxiliary-browsing-context">補助ブラウジングコンテキスト</a>がコンテンツの<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set">アクティブなサンドボックスフラグセット</a>を継承するのを保証することで、そのコンテンツがサンドボックスをエスケープするのを防ぐ。</p>
   <dt><dfn id="sandboxed-modals-flag" data-export="">サンドボックス化されたモーダルフラグ</dfn><dd><p>このフラグは、コンテンツが以下の機能のいずれかを使用してモーダルダイアログを生成するのを防ぐ：</p>

    <ul><li><code id="sandboxing:dom-alert"><a href="timers-and-user-prompts.html#dom-alert">window.alert()</a></code><li><code id="sandboxing:dom-confirm"><a href="timers-and-user-prompts.html#dom-confirm">window.confirm()</a></code><li><code id="sandboxing:dom-print"><a href="timers-and-user-prompts.html#dom-print">window.print()</a></code><li><code id="sandboxing:dom-prompt"><a href="timers-and-user-prompts.html#dom-prompt">window.prompt()</a></code><li><code id="sandboxing:event-beforeunload"><a href="indices.html#event-beforeunload">beforeunload</a></code>イベント</ul>
   <dt><dfn id="sandboxed-orientation-lock-browsing-context-flag" data-export="">サンドボックス化された方向ロックブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、画面の向きをロックする機能を無効にする。<a href="references.html#refsSCREENORIENTATION">[SCREENORIENTATION]</a></p>
   <dt><dfn id="sandboxed-presentation-browsing-context-flag" data-export="">サンドボックス化されたプレゼンテーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグはPresentation APIを無効にする。 <a href="references.html#refsPRESENTATION">[PRESENTATION]</a></p>
   <dt><dfn id="sandboxed-downloads-browsing-context-flag" data-export="">サンドボックス化されたダウンロードブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、<a href="links.html#downloading-hyperlinks" id="sandboxing:downloading-hyperlinks">ハイパーリンクのダウンロード</a>または<a id="sandboxing:as-a-download" href="links.html#as-a-download">ダウンロードとして</a>処理される<a href="browsing-the-web.html#navigation-as-a-download">ナビゲーション</a>のいずれを介して、コンテンツがダウンロードを開始またはインスタンス化するのを防ぐ。</p>
   <dt><dfn id="sandboxed-custom-protocols-navigation-browsing-context-flag" data-export="">サンドボックス化されたカスタムプロトコルナビゲーションブラウジングコンテキストフラグ</dfn><dd><p>このフラグは、非<a href="https://triple-underscore.github.io/Fetch-ja.html#fetch-scheme" id="sandboxing:fetch-scheme" data-x-internal="fetch-scheme">フェッチスキーム</a>へのナビゲーションが<a href="browsing-the-web.html#hand-off-to-external-software" id="sandboxing:hand-off-to-external-software">外部ソフトウェアに渡される</a>のを妨げる。</p>
   </dl>

  

  <p>When the user agent is to <dfn id="parse-a-sandboxing-directive" data-export="">parse a sandboxing directive</dfn>, given a string <var>input</var>, a <a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set">sandboxing flag set</a> <var>output</var>, it must run the following steps:</p>

  <ol><li><p><a href="https://triple-underscore.github.io/infra-ja.html#split-on-ascii-whitespace" id="sandboxing:split-a-string-on-spaces" data-x-internal="split-a-string-on-spaces">Split <var>input</var> on ASCII whitespace</a>, to obtain <var>tokens</var>.<li><p><var>output</var>を空にする。<li><p><var>output</var>に次のフラグを追加する：</p>

    <ul><li><p><a href="#sandboxed-navigation-browsing-context-flag" id="sandboxing:sandboxed-navigation-browsing-context-flag-3">サンドボックス化されたナビゲーションブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-popups" data-dfn-type="attr-value"><code>allow-popups</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-auxiliary-navigation-browsing-context-flag" id="sandboxing:sandboxed-auxiliary-navigation-browsing-context-flag-4">サンドボックス化された補助ナビゲーションブラウジングコンテキストフラグ</a><li><p>The <a href="#sandboxed-top-level-navigation-without-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-without-user-activation-browsing-context-flag-4">sandboxed top-level navigation without user activation browsing context flag</a>, unless <var>tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-top-navigation" data-dfn-type="attr-value"><code>allow-top-navigation</code></dfn> keyword.<li><p>The <a href="#sandboxed-top-level-navigation-with-user-activation-browsing-context-flag" id="sandboxing:sandboxed-top-level-navigation-with-user-activation-browsing-context-flag-2">sandboxed top-level navigation with user activation browsing context flag</a>, unless <var>tokens</var> contains either the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-top-navigation-by-user-activation" data-dfn-type="attr-value"><code>allow-top-navigation-by-user-activation</code></dfn> keyword or the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation"><a href="#attr-iframe-sandbox-allow-top-navigation">allow-top-navigation</a></code> keyword.</p>

      <p class="note">This means that if the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation-2"><a href="#attr-iframe-sandbox-allow-top-navigation">allow-top-navigation</a></code> is present, the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation-by-user-activation"><a href="#attr-iframe-sandbox-allow-top-navigation-by-user-activation">allow-top-navigation-by-user-activation</a></code> keyword will have no effect. For this reason, specifying both is a document conformance error.</p>
     <li><p><var>tokens</var>が<dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-same-origin" data-dfn-type="attr-value"><code>allow-same-origin</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-origin-browsing-context-flag" id="sandboxing:sandboxed-origin-browsing-context-flag">サンドボックス化された生成元ブラウジングコンテキストフラグ</a></p>

      <div class="note"><p><code id="sandboxing:attr-iframe-sandbox-allow-same-origin"><a href="#attr-iframe-sandbox-allow-same-origin">allow-same-origin</a></code>キーワードは2つの例を対象とする。</p>

       <p>1つ目は、依然としてサンドボックス化されたコンテンツのDOMへのアクセスを可能する一方で、スクリプトを無効にするためにサンドボックス化されるべき同じサイトからコンテンツを許可するために使用できる。</p>

       <p>2つ目は、サードパーティサイトからコンテンツを埋め込むために使用でき、データなどを格納するためにデータベースAPIを使用して、その元のサイトに戻る通信から埋め込まれたページを妨げることなく、ポップアップなどを開いてから、そのサイトを防ぐためにサンドボックス化する。</p>
      </div>
     <li><p><var>tokens</var>が<dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-forms" data-dfn-type="attr-value"><code>allow-forms</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-forms-browsing-context-flag" id="sandboxing:sandboxed-forms-browsing-context-flag">サンドボックス化されたフォームブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-pointer-lock" data-dfn-type="attr-value"><code>allow-pointer-lock</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-pointer-lock-browsing-context-flag" id="sandboxing:sandboxed-pointer-lock-browsing-context-flag">サンドボックス化されたポインターロックブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が<dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-scripts" data-dfn-type="attr-value"><code>allow-scripts</code></dfn>キーワードを含む場合を除いて、<a href="#sandboxed-scripts-browsing-context-flag" id="sandboxing:sandboxed-scripts-browsing-context-flag">サンドボックス化されたスクリプトブラウジングコンテキストフラグ</a><li><p><var>tokens</var>が（上記で定義された）<code id="sandboxing:attr-iframe-sandbox-allow-scripts"><a href="#attr-iframe-sandbox-allow-scripts">allow-scripts</a></code>キーワードを含む場合を除いて、<a href="#sandboxed-automatic-features-browsing-context-flag" id="sandboxing:sandboxed-automatic-features-browsing-context-flag">サンドボックス化された自動機能ブラウジングコンテキストフラグ</a></p>

      <p class="note">このフラグは、スクリプトと同じキーワードで緩和される。なぜなら、スクリプトが有効である場合にこれらの機能はいずれにせよ些細なことで実行でき、宣言的な機能を使用できるようにするよりむしろサンドボックス化された場合に、著者がそれら機能を実行するためのスクリプトを使用するよう強制することが不幸であるためである。</p>
     <li><p><a href="#sandboxed-document.domain-browsing-context-flag" id="sandboxing:sandboxed-document.domain-browsing-context-flag">サンドボックス化された<code>document.domain</code>ブラウジングコンテキストフラグ</a>。<li><p>The <a href="#sandbox-propagates-to-auxiliary-browsing-contexts-flag" id="sandboxing:sandbox-propagates-to-auxiliary-browsing-contexts-flag">sandbox propagates to auxiliary browsing contexts flag</a>, unless <var>tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-popups-to-escape-sandbox" data-dfn-type="attr-value"><code>allow-popups-to-escape-sandbox</code></dfn> keyword.<li><p>The <a href="#sandboxed-modals-flag" id="sandboxing:sandboxed-modals-flag">sandboxed modals flag</a>, unless <var>tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-modals" data-dfn-type="attr-value"><code>allow-modals</code></dfn> keyword.<li><p>The <a href="#sandboxed-orientation-lock-browsing-context-flag" id="sandboxing:sandboxed-orientation-lock-browsing-context-flag">sandboxed orientation lock browsing context flag</a>, unless <var>tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-orientation-lock" data-dfn-type="attr-value"><code>allow-orientation-lock</code></dfn> keyword.<li><p>The <a href="#sandboxed-presentation-browsing-context-flag" id="sandboxing:sandboxed-presentation-browsing-context-flag">sandboxed presentation browsing context flag</a>, unless <var>tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-presentation" data-dfn-type="attr-value"><code>allow-presentation</code></dfn> keyword.<li><p>The <a href="#sandboxed-downloads-browsing-context-flag" id="sandboxing:sandboxed-downloads-browsing-context-flag">sandboxed downloads browsing context flag</a>, unless <var> tokens</var> contains the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-downloads" data-dfn-type="attr-value"><code>allow-downloads</code></dfn> keyword.<li><p>The <a href="#sandboxed-custom-protocols-navigation-browsing-context-flag" id="sandboxing:sandboxed-custom-protocols-navigation-browsing-context-flag">sandboxed custom protocols navigation browsing context flag</a>, unless <var>tokens</var> contains either the <dfn data-dfn-for="iframe/sandbox" id="attr-iframe-sandbox-allow-top-navigation-to-custom-protocols" data-dfn-type="attr-value"><code>allow-top-navigation-to-custom-protocols</code></dfn> keyword, the <code id="sandboxing:attr-iframe-sandbox-allow-popups"><a href="#attr-iframe-sandbox-allow-popups">allow-popups</a></code> keyword, or the <code id="sandboxing:attr-iframe-sandbox-allow-top-navigation-3"><a href="#attr-iframe-sandbox-allow-top-navigation">allow-top-navigation</a></code> keyword.</ul>
   </ol>

  <hr>

  <p>すべての<a id="sandboxing:top-level-browsing-context-5" href="document-sequences.html#top-level-browsing-context">トップレベルブラウジングコンテキスト</a>は、<dfn id="popup-sandboxing-flag-set">ポップアップサンドボックス化 フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-2">サンドボックス化フラグセット</a>である。<a id="sandboxing:browsing-context-5" href="document-sequences.html#browsing-context">ブラウジングコンテキスト</a>が作成される場合、その<a href="#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set">ポップアップサンド化フラグセット</a>は空でなければならない。It is populated by <a id="sandboxing:the-rules-for-choosing-a-navigable" href="document-sequences.html#the-rules-for-choosing-a-navigable">the rules for choosing a navigable</a> and the <a href="#obtain-browsing-context-navigation" id="sandboxing:obtain-browsing-context-navigation">obtain a browsing context to use for a navigation response</a> algorithm.</p>

  <p>すべての<code id="sandboxing:the-iframe-element"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素は、<dfn id="iframe-sandboxing-flag-set"><code>iframe</code>サンドボックス化フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-3">サンドボックス化フラグセット</a>である。<a href="#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set"><code>iframe</code>サンドボックス化フラグセット</a>のどのフラグが特定の時間にセットされるかは、<code id="sandboxing:the-iframe-element-2"><a href="iframe-embed-object.html#the-iframe-element">iframe</a></code>要素の<code id="sandboxing:attr-iframe-sandbox"><a href="iframe-embed-object.html#attr-iframe-sandbox">sandbox</a></code> 属性によって決定される。</p>

  <p>すべての<code id="sandboxing:document"><a href="dom.html#document">Document</a></code>は、<dfn data-dfn-for="Document" id="active-sandboxing-flag-set" data-export="">アクティブなサンドボックス化フラグセット</dfn>を持ち、これは<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-4">サンドボックス化フラグセット</a>である、<code id="sandboxing:document-2"><a href="dom.html#document">Document</a></code>が作成される場合、その<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-2">アクティブなサンドボックス化フラグセット</a>は空でなければならない。それは、<a href="browsing-the-web.html#navigate" id="sandboxing:navigate">ナビゲーションアルゴリズム</a>によって追加される。</p>

  <p id="forced-sandboxing-flag-set">Every <a href="https://triple-underscore.github.io/CSP3-ja.html#csp-list" id="sandboxing:concept-csp-list" data-x-internal="concept-csp-list">CSP list</a> <var>cspList</var> has <dfn id="csp-derived-sandboxing-flags">CSP-derived sandboxing flags</dfn>, which is a <a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-5">sandboxing flag set</a>. It is the return value of the following algorithm:</p>

  <ol><li><p>Let <var>directives</var> be an empty <a href="https://triple-underscore.github.io/infra-ja.html#ordered-set" id="sandboxing:set" data-x-internal="set">ordered set</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="sandboxing:list-iterate" data-x-internal="list-iterate">For each</a> policy in <var>cspList</var>:</p>

    <ol><li><p>If <var>policy</var>'s <a href="https://triple-underscore.github.io/CSP3-ja.html#policy-disposition" id="sandboxing:csp-disposition" data-x-internal="csp-disposition">disposition</a> is not "<code>enforce</code>", then <a id="sandboxing:continue" href="https://triple-underscore.github.io/infra-ja.html#iteration-continue" data-x-internal="continue">continue</a>.<li><p>If <var>policy</var>'s <a href="https://triple-underscore.github.io/CSP3-ja.html#policy-directive-set" id="sandboxing:csp-directive-set" data-x-internal="csp-directive-set">directive set</a> <a href="https://triple-underscore.github.io/infra-ja.html#list-contain" id="sandboxing:list-contains" data-x-internal="list-contains">contains</a> a <a href="https://triple-underscore.github.io/CSP3-ja.html#directives" id="sandboxing:content-security-policy-directive" data-x-internal="content-security-policy-directive">directive</a> whose name is "<code id="sandboxing:sandbox-directive"><a data-x-internal="sandbox-directive" href="https://triple-underscore.github.io/CSP3-ja.html#sandbox">sandbox</a></code>", then <a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="sandboxing:list-append" data-x-internal="list-append">append</a> that directive to <var>directives</var>.</ol>
   <li><p>If <var>directives</var> is empty, then return an empty <a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-6">sandboxing flag set</a>.<li><p>Let <var>directive</var> be <var>directives</var>[<var>directives</var>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="sandboxing:list-size" data-x-internal="list-size">size</a> − 1].<li><p>Return the result of <a href="#parse-a-sandboxing-directive" id="sandboxing:parse-a-sandboxing-directive">parsing the sandboxing directive</a> <var>directive</var>.</ol>

  <hr>

  <p>nullまたは要素<var>embedder</var>を指定して、<a href="document-sequences.html#concept-document-bc" id="sandboxing:concept-document-bc">ブラウジングコンテキスト</a><var>browsing context</var>の<dfn id="determining-the-creation-sandboxing-flags">作成サンドボックスフラグ</dfn>を決定するには、次の<a href="#sandboxing-flag-set" id="sandboxing:sandboxing-flag-set-7">サンドボックスフラグセット</a>に存在するフラグの<a href="https://triple-underscore.github.io/infra-ja.html#set-union" id="sandboxing:set-union" data-x-internal="set-union">和集合</a>を返す。</p>

  <ul><li><p><var>embedder</var>がnullである場合：<var>browsing context</var>の<a href="#popup-sandboxing-flag-set" id="sandboxing:popup-sandboxing-flag-set-2">ポップアップサンドボックス化フラグセット</a>のフラグセット。<li><p><var>embedder</var>が要素である場合：<var>embedder</var>の<a href="#iframe-sandboxing-flag-set" id="sandboxing:iframe-sandboxing-flag-set-2"><code>iframe</code>サンドボックス化フラグセット</a>のフラグセット。<li><p><var>embedder</var>が要素である場合：<var>embedder</var>の<a id="sandboxing:node-document" href="https://triple-underscore.github.io/DOM4-ja.html#concept-node-document" data-x-internal="node-document">ノード文書</a>の<a href="#active-sandboxing-flag-set" id="sandboxing:active-sandboxing-flag-set-3">アクティブなサンドボックス化フラグセット</a>のフラグセット。</ul>


  <h4 id="policy-containers"><span class="secno">7.1.6</span> Policy containers<a href="#policy-containers" class="self-link"></a></h4>

  <p>A <dfn id="policy-container" data-export="">policy container</dfn> is a <a id="policy-containers:struct" href="https://triple-underscore.github.io/infra-ja.html#struct" data-x-internal="struct">struct</a> containing policies that apply to a <code id="policy-containers:document"><a href="dom.html#document">Document</a></code>, a <code id="policy-containers:workerglobalscope"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code>, or a <code id="policy-containers:workletglobalscope"><a href="worklets.html#workletglobalscope">WorkletGlobalScope</a></code>. It has the following <a href="https://triple-underscore.github.io/infra-ja.html#struct-item" id="policy-containers:struct-item" data-x-internal="struct-item">items</a>:</p>

  

  <ul><li><p>A <dfn data-dfn-for="policy container" id="policy-container-csp-list" data-export="">CSP list</dfn>, which is a <a href="https://triple-underscore.github.io/CSP3-ja.html#csp-list" id="policy-containers:concept-csp-list" data-x-internal="concept-csp-list">CSP list</a>. It is initially empty.<li><p>An <dfn data-dfn-for="policy container" id="policy-container-embedder-policy" data-export="">embedder policy</dfn>, which is an <a href="#embedder-policy" id="policy-containers:embedder-policy">embedder policy</a>. It is initially a new <a href="#embedder-policy" id="policy-containers:embedder-policy-2">embedder policy</a>.<li><p>A <dfn data-dfn-for="policy container" id="policy-container-referrer-policy" data-export="">referrer policy</dfn>, which is a <a id="policy-containers:referrer-policy" href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#referrer-policy" data-x-internal="referrer-policy">referrer policy</a>. It is initially the <a id="policy-containers:default-referrer-policy" href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#default-referrer-policy" data-x-internal="default-referrer-policy">default referrer policy</a>.</ul>

  <p class="XXX">Move other policies into the policy container.</p>

  <p>To <dfn id="clone-a-policy-container" data-export="">clone a policy container</dfn> given a <a href="#policy-container" id="policy-containers:policy-container">policy container</a> <var>policyContainer</var>:</p>

  <ol><li><p>Let <var>clone</var> be a new <a href="#policy-container" id="policy-containers:policy-container-2">policy container</a>.<li><p><a href="https://triple-underscore.github.io/infra-ja.html#list-iterate" id="policy-containers:list-iterate" data-x-internal="list-iterate">For each</a> <var>policy</var> in <var>policyContainer</var>'s <a href="#policy-container-csp-list" id="policy-containers:policy-container-csp-list">CSP list</a>, <a href="https://triple-underscore.github.io/infra-ja.html#list-append" id="policy-containers:list-append" data-x-internal="list-append">append</a> a copy of <var>policy</var> into <var>clone</var>'s <a href="#policy-container-csp-list" id="policy-containers:policy-container-csp-list-2">CSP list</a>.<li><p>Set <var>clone</var>'s <a href="#policy-container-embedder-policy" id="policy-containers:policy-container-embedder-policy">embedder policy</a> to a copy of <var>policyContainer</var>'s <a href="#policy-container-embedder-policy" id="policy-containers:policy-container-embedder-policy-2">embedder policy</a>.<li><p>Set <var>clone</var>'s <a href="#policy-container-referrer-policy" id="policy-containers:policy-container-referrer-policy">referrer policy</a> to <var>policyContainer</var>'s <a href="#policy-container-referrer-policy" id="policy-containers:policy-container-referrer-policy-2">referrer policy</a>.<li><p>Return <var>clone</var>.</ol>

  <p>To determine whether a <a id="policy-containers:url" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>url</var> <dfn id="requires-storing-the-policy-container-in-history">requires storing the policy container in history</dfn>:</p>

  <ol><li><p>If <var>url</var>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="policy-containers:concept-url-scheme" data-x-internal="concept-url-scheme">scheme</a> is "<code>blob</code>", then return false.<li><p>If <var>url</var> <a href="https://triple-underscore.github.io/Fetch-ja.html#is-local" id="policy-containers:is-local" data-x-internal="is-local">is local</a>, then return true.<li><p>falseを返す。</ol>

  <p>To <dfn id="creating-a-policy-container-from-a-fetch-response" data-lt="creating a policy container from a fetch response" data-export="">create a policy container from a fetch response</dfn> given a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="policy-containers:concept-response" data-x-internal="concept-response">response</a> <var>response</var> and an <a id="policy-containers:environment" href="webappapis.html#environment">environment</a>-or-null <var>environment</var>:</p>

  <ol><li><p>If <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="policy-containers:concept-response-url" data-x-internal="concept-response-url">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="policy-containers:concept-url-scheme-2" data-x-internal="concept-url-scheme">scheme</a> is "<code>blob</code>", then return a <a href="#clone-a-policy-container" id="policy-containers:clone-a-policy-container">clone</a> of <var>response</var>'s <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response-url" id="policy-containers:concept-response-url-2" data-x-internal="concept-response-url">URL</a>'s <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-blob-entry" id="policy-containers:concept-url-blob-entry" data-x-internal="concept-url-blob-entry">blob URL entry</a>'s <a href="https://triple-underscore.github.io/File_API-ja.html#blob-url-entry-environment" id="policy-containers:blob-url-entry-environment" data-x-internal="blob-url-entry-environment">environment</a>'s <a href="#policy-container" id="policy-containers:policy-container-3">policy container</a>.<li><p>Let <var>result</var> be a new <a href="#policy-container" id="policy-containers:policy-container-4">policy container</a>.<li><p>Set <var>result</var>'s <a href="#policy-container-csp-list" id="policy-containers:policy-container-csp-list-3">CSP list</a> to the result of <a href="https://triple-underscore.github.io/CSP3-ja.html#parse-response-csp" id="policy-containers:parse-response-csp" data-x-internal="parse-response-csp">parsing a response's Content Security Policies</a> given <var>response</var>.<li><p>If <var>environment</var> is non-null, then set <var>result</var>'s <a href="#policy-container-embedder-policy" id="policy-containers:policy-container-embedder-policy-3">embedder policy</a> to the result of <a href="#obtain-an-embedder-policy" id="policy-containers:obtain-an-embedder-policy">obtaining an embedder policy</a> given <var>response</var> and <var>environment</var>. Otherwise, set it to "<code id="policy-containers:coep-unsafe-none"><a href="#coep-unsafe-none">unsafe-none</a></code>".<li><p>Set <var>result</var>'s <a href="#policy-container-referrer-policy" id="policy-containers:policy-container-referrer-policy-3">referrer policy</a> to the result of <a href="https://triple-underscore.github.io/webappsec-referrer-policy-ja.html#parse-referrer-policy-from-header" id="policy-containers:parse-referrer-policy-header" data-x-internal="parse-referrer-policy-header">parsing the `<code>Referrer-Policy</code>` header</a> given <var>response</var>. <a href="references.html#refsREFERRERPOLICY">[REFERRERPOLICY]</a><li><p>Return <var>result</var>.</ol>

  <p>To <dfn id="determining-navigation-params-policy-container">determine navigation params policy container</dfn> given a <a id="policy-containers:url-2" href="https://triple-underscore.github.io/URL-ja.html#concept-url" data-x-internal="url">URL</a> <var>responseURL</var> and four <a href="#policy-container" id="policy-containers:policy-container-5">policy container</a>-or-nulls <var>historyPolicyContainer</var>, <var>initiatorPolicyContainer</var>, <var>parentPolicyContainer</var>, and <var>responsePolicyContainer</var>:</p>

  <ol><li><p>If <var>historyPolicyContainer</var> is not null, then:</p>

    <ol><li><p><a id="policy-containers:assert" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>responseURL</var> <a href="#requires-storing-the-policy-container-in-history" id="policy-containers:requires-storing-the-policy-container-in-history">requires storing the policy container in history</a>.<li><p>Return a <a href="#clone-a-policy-container" id="policy-containers:clone-a-policy-container-2">clone</a> of <var>historyPolicyContainer</var>.</ol>
   <li><p>If <var>responseURL</var> is <code id="policy-containers:about:srcdoc"><a href="urls-and-fetching.html#about:srcdoc">about:srcdoc</a></code>, then:</p>

    <ol><li><p><a id="policy-containers:assert-2" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>parentPolicyContainer</var> is not null.<li><p>Return a <a href="#clone-a-policy-container" id="policy-containers:clone-a-policy-container-3">clone</a> of <var>parentPolicyContainer</var>.</ol>
   <li><p>If <var>responseURL</var> <a href="https://triple-underscore.github.io/Fetch-ja.html#is-local" id="policy-containers:is-local-2" data-x-internal="is-local">is local</a> and <var>initiatorPolicyContainer</var> is not null, then return a <a href="#clone-a-policy-container" id="policy-containers:clone-a-policy-container-4">clone</a> of <var>initiatorPolicyContainer</var>.<li><p>If <var>responsePolicyContainer</var> is not null, then return <var>responsePolicyContainer</var>.<li><p>Return a new <a href="#policy-container" id="policy-containers:policy-container-6">policy container</a>.</ol>

  <p>To <dfn id="initialize-worker-policy-container">initialize a worker global scope's policy container</dfn> given a <code id="policy-containers:workerglobalscope-2"><a href="workers.html#workerglobalscope">WorkerGlobalScope</a></code> <var>workerGlobalScope</var>, a <a href="https://triple-underscore.github.io/Fetch-ja.html#concept-response" id="policy-containers:concept-response-2" data-x-internal="concept-response">response</a> <var>response</var>, and an <a id="policy-containers:environment-2" href="webappapis.html#environment">environment</a> <var>environment</var>:</p>

  <ol><li><p>If <var>workerGlobalScope</var>'s <a href="workers.html#concept-workerglobalscope-url" id="policy-containers:concept-workerglobalscope-url">url</a> <a href="https://triple-underscore.github.io/Fetch-ja.html#is-local" id="policy-containers:is-local-3" data-x-internal="is-local">is local</a> but its <a href="https://triple-underscore.github.io/URL-ja.html#concept-url-scheme" id="policy-containers:concept-url-scheme-3" data-x-internal="concept-url-scheme">scheme</a> is not "<code>blob</code>":</p>

    <ol><li><p><a id="policy-containers:assert-3" href="https://triple-underscore.github.io/infra-ja.html#assert" data-x-internal="assert">Assert</a>: <var>workerGlobalScope</var>'s <a id="policy-containers:concept-WorkerGlobalScope-owner-set" href="workers.html#concept-WorkerGlobalScope-owner-set">owner set</a>'s <a href="https://triple-underscore.github.io/infra-ja.html#list-size" id="policy-containers:list-size" data-x-internal="list-size">size</a> is 1.<li><p>Set <var>workerGlobalScope</var>'s <a href="workers.html#concept-workerglobalscope-policy-container" id="policy-containers:concept-workerglobalscope-policy-container">policy container</a> to a <a href="#clone-a-policy-container" id="policy-containers:clone-a-policy-container-5">clone</a> of <var>workerGlobalScope</var>'s <a id="policy-containers:concept-WorkerGlobalScope-owner-set-2" href="workers.html#concept-WorkerGlobalScope-owner-set">owner set</a>[0]'s <a id="policy-containers:relevant-settings-object" href="webappapis.html#relevant-settings-object">relevant settings object</a>'s <a href="webappapis.html#concept-settings-object-policy-container" id="policy-containers:concept-settings-object-policy-container">policy container</a>.</ol>
   <li><p>Otherwise, set <var>workerGlobalScope</var>'s <a href="workers.html#concept-workerglobalscope-policy-container" id="policy-containers:concept-workerglobalscope-policy-container-2">policy container</a> to the result of <a href="#creating-a-policy-container-from-a-fetch-response" id="policy-containers:creating-a-policy-container-from-a-fetch-response">creating a policy container from a fetch response</a> given <var>response</var> and <var>environment</var>.</ol>

  


  <nav><a href="popover.html">← 6.12 The popover attribute</a> — <a href="./">Table of Contents</a> — <a href="nav-history-apis.html">7.2 APIs related to navigation and session history →</a></nav>
